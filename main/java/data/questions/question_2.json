{"items":[{"tags":["java","spring-boot","cglib","spring-framework-beans"],"answers":[{"owner":{"user_id":1347695,"display_name":"SreÄ‡ko Toroman"},"up_vote_count":3,"is_accepted":true,"creation_date":1673082130,"answer_id":75039143,"body":"<p>Will try to help, but let me preface by saying I'm not an expert on Spring or anything close to it.</p>\n<p>When using <code>@Autowired</code> and <code>@Lazy</code> (or <code>@Inject</code> and <code>@Lazy</code>), Spring will not inject the requested instance itself, naturally since you want it to be lazily initialized. Instead, it creates a &quot;lazy proxy&quot; object for it. The purpose of the proxy is defer the initialization of the real dependency for as long as possible.</p>\n<p>Think of a Lazy proxy as a Mockito spy, or a <code>java.lang.reflect.Proxy</code>. It has the same interface as the original object that it is proxying to. It also has a bit of &quot;middleware&quot; in it (a.k.a <code>InvocationHandler</code> implementation), which is responsible for initializing the &quot;real dependency&quot; as soon as the first invocation is made on the proxy. From that point on, all method calls on the proxy are simply forwarded to the downstream dependency.</p>\n<p>For some good reason I suppose, Spring has its own Proxy implementation at <a href=\"https://github.com/spring-projects/spring-framework/blob/main/spring-core/src/main/java/org/springframework/cglib/proxy/Proxy.java\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-framework/blob/main/spring-core/src/main/java/org/springframework/cglib/proxy/Proxy.java</a> (rather than using Java's built-in Proxy). This is the &quot;CGLIB&quot; stuff you were referring to. Browse around that class, the whole module, as well as the parent module, to learn more about it.</p>\n<p>Check out the docs on the Java built-in Proxy too <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/reflect/Proxy.html\" rel=\"nofollow noreferrer\">https://docs.oracle.com/javase/7/docs/api/java/lang/reflect/Proxy.html</a></p>\n<p>A better alternative to using <code>@Lazy</code> is probably to use <code>Provider&lt;Foo&gt; fooProvider</code> or similar, rather than <code>@Lazy @Autowired Foo foo</code>. The downside is that you have to call <code>fooProvider.get()</code> or such but the advantage is that you don't need to explain anyone how on earth <code>@Lazy</code> even works.</p>\n<p>Finally, the hashCodes and toStrings questions you posed - the <code>@Lazy</code> injected instance (proxy) probably proxies the <code>toString()</code> call to the downstream dependency, but does not proxy the <code>hashCode()</code> and <code>equals()</code> methods. Not entirely sure why they would choose to do that, but, that's what it looks like to me.</p>\n<p>Hope it helps lead you toward the real answer, cheers!</p>\n"}],"owner":{"user_id":5992555,"display_name":"Luv"},"view_count":98,"up_vote_count":4,"accepted_answer_id":75039143,"answer_count":1,"score":4,"creation_date":1673044145,"question_id":75036649,"body":"<p>Why do bean of classes created using @Lazy annotation have different reference compared to the normal Autowired objects of the same class. I am aware that @Lazy provides bean instance when it is required but i thought it would always be the same reference.</p>\n<p>I have written below tests to demonstrate the same.</p>\n<p>A simple counter service :</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Service\npublic class CounterService {\n\n  private final AtomicInteger counter = new AtomicInteger();\n\n\n  public void inc() {\n    counter.incrementAndGet();\n  }\n\n  public int getCounter() {\n    return counter.get();\n  }\n\n}\n</code></pre>\n<p>Tests without use of Lazy :</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class CounterServiceTest extends BaseITTest {\n\n  @Autowired\n  private CounterService counterService;\n  @Autowired\n  private ApplicationContext context;\n\n  @Test\n  void testBeansReference() {\n    CounterService contextCounterService = context.getBean(CounterService.class);\n\n    counterService.inc();\n    contextCounterService.inc();\n\n    System.out.println(counterService.getCounter() + &quot; / &quot; + contextCounterService.getCounter());\n    System.out.println(&quot;counterService --&gt; obj: &quot; + counterService + &quot;, hashCode: &quot; + counterService.hashCode());\n    System.out.println(&quot;contextCounterService --&gt; obj: &quot; + contextCounterService + &quot;, hashCode: &quot; + contextCounterService.hashCode());\n    System.out.println(&quot;== Check: &quot; + (counterService == contextCounterService));\n    System.out.println(&quot;.equals() Check: &quot; + (counterService.equals(contextCounterService)));\n  }\n  \n}\n</code></pre>\n<p>Output :</p>\n<pre><code>2 / 2\ncounterService --&gt; obj: com.flock.appointment.service.CounterService@750c23a3, hashCode: 1963729827\ncontextCounterService --&gt; obj: com.flock.appointment.service.CounterService@750c23a3, hashCode: 1963729827\n== Check: true\n.equals() Check: true\n</code></pre>\n<p>Tests without use of Lazy :</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class CounterServiceLazyTest extends BaseITTest {\n\n  @Lazy\n  @Autowired\n  private CounterService counterService;\n  @Autowired\n  private ApplicationContext context;\n\n  @Test\n  void testBeansReference() {\n    CounterService contextCounterService = context.getBean(CounterService.class);\n\n    counterService.inc();\n    contextCounterService.inc();\n\n    System.out.println(counterService.getCounter() + &quot; / &quot; + contextCounterService.getCounter());\n    System.out.println(&quot;counterService --&gt; obj: &quot; + counterService + &quot;, hashCode: &quot; + counterService.hashCode());\n    System.out.println(&quot;contextCounterService --&gt; obj: &quot; + contextCounterService + &quot;, hashCode: &quot; + contextCounterService.hashCode());\n    System.out.println(&quot;== Check: &quot; + (counterService == contextCounterService));\n    System.out.println(&quot;.equals() Check: &quot; + (counterService.equals(contextCounterService)));\n  }\n\n}\n</code></pre>\n<p>Output :</p>\n<pre><code>2 / 2\ncounterService --&gt; obj: com.flock.appointment.service.CounterService@259c6ab8, hashCode: -1833445830\ncontextCounterService --&gt; obj: com.flock.appointment.service.CounterService@259c6ab8, hashCode: 631007928\n== Check: false\n.equals() Check: false\n</code></pre>\n<ul>\n<li>Note that output in second test(with  lazy) is 2, which proves that even though reference is different, the classes are still singleton which is expected as other wise output of wouldn't be 2/2.</li>\n<li>I am also not sure in second test why object.toString() are producing same outputs even though hashCode is different and also == checks says false. Isn't number in end of toString() hex of hashCode, and that hex should be different as hashCodes printed are different ?</li>\n<li>I had observed the instance of counterService in test 2 in debugger and the instance was enhanced by CGLIB, I read about CGLIB and it made me think most of the things are due to it but I did not understand it properly how all of this is happening, Also I would like to know in detail exactly how is spring internally doing this.</li>\n</ul>\n"},{"tags":["java","spring","maven","spring-data","azure-cosmosdb"],"comments":[{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"edited":false,"comment_id":134334858,"body":"Your question does not include an actual problem. Include the error you are getting, or, if no error, the behaviour you got and the different behaviour you actually wanted."},{"owner":{"user_id":12268910,"display_name":"java12399900"},"edited":false,"comment_id":134335496,"body":"@rzwitserloot question now updated"},{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":134335947,"body":"You have defined <code>PersonRepository</code> as an <code>interface</code>.  It needs to be a <code>class</code> if you want Spring to be able to make an instance of it."},{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":134369062,"body":"@java12399900 you need to place <code>@EnableCosmosRepositories</code> somewhere in your configuration: <a href=\"https://learn.microsoft.com/en-us/java/api/overview/azure/spring-data-cosmos-readme?view=azure-java-stable#setup-configuration-class\" rel=\"nofollow noreferrer\">learn.microsoft.com/en-us/java/api/overview/azure/&hellip;</a>"},{"owner":{"user_id":7237884,"display_name":"Panagiotis Bougioukos"},"edited":false,"comment_id":134379519,"body":"@java12399900 please take a look in my answer bellow to resolve your issue"},{"owner":{"user_id":10435528,"display_name":"devatherock"},"edited":false,"comment_id":134380546,"body":"@java12399900 From the <code>CosmosDbRepositoriesAutoConfigureRegistrar</code> class name in the latest error, it looks like along with <code>azure-spring-data-cosmos</code>, you are also using a 2.x version of <code>azure-spring-boot</code>. If so, can you switch it to a 3.x version?"}],"answers":[{"owner":{"user_id":6309,"display_name":"VonC"},"up_vote_count":3,"is_accepted":false,"creation_date":1683485903,"answer_id":76195768,"body":"<p>To expand on what is commented, the &quot;<a href=\"https://learn.microsoft.com/en-us/java/api/overview/azure/spring-data-cosmos-readme?view=azure-java-stable#customizing-configuration\" rel=\"nofollow noreferrer\">Azure Spring Data Cosmos client library for Java / Customizing Configuration</a>&quot; section does mention:</p>\n<blockquote>\n<p>By default, <code>@EnableCosmosRepositories</code> will scan the current package for any interfaces that extend one of Spring Data's repository interfaces.</p>\n<p>Use it to annotate your Configuration class to scan a different root package by <code>@EnableCosmosRepositories(basePackageClass=UserRepository.class)</code> if your project layout has multiple projects.</p>\n</blockquote>\n<p>Meaning:  if your repository class is not in the same package or a subpackage of your main application class, use <code>@EnableCosmosRepositories(basePackageClasses = PersonRepository.class)</code> to specify the package containing your repository class.</p>\n<p>In your case, try:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootApplication(exclude = {MongoAutoConfiguration.class, MongoDataAutoConfiguration.class})\n@EnableSwagger2\n@ConfigurationPropertiesScan(&quot;com.example.person&quot;)\n@EnableCosmosRepositories(basePackageClasses = PersonRepository.class)\npublic class PersonApplication extends SpringBootServletInitializer {\n    // ...\n}\n</code></pre>\n<p>If your <code>PersonRepository</code> is defined in the package <code>com.example.person.repository</code>, the <code>@EnableCosmosRepositories(basePackageClasses = PersonRepository.class)</code> annotation will tell Spring Boot to scan the <code>com.example.person.repository</code> package for any interfaces extending Spring Data Cosmos DB repository interfaces.</p>\n<hr />\n<p>The OP adds:</p>\n<blockquote>\n<p>When I add <code>@EnableCosmosRepositories</code>, I get the following:</p>\n<p>The bean '<code>personRepository</code>', defined in &quot;<code>com.example.PersonRepository</code> defined in <code>@EnableCosmosRepositories</code> declared on <code>CosmosDbRepositoriesAutoConfigureRegistrar.EnableCosmosDbRepositoriesConfiguration</code>, could not be registered.<br />\nA bean with that name has already been defined in <code>com.example.PersonRepository</code> defined in <code>@EnableCosmosRepositories</code> declared on <code>PersonApplication</code> and overriding is disabled.</p>\n</blockquote>\n<p>So you have a conflict between two beans with the same name, <code>personRepository</code>: check if you have multiple <code>@EnableCosmosRepositories</code> declarations in your configuration.</p>\n<p>If you do, try and remove the <code>@EnableCosmosRepositories</code> annotation from your <code>PersonApplication</code> class, since the <code>CosmosDbRepositoriesAutoConfigureRegistrar.EnableCosmosDbRepositoriesConfiguration</code> class seems to already have the annotation.<br />\nInstead, focus on updating the <code>CosmosDbRepositoriesAutoConfigureRegistrar.EnableCosmosDbRepositoriesConfiguration</code> class to include the package containing your PersonRepository.</p>\n<p>But: If you do <em>not</em> have access to the <code>CosmosDbRepositoriesAutoConfigureRegistrar.EnableCosmosDbRepositoriesConfiguration</code> class, you can try excluding the <code>CosmosDbRepositoriesAutoConfiguration</code> class from your Spring Boot auto-configuration, which may resolve the conflict.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootApplication(\n        exclude = {\n                MongoAutoConfiguration.class,\n                MongoDataAutoConfiguration.class,\n                CosmosDbRepositoriesAutoConfiguration.class\n        }\n)\n@EnableSwagger2\n@ConfigurationPropertiesScan(&quot;com.example.person&quot;)\n@EnableCosmosRepositories(basePackageClasses = PersonRepository.class)\npublic class PersonApplication extends SpringBootServletInitializer {\n    // ...\n}\n</code></pre>\n<p>This should disable the auto-configuration of the <code>CosmosDbRepositoriesAutoConfiguration</code> class, leaving only your custom <code>@EnableCosmosRepositories</code> annotation in place.</p>\n<hr />\n<p>And, As <a href=\"https://stackoverflow.com/questions/76174075/parameter-of-constructor-required-a-bean-of-type-that-could-not-be-found?noredirect=1#comment134380546_76174075\">commented</a>, make sure to use a <a href=\"https://mvnrepository.com/artifact/com.azure.spring/azure-spring-boot\" rel=\"nofollow noreferrer\">3.x version of <code>azure-spring-boot</code></a> as you do for <a href=\"https://mvnrepository.com/artifact/com.azure/azure-spring-data-cosmos\" rel=\"nofollow noreferrer\"><code>azure-spring-data-cosmos</code></a>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;\n    &lt;artifactId&gt;azure-spring-boot&lt;/artifactId&gt;\n    &lt;version&gt;3.14.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>(since <code>azure-spring-boot</code> has in its &quot;compile dependencies&quot; <code>azure-spring-data-cosmos</code> (optional) 3.34.0)</p>\n"},{"owner":{"user_id":7237884,"display_name":"Panagiotis Bougioukos"},"up_vote_count":0,"is_accepted":false,"creation_date":1683551114,"answer_id":76200892,"body":"<p>It seems that in the same package <code>com.example</code> you have another class named <code>HierarchyRepository</code> which is registering another repository with the same name (<code>personRepository</code>).</p>\n<p>Probably this is just an interface that you want to use for plain hierarchy, and in that case it should not have been registered as a spring bean.</p>\n<p>The solution to this problem to continue to have your <code>HierarchyRepository</code> in the same scanned package is to go into this class (<code>HierarchyRepository</code>) and use the annotation <code>@NoRepositoryBean</code>. Then you would be able to use it in your code, but it will not be able to be registered as a bean, so it will not conflict with the other bean that is created from <code>@EnableCosmosRepositories</code> which is the one you need.</p>\n"}],"owner":{"user_id":12268910,"display_name":"java12399900"},"view_count":267,"up_vote_count":5,"answer_count":2,"score":4,"creation_date":1683208992,"question_id":76174075,"body":"<p>I have the following <strong>Spring Repository</strong>:</p>\n<pre><code>import com.azure.spring.data.cosmos.repository.CosmosRepository;\nimport org.springframework.stereotype.Repository;\n\n@Repository\npublic interface PersonRepository extends CosmosRepository&lt;Person, String&gt; {}\n</code></pre>\n<p>It is referenced here in the constructor of my <strong>service</strong> class:</p>\n<pre><code>private final PersonRepository personRepository ;\n\n@Autowired\n    public PersonService(\n            PersonRepository personRepository) {\n        this.personRepository= personRepository;\n    }\n</code></pre>\n<p>I have added this dependency in my <strong>pom</strong>:</p>\n<pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;com.azure&lt;/groupId&gt;\n  &lt;artifactId&gt;azure-spring-data-cosmos&lt;/artifactId&gt;\n  &lt;version&gt;3.34.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>This is my application starter class:</p>\n<pre><code>@SpringBootApplication(exclude = {MongoAutoConfiguration.class, MongoDataAutoConfiguration.class})\n@EnableSwagger2\n@ConfigurationPropertiesScan(&quot;com.example.person&quot;)\npublic class PersonApplication extends SpringBootServletInitializer {\n</code></pre>\n<p>The <strong>error</strong> I am getting is:</p>\n<pre><code>Parameter 3 of constructor in PersonService required a bean of type 'PersonRepository' that could not be found.\n    \nAction:\nConsider defining a bean of type 'PersonRepository' in your configuration.\n</code></pre>\n<p>What is the issue here? Am I missing another <code>dependency</code> necessary in order to use the <code>CosmosRepository</code> within my <code>Spring boot</code> application?</p>\n<p>EDIT: when I add @EnableCosmosRepositories I get the following:</p>\n<p><code>The bean 'personRepository', defined in &quot;com.example.PersonRepository defined in @EnableCosmosRepositories declared on CosmosDbRepositoriesAutoConfigureRegistrar.EnableCosmosDbRepositoriesConfiguration, could not be registered. A bean with that name has already been defined in com.example.PersonRepository defined in @EnableCosmosRepositories declared on PersonApplication and overriding is disabled.&quot;</code></p>\n"},{"tags":["java","heap-memory","java-17"],"comments":[{"owner":{"user_id":40342,"display_name":"Joachim Sauer"},"edited":false,"comment_id":134316789,"body":"IIRC 32GB heap is when the JVM turns off <a href=\"https://wiki.openjdk.org/display/HotSpot/CompressedOops\" rel=\"nofollow noreferrer\">compressed oops</a> (simply speaking: 32bit references in a 64bit JVM). It&#39;s likely this is the cause for what you see."},{"owner":{"user_id":9787309,"display_name":"sacha.p"},"edited":false,"comment_id":134316828,"body":"I don&#39;t sea this behavior with ZGC because there is no compressed oops ?"},{"owner":{"user_id":40342,"display_name":"Joachim Sauer"},"edited":false,"comment_id":134316841,"body":"That&#39;s what your graphs suggest and a quick Google search confirm that this at least <i>was</i> true a while ago (with JDK 15). I suspect it&#39;s simply still true."}],"answers":[{"owner":{"user_id":436560,"display_name":"Lajos Arpad"},"up_vote_count":2,"is_accepted":true,"creation_date":1683118679,"answer_id":76164107,"body":"<p>Refer to this article: <a href=\"https://www.baeldung.com/jvm-compressed-oops\" rel=\"nofollow noreferrer\">https://www.baeldung.com/jvm-compressed-oops</a></p>\n<p>First, let's find out what an oop is:</p>\n<blockquote>\n<p>The HotSpot JVM uses a data structure called <a href=\"https://www.baeldung.com/java-memory-layout\" rel=\"nofollow noreferrer\">oops</a> or Ordinary Object Pointers to represent objects. These oops are equivalent to native C pointers. <strong>The <a href=\"https://github.com/openjdk/jdk15/blob/master/src/hotspot/share/oops/instanceOop.hpp\" rel=\"nofollow noreferrer\">instanceOops</a> are a special kind of oop that represents the object instances in Java</strong>. Moreover, the JVM also supports a handful of other oops that are kept in the <a href=\"http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/87ee5ee27509/src/share/vm/oops/\" rel=\"nofollow noreferrer\">OpenJDK source tree</a>.</p>\n</blockquote>\n<p>Furthermore</p>\n<p><a href=\"https://i.stack.imgur.com/QbcPM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QbcPM.png\" alt=\"enter image description here\" /></a></p>\n<p>A very neat feature is the compressing of oops to 32 bits:</p>\n<blockquote>\n<p>As it turns out, the JVM can avoid wasting memory by compressing the object pointers or oops, so we can have the best of both worlds: <strong>allowing more than 4 GB of heap space with 32-bit references in 64-bit machines!</strong></p>\n</blockquote>\n<p>Finally:</p>\n<blockquote>\n<p>To enable oop compression, we can use the -XX:+UseCompressedOops tuning flag. The oop compression is the default behavior from Java 7 onwards whenever the maximum heap size is less than 32 GB. <strong>When the maximum heap size is more than 32 GB, the JVM will automatically switch off the oop compression</strong>. So memory utilization beyond a 32 Gb heap size needs to be managed differently.</p>\n</blockquote>\n<p>So, the answer to your question is: you simply passed beyond the threshold of 32 GB as the maximum heap size.</p>\n<p><strong>Proof</strong></p>\n<p>Look at your graphs and see that the behavior we are speaking about happens at the level of 32 GB.</p>\n"}],"owner":{"user_id":9787309,"display_name":"sacha.p"},"view_count":85,"up_vote_count":4,"accepted_answer_id":76164107,"answer_count":1,"score":4,"creation_date":1683116969,"question_id":76163844,"body":"<p>my code :</p>\n<pre><code>public class Memory {\n// Dummy Entity representing usual data objects\nprivate static class Entity {\n    public String name;\n    public String detail;\n    public Double amount;\n    public Integer age;\n}\n\n// Linked list offers table inserts and helps illustrating the issue by using multiple\n// references per entry\npublic static java.util.LinkedList&lt;Entity&gt; entities = new java.util.LinkedList&lt;&gt;();\n\n// This threshold should be 2 times Xmn. It ensures the loop stops before a full GC happens.\nprivate static final int MB = 1024 * 1024;\nprivate static final int THRESHOLD = 100 * MB;\n\npublic static void main(String[] args) {\n    System.out.println(&quot;Total Memory (in bytes): &quot; + Runtime.getRuntime().totalMemory());\n    System.out.println(&quot;Free Memory (in bytes): &quot; + Runtime.getRuntime().freeMemory());\n    System.out.println(&quot;Max Memory (in bytes): &quot; + Runtime.getRuntime().maxMemory());\n\n    while (true) {\n        appendEntitiesToDataStructure();\n        terminateBeforeFullGCorOOMEcanHappen();\n    }\n}\n\nprivate static void appendEntitiesToDataStructure() {\n    entities.add(new Entity());\n}\n\nprivate static void terminateBeforeFullGCorOOMEcanHappen() {\n    if (Runtime.getRuntime().freeMemory() &lt; THRESHOLD) {\n        System.out.println(&quot;Elements created and added to LinkedList: &quot; + entities.size());\n        System.exit(0);\n    }\n}}\n</code></pre>\n<p>launch :</p>\n<pre><code>java -Xms${i}g -Xmx${i}g -Xmn50m memory.java &gt;&gt; output.txt\n</code></pre>\n<p>Idea : I want to know the behavior of JVM heap size when it evolves.</p>\n<p>Heap size : from 1 to 100 GB</p>\n<p>GC tested : g1c, zgc, pgc</p>\n<p>Result : with g1c and pgc there is regression from 32GB -&gt; I can store less data in my object as heap size increases.</p>\n<p>Schema : X : size of my object ; Y : heap size</p>\n<p>I don't know how to explain this behavior -&gt; any idea ?</p>\n<p><a href=\"https://i.stack.imgur.com/LVP8c.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LVP8c.jpg\" alt=\"java g1gc\" /></a>\n<a href=\"https://i.stack.imgur.com/jklC0.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jklC0.jpg\" alt=\"java gpc\" /></a>\n<a href=\"https://i.stack.imgur.com/uJTk9.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uJTk9.jpg\" alt=\"java zgc\" /></a></p>\n"},{"tags":["java","intellij-idea","junit5"],"answers":[{"owner":{"user_id":11342225,"display_name":"alea"},"up_vote_count":2,"is_accepted":true,"creation_date":1682927706,"answer_id":76145471,"body":"<p>One way of migration multiple Junit4 tests to Junit5 is <a href=\"https://docs.openrewrite.org\" rel=\"nofollow noreferrer\">OpenRewrite</a>.</p>\n<p>It will have multiple predefined recipes for common tasks like <a href=\"https://docs.openrewrite.org/running-recipes/popular-recipe-guides/migrate-from-junit-4-to-junit-5\" rel=\"nofollow noreferrer\"> Migrating Junit4 to Junit5</a>.</p>\n<p>If you have a maven project without spring, you can add the following to your <code>pom.xml</code>.</p>\n<pre><code>&lt;build&gt;\n  &lt;plugins&gt;\n    &lt;plugin&gt;\n      &lt;groupId&gt;org.openrewrite.maven&lt;/groupId&gt;\n      &lt;artifactId&gt;rewrite-maven-plugin&lt;/artifactId&gt;\n      &lt;version&gt;4.44.0&lt;/version&gt;\n      &lt;configuration&gt;\n        &lt;activeRecipes&gt;\n            &lt;recipe&gt;org.openrewrite.java.testing.junit5.JUnit5BestPractices&lt;/recipe&gt;\n        &lt;/activeRecipes&gt;\n      &lt;/configuration&gt;\n      &lt;dependencies&gt;\n        &lt;dependency&gt;\n          &lt;groupId&gt;org.openrewrite.recipe&lt;/groupId&gt;\n          &lt;artifactId&gt;rewrite-testing-frameworks&lt;/artifactId&gt;\n          &lt;version&gt;1.36.0&lt;/version&gt;\n        &lt;/dependency&gt;\n      &lt;/dependencies&gt;\n    &lt;/plugin&gt;\n  &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>\n<p>Quick explanation:</p>\n<pre><code>&lt;activeRecipes&gt;\n   &lt;recipe&gt;org.openrewrite.java.testing.junit5.JUnit5BestPractices&lt;/recipe&gt;\n&lt;/activeRecipes&gt;\n</code></pre>\n<p>This part activates the rewrite junit recipe, which is in the dependency <code>org.openrewrite.recipe:rewrite-testing-frameworks</code>.</p>\n<p>If you are using Spring or Spring-Boot you will need the active recipe <code>org.openrewrite.java.spring.boot2.SpringBoot2JUnit4to5Migration</code> and the following dependency.</p>\n<pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;org.openrewrite.recipe&lt;/groupId&gt;\n  &lt;artifactId&gt;rewrite-spring&lt;/artifactId&gt;\n  &lt;version&gt;4.35.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>If you are using Gradle, you should check out the <a href=\"https://docs.openrewrite.org/running-recipes/popular-recipe-guides/migrate-from-junit-4-to-junit-5\" rel=\"nofollow noreferrer\">offical documenation</a>.</p>\n<p>Via <code>mvn rewrite:dryRun</code> you can see the results in a <code>.patch</code> file.</p>\n<p>Via <code>mvn rewrite:run</code> the migration will be done. If you have a VCS, you can always run without doing a dry run, because you can see the diff in your VCS' diff tool.</p>\n"}],"owner":{"user_id":1174024,"display_name":"Nicholas DiPiazza"},"view_count":47,"up_vote_count":4,"accepted_answer_id":76145471,"answer_count":1,"score":4,"creation_date":1682881536,"question_id":76143045,"body":"<p>I am converting somewhere around 1000 JUnit tests with</p>\n<pre><code>@Test(expected=SomeException.class)\npublic void testIt() throws SomeException {\n  doSomeStuff();\n}\n</code></pre>\n<p>to JUnit Jupiter API's</p>\n<pre><code>@Test\nvoid testIt() {\n  Assertions.assertThrows(SomeException.class, () -&gt; {\n    doSomeStuff();    \n  });\n}\n</code></pre>\n<p>In Intellij, I know there is some &quot;Surround With&quot; magic, Live Templates, or something that can make this process a little more automated?</p>\n<p>I could always write a script or something, but I figure there's probably a way to utilize Intellij's built-in functionality to make this easier.</p>\n<p>Any ideas?</p>\n"},{"tags":["java","generics"],"comments":[{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"edited":false,"comment_id":134267098,"body":"This is tantamount to asking &#39;can someone write me a tutorial about generics&#39; which is.. perhaps something along the lines of at least 100 pages. Well beyond what Stack Overflow is meant for."}],"answers":[{"owner":{"user_id":3429015,"display_name":"Danon"},"up_vote_count":1,"is_accepted":false,"creation_date":1682759175,"answer_id":76135374,"body":"<p>To answer the first part of your question, you should try and always used declared type <code>T</code> as it provides more secure types, and only use <code>?</code> as the last resort (or, when you exactly know what you're doing).</p>\n<p>To answer the second part of your question, let me use your example:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public abstract class Base&lt;T extends EntityInfo&gt; {}\n\npublic abstract class BaseMapper&lt;T extends Base&lt;? extends EntityInfo&gt;&gt;{}\n</code></pre>\n<p>When declaring a class with generics, you can only declare generic types right between <code>&lt;&gt;</code> brackets of <em>that</em> class. So for <code>Base</code>, you can declare <code>T</code> right in <code>Base&lt;&gt;</code>. But for your second example, you can correctly declare <code>T</code> in <code>BaseMapper&lt;T&gt;</code>, but the second generic type (the one you tried to declare <code>S</code>) is no longer in the brackets of <code>BaseMapper</code>, it's in bracket of another class (a class, that's not being declared right now). In Java, there's a difference between declaring a class and using the class as a type. In your example, <code>Base&lt;? extends EntityInfo&gt;</code> is a class that's being <em>used</em> in declaration (similarly to how class <code>Integer</code> has to already exist when declaring <code>List&lt;Integer&gt;</code>). You might very well declare <code>BaseMapper</code> and use <code>Base&lt;&gt;</code> as its generic type, but that used <code>BaseMapper</code> will need to have the generic type specified. You tried to specify type <code>S</code>, but that type wasn't declared anywhere in the declaraton of <code>BaseMapper</code>.</p>\n<p>For it to work, you would need:</p>\n<ul>\n<li>Declare type <code>S</code> that extends <code>EntityInfo</code></li>\n<li>Declare type <code>S</code> that extends <code>EntityInfo&lt;S&gt;</code></li>\n</ul>\n<p>Something similar to this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public abstract class Base&lt;T extends EntityInfo&gt; {}\n\npublic abstract class BaseMapper&lt;S extends EntityInfo, T extends Base&lt;S&gt;&gt;{}\n</code></pre>\n<p>Your problem really reflects the lack of knowledge on how Java generics work.</p>\n"},{"owner":{"user_id":6328256,"display_name":"Sash Sinha"},"up_vote_count":1,"is_accepted":true,"creation_date":1682759392,"answer_id":76135403,"body":"<p>The key difference between using a wildcard and a specific type parameter is how Java handles generics during compilation.</p>\n<p>When you use the wildcard <code>?</code>, it represents an unknown type that extends the given bound. It allows any subtype of the given bound to be used, but the specific type information is lost. This is useful when you want to allow a wide range of types without specifying the exact type.</p>\n<p>However, when you use a specific type parameter, such as <code>S extends EntityInfo</code>, it signifies that you want to have a concrete type that extends <code>EntityInfo</code>. This allows you to use that type information within the class definition.</p>\n<p>In the context of the code you provided:</p>\n<ul>\n<li><p>The code compiles fine when you use <code>? extends EntityInfo</code> in the\n<code>BaseMapper</code> class:</p>\n<pre><code>public abstract class BaseMapper&lt;T extends Base&lt;? extends EntityInfo&gt;&gt;{}\n</code></pre>\n<p>This works because the type parameter <code>T extends Base</code> with an unknown\nsubtype of <code>EntityInfo</code>. So, when you create the <code>ImpMapper</code> class:</p>\n<pre><code>public class ImpMapper extends BaseMapper&lt;Imp&gt;{}\n</code></pre>\n<p><code>Imp</code> is a valid type, as it extends <code>Base&lt;Individual&gt;</code>, and <code>Individual</code> implements <code>EntityInfo</code>.</p>\n</li>\n<li><p>The code does not compile when you replace the wildcard with a specific type parameter:</p>\n<pre><code>public abstract class BaseMapper&lt;T extends Base&lt;S extends EntityInfo&gt;&gt;{}\n</code></pre>\n<p>This is because you are trying to declare a type parameter <code>S</code> within the bounds of another type parameter <code>T</code>. This is not valid syntax in Java. Instead, you should declare the type parameter separately:</p>\n<pre><code>public abstract class BaseMapper&lt;S extends EntityInfo, T extends Base&lt;S&gt;&gt;{}\n</code></pre>\n<p>Now, when you try to create the <code>ImpMapper</code> class:</p>\n<pre><code>public class ImpMapper extends BaseMapper&lt;Imp&gt;{}\n</code></pre>\n<p>You will still encounter a compilation error because <code>BaseMapper</code> expects two type parameters, but you only provided one (<code>Imp</code>). To fix this, provide both type parameters:</p>\n<pre><code>public class ImpMapper extends BaseMapper&lt;Individual, Imp&gt;{}\n</code></pre>\n<p>This will compile successfully since <code>Imp extends Base&lt;Individual&gt;</code>, and <code>Individual</code> implements <code>EntityInfo</code>.</p>\n</li>\n</ul>\n"}],"owner":{"user_id":20015709,"display_name":"BinaryBee"},"view_count":62,"up_vote_count":4,"accepted_answer_id":76135403,"answer_count":2,"score":4,"creation_date":1682713926,"question_id":76133094,"body":"<p>I am a bit confused on how generic works, specially on when we should be using type <code>T</code> vs wildcard <code>?</code>.</p>\n<p>I have the following:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface EntityInfo {}\n\npublic class Individual implements EntityInfo {}\n\npublic abstract class Base&lt;T extends EntityInfo&gt; {}\n\npublic class Imp extends Base&lt;Individual&gt;{}\n\npublic abstract class BaseMapper&lt;T extends Base&lt;? extends EntityInfo&gt;&gt;{}\n\npublic class ImpMapper extends BaseMapper&lt;Imp&gt;{}\n</code></pre>\n<p>This compiles fine. But if I change <code>BaseMapper</code>: from <code>? extends EntityInfo</code> to <code>S extends EntityInfo</code>, the compiler will complain:</p>\n<ol>\n<li>On BaseMapper: <code>Unexpected bound</code></li>\n<li>On ImpMapper: <code>Type parameter 'Imp' is not within its bound; should extend 'Base&lt;S&gt;'</code></li>\n</ol>\n<p>I am unsure how this works, why does wildcard work here and specific type will cause the compilation error?</p>\n<p>Could anyone help me understand/explain the above?</p>\n"},{"tags":["java","playframework","sbt"],"comments":[{"owner":{"user_id":1257694,"display_name":"Kingpin2k"},"edited":false,"comment_id":133974863,"body":"yeah, the typesafe repo is currently down, haven&#39;t quite figured out who to tell yet."},{"owner":{"user_id":86485,"display_name":"Seth Tisue"},"edited":false,"comment_id":134211923,"body":"the ticket on this transient outage was <a href=\"https://github.com/sbt/sbt/issues/7202\" rel=\"nofollow noreferrer\">github.com/sbt/sbt/issues/7202</a>"}],"answers":[{"owner":{"user_id":3331412,"display_name":"comdotlinux"},"up_vote_count":1,"is_accepted":false,"creation_date":1680927713,"answer_id":75963290,"body":"<p>If the source repository is public you could temporarily use <a href=\"https://jitpack.io\" rel=\"nofollow noreferrer\">https://jitpack.io</a> and maybe the tag to get the new maven coordinates and get the build working.</p>\n<p>This works with maven not sure if it is also working with sbt.</p>\n"},{"owner":{"user_id":865448,"display_name":"tostao"},"up_vote_count":1,"is_accepted":false,"creation_date":1681198929,"answer_id":75983521,"body":"<p>Finally, after removed all cached libs (on the mac: <code>~/Library/Caches/Coursier/v1/https</code>) sbt is able to download <code>sbt-js-engine</code> from repo.scala-sbt.org:</p>\n<p><code>https://repo.scala-sbt.org/scalasbt/sbt-plugin-releases/com.typesafe.sbt/sbt-js-engine/scala_2.12/sbt_1.0/1.2.3/ivys/ivy.xml</code></p>\n"}],"owner":{"user_id":865448,"display_name":"tostao"},"view_count":260,"up_vote_count":4,"answer_count":2,"score":4,"creation_date":1680869268,"question_id":75958260,"body":"<p>From today CI is not able to build the playframework project because of unresolved dependencies. I even cloned playframework sample hello world project - <a href=\"https://github.com/playframework/play-samples/tree/2.8.x/play-java-hello-world-tutorial\" rel=\"nofollow noreferrer\">https://github.com/playframework/play-samples/tree/2.8.x/play-java-hello-world-tutorial</a> and result is same, same dependency are missing:</p>\n<pre><code>[warn]\n[warn]  Note: Some unresolved dependencies have extra attributes.  Check that these dependencies exist with the requested attributes.\n[warn]      com.typesafe.sbt:sbt-js-engine:1.2.3 (scalaVersion=2.12, sbtVersion=1.0)\n[warn]\n[warn]  Note: Unresolved dependencies path:\n[error] sbt.librarymanagement.ResolveException: Error downloading com.typesafe.sbt:sbt-js-engine;sbtVersion=1.0;scalaVersion=2.12:1.2.3\n[error]   Not found\n[error]   Not found\n[error]   not found: https://repo1.maven.org/maven2/com/typesafe/sbt/sbt-js-engine_2.12_1.0/1.2.3/sbt-js-engine-1.2.3.pom\n</code></pre>\n<pre><code>not found: https://repo.typesafe.com/typesafe/releases/com/typesafe/sbt/sbt-js-engine_2.12_1.0/1.2.3/sbt-js-engine-1.2.3.pom\n</code></pre>\n<p>Problem is with lib:</p>\n<pre><code>Error downloading com.typesafe.sbt:sbt-js-engine;sbtVersion=1.0;scalaVersion=2.12:1.2.3\n</code></pre>\n<p>and when I check <a href=\"https://repo1.maven.org/maven2/com/typesafe/sbt\" rel=\"nofollow noreferrer\">https://repo1.maven.org/maven2/com/typesafe/sbt</a> all this dependency are missing.</p>\n<p>Any action I can do? Or even information, why this artifacts were removed?</p>\n<p><strong>UPDATE</strong>:</p>\n<p>repository: <a href=\"https://repo.typesafe.com/typesafe/releases/\" rel=\"nofollow noreferrer\">https://repo.typesafe.com/typesafe/releases/</a> redirect me to <a href=\"https://dl.cloudsmith.io/public/lightbend/maven-releases/maven/\" rel=\"nofollow noreferrer\">https://dl.cloudsmith.io/public/lightbend/maven-releases/maven/</a>\nso maybe problem is with dl.cloudsmith.io?</p>\n<p><strong>UPDATE #2</strong>:</p>\n<p>Looks like on sbt github repo, was created ticket related to this outage:  <a href=\"https://github.com/sbt/sbt/issues/7202\" rel=\"nofollow noreferrer\">https://github.com/sbt/sbt/issues/7202</a> (Thanks @SethTisue)</p>\n"},{"tags":["java","junit5","instancio"],"answers":[{"owner":{"user_id":45112,"display_name":"armandino"},"up_vote_count":2,"is_accepted":true,"creation_date":1678679235,"answer_id":75717904,"body":"<p>For a one-off case, the easiest option is to specify the implementation manually, e.g.</p>\n<pre class=\"lang-java prettyprint-override\"><code>Person person = Instancio.of(Person.class)\n    .subtype(all(Pet.class), Cat.class)\n    .create();\n</code></pre>\n<p>However, I assume that you want implementations to be found automatically. If so, there are a couple of options.</p>\n<ol>\n<li>Implement the <code>TypeResolver</code> (see <a href=\"https://www.instancio.org/user-guide/#instancio-service-provider-interface\" rel=\"nofollow noreferrer\">InstancioServiceProvider documentation</a>):</li>\n</ol>\n<pre class=\"lang-java prettyprint-override\"><code>class MyTypeResolver implements TypeResolver {\n    private Map&lt;Class&lt;?&gt;, Class&lt;?&gt;&gt; subtypeMap = new HashMap&lt;&gt;();\n\n    @Override\n    public Class&lt;?&gt; getSubtype(Class&lt;?&gt; type) {\n        return subtypeMap.get(type);\n    }\n}\n</code></pre>\n<p>The mapping can be specified manually, or automated by scanning the classpath using a library, such as ClassGraph.</p>\n<blockquote>\n<p><a href=\"https://github.com/instancio/instancio-samples/tree/main/type-resolver-sample\" rel=\"nofollow noreferrer\">See this GitHub repo for a sample implementation</a></p>\n</blockquote>\n<ol start=\"2\">\n<li>Another approach is to <a href=\"https://www.instancio.org/user-guide/#subtype-mapping\" rel=\"nofollow noreferrer\">map types via <code>Settings</code></a>. This can also be specified manually, or automated, for example: <a href=\"https://github.com/dafriedmann/instancio-jandex-subtype-mapping\" rel=\"nofollow noreferrer\">https://github.com/dafriedmann/instancio-jandex-subtype-mapping</a></li>\n</ol>\n"}],"owner":{"user_id":21384924,"display_name":"chris"},"view_count":118,"up_vote_count":4,"accepted_answer_id":75717904,"answer_count":1,"score":4,"creation_date":1678647427,"question_id":75715631,"body":"<p>I used to use Easy-Random to generate JUnit5 test data, however because it does not seem to be developed anymore, doesn't support Java records and in general seems to be less flexibility than Instancio, I've decided to migrate. Instancio, out of the box, provides a lot of nice features enabling quicker testing (easier parametrized tests, taking into consideration Javax etc.), however there is one drawback.</p>\n<p>The objects returned by our persistence layer are auto-generated implementations of some record interface which look like:</p>\n<pre><code>interface SomeRecord {\n  getUid();\n}\n</code></pre>\n<p>Easy-Random was able to find the implementation and generate a random record.</p>\n<p>I cannot find any information on how to resolve this or a workaround in Instancio's docs or anywhere else. Has anyone been able to do something similar?</p>\n"},{"tags":["java","spring","hibernate","spring-transactions","spring-retry"],"answers":[{"owner":{"user_id":1240763,"display_name":"Gary Russell"},"up_vote_count":2,"is_accepted":true,"creation_date":1678373182,"answer_id":75686165,"body":"<p>There was a recent change to the order; see <a href=\"https://github.com/spring-projects/spring-retry/pull/335\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-retry/pull/335</a> and <a href=\"https://github.com/spring-projects/spring-retry/pull/333#pullrequestreview-1330977780\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-retry/pull/333#pullrequestreview-1330977780</a></p>\n<p>It will be available in 2.0.1 (currently in 2.0.1-SNAPSHOT).</p>\n"}],"owner":{"user_id":4132818,"display_name":"Bryan Tan"},"view_count":75,"up_vote_count":4,"accepted_answer_id":75686165,"answer_count":1,"score":4,"creation_date":1678232500,"question_id":75668206,"body":"<p>According to <a href=\"https://stackoverflow.com/questions/59582135/does-annotations-order-matter\">Does annotations order matter?</a> the order shouldn't matter, however for these two it seems that the order does matter.</p>\n<p>If the transaction occurs within the retry, then the transaction could roll back, throw an exception, then spring will retry it. However if the retry occurs within the transaction, there won't be a rollback between each retry as the retry will catch the exception and go again.</p>\n<p>There could be also situations like the database details changing between retries.</p>\n"},{"tags":["java","spring","spring-boot","environment-variables","development-environment"],"comments":[{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":133346602,"body":"add <code>--spring.profiles.active=&lt;your-profile&gt;</code> as a program argument. You can use this as well when launching your app through <code>java -jar &lt;your.jar&gt; --spring.profiles.active=&lt;your-profile&gt;</code>. This is also explained in the spring boot documentation."},{"owner":{"user_id":836018,"display_name":"Jack"},"edited":false,"comment_id":133346803,"body":"I also use Environment variable of Intellij in the run configuration. But could you please explain a little bit more how the other things should be  used based on this scenario? For example, if I activate the environment when running the app, is the the only way? Or what is the usage of <code>spring: profiles: active: production</code> ? or <code>.env</code> file?"}],"answers":[{"owner":{"user_id":12473843,"display_name":"Sergey Tsypanov"},"up_vote_count":2,"is_accepted":false,"creation_date":1677511226,"answer_id":75582327,"body":"<ol>\n<li><p>Yes, you can use <code>spring.profiles.active</code>, but you probably shouldn't, because you specify this in <code>application.yml</code> which should be profile-agnostic. Instead as they pointed out in comments it'd be better to rely on e.g. <code>--spring.profiles.active=dev</code> which would tell Spring Boot to use properties from both <code>application.yml</code> and <code>application-dev.yml</code>.</p>\n</li>\n<li><p>I'd not use this file at all and rely on <code>application.yml</code>, because of two main reasons:</p>\n</li>\n</ol>\n<ul>\n<li>you can run your application from Gradle, Maven, IntelliJ, command line and for all those cases you need to handle environment variables in a different way</li>\n<li>you can run your application on various OSes where environment variables are set up separately</li>\n</ul>\n<p>If I'd solve your issue with dev and prod environments I'd create three files:</p>\n<ul>\n<li>application.yml for props shared over all profiles</li>\n<li>application-dev.yml for dev props</li>\n<li>application-prod.yml for prod props</li>\n</ul>\n<p>Then I'd switch between profiles by specifying --spring.profiles.active=dev|prod`</p>\n<p>P.S. As of your questions in comments:</p>\n<ol>\n<li>In case you specify a profile with --spring.profiles.active=dev<code>and there's a property e.g.</code>server.port<code>in both</code>application.yml<code>and</code>application-dev.yml<code>the value from</code>application-dev.yml` will be used. So you can override properties. It's a standard technique for overriding properties.</li>\n<li>Well, I don't know how you use the properties from <code>.env</code> files. Usually environment variables from OS level are accessed in Java using <code>System.getProperty(String)</code>. Moreover, some frameworks' usage implies there's a certain property specified, e.g. Apache Spark usually needs <code>HADOOP_HOME</code>. So it might be dangerous to remove those <code>.env</code> files.</li>\n<li>For secrets you can use Vault. The idea is that instead of credentials or other sensitive data you specify a key for them and application uses this key to fetch secrets from vault at runtime. This allows to secure the data even if config files leak.</li>\n</ol>\n"}],"owner":{"user_id":836018,"display_name":"Jack"},"view_count":192,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1677509450,"question_id":75581979,"body":"<p>In my Spring Boot apps, I have just started to use different environment for development and get very confused about a proper switch steps and scenarios.</p>\n<p>There are also some files that I could not totally understand as there are several conflicted information on the web about these files.</p>\n<p>Could you please clarify me about these issues below?</p>\n<p><strong>1)</strong> As far as I know, we can set the environment from the following setting in application properties. Is that true? And is there any other way for to switch between environments?</p>\n<pre><code>spring:\n  profiles:\n    active: production\n</code></pre>\n<p><strong>2)</strong> There is also another file called <code>.env</code> and I think there is also different versions e.g. <code>.env-dev</code>. As far as I know, it is used to define environment variables. But, for example when I run the app from IntelliJ, I am not sure if IntelliJ should read variables from it and use when running the app. How should I use this file?</p>\n<p>Based on these 2 issues, you can basically give an example scenario to setup dev and prod environment and switch between them. Any help would be appreciated.</p>\n"},{"tags":["javascript","java","overflow","int32"],"comments":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":133057663,"body":"Related question that might help: <a href=\"https://stackoverflow.com/q/30678303/5133585\">stackoverflow.com/q/30678303/5133585</a>"}],"answers":[{"owner":{"user_id":3788176,"display_name":"Andy Turner"},"up_vote_count":1,"is_accepted":false,"creation_date":1676022662,"answer_id":75409370,"body":"<p>I can't provide a definitive answer as to exactly why you get these exact numbers; but consider that all numbers in JS are doubles.</p>\n<p>So, whereas <code>current * 0x08088405</code> is done using integer arithmetic in Java, <code>a[0]*a[1]</code> is done using double arithmetic in JS, so these intermediate results are different; and the limited precision of a double means that adding 1 to that doesn't actually change the value:</p>\n<pre><code>console.log(a[0]*a[1]) =&gt; -215607868985706270\nconsole.log(a[0]*a[1] + a[2]) =&gt; = -215607868985706270\n</code></pre>\n<p>Compare this to Java, where integer arithmetic is used:</p>\n<pre><code>int[] a = { -1599751945, 0x08088405, 1};\nSystem.out.println(a[0]*a[1])          =&gt; 374601939\nSystem.out.println(a[0]*a[1] + a[2])   =&gt; 374601940\n</code></pre>\n<p>If we make Java do this in double arithmetic:</p>\n<pre><code>double[] a = { -1599751945, 0x08088405, 1};\nSystem.out.println(a[0]*a[1]);         =&gt; -2.15607868985706272E17\nSystem.out.println(a[0]*a[1] + a[2]);  =&gt; -2.15607868985706272E17\n</code></pre>\n<p>You can see that this is <em>almost</em> the same, but differs in the least significant digit:</p>\n<pre><code>-215607868985706270  // JS\n-215607868985706272  // Java\n</code></pre>\n<p>I don't know why there is such a difference here.</p>\n"},{"owner":{"user_id":112968,"display_name":"knittl"},"up_vote_count":0,"is_accepted":false,"creation_date":1676022807,"answer_id":75409399,"body":"<p>Floating point numbers only support precision up to a specific number of digits. JavaScript promotes numbers larger than 32 bits to floating point numbers.</p>\n<p>Java is &quot;more correct&quot; here.</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>// -215607868985706285 is the 64 bit result of your multiplication\nconsole.log(-215607868985706285); // will print -215607868985706285</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<p>See <a href=\"https://stackoverflow.com/questions/588004/is-floating-point-math-broken\">Is floating point math broken?</a> for a general discussion of this topic.</p>\n"},{"owner":{"user_id":14359869,"display_name":"antonio_s87"},"up_vote_count":1,"is_accepted":true,"creation_date":1676023381,"answer_id":75409531,"body":"<p>Use Math.imul() in JavaScript. That should produce the correct result.</p>\n<pre><code>const a = new Int32Array(4)\n\na[0] = -1599751945\na[1] = 0x08088405\na[2] = 1\na[3] = Math.imul(a[0], a[1]) + a[2]\n\nconsole.log('a[3] = ' + a[3])\n</code></pre>\n<p>Additional details as to why can be found <a href=\"https://stackoverflow.com/a/21865422/14359869\">here</a>.</p>\n"}],"owner":{"user_id":3140057,"display_name":"airone"},"view_count":102,"up_vote_count":4,"accepted_answer_id":75409531,"answer_count":3,"score":4,"creation_date":1676021314,"question_id":75409135,"body":"<p>I need to rewrite some legacy Java code performing arithmetic transformations from Java to TypeScript/JavaScript. The problem is the legacy code uses the <code>int</code> Java type (signed 32-bits) and relies on overflows. I almost got what I want using Int32Array in JavaScript, but I still have a difference I can't explain. Look below.</p>\n<p>Java:</p>\n<pre class=\"lang-java prettyprint-override\"><code>int current = -1599751945;\nint next = current * 0x08088405 + 1;\nSystem.out.println(&quot;next = &quot; + next);\n</code></pre>\n<p>Output: next = <strong>374601940</strong></p>\n<p>Javascript:</p>\n<pre class=\"lang-js prettyprint-override\"><code>const a = new Int32Array(4)\n\na[0] = -1599751945\na[1] = 0x08088405\na[2] = 1\na[3] = a[0]*a[1] + a[2]\n\nconsole.log('a[3] = ' + a[3])\n</code></pre>\n<p>Output: a[3] = <strong>374601952</strong></p>\n<p>Can someone explain the difference? And how can I get same result in JavaScript? I tried shift operations, coerce with |0, methods to convert etc., but best result is the one above.</p>\n"},{"tags":["java","spring-boot","watchservice"],"answers":[{"owner":{"user_id":8873770,"display_name":"Jonxag"},"up_vote_count":2,"is_accepted":false,"creation_date":1674469667,"answer_id":75208178,"body":"<p>You should change the loop with and add a try/Catch, in the catch restarting the service. As you commented you need to keep in even if is interrupted , so you will need the use of ExecutorService. Declare the Executor out of the method</p>\n<pre><code>@Autowired\nprivate ExecutorService executor;\n</code></pre>\n<p>and inside the method something similar to my last answer but using the executor</p>\n<pre><code>Runnable task = () -&gt; {\n        while (true) {\n            try {\n                WatchKey key = watchService.take();\n                if (key != null) {\n                    for (WatchEvent&lt;?&gt; event : key.pollEvents()) {\n                        // Perform actions on created files here\n                    }\n                    key.reset();\n                }\n            } catch (Exception e) {\n                // Wait for some time before starting the thread again\n                Thread.sleep(5000);\n            }\n        }\n    };\n    //submit the task to the executor\n    executor.submit(task);\n</code></pre>\n"},{"owner":{"user_id":9601720,"display_name":"thmasker"},"up_vote_count":0,"is_accepted":true,"creation_date":1674564848,"answer_id":75221790,"body":"<p>Actually the solution was quite simple. Wrapping the desired actions with try/catch (catching desired exceptions) in <code>DirectoryWatcherService</code> like this allows the thread to continue monitoring directories:</p>\n<pre><code>@Service\n@RequiredArgsConstructor\npublic class DirectoryWatcherService {\n\n    private final WatchService watchService;\n\n    @Async\n    @EventListener(ApplicationReadyEvent.class)\n    public void startWatching() throws InterruptedException {\n        WatchKey key;\n        while ((key = watchService.take()) != null) {\n            for (WatchEvent&lt;?&gt; event : key.pollEvents()) {\n                try {\n                    // actions on created files\n                } catch (RuntimeException ex) {\n                    // log exception or whatever you choose, as long as execution continues\n                }\n            }\n\n            key.reset();\n        }\n    }\n\n}\n</code></pre>\n"}],"owner":{"user_id":9601720,"display_name":"thmasker"},"view_count":134,"up_vote_count":4,"accepted_answer_id":75221790,"answer_count":2,"score":4,"creation_date":1674133881,"question_id":75172764,"body":"<p>I'm using Java's <code>WatchService</code> API within my Spring Boot application to monitor a directory, and perform some actions on created files. This process is executed asynchronously: it starts automatically right after the application is ready and monitors the directory in the background until the application is stopped.</p>\n<p>This is the configuration class:</p>\n<pre><code>@Configuration\npublic class DirectoryWatcherConfig {\n\n    @Value(&quot;${path}&quot;)\n    private String path;\n\n    @Bean\n    public WatchService watchService() throws IOException {\n        WatchService watchService = FileSystems.getDefault().newWatchService();\n        Path directoryPath = Paths.get(path);\n        directoryPath.register(watchService, StandardWatchEventKinds.ENTRY_CREATE);\n        return watchService;\n    }\n\n}\n</code></pre>\n<p>And this is the monitoring service:</p>\n<pre><code>@Service\n@RequiredArgsConstructor\npublic class DirectoryWatcherService {\n\n    private final WatchService watchService;\n\n    @Async\n    @EventListener(ApplicationReadyEvent.class)\n    public void startWatching() throws InterruptedException {\n        WatchKey key;\n        while ((key = watchService.take()) != null) {\n            for (WatchEvent&lt;?&gt; event : key.pollEvents()) {\n                // actions on created files\n            }\n\n            key.reset();\n        }\n    }\n\n}\n</code></pre>\n<p>This code is working as expected, with the following exception, which I'd like to fix:</p>\n<ul>\n<li>Any failure during the execution makes the monitoring to stop (obviously), and I don't know <strong>how to restart the monitoring</strong> after such events occur</li>\n</ul>\n"},{"tags":["java","locale","dollar-sign","java-19"],"comments":[{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":132454636,"body":"Just for the records: the outcome is the same when you omit the redundant <code>currencyFormatter.setCurrency(Currency.getInstance(Locale.CA&zwnj;&#8203;NADA_FRENCH));</code>?"},{"owner":{"user_id":16703146,"display_name":"Jakub BrÄ™k"},"edited":false,"comment_id":132454714,"body":"The outcome is the same, I mean there is the same difference"},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":132454783,"body":"Only JDK 16 to 18 produce the outcome <code>100,00 $ CA</code>. So the change with JDK 19 is a change back to a long standing behavior."},{"owner":{"user_id":40342,"display_name":"Joachim Sauer"},"edited":false,"comment_id":132455859,"body":"Generally speaking: localization data such as this is subject to change. Any release can pull in new data (usually from CLDR or other sources) that changes any specific detail. If your code (or UI) cares about using a <i>specific</i> currency sign for a given locale, it&#39;s better to explicitly set it than to depend on what the system provides you."}],"answers":[{"owner":{"user_id":2443502,"display_name":"Marcin KÅ‚opotek"},"up_vote_count":2,"is_accepted":true,"creation_date":1673280260,"answer_id":75059950,"body":"<blockquote>\n<p>I cannot find any details in release notes regarding that change.</p>\n</blockquote>\n<p>That's true. You will not find any because maintaining localization changes is not a responsibility of the JDK team. Each JDK release (since 9, see <a href=\"https://openjdk.org/jeps/252\" rel=\"nofollow noreferrer\">JEP-252</a>) uses embeded data from <a href=\"https://cldr.unicode.org/index#h.59ffxi4tj4wz\" rel=\"nofollow noreferrer\">The Unicode Common Locale Data Repository (CLDR)</a> to produce given locale ouput. The CLDR has it's own independent maintainers and release cycle and its contnents may change inbetween JDK releases. That means you should be aware of potential changes in that matter without being notified by the JDK team. As Joachim Sauer mentioned in the comment (he was working on JDK and <a href=\"https://openjdk.org/jeps/252\" rel=\"nofollow noreferrer\">JEP-252</a> implementation), if your code relies on these changes you can always override the defaults and use custom formatting rules.</p>\n<p>You can get more context about CLDR in <a href=\"https://stackoverflow.com/questions/51304126/what-is-common-locale-data-repository-cldr-jdk-9\">What is Common Locale Data Repository (CLDR) - JDK 9</a>.</p>\n"}],"owner":{"user_id":16703146,"display_name":"Jakub BrÄ™k"},"view_count":109,"up_vote_count":4,"accepted_answer_id":75059950,"answer_count":1,"score":4,"creation_date":1673271600,"question_id":75058112,"body":"<p>I am trying to migrate to java 19 from java 18.\nHere is the code I run:</p>\n<pre><code>NumberFormat currencyFormatter = NumberFormat.getCurrencyInstance(Locale.CANADA_FRENCH);\ncurrencyFormatter.setMaximumFractionDigits(2);\ncurrencyFormatter.setCurrency(Currency.getInstance(Locale.CANADA_FRENCH));\nvar result = currencyFormatter.format(100);\nSystem.out.println(result);\n</code></pre>\n<p>It gives different results for those 2 java versions.</p>\n<p>Java 18:\n<code>100,00Â $Â CA</code>\nJava 19:\n<code>100,00 $</code></p>\n<p>I cannot find any details in release notes regarding that change. Am I doing something wrong, or this is expected ?</p>\n"},{"tags":["java","hibernate","jpa"],"comments":[{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":134087877,"body":"what do you mean under &quot;reuse&quot;? Do you want to define JPA annotations in MappedSuperClass and define particular sequence in child classes?"},{"owner":{"user_id":352290,"display_name":"user352290"},"edited":false,"comment_id":134088570,"body":"yes, I want to reuse the Counter definition but pass in the variable sequence_name and other values as dynamic parameter from extended child classes"},{"owner":{"user_id":944593,"display_name":"shareef"},"edited":false,"comment_id":134107454,"body":"what db engine you use oracle or mysql etc..?"},{"owner":{"user_id":2739334,"display_name":"Pwnstar"},"edited":false,"comment_id":134111709,"body":"why do you need this? Having static sequences defined for you db and inside your entities is way easier to understand also way easier to do. There is no point I can think of where this will come in handy and fix a problem you might face. And even speaking of that: Do not fix problems which are not there!"}],"answers":[{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"up_vote_count":1,"is_accepted":false,"creation_date":1681660435,"answer_id":76028793,"body":"<p>The main idea could be override <code>org.hibernate.id.enhanced.SequenceStyleGenerator</code> in the following way:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Target(TYPE)\n@Retention(RUNTIME)\n@Inherited\npublic @interface EntityAwareGeneratorParams {\n\n    String sequence();\n\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public class EntityAwareGenerator extends SequenceStyleGenerator {\n\n    public static final String NAME = EntityAwareGenerator.class.getName();\n\n    @Override\n    public void configure(Type type, Properties params, ServiceRegistry serviceRegistry) throws MappingException {\n        String entityName = params.getProperty(ENTITY_NAME);\n        if (entityName == null) {\n            throw new IllegalStateException(&quot;Entity name must not be null&quot;);\n        }\n\n        Class&lt;?&gt; entityClass = serviceRegistry.requireService(ClassLoaderService.class)\n                .classForName(entityName);\n\n        EntityAwareGeneratorParams generatorParams = entityClass.getAnnotation(EntityAwareGeneratorParams.class);\n        if (generatorParams == null) {\n            throw new IllegalStateException(String.format(\n                    &quot;Annotation @%s is not present for class %s&quot;,\n                    EntityAwareGeneratorParams.class.getName(),\n                    entityClass.getName()\n            ));\n        }\n\n        params.setProperty(SEQUENCE_PARAM, generatorParams.sequence());\n\n        super.configure(type, params, serviceRegistry);\n    }\n\n}\n</code></pre>\n<p>MappedSuperClass:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Id\n@GeneratedValue(generator = &quot;entity-aware-generator&quot;, strategy = GenerationType.SEQUENCE)\n@GenericGenerator(name = &quot;entity-aware-generator&quot;, strategy = EntityAwareGenerator.NAME, ...)\nprivate Long id;\n</code></pre>\n<p>Child classes:</p>\n<pre><code>@Entity\n@EntityAwareGeneratorParams(sequence=&quot;another sequence&quot;)\n</code></pre>\n"}],"owner":{"user_id":352290,"display_name":"user352290"},"view_count":155,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1681378603,"question_id":76003921,"body":"<p>I want to reuse Counter by passing the sequence name <code>order_sequence</code> dynamically to this class, how can this be achieved</p>\n<pre><code>public class Counter  {\n    \n    @Id\n    @GeneratedValue(generator = &quot;sequence-generator&quot;)\n    @GenericGenerator(name = &quot;sequence-generator&quot;, strategy = &quot;org.hibernate.id.enhanced.SequenceStyleGenerator&quot;, parameters = {\n            @Parameter(name = &quot;sequence_name&quot;, value = &quot;order_sequence&quot;),\n            @Parameter(name = &quot;initial_value&quot;, value = &quot;1&quot;), @Parameter(name = &quot;increment_size&quot;, value = &quot;1&quot;) })\n    private Long counter;\n\n}\n</code></pre>\n"},{"tags":["java","android","google-play","google-play-console"],"comments":[{"owner":{"user_id":7927429,"display_name":"Guillem Poy"},"edited":false,"comment_id":133918673,"body":"I am facing the same problem. Yesterday I had an issue related to QUERY_ALL_PACKAGES, but now I was going to follow this tutorial to fix it ( <a href=\"https://web.archive.org/web/20220811110813/https://flutterhq.com/questions-and-answers/2907/updating-an-app-that-has-sensitive-permissions-on-the-google-play-console\" rel=\"nofollow noreferrer\">web.archive.org/web/20220811110813/https://flutterhq.com/&hellip;</a> ), but I can&#39;t since the page seems broken"},{"owner":{"user_id":1348726,"display_name":"Mikalai Daronin"},"edited":false,"comment_id":133921194,"body":"Are you using the owner account of your Google developer profile?"},{"owner":{"user_id":1073124,"display_name":"DrObey"},"edited":false,"comment_id":133924066,"body":"I hate to just be a &quot;Me too&quot;, but I&#39;ve had this for a while: can&#39;t push any updates, and can&#39;t seem to get any clarification from Google. I&#39;m stumped."},{"owner":{"user_id":2024527,"display_name":"SANAT"},"edited":false,"comment_id":133955407,"body":"I got this form link from the Google Play Console to contact with the policy center: <a href=\"https://support.google.com/googleplay/android-developer/contact/appwarning?hl=en&amp;authuser=0\" rel=\"nofollow noreferrer\">support.google.com/googleplay/android-developer/contact/&hellip;</a>"},{"owner":{"user_id":7927429,"display_name":"Guillem Poy"},"edited":false,"comment_id":133958645,"body":"@MikalaiDaronin Yes I am... I got in contact with Google via chat. Couldn&#39;t fix it, now they are &quot;looking into it&quot; and keeping communications via email."}],"answers":[{"owner":{"user_id":2024527,"display_name":"SANAT"},"up_vote_count":1,"is_accepted":true,"creation_date":1680848788,"answer_id":75955974,"body":"<p>I was having same issue and from last 2 days it was not showing any error and Today I am able to see the Sensitive permissions and API is remaining from my side. So issue is from the Google side in Play Console. I have added reply at <a href=\"https://support.google.com/googleplay/android-developer/thread/209568148/can-t-find-the-1-declaration-that-needs-attention-in-app-content-section?hl=en&amp;authuser=1\" rel=\"nofollow noreferrer\">Play Console Help</a> thread.\n<a href=\"https://i.stack.imgur.com/s1M9b.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/s1M9b.png\" alt=\"enter image description here\" /></a></p>\n"}],"owner":{"user_id":6695594,"display_name":"Taimoor Raza"},"view_count":271,"up_vote_count":5,"accepted_answer_id":75955974,"answer_count":1,"score":4,"creation_date":1680542463,"question_id":75922149,"body":"<p>I am getting error stating &quot;\nSome sections have errors, or aren't complete&quot; and I am not sure which section has error.</p>\n<p><a href=\"https://i.stack.imgur.com/1h0ae.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1h0ae.png\" alt=\"enter image description here\" /></a></p>\n<p>Any help will be appreciated. Thanks</p>\n"},{"tags":["java","apache-poi","apache-poi-4"],"comments":[{"owner":{"user_id":774183,"display_name":"carlspring"},"edited":false,"comment_id":133095099,"body":"I&#39;ve updated my question with these details."}],"answers":[{"owner":{"user_id":774183,"display_name":"carlspring"},"up_vote_count":1,"is_accepted":false,"creation_date":1676264889,"answer_id":75432066,"body":"<p>To my surprise the following works:</p>\n<pre><code>XSSFColor color = new XSSFColor(new byte[]{ (byte) 60,\n                                            (byte) 120,\n                                            (byte) 216 },\n                                new DefaultIndexedColorMap());\n\nCellStyle style = workBook.createCellStyle();\nstyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);\nstyle.setFillForegroundColor(color);\n\nXSSFCell cell = createCell(row, CellType.STRING, style, cellIndex);\n</code></pre>\n<p>Specifying a <code>new DefaultIndexedColorMap()</code> seems to solve it!</p>\n"},{"owner":{"user_id":13071509,"display_name":"AnotherOne"},"up_vote_count":0,"is_accepted":false,"creation_date":1676298459,"answer_id":75437175,"body":"<p>You can create Color class of Java awt to achieve this.</p>\n<pre><code> XSSFCellStyle cellStyle = this.createCellStyle(workbook);\n XSSFColor colorGrey = new XSSFColor(new Color(210, 210, 210));\n cellStyle.setFillForegroundColor(colorGrey);\n</code></pre>\n"}],"owner":{"user_id":774183,"display_name":"carlspring"},"view_count":96,"up_vote_count":4,"answer_count":2,"score":4,"creation_date":1676260691,"question_id":75431790,"body":"<p>I would like to set a custom color to a <code>CellStyle</code> in POI, but it doesn't seem to be getting applied.</p>\n<p>I have the following code:</p>\n<pre><code>    XSSFColor color = new XSSFColor(new byte[]{ (byte) 60,\n                                                (byte) 120,\n                                                (byte) 216 });\n    \n    CellStyle style = workBook.createCellStyle();\n    style.setFillPattern(FillPatternType.SOLID_FOREGROUND);\n    style.setFillForegroundColor(color);\n    \n    XSSFCell cell = createCell(row, CellType.STRING, style, cellIndex);\n</code></pre>\n<p>I have the following Gradle dependencies:</p>\n<pre><code>implementation(&quot;org.apache.poi:poi:5.2.3&quot;)\nimplementation(&quot;org.apache.poi:poi-ooxml:5.2.3&quot;)\n</code></pre>\n<p>If I use a different fille pattern and do something like this: <code>style.setFillPattern(FillPatternType.SOLID_FOREGROUND)</code>, the background gets set, but the fill pattern is, obviously, not solid.</p>\n<p>What's the correct way to do this?</p>\n"},{"tags":["java","maven","version","versioning","build-numbers"],"comments":[{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":133072421,"body":"A version number like that is typically a version control fingerprint; e.g. the first part of a git commit checksum.   So <code>2.0.0-SNAPSHOT-g57517b7</code> is likely to represent a prerelease (i.e. SNAPSHOT) build for 2.0.0 corresponding to commit <code>g57517b7</code>."}],"answers":[{"owner":{"user_id":2903319,"display_name":"Mutaev"},"up_vote_count":1,"is_accepted":false,"creation_date":1676088372,"answer_id":75418038,"body":"<p>The last part of the version name looks like a current git commit id.\nHave a look here <a href=\"https://stackoverflow.com/questions/40446275/include-git-commit-hash-in-jar-version\">Include git commit hash in jar version</a></p>\n"}],"owner":{"user_id":13186253,"display_name":"Ey&#252;p YÄ±ldÄ±z"},"view_count":57,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1676087067,"question_id":75417979,"body":"<p>I'm trying to learn more about how big project builds are being versioned by developer teams using maven. For example, some projects have versions like: 2.0.0-SNAPSHOT-g57517b7, what that &quot;g57517b7&quot; represents exactly? and is it possible to automate versioning process that increments those number or some kind of build number on maven?</p>\n"},{"tags":["java","spring-boot","hibernate","spring-data-jpa","hibernate-criteria"],"comments":[{"owner":{"user_id":412446,"display_name":"Christian Beikov"},"edited":false,"comment_id":132975279,"body":"Let&#39;s continue that discussion on Zulip: <a href=\"https://hibernate.zulipchat.com/#narrow/stream/132094-hibernate-orm-dev/topic/Illegal.20pop.28.29.20error\" rel=\"nofollow noreferrer\">hibernate.zulipchat.com/#narrow/stream/132094-hibernate-orm-&zwnj;&#8203;dev/&hellip;</a>"}],"answers":[{"owner":{"user_id":21186254,"display_name":"Bartek"},"up_vote_count":0,"is_accepted":false,"creation_date":1676022581,"answer_id":75409349,"body":"<p>We stumbled upon the same problem in our project where we were passing entity with OneToMany and ManyToOne relations with lazy loading to a method returning CompletableFuture. As a workaround we prepared DTO used for further operations outside of the method, passed it instead of the entity object and it worked like a charm</p>\n"},{"owner":{"user_id":1534698,"display_name":"Jan"},"up_vote_count":0,"is_accepted":false,"creation_date":1679568275,"answer_id":75822010,"body":"<p>In my system Spring Boot and Hibernate manage the database. To still get access to the entity manager I have to use</p>\n<pre><code>@PersistenceContext(type = PersistenceContextType.TRANSACTION)\nprivate final EntityManager entityManager;\n</code></pre>\n<p>The important part here is <code>PersistenceContextType.TRANSACTION</code>, when I used <code>PersistenceContextType.EXTENDED</code> I got that error. Especially in connection with other transactions.</p>\n<p>So I added <code>@Transactional(propagation = Propagation.REQUIRES_NEW)</code> to my methods to be safe.</p>\n<p>Now I'm completely error free.</p>\n"},{"owner":{"user_id":9959059,"display_name":"user9959059"},"up_vote_count":1,"is_accepted":false,"creation_date":1680958626,"answer_id":75965338,"body":"<p>For everyone who has this problem and uses Quarkus 3 with <a href=\"https://quarkus.io/guides/vertx-reference\" rel=\"nofollow noreferrer\">Vertx bare Api</a>.</p>\n<p>I fix this error by forcing the JDBC Call to the <a href=\"https://vertx.io/docs/vertx-core/java/#event_bus\" rel=\"nofollow noreferrer\">Vertx Eventbus</a> thread by wrapping it in a EvenBus Consuming function as described in the <a href=\"https://quarkus.io/guides/vertx-reference#configuring-the-address\" rel=\"nofollow noreferrer\">official documentation</a>, and fiddeling around with <a href=\"https://github.com/quarkusio/quarkus/wiki/Migration-Guide-3.0#sessions-and-transactions\" rel=\"nofollow noreferrer\">@WithTransaction, @WithSession, @WithSessionOnDemand or Panache.withTransaction{}</a>.</p>\n<p>This results in code which i'm shure gives me cancer in the long run, as the revenge of karma and the coding gods. <em>But hey , it's temporary code as i migrate my vertx code to mainly quarkus with sparkles of vertx.</em></p>\n<pre class=\"lang-kt prettyprint-override\"><code>\n    fun createToken(userId: String): Future&lt;String&gt; {\n        val promise = Promise.promise&lt;String&gt;()\n        eventBus.request&lt;String&gt;(&quot;createTokenMsg&quot;, userId)\n            .onSuccess { msg -&gt; promise.complete(msg.body()) }\n            .onFailure(promise::fail)\n        return promise.future()\n    }\n\n    @ConsumeEvent(&quot;createTokenMsg&quot;)\n    fun createTokenMsgConsume(msg: Message&lt;String&gt;) {\n        val userId = msg.body()\n\n        createToken(userId).subscribe().with(\n            { msg.reply(it.token) },\n            { error: Throwable -&gt;\n                val txt = &quot;Fail to create token for user id $userId&quot;\n                logger.log(Level.SEVERE, txt, error)\n                msg.fail(500, txt)\n            }\n        )\n    }\n\n    @WithSession\n    fun createToken(userId: String): Uni&lt;TokenIdEntity&gt; {\n        return Panache\n            .withTransaction { repository.findByUserId(userId) }\n            .chain { found: TokenIdEntity? -&gt;\n            val token = found ?: TokenIdEntity(userId = userId)\n            token.regenrateToken()\n\n            Panache.withTransaction { repository.persistAndFlush(token) }\n        }\n    }\n</code></pre>\n<p>You can use it with Objects to , you hate to use the JsonObject</p>\n<p><strong>Not an ideal solution because:</strong></p>\n<ul>\n<li>You misuse the eventbus for something which should be a function call (which introduce a lot of overhead)</li>\n<li>If your code runs in a vertx cluster , it may be consumed by another instance</li>\n<li>You loose your stacktrace at this point, you can log the .onFailure method of the eventbus.request-Future but the trace is lost at this point. (which sucks big time for debugging)</li>\n</ul>\n<p><strong>Disclaimer</strong></p>\n<p>I am not a very experienced user of Hibernate-Reactive , Panache and Quarkus so maybe this solution is shooting a sparrow with a shotgun , where you miss all of your 7 rounds and the bird dies of old age, but it works for me at a point where the other answers , were not descriptiv enough or does not work.</p>\n<p>The @Transactional solution does not work for me because quarkus takes an issue to call JTA transactions from an io Thread</p>\n<pre><code>io.quarkus.runtime.BlockingOperationNotAllowedException: Cannot start a JTA transaction from the IO thread.\n</code></pre>\n<p>But i'm corious about better solutions and hope that my solution maybe leads in a direction for a better solution.</p>\n"}],"owner":{"user_id":3206292,"display_name":"Jana"},"view_count":952,"up_vote_count":5,"answer_count":3,"score":4,"creation_date":1675515370,"question_id":75345248,"body":"<p>Getting Below error , while calling JPA method, frequently in Hibernate 6</p>\n<p>org.springframework.dao.InvalidDataAccessApiUsageException: Illegal pop() with non-matching JdbcValuesSourceProcessingState\nat org.springframework.orm.jpa.EntityManagerFactoryUtils.convertJpaAccessExceptionIfPossible(EntityManagerFactoryUtils.java:368)</p>\n"},{"tags":["java","keycode"],"comments":[{"owner":{"user_id":13963086,"display_name":"k314159"},"edited":false,"comment_id":132977999,"body":"I don&#39;t understand your question. Are you talking about the letter D or the letter P? If it&#39;s P, then where do you get this &quot;25&quot; from? It&#39;s 0x50, both in Java and Microsoft."},{"owner":{"user_id":843943,"display_name":"Grim"},"edited":false,"comment_id":132978278,"body":"@k314159 25 was a wild guess. I was supprised that 25 gives the charater P. I talk about P. I had a typo in the question, I hope the confusion is gone."},{"owner":{"user_id":838992,"display_name":"J Richard Snape"},"edited":false,"comment_id":132978469,"body":"Keyboard scan codes are not ascii - they are dependent on keyboard layouts.  Is the fundamental question - &quot;how do I know the scan codes for characters on my keyboard?&quot; or something similar?  See e.g. <a href=\"https://en.wikipedia.org/wiki/Scancode\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Scancode</a>.  Note - it gets a bit complex, you have to send one for key down, one for key up etc.  What are you trying to send longer term?"},{"owner":{"user_id":838992,"display_name":"J Richard Snape"},"edited":false,"comment_id":132978576,"body":"Look at Appendix C in this doc for the mappings for USB keyboards: <a href=\"https://download.microsoft.com/download/1/6/1/161ba512-40e2-4cc9-843a-923143f3456c/scancode.doc\" rel=\"nofollow noreferrer\">download.microsoft.com/download/1/6/1/&hellip;</a>  .  You can see that key P is in position 26, if the scan codes are 0-indexed instead of 1-indexed like the table, then P would be 25.  If this is what you&#39;re after, I can write it up into a proper answer."},{"owner":{"user_id":843943,"display_name":"Grim"},"edited":false,"comment_id":132979320,"body":"I thought about scancodes too, but since P is 25, not 26 I neglect this idea. Are you guys sure there is not a different approach? I can not imagine that oracle mixed up 0-indexed and 1-indexed."},{"owner":{"user_id":21063779,"display_name":"Lae"},"edited":false,"comment_id":133073372,"body":"Yeah it is scancodes, I built the same thing to control VirtualBox VM a few years ago in Rust, see my scancode table at the time: <a href=\"https://github.com/laech/arch-zfs-iso/blob/fa1ca01a3c5be532d386ac5dcba9dcbf5088b68f/test/src/scancode.rs#L55-L103\" rel=\"nofollow noreferrer\">github.com/laech/arch-zfs-iso/blob/&hellip;</a> and how I was translating strings to scancodes: <a href=\"https://github.com/laech/arch-zfs-iso/blob/fa1ca01a3c5be532d386ac5dcba9dcbf5088b68f/test/src/vm.rs#L118-L129\" rel=\"nofollow noreferrer\">github.com/laech/arch-zfs-iso/blob/&hellip;</a>"}],"answers":[{"owner":{"user_id":838992,"display_name":"J Richard Snape"},"up_vote_count":0,"is_accepted":false,"creation_date":1675695205,"answer_id":75362908,"body":"<p>Scan codes are keyboard layout dependent mappings to key layouts.  You can send codes based on the scan codes for a USB keyboard, which all modern systems are likely to understand.  The codes are documented in Appendix C of the Microsoft document &quot;Keyboard Scan Code Specification&quot;.  You will see there that character <code>P</code> is in position 26 in the 1-indexed table of key location.  This would explain a 0-indexed code of 25 producing the character <code>P</code>.</p>\n<p>You will see that &quot;key down&quot; needs you to send 25 as the scan code (0x19) and then 0x99 for key up.  This is what your (25 | 0x80) is doing.  So your code at the moment sends a message meaning &quot;Key P has been pressed (make in the table)&quot; followed by &quot;Key P has been released (break in the table)&quot;</p>\n<p>The direct link to the doc I'm referencing here is: <a href=\"https://download.microsoft.com/download/1/6/1/161ba512-40e2-4cc9-843a-923143f3456c/scancode.doc\" rel=\"nofollow noreferrer\">https://download.microsoft.com/download/1/6/1/161ba512-40e2-4cc9-843a-923143f3456c/scancode.doc</a></p>\n<p><strong>N.B.</strong> These codes are quite different to ASCII codes, which are where you are getting the 0x50 from.</p>\n<h3>Sending strings via the keyboard</h3>\n<p>If you want to send a whole string via the keyboard this way, what you will need is a mapping table from ASCII codes for each character to key make and key break codes.  You can then take the string character by character and work out which scan code pairs to send for each character. Note - you'll need to deal with case by adding a &quot;Shift down&quot; before the pair and &quot;Shift up&quot; afterwards.  This is do-able with a fairly long mapping table, I'd use a <code>WeakHashMap</code></p>\n"},{"owner":{"user_id":964243,"display_name":"Boann"},"up_vote_count":1,"is_accepted":false,"creation_date":1675695211,"answer_id":75362909,"body":"<p>Virtual key codes and keyboard scan codes are two different things.</p>\n<p>Keyboards (still) talk to PCs using a really dusty old protocol. Many years ago I implemented a toy version of the protocol in an OS driver and it was quite annoying. Making it worse, keyboards can use 3 different sets of keyboard scancodes which originated with different flavors of old PCs.</p>\n<p>Here is a reference for the 3 sets: <a href=\"https://www.vetra.com/scancodes.html\" rel=\"nofollow noreferrer\">https://www.vetra.com/scancodes.html</a></p>\n<p>The constants you discovered line up with Set 1. Note that Set 1 has different codes used to press the key and release the key!</p>\n<p>The virtual key constants used by the Java KeyEvent class and by that Windows list both seem to be based closely on ASCII characters, since 'P' = 0x50 in ASCII. But it's the job of the operating system keyboard driver to translate from keyboard scancodes to more logical sets of constants. There is no universal constant for a key.</p>\n<p>Since VirtualBox is emulating the physical keyboard interface to the guest OS, its <code>IKeyboard</code> API takes raw scancodes.</p>\n<p>For the VirtualBox GUI, it must have a function which translates from host OS key constants back to scancodes for the guest OS, which might be easier if you can use that, but <code>IKeyboard</code> appears to be a very low-level interface which bypasses that.</p>\n<p>Depending on your use case, perhaps there is a different API you can also use here; or perhaps you can control your VM with guest software like SSH or VNC.</p>\n"}],"owner":{"user_id":843943,"display_name":"Grim"},"view_count":102,"up_vote_count":4,"answer_count":2,"score":4,"creation_date":1675512722,"question_id":75345000,"body":"<p>How to send a string to a virtualbox-guest-machine?</p>\n<p>This is my code:</p>\n<pre><code>public void testKeyboard() throws Exception {\n    IVirtualBox b = connect();\n    List&lt;IMachine&gt; machines = b.getMachines();\n    for (IMachine m : machines) {\n        MachineState d = b.getMachineStates(Arrays.asList(m)).iterator().next();\n        if (d == MachineState.Running) {\n            ISession s = manager.getSessionObject();\n            m.lockMachine(s, LockType.Shared);\n            IConsole console = s.getConsole();\n            IKeyboard k = console.getKeyboard();\n            k.putScancodes(Arrays.asList(25, 25 | 0x80)); // &lt;- sends the character P\n            s.unlockMachine();\n        }\n    }\n}\n</code></pre>\n<p><a href=\"https://learn.microsoft.com/de-de/windows/win32/inputdev/virtual-key-codes\" rel=\"nofollow noreferrer\">Microsoft say its 0x50</a></p>\n<p>java.awt.event.KeyEvent also say its 0x50:</p>\n<pre><code>/** Constant for the &quot;P&quot; key. */\n public static final int VK_P = 0x50; \n</code></pre>\n<p>In virtualbox its different.\nP=25\n2=0x50\nb=0x30</p>\n<p>Why in the world is the code of P = 25 in virtualbox?</p>\n"},{"tags":["java","apache-spark","apache-spark-sql"],"answers":[{"owner":{"user_id":6325994,"display_name":"Abdennacer Lachiheb"},"up_vote_count":1,"is_accepted":true,"creation_date":1673513263,"answer_id":75093615,"body":"<p>You can use map function to update a custom object, then .set() the desired value:</p>\n<pre><code>    Encoder&lt;Person&gt; personEncoder = Encoders.bean(Person.class);\n    List&lt;Person&gt; personList = Arrays.asList(\n            new Person(&quot;John&quot;, &quot;Doe&quot;, 25),\n            new Person(&quot;Jane&quot;, &quot;Doe&quot;, 30)\n    );\n    Dataset&lt;Person&gt; personListDs = session.createDataset(personList, personEncoder);\n\n    personListDs.show();\n    Dataset&lt;Person&gt; updatedPersonListDs = personListDs.map((MapFunction&lt;Person, Person&gt;) person -&gt; {\n        person.setAge(12);\n        return person;\n    }, personEncoder);\n\n    updatedPersonListDs.show();\n</code></pre>\n<p><strong>Very important</strong>, the Person class should have no args constructor:</p>\n<pre><code>public class Person implements Serializable {\n    private String name;\n    private String gender;\n    private int age;\n\n    public Person() {\n    }\n\n    public Person(String name, String gender, int age) {\n        this.name = name;\n        this.gender = gender;\n        this.age = age;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public String getGender() {\n        return gender;\n    }\n\n    public void setGender(String gender) {\n        this.gender = gender;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n}\n</code></pre>\n<p><strong>UPDATE:</strong></p>\n<p>If you want the age value as a variable you can just created before the .map and called it inside .map</p>\n<pre><code>final int age = 12;\nDataset&lt;Person&gt; updatedPersonListDs = personListDs.map((MapFunction&lt;Person, Person&gt;) person -&gt; {\n    person.setAge(age);\n    return person;\n}, personEncoder);\n</code></pre>\n<p>If you don't want the variable to be final, you can use a braodcast variable:</p>\n<pre><code>int age = 12;\nBroadcast&lt;Integer&gt; broadcastAge = new JavaSparkContext(session.sparkContext()).broadcast(age);\n\nDataset&lt;Person&gt; updatedPersonListDs = personListDs.map((MapFunction&lt;Person, Person&gt;) person -&gt; {\n    person.setAge(broadcastAge.value());\n    return person;\n}, personEncoder);\n</code></pre>\n"},{"owner":{"user_id":19390106,"display_name":"Imran"},"up_vote_count":0,"is_accepted":false,"creation_date":1673516957,"answer_id":75094361,"body":"<p>Either import object like you do know and use it to access method:</p>\n<pre><code>    import org.apache.spark.sql.functions;\n\n    df.withColumn(&quot;foo&quot;, functions.lit(1));\n</code></pre>\n<p>or use import static and call method directly:</p>\n<pre><code>import static org.apache.spark.sql.functions.lit;\n\ndf.withColumn(&quot;foo&quot;, lit(1));\n</code></pre>\n"}],"owner":{"user_id":3680045,"display_name":"OPK"},"view_count":86,"up_vote_count":4,"accepted_answer_id":75093615,"answer_count":2,"score":4,"creation_date":1673498962,"question_id":75091725,"body":"<p>Assuming I have a <code>Dataset&lt;Person&gt; personList</code>, that contains list of <code>Person</code>.</p>\n<p><code>Person</code> is defined as follows:</p>\n<pre><code>public class Person {\n    String name;\n    String gender;\n}\n</code></pre>\n<p>Now I have the list <code>personList</code> as dataset, but I need to backfill another attribute into <code>Person</code>, let's say it's <code>age</code>. So I can update my <code>Person</code> to</p>\n<pre><code>public class Person {\n    String name;\n    String gender;\n    int age;\n}\n</code></pre>\n<p>How do I loop through the Dataset and upate the age value?</p>\n<p>I tried this approach, but it didn't update anything:</p>\n<pre><code>    personList.foreach(person -&gt; {\n        person.setAge(12);\n    });\n</code></pre>\n<p>I tried to give every <code>Person</code> in the <code>personList</code> age of 12, but when I read the data set, the <code>age</code> value is still empty.</p>\n<p>Why?</p>\n"},{"tags":["java","docker","heroku","micronaut"],"comments":[{"owner":{"user_id":6580775,"display_name":"kaiffeetasse"},"edited":false,"comment_id":132470358,"body":"can you check the logs with <code>heroku logs</code>?"},{"owner":{"user_id":6480751,"display_name":"Kilbo"},"edited":false,"comment_id":132481351,"body":"I checked heroku logs and they are empty except for a &quot;process started&quot; and &quot;process crashed&quot; almost immediately after"}],"answers":[{"owner":{"user_id":6480751,"display_name":"Kilbo"},"up_vote_count":1,"is_accepted":true,"creation_date":1673928350,"answer_id":75141907,"body":"<p>Well, it isn't much of an answer. And nothing in the Heroku docs points me to why this works but removing <code>ENTRYPOINT exec java -XX:+UseContainerSupport -XX:MaxRAMPercentage=80.0 -noverify -XX:+AlwaysPreTouch -jar myjar.jar</code> from my Dockerfile works. With entrypoint removed I see logs again and can see my micronaut server starting. With <code>ENTRYPOINT</code> defined in my Dockerfile I just get what I posted about above &quot;Process starting&quot; followed immediately by process crashed</p>\n"}],"owner":{"user_id":6480751,"display_name":"Kilbo"},"view_count":87,"up_vote_count":4,"accepted_answer_id":75141907,"answer_count":1,"score":4,"creation_date":1673330268,"question_id":75066008,"body":"<p>I have a simple Micronaut server I am trying to launch on Heroku by building it with a heroku.yml but for some reason when I check the logs the process exits as soon as it starts. The docker image runs just fine locally and nothing else prints out in the logs so I can't find out why.</p>\n<p>Here is my Dockerfile</p>\n<pre><code>FROM node as build-frontend\nWORKDIR /app\nCOPY frontend/myfrontend/package.json .\nCOPY frontend/myfrontend/public ./public\nCOPY frontend/myfrontend/src ./src\nRUN npm install .\nRUN npm run build\n\nFROM gradle:6.8.2-jre11 AS build-env\n# Set the working directory to /home\nWORKDIR /home\nCOPY --chown=gradle:gradle backend ./\nCOPY --from=build-frontend /app/build /home/src/main/resources/public\n# Compile the application.\nRUN ./gradlew assemble\n\nFROM openjdk:11.0.10-jre-slim-buster\n# Set the working directory to /home\nWORKDIR /home\n# Copy the compiled files over.\nCOPY --from=build-env /home/build/libs/myjar-0.1-all.jar /home/myjar.jar\n\n# Starts the java app\n# Using EntryPoing to pass env. variables as describe in this article\nENTRYPOINT exec java -XX:+UseContainerSupport -XX:MaxRAMPercentage=80.0 -noverify -XX:+AlwaysPreTouch -jar myjar.jar\n</code></pre>\n<p>Here is my heroku.yml</p>\n<pre><code>setup:\n  addons:\n    - plan: heroku-postgresql\n      as: DATABASE\nbuild:\n  docker:\n    web: Dockerfile\nrun:\n  web: &quot;exec java -XX:+UseContainerSupport -XX:MaxRAMPercentage=80.0 -noverify -XX:+AlwaysPreTouch -jar myjar.jar&quot;\n</code></pre>\n<p>and finally my Micronaut application.yml which just sets some configs</p>\n<pre><code>micronaut:\n  application:\n    name: mypackage\n  router:\n    static-resources:\n      default:\n        enabled: true\n        paths:\n        - classpath:public\n        mapping: /**\n  server:\n    port: ${PORT:8080}\n    cors:\n      enabled: true\n\ndatasources:\n  default:\n    driverClassName: org.postgresql.Driver\n    dbUrl: jdbc:postgresql://mydbhost.com:port/dbname?sslmode=require\n    dbUsername: dbuser\n    dbPassword: dbpasswd\n\n  scan:\n    packages: mypackage\n\nnetty:\n  default:\n    allocator:\n      max-order: 3\n</code></pre>\n<p>When I just do <code>docker build -t test-image:latest .</code> and <code>docker run -p 80:8080 test-image:latest</code> I can connect just fine on localhost and the docker container runs the micronaut server. If it fails for some reason I see an output in the container logs detailing why. When I upload this to heroku (through a github deployment) All i see in the logs are</p>\n<pre><code>2023-01-09T22:25:50.145942+00:00 heroku[web.1]: Starting process with command `/bin/sh -c exec\\ java\\ -XX:\\+UseContainerSupport\\ -XX:MaxRAMPercentage\\=80.0\\ -noverify\\ -XX:\\+AlwaysPreTouch\\ -jar\\ myjar.jar`\n2023-01-09T22:25:51.381760+00:00 heroku[web.1]: Process exited with status 0\n2023-01-09T22:25:51.439962+00:00 heroku[web.1]: State changed from starting to crashed\n</code></pre>\n<p>I have tried:\nTo run it locally connected to the heroku addon postgres database, works just fine\nSimplifying the build as much as possible\nRemoving the default on the port (to ensure it picks up $PORT), and running it locally with export PORT=8080 set (works just fine, docker container picks up the env port like we expect in heroku)</p>\n<p>And I cannot figure out why it just quits immediately on Heroku. editted: originally thought it had to do with the port value but but I figured out how to give micronaut a port through the command line and it still doesn't work on Heroku (works locally)</p>\n<p>edit:\nI tried changing my application.yml to this with the DB hardcoded and still nothing. Just does not seem to work. App still crashes and there is nothing to indicate why in the logs</p>\n<pre><code>setup:\n  config:\n    PORT: $PORT\n    MICRONAUT_SERVER_PORT: $PORT\nbuild:\n  docker:\n    web: Dockerfile\nrun:\n  web: &quot;exec java -Dmicronaut.server.port=$PORT -XX:+UseContainerSupport -XX:MaxRAMPercentage=80.0 -noverify -XX:+AlwaysPreTouch -jar myjar.jar&quot;\n</code></pre>\n<p>I still have no extra output from Heroku. No stacktrace or stderr or stdout at all.</p>\n"},{"tags":["java","spring","spring-boot","google-sheets-api","spring-cache"],"comments":[{"owner":{"user_id":6700091,"display_name":"Kamil BÄ™ben"},"edited":false,"comment_id":132443017,"body":"Are you injecting GoogleSheetsService or manually constructing it? Because since caching is taken care of by spring using aspects, the service needs to be injected (using either constructor injection or Autowired annotation) for it to work."}],"answers":[{"owner":{"user_id":3761976,"display_name":"jojoldu"},"up_vote_count":1,"is_accepted":true,"creation_date":1673101089,"answer_id":75041008,"body":"<p>I can doubt two things.</p>\n<ol>\n<li>Are other methods of Google Sheets Service calling the spreadsheet method?</li>\n</ol>\n<p><code>@Cacheable</code> uses the AOP concept of Spring Framework.\nSo it doesn't apply to calling other methods in the same class.</p>\n<ol start=\"2\">\n<li>Have you registered the spreadsheet with CacheManager?</li>\n</ol>\n<p>With Java Config, it is as follows,</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\n@EnableCaching\npublic class CacheConfig {\n\n  @Bean\n  public CacheManager cacheManager() {\n    ConcurrentMapCacheManager mgr = new ConcurrentMapCacheManager();\n    mgr.setCacheNames(asList(&quot;employees&quot;));\n    return mgr;\n  }\n}\n</code></pre>\n<p><a href=\"https://howtodoinjava.com/spring-boot/spring-boot-cache-example/\" rel=\"nofollow noreferrer\">link</a></p>\n<p>Is the spreadsheet registered with cacheManager?</p>\n"}],"owner":{"user_id":19721062,"display_name":"Dennis Wong"},"view_count":70,"up_vote_count":4,"accepted_answer_id":75041008,"answer_count":1,"score":4,"creation_date":1673070284,"question_id":75038356,"body":"<p>I am just starting to learn Spring Boot and am trying to use cache with the Google Sheets API to study Springboot. To use cache with Google Sheets in Spring Boot, I added the spring-boot-starter-cache dependency in my pom.xml file and enabled cache support by using the @EnableCaching annotation in my application's main class. I then used the @Cacheable annotation for caching the response from the Google Sheets API when calling a method to get a spreadsheet. However, the cache does not work, as the method is still being called every time.</p>\n<p>Here is an example of the code I am using:</p>\n<pre><code>import org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.cache.annotation.Cacheable;\nimport org.springframework.stereotype.Service;\n\n@Service\npublic class GoogleSheetsService {\n\n    private static final Logger logger = LoggerFactory.getLogger(GoogleSheetsService.class);\n\n    @Cacheable(value = &quot;spreadsheet&quot;, key = &quot;#spreadsheetId&quot;)\n    public Spreadsheet getSpreadsheet(String spreadsheetId) {\n        logger.info(&quot;Getting spreadsheet from API for {}&quot;, spreadsheetId);\n        // Call Google Sheets API to get spreadsheet\n        return spreadsheet;\n    }\n}\n\n</code></pre>\n<p>I expected the cache to return the cached value for the same spreadsheetId, but the method is being called every time and the &quot;Getting spreadsheet from API for {}&quot; log is being printed. Can you please help me understand what might be causing the cache to not work as expected?</p>\n"},{"tags":["java","docker","intellij-idea","spring-security","h2"],"comments":[{"owner":{"user_id":5277820,"display_name":"dur"},"edited":false,"comment_id":134272854,"body":"<i>However, my project has an h2 database that opens its console at the start of the project in the browser.</i> How do you open a browser in your Docker container? What kind of docker container do you use? Anyway, Spring Boot doesn&#39;t open a browser by default. You have to do it by yourself (manual or coding)."},{"owner":{"user_id":5277820,"display_name":"dur"},"edited":false,"comment_id":134272875,"body":"<i>Browser detection failed, and java property &#39;h2.browser&#39; and environment variable BROWSER are not set to a browser executable.</i> This error is clear, your app cannot open a browser. So you have to change your code, to not open any browser."},{"owner":{"user_id":15397886,"display_name":"Ð¡ÐµÑ€Ð³ÐµÐ¹"},"edited":false,"comment_id":134304745,"body":"How do you open a browser in your Docker container? The H2 database tries to open it. _ What kind of docker container do you use? I am creating a Docker Container from this image.  FROM openjdk:11 MAINTAINER Sergey Zavyalov COPY out/artifacts/KameleoonTestTask_jar/KameleoonTestTask.jar /app/KameleoonTestTask.jar WORKDIR /app EXPOSE 3000 ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app/KameleoonTestTask.jar&quot;]"},{"owner":{"user_id":15397886,"display_name":"Ð¡ÐµÑ€Ð³ÐµÐ¹"},"edited":false,"comment_id":134304858,"body":"What kind of docker container do you use? part2 _ Then I create an image docker build -t sergzv/kameleoon:v0.0.1 . _ Then I create a container docker run --rm --name testtask sergzv/kameleoon:v0.0.1"},{"owner":{"user_id":15397886,"display_name":"Ð¡ÐµÑ€Ð³ÐµÐ¹"},"edited":false,"comment_id":134304911,"body":"What kind of docker container do you use? Anyway, Spring Boot doesn&#39;t open a browser by default. You have to do it by yourself. Yes, I read about it. And this is the strangest thing. Therefore, I am now trying to create a new project and see if there will be this error in it. I repeat, with a simple launch of the project, there is no console. It only occurs when I create artifacts and run it in the terminal via the java -jar command out/artifacts/KameleoonTestTask_jar/KameleoonTestTask.jar . Is it possible that this is the case?"},{"owner":{"user_id":15397886,"display_name":"Ð¡ÐµÑ€Ð³ÐµÐ¹"},"edited":false,"comment_id":134304941,"body":"This error is clear, your app cannot open a browser. So you have to change your code, to not open any browser.  Yes, this is the way I decided to go. Actually, that was my question. How to disable the console, which should already be disabled by default so that it does not launch the browser when the application starts. In addition, I read that the console is needed only for tests and in ready-made applications it should be disabled."},{"owner":{"user_id":12567365,"display_name":"andrewJames"},"edited":false,"comment_id":134306544,"body":"The only way I know how to get the web console to pop up is if I explicitly start the H2 DB server - for example, using <code>java -cp h2-2.1.214.jar org.h2.tools.Server -baseDir .</code> (and there are other equivalent ways, also). When I do that, I see a <code>Web Console server running at ...</code> message. On the other hand, if I only have a web app running with a JDBC connection, I never see the console (including when running on the command line)."},{"owner":{"user_id":12567365,"display_name":"andrewJames"},"edited":false,"comment_id":134306552,"body":"You are using an in-memory H2 instance - so is it safe to assume you do not have any code in your Spring Boot app doing anything like this: <code>Server server = Server.createTcpServer(args).start();</code>? Or any other place where there is an explicit command to start the H2 in server mode?"},{"owner":{"user_id":15397886,"display_name":"Ð¡ÐµÑ€Ð³ÐµÐ¹"},"edited":false,"comment_id":134322379,"body":"Everything is right. I don&#39;t explicitly call the h2 database start anywhere. Except in application.properties (the settings of which I described in the main question), when connecting dependencies in pom.xml I don&#39;t call it anywhere. I don&#39;t know if it&#39;s possible to give a link to the full project here and whether anyone will dig into it, but just in case here <a href=\"https://github.com/SERGZV/KameleoonTestTask\" rel=\"nofollow noreferrer\">github.com/SERGZV/KameleoonTestTask</a> ."}],"answers":[{"owner":{"user_id":15397886,"display_name":"Ð¡ÐµÑ€Ð³ÐµÐ¹"},"up_vote_count":0,"is_accepted":false,"creation_date":1684171316,"answer_id":76256511,"body":"<p>The problem has been solved. What have I done for this:</p>\n<ol>\n<li><p>I installed the latest 30-day trial version of Idea Ultimate</p>\n</li>\n<li><p>In pom.xml I removed all the plugins that were there and added this one:</p>\n<p>&lt;plugin&gt;<br />\norg.springframework.boot<br />\nspring-boot-maven-plugin<br />\n&lt;/plugin&gt;</p>\n</li>\n<li><p>This time I did not build the JAR artifact using Idea (File &gt; Project Structure &gt; + JAR from modules with dependencies).\nNow I produced it with Maven (Go to &quot;Toolbar&quot; from the right with the name Maven &gt; &quot;name of your project&quot; &gt; Lifecycle &gt; package)</p>\n</li>\n<li><p>Now the artifact is in the target folder and when I run it using &quot;java -jar...&quot; the login window to the h2database console no longer opens in the browser</p>\n</li>\n<li><p>Of course, in order for Docker container to use a new artifact, I changed the path in the Makefile and re-created the image and the container based on the new JAR file.</p>\n</li>\n</ol>\n<p>Now, during the launch of the Docker file or the jar artifact itself, the H2 console window does not pop up in the browser.</p>\n"}],"owner":{"user_id":15397886,"display_name":"Ð¡ÐµÑ€Ð³ÐµÐ¹"},"view_count":57,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1682618527,"question_id":76123402,"body":"<p>I want to put my program in a Docker container. However, my project has an h2 database that opens its console at the start of the project in the browser. As a result, an error appears when starting the container:\n<strong>Failed to start a browser to open the URL <a href=\"http://172.17.0.2:8082?key=9cfa612432aa32f89b955f102b129e4b8123dcec3f9841e74c6bd5e319f3a3a5\" rel=\"nofollow noreferrer\">http://172.17.0.2:8082?key=9cfa612432aa32f89b955f102b129e4b8123dcec3f9841e74c6bd5e319f3a3a5</a>: Browser detection failed, and java property<br />\n'h2.browser' and environment variable BROWSER are not set to a browser executable.</strong></p>\n<p>As a result, it was decided to go the easy way and disable the h2 console, since I still don't use it yet. Following the advice of chat-gpt-3, I tried to disable it using the <strong>application.properties</strong> file :</p>\n<pre><code>spring.datasource.url=jdbc:h2:mem:default\nspring.datasource.username=sa\nspring.datasource.password=\nspring.datasource.DriverClassName=org.h2.Driver\nspring.h2.console.enabled=false\nspring.h2.console.path=/myh2console\n</code></pre>\n<p>I created a jar artifact and launched it using the command: <strong>java -jar out/artifacts/KameleoonTestTask_jar/KameleoonTestTask.jar</strong></p>\n<p>But it did not bring the desired result. As soon as I launch the artifact, a new tab opens in the browser with the h2 database window and prompts me to enter a name and password, and the h2 database console icon appears at the bottom of the tray.</p>\n<p>Then following his other advice I tried disabling the console by denying the console access to the browser using SpringSecurity:</p>\n<pre><code>package project.config;\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.Enable Web Security;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfig extends WebSecurityConfigurerAdapter\n{\n    @Override\n    protected void configure(Http Security http) throws Exception\n    {\n        http.authorizerequest()\n        .antMatchers(&quot;/h2-console/*&quot;).denyAll()\n        .and().headers().frameOptions().disable();\n    }\n}\n</code></pre>\n<p>The console keeps popping up.</p>\n<p>It is also worth noting that the console does not appear during the normal launch of the application in Idea. It appears only when I run the artifact with the above command. I run the artifact manually to check how the program will behave inside the docker container.</p>\n<p>If anyone knows how to disable this console, please help.</p>\n"},{"tags":["java","volatile","concurrenthashmap"],"comments":[{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134382537,"body":"Why do you think that an acquireâ†’release relationship doesnâ€™t guaranty memory visibility?"},{"owner":{"user_id":1059372,"display_name":"Eugene"},"edited":false,"comment_id":134383269,"body":"&quot;Using only acquire and release semantics can&#39;t guarantee visibility&quot; - it does, but it&#39;s weaker then volatile. very good read <a href=\"https://stackoverflow.com/questions/46889610/sequential-consistency-volatile-explanation\">over here</a>"},{"owner":{"user_id":6941784,"display_name":"Oliver"},"edited":false,"comment_id":134387471,"body":"Maybe I didnâ€™t describe it accurately. When I say using only acquire and release semantics can&#39;t guarantee visibility, I mean that the thread that calls <code>getObjectVolatile</code> can&#39;t immediately see the update made by the thread that calls <code>putObjectRelease</code>.@Holger @Eugene"},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134390478,"body":"Depends on what you mean with â€œimmediatelyâ€. There are no timing guarantees at all. But opaque and stronger memory accesses all have the same visibility regarding the writes and reads of the same variable. When it comes to transitivity relations, acquire/release is as good as volatile; the discussion about locking is about the ordering of concurrent <code>computeâ€¦</code> operations, not about <code>get</code> calls."},{"owner":{"user_id":6941784,"display_name":"Oliver"},"edited":false,"comment_id":134391287,"body":"In <code>jdk.internal.misc.Unsafe</code> of JDK11, the author mentioned something about immediate visibility in the comment of the method <code>putObjectRelease</code>.    <code>Versions of {@link #putObjectVolatile(Object, long, Object)} that do not guarantee immediate visibility of the store to other threads. This method is generally only useful if the underlying field is a Java volatile (or if an array cell, one that is otherwise only accessed using volatile accesses). Corresponds to C11 atomic_store_explicit(..., memory_order_release).</code>"},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134392415,"body":"This comment originally belonged to <code>putOrderedObject</code> back then, when there were no acquire/release/opaque and not even a â€œgetOrderedObjectâ€, so the counterpart had to be a volatile read when the comment was written. I donâ€™t know why they decided to keep the comment dangling somewhere above the put methods (itâ€™s <i>not</i> a documentation comment for <code>putReferenceRelease</code>) and change the first sentence to plural while not changing the second. â€œotherwise only accessed using volatile accessesâ€ should have been updated to â€œotherwise only accessed using opaque or stronger accessesâ€."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134392577,"body":"On the other hand, itâ€™s neither an official API nor a javadoc comment that would appear anywhere. Since the official API (<code>VarHandle</code>) doesnâ€™t provide a documentation of these access mode either (and even the JMM doesnâ€™t cover them), the best you can get is <a href=\"https://gee.cs.oswego.edu/dl/html/j9mm.html\" rel=\"nofollow noreferrer\">this document</a>."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134392626,"body":"When you look at <a href=\"https://gee.cs.oswego.edu/dl/html/j9mm.html#summarysec\" rel=\"nofollow noreferrer\">the summary at the end</a> you find â€œâ€¢ Opaque mode â€¦ensures awareness of variables across threads â€¢ Release/Acquire mode additionally supportsâ€¦ â€¢ Volatile mode additionally supportsâ€¦â€ In short, opaque is enough for visibility (of a single variable) while the other modes provide additional guarantees regarding ordering, which is necessary to see compound objects in a consistent state or establish a <i>happens-before</i> relationship. It would be strange, if a release was not combinable with an acquire but required a volatile read"}],"owner":{"user_id":6941784,"display_name":"Oliver"},"view_count":125,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1682381034,"question_id":76096854,"body":"<p>In <code>ConcurrentHashMap</code> of JDK8, both of the methods <code>tabAt</code>and <code>setTabAt</code> need volatile semantics.</p>\n<pre class=\"lang-java prettyprint-override\"><code>static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) {\n    return (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);\n}\n\nstatic final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) {\n    U.putObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);\n}\n</code></pre>\n<p>The author commented that:</p>\n<blockquote>\n<p>Note that calls to setTabAt always occur within locked regions,  and\nso in principle require only release ordering, not full volatile\nsemantics, but are currently coded as volatile writes to be\nconservative.</p>\n</blockquote>\n<p>Then in <code>ConcurrentHashMap</code> of JDK11, both of the methods <code>tabAt</code> and <code>setTabAt</code> don't need volatile semantics and use acquire and release semantics instead.</p>\n<pre class=\"lang-java prettyprint-override\"><code>static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) {\n    return (Node&lt;K,V&gt;)U.getObjectAcquire(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);\n}\n\nstatic final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) {\n    U.putObjectRelease(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);\n}\n</code></pre>\n<p>The author commented that:</p>\n<blockquote>\n<p>Note that calls to setTabAt always occur within locked regions,  and\nso require only release ordering.</p>\n</blockquote>\n<p>As far as I know, the elements of the array <code>Node&lt;K,V&gt;[] tab</code> aren't <code>volatile</code>. Using only acquire and release semantics can't guarantee immediate visibility. The thread that gets elements can't  immediately see the update made by the thread that sets elements.</p>\n<p>Even if the calls to <code>setTabAt</code> always occur within locked regions, it seems that it doesn't make any difference. Because the calls to <code>tabAt</code> don't always occur within locked regions, there is no guarantee of happens-before relationship.</p>\n<p>The call to <code>tabAt</code> doesn't occur within a locked region in the method <code>get</code></p>\n<pre class=\"lang-java prettyprint-override\"><code>public V get(Object key) {\n    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek;\n    int h = spread(key.hashCode());\n    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;\n        (e = tabAt(tab, (n - 1) &amp; h)) != null) {\n        if ((eh = e.hash) == h) {\n            if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))\n                return e.val;\n        }\n        else if (eh &lt; 0)\n            return (p = e.find(h, key)) != null ? p.val : null;\n        while ((e = e.next) != null) {\n            if (e.hash == h &amp;&amp;\n                ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))))\n                return e.val;\n        }\n    }\n    return null;\n}\n</code></pre>\n<p>I wonder if there is something wrong with my understanding. Could anyone provide more information about this?</p>\n"},{"tags":["java","node.js"],"comments":[{"owner":{"user_id":10871900,"display_name":"dan1st"},"edited":false,"comment_id":134089632,"body":"What happens when printing <code>s</code>?"},{"owner":{"user_id":4412979,"display_name":"Vasily Liaskovsky"},"edited":false,"comment_id":134089682,"body":"Oh boy, Unicode is even stranger than you think"},{"owner":{"user_id":16462950,"display_name":"Heiko Thei&#223;en"},"edited":false,"comment_id":134089966,"body":"Does this answer your question? <a href=\"https://stackoverflow.com/questions/5903008/what-is-a-surrogate-pair-in-java\">What is a &quot;surrogate pair&quot; in Java?</a>"},{"owner":{"user_id":6657837,"display_name":"Turkhan Badalov"},"edited":false,"comment_id":134090048,"body":"Kind of TL;DR to Helko&#39;s link. String in Java represents text in UTF-16 format. Which uses 2 consecutive bytes if the Unicode code point value is higher than <code>FFFF</code> which is <code>1F60A</code> for the emoji in your case. This pair of consecutive bytes is known as surrogates (the leading being a higher-, the following being lower-surrogate). Finally, based on the docs of <code>String.charAt</code>, in case of a character encoded by surrogate pairs, the call returns a single surrogate each time. However, each surrogate doesn&#39;t represent any character. In fact, surrogate values are reserved and don&#39;t map to any symbol"},{"owner":{"user_id":6657837,"display_name":"Turkhan Badalov"},"edited":false,"comment_id":134090932,"body":"@user16320675, for me it is working normal with both characters you&#39;ve mentioned. Perhaps something to do with your default system encoding <code>env | grep LANG</code>? If it is different than <code>UTF-8</code>, reading in <code>UTF-8</code> can lead to corrupted results"},{"owner":{"user_id":20365983,"display_name":"f478ccf2"},"edited":false,"comment_id":134106752,"body":"@TurkhanBadalov I&#39;m on Windows"},{"owner":{"user_id":6657837,"display_name":"Turkhan Badalov"},"edited":false,"comment_id":134111226,"body":"@f478ccf2, I am sorry"}],"answers":[{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"up_vote_count":0,"is_accepted":false,"creation_date":1681671036,"answer_id":76029739,"body":"<p>In javascript strings are raw bytes (in the end, processes have 'standard in' and 'standard out' and they do'nt <em>have</em> to be a keyboard and screen, they can e.g. be files - and these stdin and stdout are defined as byte streams after all - hence, they aren't chars!) - and you read them in and emit them right back out. It'll work regardless of encoding setting.</p>\n<p>Whereas in the java code you are converting the bytes to strings and then back to bytes which is going to fail unless you have the right encoding.</p>\n<p>In addition, you're running into a nitpicky thing about <code>char</code> in java: It's not.. actually a unicode value. You want <code>.codepointAt(0)</code>, not <code>.charAt(0)</code>. <code>charAt</code> gives you the first of a surrogate pair (in java, <code>char</code> is only 16-bit large which is enough for almost all chars, but not for e.g. emojis).</p>\n"}],"owner":{"user_id":20365983,"display_name":"f478ccf2"},"view_count":71,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1681665662,"question_id":76029272,"body":"<p>I've noticed in Node.js, when reading stdin from the Windows Console (conhost.exe), when you input a UTF-8 character it reads it just fine, with any code page.</p>\n<p>I've been testing with an emoji (ðŸ˜Š), but you can try it with whatever you want.</p>\n<p>(both these programs were run in cmd.exe)\nExample code:</p>\n<pre class=\"lang-js prettyprint-override\"><code>process.stdin.on(&quot;readable&quot;, () =&gt; {\n    var input = process.stdin.read();\n    if (input !== null) {\n        console.log(input); // this will output the correct UTF-8 bytes, &lt;Buffer f0 9f 98 8a 0d 0a&gt;\n        process.exit();\n    }\n});\n</code></pre>\n<p>Now testing with Java</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.io.*;\nimport java.nio.charset.StandardCharsets;\n\npublic class Main {\n    public static void main(String[] args) throws IOException {\n        BufferedReader r = new BufferedReader(new InputStreamReader(System.in, StandardCharsets.UTF_8));\n        String s = r.readLine();\n        for (int i = 0; i &lt; s.length(); i++) {\n            char c = s.charAt(i);\n            System.out.println((int) c);\n        }\n    }\n}\n</code></pre>\n<p>With the default code page (437), it outputs (63, 63), while with 65001 (UTF-8), it outputs two null bytes (0, 0), which is even stranger.</p>\n<p>I thought the Windows console (conhost) didn't support Unicode, but Node can at least read the bytes intact (albeit not being able to display them as text). How can it do that, and is there a way I can get this behaviour in Java?</p>\n"},{"tags":["python","java","algorithm","jwt"],"comments":[{"owner":{"user_id":11002,"display_name":"tgdavies"},"edited":false,"comment_id":134075929,"body":"<code>secret = &#39;abcdefghijklmnopqrstuvwxyz&#39;;</code> isn&#39;t valid Java."},{"owner":{"user_id":7167572,"display_name":"Tatranskymedved"},"edited":false,"comment_id":134076143,"body":"There are some more details at this <a href=\"https://elc.github.io/python-security/chapters/10_JSON_Web_Tokens.html\" rel=\"nofollow noreferrer\">web about JSON web tokens in python</a>. However, my best shot would be that the encoding for those characters would be different in Python/Java, thus generating different results. I&#39;m not native to either language, so idk exactly how they behave."},{"owner":{"user_id":21354950,"display_name":"takaki"},"edited":false,"comment_id":134079212,"body":"Thank you for your answer, yes i see what you mean, i just wanted to express that the result is different when the key is the same."}],"answers":[{"owner":{"user_id":4166251,"display_name":"Stanimir Stamenkov"},"up_vote_count":0,"is_accepted":false,"creation_date":1681545558,"answer_id":76021020,"body":"<p>Reading the API docs:</p>\n<ul>\n<li><a href=\"https://pyjwt.readthedocs.io/en/stable/api.html?highlight=jwt#jwt.encode\" rel=\"nofollow noreferrer\"><code>jwt.encode(payload, key, algorithm=&quot;HS256&quot;, headers=None, json_encoder=None)</code></a> (Python)</li>\n<li><a href=\"https://javadoc.io/static/io.jsonwebtoken/jjwt-api/0.11.5/io/jsonwebtoken/JwtBuilder.html#signWith(io.jsonwebtoken.SignatureAlgorithm,%20java.lang.String)\" rel=\"nofollow noreferrer\"><code>JwtBuilder.signWith(SignatureAlgorithm alg, String base64EncodedSecretKey)</code></a> (Java)</li>\n</ul>\n<p>I'm speculating you need to be using:</p>\n<ul>\n<li><a href=\"https://javadoc.io/static/io.jsonwebtoken/jjwt-api/0.11.5/io/jsonwebtoken/JwtBuilder.html#signWith(io.jsonwebtoken.SignatureAlgorithm,%20byte%5B%5D)\" rel=\"nofollow noreferrer\"><code>JwtBuilder.signWith(SignatureAlgorithm alg, byte[] secretKey)</code></a> (Java)</li>\n</ul>\n<pre class=\"lang-java prettyprint-override\"><code>    String secret = &quot;...&quot;; // The same as with Python\n    ...\n    String jwttoken = Jwts.builder()\n            ...\n            .signWith(SignatureAlgorithm.HS512, secret.getBytes())\n            .compact();\n</code></pre>\n<p>Alternatively, if your Java result is already as intended, you might need to change the Python code like:</p>\n<pre class=\"lang-py prettyprint-override\"><code>import base64\n...\nencoded_jwt = jwt.encode(payload, base64.b64decode(secret), algorithm='HS512', headers=headers)\n</code></pre>\n<p><em>Disclaimer:</em> I don't have any Python experience.</p>\n"}],"owner":{"user_id":21354950,"display_name":"takaki"},"view_count":73,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1681538078,"question_id":76020607,"body":"<p>#1. python code:</p>\n<pre><code>payload = {&quot;login_user_key&quot;: &quot;b7c5443c-5395-46b0-b6c1-d940fd686880&quot;}\nsecret = 'abcdefghijklmnopqrstuvwxyz'\nheaders = {&quot;alg&quot;: &quot;HS512&quot;, &quot;typ&quot;: &quot;JWT&quot;}\nencoded_jwt = jwt.encode(payload, secret, algorithm='HS512', headers=headers)\nprint(encoded_jwt)\n</code></pre>\n<p>#result:eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJsb2dpbl91c2VyX2tleSI6ImI3YzU0NDNjLTUzOTUtNDZiMC1iNmMxLWQ5NDBmZDY4Njg4MCJ9.fmhdCmM4BJBOASK_UXtRoszP0Q614mDlQ3iDU9_ZFCr--jh--OHG8o5aCG4Zgpcpmsry9NH1LY-4Bd_NN0mmQQ</p>\n<p>//2. java code:</p>\n<pre><code>        String secret = &quot;abcdefghijklmnopqrstuvwxyz&quot;;\n        Map&lt;String, Object&gt; claims = new HashMap&lt;&gt;();\n        claims.put(&quot;login_user_key&quot;, &quot;b7c5443c-5395-46b0-b6c1-d940fd686880&quot;);\n        String jwttoken = Jwts.builder()\n                .setHeaderParam(&quot;alg&quot;, &quot;HS512&quot;)\n                .setHeaderParam(&quot;typ&quot;, &quot;JWT&quot;)\n                .setClaims(claims)\n                .signWith(SignatureAlgorithm.HS512, secret).compact();\n        System.out.println(jwttoken);\n</code></pre>\n<p>//result:eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJsb2dpbl91c2VyX2tleSI6ImI3YzU0NDNjLTUzOTUtNDZiMC1iNmMxLWQ5NDBmZDY4Njg4MCJ9.Gat6BTTXtwC_XWN4pZjqC-x4Bw24xfpNXmLIMSysa3FJaPvpnXcjO0wp6FBlKtrfYyqZRQARQbE4rGwhAOY_eg</p>\n<p>please tell me that Java code and Python code generate different signature of encode_jwt ,and modify the python code to make the final generated jwt the same. please....</p>\n<p>I tried to use chatgpt to give an answer, but it didn't work, it may not be a problem with key encoding, maybe a problem with json data or string data?</p>\n"},{"tags":["java","android","kotlin","android-emulator"],"owner":{"user_id":2964945,"display_name":"Melquiades"},"view_count":168,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1681398869,"question_id":76007110,"body":"<p>For our automated testing platform for Android emulator, we are able to push a Proxyman certificate to a <code>/system/etc/security/cacerts</code> with the tried and tested commands:</p>\n<ol>\n<li><p>Start emulator with <code>-writable-system</code> flag: <code>emulator -avd emulator_name -writable-system</code></p>\n</li>\n<li><p>Prepare Proxyman certificate:</p>\n<ul>\n<li><p><code>openssl x509 -inform PEM -subject_hash_old -in proxyman-ssl-proxying-certificate.pem | head -1</code> - it returns a hash for the cert, eg. 30eb732c</p>\n</li>\n<li><p>save that to a file: <code>cat proxyman-ssl-proxying-certificate.pem &gt; 30eb732c.0</code></p>\n</li>\n<li><p><code>openssl x509 -inform PEM -text -in proxyman-ssl-proxying-certificate.pem -out /dev/null &gt;&gt; 30eb732c.0</code></p>\n</li>\n</ul>\n</li>\n<li><p>Push the created <code>30eb732c.0</code> to emulator:</p>\n<ul>\n<li><code>adb root</code></li>\n<li><code>adb remount</code></li>\n<li><code>adb root</code></li>\n<li><code>adb shell avbctl disable-verification</code></li>\n<li><code>adb reboot</code></li>\n<li><code>adb root</code></li>\n<li><code>adb remount</code></li>\n<li><code>adb push 30eb732c.0 /system/etc/security/cacerts</code></li>\n</ul>\n</li>\n<li><p>I can verify that the file is there by listing all certs with <code>adb shell ls /system/etc/security/cacert</code> and seeing mine on the list.</p>\n</li>\n</ol>\n<p>With these, we are able to see the traffic in Proxyman on release builds of our apps, up to API 33, and I can see the certificate installed on system partition in the Emulator Settings/Security/Encryption &amp; credentials/Trusted credentials.</p>\n<p><a href=\"https://i.stack.imgur.com/wSDAv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wSDAv.png\" alt=\"enter image description here\" /></a></p>\n<p>With the same steps for Android Emulator UpsideDownCake, I can see that the cert file is indeed in <code>/system/etc/security/cacert</code>, but the UI doesn't show it, and the traffic also fails to be captured by Proxyman (getting <code>SSL Handshake Failed</code>).</p>\n<p>The method for installing cert has been informed by many of these:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/58010655/is-adb-remount-broken-on-android-api-29\">Is adb remount broken on android api 29?</a></li>\n<li><a href=\"https://issuetracker.google.com/issues/144891973?pli=1\" rel=\"nofollow noreferrer\">https://issuetracker.google.com/issues/144891973?pli=1</a></li>\n<li><a href=\"https://gist.github.com/pwlin/8a0d01e6428b7a96e2eb\" rel=\"nofollow noreferrer\">https://gist.github.com/pwlin/8a0d01e6428b7a96e2eb</a></li>\n<li><a href=\"https://blog.ropnop.com/configuring-burp-suite-with-android-nougat\" rel=\"nofollow noreferrer\">https://blog.ropnop.com/configuring-burp-suite-with-android-nougat</a></li>\n</ul>\n<p>I feel like I might be missing something here, but also wondering what's the difference between API 33 and UpsideDownCake emulators. Has anyone been successful in installing a certificate in <code>/system/etc/security/cacert</code> on Android 14 (UpsideDownCake) emulator?</p>\n"},{"tags":["java","jpa","jakarta-ee","eclipselink"],"owner":{"user_id":21624524,"display_name":"renatompf"},"view_count":66,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1681290368,"question_id":75993697,"body":"<p>I have a class which is annotated with eclipselink <code>@Customizer</code>.</p>\n<p>That customizer, uses a custom customizer that inherits from <code>DescriptorCustomizer</code>.\nIn <code>customize</code> function I have a HistoryPolicy in order to create a history table for the annotated class.</p>\n<p>Down below I leave an example:</p>\n<p>Custom Customizer:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class MyCustomizer implements DescriptorCustomizer {\n\n    @Override\n    public void customize(ClassDescriptor cd) {\n        HistoryPolicy policy = new HistoryPolicy();\n        policy.addHistoryTableName(&quot;history_table&quot;);\n        policy.addStartFieldName(&quot;start_ts&quot;);\n        policy.addEndFieldName(&quot;end_ts&quot;);\n        cd.setHistoryPolicy(policy);\n    }\n\n}\n</code></pre>\n<p>My Class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Customizer(MyCustomizer.class)\npublic class myClass {\n    @Column(name = &quot;field_To_Track&quot;)\n    private Integer fieldToBeTracked;\n    @Column(name = &quot;field_Not_To_Track&quot;)\n    private Integer fieldNotToBeTracked;\n}\n\n</code></pre>\n<p>I want to ignore a fields from being the reason why a row it's written in the history table. That way, every new row written in the table it's not because of an update on that column. Is that possible?</p>\n"},{"tags":["java","java-20"],"comments":[{"owner":{"user_id":2970947,"display_name":"Elliott Frisch"},"edited":false,"comment_id":133993487,"body":"I think it&#39;s a compiler bug. By any chance are you using eclipse?"},{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":133993542,"body":"Definitely a bug.  Java source code should never compile to bytecodes that give a verify error.  But ... make sure you raise the bug report against the correct compiler ..."},{"owner":{"user_id":20306007,"display_name":"life888888"},"edited":false,"comment_id":133993643,"body":"I test the code, in Ubuntu 20, OpenJDK Runtime Environment Temurin-20+36, Compile Command: <code>javac -source 20 --enable-preview Main.java</code>, and run command <code>java --enable-preview Main</code>, then get same error message.(java.lang.VerifyError: Bad local variable type Exception Details:   Location:     Main.testSwitch(Ljava/lang/Object;)V @309: aload)"},{"owner":{"user_id":20306007,"display_name":"life888888"},"edited":false,"comment_id":133993660,"body":"if add <code>-Xlint:preview</code>, <code>javac -source 20 -Xlint:preview --enable-preview Main.java</code>, will get more detaile warining: <code>Main.java:16: warning: [preview] patterns in switch statements are a preview feature and may be removed in a future release.             case Point(var x, var y, Color c) when c == Color.RED -&gt; out.printf(&quot;Red point x=%d, y=%d\\n&quot;,x,y);                  ^ Main.java:16: warning: [preview] deconstruction patterns are a preview feature and may be removed in a future release.....</code>"},{"owner":{"user_id":3610608,"display_name":"Hristo Stoyanov"},"edited":false,"comment_id":133995523,"body":"@life888888. I expect the warnings, since I deliberately use preview feature. But it is not OK if the thing compiles and fails at runtime. Here is the JDK printout on my MacBook Air M1 running Ventura 13.3.1 (e.g. latest), but this see like a bug in all JDK 20 distros: ``` java -version java version &quot;20&quot; 2023-03-21 Java(TM) SE Runtime Environment (build 20+36-2344) Java HotSpot(TM) 64-Bit Server VM (build 20+36-2344, mixed mode, sharing) ```"},{"owner":{"user_id":20306007,"display_name":"life888888"},"edited":false,"comment_id":133998218,"body":"@Hristo Stoyanov, I also agree that this might be a problem with JDK 20.x, so I tested on my Ubuntu 20.04 + OpenJDK Runtime Environment Temurin-20+36 and got the same error message as you. (Error: Unable to initialize main class Main Caused by: java.lang.VerifyError: Bad local variable type)"},{"owner":{"user_id":1441122,"display_name":"Stuart Marks"},"edited":false,"comment_id":133998966,"body":"Itâ€™s clearly a bug that javac is producing a class file that doesnâ€™t verify. There are a couple open bugs that seem related, e.g., <a href=\"https://bugs.openjdk.org/browse/JDK-8302865\" rel=\"nofollow noreferrer\">JDK-8302865</a> and <a href=\"https://bugs.openjdk.org/browse/JDK-8304863\" rel=\"nofollow noreferrer\">JDK-8304863</a>. You might try this on a JDK 21 build."},{"owner":{"user_id":3610608,"display_name":"Hristo Stoyanov"},"edited":false,"comment_id":134000061,"body":"Thanks @StuartMarks for confirming, I filed a bug (internal review ID : 9075078). Hopefully jdk 20 is fixed soon, so we can taste all these new features!"}],"answers":[{"owner":{"user_id":3610608,"display_name":"Hristo Stoyanov"},"up_vote_count":0,"is_accepted":false,"creation_date":1681164423,"answer_id":75981095,"body":"<p>As confirmed by @stuartmarks (see comments) this is Java 20 compiler bug.</p>\n"}],"owner":{"user_id":3610608,"display_name":"Hristo Stoyanov"},"view_count":108,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1681049426,"question_id":75971020,"body":"<p><strong>Is the below a bug</strong> in Java 20 or, am I missing something?\nIf you compile/run the below program, you get the expected printouts. But, if you uncomment the single line in the switch:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import static java.lang.System.*;\npublic class Main {\n    record Point(int x, int y, Color color){}\n    enum Color {RED, BLUE, YELLOW}\n    public static void main(String[] args) {\n        testSwitch(new Point(10,20,Color.BLUE));\n        testSwitch(new Point(10,20,Color.RED));\n        testSwitch(&quot;vbjhjbhbjhbj&quot;);\n        testSwitch(1.012);\n        testSwitch(Color.YELLOW);\n    }\n    static void testSwitch(Object o){\n        switch(o){\n            case null -&gt; out.println(&quot;Null&quot;);\n            case Color c -&gt; out.println(&quot;Color: &quot;+c);\n            //case Point(var x, var y, Color c) when c == Color.RED -&gt; out.printf(&quot;Red point x=%d, y=%d\\n&quot;,x,y);\n            case Point(var x, var y, var color) -&gt; out.printf(&quot;Point x=%d, y=%d, color=%s\\n&quot;,x,y,color);\n            case String s when s.length() &gt;=7 -&gt; out.printf(&quot;Big string: '%s', of size %d\\n&quot;,s,s.length());\n            case String s -&gt; out.printf(&quot;Small string: %s, of size %d\\n&quot;,s,s.length());\n            default -&gt; out.println(&quot;Unexpected value: &quot; + o);\n        }\n    }\n}\n</code></pre>\n<p>the code compiles fine, but at runtime I get (on MacOS 13.3.1 ARM64 JDK 20 with preview features enabled) this run-time failure:</p>\n<pre><code>/Library/Java/JavaVirtualMachines/jdk-20.jdk/Contents/Home/bin/java --enable-preview -javaagent:/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=50788:/Applications/IntelliJ IDEA.app/Contents/bin -Dfile.encoding=UTF-8 -Dsun.stdout.encoding=UTF-8 -Dsun.stderr.encoding=UTF-8 -classpath /Users/hristo/projects/java20tests/java20tests/out/production/java20tests Main\nError: Unable to initialize main class Main\nCaused by: java.lang.VerifyError: Bad local variable type\nException Details:\n  Location:\n    Main.testSwitch(Ljava/lang/Object;)V @309: aload\n  Reason:\n    Type top (current frame, locals[7]) is not assignable to reference type\n  Current Frame:\n    bci: @309\n    flags: { }\n    locals: { 'java/lang/Object', 'java/lang/Object', integer, top, 'Main$Point', integer, integer, top, integer, integer, integer, integer, 'Main$Color', integer }\n    stack: { 'java/io/PrintStream', 'java/lang/String', '[Ljava/lang/Object;', '[Ljava/lang/Object;', integer }\n  Bytecode:\n    0000000: 2a4c 033d 2b1c ba00 2800 00aa 0000 019a\n    0000010: ffff ffff 0000 0003 0000 0021 0000 002c\n    0000020: 0000 0043 0000 013f 0000 0174 b200 2c12\n    0000030: 32b6 0034 a701 832b c000 0a4e b200 2c2d\n    0000040: b800 3aba 003f 0000 b600 34a7 016c 2bc0\n    0000050: 0007 3a04 1904 b600 4336 0803 3609 1508\n    0000060: b800 4715 09ba 004c 0000 ab00 0000 00db\n    0000070: 0000 0002 ffff ffff 0000 00db 0000 0000\n    0000080: 0000 001a 1508 3605 1904 b600 4d36 0a03\n    0000090: 360b 150a b800 4715 0bba 004c 0000 ab00\n    00000a0: 0000 00a1 0000 0002 ffff ffff 0000 00a1\n    00000b0: 0000 0000 0000 001a 150a 3606 1904 b600\n    00000c0: 503a 0c03 360d 190c 150d ba00 5400 00ab\n    00000d0: 0000 004b 0000 0002 ffff ffff 0000 004b\n    00000e0: 0000 0000 0000 0019 190c 3a07 1907 b200\n    00000f0: 18a5 0009 0436 0da7 ffcf b200 2c12 5805\n    0000100: bd00 0259 0315 05b8 0047 5359 0415 06b8\n    0000110: 0047 53b6 005a 57a7 00a0 b200 2c12 5e06\n    0000120: bd00 0259 0315 05b8 0047 5359 0415 06b8\n    0000130: 0047 5359 0519 0753 b600 5a57 a700 7b04\n    0000140: 3609 a7ff 1c05 3da7 febd 2bc0 003b 3a08\n    0000150: 1908 b600 6010 07a2 0008 063d a7fe a8b2\n    0000160: 002c 1263 05bd 0002 5903 1908 5359 0419\n    0000170: 08b6 0060 b800 4753 b600 5a57 a700 3b2b\n    0000180: c000 3b3a 09b2 002c 1265 05bd 0002 5903\n    0000190: 1909 5359 0419 09b6 0060 b800 4753 b600\n    00001a0: 5a57 a700 15b2 002c 2ab8 003a ba00 6700\n    00001b0: 00b6 0034 a700 03a7 0011 4cbb 006a 592b\n    00001c0: b600 6c2b b700 70bf b1                 \n  Exception Handler Table:\n    bci [86, 89] =&gt; handler: 442\n    bci [138, 141] =&gt; handler: 442\n    bci [190, 193] =&gt; handler: 442\n  Stackmap Table:\n    append_frame(@4,Object[#2],Integer)\n    same_frame(@44)\n    same_frame(@55)\n    same_frame(@78)\n    full_frame(@94,{Object[#2],Object[#2],Integer,Top,Object[#7],Top,Top,Top,Integer,Integer},{})\n    same_frame(@132)\n    full_frame(@146,{Object[#2],Object[#2],Integer,Top,Object[#7],Integer,Top,Top,Integer,Integer,Integer,Integer},{})\n    same_frame(@184)\n    full_frame(@198,{Object[#2],Object[#2],Integer,Top,Object[#7],Integer,Integer,Top,Integer,Integer,Integer,Integer,Object[#10],Integer},{})\n    same_frame(@232)\n    full_frame(@250,{Object[#2],Object[#2],Integer,Top,Object[#7],Integer,Integer,Object[#10],Integer,Integer,Integer,Integer,Object[#10],Integer},{})\n    full_frame(@282,{Object[#2],Object[#2],Integer,Top,Object[#7],Integer,Integer,Top,Integer,Integer,Integer,Integer,Object[#10],Integer},{})\n    full_frame(@319,{Object[#2],Object[#2],Integer,Top,Object[#7],Integer,Top,Top,Integer,Integer,Integer,Integer},{})\n    full_frame(@325,{Object[#2],Object[#2],Integer,Top,Object[#7],Top,Top,Top,Integer,Integer},{})\n    full_frame(@330,{Object[#2],Object[#2],Integer},{})\n    full_frame(@351,{Object[#2],Object[#2],Integer,Top,Top,Top,Top,Top,Object[#59]},{})\n    full_frame(@383,{Object[#2],Object[#2],Integer},{})\n    same_frame(@421)\n    chop_frame(@439,2)\n    same_locals_1_stack_item_frame(@442,Object[#104])\n    same_frame(@456)\n\nProcess finished with exit code 1\n</code></pre>\n"},{"tags":["java","spring-boot","kotlin"],"comments":[{"owner":{"user_id":792580,"display_name":"srk"},"edited":false,"comment_id":134376995,"body":"For me adding <code>&quot;kotlin.compiler.jvm.target&quot;: &quot;17&quot;</code> in the project settings.json resolved the compiler error in SpringBoot main class"}],"owner":{"user_id":7830921,"display_name":"Tom_E"},"view_count":313,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1680262622,"question_id":75898088,"body":"<p>I'm trying to compile / run a fresh created &quot;hello world&quot; type Spring Boot application in VS Code.</p>\n<ul>\n<li>Spring boot is Version 3.0.5</li>\n<li>Java is pinned to 17 in pom.xml</li>\n<li>Kotlin Compiler is 1.7.22 in pom.xml</li>\n<li>I have &quot;kotlin.compiler.jvm.target&quot;: &quot;17&quot; in the project settings.json</li>\n</ul>\n<p>When I compile, I get the error <code>Cannot inline bytecode built with JVM target 17 into bytecode that is being built with JVM target 1.8. Please specify proper '-jvm-target' option kotlin(INLINE_FROM_HIGHER_PLATFORM)</code> in the &quot;<strong>KotlinSampleApplication.kt</strong>&quot; / &quot;<strong>runApplication</strong>&quot;.</p>\n<p>When I remove &quot;<strong>kotlin.compiler.jvm.target</strong>&quot; from the settings.json, it complains about running JVM 1.8 target code in an bytecode builds for Java 17 (== the other way around)</p>\n<p>It looks like some of the Spring Boot dependencies are build with Java 17 and some with Java 1.8.\nHow can I get the application to run?</p>\n"},{"tags":["java","sql-server","azure-web-app-service","mssql-jdbc"],"comments":[{"owner":{"user_id":7961298,"display_name":"Rolf Nyffenegger"},"edited":false,"comment_id":133836737,"body":"With further investigation, it seems to be an issue between the JDBC driver and the used Token service of Azure WebApp. From version 10.2.3 on they decided to only use the &quot;expires_in&quot; field from the response, but the provided token service from Azure only returns the &quot;expires_on&quot; field. Issue is tracked here: <a href=\"https://github.com/microsoft/mssql-jdbc/issues/2103\" rel=\"nofollow noreferrer\">github.com/microsoft/mssql-jdbc/issues/2103</a>"}],"answers":[{"owner":{"user_id":7961298,"display_name":"Rolf Nyffenegger"},"up_vote_count":0,"is_accepted":false,"creation_date":1681214187,"answer_id":75985628,"body":"<p>As mentioned in this github issue (<a href=\"https://github.com/microsoft/mssql-jdbc/issues/2103\" rel=\"nofollow noreferrer\">https://github.com/microsoft/mssql-jdbc/issues/2103</a>), it was really a driver version incompatibility (azure-msal, azure-identity). Choosing the correct transitive dependencies solved the issue, at least for JDBC version 12.x.\nFixes for versions 10.x + 11.x should be ready soon.</p>\n"}],"owner":{"user_id":7961298,"display_name":"Rolf Nyffenegger"},"view_count":76,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1679997304,"question_id":75864757,"body":"<p>When upgrading our Java WebApp (SpringBoot) to a newer than 10.1 (&gt;= 10.2 or 11.x or 12.x) version of the JDBC connection driver, it is now failing with the following Exception:</p>\n<p><code>SQLServerException: MSI Token failure: Failed to acquire token from MSI Endpoint</code></p>\n<p>With Version 12.2 we get a slightly different Exception:</p>\n<p><code>IOException: Server returned HTTP response code: 401 for URL: http://169.254.132.2:8081/msi/token?resource=https%3A%2F%2Fdatabase.windows.net%2F&amp;api-version=2017-09-01</code></p>\n<p>We are using an Azure WebApp with SystemAssigned Identity:\n<a href=\"https://i.stack.imgur.com/yHI4O.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yHI4O.png\" alt=\"Actived System assigned Identity\" /></a></p>\n<p>The mentioned user has access to the database (with JDBC driver version 10.1 it works perfect).</p>\n<p>I then tried to reproduce it with a freshly set up web app and with a demo application that contains only this code (with correct server and db names):</p>\n<pre><code>public class Application {\n  public static void main(String[] args) throws Exception {\n    SQLServerDataSource ds = new SQLServerDataSource();\n    ds.setServerName(&quot;server-name&quot;);\n    ds.setDatabaseName(&quot;database-name&quot;);\n    ds.setAuthentication(&quot;ActiveDirectoryMSI&quot;);\n\n    try (Connection connection = ds.getConnection();\n        Statement stmt = connection.createStatement();\n        ResultSet rs = stmt.executeQuery(&quot;SELECT * FROM exampledata&quot;)) {\n      if (rs.next()) {\n        System.out.println(&quot;Data can be read: &quot; + rs.getString(1));\n      } else {\n        System.out.println(&quot;No Data could be fetched...&quot;);\n      }\n    }\n  }\n}\n</code></pre>\n<p>This results in the same exception:\n<code>SQLServerException: MSI Token failure: Failed to acquire token from MSI Endpoint</code></p>\n<p>Then I tried the same using Username/Password authentication (<code>ds.setAuthentication(&quot;SqlPassword&quot;)</code>). With that everything works fine. But this is not an option for us.</p>\n<p>Reading through the internet, previous posts mentioned that it is an issue with the JDBC driver. But that's long ago and there would be 3 Major versions affected. So I assume something different is wrong. Any ideas?</p>\n"},{"tags":["java","android","android-studio","kotlin"],"comments":[{"owner":{"user_id":9520315,"display_name":"Sujal Kumar"},"edited":false,"comment_id":133775728,"body":"Can you please share the build.gradle file?"},{"owner":{"user_id":56076,"display_name":"Don Branson"},"edited":false,"comment_id":133821950,"body":"I see the same issue. The app seems to run, but with this error message. There&#39;s a <a href=\"https://github.com/koreader/koreader/issues/9891\" rel=\"nofollow noreferrer\">Closed issue</a> which has a link to this <a href=\"https://github.com/koreader/koreader/issues/9867\" rel=\"nofollow noreferrer\">Open issue</a>."},{"owner":{"user_id":1325048,"display_name":"d.aemon"},"edited":false,"comment_id":134241278,"body":"@Bob please don&#39;t use links to resources that no longer exist. If you need an answer to your question, helpers should be able to reach all the information you provide. The link to build.gradle no longer works."}],"owner":{"user_id":21484738,"display_name":"Bob"},"view_count":924,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1679693810,"question_id":75838293,"body":"<p>I created an application in android studio, the strange part is that the application works perfectly on the emulator, but when I press a certain button, the application crashes on the real phone.</p>\n<p>Logcat:</p>\n<blockquote>\n<p>E/BufferQueueProducer: Unable to open libpenguin.so: dlopen failed: library &quot;libpenguin.so&quot; not found.\njava.lang.IndexOutOfBoundsException: Index: 0, Size: 0</p>\n</blockquote>\n<p>Thank you in advance!</p>\n"},{"tags":["java","android","android-print-framework","android-print-manager"],"owner":{"user_id":21238708,"display_name":"Jatin guglani"},"view_count":27,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1679334835,"question_id":75793691,"body":"<p>I'm able to print a custom document using <a href=\"https://developer.android.com/training/printing/custom-docs\" rel=\"nofollow noreferrer\">Printing custom documents</a></p>\n<p>but it uses android print interface to perform the print operations (as shown in image)</p>\n<p><a href=\"https://i.stack.imgur.com/eR0zu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/eR0zu.png\" alt=\"enter image description here\" /></a></p>\n<p>Instead, I want to show my own interface to print the doc, I have seen many apps interface that does this, but not able to find any resource for the steps to be followed.</p>\n<p><a href=\"https://i.stack.imgur.com/Fh0Fs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Fh0Fs.png\" alt=\"enter image description here\" /></a></p>\n<p><a href=\"https://i.stack.imgur.com/QW54q.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QW54q.png\" alt=\"enter image description here\" /></a></p>\n<p>I'm not clear with the right sets of steps and classes to be used to implement the same or if is there any resource for the same.</p>\n"},{"tags":["java","multithreading","project-loom"],"comments":[{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":133656068,"body":"The lack of preemptive task switching between virtual threads may add fuel to the flames but generally, every server will become unresponsive â€œif enough requests happen to be running CPU-bound code at onceâ€. But submitting CPU intense jobs to any thread pool of your choice still is possible the same way as before. The great thing about the virtual threads is that you can simply <code>join()</code> on the task (or use any other form of blocking wait), instead of having to wrench your code into <code>thenâ€¦</code> chains."}],"owner":{"user_id":9367377,"display_name":"tsutsu"},"view_count":47,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1677614522,"question_id":75596771,"body":"<p>We have a Jetty webapp with a custom threadpool backed by Java19 virtual threads.</p>\n<p>The business logic we run in response to a request is usually IO-bound (e.g. DB queries), so virtual threads have been a great win for us, allowing us to have many more IO-bound requests in-flight at once than would be possible using platform threads, while avoiding writing explicitly async code.</p>\n<p>But some of our requests have CPU-bound computation sections. And if enough requests happen to be running CPU-bound code at once, our whole webapp will lock up and become unresponsive to new requests until one of these requests resolves.</p>\n<p>Java19's virtual-threading support is apparently implemented by having all virtual threads schedule onto a single JVM-global bounded-size ForkJoinPool backed by N underlying carrier threads.</p>\n<p>This means that, if I start many virtual threads â€” and at least N of these threads have some long-running CPU-bound operation as part of them â€” then as soon as these N threads reach this CPU-bound part, the entire JVM-global virtual thread pool will lock up / become blocked, since all available carrier threads are in use by one of the virtual threads running CPU-bound code.</p>\n<p>What would be a best-practice, in designing an app that makes use of virtual threads as the top-level concurrency mechanism, if it has mixed IO-bound/CPU-bound workloads like this?</p>\n"},{"tags":["java","executorservice","executor"],"comments":[{"owner":{"user_id":13860286,"display_name":"Shila Mosammami"},"edited":false,"comment_id":133166119,"body":"I guess you should add your code here, it is not clear what you are explaining"},{"owner":{"user_id":16034206,"display_name":"experiment unit 1998X"},"edited":false,"comment_id":133174230,"body":"hello, i added some source code, i have refactored it to use threads currently instead of an executor service, but you could just assume it uses two executor services of single thread as mentioned in the question"},{"owner":{"user_id":16034206,"display_name":"experiment unit 1998X"},"edited":false,"comment_id":133174247,"body":"but basically, i want to know does creating two executor services that use single thread cause performance issues? i assume it might be expensive to instantiate two different executor service objects, and could a thread pool of 2 be more performant/less expensive while still being able to meet the requirements of executing the tasks in order?"},{"owner":{"user_id":7970787,"display_name":"Alex R"},"edited":false,"comment_id":133174648,"body":"You do not need to create a thread <i>pool</i> (i.e. an <code>ExecutorService</code>) if your UDPServer is running for the whole duration of the program. A pool is used for Thread reuse. If your task is blocking a Thread for the entire duration, you don&#39;t have to create an extra pool for it. I&#39;d probably just stick with <code>new Thread</code> for the UDPServer and <code>newSingleThreadExecutor()</code> for the packet tasks."}],"owner":{"user_id":16034206,"display_name":"experiment unit 1998X"},"view_count":68,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1676351691,"question_id":75443734,"body":"<p>I have a task that runs in an endless while loop to read from a queue of numbers and checks if there is a sequence gap. Then, the main thread listens to UDP multicast and if it receives a packet, it creates and submits a runnable task to an executor service that will persist the packet to a file, then add it to the queue to be read. The persisting of packet to file and adding of packets to queue needs to be done in sequential order which is why I use <code>Executors.newSingleThreadExecutor()</code> for this task.</p>\n<p>I instantiated two separate Executor Services <code>Executors.newSingleThreadExecutor()</code> for these two tasks. I want to ask if it is better to instantiate two executor services as I have done, or I can achieve the same by using <code>Executors.newFixedThreadPool(2);</code>?</p>\n<p>I assume that since the first task is an endless while loop, it will take up one thread, then the second thread should have sequential execution of incoming tasks. Will there be any performance issues or will it not behave as I expect?</p>\n<p>a snip shot of the code (this one currently uses threads).</p>\n<pre><code>public UDPServer(UDPChannel... udpChannels) throws IOException {\n        //I had a executor service here to check the thread\n        SEQUENCE_CHECKER_THREAD = new Thread(new SequenceChecker(QUEUE), &quot;SequenceChecker&quot;);\n        SEQUENCE_CHECKER_THREAD.start();\n\n        //needs to check sequential tasks\n        TASK_SCHEDULER = new TaskScheduler(BUFFER_POOL, QUEUE);\n        TASK_SCHEDULER_THREAD = new Thread(TASK_SCHEDULER, &quot;TaskScheduler&quot;);\n        TASK_SCHEDULER_THREAD.start();\n\n        SELECTOR = Selector.open();\n        for (UDPChannel channel : udpChannels){\n            DatagramChannel ch = channel.getCHANNEL();\n            ch.register(SELECTOR, SelectionKey.OP_READ, channel);  //I am listening for clients are ready to be read\n        }\n        CHANNELS = udpChannels;\n    }\n/**\n     * This is a helper method to have the &quot;UDPServer&quot; listen to messages in an endless loop. By iterating over the\n     * selector's keys in a nested while loop, we listen to and receive data from channels that are ready to be read.\n     * @throws IOException the IOException that is thrown, if UDPServer has a problem {@link #closeChannels() closing channels}\n     */\n    public void startReceiving() throws IOException {\n        if (isTraceEnabled) LOGGER.trace(mainMarker,&quot;Server preparing to receive...&quot;);\n        running = false;\n        while (!Thread.currentThread().isInterrupted()){\n            if (running){\n                closeChannels();\n                closeQueue();\n                break;\n            }\n            try{\n                if (SELECTOR.selectNow() == 0) {\n                    continue;\n                }\n            }catch(IOException ioException){\n                ioException.printStackTrace();\n                LOGGER.error(ioException.getMessage());\n            }\n\n            Iterator&lt;SelectionKey&gt; iter = SELECTOR.selectedKeys().iterator();\n            while(iter.hasNext()){\n                SelectionKey key = iter.next();\n                if (key.isReadable()){\n                    try {\n                        receiveData(key);\n                    } catch (InterruptedException e) {\n                        LOGGER.error(e.getMessage());\n                    }\n                }\n                iter.remove();\n            }\n        }\n        if (isTraceEnabled) LOGGER.trace(mainMarker,&quot;PacketSink finished receiving...&quot;);\n    }\n\n    /**\n     * helper method to receive data from a provided datagram channel into the byteBuffer.\n     * This method then calls the decodeByteBuffer method to decode. Then , using chronicle queue's\n     * appender, writes a &quot;self-describing&quot; message to the queue. Do &lt;b&gt;NOT&lt;/b&gt; use the try-with-resources to\n     * write the document. It writes in a wrong low-level format which clashes with self-describing messages\n     * and causes tailer to not be able to read.\n     * &lt;p&gt;\n     *     try (final DocumentContext dc = APPENDER.writingDocument()){\n     *         dc.wire().writeDocument(w -&gt; w.write(&quot;packet&quot;).marshallable(\n     *                 m-&gt;m.write(&quot;moldUdpHeader&quot;).text(moldUdpHeader.toString())\n     *                         .write(&quot;byteBuffer&quot;).bytes(buffer.array())\n     *         ));\n     *     }catch(Exception e){\n     *         e.printStackTrace();\n     *     }\n     *\n     * @param key the SelectionKey that represents a selected channel\n     * @throws IOException IOException when dealing with DatagramChannels/UDP Sockets\n     */\n    private void receiveData(SelectionKey key) throws IOException, InterruptedException {\n        if (isTraceEnabled) LOGGER.trace(mainMarker,&quot;Key: {}&quot;, key);\n        DatagramChannel channel = (DatagramChannel) key.channel();\n        ByteBuffer buffer;\n        while((buffer = BUFFER_POOL.getBuffer()) == null){}  //while unable to get buffer, continue to poll for buffer\n\n        buffer.clear();\n        InetSocketAddress remoteAdd = (InetSocketAddress) channel.receive(buffer);\n        buffer.flip();\n\n        try {  //here is where i previously used a single threaded executor service to schedule sequential tasks\n            TASK_SCHEDULER.scheduleTask(buffer, remoteAdd,((UDPChannel) key.attachment()).getChannelMarker());\n        } catch (InterruptedException e) {\n            LOGGER.warn(e.getMessage());\n        }\n        if (isTraceEnabled) LOGGER.trace(mainMarker,&quot;Server has read from key: {}&quot;, key);\n    }\n</code></pre>\n"},{"tags":["java","android","gradle"],"comments":[{"owner":{"user_id":6540591,"display_name":"User51"},"edited":false,"comment_id":132761869,"body":"Would something like this do it for you, to exclude/include what you dont/do want?  <a href=\"https://stackoverflow.com/questions/19575474/gradle-how-to-exclude-a-particular-package-from-a-jar\" title=\"gradle how to exclude a particular package from a jar\">stackoverflow.com/questions/19575474/&hellip;</a>"},{"owner":{"user_id":2437655,"display_name":"Shubham AgaRwal"},"edited":false,"comment_id":132763674,"body":"Will check jar and sourceSets but I think it focus on what not to pack. In case of gradle dependency (or .aar file), we already have a compiled packaged jar (classes.jar) file."}],"answers":[{"owner":{"user_id":2049647,"display_name":"ATutorMe"},"up_vote_count":0,"is_accepted":false,"creation_date":1675232114,"answer_id":75306293,"body":"<p>Using gradle constraints might be the answer: <a href=\"https://docs.gradle.org/current/userguide/dependency_constraints.html#sec:adding-constraints-transitive-deps\" rel=\"nofollow noreferrer\">https://docs.gradle.org/current/userguide/dependency_constraints.html#sec:adding-constraints-transitive-deps</a></p>\n<p>You could then have your fixed version of the library in <code>mavenLocal</code>, your own private Nexus repo, or a <code>libs</code> directory and specify the version number of your fixed version in the constraint.</p>\n"},{"owner":{"user_id":1746655,"display_name":"MisterAnt"},"up_vote_count":0,"is_accepted":false,"creation_date":1675240413,"answer_id":75307423,"body":"<p>For me the best solution is modify the problem library.</p>\n<p>STEPS:</p>\n<ol>\n<li><p>Clone the library.</p>\n</li>\n<li><p>Use like local module in your app.</p>\n</li>\n<li><p>Keep the package name and fix the bugs.</p>\n</li>\n</ol>\n<p>PROBLEM SOLVED!</p>\n"}],"owner":{"user_id":2437655,"display_name":"Shubham AgaRwal"},"view_count":196,"up_vote_count":4,"answer_count":2,"score":4,"creation_date":1674334782,"question_id":75196524,"body":"<p>I am using a third-party dependency which doesn't handle a special use case and is been crashing on multi-process applications.</p>\n<p>Is there any way we can remove the file during packaging so that we can create and put a new fixed file in the application code with the same package name as of third party?</p>\n<p>If we are not removing the original file from the third-party dependency, we are getting multiple files defined in different dex. Is there any way to remove the original file from external dependency or replace the file during packaging?</p>\n<p>I have tried the same using</p>\n<p><a href=\"https://docs.gradle.org/current/dsl/org.gradle.api.artifacts.ResolutionStrategy.html\" rel=\"nofollow noreferrer\">ResolutionStrategy</a>: This doesn't support file-level changes.</p>\n<p><a href=\"https://docs.gradle.org/current/javadoc/org/gradle/api/file/DuplicatesStrategy.html\" rel=\"nofollow noreferrer\">DuplicatesStrategy</a>: Not able to get enough resources to solve the requirement.</p>\n<p>There can be the solution of downloading the <code>.aar</code> or <code>.jar</code> file and manually removing the file and then repackaging it. But looking forward to knowing if there is any direct solution that gradle or any other tool support this context.</p>\n"},{"tags":["java","class","intellij-idea","intellij-plugin","automated-refactoring"],"answers":[{"owner":{"user_id":2496485,"display_name":"Morteza Zakeri"},"up_vote_count":0,"is_accepted":false,"creation_date":1674125188,"answer_id":75171085,"body":"<p>As for <a href=\"https://m-zakeri.github.io/CodART/\" rel=\"nofollow noreferrer\">CodART</a>, the following code is used to rename a specified class:</p>\n<pre class=\"lang-Python3 prettyprint-override\"><code>    from codart.refactorings.rename_class2 import main\n    project_path_ = r&quot;/JSON/&quot;  # Project source files root\n    package_name_ = r&quot;org.json&quot;  # Class package name\n    class_identifier_ = r&quot;CDL&quot;  # Old class name\n    new_class_name_ = r&quot;CDL_Renamed&quot;  # New class name\n    output_dir_ = r&quot;JSON_Refactored&quot;  # Refactored project source files root\n    main(project_path_, package_name_, class_identifier_, new_class_name_, output_dir_)\n</code></pre>\n"},{"owner":{"user_id":59087,"display_name":"Dave Jarvis"},"up_vote_count":0,"is_accepted":true,"creation_date":1674522436,"answer_id":75216573,"body":"<p>A few solutions courtesy of HackerNews.</p>\n<hr />\n<p>A <a href=\"https://news.ycombinator.com/item?id=34496280\" rel=\"nofollow noreferrer\">shell script</a>:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>#!/usr/bin/env bash\n\njavas=$(find . -regex '.*\\.java$')\nsed -i -E &quot;$(printf 's/\\\\&lt;(%s)\\\\&gt;/Kt\\\\1/g;' $(grep -hrPo '\\b(class|interface|record|enum) (?!Kt)(?!List\\b)(?!Entry\\b)\\K[A-Z]\\w+'))&quot; $(echo $javas); \nperl-rename 's;\\b(?!Kt)(\\w+[.]java)$;Kt$1;' $(echo $javas)\n</code></pre>\n<p>This is a little overzealous, but rolling back some of the changes was quick and painless. Also, Arch Linux doesn't have perl-rename installed by default, so that's needed.</p>\n<hr />\n<p>Another solution is to create a <a href=\"https://news.ycombinator.com/item?id=34494072\" rel=\"nofollow noreferrer\">Kotlin IDEA plug-in</a>:</p>\n<ol>\n<li>Install, run, then import the project into <a href=\"https://www.jetbrains.com/idea/download/\" rel=\"nofollow noreferrer\">IDEA</a>.</li>\n<li>Install the Kotlin plug-in for IDEA.</li>\n<li>Press <kbd>Ctrl+Shift+A</kbd> to open the <strong>Script Engine</strong> menu.</li>\n<li>Select <strong>Kotlin</strong>.</li>\n<li>Paste the script (given below).</li>\n<li>Press <kbd>Ctrl+A</kbd> to select the script.</li>\n<li>Press <kbd>Ctrl+Enter</kbd> to integrate the script into the IDE.</li>\n<li>Open the <strong>Project</strong> window.</li>\n<li>Select a single package directory (i.e., a root-level package).</li>\n<li>Click <strong>Navigate &gt;&gt; Search Everywhere</strong>.</li>\n<li>Click the <strong>Actions</strong> tab.</li>\n<li>Search for: <code>Bulk</code></li>\n<li>Select <strong>Bulk refactor</strong>.</li>\n</ol>\n<p>The classes are renamed. Note: There may be prompts for shadowing class names and other trivial issues to resolve.</p>\n<p><strong>Script</strong></p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>@file:Suppress(&quot;NAME_SHADOWING&quot;)\n\n  import com.intellij.notification.Notification\n  import com.intellij.notification.NotificationType\n  import com.intellij.notification.Notifications\n  import com.intellij.openapi.actionSystem.*\n  import com.intellij.openapi.keymap.KeymapManager\n  import com.intellij.openapi.command.WriteCommandAction\n  import com.intellij.psi.*\n  import com.intellij.psi.search.*\n  import com.intellij.refactoring.rename.RenameProcessor\n  import com.intellij.util.ThrowableConsumer\n  import java.io.PrintWriter\n  import java.io.StringWriter\n  import javax.swing.KeyStroke\n\n  // Usage: In IDEA: Tools -&gt; IDE Scripting Console -&gt; Kotlin\n  // Ctrl+A, Ctrl+Enter to run the script\n  // Select folder containing target classes, Ctrl+Shift+A to open action menu, search for Bulk refactor\n\n  //&lt;editor-fold desc=&quot;Boilerplate&quot;&gt;\n  val b = bindings as Map&lt;*, *&gt;\n  val IDE = b[&quot;IDE&quot;] as com.intellij.ide.script.IDE\n\n  fun registerAction(\n    name: String,\n    keyBind: String? = null,\n    consumer: ThrowableConsumer&lt;AnActionEvent, Throwable&gt;\n  ) {\n    registerAction(name, keyBind, object : AnAction() {\n      override fun actionPerformed(event: AnActionEvent) {\n        try {\n          consumer.consume(event);\n        } catch (t: Throwable) {\n          val sw = StringWriter()\n          t.printStackTrace(PrintWriter(sw))\n          log(&quot;Exception in action $name: $t\\n\\n\\n$sw&quot;, NotificationType.ERROR)\n          throw t\n        }\n      }\n    });\n  }\n\n  fun registerAction(name: String, keyBind: String? = null, action: AnAction) {\n    action.templatePresentation.text = name;\n    action.templatePresentation.description = name;\n\n    KeymapManager.getInstance().activeKeymap.removeAllActionShortcuts(name);\n    ActionManager.getInstance().unregisterAction(name);\n    ActionManager.getInstance().registerAction(name, action);\n\n    if (keyBind != null) {\n      KeymapManager.getInstance().activeKeymap.addShortcut(\n        name,\n        KeyboardShortcut(KeyStroke.getKeyStroke(keyBind), null)\n      );\n    }\n  }\n\n  fun log(msg: String, notificationType: NotificationType = NotificationType.INFORMATION) {\n    log(&quot;Scripted Action&quot;, msg, notificationType)\n  }\n\n  fun log(\n    title: String,\n    msg: String,\n    notificationType: NotificationType = NotificationType.INFORMATION\n  ) {\n    Notifications.Bus.notify(\n      Notification(\n        &quot;scriptedAction&quot;,\n        title,\n        msg,\n        notificationType\n      )\n    )\n  }\n  //&lt;/editor-fold&gt;\n\n  registerAction(&quot;Bulk refactor&quot;) lambda@{ event -&gt;\n    val project = event.project ?: return@lambda;\n    val psiElement = event.getData(LangDataKeys.PSI_ELEMENT) ?: return@lambda\n\n    log(&quot;Bulk refactor for: $psiElement&quot;)\n\n    WriteCommandAction.writeCommandAction(event.project).withGlobalUndo().run&lt;Throwable&gt; {\n      psiElement.accept(object : PsiRecursiveElementWalkingVisitor() {\n        override fun visitElement(element: PsiElement) {\n          super.visitElement(element);\n          if (element !is PsiClass) {\n            return\n          }\n\n          if(element.name?.startsWith(&quot;Renamed&quot;) == false) {\n            log(&quot;Renaming $element&quot;)\n\n            // arg4 = isSearchInComments\n            // arg5 = isSearchTextOccurrences\n            val processor = object : RenameProcessor(project, element, &quot;Renamed&quot; + element.name, false, false) {\n              override fun isPreviewUsages(usages: Array&lt;out UsageInfo&gt;): Boolean {\n                return false\n              }\n            }\n  \n            processor.run()\n          }\n        }\n      })\n    }\n  }\n</code></pre>\n"}],"owner":{"user_id":59087,"display_name":"Dave Jarvis"},"view_count":311,"up_vote_count":4,"accepted_answer_id":75216573,"answer_count":2,"score":4,"creation_date":1674013828,"question_id":75154524,"body":"<h1>Background</h1>\n<p>Hundreds of class files need to be renamed with a prefix. For example, rename these:</p>\n<ul>\n<li>com.domain.project.Mary</li>\n<li>com.domain.project.Jones</li>\n<li>com.domain.project.package.Locket</li>\n<li>com.domain.project.package.Washington</li>\n</ul>\n<p>to these:</p>\n<ul>\n<li>com.domain.project.PrefixMary</li>\n<li>com.domain.project.PrefixJones</li>\n<li>com.domain.project.package.PrefixLocket</li>\n<li>com.domain.project.package.PrefixWashington</li>\n</ul>\n<p>Such a rename could use a regular expression on the corresponding <code>.java</code> filename, such as:</p>\n<pre><code>(.+)\\.(.+) -&gt; Prefix$1\\.$2\n</code></pre>\n<h1>Problem</h1>\n<p>Most solutions describe renaming files. Renaming files won't work because it leaves the class references unchanged, resulting in a broken build.</p>\n<h1>Question</h1>\n<p>How would you rename Java source files en mass (in bulk) so that all references are also updated, without performing hundreds of actions manually (i.e., one per file)?</p>\n<h1>Ideas</h1>\n<ul>\n<li><a href=\"https://github.com/qaware/refactobot\" rel=\"nofollow noreferrer\">refactobot</a> is inscrutable, but looks promising.</li>\n<li><a href=\"https://spoon.gforge.inria.fr/mvnsites/spoon-core/apidocs/spoon/refactoring/CtRefactoring.html\" rel=\"nofollow noreferrer\">Spoon</a>'s Refactoring API is too buggy and introduced broken code.</li>\n<li><a href=\"https://javaparser.org/\" rel=\"nofollow noreferrer\">JavaParser</a> doesn't appear to have a concept of related references. Renaming the class resulted in only the class name being changed, but not its constructor, much less other references. This would require a visitor pattern, but even so the output from JavaParser loses formatting and may introduce other issues.</li>\n<li><a href=\"https://github.com/m-zakeri/CodART\" rel=\"nofollow noreferrer\">CodART</a> could help refactor the class names.</li>\n<li>Rename the files using a regular expression and the <code>find</code> command, then use an IDE to fix all the problems. I couldn't see a way for IntelliJ IDEA to correct errors in bulk, which means fixing hundreds of issues one at a time.</li>\n<li>Use IntelliJ IDEA's &quot;replace structurally&quot; functionality. This doesn't perform refactoring, resulting in a broken build. Also, there's no easy way to distinguish between files that have already been renamed and files that haven't: you have to rename by selecting classes in batches.</li>\n<li>Use IntelliJ's <a href=\"https://github.com/JetBrains/intellij-community/blob/master/platform/lang-impl/src/com/intellij/refactoring/rename/RenameProcessor.java\" rel=\"nofollow noreferrer\">RenameProcessor</a> API to perform renaming. There doesn't appear to be a fine-grained separation of packages that can be pulled from a central repository.</li>\n<li>Use an IDEA plug-in, such as <a href=\"https://github.com/Miura-KR/RenameFilesRefactorBatch-intellij\" rel=\"nofollow noreferrer\">RenameFilesRefactorBatch</a>. The plug-in has been updated to support regular expressions, making it the most promising candidate.</li>\n</ul>\n<h2>IDEA</h2>\n<p>The main stumbling block with using IDEA is that although it can detect the problems as &quot;Project Errors&quot; when renaming the files, it offers no way to resolve the all the errors at once:</p>\n<p><a href=\"https://i.stack.imgur.com/C5XVi.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/C5XVi.png\" alt=\"IDEA-01\" /></a></p>\n<p>The screenshot shows <code>Glue</code> and <code>Num</code> having been renamed to <code>KtGlue</code> and <code>KtNum</code>, respectively. There's no way to select multiple items, and the context menu does not have an option to automatically fix the problems.</p>\n"},{"tags":["java","spring","spring-boot","kotlin","spring-security"],"comments":[{"owner":{"user_id":7237884,"display_name":"Panagiotis Bougioukos"},"edited":false,"comment_id":132654887,"body":"share also your <code>@Configuration</code> and <code>@SpringBootApplication</code> classes and also any custom security configurations"},{"owner":{"user_id":20995473,"display_name":"Lukas0610"},"edited":false,"comment_id":132677300,"body":"@PanagiotisBougioukos I&#39;ve added those classes to my post"},{"owner":{"user_id":19366,"display_name":"varad"},"edited":false,"comment_id":132678517,"body":"I have an interface with a method annotated with <code>@PreAuthorize</code>. An implementation of this method also have <code>@PreAuthorize</code>. I.e. PreAuthorize is defined on two places for the same method. When using @EnableMethodSecurity, I was getting the same error.   When I use deprecated &quot;<code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code>&quot; instead, it works. I guess that&#39;s what they mean by &quot;activate stricter enforcement of Spring Securityâ€™s non-repeatable&quot; (<a href=\"https://docs.spring.io/spring-security/reference/5.8/migration/servlet/authorization.html#servlet-check-for-annotationconfigurationexceptions\" rel=\"nofollow noreferrer\">docs.spring.io/spring-security/reference/5.8/migration/serv&zwnj;&#8203;let/&hellip;</a>)"}],"answers":[{"owner":{"user_id":20995473,"display_name":"Lukas0610"},"up_vote_count":0,"is_accepted":true,"creation_date":1674287676,"answer_id":75191876,"body":"<p>After some more debugging and reading through the migration-guide @varad posted I decided to implement custom authorization-managers which do not scan the annotations as thoroughly as Spring Security does.</p>\n<p>I posted the implementations of the custom method-security and authorization-managers on GitHub: <a href=\"https://gist.github.com/Lukas0610/5ac78a358276fa15b1ce7cdc0483988d\" rel=\"nofollow noreferrer\">https://gist.github.com/Lukas0610/5ac78a358276fa15b1ce7cdc0483988d</a></p>\n<p>Thanks for you help guys.</p>\n"},{"owner":{"user_id":4863415,"display_name":"Manas Das"},"up_vote_count":0,"is_accepted":false,"creation_date":1683753606,"answer_id":76222627,"body":"<p>I am doing similar stuff. Applying post filter on findAll method.</p>\n<pre><code>public interface AbcRepository extends JpaRepository&lt;InfraResource, Long&gt; {\n\n    @PostFilter(&quot;hasPermission(filterObject, 'read')&quot;)\n    List&lt;InfraResource&gt; findAll();\n}\n</code></pre>\n<p>Configuration annotated with @EnableMethodSecurity(prePostEnabled = true) I am getting following issue.</p>\n<p><strong>API Response</strong></p>\n<pre><code>&quot;status&quot;: 500,\n&quot;error&quot;: &quot;Internal Server Error&quot;,\n</code></pre>\n<p><strong>Server log</strong></p>\n<pre><code>ERROR 45859 --- [nio-8080-exec-2] o.a.c.c.C.[.[.[.[dispatcherServlet]      : Servlet.service() for servlet [dispatcherServlet] in context with path [/api] threw exception [Request processing failed: org.springframework.core.annotation.AnnotationConfigurationException: Found more than one annotation of type interface org.springframework.security.access.prepost.PostFilter attributed to public final java.util.List jdk.proxy2.$Proxy108.findAll() Please remove the duplicate annotations and publish a bean to handle your authorization logic.] with root cause\n        \n        org.springframework.core.annotation.AnnotationConfigurationException: Found more than one annotation of type interface org.springframework.security.access.prepost.PostFilter attributed to public final java.util.List jdk.proxy2.$Proxy108.findAll() Please remove the duplicate annotations and publish a bean to handle your authorization logic.\n</code></pre>\n<p>After doing some further debug into the code base, I found <code>AuthorizationAnnotationUtils</code> class. Method <code>findUniqueAnnotation</code> performs an exhaustive search on type hierarchy of a given method and if the it finds duplicate annotation throws <code>AnnotationConfigurationException</code> exception.</p>\n<p>Under the hood for findAll there are 2 implementations.</p>\n<pre><code>1. Iterable&lt;T&gt; findAll() coming from CrudRepository\n2. List&lt;T&gt; findAll() coming from SimpleJpaRepository \n</code></pre>\n<p>Further digging down, at runtime it is finding duplicate <code>PostFilter</code> annotation for <code>findAll</code> method.</p>\n<p>Here is the duplicate details in runtime</p>\n<pre><code>public abstract java.util.List AbcRepository.findAll()\n    \npublic default java.lang.Iterable AbcRepository.findAll()\n</code></pre>\n<p>For now I am using <code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code> instead to overcome the issue even though it is marked as deprecated.</p>\n<p>I am still researching on. I Will post an update as soon as I find an alternative.</p>\n"}],"owner":{"user_id":20995473,"display_name":"Lukas0610"},"view_count":544,"up_vote_count":4,"accepted_answer_id":75191876,"answer_count":2,"score":4,"creation_date":1673560053,"question_id":75102645,"body":"<p>I have recently upgraded my Spring Boot Application to Spring Boot 3 (from 2.6.4), Kotlin 1.8.0 (from 1.7.20) and JDK 17 (from 11). Right now I'm facing AnnotationConfigurationExceptions caused by <code>@PreAuthorize</code> meta-annotations used on inherited repository-methods.</p>\n<pre><code>org.springframework.core.annotation.AnnotationConfigurationException: Found more than one annotation of type interface org.springframework.security.access.prepost.PreAuthorize attributed to public final java.util.List jdk.proxy2.$Proxy390.findAll() Please remove the duplicate annotations and publish a bean to handle your authorization logic.\n        at org.springframework.security.authorization.method.AuthorizationAnnotationUtils.findUniqueAnnotation(AuthorizationAnnotationUtils.java:64)\n        at org.springframework.security.authorization.method.PreAuthorizeExpressionAttributeRegistry.findPreAuthorizeAnnotation(PreAuthorizeExpressionAttributeRegistry.java:71)\n        at org.springframework.security.authorization.method.PreAuthorizeExpressionAttributeRegistry.resolveAttribute(PreAuthorizeExpressionAttributeRegistry.java:61)\n        at org.springframework.security.authorization.method.AbstractExpressionAttributeRegistry.lambda$getAttribute$0(AbstractExpressionAttributeRegistry.java:57)\n        at java.base/java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1708)\n        at org.springframework.security.authorization.method.AbstractExpressionAttributeRegistry.getAttribute(AbstractExpressionAttributeRegistry.java:57)\n        at org.springframework.security.authorization.method.AbstractExpressionAttributeRegistry.getAttribute(AbstractExpressionAttributeRegistry.java:46)\n        at org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager.check(PreAuthorizeAuthorizationManager.java:63)\n        at org.springframework.security.authorization.method.PreAuthorizeAuthorizationManager.check(PreAuthorizeAuthorizationManager.java:40)\n        at org.springframework.security.authorization.ObservationAuthorizationManager.check(ObservationAuthorizationManager.java:55)\n        at org.springframework.security.config.annotation.method.configuration.DeferringObservationAuthorizationManager.check(DeferringObservationAuthorizationManager.java:47)\n        at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:252)\n        at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:198)\n        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\n        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)\n</code></pre>\n<p>After some debugging, I found that Spring Security somehow reflects the single annotation multiple times. As soon as I move the methods from the base-repository to the actual repository, the exception does no longer appear.</p>\n<p>I've got a base-repository implementing some common methods like findAll, findById, etc. and marking them accessible using the REST-API and restricting the access using the <code>@HasRoleAdminOrHasReadCollectionPermission</code> meta-annotation (following later):</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>@NoRepositoryBean\ninterface BaseRepository&lt;T : BaseEntity&gt; : CrudRepository&lt;T, Long&gt; {\n\n    /* [...] */\n\n    @RestResource\n    @HasRoleAdminOrHasReadCollectionPermission\n    override fun findAll(): List&lt;T&gt;\n\n    /* [...] */\n\n}\n</code></pre>\n<p>Second, the base-repository is implemented by the actual entity-repository:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>@RepositoryRestResource(path = &quot;categories&quot;, collectionResourceRel = &quot;categories&quot;)\n@Transactional(readOnly = true)\ninterface CategoryRepository : BaseRepository&lt;Category&gt; {\n\n    /* [...] */\n\n}\n</code></pre>\n<p>Third, here's the <code>@HasRoleAdminOrHasReadCollectionPermission</code> meta-annotation:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>@Retention(AnnotationRetention.RUNTIME)\n@Target(AnnotationTarget.CLASS, AnnotationTarget.FUNCTION)\n@PreAuthorize(&quot;hasRole('$ROLE_ADMIN') or hasPermission($COLLECTION_TARGET, $DELETE_PERMISSION)&quot;)\nannotation class HasRoleAdminOrHasDeleteCollectionPermission\n</code></pre>\n<p>I'm all out of ideas, looked through the Java files generated from Kotlin, nowhere are duplicated annotations. Hoping someone here can help me with that.</p>\n<p>Edit: As requested, here's the Application-class and the class containing the security-config:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>@SpringBootApplication(exclude = [ErrorMvcAutoConfiguration::class])\n@ServletComponentScan\n@EnableAsync\n@EnableScheduling\nclass Application {\n    companion object {\n        val HOSTNAME = System.getenv(&quot;HOSTNAME&quot;)\n        val TIMESTAMP = System.currentTimeMillis()\n\n        /** Entry point, run with gradle `bootRun` task. */\n        @JvmStatic\n        fun main(args: Array&lt;String&gt;) {\n            SpringApplication.run(Application::class.java, *args)\n        }\n    }\n}\n</code></pre>\n<pre class=\"lang-kotlin prettyprint-override\"><code>@Configuration\n@EnableWebSecurity(debug = true)\n@EnableMethodSecurity(prePostEnabled = true)\nclass SecurityConfig(\n    private val environment: Environment,\n    private val baseProperties: BaseProperties,\n    private val accountService: AccountService,\n    private val integrationService: IntegrationService,\n    private val jwtService: JwtService,\n    private val loginAttemptService: LoginAttemptService,\n    private val handlerExceptionResolver: HandlerExceptionResolver\n) {\n\n    @Bean\n    fun webSecurityCustomizer(): WebSecurityCustomizer =\n        WebSecurityCustomizer { web: WebSecurity -&gt; web.debug(true) }\n\n    @Bean\n    fun corsConfigurationSource(): CorsConfigurationSource {\n        val configuration = CorsConfiguration()\n        configuration.allowedOrigins = baseProperties.corsAllowedOrigins()\n        configuration.allowedMethods = listOf(CorsConfiguration.ALL)\n        configuration.allowedHeaders = listOf(CorsConfiguration.ALL)\n        configuration.allowCredentials = true\n        val source = UrlBasedCorsConfigurationSource()\n        source.registerCorsConfiguration(ANY_PATH, configuration)\n        return source\n    }\n\n    @Bean\n    fun userDetailsService(): UserDetailsService =\n        AccountUserDetailsService(accountService, integrationService)\n\n    @Bean\n    fun authenticationManager(\n        http: HttpSecurity,\n        userDetailsService: UserDetailsService\n    ): AuthenticationManager {\n        val authenticationManagerBuilder = http.getSharedObject(AuthenticationManagerBuilder::class.java)\n\n        val loginAttemptDaoAuthenticationProvider = LoginAttemptDaoAuthenticationProvider(loginAttemptService, userDetailsService)\n        val jwtPreAuthenticationProvider = PreAuthenticatedAuthenticationProvider()\n\n        jwtPreAuthenticationProvider.setPreAuthenticatedUserDetailsService(UserDetailsByNameServiceWrapper(userDetailsService))\n\n        return authenticationManagerBuilder\n            .userDetailsService(userDetailsService).and()\n            .authenticationProvider(loginAttemptDaoAuthenticationProvider)\n            .authenticationProvider(jwtPreAuthenticationProvider)\n            .build()\n    }\n\n    @Bean\n    fun filterChain(\n        http: HttpSecurity,\n        authenticationManager: AuthenticationManager,\n        userDetailsService: UserDetailsService\n    ): SecurityFilterChain {\n        return http\n            .requireSSL()\n            .disableLocalHSTS()\n            .enableCors()\n            .enableStatelessCsrf()\n            .statelessSessionManagement()\n            .jwtAuthentication(authenticationManager)\n            .setRequestRestrictions()\n            .build()\n    }\n\n    private fun HttpSecurity.requireSSL(): HttpSecurity =\n        requiresChannel().anyRequest().requiresSecure().and()\n\n    private fun HttpSecurity.disableLocalHSTS(): HttpSecurity =\n        if (environment.acceptsProfiles(Profiles.of(DEVELOPMENT, TESTING)))\n            headers().httpStrictTransportSecurity().disable().and()\n        else this\n\n    private fun HttpSecurity.enableCors(): HttpSecurity =\n        cors().and()\n\n    private fun HttpSecurity.enableStatelessCsrf(): HttpSecurity =\n        csrf().disable().addFilterBefore(StatelessCsrfFilter(), CsrfFilter::class.java)\n\n    private fun HttpSecurity.statelessSessionManagement(): HttpSecurity =\n        sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS).and()\n\n    private fun HttpSecurity.jwtAuthentication(\n        authenticationManager: AuthenticationManager\n    ): HttpSecurity =\n        addFilterBefore(JwtPreAuthenticatedProcessingFilter(authenticationManager, jwtService), UsernamePasswordAuthenticationFilter::class.java)\n            .addFilterBefore(JwtCookiePreAuthenticationFilter(jwtService), UsernamePasswordAuthenticationFilter::class.java)\n            .formLogin()\n            .loginProcessingUrl(LOGIN_URL)\n            .successHandler(JwtCookieAuthenticationSuccessHandler(jwtService))\n            .failureHandler(AuthenticationFailureResolver(handlerExceptionResolver))\n            .and()\n            .logout()\n            .logoutUrl(LOGOUT_URL)\n            .logoutSuccessHandler(Http200LogoutSuccessHandler())\n            .addLogoutHandler(JwtCookieLogoutHandler(jwtService))\n            .and()\n\n    private fun HttpSecurity.setRequestRestrictions(): HttpSecurity =\n        authorizeHttpRequests {\n            it.requestMatchers(HttpMethod.GET, ROOT_URL).permitAll()\n                .requestMatchers([...])\n                .anyRequest().denyAll().and()\n        }\n}\n\n</code></pre>\n"},{"tags":["java","flexmark"],"owner":{"user_id":421049,"display_name":"Garret Wilson"},"view_count":56,"up_vote_count":4,"answer_count":0,"score":4,"creation_date":1672947824,"question_id":75023594,"body":"<p>Using <a href=\"https://github.com/vsch/flexmark-java\" rel=\"nofollow noreferrer\">Flexmark</a> 0.64.0 with Java 17 I'm expecting the <a href=\"https://github.com/vsch/flexmark-java/wiki/Typographic-Extension\" rel=\"nofollow noreferrer\">Typographic Extension</a> to turn <code>'</code> into <code>&amp;rsquo;</code> with its default configuration, but instead it seems merely to drop the character. The same happens e.g. with <code>---</code>.</p>\n<p>I'm setting up my parser and HTML renderer like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>MutableDataHolder parserOptions = new MutableDataSet()\n    //emoji; see https://www.webfx.com/tools/emoji-cheat-sheet/\n    .set(EmojiExtension.USE_IMAGE_TYPE, EmojiImageType.UNICODE_ONLY)\n    //GFM tables\n    .set(TablesExtension.COLUMN_SPANS, false).set(TablesExtension.APPEND_MISSING_COLUMNS, true).set(TablesExtension.DISCARD_EXTRA_COLUMNS, true)\n    .set(TablesExtension.HEADER_SEPARATOR_COLUMN_MATCH, true)\n    //extensions\n    .set(Parser.EXTENSIONS, List.of(DefinitionExtension.create(), EmojiExtension.create(), SuperscriptExtension.create(), TablesExtension.create(),\n        TypographicExtension.create(), YamlFrontMatterExtension.create()));\nparser = Parser.builder(parserOptions).build();\nhtmlRenderer = HtmlRenderer.builder().build();\n</code></pre>\n<p>Note that I just use <code>TypographicExtension.create()</code>. Maybe there are further configurations to do, but by default I wouldn't expect the extension just to drop characters.</p>\n<p>I use the parser like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>com.vladsch.flexmark.util.ast.Document markdownDocument = parser.parse(&quot;it's working&quot;);\nSystem.out.println(htmlRenderer.render(markdownDocument));\n</code></pre>\n<p>I expect:</p>\n<blockquote>\n<p><code>&lt;p&gt;it&amp;rsquo;s working&lt;/p&gt;</code></p>\n</blockquote>\n<p>Instead I get:</p>\n<blockquote>\n<p><code>&lt;p&gt;its working&lt;/p&gt;</code></p>\n</blockquote>\n<p>I tried mucking with the settings, using a literal character instead of a character reference:</p>\n<pre class=\"lang-java prettyprint-override\"><code>.set(TypographicExtension.ENABLE_QUOTES, true)\n.set(TypographicExtension.SINGLE_QUOTE_UNMATCHED, &quot;x&quot;)\n</code></pre>\n<p>Nothing changed. The character still simply disappeared</p>\n<p>However I was able to <em>disable quote processing altogether</em>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>.set(TypographicExtension.ENABLE_QUOTES, false)\n</code></pre>\n<p>Then I got my original string back. (Of course this defeats the purpose of the extension.)</p>\n<p>Does this mean the Typographic Extension is simply broken, or am I missing some additional configuration? (In any case, I certainly wouldn't expect the default configuration to silently discard content.)</p>\n<p>I opened <a href=\"https://github.com/vsch/flexmark-java/issues/547\" rel=\"nofollow noreferrer\">Flexmark Issue #547</a>, but so far I haven't had any responses. Maybe someone can point out my error.</p>\n"},{"tags":["java","maven","concurrency","continuous-integration","devops"],"comments":[{"owner":{"user_id":296328,"display_name":"khmarbaise"},"edited":false,"comment_id":133060151,"body":"Is this a multi module build? If yes use Maven itself and don&#39;t use self crafted scripts... Maven itself can du and also in parallel... Use more recent version of maven at minimium 3.8.7 or (3.9.0)..."},{"owner":{"user_id":927493,"display_name":"J Fabian Meier"},"edited":false,"comment_id":133063368,"body":"@khmarbaise I think the OP wants to test the new concurrency feature of Maven 3.9.0. Are there any example projects or docs for the new features of Maven 3.9.0?"},{"owner":{"user_id":296328,"display_name":"khmarbaise"},"edited":false,"comment_id":133064911,"body":"The concurrency is not new in Maven it exists since Maven 3.0.0 (ca. 10 years) the part in Maven 3.9.0 are some other things ... References: <a href=\"https://maven.apache.org/docs/3.9.0/release-notes.html\" rel=\"nofollow noreferrer\">maven.apache.org/docs/3.9.0/release-notes.html</a>"},{"owner":{"user_id":296328,"display_name":"khmarbaise"},"edited":false,"comment_id":133065050,"body":"If you have special questions please subscribe to the user mailing <a href=\"https://maven.apache.org/mailing-lists.html\" rel=\"nofollow noreferrer\">maven.apache.org/mailing-lists.html</a> .... Also use really the most recent version of Maven (3.9.0) because the error messages implying you are using an older version (aether-imple-1.7.XX) ..."},{"owner":{"user_id":927493,"display_name":"J Fabian Meier"},"edited":false,"comment_id":133074124,"body":"@khmarbaise I meant concurrent access to the local repository, which is a rather new feature."},{"owner":{"user_id":852569,"display_name":"Fabrizio Giudici"},"edited":false,"comment_id":133855400,"body":"I&#39;m interested in Maven 3.9 for the same reason. Did you try 3.9.1 and check whether the wrong behaviour was a bug that has been fixed?"}],"answers":[{"owner":{"user_id":20533909,"display_name":"grzegorzgrzegorz"},"up_vote_count":1,"is_accepted":false,"creation_date":1676045673,"answer_id":75413569,"body":"<p>I think it is bad idea to let maven do the concurrency on any level. There are reasons like:</p>\n<ul>\n<li>high risk of failure</li>\n<li>unclear pipeline feedback</li>\n</ul>\n<p>You want the opposite: stable tests and clear results and you don't have time for playing around and experimenting. Let the testing of new Maven features be done by other people.</p>\n<p>So you should move all the concurrency you need from Maven to pipeline itself as much as you can:</p>\n<ul>\n<li>if you need concurrent builds, create separate jobs</li>\n<li>if there is common maven repository, you just have to create separate Maven repository for each of them (this is painful only for the 1. time, after this Maven uses update policy so repo updates are cheap); alternatively, you would have to run jobs in the sequence</li>\n<li>if you need to build multimodule project, do not let Maven do it, but split it in the pipeline so that each parent module is run as separate stage (one maven invocation for one parent module)</li>\n<li>do not let Maven run build and test at one go: split building and testing to separate stages so that you have artifacts after build phase. These artifacts should be reused then in all later stages which do all the testing etc.\n(remember you just need POMs and artifacts in all testing stages - code is not needed anymore)\netc.</li>\n</ul>\n<p>So to sum up, do not give Maven to much work to do, but cut it into small pieces. I think you should not go in the direction you are describing.</p>\n"}],"owner":{"user_id":19448783,"display_name":"HHHHNNNNNNIIIII"},"view_count":123,"up_vote_count":4,"answer_count":1,"score":4,"creation_date":1676016558,"question_id":75408417,"body":"<p>I'm recently building a CI system, where several project will be <strong>build concurrently with shared local repository</strong>. And several error occurs.</p>\n<p>To find solution and make it simple, I wrote a script to <strong>simulate situation of concurrent build across several Maven processes</strong> locally on mac os, like this.</p>\n<pre class=\"lang-bash prettyprint-override\"><code>task(){\n    cd &quot;$1&quot;; pwd;\n    mvn -gs /Users/xx/settings-pre.xml clean package -Dmaven.repo.local=/Users/xx/.m2/repository -DskipTests -e -U\n}\n\n## clean local repo before concurrent build\nrm -rf /Users/xx/.m2/repository\n\n## set maven env\nsource  ~/newwork/script/set_maven_3.5.0.sh\n\n## I've got 10 project with same code in current dir\n## so mvn clean package will be executed in project1, project2.... project10\nfor d in ./*/;  do\n    ## task will be exec concurrently\n    task &quot;$d&quot; &amp;\ndone\n</code></pre>\n<p>I've tried Takari extensionï¼ˆhttp://takari.io/book/30-team-maven.html) with Maven-3.5.0, and concurrent build failed.\n<a href=\"https://i.stack.imgur.com/bJ8bq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bJ8bq.png\" alt=\"error log\" /></a></p>\n<p>I've tried Maven-3.9.0 with named lock(<a href=\"https://maven.apache.org/resolver/maven-resolver-named-locks/index.html\" rel=\"nofollow noreferrer\">https://maven.apache.org/resolver/maven-resolver-named-locks/index.html</a>) but still failed.</p>\n<pre><code>mvn -gs /Users/ninan/work/apache-maven-3.8.5/conf/settings-pre.xml clean package -Dmaven.repo.local=/Users/ninan/.m6/repository -DskipTests -e -U -Daether.syncContext.named.factory=file-lock -Daether.syncContext.named.nameMapper=file-gav -Daether.syncContext.named.time=120\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/To87M.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/To87M.png\" alt=\"error log\" /></a></p>\n<p>1 I wonder if there is something wrong with my local test method, like I use named lock in the wrong way etc.</p>\n<p>2 If not, what I can do to fix tis problem.</p>\n<p>Thanks.</p>\n"},{"tags":["java","file"],"comments":[{"owner":{"user_id":2851311,"display_name":"hfontanez"},"edited":false,"comment_id":132485334,"body":"Iâ€™m voting to close this question because it is off topic for Stack Overflow, but also off topic for the options under Stack Exchange network."},{"owner":{"user_id":1553851,"display_name":"shmosel"},"edited":false,"comment_id":132485424,"body":"@hfontanez Why? Seems like a reasonable question to me. Although why-based questions often drift into opinion territory, this was clearly a deliberate decision that served a specific purpose."},{"owner":{"user_id":2851311,"display_name":"hfontanez"},"edited":false,"comment_id":132485557,"body":"@shmosel It is a reasonable question. I never said it wasn&#39;t. But I don&#39;t think it belongs here. I have seen other similarly reasonable questions being shut down for being &quot;off topic&quot;. So, I exercised my judgment and did what I think is right. Notice that I didn&#39;t downvote the question. I do not operate that way."},{"owner":{"user_id":507738,"display_name":"MC Emperor"},"edited":false,"comment_id":132485719,"body":"I think this question should be left open, for the reason mentioned by shmosel. The JavaDocs suggest that this was not a kind of &quot;because the API authors designed it this way&quot;, but it rather suggests that this was a deliberate choice."},{"owner":{"user_id":992484,"display_name":"MadProgrammer"},"edited":false,"comment_id":132486326,"body":"@shmosel I think when it comes to &quot;api design choices&quot; like this - unless it&#39;s clearly documented, it begins to reach into the area of &quot;opinion&quot; - I tend to agree, while it&#39;s a reasonable question, I&#39;m not convinced it&#39;s within scope for SO.  When you have a look at the source code, there is no explanation of &quot;why&quot;, so unless we happen to have the original author(s) of the code, we can only &quot;guess&quot; at the reasoning"}],"answers":[{"owner":{"user_id":14947702,"display_name":"BlockManBlue"},"up_vote_count":0,"is_accepted":false,"creation_date":1673383017,"answer_id":75075565,"body":"<p>Likely a limitation that was on older hardware or an older version of an operating system Java works on. You might be able to go around the limitation by putting a space after the prefix to make it longer, like this:</p>\n<pre><code>File tempFile = File.createTempFile(&quot;te &quot;, &quot;.tmp&quot;);\n</code></pre>\n<p>However, I have not used <code>File.createTempFile()</code> before, only creating permanent files, such as:</p>\n<pre><code>File file = new File(&quot;te.tmp&quot;);\nfile.createNewFile();\n</code></pre>\n<p>And I have had no reason to make a file shorter than 3 characters, so I don't know whether or not it would work with a permanent file. Let me know if this helps.</p>\n"}],"owner":{"user_id":3870761,"display_name":"sergioFC"},"view_count":168,"up_vote_count":5,"answer_count":1,"score":4,"creation_date":1673382090,"question_id":75075412,"body":"<p>According to <a href=\"https://docs.oracle.com/javase/8/docs/api/java/io/File.html#createTempFile-java.lang.String-java.lang.String-\" rel=\"nofollow noreferrer\">java.io.File.createTempFile</a>, the prefix to create a temp file must be at least 3 characters long. Why does java API have this restriction? See following javadoc (emphasis mine)</p>\n<blockquote>\n<p>public staticÂ FileÂ <strong>createTempFile(StringÂ prefix, StringÂ suffix) throws IOException</strong></p>\n<p>Creates an empty file in the default temporary-file directory, using the given prefix and suffix to generate its name. Invoking this method is equivalent to invoking createTempFile(prefix,Â suffix,Â null).</p>\n<p>The Files.createTempFile method provides an alternative method to create an empty file in the temporary-file directory. Files created by that method may have more restrictive access permissions to files created by this method and so may be more suited to security-sensitive applications.</p>\n<p>Parameters:</p>\n<p><strong>prefix - The prefix string to be used in generating the file's name; must be at least three characters long</strong></p>\n<p>suffix - The suffix string to be used in generating the file's name; may be null, in which case the suffix &quot;.tmp&quot; will be used</p>\n<p>Returns: An abstract pathname denoting a newly-created empty file</p>\n<p>Throws: <strong>IllegalArgumentException - If the prefix argument contains fewer than three characters</strong></p>\n<p>IOException - If a file could not be created</p>\n<p>SecurityException - If a security manager exists and its SecurityManager.checkWrite(java.lang.String) method does not allow a file to be created</p>\n</blockquote>\n<p>For example this prefix is invalid as it has only two characters</p>\n<pre><code>// Throws IllegalArgumentException: Prefix string &quot;te&quot; too short: length must be at least 3\nFile tempFile = File.createTempFile(&quot;te&quot;, &quot;.tmp&quot;);\n</code></pre>\n<p>While this prefix is valid because it has 4 characters:</p>\n<pre><code>// Creates temp file test14287484991844360415.tmp\nFile tempFile = File.createTempFile(&quot;test&quot;, &quot;.tmp&quot;);\n</code></pre>\n<p>The new java API (<a href=\"https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#createTempFile-java.lang.String-java.lang.String-java.nio.file.attribute.FileAttribute...-\" rel=\"nofollow noreferrer\">java.nio.file.Files.createTempFile</a>) does not have this restriction, and works whit prefix shorter than 3 characters, so what is the reason why the old java File API requires prefix to be at least three characters long?</p>\n"},{"tags":["java","java-stream"],"comments":[{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134486124,"body":"Can you find the documentation that says the map function needs to be called? This is why you don&#39;t use side effects in your streams."},{"owner":{"user_id":1762224,"display_name":"Mr. Polywhirl"},"edited":false,"comment_id":134486164,"body":"I get &quot;1, 2, 3, 3&quot; as output."},{"owner":{"user_id":589259,"display_name":"Maarten Bodewes"},"edited":false,"comment_id":134486185,"body":"@Mr.Polywhirl Probably depends on the compiler / JIT you&#39;re running it on. This is due to an optimization."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134488592,"body":"@MaartenBodewes itâ€™s a well known optimization of the Stream API implementation introduced in Java 9 and <i>the</i> canonical example of why programmers should make no assumptions about the evaluation of intermediate operations. Since it was expected that developers get surprised, <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/stream/Stream.html#count()\" rel=\"nofollow noreferrer\">the documentation</a> even mentions this. No JIT magic involved."},{"owner":{"user_id":589259,"display_name":"Maarten Bodewes"},"edited":false,"comment_id":134488651,"body":"Well, it makes sense in functional programming (which the Stream API basically implements). However, I can imagine that it still wrong-foot users of Java, which are used to more OO / procedural ways of handling things. Just skipping over methods that introduce side effects is <i>generally</i> not how Java works. Or used to work anyway."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134499869,"body":"@MaartenBodewes imperative code continues to work as it used to do. The Stream API is specifically for specifying an operation in a functional/declarative way and accepting that there is less control over the evaluation. The problem here is not that the implementation skips over a method with side effects <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/stream/package-summary.html#SideEffects\" rel=\"nofollow noreferrer\">but that this function has a side effect to begin with</a>. Loops still exists and are neither deprecated nor discouraged; they are still the preferred approach for side effects."},{"owner":{"user_id":589259,"display_name":"Maarten Bodewes"},"edited":false,"comment_id":134500513,"body":"Uh, that&#39;s what I said right? Yes, when using Stream API, assume &amp; use functional programming."}],"answers":[{"owner":{"user_id":345130,"display_name":"ILya Cyclone"},"up_vote_count":8,"is_accepted":true,"creation_date":1684240803,"answer_id":76263132,"body":"<p>Streams are <em>lazy</em> and <em>smart</em>. Since your terminal operation is <code>count</code>, which does not care of individual elements, but only of their number, <code>map</code> isn't called.<br />\nReplace <code>count</code> with something that would need to calculate individual elements, like <code>sum</code> - and <code>map</code> will be called.</p>\n<pre class=\"lang-java prettyprint-override\"><code>Long x = Stream.of(1, 2, 3).map(i -&gt; {\n            System.out.println(i);\n            return i + 4;\n        })\n        .mapToLong(Long::valueOf)\n        .sum(); // prints 1 2 3\n\n        System.out.println(x); // prints 18\n</code></pre>\n<p>Also a person in comments rightfully reminds you side effects.</p>\n"},{"owner":{"user_id":4712734,"display_name":"DuncG"},"up_vote_count":10,"is_accepted":false,"creation_date":1684240941,"answer_id":76263150,"body":"<p>The javadoc for <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/stream/Stream.html#count()\" rel=\"noreferrer\">count()</a> has note that:</p>\n<blockquote>\n<p>An implementation may choose to not execute the stream pipeline (either\nsequentially or in parallel) if it is capable of computing the count\ndirectly from the stream source. In such cases no source elements will\nbe traversed and no intermediate operations will be evaluated.</p>\n</blockquote>\n"},{"owner":{"user_id":1097125,"display_name":"J.K"},"up_vote_count":1,"is_accepted":false,"creation_date":1684241632,"answer_id":76263247,"body":"<p>Directly calling count actually not helps to run the map. but if we try to call the <code>toList</code> and <code>Size</code> for the count. seems working for me.</p>\n<pre class=\"lang-java prettyprint-override\"><code>Integer x = Stream.of(1, 2, 3).map(i -&gt; {\n                    System.out.println(i);\n                    return i + 4;\n                })\n                .toList().size();\n</code></pre>\n"}],"owner":{"user_id":1498827,"display_name":"microwth"},"view_count":99,"up_vote_count":4,"accepted_answer_id":76263132,"answer_count":3,"score":3,"creation_date":1684239809,"question_id":76263013,"body":"<p>As simple as:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.util.stream.*;\n\npublic class MyClass {\n  public static void main(String args[]) {\n    Long x = Stream.of(1, 2, 3).map(i -&gt; {\n      System.out.println(i);\n      return i + 4;\n    }).count();\n\n    System.out.println(x); // prints '3'\n  }\n}\n</code></pre>\n<p>The <code>count()</code> here is used in order to trigger the intermediate operations which include <code>System.out.println(i)</code>, but nothing gets printed from inside <code>map()</code>. Why is that?</p>\n"},{"tags":["java","datetime","java-time","localdatetime","java.time.instant"],"comments":[{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132776241,"body":"There really isnâ€™t much good use for <code>LocalDateTime</code>. I think I have always preferred <code>ZonedDateTime</code> because it makes time zone explicit, contrary to <code>LocalDateTime</code>. For one case where you <i>do</i> need a <code>LocalDateTime</code> see <a href=\"https://stackoverflow.com/questions/64545555/storing-appointments-in-a-sql-database-such-as-postgres-for-use-with-java-time-f\">Storing appointments in a SQL database such as Postgres for use with java.time framework</a>."}],"answers":[{"owner":{"user_id":22656,"display_name":"Jon Skeet"},"up_vote_count":9,"is_accepted":true,"creation_date":1674723037,"answer_id":75243899,"body":"<blockquote>\n<p>And <code>LocalDateTime</code> represents a point in time, encoded as date and time in the JVM local timezone.</p>\n</blockquote>\n<p>No, that's not true. Regardless of the &quot;encoded as&quot; part (which I highly doubt, but which I don't have significant knowledge of to disprove), a <code>LocalDateTime</code> does <em>not</em> represent a point in time. It represents a local date/time, without reference to a specific time zone. Any given <code>LocalDateTime</code> occurs at different points in time in different time zones.</p>\n<p>Currently the local date and time in the Europe/London time zone is 2023-01-26T08:50. The <em>same point in time</em> in (say) America/New_York would result in a different <code>LocalDateTime</code>. Whereas in America/New_York, the <code>LocalDateTime</code> of 2023-01-26T08:50 occurs as a different point in time.</p>\n<p>For some <code>LocalDateTime</code> / time zone combinations, there may be zero or two corresponding points in time - for example, the <code>LocalDateTime</code> 2022-11-06T01:30 will occur in America/New_York at both 2022-11-06 05:30:00Z and 2022-11-06 06:30:00Z.</p>\n<p>Hopefully this is sufficient evidence that a <code>LocalDateTime</code> really <em>isn't</em> a point in time...</p>\n"},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"up_vote_count":5,"is_accepted":false,"creation_date":1674723068,"answer_id":75243903,"body":"<p>A LocalDateTime represents a date and time without time zone information. It is used to represent &quot;local time&quot; (as an example for me, right now the local time is 2023-01-26 09:50). An Instant is always at UTC (example, the time right now is 2023-01-26 08:50 UTC). To transform between an Instant and what the observer considers to be local time, you need to know the ZoneId of the location of the observer (e.g. for me Europe/Amsterdam), otherwise you cannot derive a local time.</p>\n<p>And to be clear, a LocalDateTime does not represent a point in time (that is what Instant is for). To expand my example, for me the local time 2023-01-26 09:50 is now past, while for Jon Skeet (in Europe/London), that local time will happen in slightly less than an hour).</p>\n"},{"owner":{"user_id":19835740,"display_name":"Daxelarne"},"up_vote_count":1,"is_accepted":false,"creation_date":1674723071,"answer_id":75243905,"body":"<p><code>.ofInstant()</code> is there to specify the instant and timezone.</p>\n<p>If you don't want to specify the time zone and instant  you can use <code>.now()</code> wich will use the local date and time.</p>\n<p>If you want to specify the instant but not the ZoneId you can use <code>ZomeId.systemDefault()</code>.</p>\n"},{"owner":{"user_id":1712135,"display_name":"deHaar"},"up_vote_count":1,"is_accepted":false,"creation_date":1674724885,"answer_id":75244197,"body":"<p>An <code>Instant</code> is independent from time zones or offsets, but a <code>LocalDateTime</code> is not. Although it does not have a <code>ZoneId</code> or <code>ZoneOffset</code>, it's values are partially based on the offset the specific zone currently has.</p>\n<p>Here's a code example with different zones that lead to different values of the very same <code>Instant</code>:</p>\n<pre><code>public static void main(String[] args) throws DateTimeParseException {\n    // example instant (see output)\n    var instant = Instant.now();\n    // get the instant with different time zones\n    var ldtBerlin = LocalDateTime.ofInstant(instant, ZoneId.of(&quot;Europe/Berlin&quot;));\n    var ldtCanberra = LocalDateTime.ofInstant(instant, ZoneId.of(&quot;Australia/Canberra&quot;));\n    var ldtKolkata = LocalDateTime.ofInstant(instant, ZoneId.of(&quot;Asia/Kolkata&quot;));\n    var ldtLA = LocalDateTime.ofInstant(instant, ZoneId.of(&quot;America/Los_Angeles&quot;));\n    // print all the results\n    System.out.println(&quot;Instant &quot; + instant.toEpochMilli() + &quot; in different zones:&quot;);\n    System.out.println(ldtBerlin + &quot; (Berlin)&quot;);\n    System.out.println(ldtCanberra + &quot; (Canberra)&quot;);\n    System.out.println(ldtKolkata + &quot; (Kolkata)&quot;);\n    System.out.println(ldtLA + &quot; (Los Angeles)&quot;);\n}\n</code></pre>\n<p>Output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>Instant 1674724841016 in different zones:\n2023-01-26T10:20:41.016228 (Berlin)\n2023-01-26T20:20:41.016228 (Canberra)\n2023-01-26T14:50:41.016228 (Kolkata)\n2023-01-26T01:20:41.016228 (Los Angeles)\n</code></pre>\n<p>View the different values, those are the local dates and times of the zones, but a <code>LocalDateTime</code> does not have any! You can use other objects, like <code>ZonedDateTime</code> (has zone and offset) and <code>OffsetDateTime</code> (has offset). Both of them have a method <code>toLocalDateTime()</code>, in case you need a <code>LocalDateTime</code> later onâ€¦</p>\n"}],"owner":{"user_id":11019740,"display_name":"Mike"},"view_count":265,"up_vote_count":4,"accepted_answer_id":75243899,"answer_count":4,"score":3,"creation_date":1674722718,"question_id":75243843,"body":"<p>In Java,</p>\n<ul>\n<li>If <code>Instant</code> represents a point in time, encoded as date and time in\nUTC.</li>\n<li>And <code>LocalDateTime</code> represents a point in time, encoded as date and time in the JVM local timezone.</li>\n</ul>\n<p>Why then does <code>LocalDateTime.ofInstant()</code> require a <code>ZoneId</code> as a second argument ?</p>\n<p>This makes <code>LocalDateTime</code> not only confusing and potentially incorrect, but also makes it identical to <code>ZonedDateTime</code>; because the timezone of <code>LocalDateTime</code> can be any timezone just like <code>ZonedDateTime</code>.</p>\n"},{"tags":["java","spring","kotlin","gradle","spring-initializr"],"answers":[{"owner":{"user_id":7713562,"display_name":"zawarudo"},"up_vote_count":0,"is_accepted":false,"creation_date":1680102864,"answer_id":75879126,"body":"<p>I assume that you are using some kind of IDE, Eclipse or IntelliJ, or whatever. How IDE works is that it is an isolated ecosystem with already predefined JDK/JRE.</p>\n<p>I know for a fact when you install a new Eclipse and if you</p>\n<ol>\n<li><p>Right-click on your project</p>\n</li>\n<li><p>Properties</p>\n</li>\n<li><p>Java Build Path</p>\n</li>\n<li><p>Libraries Tab</p>\n</li>\n<li><p>Click on JRE System Library</p>\n</li>\n<li><p>Click on Edit</p>\n</li>\n<li><p>Installed JRE</p>\n</li>\n</ol>\n<p>In that window, Eclipse will have one of the latest JDKs set as a default, which has nothing to do with the JDK that you have installed on your system.\nSo for example, if you downloaded the latest Eclipse it will have the latest JDK set there that is part of Eclipse, and that is the value that needs to be deleted, and you explicitly set JDK that you want to use, that is 17 in your example.\nThe same goes for the IDE compiler version, you also need to check if it has the correct value, which is 17 in your example.</p>\n<p>Eclipse has Installed JRE and Java Compiler, IntelliJ has SDKs and Java Compiler.</p>\n<p>As of IntelliJ places for JDK</p>\n<ol>\n<li><p>File &gt; Settings &gt; Build &gt; Compiler &gt; Java Compiler</p>\n</li>\n<li><p>File &gt; Project Settings &gt; SDK and Language level should be 17</p>\n</li>\n<li><p>File &gt; Project Settings &gt; Modules &gt; Dependencies tab should have 17 on top</p>\n</li>\n<li><p>File &gt; Project Settings &gt; Modules &gt; Sources tab should have 17 on top â€“</p>\n</li>\n</ol>\n<p>Also please keep in mind that you also need to make sure that you have JDK17 in your pom/gradle file as well.</p>\n"},{"owner":{"user_id":16682019,"display_name":"Julius Babies"},"up_vote_count":6,"is_accepted":true,"creation_date":1680103669,"answer_id":75879255,"body":"<p>I've found the problem:\nMy Gradle settings were trying to use Java 20.\nI solved it by clicking on Gradle -&gt; the little cogwheel -&gt; Gradle Settings and setting Gradle JVM to 17.</p>\n"},{"owner":{"user_id":17621695,"display_name":"RaymondNoodle"},"up_vote_count":3,"is_accepted":false,"creation_date":1683430156,"answer_id":76192076,"body":"<p>I know that I am a bit late to this thread. However, I just ran into this issue, and I found that updating <code>gradle-wrapper.jar</code> solves this. I did so by running <code>./gradlew wrapper --gradle-version=8.1.1 --distribution-type=bin</code> in my project directory.</p>\n<p>Source: <a href=\"https://gradle.org/install/#helpful-information\" rel=\"nofollow noreferrer\">https://gradle.org/install/#helpful-information</a></p>\n"}],"owner":{"user_id":16682019,"display_name":"Julius Babies"},"view_count":3806,"up_vote_count":3,"accepted_answer_id":75879255,"answer_count":3,"score":3,"creation_date":1680101972,"question_id":75878942,"body":"<p>When I create a new project using the <a href=\"https://start.spring.io/\" rel=\"nofollow noreferrer\">Spring initializr</a> Gradle won't build the project. I use IntelliJ IDEA.</p>\n<p>The error message is</p>\n<pre><code>* Exception is:\norg.gradle.cache.CacheOpenException: Could not open init generic class cache for initialization script '/tmp/ijmapper.gradle' (/home/julius/.gradle/caches/7.6.1/scripts/dnnmnny7cynyzgkf00s30jlld).\n    at org.gradle.cache.internal.DefaultPersistentDirectoryStore.open(DefaultPersistentDirectoryStore.java:91)\n    ... 166+ more\nCaused by: java.lang.IllegalArgumentException: Unsupported class file major version 64\n</code></pre>\n<p>I looked it up using <a href=\"https://javaalmanac.io/bytecode/versions/\" rel=\"nofollow noreferrer\">this table</a>, it's java 20. The issue is, that I didn't select Java-20, I chose Java-17. On top of that, I'm not able to install Java-20 on my Linux machine yet.</p>\n"},{"tags":["java","java-time","milliseconds"],"comments":[{"owner":{"user_id":7034621,"display_name":"orhtej2"},"edited":false,"comment_id":133820252,"body":"You can <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/LocalDateTime.html#plus(long,java.time.temporal.TemporalUnit)\" rel=\"nofollow noreferrer\"><code>ldt.plus(1, ChronoUnit.MILLIS)</code></a>."},{"owner":{"user_id":135589,"display_name":"Jesper"},"edited":false,"comment_id":133820322,"body":"If there is such a function in later versions: No. You can look that up in the API documentation. For example <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/LocalDateTime.html\" rel=\"nofollow noreferrer\">Java SE 20 API docs for <code>LocalDateTime</code></a>."}],"answers":[{"owner":{"user_id":5645656,"display_name":"Cardinal System"},"up_vote_count":8,"is_accepted":true,"creation_date":1680008308,"answer_id":75866572,"body":"<p>Adding nanoseconds is a completely valid way of doing this. If you want a solution that is more self-explanatory, you can use <a href=\"https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html#plus-long-java.time.temporal.TemporalUnit-\" rel=\"noreferrer\"><code>LocalDateTime#plus(long, TemporalUnit)</code></a>:</p>\n<pre><code>private static final DateTimeFormatter FORMATTER = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;);\n\npublic static void main(String[] args) {\n    LocalDateTime localDateTime = LocalDateTime.parse(&quot;2022-01-01 00:00:00.123&quot;, FORMATTER);\n    localDateTime = localDateTime.plus(1L, ChronoUnit.MILLIS);\n    //         How much you are adding ^              ^ What you are adding\n\n    System.out.println(FORMATTER.format(localDateTime));\n}\n</code></pre>\n<p>The <a href=\"https://docs.oracle.com/javase/8/docs/api/java/time/temporal/TemporalUnit.html\" rel=\"noreferrer\"><code>TemporalUnit</code></a> parameter explains exactly what you are adding to the the timestamp, thus making your code more easily understandable to other programmers who may be viewing it. It also takes care of the unit conversions behind the scenes, so there is less margin for human error and your code is not cluttered with math.</p>\n"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":1,"is_accepted":false,"creation_date":1680038360,"answer_id":75871162,"body":"<p>The <a href=\"https://stackoverflow.com/a/75866572/642706\">Answer by Cardinal System</a> is correct.</p>\n<h1><code>Duration</code></h1>\n<p>An alternative is use of <code>Duration</code> class with <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/LocalDateTime.html#plus(java.time.temporal.TemporalAmount)\" rel=\"nofollow noreferrer\"><code>LocalDateTime#plus</code></a>.</p>\n<p>A <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/Duration.html\" rel=\"nofollow noreferrer\"><code>Duration</code></a> object represents a span of time not attached to the timeline, on a scale of hours, minutes, seconds, and fractional second.</p>\n<pre><code>LocalDateTime ldt = LocalDateTime.parse( &quot;2022-01-01 00:00:00.123&quot;.replace( &quot; &quot; , &quot;T&quot; ) ) ;  // Replace SPACE with `T` to comply with standard ISO 8601 format.\nDuration duration = Duration.ofMillis( 1L ) ;\nLocalDateTime later = ldt.plus( duration ) ;\n</code></pre>\n<hr />\n<p>By the way, be aware that <code>LocalDateTime</code> is inherently ambiguous. That class represents a date with a time-of-day but lacks a time zone or offset-from-UTC needed to determine a point on the timeline.</p>\n<p>For a specific point on the timeline, use <code>Instant</code>.</p>\n<pre><code>Instant instant = Instant.now() ;\nInstant later = instant.plus( duration ) ;\n</code></pre>\n<p>To see that same moment through the lens of a particular time zone, apply a <code>ZoneId</code> to get a <code>ZonedDateTime</code> object.</p>\n<pre><code>ZoneId z = ZoneId.of( &quot;Pacific/Auckland&quot; ) ;\nZonedDateTime zdt = later.atZone( z ) ;\n</code></pre>\n<p>See this code <a href=\"https://ideone.com/nat4i6\" rel=\"nofollow noreferrer\">run at Ideone.com</a>. Note the differences: (a) one millisecond later, and (b) different time-of-day &amp; different date.</p>\n<pre class=\"lang-none prettyprint-override\"><code>instant.toString(): 2023-03-29T19:12:16.727887Z\nlater.toString(): 2023-03-29T19:12:16.728887Z\nzdt.toString(): 2023-03-30T08:12:16.728887+13:00[Pacific/Auckland]\n</code></pre>\n<p>If you want only milliseconds, you can truncate to clear the microseconds &amp; nanoseconds to zero.</p>\n<pre><code>Instant trunc = instant.truncatedTo( ChronoUnit.MILLIS ) ;\n</code></pre>\n"}],"owner":{"user_id":21173249,"display_name":"goguma"},"view_count":348,"up_vote_count":3,"accepted_answer_id":75866572,"answer_count":2,"score":3,"creation_date":1680007842,"question_id":75866488,"body":"<p>I want to increase the millisecond value with LocalDateTime. I used plusNanos because I didn't have plusmillisecond.\nI wonder if this is the right way.\nI'm using JDK 1.8.\nI also want to know if there is a plus millisecond function in later versions.</p>\n<pre><code>DateTimeFormatter f = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;);\nLocalDateTime ldt = LocalDateTime.parse(&quot;2022-01-01 00:00:00.123&quot;,f);\n        \nSystem.out.println(ldt.format(f));\n        \nldt = ldt.plusNanos(1000000);\n        \nSystem.out.println(ldt.format(f));\n</code></pre>\n<pre><code>2022-01-01 00:00:00.123\n2022-01-01 00:00:00.124\n</code></pre>\n"},{"tags":["java","java-stream","lazy-evaluation"],"answers":[{"owner":{"user_id":20607467,"display_name":"ï¾“ï½·ï½¬ï¾ƒï¾ž"},"up_vote_count":7,"is_accepted":true,"creation_date":1673920302,"answer_id":75141306,"body":"<p>You can lazily evaluate by concatenating <code>Supplier&lt;List&lt;MyObject&gt;&gt;</code> instead of <code>List&lt;MyObject&gt;</code>.</p>\n<pre><code>public static Optional&lt;MyObject&gt; findTarget(String input, List&lt;MyObject&gt; myList) {\n    List&lt;Supplier&lt;List&lt;MyObject&gt;&gt;&gt; concat = List.of(() -&gt; myList, () -&gt; expensive());\n    return concat.stream()\n        .flatMap(supplier -&gt; supplier.get().stream())\n        .filter(o -&gt; o.hasName(input))\n        .findFirst();\n}\n</code></pre>\n<p>Test:</p>\n<pre><code>record MyObject(String s) {\n    public boolean hasName(String in) {\n        return s.equals(in);\n    }\n}\n\nstatic List&lt;MyObject&gt; expensive() {\n    System.out.println(&quot;expensive() called&quot;);\n    return List.of(new MyObject(&quot;z&quot;));\n}\n\npublic static void main(String[] args) {\n    List&lt;MyObject&gt; myList = List.of(new MyObject(&quot;a&quot;));\n    System.out.println(&quot;case 1: &quot; + findTarget(&quot;a&quot;, myList));\n    System.out.println(&quot;case 2: &quot; + findTarget(&quot;x&quot;, myList));\n}\n</code></pre>\n<p>Output:</p>\n<pre><code>case 1: Optional[MyObject[s=a]]\nexpensive() called\ncase 2: Optional.empty\n</code></pre>\n<p>Alternatively you can do this:</p>\n<pre><code>public static Optional&lt;MyObject&gt; findTarget(String input, List&lt;MyObject&gt; myList) {\n    return Stream.of(\n            (Supplier&lt;List&lt;MyObject&gt;&gt;) () -&gt; myList,\n            (Supplier&lt;List&lt;MyObject&gt;&gt;) () -&gt; expensive())\n        .flatMap(supplier -&gt; supplier.get().stream())\n        .filter(o -&gt; o.hasName(input))\n        .findFirst();\n}\n</code></pre>\n"},{"owner":{"user_id":525036,"display_name":"Didier L"},"up_vote_count":2,"is_accepted":false,"creation_date":1674063408,"answer_id":75163153,"body":"<p>Another alternative, which might be simpler to understand, is to extract the stream logic in a separate method:</p>\n<pre><code>private static Optional&lt;MyObject&gt; findInternal(String input, List&lt;MyObject&gt; myList) {\n    return myList.stream().filter(o -&gt; o.hasName(input)).findFirst();\n}\n</code></pre>\n<p>and then simply call it twice:</p>\n<pre><code>public static Optional&lt;MyObject&gt; findTarget(String input, List&lt;MyObject&gt; myList) {\n    return findInternal(input, myList).or(() -&gt; findInternal(input, expensive()));\n}\n</code></pre>\n"}],"owner":{"user_id":1589188,"display_name":"user1589188"},"view_count":96,"up_vote_count":3,"accepted_answer_id":75141306,"answer_count":2,"score":3,"creation_date":1673919155,"question_id":75141218,"body":"<p>I have an expensive method that I only want to call it when necessary in a stream. Here is an example:</p>\n<pre><code>public static Optional&lt;MyObject&gt; findTarget(String input, List&lt;MyObject&gt; myList) {\n    return Stream.concat(myList.stream(), expensive().stream()).filter(o -&gt; o.hasName(input)).findFirst();\n}\n</code></pre>\n<p>The goal is to find the target <code>MyObject</code> from <code>myList</code> based on the <code>input</code> value, but if its not in <code>myList</code> ONLY then it will call <code>expensive()</code> to return a bigger list and look from there.</p>\n<p>The above example does not do that, as it seems <code>Stream.concat</code> will call <code>expensive()</code> already before consuming all of <code>myList</code>.</p>\n<p>An ugly solution I can think of is to do it in two steps, e.g.:</p>\n<pre><code>return myList.stream().filter(o -&gt; o.hasName(input)).findFirst().or(\n    () -&gt; expensive().stream().filter(o -&gt; o.hasName(input)).findFirst());\n</code></pre>\n<p>But then I will have to repeat the filter and the rest twice.</p>\n<p>Is there any better solution or even a single liner of Stream that does that?</p>\n"},{"tags":["java","android","date"],"comments":[{"owner":{"user_id":2636929,"display_name":"Stultuske"},"edited":false,"comment_id":132912185,"body":"have you tried applying a dateformatter?"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132915223,"body":"I believe that the standard format in <a href=\"https://www.sqlite.org/lang_datefunc.html\" rel=\"nofollow noreferrer\">SQLite is YYYY-MM-DD</a>, also known as ISO 8601. I would certainly use it. It is also the default format for <code>LocalDate</code>, which makes it easy to format it for your user the way they prefer to see it, for example dd/mm/yyyy."}],"answers":[{"owner":{"user_id":20387575,"display_name":"John Johnson"},"up_vote_count":2,"is_accepted":false,"creation_date":1675346494,"answer_id":75324272,"body":"<p>This is how i got it to work:</p>\n<pre><code>        String sYear = String.valueOf(Year);\n        String sMonth = String.valueOf((Month + 1));\n        String sDay = String.valueOf(Day);\n\n        if (sDay.length() == 1)\n            sDay = &quot;0&quot; + sDay;\n\n        if (sMonth.length() == 1)\n            sMonth = &quot;0&quot; + sMonth;\n\n        if (sDay.length() == 1)\n            sDay = &quot;0&quot; + sDay;\n\n            date =   sDay + &quot;/&quot; + sMonth + &quot;/&quot; + sYear;\n</code></pre>\n"},{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"up_vote_count":6,"is_accepted":true,"creation_date":1675352253,"answer_id":75325498,"body":"<p>There is a better way (than what you have posted as an answer) to get the required formatted string:</p>\n<pre><code>String output = String.format(&quot;%02d/%02d/%d&quot;, day, month, year);\n</code></pre>\n<p>where <code>day</code>, <code>month</code> and <code>year</code> are integers.</p>\n<h2>Using <code>java.time</code> API:</h2>\n<pre><code>import java.time.LocalDate;\nimport java.time.format.DateTimeFormatter;\n\nclass Main {\n    public static void main(String[] args) {\n        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;dd/MM/uuuu&quot;);\n\n        // Sample units\n        int year = 2023, month = 2, day = 1;\n        LocalDate date = LocalDate.of(year, month, day);\n        String output = date.format(formatter);\n        System.out.println(output);\n    }\n}\n</code></pre>\n<p><strong>Output</strong>:</p>\n<pre><code>01/02/2023\n</code></pre>\n<p><a href=\"https://ideone.com/2um1Dl\" rel=\"noreferrer\"><kbd>ONLINE DEMO</kbd></a></p>\n<p>Learn more about the modern Date-Time API from <strong><a href=\"https://docs.oracle.com/javase/tutorial/datetime/index.html\" rel=\"noreferrer\">Trail: Date Time</a></strong>.</p>\n"}],"owner":{"user_id":20387575,"display_name":"John Johnson"},"view_count":77,"up_vote_count":4,"accepted_answer_id":75325498,"answer_count":2,"score":3,"creation_date":1675345888,"question_id":75324143,"body":"<p>In my SQLite database I have my dates stored in this format 02/01/2023 but when I try to get the date from the calendarview it gives them to me as 2/1/2023 which causes me to have an error when trying to retrieve the data from the database that matches that date.</p>\n<p>How do I format this into a String variable?</p>\n<p>My attempt so far:</p>\n<pre><code>    public void onSelectedDayChange(@NonNull CalendarView calendarview, int i, int i1,int i2) {\n        exercise_name = new ArrayList&lt;&gt;();\n        set_weight = new ArrayList&lt;&gt;();\n        set_reps = new ArrayList&lt;&gt;();\n        set_date= new ArrayList&lt;&gt;();\n    //formatting to dd/mm/yyyy\n            System.out.println(&quot;both are over 10&quot;);\n            date =    i2 + &quot;/&quot; + (i1+1) + &quot;/&quot; + i;\n\n        //month needs plus 1 because it starts at 0\n        tviewdate.setText(date);\n        storeDataDateinArrays();\n</code></pre>\n"},{"tags":["java","spring-boot"],"answers":[{"owner":{"user_id":7739171,"display_name":"Sivvie Lim"},"up_vote_count":8,"is_accepted":true,"creation_date":1673400197,"answer_id":75077454,"body":"<p>You don't have to add jakarta servlet api 6.0 into the <code>pom.xml</code>.\nAccording to documentation <a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#Jakarta-EE\" rel=\"noreferrer\">here</a>, it is already included.</p>\n<p>In your code whichever is using <code>javax.servlet.http.HttpServletRequest</code>, you need to change the <code>javax</code> to <code>jakarta</code>.</p>\n<p>So the whole line will be something like this:\n<code>import jakarta.servlet.http.HttpServletRequest</code></p>\n<p>I faced this error before when I upgrade my service as well and I solved it using this way. Maybe you can try it.</p>\n<p>[EDIT]</p>\n<p>I see that one of your dependency is using the <code>javax.servlet</code>:\n<a href=\"https://mvnrepository.com/artifact/org.springframework.social/spring-social-facebook/2.0.3.RELEASE\" rel=\"noreferrer\">https://mvnrepository.com/artifact/org.springframework.social/spring-social-facebook/2.0.3.RELEASE</a></p>\n<p>And following this github, it seems this packages is no longer actively maintained and being archived, so it is likely they do not upgrade for Spring Boot 3.</p>\n<p>I would recommend find other ways to work on the social login for Facebook, maybe you can try this way?</p>\n<p><a href=\"https://www.codejava.net/frameworks/spring-boot/social-login-with-facebook-example\" rel=\"noreferrer\">https://www.codejava.net/frameworks/spring-boot/social-login-with-facebook-example</a></p>\n"},{"owner":{"user_id":2189421,"display_name":"Aparna"},"up_vote_count":0,"is_accepted":false,"creation_date":1681732733,"answer_id":76034931,"body":"<p>You can also try adding new dependencies as follows. With the below dependencies I was able to retain javax.servlet class.</p>\n<pre><code> &lt;dependency&gt;\n        &lt;groupId&gt;javax.annotation&lt;/groupId&gt;\n        &lt;artifactId&gt;javax.annotation-api&lt;/artifactId&gt;\n        &lt;version&gt;1.3.2&lt;/version&gt;\n  &lt;/dependency&gt; \n  &lt;dependency&gt;\n        &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;\n        &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;\n        &lt;version&gt;2.2.12&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt;\n        &lt;artifactId&gt;jaxb-impl&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;\n        &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;\n        &lt;version&gt;3.0.1&lt;/version&gt;\n        &lt;scope&gt;provided&lt;/scope&gt;\n    &lt;/dependency&gt; \n</code></pre>\n"}],"owner":{"user_id":16687077,"display_name":"Jason Chuang"},"view_count":4854,"up_vote_count":4,"accepted_answer_id":75077454,"answer_count":2,"score":3,"creation_date":1673399355,"question_id":75077401,"body":"<p>When I ran spring-boot-2.7, there is no issue. However when I changed code and tailored it to spring-boot-3.0, there is java.lang.ClassNotFoundException: javax.servlet.http.HttpServletRequest</p>\n<p>Could someone help me to download the source code and run on your computer? After run it, and you click &quot;Login using Facebook&quot;, you will see the exception.\n<a href=\"https://github.com/chuangtc/spring-boot-3.0-security-social-login\" rel=\"nofollow noreferrer\">https://github.com/chuangtc/spring-boot-3.0-security-social-login</a></p>\n<p>I tried adding jarkarta servlet api 6.0, but the exception is still there.</p>\n"},{"tags":["java","volatile","java-threads"],"comments":[{"owner":{"user_id":869736,"display_name":"Louis Wasserman"},"edited":false,"comment_id":134177303,"body":"<code>value = value + 1</code> requires an <code>AtomicInteger</code>, not just a volatile."},{"owner":{"user_id":592355,"display_name":"xerx593"},"edited":false,"comment_id":134177313,"body":"Hi &amp; welcome! :) ..maybe...but: <code>thread1.start();thread1.join();thread2.start();</code> <i>is sequential</i> (i.e. <i>not parallel</i>)"},{"owner":{"user_id":869736,"display_name":"Louis Wasserman"},"edited":false,"comment_id":134177413,"body":"<code>volatile</code> makes reads and writes atomic, but not their combination.  See, for example, <a href=\"https://www.scaler.com/topics/volatile-keyword-in-java/\" rel=\"nofollow noreferrer\">scaler.com/topics/volatile-keyword-in-java</a>.  Incrementing a volatile variable is <i>not</i> safe and needs a full <code>AtomicInteger</code>."},{"owner":{"user_id":16785907,"display_name":"Mihail2048"},"edited":false,"comment_id":134177765,"body":"@Louis Wasserman <code>volatile</code> is not about atomicity, do not please confuse others: <a href=\"https://stackoverflow.com/questions/19744508/volatile-vs-atomic#:~:text=Volatile%20and%20Atomic%20are%20two,on%20variables%20are%20performed%20atomically\" title=\"volatile vs atomic%23%3a%7e%3atext%3dVolatile%2520and%2520Atomic%2520are%2520two%2con%2520variables%2520are%2520performed%2520atomically\">stackoverflow.com/questions/19744508/&hellip;</a>."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134182493,"body":"Each instance of <code>MutliThreadExample</code> has its own <code>value</code>, so there is only one thread accessing it anyway; volatile isn&#39;t really necessary for your code."}],"answers":[{"owner":{"user_id":139985,"display_name":"Stephen C"},"up_vote_count":7,"is_accepted":false,"creation_date":1682232769,"answer_id":76083499,"body":"<blockquote>\n<p>Am I doing anything wrong in this ?</p>\n</blockquote>\n<p>Yes.  Multiple things.</p>\n<p>Firstly, your application is effectively single-threaded (NOT multi-threaded) because of this:</p>\n<pre><code>    thread1.start();\n    thread1.join();\n    thread2.start();\n</code></pre>\n<p>What that says is</p>\n<ol>\n<li>Start thread1</li>\n<li>Wait for thread1 to finish</li>\n<li>Start thread2.</li>\n</ol>\n<p>So thread1 and thread2 will not be running at the same time.</p>\n<p>Secondly, the threads do this:</p>\n<pre><code>    Thread.sleep(1000);\n</code></pre>\n<p>When you call <code>sleep</code>, variable values that are cached in registers, etcetera are liable to be written to main memory.  That is liable to make this code behave differently, and interfere with any observations you are attempting to make.</p>\n<p>Thirdly, they do this:</p>\n<pre><code>    System.out.println(value + &quot;-&quot; + Thread.currentThread());\n</code></pre>\n<p>In the <code>println</code> call, the I/O stack typically does some synchronization under the hood, and <em>that</em> will also interfere with the observation of <code>value</code>.  Furthermore <code>value</code> may have changed since you incremented it.</p>\n<p>Fourthly, you increment the variable like this:</p>\n<pre><code>    value = value + 1;\n</code></pre>\n<p>That is not an atomic operation, even when <code>value</code> is declared as <code>volatile</code>.  It is in fact a read operation followed by an addition followed by a write operation.  The same would be true if you wrote</p>\n<pre><code>    value++;  // or ++value;\n</code></pre>\n<p>If two threads <em>actually</em> execute these statement simultaneously, they are liable to lose an increment due to the interleaving of the read, add, write operations.</p>\n<p>(Declaring a variable as <code>volatile</code> gives a <em>happens before</em> relationship between a write of the variable by one thread a subsequent reads of the same variable by other threads.  But that is not sufficient to implement a counter that can be updated by two or more threads in a thread-safe fashion.   To do that you need to use <code>synchronized</code>, an <code>AtomicInteger</code> or equivalent.)</p>\n<p>Finally, you have declared <code>value</code> as an instance variable of <code>MutliThreadExample</code>, and <code>thread1</code> and <code>thread2</code> are different instances of that class.  That means that <code>thread1</code> and <code>thread2</code> are updating <em>different</em> <code>value</code> variables.</p>\n<hr />\n<p>In summary your code produces the same output in both versions because it is not multi-threaded.  The <code>sleep</code> and <code>println</code> calls are also liable to interfere with the &quot;observations&quot;.  And the threads are updating <em>different</em> <code>value</code> variables anyway.</p>\n<p>If you fixed all of those problems, your code is <em>not thread-safe</em>, either with the <code>volatile</code> or without it.  Neither version would be guaranteed produce either correct or incorrect answers.  They would both have non-deterministic behavior.</p>\n<p>Reliably demonstrating the effects of <code>volatile</code> is difficult.  And making basic programming mistakes doesn't help.</p>\n"}],"owner":{"user_id":21708882,"display_name":"shravan"},"view_count":86,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1682187565,"question_id":76081253,"body":"<p>I get the same output with and without the <code>volatile</code> keyword.</p>\n<p>Have I made a mistake in the code?</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class MutliThreadExample extends Thread{\n\n    volatile int value;\n    \n    public static void main(String[] args) throws InterruptedException {\n        MutliThreadExample thread1 = new MutliThreadExample();\n        MutliThreadExample thread2 = new MutliThreadExample();\n        thread1.start();\n        thread1.join();\n        thread2.start();\n    }\n\n    @Override\n    public void run() {\n        for (int i = 1; i &lt;= 5; i++) {\n            value = value + 1;\n            System.out.println(value + &quot;-&quot; + Thread.currentThread());\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n}\n</code></pre>\n<p>I am not able to use <code>volatile</code> keyword properly in Java.</p>\n"},{"tags":["java","regex","spring-boot","spring-cloud","spring-cloud-gateway"],"answers":[{"owner":{"user_id":613960,"display_name":"kishoredbn"},"up_vote_count":0,"is_accepted":false,"creation_date":1678898116,"answer_id":75747583,"body":"<p>Check the route URI configuration.</p>\n<p>You have this:</p>\n<pre><code>uri: lb://admin\n</code></pre>\n<p>chenge it to this:</p>\n<pre><code>uri: lb://\n</code></pre>\n"},{"owner":{"user_id":242587,"display_name":"stmi"},"up_vote_count":1,"is_accepted":false,"creation_date":1679393449,"answer_id":75799818,"body":"<p>The API gateway does a match on url prefix in this case <code>admin</code> and then redirects call to specified service which does a match on remaining url. <code>SpringCloudGateway</code> is unaware of internal routing of your service. You could replace <code>context-path: /admin</code> with <code>context-path: /tomato</code> and then you'd need to inlcude <code>tomato</code> in url.</p>\n<p>Solution would be to drop the <code>admin</code> prefix on the implementing service configuration. From what you've described it's intended to be used via API Gateway anyway, so service mappings without <code>admin</code> wouldn't be accessible anyway to consumers. Since default value is <code>/</code> just remove property <code>servlet.context-path</code> from <code>application.yaml</code></p>\n<p>As per Eureka discovery your service reports its name via following\nproperties (excerpt from documentation)</p>\n<blockquote>\n<p>The default application name\n(that is, the service ID), virtual host, and non-secure port (taken\nfrom the Environment) are ${spring.application.name},\n${spring.application.name} and ${server.port}, respectively.</p>\n</blockquote>\n<p><a href=\"https://cloud.spring.io/spring-cloud-netflix/multi/multi__service_discovery_eureka_clients.html\" rel=\"nofollow noreferrer\">https://cloud.spring.io/spring-cloud-netflix/multi/multi__service_discovery_eureka_clients.html</a></p>\n"},{"owner":{"user_id":2165146,"display_name":"muhammed ozbilici"},"up_vote_count":0,"is_accepted":false,"creation_date":1679779726,"answer_id":75844623,"body":"<p>You are having that issue because you have specified <code>/**</code> as the path predicate which means any path that matches <code>/**</code> will be forwarded to the admin service, including the <code>/admin</code> prefix.</p>\n<p>Modify your configuration to include the /admin prefix in the path predicate.</p>\n<pre><code>spring:\n  application:\n    name: gateway\n  cloud:\n    gateway:\n      discovery:\n        locator:\n          enabled: true\n          lower-case-service-id: true\n      routes:\n        - id: admin_route\n          uri: lb://admin\n          predicates:\n            - Path=/admin/**\n</code></pre>\n<p>Now requests to <code>http://localhost:&lt;GATEWAY_PORT&gt;/admin/system/employee/check</code> will be forwarded to <code>http://localhost:&lt;ADMIN_PORT&gt;/system/employee/check</code>. The <code>/admin</code> prefix will be trimmed before the request is forwarded to the admin service.</p>\n"},{"owner":{"user_id":16237195,"display_name":"Hazhir Ahmadzadeh"},"up_vote_count":4,"is_accepted":false,"creation_date":1679824792,"answer_id":75847019,"body":"<p>Firstly, you should alter the name of your admin service in both the <code>pom.xml</code> and <code>application.yml</code> files. Consider choosing a name like <code>admin-service</code> or something distinct from the name <code>admin</code>.</p>\n<p>After you have made this change, you should update the service name in the gateway to match the new name you have chosen for the admin service. By doing so, you will ensure that the predicate and service uri are distinct from one another.</p>\n<p>Once you have made these changes, your gateway should be able to successfully route requests.</p>\n<h5>admin service application.yml:</h5>\n<pre class=\"lang-yaml prettyprint-override\"><code>    spring:\n      application:\n        name: admin-service\n</code></pre>\n<h5>gateway service application.yml:</h5>\n<pre class=\"lang-yaml prettyprint-override\"><code>    spring:\n      application:\n        name: gateway\n      cloud:\n        gateway:\n          discovery:\n            locator:\n              enabled: true\n              lower-case-service-id: true\n          routes:\n            - id: admin_route\n            uri: lb://admin-service\n            predicates:\n              - Path=/admin/**\n</code></pre>\n"},{"owner":{"user_id":11762199,"display_name":"mhrsalehi"},"up_vote_count":3,"is_accepted":true,"creation_date":1679848401,"answer_id":75849090,"body":"<p>the culprit is this config:</p>\n<pre><code>  cloud:\n    gateway:\n      discovery:\n        locator:\n          enabled: true\n</code></pre>\n<p>from <a href=\"https://cloud.spring.io/spring-cloud-gateway/multi/multi__configuration.html#_discoveryclient_route_definition_locator\" rel=\"nofollow noreferrer\">docs</a>:</p>\n<blockquote>\n<p>8.2 DiscoveryClient Route Definition Locator The Gateway can be configured to create routes based on services registered with a\nDiscoveryClient compatible service registry.</p>\n<p>To enable this, set\nspring.cloud.gateway.discovery.locator.enabled=true and make sure a\nDiscoveryClient implementation is on the classpath and enabled (such\nas Netflix Eureka, Consul or Zookeeper).</p>\n<p>8.2.1 Configuring Predicates and Filters For DiscoveryClient Routes By default the Gateway defines a single predicate and filter for routes\ncreated via a DiscoveryClient.</p>\n<p>The default predicate is a path predicate defined with the pattern\n/serviceId/**, where serviceId is the id of the service from the\nDiscoveryClient.</p>\n<p>The default filter is rewrite path filter with the regex\n/serviceId/(?.*) and the replacement /${remaining}. This\njust strips the service id from the path before the request is sent\ndownstream.</p>\n</blockquote>\n<p>so when you call the following URL:</p>\n<pre><code>http://localhost:&lt;GATEWAY_PORT&gt;/admin/system/employee/check \n</code></pre>\n<p>the gateway rewrite the path to <code>/system/employee/check</code>, because <code>admin</code> is the service name.</p>\n<p>when you call :</p>\n<pre><code>http://localhost:&lt;GATEWAY_PORT&gt;/admin/admin/system/employee/check \n</code></pre>\n<p>the gateway rewrite the path to <code>/admin/system/employee/check</code>, which is the correct one.</p>\n"}],"owner":{"user_id":7189597,"display_name":"Sobhan"},"view_count":332,"up_vote_count":3,"accepted_answer_id":75849090,"answer_count":5,"score":3,"creation_date":1678546003,"question_id":75705715,"body":"<p>I'm trying to implement a <code>API-Gateway</code> service over our project using <code>Spring-Cloud-Gateway</code>.</p>\n<p>Consider that I have a service named <code>admin</code> and I'm trying to configure it's route as below:</p>\n<pre><code>spring:\n  application:\n    name: gateway\n  cloud:\n    gateway:\n      discovery:\n        locator:\n          enabled: true\n          lower-case-service-id: true\n      routes:\n        - id: admin_route\n          uri: lb://admin\n          predicates:\n            - Path=/admin/**\n</code></pre>\n<p>It compiles successfully but there is just a problem!!</p>\n<p>I have an API on <code>admin</code> service with a URL like below that works fine without a gateway:</p>\n<pre><code>http://localhost:&lt;ADMIN_PORT&gt;/admin/system/employee/check\n</code></pre>\n<p>But when I want to call this API through <code>gateway</code> service, I have to duplicate the <code>admin</code> in the URL, like below, so that it works fine:</p>\n<pre><code>http://localhost:&lt;GATEWAY_PORT&gt;/admin/admin/system/employee/check \n</code></pre>\n<p>Does anybody have any idea or clue how to resolve this issue?</p>\n<p>Any help would be appreciated!!</p>\n<p><strong>Note: Spring-Boot 2.7.0,\nSoring-Cloud 2021.0.3,\nJava 1.8</strong></p>\n<p>******************** UPDATE ************************</p>\n<p>I have set <code>servlet-context-path</code> and <code>apllication.name</code> in admin's <code>application.yml</code> as below:</p>\n<pre><code>spring:\n  application:\n    name: admin\nserver:\n  port: &lt;ADMIN_PORT&gt;\n  servlet:\n    context-path: /admin\n</code></pre>\n<p>I think that it is the reason why I need to duplicate the service name in the URL, But I couldn't find any configuration on <code>SpringCloudGateway</code> related to this topic!!</p>\n<p>******************** ATTENTION ************************</p>\n<p>I am not allowed to remove <code>servlet-context-path</code> which has been set to <code>/admin</code> from admin's <code>application.yml</code>, because I need them to call my services internally without getting help from <code>Gateway</code>!!</p>\n<p>So I need the following URL:</p>\n<pre><code>http://localhost:&lt;GATEWAY_PORT&gt;/admin/system/employee/check\n</code></pre>\n<p>to be routed to the following address:</p>\n<pre><code>http://localhost:&lt;ADMIN_PORT&gt;/admin/system/employee/check\n</code></pre>\n<p>without <code>/admin</code> getting removed after routing!!</p>\n<p>Still, any help would be appreciated!!! :))</p>\n"},{"tags":["java","datetime","timezone-offset","datetimeoffset"],"comments":[{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132841526,"body":"Do you know whether thatâ€™s a message from <a href=\"https://github.com/policeman-tools/forbidden-apis/wiki\" rel=\"nofollow noreferrer\">forbidden-apis</a>? It could sound like it."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132841558,"body":"I strongly recommend you donâ€™t use <code>SimpleDateFormat</code>, <code>Date</code>, <code>Calendar</code> and<code>TimeZone</code>. Those classes are troublesome and long outdated. Use <code>Instant</code>, <code>ZoneOffset</code> and <code>OffsetDateTime</code> from <a href=\"https://docs.oracle.com/javase/tutorial/datetime/index.html\" rel=\"nofollow noreferrer\">java.time, the modern Java date and time API</a>."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132843972,"body":"If you meant to ask for a <code>java.util.Date</code> with the format you mentioned, that is neither possible nor what you should want. Use a date-time object (for example an <code>OffsetDateTime</code>, not a <code>Date</code> as I said) to hold a <i>value</i>. When you need to give output in a specific format, use a formatter for formatting that value into a <code>String</code> in the desired format. As an aside only, <code>Instant.toString()</code> prints in that format, <code>OffsetDateTime.toString()</code> will if the offset is 0; <code>Date.toString()</code> <i>never</i> will."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132846373,"body":"Is the UTC offset always a whole number of hours? Could it be for example +5:30 or +5:45?"}],"answers":[{"owner":{"user_id":17795888,"display_name":"Chaosfire"},"up_vote_count":4,"is_accepted":false,"creation_date":1675069486,"answer_id":75282167,"body":"<p>I would suggest to move away from the legacy API (java.util.Date, java.util.Calendar, etc.), it is cumbersome and error prone. Since java 8 the modern date-time API, <a href=\"https://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html\" rel=\"nofollow noreferrer\">java.time</a>, is available. With it the task would be quite trivial.</p>\n<pre><code>String date = &quot;2023-01-09T23:51:44.595Z&quot;;\nOffsetDateTime oldDateTime = OffsetDateTime.parse(date);\nSystem.out.println(&quot;old - &quot; + oldDateTime);\nZoneOffset offset = ZoneOffset.ofHours(6);\nOffsetDateTime newDateTime = oldDateTime.withOffsetSameInstant(offset);\nSystem.out.println(&quot;new - &quot; + newDateTime);\n</code></pre>\n<p>Prints time - <code>2023-01-10T05:51:44.595+06:00</code>.</p>\n<p>Note that it ends with <code>+06:00</code>, not <code>Z</code>. <code>Z</code> at the end of a date-time string means <code>Zulu</code>, which indicates that the time is in UTC - <a href=\"https://stackoverflow.com/questions/27840670/what-is-the-z-ending-on-date-strings-like-2014-01-01t000000-588z\">What is the Z ending on date strings like 2014-01-01T00:00:00.588Z</a>. Since resulting time is UTC + 6 hours, a date sting <code>2023-01-10T05:51:44.595Z</code> would be <strong>incorrect</strong>.</p>\n"},{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"up_vote_count":3,"is_accepted":false,"creation_date":1675085218,"answer_id":75285083,"body":"<h2>java.time</h2>\n<p>The <code>java.util</code> date-time API and their corresponding parsing/formatting type, <code>SimpleDateFormat</code> are outdated and error-prone. In March 2014, the <a href=\"https://www.oracle.com/technical-resources/articles/java/jf14-Date-Time.html\" rel=\"nofollow noreferrer\">modern Date-Time API</a> was released as part of the <strong>Java 8 standard library</strong> which supplanted the legacy date-time API and since then it is strongly recommended to switch to <code>java.time</code>, the modern date-time API.</p>\n<h2>Solution using <code>java.time</code></h2>\n<ol>\n<li><code>java.time</code> API is based on <a href=\"https://en.wikipedia.org/wiki/ISO_8601\" rel=\"nofollow noreferrer\">ISO 8601</a> and therefore you do not need a <code>DateTimeFormatter</code> to parse a date-time string which is already in ISO 8601 format e.g. your date-time string, <code>2023-01-09T23:51:44.595Z</code> which can be directly parsed into an <code>OffsetDateTime</code>.</li>\n<li>Your offset string is not in the ISO 8601 standard format. The standard format is <code>+/-HH:mm:ss</code> or <code>Z</code> which refers to <code>+00:00</code> offset. In most cases, you will see <code>+/-HH:mm</code> e.g. <code>+06:00</code>. You can choose any basic string manipulation technique to get the hours and minutes from your string and create a <code>ZoneOffset</code> instance using them. I have used one which I have found easy to do.</li>\n</ol>\n<p>The rest of the code is straightforward.</p>\n<p><strong>Demo:</strong></p>\n<pre><code>import java.time.OffsetDateTime;\nimport java.time.ZoneOffset;\n\nclass Main {\n    public static void main(String[] args) {\n        String strDateTime = &quot;2023-01-09T23:51:44.595Z&quot;;\n        String utcOffset = &quot;UTC +6&quot;;\n        int offsetHour = Integer.parseInt(utcOffset.replaceAll(&quot;[^0-9+-]&quot;, &quot;&quot;));\n        ZoneOffset zoneOffset = ZoneOffset.ofHours(offsetHour);\n        OffsetDateTime odtGiven = OffsetDateTime.parse(strDateTime);\n        OffsetDateTime odtDesired = odtGiven.withOffsetSameLocal(zoneOffset)\n                                        .withOffsetSameInstant(zoneOffset.UTC);\n        System.out.println(odtDesired);\n    }\n}\n</code></pre>\n<p><strong>Output</strong>:</p>\n<pre><code>2023-01-09T17:51:44.595Z\n</code></pre>\n<p>Note that <code>2023-01-10T05:51:44.595Z</code> does not make sense without am/pm marker as you mean <code>05:51:44.595 pm</code>. You can use a <code>DateTimeFormatter</code> to format the above output in your desired way.</p>\n<p><a href=\"https://ideone.com/l2YdsV\" rel=\"nofollow noreferrer\"><kbd>ONLINE DEMO</kbd></a></p>\n<p>Learn more about the modern Date-Time API from <strong><a href=\"https://docs.oracle.com/javase/tutorial/datetime/index.html\" rel=\"nofollow noreferrer\">Trail: Date Time</a></strong>.</p>\n<hr />\n<p>I liked the alternative way <a href=\"https://stackoverflow.com/questions/75280511/date-conversion-add-utcoffset-to-existing-timezone/75285083?noredirect=1#comment132847275_75285083\">suggested by Ole V.V.</a> to parse the offset string. Given below is the solution based on his suggestion:</p>\n<pre><code>class Main {\n    public static void main(String[] args) {\n        String strDateTime = &quot;2023-01-09T23:51:44.595Z&quot;;\n        String utcOffset = &quot;UTC +6&quot;;\n        DateTimeFormatter offsetFormatter = new DateTimeFormatterBuilder()\n                                            .appendLiteral(&quot;UTC &quot;)\n                                            .appendOffset(&quot;+H:mm&quot;, &quot;+0&quot;)\n                                            .toFormatter(Locale.ROOT);\n        ZoneOffset zoneOffset = offsetFormatter.parse(utcOffset, ZoneOffset::from);\n        // Rest of the lines are the same as the above code\n    }\n}\n</code></pre>\n<p><a href=\"https://ideone.com/8WZj5C\" rel=\"nofollow noreferrer\"><kbd>ONLINE DEMO</kbd></a></p>\n"}],"owner":{"user_id":19106386,"display_name":"Shilpa HM"},"view_count":102,"up_vote_count":3,"answer_count":2,"score":3,"creation_date":1675056076,"question_id":75280511,"body":"<p>I have date which is in the format of(example) Date = 2023-01-09T23:51:44.595Z\nand I have utcOffset String utcOffset = &quot;UTC +6&quot;</p>\n<p>I want output as 2023-01-10T05:51:44.595Z in Date format.</p>\n<p>How to achieve this??</p>\n<p>I should add UTC offset to existing date.</p>\n<p>Tried this:</p>\n<pre><code>public static void main(String[] args) throws ParseException {\n        String rawDate = &quot;2023-01-09T23:51:44.595Z&quot;;\n        String utcOffset = &quot;UTC +6&quot;;\n\n        SimpleDateFormat formatter = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;, Locale.ROOT);\n        Date date = (Date) formatter.parse(rawDate);\n        SimpleDateFormat formatter1 = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;, Locale.ROOT);\n        String v = formatter1.format(date);\n        System.out.println(&quot;Original raw date::::::::::&quot;+v);\n        \n        System.out.println(&quot;utcOffset::::::::::&quot;+utcOffset);\n\n        Date triggerTime = date;\n        String onlyHoursAndMin = StringUtils.strip(utcOffset, &quot;UTC &quot;);\n\n        String[] split = onlyHoursAndMin.split(&quot;:&quot;);\n        int hours = Integer.parseInt(&quot;0&quot;);\n        int minutes = Integer.parseInt(&quot;0&quot;);\n        if (split.length == 2) {\n            hours = Integer.parseInt(split[0]);\n            minutes = Integer.parseInt(split[1]);\n        } else if (split.length == 1) {\n            hours = Integer.parseInt(split[0]);\n            minutes = Integer.parseInt(&quot;0&quot;);\n        }\n\n        TimeZone timeZone = TimeZone.getTimeZone(&quot;UTC&quot;);\n        Calendar calendar = Calendar.getInstance(timeZone);\n        calendar.setTime(triggerTime);\n        calendar.add(Calendar.HOUR_OF_DAY, hours);\n        calendar.add(Calendar.MINUTE, minutes);\n        Date s = calendar.getTime();\n        \n        SimpleDateFormat utcFormatter1 = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;, Locale.ROOT);\n        String newDate = utcFormatter1.format(s);\n        System.out.println(&quot;Date in string format::::::::::::::&quot;+newDate);\n        \n        SimpleDateFormat format1 = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;, Locale.ROOT);\n        SimpleDateFormat format2 = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;, Locale.ROOT);\n        Date aaa = format1.parse(newDate);\n        String bbb = format2.format(aaa);\n        System.out.println(&quot;:::::::::::::&quot;+aaa);\n        System.out.println(&quot;Date in correct format::::::::::::::&quot;+format2.format(aaa));\n        \n    }\n</code></pre>\n<p>but finale Date format is Tue Jan 10 05:51:44 IST 2023 which is not expected.</p>\n<p>and when build I am getting below error as well:\nForbidden method invocation: java.util.Calendar#getInstance(java.util.TimeZone) [Uses default locale or time zone]</p>\n"},{"tags":["java"],"answers":[{"owner":{"user_id":6198203,"display_name":"Ashikur2146"},"up_vote_count":1,"is_accepted":false,"creation_date":1673077458,"answer_id":75038822,"body":"<p>Compiler understands the scope of the class Super is within the AccessModifierTest, but compiler does not know a callee method of any class without the reference. This is how oop based languages are designed to work. The main benefit is that compiler can remove the method call ambiguity through this.</p>\n<p>So when a private constructor is called within a class scope compiler understands where it is coming from, but any other method requires the object reference to access.</p>\n<p>to make your code work you need to use the reference super.setN(5) to make it work.</p>\n"},{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":6,"is_accepted":true,"creation_date":1673084950,"answer_id":75039384,"body":"<p>Just like the superclass constructor, <code>setN</code> is perfectly <em>accessible</em> in <code>Sub</code>. This is because, as your linked Q&amp;A explained, <code>private</code> members declared in an inner class are accessible everywhere as long as you are inside the top-level class. So the problem is somewhere else.</p>\n<p>If you are using IntelliJ, the error message it gives is &quot;<code>setN</code> has private access...&quot;, which is more useful and lets you fix the error immediately (and <code>setN</code> being private also plays a role as you will see). But <code>javac</code>'s error message, &quot;cannot find symbol <code>setN</code>&quot;, shows that <strong>this isn't actually about accessibility</strong>, and that the compiler can't actually find <code>setN</code>.</p>\n<p>According to the <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-6.html#jls-6.5.7.1\" rel=\"noreferrer\">spec</a>, a simple method name like <code>setN</code></p>\n<blockquote>\n<p>consists of a single UnqualifiedMethodIdentifier which specifies the name of the method to be invoked. The rules of method invocation require that the UnqualifiedMethodIdentifier denotes a method that is in scope at the point of the method invocation.</p>\n</blockquote>\n<p><code>setN</code> is actually not in scope in the constructor of <code>Sub</code>. The scope of <code>setN</code> is only <code>Super</code>. See also <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-6.html#jls-6.3\" rel=\"noreferrer\">Scope of a Declaration</a> in the spec.</p>\n<p>But doesn't <code>Sub</code> inherit <code>setN</code> from <code>Super</code>? Well, it doesn't. <code>private</code> members are not inherited. See <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-8.html#jls-8.4.8\" rel=\"noreferrer\">this section</a> for the conditions for inheritance.</p>\n<blockquote>\n<p>A class C inherits from its direct superclass type D all concrete\nmethods m (both static and instance) for which all of the following\nare true:</p>\n<ul>\n<li><p>m is a member of D.</p>\n</li>\n<li><p>m is public, protected, or declared with package access in the same\npackage as C.</p>\n</li>\n<li><p>No method declared in C has a signature that is a subsignature\n(Â§8.4.2) of the signature of m as a member of D.</p>\n</li>\n</ul>\n</blockquote>\n<p>If you use another form (instead of a simple name) to refer to <code>Super.setN</code>, like <code>super.setN(5);</code>, or <code> ((Super)this).setN(5);</code> then it can compile just fine.</p>\n<p>For why these work, see the <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-15.html#jls-15.12.1\" rel=\"noreferrer\">compile-time step 1</a> of processing a method call, where the compiler determines in which type it should search for a method declaration. If the type to search is <code>Super</code>, then it would compile, because <code>Super</code> actually has the <code>setN</code> method, whereas <code>Sub</code> does not inherit it from <code>Super</code>, so does not have it as a member.</p>\n<p>Note that constructor calls and method calls are treated completely separately by the language spec and they have <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-8.html#jls-8.8.7.1\" rel=\"noreferrer\">completely different rules</a>. The <code>super();</code> syntax is essentially &quot;hardcoded&quot; into the language - there is no &quot;scope&quot; or &quot;names&quot; of a constructor or anything like that. The constructor just has to be accessible for you to call it.</p>\n"}],"owner":{"user_id":589554,"display_name":"coder"},"view_count":85,"up_vote_count":3,"accepted_answer_id":75039384,"answer_count":2,"score":3,"creation_date":1673076220,"question_id":75038724,"body":"<p>The following constellation:</p>\n<pre><code>public class AccessModifierTest {\n\n  private static class Super {\n    private int n = 3;\n\n    private Super() {}\n\n    private void setN(int n) {\n      this.n = n;\n    }\n  }\n\n  private static class Sub extends Super {\n    private Sub() {\n      super(); // invoking private ctor is permitted\n      // setN(5); but invoking private method is not permitted, why?\n      // super.setN(5); this is fine too\n    }\n  }\n\n  public static void main(String[] args) {\n    Super superInstance = new Sub();\n  }\n\n}\n</code></pre>\n<p>The private ctor of Sub is allowed to invoke the private ctor of Super.</p>\n<p>Why this is ok, is answered here:\n<a href=\"https://stackoverflow.com/questions/12542193/scope-of-private-constructor-in-nested-class\">scope of private constructor in Nested Class</a></p>\n<p>Because of this, shouldn't it be also fine to invoke the private method setN in the ctor of Sub?</p>\n<p>Why is this not legal?</p>\n"},{"tags":["java","generics"],"answers":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":2,"is_accepted":true,"creation_date":1682684360,"answer_id":76129514,"body":"<p>The case of <code>method3</code> is not similar to the case of <code>method2</code> at all. Namely, there are no <a href=\"https://stackoverflow.com/q/2770321/5133585\">raw types</a> involved when calling <code>method3</code>. <code>DerivedClass</code> in <code>DerivedClass.class</code> is a raw type.</p>\n<p>It <em>would</em> be similar if you return a raw <code>DerivedClass</code> in the supplier:</p>\n<pre><code>final var m5 = method3(arg, () -&gt; new DerivedClass());\n\n// this doesn't compile, for the same reason as in the method2 case\ns = m5.getSomething();\n</code></pre>\n<p>The type argument for <code>method2</code> <em>cannot</em> be inferred as <code>DerivedClass&lt;T&gt;</code>, because then the second parameter (<code>arg2</code>) would be of type <code>Class&lt;? extends DerivedClass&lt;T&gt;&gt;</code>, but you are passing a <code>Class&lt;DerivedClass&gt;</code> to it.</p>\n<p>It's like assigning a <code>Class&lt;DerivedClass&gt;</code> to <code>Class&lt;? extends DerivedClass&lt;T&gt;&gt;</code> variable:</p>\n<pre><code>// this does not compile either\nClass&lt;? extends DerivedClass&lt;T&gt;&gt; x = DerivedClass.class;\n</code></pre>\n<p>This doesn't compile because the raw <code>DerivedClass</code> is not a subtype of <code>DerivedClass&lt;T&gt;</code>. In fact, if you look at <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-4.html#jls-4.10.2\" rel=\"nofollow noreferrer\">section 4.10.2</a> of the JLS, <code>DerivedClass</code> is a direct <em>supertype</em> of <code>DerivedClass&lt;T&gt;</code>.</p>\n<blockquote>\n<p>Given a generic class or interface <code>C</code> with type parameters F1,...,Fn (n &gt; 0), the direct supertypes of the parameterized type <code>C&lt;T1,...,Tn&gt;</code>, where each of Ti (1 â‰¤ i â‰¤ n) is a type, are all of the following:</p>\n<ul>\n<li><p>[...]</p>\n</li>\n<li><p>The raw type <code>C</code>.</p>\n</li>\n</ul>\n</blockquote>\n<p>Therefore, the type parameter of <code>method2</code> is inferred as the raw <code>DerivedClass</code>. This works for <code>arg1</code> too, as the generic <code>DerivedClass&lt;T&gt;</code> is a subtype of the raw <code>DerivedClass</code>.</p>\n<p>That said, <a href=\"https://stackoverflow.com/q/2390662/5133585\">it is not possible to get a <code>Class&lt;DerivedClass&lt;T&gt;&gt;</code></a> unless you do unchecked casts.</p>\n<p>Now you might be wondering how this assignment works if <code>method2</code> returns a raw <code>DerivedClass</code>, but you are assigning it to <code>DerivedClass&lt;T&gt;</code>:</p>\n<pre><code>final DerivedClass&lt;T&gt; m4 = BaseClass.method2(arg, DerivedClass.class);\n</code></pre>\n<p>This works because in assignment contexts just are <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-5.html#jls-5.2\" rel=\"nofollow noreferrer\">specified</a> to work like this. The important sentence is:</p>\n<blockquote>\n<p>If, after the conversions listed above have been applied, the resulting type is a raw type (Â§4.8), an unchecked conversion (Â§5.1.9) may then be applied.</p>\n</blockquote>\n<p>There is an implicit unchecked conversion here converting <code>DerivedClass</code> to <code>DerivedClass&lt;T&gt;</code>. This is also why you get the warning.</p>\n"},{"owner":{"user_id":112968,"display_name":"knittl"},"up_vote_count":4,"is_accepted":false,"creation_date":1682684761,"answer_id":76129568,"body":"<p>Because both <code>BaseClass</code> and <code>DerivedClass</code> are generic classes, but <code>DerivedClass.class</code> is a raw type (namely <code>Class&lt;DerivedClass&gt;</code> and not <code>Class&lt;DerivedClass&lt;T&gt;&gt;</code>).</p>\n<p><code>var</code> is inferred to be the raw type and your statement is identical to:</p>\n<pre><code>final DerivedClass m2 = method2(arg, DerivedClass.class);\n</code></pre>\n<p>Once you use raw types, all generic information is &quot;lost&quot;/erased and you have to deal with plain <code>Object</code>s.</p>\n<p><code>this.&lt;DerivedClass&lt;T&gt;&gt;method2(arg, DerivedClass.class)</code> should make <code>m2</code> generic again (but you probably still have the unchecked cast warning, just for the argument).</p>\n<p>And it's exactly this &quot;unchecked assignment&quot; that's causing the issues (unchecked from the raw type to the generic closed type).</p>\n"}],"owner":{"user_id":852569,"display_name":"Fabrizio Giudici"},"view_count":82,"up_vote_count":3,"accepted_answer_id":76129514,"answer_count":2,"score":3,"creation_date":1682682861,"question_id":76129388,"body":"<p>I'd like to resolve a dubious point that has been affecting some parts of my code for years â€” it is fixed with a trivial cast, but now I'd like to understand the rationale behind it and possibly a reference in official specifications.</p>\n<p>Let me introduce this piece of code:</p>\n<pre><code>import java.util.function.Supplier;\n\nclass BaseClass&lt;T, R&gt; {\n  R getSomething() { return null; }\n  static &lt;U&gt; U method1 (final U arg1) { return arg1; }\n  static &lt;U&gt; U method2 (final U arg1, final Class&lt;? extends U&gt; arg2) { return arg1; }\n  static &lt;U&gt; U method3 (final U arg1, final Supplier&lt;? extends U&gt; arg2) { return arg1; }\n}\n</code></pre>\n<p>Now let me have a subclass with a partial generics binding (<code>T</code> is still unbound):</p>\n<pre><code>class DerivedClass&lt;T&gt; extends BaseClass&lt;T, String&gt; {\n  private String s;\n\n  void test (final DerivedClass&lt;T&gt; arg) {\n    final var m1 = method1(arg);\n    s = m1.getSomething();\n\n    final DerivedClass&lt;T&gt; m3 = method1(arg);\n    s = m3.getSomething();\n\n    final var m2 = method2(arg, DerivedClass.class);\n    // 1. ERROR: requires String, found Object\n    s = m2.getSomething();\n\n    // 2. WARNING: unchecked assignment DerivedClass to DerivedClass&lt;T&gt;\n    final DerivedClass&lt;T&gt; m4 = method2(arg, DerivedClass.class);\n    s = m4.getSomething();\n\n    final var m5 = method3(arg, () -&gt; new DerivedClass&lt;&gt;());\n    s = m5.getSomething();\n    } \n}\n</code></pre>\n<p>With <code>method1</code> everything is fine and the returned object carries the binding <code>R</code> -&gt; <code>String</code>. In other words, the <code>U</code> type of <code>arg1</code> is correctly propagated to the result.</p>\n<p>With <code>method2</code> the binding is lost (and &quot;downgraded&quot; to <code>Object</code>): this ends up in a warning if I force things with an explicit type declaration of <code>m4</code> (of course an explicit cast would work too) and an error if I use <code>var</code>.</p>\n<p>With <code>method3</code>, in spite of <code>arg2</code> being declared in a similar way as in <code>method2</code>, everything is fine again.</p>\n<p>So it seems that the culprit is the presence of an argument of <code>Class&lt;&gt;</code> type. Why? In general, why doesn't the compiler use <code>arg1</code> for a complete match even when there is a <code>Class&lt;&gt;</code> parameter?</p>\n<p>As far as I can remember this happens since Java 5 (of course the portions with <code>var</code> refer to Java 17).</p>\n"},{"tags":["java","lambda","method-reference"],"comments":[{"owner":{"user_id":3499626,"display_name":"jhamon"},"edited":false,"comment_id":134205868,"body":"<a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html#apply-T-\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/8/docs/api/java/util/function/&hellip;</a>"},{"owner":{"user_id":16320675,"display_name":"user16320675"},"edited":false,"comment_id":134205985,"body":"<code>Function.apply()</code> is non-<code>static</code> 1-parameter method, so it needs an instance to run; but <code>Function::apply</code> is not providing such instance, so needs an additional argument when called, meaning it is equivalent to a 2-parameter function (first argument will be <code>this</code>) || <code>BiFunction&lt;T, U, R&gt; function = Function::apply</code> ~= <code>(T t, U u) -&gt; t.apply(u)</code> returning type <code>R</code> ( if I am correct, in this specific case: <code>(Consumer&lt;String&gt; t, String u) -&gt; t.apply(s)</code> )"}],"answers":[{"owner":{"user_id":16775102,"display_name":"Feel free"},"up_vote_count":1,"is_accepted":false,"creation_date":1682407849,"answer_id":76098623,"body":"<p><code>Function::apply</code> is a method reference that refers to the apply method of the Function interface in the line <code>Seq s1 = seq.zip(split, Function::apply)</code>. It serves as the second argument to the zip method, which requires a <code>BiFunction</code> functional interface and anticipates one that accepts two arguments of types <code>T</code> and <code>U</code> and returns a result of type <code>R</code>.</p>\n<p>In this instance, <code>T</code> is an <code>UnaryOperator&lt;String&gt;</code> (from <code>Seq&lt;UnaryOperator&lt;String&gt;&gt; seq)</code>, <code>U</code> is a String (from <code>List&lt;String&gt; split</code>), and <code>R</code> is a String when the zip method is executed. Because <code>String::apply</code> has the same signature as the apply method of the Function interface, which accepts a single argument of type String and returns a String, it is used as a reference to the <code>Function::apply</code> method.</p>\n<p>The seq sequence of functions will be applied to each element of the split list by the zip method as iterates over the split list's elements. The apply method of the Function interface will be used to apply each <code>UnaryOperator&lt;String&gt;</code> in seq to the corresponding String element in the split.</p>\n"},{"owner":{"user_id":2411243,"display_name":"Zabuzard"},"up_vote_count":5,"is_accepted":true,"creation_date":1682408045,"answer_id":76098657,"body":"<h2>Non-static method reference</h2>\n<p>This is indeed an interesting one, as it uses one of the <em>special rules</em> that method references allow for.</p>\n<p>Quick example, suppose you demand a <code>Function&lt;String, Integer&gt;</code>, then one could write <code>String::length</code>, eventhough this method has a different signature. The requested signature is:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Integer apply(String x) { ... }\n</code></pre>\n<p>but we supplied a method that only has <code>int length()</code>, so no <code>String</code> argument at all. However, that method is non-static and operates on instances of <code>String</code>. So Java can assume you meant to call that method on that instance, and by that deduce the first parameter to the method. I.e. <code>s -&gt; s.length()</code>.</p>\n<hr />\n<h2>Generic details</h2>\n<p>The same is happening in your setup. First of all, you have to understand what the generics for your requested <code>BiFunction&lt;T, U, R&gt;</code> resolve to. They are:</p>\n<ul>\n<li><code>T</code>: <code>UnaryOperator&lt;String&gt;</code></li>\n<li><code>U</code>: <code>String</code></li>\n<li><code>R</code>: <code>Consumer&lt;T&gt;</code>, so <code>Consumer&lt;UnaryOperator&lt;String&gt;&gt;</code></li>\n</ul>\n<p>Quite complex, but okay.</p>\n<h2>Actual signature</h2>\n<p>Now, the requested signature is:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Consumer&lt;UnaryOperator&lt;String&gt;&gt; apply(UnaryOperator&lt;String&gt; t, String u)\n</code></pre>\n<p>When you give your method reference <code>Function::apply</code>, whose signature is:</p>\n<pre class=\"lang-java prettyprint-override\"><code>R apply(T t)\n</code></pre>\n<p>so, in this case:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Consumer&lt;UnaryOperator&lt;String&gt;&gt; apply(String u)\n</code></pre>\n<p>Then, the first argument from the required signature (<code>UnaryOperator&lt;String&gt; t</code>) is again deducted from the fact that <code>Function::apply</code> is a non-static method that operates on the <code>Function</code> instance, which happens to be compatible with <code>UnaryOperator&lt;String&gt;</code>, since <code>UnaryOperator extends Function</code>.</p>\n<h2>Implementation</h2>\n<p>So <code>Function::apply</code> essentially is the same as implementing your <code>BiFunction</code> as:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Consumer&lt;UnaryOperator&lt;String&gt;&gt; apply(UnaryOperator&lt;String&gt; t, String u) {\n  return t.apply(u);\n}\n</code></pre>\n<p>Taking the function from the first argument and applying it to the second, returning the result.</p>\n"}],"owner":{"user_id":15578940,"display_name":"Osiris"},"view_count":76,"up_vote_count":3,"accepted_answer_id":76098657,"answer_count":2,"score":3,"creation_date":1682406035,"question_id":76098398,"body":"<p>I am confused about the following line:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Seq&lt;String&gt; s1 = seq.zip(split, Function::apply);\n</code></pre>\n<p>In this snippet:</p>\n<pre><code>static String underscoreToCamel(String str) {\n        UnaryOperator&lt;String&gt; capitalize = s -&gt; s.substring(0, 1).toUpperCase() + s.substring(1).toLowerCase();\n        \n        Seq&lt;UnaryOperator&lt;String&gt;&gt; seq = c -&gt; {\n            c.accept(String::toLowerCase);\n            while (true) {\n                c.accept(capitalize);\n            }\n        };\n        List&lt;String&gt; split = Arrays.asList(str.split(&quot;_&quot;));\n        Seq&lt;String&gt; s1 = seq.zip(split, Function::apply);\n        String a = s1.join(&quot;&quot;);\n        return a;\n    }\n\npublic interface Seq&lt;T&gt; {\n        void consume(Consumer&lt;T&gt; consumer);\n\n        static &lt;T&gt; Seq&lt;T&gt; unit(T t) {\n            return consumer -&gt; consumer.accept(t);\n        }\n\n        default &lt;E&gt; Seq&lt;E&gt; map(Function&lt;T, E&gt; function) {\n            return consumer -&gt; consume(t -&gt; consumer.accept(function.apply(t)));\n        }\n\n        default &lt;E&gt; Seq&lt;E&gt; flatMap(Function&lt;T, Seq&lt;E&gt;&gt; function) {\n            return consumer -&gt; consume(t -&gt; function.apply(t).consume(consumer));\n        }\n\n\n        default String join(String sep) {\n            StringJoiner joiner = new StringJoiner(sep);\n            consume(t -&gt; joiner.add(t.toString()));\n            return joiner.toString();\n        }\n\n        static &lt;T&gt; T stop() {\n            throw StopException.INSTANCE;\n        }\n\n        default void consumeTillStop(Consumer&lt;T&gt; consumer) {\n            try {\n                consume(consumer);\n            } catch (StopException ignore) {}\n        }\n\n        default &lt;U, R&gt; Seq&lt;R&gt; zip(Iterable&lt;U&gt; iterable, BiFunction&lt;T, U, R&gt; function) {\n            return c -&gt; {\n                Iterator&lt;U&gt; iterator = iterable.iterator();\n                consumeTillStop(t -&gt; {\n                    if (iterator.hasNext()) {\n                        c.accept(function.apply(t, iterator.next()));\n                    } else {\n                        stop();\n                    }\n                });\n            };\n        }\n\n    }\n\n</code></pre>\n<p>I do understand that <code>Function::apply</code> is a <strong>method reference</strong> and that the method wants a <code>BiFunction&lt;T, U, R&gt;</code>. But I do not get how this is compatible.</p>\n<p>What exactly does it resolve to? Why can I supply <code>Function::apply</code> in this case?</p>\n"},{"tags":["java","android","kotlin"],"comments":[{"owner":{"user_id":11002,"display_name":"tgdavies"},"edited":false,"comment_id":133612444,"body":"I&#39;d start with <code>mvn dependency:tree</code>"},{"owner":{"user_id":5354987,"display_name":"Samuel Marchant"},"edited":false,"comment_id":133612461,"body":"You have two different .jar versions configured into whatever it is that requires one of them, it&#39;s being told to load both when only one is required.! Remove one of those jars."},{"owner":{"user_id":445884,"display_name":"coder"},"edited":false,"comment_id":133650809,"body":"Thanks tgdavies but I don&#39;t have maven installed."},{"owner":{"user_id":11016652,"display_name":"zomega"},"edited":false,"comment_id":133653783,"body":"Could you please try to remove this line and see if it helps? implementation(&quot;org.jetbrains.kotlinx:kotlinx-serialization-&zwnj;&#8203;json:1.5.0&quot;)"},{"owner":{"user_id":445884,"display_name":"coder"},"edited":false,"comment_id":133659112,"body":"Thanks @zomega, I removed that but still have the same exception."}],"answers":[{"owner":{"user_id":6309,"display_name":"VonC"},"up_vote_count":6,"is_accepted":true,"creation_date":1679048372,"answer_id":75766421,"body":"<p>The reported conflict is between two versions of Kotlin standard library: <code>kotlin-stdlib-1.8.10</code> and <code>kotlin-stdlib-jdk8-1.7.201</code>.</p>\n<p>As <a href=\"https://stackoverflow.com/a/75664860/6309\">suggested here</a>, try and replace the oldest one with:</p>\n<pre class=\"lang-java prettyprint-override\"><code>// Align versions of all Kotlin components\nimplementation(platform(&quot;org.jetbrains.kotlin:kotlin-bom:1.8.0&quot;))\nimplementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.8.0&quot;\n</code></pre>\n<p>But: if you did not even include explicitly these dependencies, then <em>excluding</em> <code>kotlin-stdlib-jdk8</code> might be enough.</p>\n<p>As in this answer, add the following in <code>build.gradle</code> (<code>:app</code>)</p>\n<pre class=\"lang-java prettyprint-override\"><code>configurations.implementation {\n  exclude group: 'org.jetbrains.kotlin', module: 'kotlin-stdlib-jdk8'\n}\n</code></pre>\n"}],"owner":{"user_id":445884,"display_name":"coder"},"view_count":270,"up_vote_count":3,"accepted_answer_id":75766421,"answer_count":1,"score":3,"creation_date":1678855158,"question_id":75740619,"body":"<p>I'm building my first Android app in Android Studio and a little lost with this issue.</p>\n<p>Here's my Module build.gradle:</p>\n<pre><code>plugins {\n    id 'com.android.application'\n    id 'org.jetbrains.kotlin.android'\n    id 'com.google.devtools.ksp' version &quot;1.7.21-1.0.8&quot;\n    id 'org.jetbrains.kotlin.plugin.serialization' version '1.7.20'\n}\n\nandroid {\n    namespace 'com.myApp'\n    compileSdk 33\n\n    defaultConfig {\n        applicationId &quot;com.myApp&quot;\n        minSdk 24\n        targetSdk 33\n        versionCode 1\n        versionName &quot;1.0&quot;\n\n        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;\n        vectorDrawables {\n            useSupportLibrary true\n        }\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n    kotlinOptions {\n        jvmTarget = '1.8'\n    }\n    buildFeatures {\n        compose true\n    }\n    composeOptions {\n        kotlinCompilerExtensionVersion '1.3.2'\n    }\n    packagingOptions {\n        resources {\n            excludes += '/META-INF/{AL2.0,LGPL2.1}'\n        }\n    }\n}\n\ndependencies {\n\n    implementation 'androidx.activity:activity-compose:1.6.1'\n    implementation &quot;androidx.compose.material:material:$compose_material_version&quot;\n    implementation &quot;androidx.compose.ui:ui:$compose_ui_version&quot;\n    implementation &quot;androidx.compose.ui:ui-tooling:$compose_ui_version&quot;\n    implementation &quot;androidx.compose.ui:ui-tooling-preview:$compose_ui_version&quot;\n    implementation 'androidx.compose.material3:material3:1.0.1'\n    implementation 'androidx.core:core-ktx:1.9.0'\n    implementation 'androidx.lifecycle:lifecycle-runtime-ktx:2.6.0'\n    implementation 'androidx.lifecycle:lifecycle-viewmodel-compose:2.6.0'\n    implementation &quot;androidx.navigation:navigation-compose:2.5.3&quot;\n    // Room\n    implementation &quot;androidx.room:room-runtime:$room_version&quot;\n    testImplementation 'junit:junit:4.13.2'\n    ksp &quot;androidx.room:room-compiler:$room_version&quot;\n    implementation &quot;androidx.room:room-ktx:$room_version&quot;\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.5'\n    // Retrofit\n    implementation &quot;com.squareup.retrofit2:retrofit:2.9.0&quot;\n    // Retrofit with Scalar Converter\n    implementation &quot;com.squareup.retrofit2:converter-scalars:2.9.0&quot;\n    // Retrofit with Kotlin serialization Converter\n    implementation &quot;com.jakewharton.retrofit:retrofit2-kotlinx-serialization-converter:0.8.0&quot;\n    implementation 'com.squareup.okhttp3:okhttp:5.0.0-alpha.11'\n\n    implementation(&quot;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.0&quot;)\n}\n</code></pre>\n<p>Here's the stack:</p>\n<pre><code>Duplicate class kotlin.collections.jdk8.CollectionsJDK8Kt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.internal.jdk7.JDK7PlatformImplementations found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.internal.jdk7.JDK7PlatformImplementations$ReflectSdkVersion found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.internal.jdk8.JDK8PlatformImplementations found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.internal.jdk8.JDK8PlatformImplementations$ReflectSdkVersion found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.io.path.DirectoryEntriesReader found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.ExperimentalPathApi found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.FileVisitorBuilder found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.FileVisitorBuilderImpl found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.FileVisitorImpl found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.LinkFollowing found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathNode found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathRelativizer found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathTreeWalk found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathTreeWalk$bfsIterator$1 found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathTreeWalk$dfsIterator$1 found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathTreeWalkKt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathWalkOption found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathsKt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathsKt__PathReadWriteKt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.io.path.PathsKt__PathUtilsKt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.jdk7.AutoCloseableKt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk7-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.7.20)\nDuplicate class kotlin.jvm.jdk8.JvmRepeatableKt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.jvm.optionals.OptionalsKt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.random.jdk8.PlatformThreadLocalRandom found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.streams.jdk8.StreamsKt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.streams.jdk8.StreamsKt$asSequence$$inlined$Sequence$1 found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.streams.jdk8.StreamsKt$asSequence$$inlined$Sequence$2 found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.streams.jdk8.StreamsKt$asSequence$$inlined$Sequence$3 found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.streams.jdk8.StreamsKt$asSequence$$inlined$Sequence$4 found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.text.jdk8.RegexExtensionsJDK8Kt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\nDuplicate class kotlin.time.jdk8.DurationConversionsJDK8Kt found in modules kotlin-stdlib-1.8.10 (org.jetbrains.kotlin:kotlin-stdlib:1.8.10) and kotlin-stdlib-jdk8-1.7.20 (org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.7.20)\n</code></pre>\n"},{"tags":["java","switch-statement","switch-expression"],"comments":[{"owner":{"user_id":2636929,"display_name":"Stultuske"},"edited":false,"comment_id":133035420,"body":"in your first example, nothing is returned for Type_D, in your second example, there is still a default value returned"},{"owner":{"user_id":5558072,"display_name":"Youcef LAIDANI"},"edited":false,"comment_id":133035540,"body":"what about using default, ex <code>default -&gt; Map.of();</code>"},{"owner":{"user_id":16320675,"display_name":"user16320675"},"edited":false,"comment_id":133035555,"body":"first one is a <i>switch expression</i> (<a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-15.html#jls-15.28\" rel=\"nofollow noreferrer\">15.28. switch Expressions</a>), second a <i>switch statement</i> (<a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-14.html#jls-14.11\" rel=\"nofollow noreferrer\">14.11. The switch Statement</a>), and more <a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-15.html#jls-15.28.1-100-B\" rel=\"nofollow noreferrer\">explicitly</a>: &quot;<i>If the type of the selector expression is an enum type, then (i) the set of the case constants associated with the switch block includes every enum constant of the enum type,</i>&quot;"},{"owner":{"user_id":16320675,"display_name":"user16320675"},"edited":false,"comment_id":133035652,"body":"( in other words, an expression must always return a value [or throw an Exception]; a statement can do nothing ) ( BTW some IDEs show a warning [configurable in Eclipse] for the second case )"}],"answers":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":6,"is_accepted":true,"creation_date":1675934756,"answer_id":75396557,"body":"<p>When you use a <code>switch</code> as part of a <code>return</code>, it is a <em>switch expression</em>. But if you just put the <code>switch</code> randomly in the middle of a method, it is parsed as a <em>switch statement</em>. These have different rules. Importantly, <em>switch expressions</em> need to be exhaustive.</p>\n<p>From the <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-15.html#jls-15.28.1\" rel=\"noreferrer\">Java Language Specification</a>:</p>\n<blockquote>\n<p>If the type of the selector expression is not an enum type, then there is exactly one default label associated with the switch block.</p>\n<p>If the type of the selector expression is an enum type, then (i) the set of the case constants associated with the switch block includes every enum constant of the enum type, and (ii) at most one default label is associated with the switch block.</p>\n</blockquote>\n<p>On the other hand, <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-14.html#jls-14.11.1\" rel=\"noreferrer\">switch statements</a> do not have this restriction.</p>\n<p>Intuitively, <em>expressions</em> have to evaluate to a value, but statements don't have to. Therefore, switch expressions have to cover all cases. If they don't, then there will be situations where it can't evaluate to anything.</p>\n<p>In the <a href=\"https://docs.oracle.com/javase/specs/jls/se19/preview/specs/patterns-switch-record-patterns-jls.html#jls-14.11.1.1\" rel=\"noreferrer\">preview specifications</a> of later versions of Java, the idea of an &quot;exhaustive switch&quot; is more clearly defined, because they now need to support pattern matching among other things.</p>\n<blockquote>\n<p>The switch block of a switch expression or switch statement is exhaustive for a selector expression of type T if either (i) the switch block contains a default switch label, or (ii) the set containing all the unguarded case elements supported by switch labels in the switch block is exhaustive for T, which is specified as follows: [...]</p>\n</blockquote>\n<p>And <a href=\"https://docs.oracle.com/javase/specs/jls/se19/preview/specs/patterns-switch-record-patterns-jls.html#jls-15.28.1\" rel=\"noreferrer\">later</a>,</p>\n<blockquote>\n<p>A switch expression must be exhaustive (14.11.1.1), or a compile-time error occurs.</p>\n</blockquote>\n"}],"owner":{"user_id":548601,"display_name":"andriy"},"view_count":344,"up_vote_count":4,"accepted_answer_id":75396557,"answer_count":1,"score":3,"creation_date":1675933518,"question_id":75396340,"body":"<p>I'm developing with java 17 in IntelliJ 2022.2.</p>\n<p>In some cases <code>'switch' expression does not cover all possible input values</code> is shown, but in some not. I'd like to figure out why.</p>\n<p>Let's assume that <code>entityType</code> is an enum with 3 values and I'm adding 4th one <code>TYPE_D</code>. So  I expect to see <code>'switch' expression does not cover all possible input values</code> errors where I use this enum in <code>switch</code>.</p>\n<p>When it is shown:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public Map&lt;String, String&gt; getRecordDetails() {\n    return switch (entityType) {\n        case TYPE_A -&gt; Map.of(&quot;A&quot;,&quot;A&quot;);\n        case TYPE_B -&gt; Map.of(&quot;B&quot;,&quot;B&quot;);\n        case TYPE_C -&gt; Map.of(&quot;C&quot;,&quot;C&quot;);\n    };\n}\n</code></pre>\n<p>not shown:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public String getRecordDetails() {\n    StringBuilder stringBuilder = new StringBuilder();\n    switch (entityType) {\n        case TYPE_A -&gt; stringBuilder.append(&quot;A&quot;);\n        case TYPE_B -&gt; stringBuilder.append(&quot;B&quot;);\n        case TYPE_C -&gt; stringBuilder.append(&quot;C&quot;);\n    };\n    return stringBuilder.toString(); \n}\n</code></pre>\n<p>I see it is related when I do return of switch case, but why it is not shown when I have switch case inside of function's code?</p>\n"},{"tags":["java","kotlin"],"comments":[{"owner":{"user_id":1886904,"display_name":"egeorge"},"edited":false,"comment_id":132718413,"body":"The simple answer is because Kotlin is awesome."}],"answers":[{"owner":{"user_id":1514861,"display_name":"Ivo"},"up_vote_count":3,"is_accepted":false,"creation_date":1674482059,"answer_id":75210500,"body":"<p>I believe mutability plays an important part. The java example doesn't work because <code>List</code>s are mutable, as in, you are able to add new elements to it. If it allowed the assignment and you would add a <code>Note</code> to <code>notes</code> you run into the problem that <code>favouriteNotes</code> would contain a non-<code>FavouriteNote</code> since it refers to the same list.</p>\n<p>Kotlin's <code>emptyList</code> and <code>listOf</code> returns non-mutable lists. It allows the assignment because you can't add anything to <code>notes</code> anyway. Notice that if you change <code>notes</code>'s declaration as</p>\n<pre><code>var notes = mutableListOf&lt;Note&gt;()\n</code></pre>\n<p>you will run in the same compiler error as in Java</p>\n"},{"owner":{"user_id":506796,"display_name":"Tenfour04"},"up_vote_count":3,"is_accepted":true,"creation_date":1674482792,"answer_id":75210632,"body":"<p>For the following examples, let's introduce one more class to use:</p>\n<pre class=\"lang-java prettyprint-override\"><code>class ShortNote extends Note {\n    public ShortNote(String name) {\n        super(name);\n    }\n}\n</code></pre>\n<p>The biggest difference between Kotlin and Java generics is that Kotlin introduces <em>declaration site</em> variance for classes and interfaces. Java only has <em>use site</em> variance for classes and interfaces.</p>\n<p>The variance of variable in Java can only be declared at the use site. If you don't specifically declare a List to be covariant, it is invariant:</p>\n<pre class=\"lang-java prettyprint-override\"><code>List&lt;Note&gt; notes = new ArrayList&lt;Note&gt;();\nList&lt;FavouriteNote&gt; favouriteNotes = new ArrayList&lt;FavouriteNote&gt;();\nnotes = favouriteNotes; // error\n</code></pre>\n<p>This is the type system preventing you from making a mistake. Suppose the above code didn't throw an error. Then this could happen:</p>\n<pre class=\"lang-java prettyprint-override\"><code>List&lt;Note&gt; notes = new ArrayList&lt;Note&gt;();\nList&lt;FavouriteNote&gt; favouriteNotes = new ArrayList&lt;FavouriteNote&gt;();\nnotes = favouriteNotes; // Invalid code, but pretend compiler allows it.\nnotes.add(new ShortNote(&quot;Hello&quot;)); // Permitted, a List&lt;Note&gt; is a Note consumer and\n                                   // a ShortNote is a Note.\nFavouriteNote aFavouriteNote = favouriteNotes.get(0); // ClassCastException!\n</code></pre>\n<p>Incidentally, Kotlin's MutableList does not make use of declaration site variance, so you would have the exact same restriction:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>var notes: MutableList&lt;Note&gt; = ArrayList&lt;Note&gt;()\nvar favouriteNotes: MutableList&lt;FavoriteNote&gt; = ArrayList&lt;FavoriteNote&gt;()\nnotes = favouriteNotes // error\n</code></pre>\n<p>However, you can use use-site variance to make the cast possible. We can declare the list to be covariant at the use site:</p>\n<pre class=\"lang-java prettyprint-override\"><code>//Java\nList&lt;? extends Note&gt; notes = new ArrayList&lt;Note&gt;();\nList&lt;FavouriteNote&gt; favouriteNotes = new ArrayList&lt;FavouriteNote&gt;();\nnotes = favouriteNotes; // OK\n</code></pre>\n<pre class=\"lang-kotlin prettyprint-override\"><code>//Kotlin\nvar notes: MutableList&lt;out Note&gt; = ArrayList&lt;Note&gt;()\nvar favouriteNotes: MutableList&lt;out FavoriteNote&gt; = ArrayList&lt;FavoriteNote&gt;()\nnotes = favouriteNotes// OK\n</code></pre>\n<p>You are protected from the ClassCastException situation above because the compiler prevents you from adding items to a covariant list.</p>\n<hr />\n<p>Now getting to declaration site variance. Kotlin declares the read-only List interface's type to be <code>&lt;out T&gt;</code> right in the definition of the interface. This means all Lists are automatically assumed to be covariant, even if you don't bother to declare it to be covariant at the use site.</p>\n<p>If you declare variance at a class or interface's declaration site, the compiler will restrict you from making functions or properties that violate that variance. The read-only List interface doesn't have any <code>add</code> functions, so it is fine for it to be a <code>T</code> producer and not consumer.</p>\n"}],"owner":{"user_id":17846993,"display_name":"bighugedev"},"view_count":102,"up_vote_count":3,"accepted_answer_id":75210632,"answer_count":2,"score":3,"creation_date":1674480342,"question_id":75210169,"body":"<p>I have read topics on Generics and Wildcards in Kotlin and also their differences compared with Java, I have tried to search online, but I couldn't find the answer to this question nor make sure if anyone has asked it.</p>\n<p>I've got the class <code>Note</code> and the class <code>FavouriteNote</code>, derived from the class <code>Note</code>. I've also got an array list with type parameter <code>Note</code> and an array list with type parameter <code>FavouriteNote</code>. I'm trying to assign <code>List&lt;FavouriteNote&gt;</code> to <code>List&lt;Note&gt;</code>, which of course won't work in Java.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Main {\n    public static void main(String[] args) {\n        List&lt;Note&gt; notes = new ArrayList&lt;Note&gt;();\n        List&lt;FavouriteNote&gt; favouriteNotes = new ArrayList&lt;FavouriteNote&gt;();\n\n        notes = favouriteNotes; // this won't compile\n    }\n}\n\n\nclass Note {\n    public final String name;\n\n    public Note(String name) {\n        this.name = name;\n    }\n}\n\nclass FavouriteNote extends Note {\n    public FavouriteNote(String name) {\n        super(name);\n    }\n}\n</code></pre>\n<p>In Kotlin, though, I am free to assign <code>List&lt;FavouriteNote&gt;</code> to <code>List&lt;Note&gt;</code>:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>fun main() {\n    var notes = emptyList&lt;Note&gt;()\n    val favouriteNotes = emptyList&lt;FavouriteNote&gt;()\n\n    notes = favouriteNotes // compiles and runs successfully\n}\n\nopen class Note(val name: String)\n\nclass FavouriteNote(name: String) : Note(name)\n</code></pre>\n<p>Why is that or what can I read to learn more about how this works in Kotlin and what is happening under the hood?</p>\n"},{"tags":["java","utf-8"],"comments":[{"owner":{"user_id":2985643,"display_name":"skomisa"},"edited":false,"comment_id":132642388,"body":"A slightly simpler variation of your approach would be <code>byte[] ba = new String(new int[]{119},0, 1).getBytes();</code> (where 119 (<code>W</code>) is some arbitrary code point). I don&#39;t know if that would be more efficient than your approach, but it is certainly less elegant than the accepted answer."}],"answers":[{"owner":{"user_id":40342,"display_name":"Joachim Sauer"},"up_vote_count":6,"is_accepted":true,"creation_date":1673881524,"answer_id":75136107,"body":"<p>The most compact form I can think of is this:</p>\n<pre><code>static byte[] utf8BytesForCodePoint(int codePoint) {\n    return Character.toString(codePoint).getBytes(StandardCharsets.UTF_8);\n}\n</code></pre>\n<p>This avoids the extra steps of creating a <code>StringBuilder</code> by using <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Character.html#toString(int)\" rel=\"nofollow noreferrer\"><code>Character.toString(int codePoint)</code></a>.</p>\n"}],"owner":{"user_id":45843,"display_name":"rwallace"},"view_count":39,"up_vote_count":3,"accepted_answer_id":75136107,"answer_count":1,"score":3,"creation_date":1673880910,"question_id":75135981,"body":"<p>I need to convert a code point (supplied as an integer) to a UTF-8 byte array (probably represented as a <code>ByteArrayOutputStream</code>, unless there is a more efficient representation). A previous question asked how to do that by translating the algorithm to handwritten code, which of course would be an option, but given that the Java standard library already has the means to do it, best practice would be to try to use the standard library rather than duplicate the functionality.</p>\n<p>I know of one way to do it: <code>StringBuilder</code> <code>appendCodePoint</code> followed by <code>toString</code> to convert the code point to a string, then <code>getBytes</code> to convert to a byte array, which can then be appended to the byte output stream, for ultimate gathering up into a larger composite byte array.</p>\n<p>However, it feels like there should be a more elegant and efficient way, involving fewer steps.</p>\n<p>What is the idiomatic way to do this in Java?</p>\n"},{"tags":["java","javafx","controller"],"comments":[{"owner":{"user_id":7587451,"display_name":"Giovanni Contreras"},"edited":false,"comment_id":132326210,"body":"Does this answer your question? <a href=\"https://stackoverflow.com/questions/14187963/passing-parameters-javafx-fxml\">Passing Parameters JavaFX FXML</a>"},{"owner":{"user_id":13194694,"display_name":"Kratos"},"edited":false,"comment_id":132326240,"body":"No, it doesn&#39;t help, my problem is that i use a separate Scene Controller than usual and i don&#39;t know how to pass values through scenes"},{"owner":{"user_id":2189127,"display_name":"James_D"},"edited":false,"comment_id":132326522,"body":"You would need to define a method in <code>SceneController</code> that allows you to pass the data. Alternatively, use a <a href=\"https://stackoverflow.com/questions/32342864/applying-mvc-with-javafx\">MVC approach</a> and make the username part of the model."},{"owner":{"user_id":1155209,"display_name":"jewelsea"},"edited":false,"comment_id":132327240,"body":"Unrelated: <a href=\"https://stackoverflow.com/questions/72437983/why-should-i-avoid-using-propertyvaluefactory-in-javafx\">don&#39;t use <code>PropertyValueFactory</code></a>."}],"answers":[{"owner":{"user_id":1155209,"display_name":"jewelsea"},"up_vote_count":6,"is_accepted":true,"creation_date":1672684041,"answer_id":74985852,"body":"<p>Using the method:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/14187963/passing-parameters-javafx-fxml\">Passing Parameters JavaFX FXML</a></li>\n</ul>\n<p>In <code>SceneController.switchScene</code>, replace:</p>\n<pre><code>Parent root = FXMLLoader.load(getClass().getResource(file));\n</code></pre>\n<p>with:</p>\n<pre><code>FXMLLoader loader = new FXMLLoader(\n   getClass().getResource(\n      file\n   )\n); \n\nParent root = loader.load();\nController controller = loader.getController();\n\n// do other stuff\n\nreturn controller;\n</code></pre>\n<p>returning a <code>Controller</code> from <code>switchScene</code>.</p>\n<p>Then use it:</p>\n<pre><code>MainController mainController = (MainController)\n    sceneController.switchScene(stage, &quot;main-view.fxml&quot;);\nmainController.setLoginDetails(loginDetails);\n</code></pre>\n<p><em>Alternatives</em></p>\n<p>There are other options for doing this (some avoid the cast).</p>\n<p>For example,</p>\n<ul>\n<li>passing the login details to the switchScene method, which gets the controller from the loader and sets the login details on it, or</li>\n<li>creating the controller up front, setting the login details on it and passing the controller to the switchScene method, which sets the controller on the loader before loading, or</li>\n<li>using a controller factory mechanism like <a href=\"https://edencoding.com/dependency-injection\" rel=\"nofollow noreferrer\">this clever thing from eden</a>, or</li>\n<li>applying a <a href=\"https://stackoverflow.com/questions/32342864/applying-mvc-with-javafx\">MVC approach</a>.</li>\n</ul>\n"}],"owner":{"user_id":13194694,"display_name":"Kratos"},"view_count":115,"up_vote_count":3,"accepted_answer_id":74985852,"answer_count":1,"score":3,"creation_date":1672678544,"question_id":74985079,"body":"<p>I'm triying to make a library with login posibility and i need to know what user is logged in in all my scenes.</p>\n<p>I'm triyng to send the login details(the response from the database) from LoginController to MainController via SceneController.</p>\n<p>In SceneController I'm changing the scenes via a parameter that holds the resource file name and the current stage.</p>\n<p>LoginController.java</p>\n<pre><code>public class LoginController implements Initializable {\n    @FXML\n    private Button cancelButton;\n    @FXML\n    private Button loginButton;\n    @FXML\n    private Label loginMessageLabel;\n    @FXML\n    private TextField usernameField;\n    @FXML\n    private TextField passwordField;\n\n    public void initialize(URL url, ResourceBundle resourceBundle){\n    }\n\n    public void loginButtonOnAction(ActionEvent event){\n        if(!usernameField.getText().isBlank() &amp;&amp; !passwordField.getText().isBlank()){\n            validateLogin();\n        }else{\n            loginMessageLabel.setText(&quot;Datele introduse nu sunt corecte!&quot;);\n        }\n    }\n\n    public void cancelButtonOnAction(ActionEvent event){\n        Stage stage = (Stage) cancelButton.getScene().getWindow();\n        stage.close();\n    }\n\n    public void validateLogin(){\n        DatabaseConnection connectionNew = new DatabaseConnection();\n        Connection connectDB = connectionNew.getConnection();\n\n        String verifyLogin = &quot;SELECT count(1), id, name FROM users WHERE Username= '&quot;+usernameField.getText()+&quot;' AND Password ='&quot;+passwordField.getText()+&quot;'&quot;;\n        System.out.println(verifyLogin);\n        try{\n\n            Statement statement = connectDB.createStatement();\n            ResultSet queryResult = statement.executeQuery(verifyLogin);\n\n            while(queryResult.next()){\n\n                if(queryResult.getInt(1) == 1){\n                    Stage stage = (Stage) loginButton.getScene().getWindow();\n                    SceneController sceneController = new SceneController();\n                    sceneController.switchScene(stage, &quot;main-view.fxml&quot;);\n                }else{\n                    loginMessageLabel.setText(&quot;Datele introduse nu sunt corecte!&quot;);\n                }\n\n            }\n\n        }catch (Exception e){\n            throw new RuntimeException(&quot;unhandled&quot;, e);\n        }\n    }\n\n}\n</code></pre>\n<p>MainController.java</p>\n<pre><code>public class MainController implements Initializable {\n\n    private static String paneName;\n    private static String userId;\n    private static String defaultImagePath = &quot;C:\\\\Users\\\\costi\\\\Desktop\\\\LibraryImages\\\\&quot;;\n    private static String defaultImageName = &quot;default.png&quot;;\n    public TableView&lt;Book&gt; tableViewSearch, tableViewHome;\n    public TableColumn&lt;Book,String&gt; colSearchTitle, colHomeTitle, colSearchPublicatedOn, colHomePublicatedOn, colSearchPublishingHouse, colHomePublishingHouse, colSearchSummary, colHomeSummary;\n    public TableColumn&lt;Book,Integer&gt; colSearchPrice, colHomePrice, colSearchId, colHomeId;\n    @FXML\n    private Button cancelButton, menuHomeButton, menuSearchButton, borrowBookButton;\n    @FXML\n    private Pane paneHome, paneSearch, paneBookDetails;\n    @FXML\n    private TextField searchField, titleField, publishingHouseField, priceField, bookIdField, userIdField;\n    @FXML\n    private DatePicker publishedOnField;\n    @FXML\n    private TextArea summaryTextArea;\n    @FXML\n    private FlowPane flowPaneCoverImage;\n\n    public void initialize(URL url, ResourceBundle resourceBundle) {\n        paneHome.toFront();\n        setPaneName(&quot;paneHome&quot;);\n        setMainData();\n    }\n    public void setMainData(){\n        colHomeId.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;Id&quot;));\n        colHomeTitle.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;Title&quot;));\n        colHomePublicatedOn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;PublicatedOn&quot;));\n        colHomePublishingHouse.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;PublishingHouse&quot;));\n        colHomeSummary.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;Summary&quot;));\n        colHomePrice.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;Price&quot;));\n        HomeController homeController = new HomeController();\n        tableViewHome.setRowFactory( tv -&gt; {\n            TableRow&lt;Book&gt; row = new TableRow&lt;&gt;();\n            row.setOnMouseClicked(event -&gt; {\n                if (event.getClickCount() == 2 &amp;&amp; (! row.isEmpty()) ) {\n                    paneBookDetails.toFront();\n                    Book rowData = row.getItem();\n\n                    String date = rowData.getPublicatedOn();\n                    var dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;dd.MM.yyyy&quot;);\n                    var dateTime = LocalDate.parse(date, dateTimeFormatter);\n\n                    bookIdField.setText(Integer.toString(rowData.getId()));\n                    titleField.setText(rowData.getTitle());\n                    publishingHouseField.setText(rowData.getPublishingHouse());\n                    priceField.setText(Integer.toString(rowData.getPrice()));\n                    publishedOnField.setValue(dateTime);\n                    summaryTextArea.setText(rowData.getSummary());\n\n                    InputStream stream = null;\n                    try {\n                        stream = new FileInputStream(defaultImagePath + rowData.getCover());\n                    } catch (FileNotFoundException e) {\n                        try {\n                            stream = new FileInputStream(defaultImagePath + defaultImageName);\n                        } catch (FileNotFoundException ex) {\n                        }\n                    }\n\n                    Image image = new Image(stream);\n                    ImageView imageView = new ImageView(image);\n                    imageView.setFitHeight(flowPaneCoverImage.getHeight());\n                    imageView.setFitWidth(flowPaneCoverImage.getWidth());\n                    flowPaneCoverImage.getChildren().clear();\n                    flowPaneCoverImage.getChildren().add(imageView);\n                }\n            });\n            return row ;\n        });\n\n        tableViewHome.setItems(homeController.getBooks());\n    }\n\n    public void searchButtonOnAction(ActionEvent event) {\n        colSearchId.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;Id&quot;));\n        colSearchTitle.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;Title&quot;));\n        colSearchPublicatedOn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;PublicatedOn&quot;));\n        colSearchPublishingHouse.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;PublishingHouse&quot;));\n        colSearchSummary.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;Summary&quot;));\n        colSearchPrice.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;Price&quot;));\n        tableViewSearch.setRowFactory( tv -&gt; {\n            TableRow&lt;Book&gt; row = new TableRow&lt;&gt;();\n            row.setOnMouseClicked(ev -&gt; {\n                if (ev.getClickCount() == 2 &amp;&amp; (! row.isEmpty()) ) {\n                    paneBookDetails.toFront();\n                    Book rowData = row.getItem();\n\n                    String date = rowData.getPublicatedOn();\n                    var dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;dd.MM.yyyy&quot;);\n                    var dateTime = LocalDate.parse(date, dateTimeFormatter);\n\n                    bookIdField.setText(Integer.toString(rowData.getId()));\n                    titleField.setText(rowData.getTitle());\n                    publishingHouseField.setText(rowData.getPublishingHouse());\n                    priceField.setText(Integer.toString(rowData.getPrice()));\n                    publishedOnField.setValue(dateTime);\n                    summaryTextArea.setText(rowData.getSummary());\n\n                    InputStream stream = null;\n                    try {\n                        stream = new FileInputStream(defaultImagePath + rowData.getCover());\n                    } catch (FileNotFoundException e) {\n                        try {\n                            stream = new FileInputStream(defaultImagePath + defaultImageName);\n                        } catch (FileNotFoundException ex) {\n                        }\n                    }\n\n                    Image image = new Image(stream);\n                    ImageView imageView = new ImageView(image);\n                    imageView.setFitHeight(flowPaneCoverImage.getHeight());\n                    imageView.setFitWidth(flowPaneCoverImage.getWidth());\n                    flowPaneCoverImage.getChildren().clear();\n                    flowPaneCoverImage.getChildren().add(imageView);\n                }\n            });\n            return row ;\n        });\n        SearchController searchController = new SearchController();\n        tableViewSearch.setItems(searchController.getBooks(searchField.getText()));\n    }\n\n    public void cancelButtonOnAction(ActionEvent event){\n        Stage stage = (Stage) cancelButton.getScene().getWindow();\n        stage.close();\n    }\n\n    public void menuButtonOnAction(ActionEvent event){\n        if(event.getSource() == menuHomeButton){\n            setPaneName(&quot;paneHome&quot;);\n            paneHome.toFront();\n            setMainData();\n        }else if(event.getSource() == menuSearchButton){\n            setPaneName(&quot;paneSearch&quot;);\n            paneSearch.toFront();\n        }\n    }\n\n    public void backButtonOnAction(ActionEvent event){\n        var lastPannelName = getPaneName();\n\n        System.out.println(lastPannelName);\n\n        if(lastPannelName == &quot;paneHome&quot;){\n            paneHome.toFront();\n        }else if(lastPannelName == &quot;paneSearch&quot;){\n            paneSearch.toFront();\n        }\n    }\n\n    public void borrowBookOnAction(ActionEvent event){\n        HomeController homeController = new HomeController();\n        var currentBookId = Integer.valueOf(bookIdField.getText());\n        try {\n            homeController.borrowBook(1, 1);\n        } catch (SQLException e) {\n            throw new RuntimeException(e);\n        }\n\n        System.out.println((currentBookId));\n    }\n\n    public static String getPaneName() {\n        return paneName;\n    }\n\n    public void display(String ceva){\n        System.out.println(ceva);\n    }\n\n    public static void setPaneName(String paneName) {\n        MainController.paneName = paneName;\n    }\n\n}\n</code></pre>\n<p>SceneController.java</p>\n<pre><code>public class SceneController {\n\n    private double xOffset = 0;\n    private double yOffset = 0;\n\n    public void switchScene(Stage stage, String file) throws IOException {\n        Parent root = FXMLLoader.load(getClass().getResource(file));\n        \n        root.setOnMousePressed(new EventHandler&lt;MouseEvent&gt;() {\n            @Override\n            public void handle(MouseEvent event) {\n                xOffset = event.getSceneX();\n                yOffset = event.getSceneY();\n            }\n        });\n\n        root.setOnMouseDragged(new EventHandler&lt;MouseEvent&gt;() {\n            @Override\n            public void handle(MouseEvent event) {\n                stage.setX(event.getScreenX() - xOffset);\n                stage.setY(event.getScreenY() - yOffset);\n            }\n        });\n\n        stage.setScene(new Scene(root));\n        stage.show();\n    }\n\n}\n</code></pre>\n"},{"tags":["java","steam"],"answers":[{"owner":{"user_id":12171116,"display_name":"Broccoli_Salad"},"up_vote_count":4,"is_accepted":false,"creation_date":1683358285,"answer_id":76187662,"body":"<p>You can make default supplier that returns <code>0</code> if the group is empty.</p>\n<pre class=\"lang-java prettyprint-override\"><code>List&lt;Person&gt; users = Arrays.asList(\n    new Person(18, &quot;å¼ ä¸‰&quot;, &quot;123&quot;, 1),\n    new Person(19, &quot;æŽå››&quot;, &quot;124&quot;, 0),\n    new Person(20, &quot;çŽ‹äº”&quot;, &quot;125&quot;, 1),\n    new Person(24, &quot;å­™å…«&quot;, &quot;128&quot;, 0),\n    new Person(27, &quot;å‘¨ä¹&quot;, &quot;129&quot;, 1)\n); \n\n// Create a default Map with all possible age groups and a count of zero for each age group\nSupplier&lt;Map&lt;String, Long&gt;&gt; defaultMapSupplier = () -&gt; Stream.of(&quot;18-20&quot;, &quot;21-23&quot;, &quot;24-26&quot;, &quot;else&quot;)\n        .collect(Collectors.toMap(ageGroup -&gt; ageGroup, ageGroup -&gt; 0L));\n\nMap&lt;String, Long&gt; ageCountMap = users.stream()\n    .collect(Collectors.groupingBy(\n            u -&gt; {\n                int age = u.getAge();\n                if (age &gt;= 18 &amp;&amp; age &lt;= 20) { return &quot;18-20&quot;; }\n                else if (age &gt;= 21 &amp;&amp; age &lt;= 23) { return &quot;21-23&quot;; }\n                else if (age &gt;= 24 &amp;&amp; age &lt;= 26) { return &quot;24-26&quot;; }\n                else { return &quot;else&quot;; }\n            },\n            defaultMapSupplier,\n            Collectors.counting()\n    ));\n</code></pre>\n"},{"owner":{"user_id":6771202,"display_name":"Sachintha Hewawasam"},"up_vote_count":1,"is_accepted":true,"creation_date":1683360513,"answer_id":76187812,"body":"<p>You can initialize the HashMap with the desired age groups and their counts set to zero.</p>\n<pre><code>    Map&lt;String, Long&gt; group2 = new HashMap&lt;&gt;();\n    group2.put(&quot;18-20&quot;, 0L);\n    group2.put(&quot;21-23&quot;, 0L);\n    group2.put(&quot;24-26&quot;, 0L);\n    group2.put(&quot;else&quot;, 0L);\n\n    // Update the age group counts using the users list\n    Map&lt;String, Long&gt; ageGroupCounts = users.stream()\n        .collect(Collectors.groupingBy(u -&gt; {\n            int age = u.getAge();\n            if (age &gt;= 18 &amp;&amp; age &lt;= 20) {\n                return &quot;18-20&quot;;\n            } else if (age &gt;= 21 &amp;&amp; age &lt;= 23) {\n                return &quot;21-23&quot;;\n            } else if (age &gt;= 24 &amp;&amp; age &lt;= 26) {\n                return &quot;24-26&quot;;\n            } else {\n                return &quot;else&quot;;\n            }\n        }, Collectors.counting()));\n\n    // Merge the initialized HashMap with the age group counts from the users list\n    group2.forEach((key, value) -&gt; ageGroupCounts.merge(key, value, Long::sum));\n</code></pre>\n"}],"owner":{"user_id":15045091,"display_name":"johnson"},"view_count":107,"up_vote_count":3,"accepted_answer_id":76187812,"answer_count":2,"score":3,"creation_date":1683356518,"question_id":76187552,"body":"<p>I want to return the age group, or zero if there is no age, but the hashMap key simply does not show the age 21-23 when there is no age</p>\n<pre class=\"lang-java prettyprint-override\"><code>List&lt;Person&gt; users = Arrays.asList(\n    new Person(18, &quot;å¼ ä¸‰&quot;, &quot;123&quot;, 1),\n    new Person(19, &quot;æŽå››&quot;, &quot;124&quot;, 0),\n    new Person(20, &quot;çŽ‹äº”&quot;, &quot;125&quot;, 1),\n    new Person(24, &quot;å­™å…«&quot;, &quot;128&quot;, 0),\n    new Person(27, &quot;å‘¨ä¹&quot;, &quot;129&quot;, 1)\n); \nMap&lt;String, Long&gt; group2 = users.stream()\n    .collect(Collectors.groupingBy(u -&gt; {\n            int age = u.getAge();\n            if (age &gt;= 18 &amp;&amp; age &lt;= 20) { \n                return &quot;18-20&quot;; \n            } else if (age &gt;= 21 &amp;&amp; age &lt;= 23) { \n                return &quot;21-23&quot;; \n            } else if (age &gt;= 24 &amp;&amp; age &lt;= 26) {\n                return &quot;24-26&quot;; \n            } else {\n                 return &quot;else&quot;; \n            }\n        }), Collectors.counting());\n</code></pre>\n"},{"tags":["java","javafx","installation","sdk"],"comments":[{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134302712,"body":"The only way to do that is to use a JDK that already bundles JavaFX. I think Azul and BellSoft Liberica do so. You can&#39;t just put JavaFX into a JDK yourself (though I&#39;m not sure trying to use JavaFX from jshell makes much sense TBH)."},{"owner":{"user_id":2423906,"display_name":"SedJ601"},"edited":false,"comment_id":134303235,"body":"<a href=\"https://openjfx.io/openjfx-docs/\" rel=\"nofollow noreferrer\">openjfx.io/openjfx-docs</a>"},{"owner":{"user_id":2189127,"display_name":"James_D"},"edited":false,"comment_id":134305309,"body":"@MarkRotteveel &quot;You can&#39;t just put JavaFX into a JDK yourself&quot;; you essentially can do this with <code>jlink</code>. (It doesn&#39;t put JavaFX into an existing JDK, but can create a new one.)"},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134312290,"body":"@James_D You&#39;re right, I entirely forgot about that scenario."}],"answers":[{"owner":{"user_id":2189127,"display_name":"James_D"},"up_vote_count":5,"is_accepted":true,"creation_date":1683038876,"answer_id":76156106,"body":"<p>For this part of your question:</p>\n<blockquote>\n<p>What I am trying to find out is, is there any way I can install the JavaFX SDK so that it is merged with the Java SDK directory and saves me having to use the flags whenever I want to compile/run a program that requires any modules from JavaFX?</p>\n</blockquote>\n<p>you can use <code>jlink</code>, which generates a custom runtime image. In order to include services in the generated runtime image, use the <code>--bind-services</code> option. For reasons I don't quite understand, to include <code>jshell</code> in this, you must explicitly add the <code>jdk.jshell</code> module (simply using <code>--add-modules ALL-MODULE-PATH</code> will not work). So you need something like:</p>\n<pre><code>jlink --module-path $PATH_TO_FX --add-modules javafx.controls,javafx.fxml,jdk.jshell --bind-services --output JavaWithFX\n</code></pre>\n<p>to create a JDK that includes the JavaFX modules. You might need to include other JavaFX modules (e.g. <code>javafx.web</code> if you are using <code>WebView</code>, <code>javafx.media</code> if you are using <code>MediaPlayer</code>, etc.), or omit <code>javafx.fxml</code> if you are not using FXML.</p>\n<p>Now you can just use that JDK to compile and run:</p>\n<pre><code>export JAVA_HOME=JavaWithFX\njavac ClassName.java\njava ClassName\n</code></pre>\n<p>(or possibly <code>export PATH=JavaWithFX/bin:$PATH</code> instead of the <code>export JAVA_HOME</code>, depending on how Java works on your system).</p>\n<p>Running</p>\n<pre><code>JavaWithFX/bin/jshell\n</code></pre>\n<p>will give you a jshell that includes the JavaFX modules:</p>\n<pre><code>% JavaWithFX/bin/jshell\n|  Welcome to JShell -- Version 20\n|  For an introduction type: /help intro\n\njshell&gt; import javafx.beans.property.SimpleIntegerProperty\n\njshell&gt; var x = new SimpleIntegerProperty(0)\nx ==&gt; IntegerProperty [value: 0]\n\njshell&gt; x.addListener((obs, oldValue, newValue) -&gt; System.out.printf(&quot;x changed from %d to %d%n&quot;, oldValue, newValue))\n\njshell&gt; x.set(42)\nx changed from 0 to 42\n\njshell&gt; \n</code></pre>\n"}],"owner":{"user_id":16737129,"display_name":"Zeta-Squared"},"view_count":58,"up_vote_count":3,"accepted_answer_id":76156106,"answer_count":1,"score":3,"creation_date":1683031973,"question_id":76155054,"body":"<p>I am new to Java and currently reading through a text and learning. I have installed the JDK in my <code>/opt</code> directory (working on Kubuntu). I have also installed openjfx in <code>/opt</code>. Since I work out the terminal, whenever I want to compile or run something involving a module from JavaFX, I use</p>\n<p><code>javac --module-path $PATH_TO_FX --add-modules ALL-MODULE-PATH className.java</code></p>\n<p>However, when I try the same thing with <code>jshell</code> it will not work. That is,</p>\n<p><code>jshell --module-path $PATH_TO_FX --add-modules ALL-MODULE-PATH</code></p>\n<p>What I am trying to find out is, is there any way I can install the JavaFX SDK so that it is merged with the Java SDK directory and saves me having to use the flags whenever I want to compile/run a program that requires any modules from JavaFX?</p>\n<p>If not, can anyone tell me why the <code>jshell</code> comand above will not work as I expect it to?</p>\n"},{"tags":["java","java-stream"],"comments":[{"owner":{"user_id":1552534,"display_name":"WJS"},"edited":false,"comment_id":134234089,"body":"You can&#39;t pass a null to an  int in the constructor  carCode is an int.  Please include your complete class including constructors and getters.  And why is the car name an int?  If is really a string, any answer provided won&#39;t be of use to you."},{"owner":{"user_id":1711465,"display_name":"Vamsi"},"edited":false,"comment_id":134234171,"body":"Thanks for pointing it out. I corrected them."},{"owner":{"user_id":1711465,"display_name":"Vamsi"},"edited":false,"comment_id":134234227,"body":"I removed unnecessary properties from the class in the question."}],"answers":[{"owner":{"user_id":17795888,"display_name":"Chaosfire"},"up_vote_count":2,"is_accepted":false,"creation_date":1682539637,"answer_id":76114695,"body":"<p>Predicates provide the method <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/function/Predicate.html#and(java.util.function.Predicate)\" rel=\"nofollow noreferrer\"><code>and()</code></a>, which allows you to combine two predicates with a logical <strong>AND</strong>.</p>\n<blockquote>\n<p>Returns a composed predicate that represents a short-circuiting logical AND of this predicate and another. When evaluating the composed predicate, if this predicate is false, then the other predicate is not evaluated.</p>\n</blockquote>\n<p>Example:</p>\n<pre><code>Predicate&lt;Car&gt; distinctByCarNum = distinctByKey(Car::getCarNum);\nPredicate&lt;Car&gt; engineNonNull = car -&gt; Objects.nonNull(car.getCarEngine());\nPredicate&lt;Car&gt; combinedPredicate = distinctByCarNum.and(engineNonNull);\nList&lt;Car&gt; filtered = carList.stream()\n    .filter(combinedPredicate)\n    .collect(Collectors.toList());\n</code></pre>\n<p><strong>Edit:</strong> After requirement update, you need grouping, not filtering. Refer to the <a href=\"https://stackoverflow.com/a/76114896/17795888\">answer from shmosel</a> for correct solution.</p>\n"},{"owner":{"user_id":1553851,"display_name":"shmosel"},"up_vote_count":3,"is_accepted":false,"creation_date":1682541391,"answer_id":76114896,"body":"<p>I would recommend the <code>toMap()</code> collector with a merge function to select the one with a non-null engine:</p>\n<pre><code>carList.stream()\n        .collect(Collectors.collectingAndThen(\n                Collectors.toMap(\n                        Car::getCarNum,\n                        c -&gt; c,\n                        (a, b) -&gt; a.getCarEngine() != null ? a : b),\n                map -&gt; new ArrayList&lt;&gt;(map.values())))\n</code></pre>\n<p>This way, if there's a <code>carNum</code> with only null engines, the first one will remain the final result.</p>\n"},{"owner":{"user_id":1552534,"display_name":"WJS"},"up_vote_count":0,"is_accepted":false,"creation_date":1682543829,"answer_id":76115160,"body":"<p>Here is one way.</p>\n<ul>\n<li>first I group by <code>carNum</code>.</li>\n<li>then for each collection of same <code>carNums</code> I first check that all are null for <code>carEngine</code>.  If so, I simply return the first in the collection.</li>\n<li>otherwise, I stream the list and choose the first one that is not null since one <strong>must</strong> be.</li>\n</ul>\n<pre><code>List&lt;Car&gt; results = carList.stream()\n   .collect(Collectors.groupingBy(Car::getCarNum)).values()\n   .stream().map(lst -&gt; {\n      if (lst.stream().allMatch(car -&gt; car.getCarEngine() == null)) {\n          return lst.get(0);\n      } else {\n          return lst.stream()\n                 .filter(car -&gt; car.getCarEngine() != null)\n                 .findFirst().get();\n            }\n        }).toList();\n</code></pre>\n<p>prints</p>\n<pre><code>Car [carNum=1, carEngine=S02K]\nCar [carNum=2, carEngine=S9K]\nCar [carNum=3, carEngine=null]\n</code></pre>\n"},{"owner":{"user_id":5730279,"display_name":"hc_dev"},"up_vote_count":0,"is_accepted":false,"creation_date":1682548177,"answer_id":76115521,"body":"<h2>Sort with <a href=\"https://docs.oracle.com/javase/10/docs/api/java/util/Comparator.html#nullsLast(java.util.Comparator)\" rel=\"nofollow noreferrer\"><code>nullsLast</code></a> before filtering</h2>\n<p>The trick is to sort with <strong>nulls last</strong> before the distinct-filter:</p>\n<pre class=\"lang-java prettyprint-override\"><code>// first by number\nComparator.comparing(Car::getNum)\n  // we prefer with engine before no engine.\n  .thenComparing(Car::getEngine, Comparator.nullsLast(Comparator.naturalOrder()))\n</code></pre>\n<p>You can pass this comparator to the <code>Stream.sorted()</code> step, before filtering.</p>\n<h3>Solution</h3>\n<pre class=\"lang-java prettyprint-override\"><code>import java.util.*\nimport java.util.Comparator;\nimport java.util.concurrent.*;\nimport java.util.function.*;\nimport java.util.stream.*;\n\nclass Car {\n  int num;\n  String engine;\n\n  public Car(int num, String engine) {\n    this.num = num;\n    this.engine = engine;\n  }\n\n  public Integer getNum() {\n    return this.num;\n  }\n\n  public String getEngine() {\n    return this.engine;\n  }\n\n  public String toString() {\n    return String.format(&quot;Car: %d, %s&quot;, num, engine);\n  }\n}\n\n/* Name of the class has to be &quot;Main&quot; only if the class is public. */\nclass Ideone {\n  public static &lt;T&gt; Predicate&lt;T&gt; distinctByKey(\n      Function&lt;? super T, ?&gt; keyExtractor) {\n    Set&lt;Object&gt; seen = ConcurrentHashMap.newKeySet();\n    return t -&gt; seen.add(keyExtractor.apply(t));\n  }\n\n  public static Comparator&lt;Car&gt; withNullEnginesLast() {\n    return Comparator.comparing(Car::getNum)\n        .thenComparing(\n            Car::getEngine, Comparator.nullsLast(Comparator.naturalOrder()));\n  }\n\n  public static void main(String[] args) throws java.lang.Exception {\n    // your code goes here\n\n    var carList = List.of(\n        // num, engine\n        new Car(1, &quot;S02K&quot;),\n        new Car(1, null),  // filter out as duplicate (nulls last)\n        new Car(2, null),  // filter out as duplicate (nulls last)\n        new Car(2, &quot;S9K&quot;),\n        new Car(3, null)  // include because only occurrence for number\n    );\n\n    var result =\n        carList.stream()\n            .sorted(withNullEnginesLast()) // sort first by num, then engine\n                                           // where null-engines last\n            .filter(distinctByKey(Car::getNum))\n            .collect(Collectors.toList());\n\n    System.out.println(result);\n  }\n}\n</code></pre>\n<p>Prints the car 2 <strong>with engine</strong>:</p>\n<pre><code>[Car: 1, S02K, Car: 2, S9K, Car: 3, null]\n</code></pre>\n<p>Try it online: <a href=\"https://ideone.com/69nfTx\" rel=\"nofollow noreferrer\">IDEone demo</a></p>\n<h3>See also</h3>\n<ul>\n<li>Baeldung Tutorial: <a href=\"https://www.baeldung.com/java-8-sort-lambda\" rel=\"nofollow noreferrer\">Java 8 - Comparison with Lambdas</a></li>\n<li>Similar Car sorting: <a href=\"https://stackoverflow.com/questions/58332511/how-to-do-stream-sort-based-on-multiple-comparsions-of-nested-object\">How to do stream sort based on multiple comparsions of nested object?</a></li>\n<li>JavaDocs for the important decorator: <a href=\"https://docs.oracle.com/javase/10/docs/api/java/util/Comparator.html#nullsLast(java.util.Comparator)\" rel=\"nofollow noreferrer\"><code>Comparator.nullsLast()</code></a></li>\n</ul>\n"}],"owner":{"user_id":1711465,"display_name":"Vamsi"},"view_count":78,"up_vote_count":3,"answer_count":4,"score":3,"creation_date":1682538902,"question_id":76114600,"body":"<p>I have the following code</p>\n<pre><code>public class Car {\n    Long carNum;\n    String carEngine;\n}\n</code></pre>\n<p>The data in List object is as follows:</p>\n<pre><code>Car(carNum=1, carEngine=S02K), \nCar(carNum=1, carEngine=null), \nCar(carNum=2, carEngine=null),\nCar(carNum=2, carEngine=S9K),\nCar(carNum=3, carEngine=null)\n</code></pre>\n<p>How can I filter out data from the car object where</p>\n<p>check for <strong>distinct carNum</strong> If there are more than one similar carNum then check where <strong>carEngine is not null</strong> and return the data in a list.</p>\n<p>I am able to do the distinct carNum using</p>\n<pre><code>public static &lt;T&gt; Predicate&lt;T&gt; distinctByKey(Function&lt;? super T, ?&gt; keyExtractor) {\n        Set&lt;Object&gt; seen = ConcurrentHashMap.newKeySet();\n        return t -&gt; seen.add(keyExtractor.apply(t));\n}\n</code></pre>\n<p>in the following way:</p>\n<pre><code>carList.stream().filter(distinctByKey(Car::getCarNum)).collect(Collectors.toList());\n</code></pre>\n<p>The above code gets the distinct carNum but there is a very good chance that it will return the results with null carEngine.</p>\n<p>How can I check where carEngine is not null along with distinct carNum combined.</p>\n<p><strong>NOTE:</strong> If there is only one distinct carNum without carEngine then I should return that row along with other rows.</p>\n<p>For example: If the input data looks like this:</p>\n<pre><code>Car(carNum=1, carEngine=S02K), \nCar(carNum=1, carEngine=null), \nCar(carNum=2, carEngine=null),\nCar(carNum=2, carEngine=S9K),\nCar(carNum=3, carEngine=null)\n</code></pre>\n<p>then the output should be:</p>\n<pre><code>Car(carNum=1, carEngine=S02K), \nCar(carNum=2, carEngine=S9K),\nCar(carNum=3, carEngine=null)\n</code></pre>\n<p>Please let me know. Thank you!</p>\n"},{"tags":["java","hashmap","concurrenthashmap"],"comments":[{"owner":{"user_id":1707427,"display_name":"S&#246;ren"},"edited":false,"comment_id":133632357,"body":"&quot;Comparator is to .compareTo what X is to .equals+.hashcode - why doesn&#39;t Java have X&quot;. Is that your question?"}],"answers":[{"owner":{"user_id":139985,"display_name":"Stephen C"},"up_vote_count":5,"is_accepted":true,"creation_date":1678948206,"answer_id":75752782,"body":"<p>This was requested as an RFE for Java 1.2.2 and so on, but never implemented and eventually closed.  <a href=\"https://bugs.openjdk.org/browse/JDK-4269596\" rel=\"nofollow noreferrer\">https://bugs.openjdk.org/browse/JDK-4269596</a></p>\n<p>Joshua Bloch's analysis in 1999 was:</p>\n<blockquote>\n<p>When the Collections Framework was designed, we thought hard about whether to include support for custom equals/hashCode methods. In the end, we rejected it on the grounds of increased complexity, and inconsistency with other design decisions. In particular, the decision that List, Set and Map objects can be compared independent of their representation is inconsistent with support for custom equals methods.</p>\n<p>Moreover, full support for custom equals methods is probably overkill. 99% of the time, when a developer wants a collection with a custom equals method, the desired equals method is element identity. This suggests an alternate solution, which is to provide one or two special-purpose implementations that are based on identity rather than equality. Of course these implementations would not be &quot;good citizens of the realm&quot;, in that they could not be properly compared to other collections. (Which equals method would you use?) This is not without precedent, however. It is possible to make a SortedMap/Set that violates the Map/Set contract, by specifiying a Comparator that is not &quot;consistent with equals.&quot;</p>\n<p>I am leaving this RFE open to track support for special-purpose, identity-based Set and Map implementations.</p>\n</blockquote>\n<p>The final comment (in 2011) notes that identity-based use-cases <em>have been</em> addressed via <code>IdentityHashMap</code> etc.</p>\n<p>There a number of linked issues if you want to trawl through them.</p>\n<hr />\n<p>Having said that, if you want a Java hash table implementation that allows you use a different <code>hashCode</code> and <code>equals</code> to those implemented by the key type, there are 3rd party libraries that support this.  For example, Apache Commons Collections <code>AbstractHashedMap</code> (<a href=\"https://commons.apache.org/proper/commons-collections/javadocs/api-4.4/org/apache/commons/collections4/map/AbstractHashedMap.html\" rel=\"nofollow noreferrer\">javadoc</a>).  There are other possibilities listed in this Q&amp;A: <a href=\"https://stackoverflow.com/questions/15184637\">Custom hashcode/equals operation for HashMap</a>.</p>\n"}],"owner":{"user_id":709537,"display_name":"Evgeniy Berezovsky"},"view_count":114,"up_vote_count":4,"accepted_answer_id":75752782,"answer_count":1,"score":3,"creation_date":1678946400,"question_id":75752615,"body":"<p><code>ConcurrentHashMap</code> and <code>HashMap</code> are using <code>equals()</code>/<code>hashCode()</code> of the key instances.</p>\n<p>Over the decades, on quite a few occasions, I have missed the possibility to provide different equals/hashCode implementations. Not being able to do this means you either have to use a sorted map, which allows you to set a <code>Comparator</code>, at the cost of SortedMap's worse performance characteristics, or you have to use different objects as your keys, i.e. by creating key wrapper instances that provide their own equals/hashCode implementations.</p>\n<p>In the latter case, the need to create another object for every key has obvious memory and performance implications. (In the current case I'm looking at, it would mean the creation of hundreds of thousands of additional object instances per second at peak times - which is where performance matters most.)</p>\n<p>This seems like such a trivial and safe change to do, with huge performance benefits in the cases where it is needed.</p>\n<p>.Net has been offering this for its <code>Dictionary</code> since <a href=\"https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2.-ctor?view=net-7.0&amp;viewFallbackFrom=netframework-1.1#system-collections-generic-dictionary-2-ctor(system-collections-generic-iequalitycomparer((-0)))\" rel=\"nofollow noreferrer\">at least version 1.1</a>. So are there any good, technical reasons why Java does not?</p>\n"},{"tags":["java","design-patterns"],"comments":[{"owner":{"user_id":608820,"display_name":"Augusto"},"edited":false,"comment_id":133501980,"body":"I would say that you don&#39;t need an interface for the configuration. The concrete implementations of ServiceX will need concrete implementations of the configuration. And I have a strong feeling that the method <code>Service.getConfig()</code> is a bad idea. Why would you like to leak the configuration of the service?"}],"answers":[{"owner":{"user_id":2056697,"display_name":"Thomas"},"up_vote_count":3,"is_accepted":false,"creation_date":1678283548,"answer_id":75673954,"body":"<p>You can use genericity in <code>Service</code> definition :</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface Service&lt;T extends ServiceConfiguration&gt;{   \n   T getConfig()\n}\n</code></pre>\n<p><code>public class ServiceA implements Service&lt;ServiceAConfiguration&gt;{}</code></p>\n<p><code>public class ServiceB implements Service&lt;ServiceBConfiguration&gt;{}</code></p>\n<pre class=\"lang-java prettyprint-override\"><code>public class ServiceAConfiguration implements ServiceConfiguration {\n    int port;\n    int version;\n    String url;\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public class ServiceBConfiguration implements ServiceConfiguration {\n    int port;\n    Socket socket;\n    File file;\n}\n</code></pre>\n<p>You no longer need to cast the configuration :</p>\n<pre class=\"lang-java prettyprint-override\"><code>Service s = new ServiceA(...);\nServiceAConfiguration config = s.getConfig();\n</code></pre>\n"},{"owner":{"user_id":17795888,"display_name":"Chaosfire"},"up_vote_count":2,"is_accepted":false,"creation_date":1678287936,"answer_id":75674764,"body":"<p>It looks to me that you are using <code>Configuration</code>s as data carriers, thus the need to expose the actual state (port, url, etc.). I suggest that you change the approach and provide it whatever has to be configured, or create new configured object (whatever is more appropriate for your use case).</p>\n<p>Properties make it look like configurations for a connection, so i will use that as placeholder.</p>\n<pre><code>public interface ServiceConfiguration {\n\n   Connection configureConnection();\n}\n</code></pre>\n<pre><code>public class ServiceAConfiguration implements ServiceConfiguration {\n    //properties\n    \n    @Override\n    Connection configureConnection() {\n        return a connection using port, version and url;\n    }\n}\n</code></pre>\n<pre><code>public class ServiceBConfiguration implements ServiceConfiguration {\n    //properties\n\n    @Override\n    Connection configureConnection() {\n        return a connection using port, socket and file;\n    }\n}\n</code></pre>\n<p>Like this you don't need to expose the actual configuration details to the outside world and consequently you don't need to cast <code>ServiceConfiguration</code> to the actual class.</p>\n"}],"owner":{"user_id":4126768,"display_name":"Dingo"},"view_count":64,"up_vote_count":3,"answer_count":2,"score":3,"creation_date":1678282136,"question_id":75673673,"body":"<p>I have interface <code>Service</code></p>\n<p><code>public interface Service{}</code></p>\n<p>And multiple implementations</p>\n<p><code>public class ServiceA implements Service{}</code></p>\n<p><code>public class ServiceB implements Service{}</code></p>\n<p>Now each service has some kind of configuration, e.g</p>\n<pre><code>public interface Service{   \n   ServiceConfiguration getConfig()\n}\n</code></pre>\n<p>However each of these implementation requires different configuration. So for example <code>ServiceA</code> needs <code>port</code>,<code>version</code>,<code>url</code> , serviceB needs <code>port</code>,<code>socket</code>,<code>file</code> and so on.</p>\n<p>What is some elegant and good practice way to achieve this? The only thing that comes to my mind is create implementation of <code>ServiceConfiguration</code> (and use it as Marker interface ) for each service, and then cast it, e.g</p>\n<p><code>public interface ServiceConfiguration {}</code></p>\n<pre><code>public class ServiceAConfiguration implements ServiceConfiguration {\n    int port;\n    int version;\n    String url;\n}\n\npublic class ServiceBConfiguration implements ServiceConfiguration {\n    int port;\n    Socket socket;\n    File file;\n}\n</code></pre>\n<p>And then casting it in code like:</p>\n<pre><code>Service s = new ServiceA(...);\nServiceAConfiguration config = (ServiceAConfiguration)s.getConfig();\n</code></pre>\n<p>Is there better way, some kind of best practice or some design pattern for this? So far i have found only <code>AbstractDocument</code> design pattern for dealing with properties but i think that is not applicable here.</p>\n<p>Thanks for helP!</p>\n"},{"tags":["java","graalvm","jaotc"],"answers":[{"owner":{"user_id":1515052,"display_name":"Simulant"},"up_vote_count":5,"is_accepted":true,"creation_date":1675288690,"answer_id":75316645,"body":"<p>You still need the JVM, because you just compiled a small portion i.e. &quot;your HelloWorld&quot; to native code. You still require a lot of the JVM to run your program. e.g. the Java standard library (which you haven't compiled to native code), class loading, detection of the program entry point (finding your main method), and garbage collection. All of this is provided by the JVM.</p>\n<p>In short, you just compiled a library, a small part of your program, to native code. You don't compile the complete program to native code.</p>\n<p>This is also stated by the <a href=\"https://openjdk.org/jeps/295\" rel=\"noreferrer\">summary of JEP295</a>:</p>\n<blockquote>\n<p>Summary<br />\nCompile Java classes to native code prior to launching the virtual machine.</p>\n</blockquote>\n<p>I think what you actually want to do, is to <a href=\"https://www.graalvm.org/22.0/reference-manual/native-image/\" rel=\"noreferrer\">compile a native image</a> of your program. This would include all the implications like garbage collection from the JVM into the executable.</p>\n"}],"owner":{"user_id":2566397,"display_name":"user2566397"},"view_count":77,"up_vote_count":3,"accepted_answer_id":75316645,"answer_count":1,"score":3,"creation_date":1675288016,"question_id":75316542,"body":"<p>Im learning about GraalVM and AOT and I was reading the <a href=\"https://openjdk.org/jeps/295\" rel=\"nofollow noreferrer\">spec for AOT</a> and then I got confused, if AOT compiles my code to machine code (native) why do I need a JVM?<br/>\nwhy I need this:</p>\n<pre><code>java -XX:AOTLibrary=./libHelloWorld.so HelloWorld\n</code></pre>\n"},{"tags":["java","flutter","android-studio"],"answers":[{"owner":{"user_id":2684,"display_name":"Martin Marconcini"},"up_vote_count":2,"is_accepted":false,"creation_date":1674819901,"answer_id":75257663,"body":"<h3>UPDATE 2</h3>\n<p>While the suggestion in Update 1 would work, this is not a &quot;script&quot; interpreted in real-time, and rather part of the <code>flutter</code> binary (if I am not mistaken), so in order for this to work, one would have to compile the <code>flutter</code> binary again, I don't know how to do that right now (as I've never used flutter beyond the basics) and I can't certainly do it on my &quot;work machine&quot; where the Corporate eyes forbid everything that is fun.</p>\n<p>In other words, use the symlink trick you found <a href=\"https://github.com/flutter/flutter/issues/119325\" rel=\"nofollow noreferrer\">in this GitHub issue</a> until the Flutter team releases an updated <code>flutter</code> that searches for the correct java Path in the newer versions of Android Studio.</p>\n<p>And Jetbrains, please, stop renaming the java location every other year...</p>\n<h3>UPDATE 1</h3>\n<p>In the flutter sdk, there's a file called: <code>android_studio.dart</code>. (well there are various android related files, none &quot;java&quot; related, since it seems like Flutter treats Java as an &quot;android thing&quot; (judging by the fact that all java references and validations or checks are performed in <code>android_</code> files).</p>\n<p>This file is located in <code>path/to/flutter/packages/flutter_tools/lib/src/android/android_studio.dart</code>.</p>\n<p>Inside it contains this to calculate the path to java:</p>\n<pre><code>    final String javaPath = globals.platform.isMacOS ?\n        version != null &amp;&amp; version.major &lt; 2020 ?\n        globals.fs.path.join(directory, 'jre', 'jdk', 'Contents', 'Home') :\n        globals.fs.path.join(directory, 'jre', 'Contents', 'Home') :\n        globals.fs.path.join(directory, 'jre');\n</code></pre>\n<p>In essence, if you add another entry like this:</p>\n<pre><code>        globals.fs.path.join(directory, 'jbr', 'Contents', 'Home') :\n</code></pre>\n<p>So it ends up looking like:</p>\n<pre><code>    final String javaPath = globals.platform.isMacOS ?\n        version != null &amp;&amp; version.major &lt; 2020 ?\n        globals.fs.path.join(directory, 'jre', 'jdk', 'Contents', 'Home') :\n        globals.fs.path.join(directory, 'jre', 'Contents', 'Home') :\n        globals.fs.path.join(directory, 'jbr', 'Contents', 'Home') :\n        globals.fs.path.join(directory, 'jre');\n</code></pre>\n<p>Then you can run <code>flutter doctor</code> and it may work.</p>\n<p>I also removed the <code>&amp;&amp; version.major &lt; 2020</code> part, just to ensure it was always run. Now I see:</p>\n<pre><code>[!] Android Studio (version 2022.1)\n    âœ— Unable to find bundled Java version.\n[âœ“] Android Studio (version 2021.3)\n</code></pre>\n<p>So... Two different Android Studio versions, the latest (the one with <code>jbr</code> instead of <code>jre</code> seems to work fine.</p>\n<hr />\n<p>In Android Studio Electric Eel, the bundled Java was <em>moved</em> to <code>/Applications/Android Studio.app/Contents/jbr/Contents/Home</code> so you can set your <code>$JAVA_HOME</code> to point to that directly.</p>\n<p>In Addition, if you're on macOS (as it looks like that's the case) remember macOS uses (for some Apple reason) a binary called <code>java_home</code> to set the JAVA installations.</p>\n<p>You can find this binary in <code>/usr/libexec/java_home</code>.</p>\n<p>It seems like the flutter plug-in may be looking for Java under the assumption that it's under the &quot;old&quot; <code>jre</code> instead of the &quot;new&quot; <code>jbr</code> folder. I don't know if this is hardcoded (and therefore needs a 'patch') or if it just reads the environment variable for JAVA_HOME.</p>\n"},{"owner":{"user_id":21004694,"display_name":"wey"},"up_vote_count":3,"is_accepted":false,"creation_date":1674890640,"answer_id":75266041,"body":"<p>Are you using Jetbrain Toolbox to manage Android Studio?</p>\n<p>If so, my solution may work for you.\nI'm also using M1Air, Flutter 3.7.0, Android Studio Electric Eel 2022.1.1</p>\n<p>cd ~/Library/Application\\ Support/JetBrains/Toolbox/apps/AndroidStudio/ch-0/{ YOUR_VERSION_OF_ANDROID_STUDIO }/Android\\ Studio.app/Contents/</p>\n<p>run <code>ls</code> and look for <code>/jbr</code></p>\n<p>run <code>sudo ln -s jbr jre</code> and <code>flutter doctor</code></p>\n<p>This solved my problem.</p>\n<p>EDIT</p>\n<p>Your version of Android Studio can be found at <code>Jetbrain Toolbox -&gt; Android Studio -&gt; Settings(3 dots on the right) -&gt; Configuration -&gt; Install Location</code></p>\n<p><a href=\"https://github.com/flutter/flutter/issues/118502#issuecomment-1383388490\" rel=\"nofollow noreferrer\">Related Github Issue</a></p>\n"}],"owner":{"user_id":408900,"display_name":"popey"},"view_count":1100,"up_vote_count":3,"answer_count":2,"score":3,"creation_date":1674768963,"question_id":75251872,"body":"<p>Setting up Flutter on MacOS Ventura 13.2 on an M1 MacBook Air. I've installed everything to get <code>[âœ“]</code> except for flutter doctor unable to find a bundled jre in Android Studio. I have found some other questions on this site, but none helped.</p>\n<pre><code>alan@Alans-MacBook-Air ~ % flutter doctor   \nDoctor summary (to see all details, run flutter doctor -v):\n[âœ“] Flutter (Channel stable, 3.7.0, on macOS 13.2 22D49 darwin-arm64 (Rosetta), locale en-GB)\n[âœ“] Android toolchain - develop for Android devices (Android SDK version 33.0.1)\n[âœ“] Xcode - develop for iOS and macOS (Xcode 14.2)\n[âœ“] Chrome - develop for the web\n[!] Android Studio (version 2022.1)\n    âœ— Unable to find bundled Java version.\n[âœ“] VS Code (version 1.74.3)\n[âœ“] Connected device (2 available)\n[âœ“] HTTP Host Availability\n</code></pre>\n<p>Here's the full output of the Android Studio section:</p>\n<pre><code>[!] Android Studio (version 2022.1)\n    â€¢ Android Studio at /Applications/Android Studio.app/Contents\n    â€¢ Flutter plugin can be installed from:\n      ðŸ”¨ https://plugins.jetbrains.com/plugin/9212-flutter\n    â€¢ Dart plugin can be installed from:\n      ðŸ”¨ https://plugins.jetbrains.com/plugin/6351-dart\n    âœ— Unable to find bundled Java version.\n    â€¢ Try updating or re-installing Android Studio.\n</code></pre>\n<p>I have java installed:</p>\n<pre><code>alan@Alans-MacBook-Air ~ % java -version \njava version &quot;19.0.2&quot; 2023-01-17\nJava(TM) SE Runtime Environment (build 19.0.2+7-44)\nJava HotSpot(TM) 64-Bit Server VM (build 19.0.2+7-44, mixed mode, sharing)\nalan@Alans-MacBook-Air ~ % /usr/libexec/java_home \n/Library/Java/JavaVirtualMachines/jdk-19.jdk/Contents/Home\n</code></pre>\n<p>I also have my environment setup correctly, I think:</p>\n<pre><code>alan@Alans-MacBook-Air ~ % echo $JAVA_HOME\n/Library/Java/JavaVirtualMachines/jdk-19.jdk/Contents/Home\n</code></pre>\n<p>Some other questions suggest playing with symlinks in the jre folder in the Android Studio install, but I have <em>no</em> jre folder in there. There is however a jbr folder, which appears to contain an OpenJDK build. But I don't know how to get flutter to see/use it.</p>\n<pre><code>alan@Alans-MacBook-Air ~ % /Applications/Android\\ Studio.app/Contents/jbr/Contents/Home/bin/java -version\nopenjdk version &quot;11.0.15&quot; 2022-04-19\nOpenJDK Runtime Environment (build 11.0.15+0-b2043.56-8887301)\nOpenJDK 64-Bit Server VM (build 11.0.15+0-b2043.56-8887301, mixed mode)\n</code></pre>\n<p>Installed all the components as required in the documentation. I think I've set environment and other parts up correctly.</p>\n"},{"tags":["java","static-methods","factory-method","effective-java"],"comments":[{"owner":{"user_id":1744230,"display_name":"QBrute"},"edited":false,"comment_id":132690560,"body":"The method doesn&#39;t create any objects, it just returns the values of <code>Boolean.TRUE</code> or <code>Boolean.FALSE</code> that were created once when the <code>Boolean</code> class was loaded."},{"owner":{"user_id":12567365,"display_name":"andrewJames"},"edited":false,"comment_id":132690597,"body":"There is a difference between <b>returning</b> an object which already exists (<code>Boolean.TRUE</code> or <code>Boolean.FALSE</code>) vs. <b>creating</b> a new object."},{"owner":{"user_id":8041003,"display_name":"John Williams"},"edited":false,"comment_id":132690663,"body":"booleanWrapped does not reference a newly <i>created</i> object. It references the static Boolean.TRUE created the first time the Boolean class loads."},{"owner":{"user_id":18157,"display_name":"Jim Garrison"},"edited":false,"comment_id":132692145,"body":"A <code>Boolean</code> is an <i>immutable</i> object (its internal state cannot be changed). There are only two possible boolean values.  When class <code>Boolean</code> is loaded and initialized it creates two static instances, TRUE and FALSE.  Therefore, there is never any reason to instantiate a <code>Boolean</code> object, every <code>Boolean</code> reference can point to one of the two static values created at <code>Boolean</code> class initialization time.  <code>valueOf()</code> returns one of those two references."}],"answers":[{"owner":{"user_id":8041003,"display_name":"John Williams"},"up_vote_count":2,"is_accepted":false,"creation_date":1674316246,"answer_id":75194574,"body":"<p>Your booleanWrapped variable does not reference a newly <strong>created</strong> object. It references the static <code>Boolean.TRUE</code> created the first time the Boolean class loads. All calls to <code>Boolean.valueOf(true)</code> simply reuse that single object.</p>\n"},{"owner":{"user_id":1552534,"display_name":"WJS"},"up_vote_count":2,"is_accepted":true,"creation_date":1674316267,"answer_id":75194579,"body":"<p>As of Java 9, Boolean has a deprecated constructor.  But this still demonstrates the difference.</p>\n<p>So <code>Boolean b1 = new Boolean(true).</code> creates a new instance and stores it in <code>b1</code>.</p>\n<pre><code>Boolean b1 = new Boolean(true);\nBoolean b2 = new Boolean(true);\nSystem.out.println(System.identityHashCode(b1));\nSystem.out.println(System.identityHashCode(b2));\n</code></pre>\n<p>Two different identity hashcodes imply different objects</p>\n<pre><code>804564176\n1421795058\n</code></pre>\n<p>Now use the existing static instance.</p>\n<pre><code>Boolean b1 = Boolean.TRUE;\nBoolean b2 = Boolean.TRUE;\nSystem.out.println(System.identityHashCode(b1));\nSystem.out.println(System.identityHashCode(b2));\n</code></pre>\n<p>Sharing the same object - same hashcode.</p>\n<pre><code>804564176\n804564176\n</code></pre>\n<p>Within the Boolean class you have the following:</p>\n<pre><code>public static final Boolean TRUE = new Boolean(true);\npublic static final Boolean FALSE = new Boolean(false);\n</code></pre>\n<p>So they are created when the class is loaded.</p>\n"},{"owner":{"user_id":1031887,"display_name":"phatfingers"},"up_vote_count":0,"is_accepted":false,"creation_date":1674317960,"answer_id":75194770,"body":"<p>Both <code>Boolean.TRUE</code> and <code>Boolean.FALSE</code> are pre-existing <code>static</code> members defined by the Boolean class.</p>\n<p>One important concept to not overlook in understanding the benefit of static factory methods over traditional constructors is why Josh Bloch specifies that <em>immutable</em> classes can be cached or pre-constructed. The point isn't really about whether or not a single object is constructed at the time that static factory method is called the first time, but rather how it can conserve resources when used multiple times.  The savings is all about returning a pre-existing immutable instance rather than constructing a new one.</p>\n"},{"owner":{"user_id":112968,"display_name":"knittl"},"up_vote_count":1,"is_accepted":false,"creation_date":1674321128,"answer_id":75195138,"body":"<p>The method <code>valueOf</code> never creates a new object (there is no <code>new</code> expression and no other method call that could transitively call a constructor). The method simply returns one of 2 static fields (<code>Boolean.TRUE</code> or <code>Boolean.FALSE</code>). These fields already exist and the objects they reference were already created (outside and before the method <code>valueOf</code>).</p>\n<p>Obviously, the objects have to be created <em>somewhere</em>; but they are not created in the method <code>valueOf</code>.</p>\n<p>And &quot;returning an object&quot; != &quot;creating an object&quot;.</p>\n<pre><code>public static Object demo() {\n  final Object obj = new Object(); // `new` creates the object\n  return obj; // `return` returns the object, it does not create a new one\n}\n</code></pre>\n"}],"owner":{"user_id":20926873,"display_name":"citizen_code"},"view_count":98,"up_vote_count":3,"accepted_answer_id":75194579,"answer_count":4,"score":3,"creation_date":1674315287,"question_id":75194488,"body":"<h1>Source of Question</h1>\n<p>I was wondering about the following advantage of Static Factory Methods described by Joshua Blochs &quot;Effective Java&quot;, 3rd edition  in item #1:</p>\n<blockquote>\n<p>A second advantage of static factory methods is that, unlike constructors, they are not required to create a new object each time theyâ€™re invoked. This allows immutable classes (Item 15) to use preconstructed instances, or to cache instances as theyâ€™re constructed, and dispense them repeatedly to avoid creating unnecessary duplicate objects. The Boolean.valueOf(boolean) method illustrates this technique: it never creates an object.</p>\n</blockquote>\n<p>See extract <a href=\"https://www.informit.com/articles/article.aspx?p=1216151\" rel=\"nofollow noreferrer\">here</a>.</p>\n<h1>Question</h1>\n<p>What got my attention was the last line about <code>valueOf(boolean)</code> not creating an object.\nAccording to the book</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static Boolean valueOf(boolean b) {\n    return b ? Boolean.TRUE : Boolean.FALSE;\n}\n</code></pre>\n<p>and the <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/Boolean.html#valueOf(boolean)\" rel=\"nofollow noreferrer\">Javadoc</a></p>\n<blockquote>\n<p><code>public static Boolean valueOf(boolean b)</code></p>\n<p>Returns a Boolean instance representing the specified boolean value. If the specified boolean value is true, this method returns Boolean.TRUE; if it is false, this method returns Boolean.FALSE. If a new Boolean instance is not required, this method should generally be used in preference to the constructor Boolean(boolean), as this method is likely to yield significantly better space and time performance.</p>\n</blockquote>\n<p>So from my understanding and the Javadoc (&quot;Returns a Boolean instance...&quot;) the static method returns indeed a Boolean and therefore an object - as it is literally the return type. In the following case:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class MyClass {\n    public static void main(String args[]) {\n        Boolean booleanWrapped = Boolean.valueOf(true);\n        System.out.println(booleanWrapped);\n    }\n}\n</code></pre>\n<p><code>booleanWrapped</code> is my object I can use e.g. like in the <code>prinln()</code> statement.</p>\n<p>So what am I missing here if Joshua states</p>\n<blockquote>\n<p>The Boolean.valueOf(boolean) [...] <strong>never</strong> creates an object</p>\n</blockquote>\n<p>I'm aware of a similar question with an existing <a href=\"https://stackoverflow.com/a/58544419/20926873\">answer</a> but it doesn't seem to fully answer my question as in my example above there isn't an &quot;pre-existing&quot; instance.?!</p>\n"},{"tags":["java","date","java-time","duration","localdate"],"comments":[{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"edited":false,"comment_id":132637377,"body":"This question meets the <a href=\"https://stackoverflow.com/help/how-to-ask\">requirements of a good question</a>. I don&#39;t see any reason for the close vote."}],"answers":[{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"up_vote_count":5,"is_accepted":true,"creation_date":1674064748,"answer_id":75163393,"body":"<h2>TL;DR</h2>\n<p>Use <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Period.html\" rel=\"noreferrer\"><code>Period</code></a> instead of <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/Duration.html\" rel=\"noreferrer\"><code>Duration</code></a>.</p>\n<p><strong>Demo</strong>:</p>\n<pre><code>import java.time.LocalDate;\nimport java.time.Period;\n\nclass Main {\n    public static void main(String[] args) {\n        LocalDate today = LocalDate.now();\n        LocalDate fortyDaysAgo = today.minusDays(40);\n        Period period = Period.between(fortyDaysAgo, today);\n        System.out.println(period);\n        System.out.printf(&quot;%d year(s) %d month(s) %d day(s)%n&quot;, period.getYears(), period.getMonths(),\n                period.getDays());\n    }\n}\n</code></pre>\n<p><strong>Output from a sample run:</strong></p>\n<pre><code>P1M9D\n0 year(s) 1 month(s) 9 day(s)\n</code></pre>\n<p><a href=\"https://ideone.com/XIrUya\" rel=\"noreferrer\"><kbd>ONLINE DEMO</kbd></a></p>\n<p>Learn more about the modern Date-Time API from <strong><a href=\"https://docs.oracle.com/javase/tutorial/datetime/index.html\" rel=\"noreferrer\">Trail: Date Time</a></strong>.</p>\n"}],"owner":{"user_id":10977681,"display_name":"Tom Carmi"},"view_count":54,"up_vote_count":3,"accepted_answer_id":75163393,"answer_count":1,"score":3,"creation_date":1674063904,"question_id":75163249,"body":"<p>I have 2 dates:</p>\n<pre><code>LocalDate date1 = LocalDate.now().minusDays(40);\nLocalDate date2 = LocalDate.now();\n</code></pre>\n<p>I want to figure out what is the biggest time unit I can pick to define the difference between the 2 (out of days, months, years), and to get its number.\nThe perfect solution for me, I think, would been if <code>Duration</code> of <code>java.time</code> api had also <code>toMonthsPart</code> and <code>toYearsPart</code> as it has <code>toDaysPart</code>. This way I could do this:</p>\n<pre><code>Duration dif = Duration.between(date1, date2);\n\nlong daysPart = dif.toDaysPart();\nif (daysPart &gt; 0) {\n    return ChronoUnit.DAYS.between(date1, date2);\n}\n\nlong monthPart = dif.getMonthsPart();\nif (monthPart &gt; 0) {\n    return ChronoUnit.MONTHS.between(date1, date2);\n}\n\nlong yearPart = dif.getYearsPart();\nif (yearPart &gt; 0) {\n    return ChronoUnit.YEARS.between(date1, date2);\n}\n\nthrow new Exception(&quot;no difference&quot;);\n</code></pre>\n<p>But there is no such methods in the API.\nIs there another package can provide this functionality, or do you know of different approach to achieve my goal?</p>\n"},{"tags":["java","android","flutter","android-studio","jvm"],"answers":[{"owner":{"user_id":2830945,"display_name":"Maaz Aftab"},"up_vote_count":5,"is_accepted":true,"creation_date":1673967660,"answer_id":75148333,"body":"<p>In your zshrc file add.</p>\n<pre><code>export JAVA_HOME=/Applications/Android\\ Studio.app/Contents/jbr/Contents/Home\n</code></pre>\n<p>Restart the android studio. Flutter doctor will give this.</p>\n<pre><code>maazaftab@maazs-MacBook-Pro edge-focus-mobile % flutter doctor\nDoctor summary (to see all details, run flutter doctor -v):\n[âœ“] Flutter (Channel beta, 3.7.0-1.2.pre, on macOS 13.0.1 22A400 darwin-arm64, locale en-PK)\n[âœ“] Android toolchain - develop for Android devices (Android SDK version 33.0.1)\n[âœ“] Xcode - develop for iOS and macOS (Xcode 14.1)\n[âœ“] Chrome - develop for the web\n[!] Android Studio (version 2022.1)\n    âœ— Unable to find bundled Java version.\n[âœ“] IntelliJ IDEA Community Edition (version 2022.3)\n[âœ“] VS Code (version 1.62.3)\n[âœ“] Connected device (2 available)\n[âœ“] HTTP Host Availability\n</code></pre>\n<p>You can ignore the warning <em><strong>âœ— Unable to find bundled Java version.</strong></em> but the code will compile successfully.</p>\n"},{"owner":{"user_id":9143818,"display_name":"Oruj"},"up_vote_count":0,"is_accepted":false,"creation_date":1674108242,"answer_id":75168303,"body":"<p>Open the folder where Android Studio is installed.</p>\n<p>In most cases, it is &quot;C:\\Program Files\\Android\\Android Studio&quot;</p>\n<ol>\n<li>Open the &quot;jbr&quot; folder inside the Android Studio folder (&quot;C:\\Program Files\\Android\\Android Studio\\jbr&quot;), and copy all contents in it.</li>\n<li>Then go back and create a new folder called &quot;jre&quot; -&gt; &quot;C:\\Program Files\\Android\\Android Studio\\jre&quot;</li>\n<li>Paste all contents which you copied from &quot;jbr&quot; folder to &quot;jre&quot; folder.</li>\n<li>Click Start and search for &quot;Environment&quot; and open &quot;Edit the Environment variables&quot; from search result.</li>\n<li>Click to open &quot;Environment variables&quot;</li>\n<li>On &quot;User variables&quot; pane click new and add new variable with name &quot;JAVA_HOME&quot; and path &quot;C:\\Program Files\\Android\\Android Studio\\jre&quot;. Click OK to save.</li>\n<li>Restart Android Studio and run flutter doctor. It will solve the problem.</li>\n</ol>\n<p><a href=\"https://i.stack.imgur.com/cgOgx.png\" rel=\"nofollow noreferrer\">Android Studio folder screenshot</a>\n<a href=\"https://i.stack.imgur.com/29hvv.jpg\" rel=\"nofollow noreferrer\">Environment screenshot</a></p>\n"}],"owner":{"user_id":2830945,"display_name":"Maaz Aftab"},"view_count":1028,"up_vote_count":3,"accepted_answer_id":75148333,"answer_count":2,"score":3,"creation_date":1673967660,"question_id":75148332,"body":"<p>I updated android studio to Electric El, but after updating, it is unable to find Java Runtime.</p>\n<p>Flutter doctor gives this error and the code does not compile.</p>\n<pre><code>maazaftab@maazs-MacBook-Pro edge-focus-mobile % flutter doctor                   \nDoctor summary (to see all details, run flutter doctor -v):\nThe operation couldnâ€™t be completed. Unable to locate a Java Runtime.\nPlease visit http://www.java.com for information on installing Java.\nThe operation couldnâ€™t be completed. Unable to locate a Java Runtime.\nPlease visit http://www.java.com for information on installing Java.\n[âœ“] Flutter (Channel beta, 3.7.0-1.2.pre, on macOS 13.0.1 22A400 darwin-arm64, locale en-PK)\n[!] Android toolchain - develop for Android devices (Android SDK version 31.0.0)\n    âœ— Could not determine java version\n[âœ“] Xcode - develop for iOS and macOS (Xcode 14.1)\n[âœ“] Chrome - develop for the web\n[!] Android Studio (version 2022.1)\n    âœ— Unable to find bundled Java version.\n[âœ“] IntelliJ IDEA Community Edition (version 2022.3)\n[âœ“] VS Code (version 1.62.3)\n[âœ“] Connected device (2 available)\n[âœ“] HTTP Host Availability\n\n! Doctor found issues in 2 categories.\n\n</code></pre>\n"},{"tags":["java","javafx","tableview"],"comments":[{"owner":{"user_id":2189127,"display_name":"James_D"},"edited":false,"comment_id":132500233,"body":"For 1., doesn&#39;t the obvious modification (<code>if (empty || item &lt;= 0) { setGraphic(null); } else { ... }</code>) work?"},{"owner":{"user_id":11441011,"display_name":"maloomeister"},"edited":false,"comment_id":132500323,"body":"@James_D thanks for the suggestion, I already tried this however this doesn&#39;t work. This will make the progress indicator never visible when it&#39;s indeterminate (because then <code>item == -1</code> if I remember correctly)."},{"owner":{"user_id":4815321,"display_name":"mr mcwolf"},"edited":false,"comment_id":132500356,"body":"tasks cannot be restarted. every time you want to run a task you have to create it. from here the table design also becomes wrong."},{"owner":{"user_id":2189127,"display_name":"James_D"},"edited":false,"comment_id":132500388,"body":"Actually, looking at the changes you made to the <code>TestTask</code>, the progress can only either be indeterminate, or 1. If this is the case, I don&#39;t understand the point of observing the <code>progressProperty</code> at all. Just observe the <code>state</code> property, and make the progress indicator invisible, visible with value -1, or visible with value 1 as appropriate."},{"owner":{"user_id":2189127,"display_name":"James_D"},"edited":false,"comment_id":132500404,"body":"For 2. you would need the model class to subclass (or encapsulate) a <code>Service</code>, not a <code>Task</code>."},{"owner":{"user_id":11441011,"display_name":"maloomeister"},"edited":false,"comment_id":132500564,"body":"@James_D yes, that&#39;s the case. I want the indicator to only be indeterminate or 1. Can you explain what you mean by &quot;<i>Just observe the <code>state</code> property ...</i>&quot;? I tought I needed to observe the <code>progressProperty</code> to be able to update the indicator at all. Thanks."},{"owner":{"user_id":2189127,"display_name":"James_D"},"edited":false,"comment_id":132500650,"body":"I mean the <code>state</code> property of the task, instead of the <code>progress</code> property <i>of the task</i>. Then just update the progress property of the indicator."},{"owner":{"user_id":203657,"display_name":"kleopatra"},"edited":false,"comment_id":132501169,"body":"hmm don&#39;t quite understand your requirement: in the comment _ want the indicator to only be indeterminate or 1._ and in the description: _ each row is displayed immediately .. make them visible for each row one after another [after the task is started]_ - so you want to visualize the complete three-state (ready/running == indeterminate/done of the task. So comming back to the first comment by @James_D: why don&#39;t you implement that three-state appearance in the cell by hiding the indicator if not yet started? Please modify the example to demonstrate <i>indicator never visible</i> of you comment"},{"owner":{"user_id":11441011,"display_name":"maloomeister"},"edited":false,"comment_id":132501186,"body":"@James_D Thanks for the hints! Seems like I got 1. working. I was confused because I thought I needed to observe the progress either way. But now observing the <code>state</code> I got it working."},{"owner":{"user_id":11441011,"display_name":"maloomeister"},"edited":false,"comment_id":132501291,"body":"@kleopatra  Yeah I was confused and I got it wrong before, where I weren&#39;t able to set the indicators visible according the task status."},{"owner":{"user_id":2423906,"display_name":"SedJ601"},"edited":false,"comment_id":132501297,"body":"Here is something with similar ideas. <a href=\"https://stackoverflow.com/questions/51955550/remove-tableview-entries-when-status-change\" title=\"remove tableview entries when status change\">stackoverflow.com/questions/51955550/&hellip;</a>"}],"answers":[{"owner":{"user_id":2189127,"display_name":"James_D"},"up_vote_count":5,"is_accepted":true,"creation_date":1673447111,"answer_id":75084558,"body":"<p>Here is a version that implements your first question. With this requirement, the cell is only a function of the task's state. If it's <code>RUNNING</code>, display an indeterminate progress indicator; if it's <code>SUCCEEDED</code> display a progress indicator with value 1; otherwise, display nothing.</p>\n<p>Note the original question is very old and uses a lot of outdated code styles. I've updated accordingly.</p>\n<pre><code>import javafx.application.Application;\nimport javafx.beans.property.ReadOnlyStringProperty;\nimport javafx.beans.property.ReadOnlyStringWrapper;\nimport javafx.concurrent.Task;\nimport javafx.concurrent.Worker;\nimport javafx.scene.Scene;\nimport javafx.scene.control.*;\nimport javafx.scene.layout.BorderPane;\nimport javafx.stage.Stage;\n\nimport java.util.Random;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class ProgressIndicatorTableCellTest extends Application {\n    public void start(Stage primaryStage) {\n        TableView&lt;TestTask&gt; table = new TableView&lt;&gt;();\n        Random rng = new Random();\n        for (int i = 0; i &lt; 3; i++) {\n            table.getItems().add(new TestTask(rng.nextInt(3000) + 2000, &quot;Test&quot;));\n        }\n\n        TableColumn&lt;TestTask, String&gt; nameCol = new TableColumn&lt;&gt;(&quot;Name&quot;);\n        nameCol.setCellValueFactory(data -&gt; data.getValue().nameProperty());\n        nameCol.setPrefWidth(75);\n\n        TableColumn&lt;TestTask, Worker.State&gt; progressCol = new TableColumn&lt;&gt;(&quot;Progress&quot;);\n        progressCol.setCellValueFactory(data -&gt; data.getValue().stateProperty());\n        progressCol.setCellFactory(col -&gt; new ProgressIndicatorTableCell&lt;&gt;());\n\n        table.getColumns().addAll(nameCol, progressCol);\n\n        BorderPane root = new BorderPane();\n        root.setCenter(table);\n        Button btn = new Button(&quot;Start&quot;);\n        btn.setOnAction(actionEvent -&gt; {\n            ExecutorService executor = Executors.newSingleThreadExecutor(r -&gt; {\n                Thread t = new Thread(r);\n                t.setDaemon(true);\n                return t;\n            });\n\n            for (TestTask task : table.getItems()) {\n                executor.submit(task);\n            }\n        });\n\n        root.setBottom(btn);\n        primaryStage.setScene(new Scene(root));\n        primaryStage.show();\n\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n\n    public static class TestTask extends Task&lt;Void&gt; {\n        private final int waitTime; // milliseconds\n        final ReadOnlyStringWrapper name = new ReadOnlyStringWrapper();\n        public static final int NUM_ITERATIONS = 100;\n\n        public TestTask(int waitTime, String name) {\n            this.waitTime = waitTime;\n            this.name.set(name);\n        }\n\n        public ReadOnlyStringProperty nameProperty() {\n            return name.getReadOnlyProperty();\n        }\n\n        @Override\n        protected Void call() throws Exception {\n            this.updateProgress(ProgressIndicator.INDETERMINATE_PROGRESS, 1);\n            Thread.sleep(waitTime);\n            this.updateProgress(1, 1);\n            return null;\n        }\n    }\n}\n\nclass ProgressIndicatorTableCell&lt;S&gt; extends TableCell&lt;S, Worker.State&gt; {\n\n    private final ProgressIndicator progressIndicator = new ProgressIndicator();\n\n    @Override\n    protected void updateItem(Worker.State state, boolean empty) {\n        super.updateItem(state, empty);\n        if (state == Worker.State.SUCCEEDED) {\n            progressIndicator.setProgress(1);\n            setGraphic(progressIndicator);\n        } else if (state == Worker.State.RUNNING) {\n            progressIndicator.setProgress(-1);\n            setGraphic(progressIndicator);\n        } else {\n            setGraphic(null);\n        }\n    }\n\n}\n</code></pre>\n<hr />\n<p>To allow for &quot;restarting&quot;, you should use a <code>Service</code> instead of just a <code>Task</code>. This version will allow for a restart if the button is pressed multiple times, returning everything to the initial state before proceeding.</p>\n<p>This version also factors the processing work out of the model class, which is desirable for properly assigning responsibilities to classes:</p>\n<p>Item.java:</p>\n<pre><code>import javafx.beans.property.ObjectProperty;\nimport javafx.beans.property.ReadOnlyStringProperty;\nimport javafx.beans.property.ReadOnlyStringWrapper;\nimport javafx.beans.property.SimpleObjectProperty;\n\npublic class Item {\n\n    public enum State {WAITING, PROCESSING, READY}\n\n    final ReadOnlyStringWrapper name = new ReadOnlyStringWrapper();\n\n    private final ObjectProperty&lt;State&gt; state = new SimpleObjectProperty&lt;&gt;(State.WAITING);\n\n\n    public Item(String name) {\n        this.name.set(name);\n    }\n\n    public ReadOnlyStringProperty nameProperty() {\n        return name.getReadOnlyProperty();\n    }\n\n    public State getState() {\n        return state.get();\n    }\n\n    public ObjectProperty&lt;State&gt; stateProperty() {\n        return state;\n    }\n\n    public void setState(State state) {\n        this.state.set(state);\n    }\n}\n</code></pre>\n<p>ProcessManager.java:</p>\n<pre><code>import javafx.application.Platform;\nimport javafx.concurrent.Service;\nimport javafx.concurrent.Task;\n\nimport java.util.List;\nimport java.util.Random;\n\npublic class ProcessManager {\n\n    private final List&lt;Item&gt; items;\n\n    private Random rng = new Random();\n\n    private Service&lt;Void&gt; service = new Service&lt;&gt;() {\n\n        @Override\n        protected Task&lt;Void&gt; createTask() {\n            return new Task&lt;&gt;() {\n                @Override\n                protected Void call() throws Exception {\n                    for (Item task: items) {\n                        try {\n                            Platform.runLater(() -&gt; task.setState(Item.State.PROCESSING));\n                            Thread.sleep(2000 + rng.nextInt(3000));\n                            Platform.runLater(() -&gt; task.setState(Item.State.READY));\n                        } catch (InterruptedException exc) {\n                            Thread.currentThread().interrupt();\n                        }\n                        if (isCancelled()) {\n                            Platform.runLater(() -&gt; task.setState(Item.State.WAITING));\n                            break;\n                        }\n                    }\n                    return null;\n                }\n            };\n        }\n    };\n\n\n    public ProcessManager(List&lt;Item&gt; items) {\n        this.items = items ;\n        service.setOnCancelled(e -&gt; items.forEach(task -&gt; task.setState(Item.State.WAITING)));\n    }\n\n\n    public void process() {\n        service.restart();\n    }\n}\n</code></pre>\n<p>and the application:</p>\n<pre><code>import javafx.application.Application;\nimport javafx.collections.FXCollections;\nimport javafx.collections.ObservableList;\nimport javafx.scene.Scene;\nimport javafx.scene.control.*;\nimport javafx.scene.layout.BorderPane;\nimport javafx.stage.Stage;\n\npublic class ProgressIndicatorTableCellTest extends Application {\n\n    public void start(Stage primaryStage) {\n\n        ObservableList&lt;Item&gt; tasks = FXCollections.observableArrayList();\n\n        ProcessManager processManager = new ProcessManager(tasks);\n\n        TableView&lt;Item&gt; table = new TableView&lt;&gt;();\n        for (int i = 0; i &lt; 3; i++) {\n            Item task = new Item(&quot;Item &quot; + (i + 1));\n            tasks.add(task);\n        }\n        table.setItems(tasks);\n\n        TableColumn&lt;Item, String&gt; nameCol = new TableColumn&lt;&gt;(&quot;Name&quot;);\n        nameCol.setCellValueFactory(data -&gt; data.getValue().nameProperty());\n        nameCol.setPrefWidth(75);\n\n        TableColumn&lt;Item, Item.State&gt; progressCol = new TableColumn&lt;&gt;(&quot;Progress&quot;);\n        progressCol.setCellValueFactory(data -&gt; data.getValue().stateProperty());\n        progressCol.setCellFactory(col -&gt; new TableCell&lt;&gt;() {\n            private final ProgressIndicator indicator = new ProgressIndicator();\n            @Override\n            protected void updateItem(Item.State state, boolean empty) {\n                super.updateItem(state, empty);\n                if (state == Item.State.PROCESSING) {\n                    indicator.setProgress(-1);\n                    setGraphic(indicator);\n                } else if (state == Item.State.READY) {\n                    indicator.setProgress(1);\n                    setGraphic(indicator);\n                } else {\n                    setGraphic(null);\n                }\n            }\n        });\n\n        table.getColumns().addAll(nameCol, progressCol);\n\n        BorderPane root = new BorderPane();\n        root.setCenter(table);\n        Button btn = new Button(&quot;Start&quot;);\n        btn.setOnAction(actionEvent -&gt; processManager.process());\n\n        root.setBottom(btn);\n        primaryStage.setScene(new Scene(root));\n        primaryStage.show();\n\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n\n}\n</code></pre>\n"}],"owner":{"user_id":11441011,"display_name":"maloomeister"},"view_count":69,"up_vote_count":3,"accepted_answer_id":75084558,"answer_count":1,"score":3,"creation_date":1673442006,"question_id":75083453,"body":"<p>I'm trying to do the following in JavaFX:</p>\n<ul>\n<li>Have a <code>TableView</code> with multiple rows.</li>\n<li>Each row contains columns with text and one Progress/Status column.</li>\n<li>When a specific <code>Button</code> is pressed, for each row of the <code>TableView</code> some task should be performed, one row after the other. (e.g. check some data, ...)</li>\n<li>While this task is performed, a indeterminate <code>ProgressIndicator</code> shall be shown in the Status column, until the task for this row is finished, then the indicator shows as done.</li>\n<li>When all tasks for each row are done, the button can be pressed again to reset the status and execute the tasks again.</li>\n</ul>\n<hr />\n<p>I had found some help in <a href=\"https://stackoverflow.com/questions/16721380/javafx-update-progressbar-in-tableview-from-task\">this related Stackoverflow post</a> and also <a href=\"https://community.oracle.com/tech/developers/discussion/2533798/table-cell-progress-indicator\" rel=\"nofollow noreferrer\">here</a> and tried to tweak this as needed but got stuck on some issues:</p>\n<ol>\n<li>Currently, each <code>ProgressIndicator</code> for each row is displayed immediately (as indeterminate) when I run the program. How can I only activate them / make them visible for each row one after another once the button is pressed?</li>\n<li>Pressing the button again once the fake tasks are done does not restart it. How would I have to modify / rebuild the program to make resets possible?</li>\n<li>Does the overall approach make sense?</li>\n</ol>\n<hr />\n<p>My current runnable code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.util.Random;\nimport java.util.concurrent.*;\n\nimport javafx.application.Application;\nimport javafx.beans.property.ReadOnlyStringProperty;\nimport javafx.beans.property.ReadOnlyStringWrapper;\nimport javafx.beans.value.ObservableValue;\nimport javafx.concurrent.Task;\nimport javafx.scene.Scene;\nimport javafx.scene.control.*;\nimport javafx.scene.control.cell.PropertyValueFactory;\nimport javafx.scene.layout.BorderPane;\nimport javafx.stage.Stage;\nimport javafx.util.Callback;\n\npublic class ProgressIndicatorTableCellTest extends Application {\n    public void start(Stage primaryStage) {\n        TableView&lt;TestTask&gt; table = new TableView&lt;&gt;();\n        Random rng = new Random();\n        for (int i = 0; i &lt; 3; i++) {\n            table.getItems().add(new TestTask(rng.nextInt(3000) + 2000, &quot;Test&quot;));\n        }\n\n        TableColumn&lt;TestTask, String&gt; nameCol = new TableColumn(&quot;Name&quot;);\n        nameCol.setCellValueFactory(new PropertyValueFactory&lt;TestTask, String&gt;(&quot;name&quot;));\n        nameCol.setPrefWidth(75);\n\n        TableColumn&lt;TestTask, Double&gt; progressCol = new TableColumn(&quot;Progress&quot;);\n        progressCol.setCellValueFactory(new PropertyValueFactory&lt;TestTask, Double&gt;(&quot;progress&quot;));\n        progressCol.setCellFactory(ProgressIndicatorTableCell.&lt;TestTask&gt;forTableColumn());\n\n        table.getColumns().addAll(nameCol, progressCol);\n\n        BorderPane root = new BorderPane();\n        root.setCenter(table);\n        Button btn = new Button(&quot;Start&quot;);\n        btn.setOnAction(actionEvent -&gt; {\n            ExecutorService executor = Executors.newSingleThreadExecutor();\n\n            for (TestTask task : table.getItems()) {\n                executor.submit(task);\n            }\n        });\n\n        root.setBottom(btn);\n        primaryStage.setScene(new Scene(root));\n        primaryStage.show();\n\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n\n    public static class TestTask extends Task&lt;Void&gt; {\n        private final int waitTime; // milliseconds\n        final ReadOnlyStringWrapper name = new ReadOnlyStringWrapper();\n        public static final int NUM_ITERATIONS = 100;\n\n        public TestTask(int waitTime, String name) {\n            this.waitTime = waitTime;\n            this.name.set(name);\n        }\n\n        public ReadOnlyStringProperty nameProperty() {\n            return name.getReadOnlyProperty();\n        }\n\n        @Override\n        protected Void call() throws Exception {\n            this.updateProgress(ProgressIndicator.INDETERMINATE_PROGRESS, 1);\n            Thread.sleep(waitTime);\n            this.updateProgress(1, 1);\n            return null;\n        }\n    }\n}\n\nclass ProgressIndicatorTableCell&lt;S&gt; extends TableCell&lt;S, Double&gt; {\n    public static &lt;S&gt; Callback&lt;TableColumn&lt;S, Double&gt;, TableCell&lt;S, Double&gt;&gt; forTableColumn() {\n        return new Callback&lt;TableColumn&lt;S, Double&gt;, TableCell&lt;S, Double&gt;&gt;() {\n            @Override\n            public TableCell&lt;S, Double&gt; call(TableColumn&lt;S, Double&gt; param) {\n                return new ProgressIndicatorTableCell&lt;&gt;();\n            }\n        };\n    }\n\n    private final ProgressIndicator progressIndicator;\n    private ObservableValue observable;\n\n    public ProgressIndicatorTableCell() {\n        this.progressIndicator = new ProgressIndicator();\n        setGraphic(progressIndicator);\n    }\n\n    @Override\n    public void updateItem(Double item, boolean empty) {\n        super.updateItem(item, empty);\n\n        if (empty) {\n            setGraphic(null);\n        } else {\n            progressIndicator.progressProperty().unbind();\n\n            observable = getTableColumn().getCellObservableValue(getIndex());\n            if (observable != null) {\n                progressIndicator.progressProperty().bind(observable);\n            } else {\n                progressIndicator.setProgress(item);\n            }\n\n            setGraphic(progressIndicator);\n        }\n    }\n}\n</code></pre>\n<p>And the current output:</p>\n<p><a href=\"https://i.stack.imgur.com/3NrVp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3NrVp.png\" alt=\"enter image description here\" /></a>\n<a href=\"https://i.stack.imgur.com/uvsEz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uvsEz.png\" alt=\"enter image description here\" /></a></p>\n"},{"tags":["java","spring-boot","spring-boot-starter","configurationproperties"],"comments":[{"owner":{"user_id":11656070,"display_name":"Alisher"},"edited":false,"comment_id":132430381,"body":"PS Using spring boot 3.0.1"},{"owner":{"user_id":20460294,"display_name":"Anon"},"edited":false,"comment_id":132430789,"body":"try adding the NoArgsConstructor on the class TimeFormatConf but with the code you have now it should be working maybe its something with the new version of spring also use RequiredArgsConstructor annotation if you are using final also you can comment Configuration and EnableConfigurationProperties(TimeFormatConf.class) in DateTimeConfigurer i dont think they are doing anything"},{"owner":{"user_id":11656070,"display_name":"Alisher"},"edited":false,"comment_id":132434300,"body":"Well, I have tried adding those, but it does not make a difference. Also, properties are bound through setters unless you specify constructor binding annotation."},{"owner":{"user_id":20460294,"display_name":"Anon"},"edited":false,"comment_id":132434915,"body":"ok i just tested and you just need to add Configuration annotation to TimeFormatConf class and it will work no problem"},{"owner":{"user_id":20460294,"display_name":"Anon"},"edited":false,"comment_id":132435285,"body":"update: just put ConfigurationPropertiesScan annotation on the  main class near the SpringBootApplication adding Configuration annotation was the old way of doing it my bad"}],"answers":[{"owner":{"user_id":11656070,"display_name":"Alisher"},"up_vote_count":5,"is_accepted":true,"creation_date":1673782245,"answer_id":75124719,"body":"<p>There seems to be a change in the way configurations beans are detected by Spring since version 2.7, it seems to be covered in this migration <a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#auto-configuration-files\" rel=\"noreferrer\">guide</a></p>\n<p>Basically, instead of providing configuration in <code>META-INF/spring.factories</code>, you would do so in <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code></p>\n"}],"owner":{"user_id":11656070,"display_name":"Alisher"},"view_count":902,"up_vote_count":4,"accepted_answer_id":75124719,"answer_count":1,"score":3,"creation_date":1673131527,"question_id":75044304,"body":"<p>I am creating a Maven artifact with following classes and configuration in custom Spring Starter project:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ConfigurationProperties(prefix = &quot;commons.time.formats&quot;)\n@Getter\n@Setter\npublic class TimeFormatConf {\n... fields\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@Component\n@Configuration\n@AllArgsConstructor\n@EnableConfigurationProperties(TimeFormatConf.class)\n@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)\npublic class DateTimeConfigurer {\n  private final TimeFormatConf timeFormatConf;\n\n  @EventListener(ApplicationReadyEvent.class)\n  public void configureTimeFormat() {\n    TimeZone.setDefault(TimeZone.getTimeZone(timeFormatConf.getDynamicZone()));\n    System.setProperty(&quot;user.timezone&quot;, timeFormatConf.getDynamicZone());\n  }\n}\n</code></pre>\n<p>And spring.factories (<code>src/main/resources/META-INF/spring.factories</code>):</p>\n<pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\\n[package].DateTimeConfigurer,\\\n...\n</code></pre>\n<p>When I try to autowire a TimeFormatConf class my spring application crashes at start up as it cannot find a bean of TimeFormatConf class:</p>\n<blockquote>\n<p>Parameter 0 of constructor in com.some.package.b.Class required a bean\nof type 'com.some.package.a.TimeFormatConf' that could not be found.</p>\n</blockquote>\n<p>The artifact is present with correct configuration on classpath. So it has to do something with either declaration or configuration of Spring.</p>\n<p>I have also tried adding <code>@Component</code> on properties class and <code>@ComponentScan</code> on configuration class does not have any effect.</p>\n<p>Reverting to Spring Boot 2.7.7 on both projects fixed the problem. So it seems to be a bug or at least lack of documentation. I have opened an issue to follow this up with spring team: <a href=\"https://github.com/spring-projects/spring-boot/issues/33720\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-boot/issues/33720</a></p>\n"},{"tags":["java","rest","exception","swagger"],"comments":[{"owner":{"user_id":3636601,"display_name":"Jens"},"edited":false,"comment_id":132381254,"body":"Please share the complete stacktrace"},{"owner":{"user_id":13321125,"display_name":"Amber Akkermans"},"edited":false,"comment_id":132381272,"body":"Added to my original question"}],"answers":[{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"up_vote_count":5,"is_accepted":false,"creation_date":1672913029,"answer_id":75016728,"body":"<p>You're asking JAXB to put the peg (a number value received from the JSON and identifier by swagger as $int64) in the hole (the <code>Instant expires;</code> field in your <code>AccountClientIdentifierEntity</code> class).</p>\n<p>Turns out, that's a square peg and a round hole. JAXB tries its best, and given that it has no idea what an <code>Instant</code> might be, is planning to construct one and perhaps find a set method maybe. That's not how <code>Instant</code> works, however; you're looking specifically for <code>Instant.ofEpochSecond</code> or <code>ofEpochMilli</code>, and we are now truly getting into the root issue here: What does that $int64 even mean? Is it seconds since 1970? milliseconds? Nanofurlongs? Perhaps it's days since 1902, using the decimal fraction for hours and seconds?</p>\n<p>Asking JAXB to just take a flying wild stab at it seems unreasonable, and indeed, isn't a thing JAXB can do, nor will it ever. You must tell it what to do.</p>\n<p>To do this, you tell JAXB that there is a specific unmarshaller available for that field.</p>\n<p>An <code>@XmlJavaTypeAdapter</code> annotation should be able to do the job; you can annotate the <code>expires</code> field with it, passing a class reference to a class that implements <a href=\"https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/adapters/XmlAdapter.html\" rel=\"noreferrer\"><code>XmlAdapter</code></a>.</p>\n<p>The <a href=\"https://github.com/davidkarlsen/jaxb-java-time-adapters\" rel=\"noreferrer\"><code>jaxb-java-time-adapters</code></a> project could be useful here; possibly only to look at the source to know what to do.</p>\n"}],"owner":{"user_id":13321125,"display_name":"Amber Akkermans"},"view_count":270,"up_vote_count":4,"answer_count":1,"score":3,"creation_date":1672911721,"question_id":75016432,"body":"<p>I get the error <code>java.lang.NoSuchMethodError: java.time.Instant.&lt;init&gt;()</code> when in a rest-API documentation (swagger) I try to do a post request with as body the following json:</p>\n<pre><code>{\n  &quot;accountId&quot;: &quot;string&quot;,\n  &quot;name&quot;: &quot;string&quot;,\n  &quot;value&quot;: &quot;string&quot;,\n  &quot;expires&quot;: 0\n}\n</code></pre>\n<p>this maps to the model:</p>\n<pre><code>AccountClientIdentifierEntity{\naccountId   string\nname    string\nvalue   string\nexpires integer($int64)\n}\n</code></pre>\n<p>Now in my Java code this expires attribute is actually an Instant, but it somehow gets parsed as an Integer here, so I guess my problem lies here, when I post with the &quot;0&quot; instead of an Instant. Can someone help me to fix this, or at least catch the error correctly?</p>\n<p>Full code:\nEntity:</p>\n<pre><code>/**\n * The Class UserEntity.\n */\n@XmlRootElement(name = &quot;accountClientIdentifier&quot;)\n@XmlType(propOrder = { &quot;accountId&quot;, &quot;name&quot;, &quot;value&quot;, &quot;expires&quot;})\n@JsonInclude(JsonInclude.Include.NON_NULL)\npublic class AccountClientIdentifierEntity {\n\n    public static void registerToContextProvider(){\n        try {\n            CustomContextProvider.registerClass(com.inteno.iopsys.plugin.restapi.entity.AccountClientIdentifierEntity.class);\n        } catch (Exception e){\n            Log.error(&quot;Could not register AccountClientIdentifierEntity: &quot;+e.getMessage());\n        }\n    }\n\n    /** The username. */\n    private String accountId;\n\n    /** The name. */\n    private String name;\n\n    /** The value. */\n    private String value;\n\n    /** expires. */\n    private Instant expires;\n\n\n    /**\n     * Instantiates a new user entity.\n     */\n    public AccountClientIdentifierEntity() {\n\n    }\n\n    /**\n     * Instantiates a new user entity.\n     *\n     * @param accountId\n     *            the account ID\n     * @param name\n     *            the name\n     * @param value\n     *            the value\n     */\n    public AccountClientIdentifierEntity(String accountId, String name, String value) {\n        this.accountId = accountId;\n        this.name = name;\n        this.value = value;\n    }\n</code></pre>\n<ul>\n<li>getters &amp; setters</li>\n</ul>\n<p>service path:</p>\n<pre><code>@POST\n    @Path(&quot;/identifiers&quot;)\n    @ApiOperation(value = &quot;Add a new account client identifier&quot;)\n    @ApiResponses(value = {@ApiResponse(code = 201, message = &quot;Created&quot;)})\n    public Response createAccountClientId(\n            @ApiParam(value = &quot;The new identifier to create&quot;, required = true) AccountClientIdentifierEntity accountClientIdentifierEntity\n    ) throws ServiceException {\n        controller.createOrUpdateAccountClientIdentifier(accountClientIdentifierEntity);\n        return Response.status(Response.Status.CREATED).build();\n    }\n</code></pre>\n<p>Stacktrace:</p>\n<pre><code>2023.01.05 09:25:21 WARN  [Jetty-QTP-API-1-821]: HttpChannel.java:700 - /restapi/v1/account/identifiers\njava.lang.NoSuchMethodError: java.time.Instant.&lt;init&gt;()\n        at com.sun.xml.bind.v2.ClassFactory.tryGetDeclaredConstructor(ClassFactory.java:115) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.ClassFactory.create0(ClassFactory.java:76) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.ClassBeanInfoImpl.createInstance(ClassBeanInfoImpl.java:255) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallingContext.createInstance(UnmarshallingContext.java:672) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.StructureLoader.startElement(StructureLoader.java:158) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallingContext._startElement(UnmarshallingContext.java:547) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallingContext.startElement(UnmarshallingContext.java:526) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.InterningXmlVisitor.startElement(InterningXmlVisitor.java:45) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.StAXStreamConnector.handleStartElement(StAXStreamConnector.java:216) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.StAXStreamConnector.bridge(StAXStreamConnector.java:150) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal0(UnmarshallerImpl.java:385) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal(UnmarshallerImpl.java:364) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        at com.sun.jersey.json.impl.BaseJSONUnmarshaller.unmarshalJAXBElementFromJSON(BaseJSONUnmarshaller.java:111) ~[?:?]\n        at com.sun.jersey.json.impl.BaseJSONUnmarshaller.unmarshalFromJSON(BaseJSONUnmarshaller.java:100) ~[?:?]\n        at com.sun.jersey.json.impl.provider.entity.JSONRootElementProvider.readFrom(JSONRootElementProvider.java:154) ~[?:?]\n        at com.sun.jersey.core.provider.jaxb.AbstractRootElementProvider.readFrom(AbstractRootElementProvider.java:111) ~[?:?]\n        at com.sun.jersey.spi.container.ContainerRequest.getEntity(ContainerRequest.java:490) ~[?:?]\n        at com.sun.jersey.server.impl.model.method.dispatch.EntityParamDispatchProvider$EntityInjectable.getValue(EntityParamDispatchProvider.java:123) ~[?:?]\n        at com.sun.jersey.server.impl.inject.InjectableValuesProvider.getInjectableValues(InjectableValuesProvider.java:86) ~[?:?]\n        at com.sun.jersey.server.impl.model.method.dispatch.AbstractResourceMethodDispatchProvider$EntityParamInInvoker.getParams(AbstractResourceMethodDispatchProvider.java:153) ~[?:?]\n        at com.sun.jersey.server.impl.model.method.dispatch.AbstractResourceMethodDispatchProvider$ResponseOutInvoker._dispatch(AbstractResourceMethodDispatchProvider.java:203) ~[?:?]\n        at com.sun.jersey.server.impl.model.method.dispatch.ResourceJavaMethodDispatcher.dispatch(ResourceJavaMethodDispatcher.java:75) ~[?:?]\n        at com.sun.jersey.server.impl.uri.rules.HttpMethodRule.accept(HttpMethodRule.java:302) ~[?:?]\n        at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:147) ~[?:?]\n        at com.sun.jersey.server.impl.uri.rules.ResourceClassRule.accept(ResourceClassRule.java:108) ~[?:?]\n        at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:147) ~[?:?]\n        at com.sun.jersey.server.impl.uri.rules.RootResourceClassesRule.accept(RootResourceClassesRule.java:84) ~[?:?]\n        at com.sun.jersey.server.impl.application.WebApplicationImpl._handleRequest(WebApplicationImpl.java:1542) ~[?:?]        at com.sun.jersey.server.impl.application.WebApplicationImpl._handleRequest(WebApplicationImpl.java:1473) ~[?:?]        at com.sun.jersey.server.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:1419) ~[?:?]\n        at com.sun.jersey.server.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:1409) ~[?:?]\n        at com.sun.jersey.spi.container.servlet.WebComponent.service(WebComponent.java:409) ~[?:?]\n        at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:558) ~[?:?]\n        at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:733) ~[?:?]\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[jetty-servlet-api-4.0.6.jar:?]\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:764) ~[jetty-servlet-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:508) ~[jetty-servlet-10.0.5.jar:10.0.5]        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:221) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1373) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:176) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:463) ~[jetty-servlet-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:174) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1295) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:129) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.handler.HandlerList.handle(HandlerList.java:51) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.Server.handle(Server.java:562) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.HttpChannel.lambda$handle$0(HttpChannel.java:399) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:656) ~[jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:391) [jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:282) [jetty-server-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:319) [jetty-io-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:100) [jetty-io-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.io.ssl.SslConnection$DecryptedEndPoint.onFillable(SslConnection.java:538) [jetty-io-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:387) [jetty-io-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.io.ssl.SslConnection$2.succeeded(SslConnection.java:161) [jetty-io-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:100) [jetty-io-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.io.SocketChannelEndPoint$1.run(SocketChannelEndPoint.java:101) [jetty-io-10.0.5.jar:10.0.5]        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [jetty-util-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [jetty-util-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [jetty-util-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [jetty-util-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:378) [jetty-util-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:894) [jetty-util-10.0.5.jar:10.0.5]\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1038) [jetty-util-10.0.5.jar:10.0.5]\n        at java.lang.Thread.run(Thread.java:834) [?:?]\nCaused by: java.lang.NoSuchMethodException: java.time.Instant.&lt;init&gt;()\n        at java.lang.Class.getConstructor0(Class.java:3350) ~[?:?]\n        at java.lang.Class.getDeclaredConstructor(Class.java:2554) ~[?:?]\n        at com.sun.xml.bind.v2.ClassFactory.tryGetDeclaredConstructor(ClassFactory.java:107) ~[jaxb-runtime-2.3.2.jar:2.3.2]\n        ... 65 more\n</code></pre>\n"},{"tags":["java","spring-boot","jodatime","java-time"],"comments":[{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132342585,"body":"Do I understand correctly that you need a java.time <i>datetime object</i> that <i>represents</i> <code>2022-10-01T00:00:00.000Z</code>? Or are you needing a <i>string</i> with this exact content? Please distinguish between the data itself and the format of the string representation of the data."},{"owner":{"user_id":19198847,"display_name":"Umang Pachaury"},"edited":false,"comment_id":132342857,"body":"Yes, I need a java.time datetime object that represents the format not a String. Thanks for correcting me appreciate it. Thanks and Regards"}],"answers":[{"owner":{"user_id":1712135,"display_name":"deHaar"},"up_vote_count":5,"is_accepted":true,"creation_date":1672753494,"answer_id":74994213,"body":"<p>The <code>String</code> <code>&quot;2022-10-01T00:00:00.000&quot;</code> can be parsed to a <code>LocalDateTime</code> because it only consists of year, month of year, day of month, hour of day, minute of hour, second of minute and fractions of second.</p>\n<p>Your desired output <code>String</code> <code>&quot;2022-10-01T00:00:00.000Z&quot;</code> represents the same values plus an offset, the <code>Z</code> for <em>Zulu</em> time, which basically means UTC.</p>\n<p>If you want to <em>add</em> an offset to the input <code>String</code> with <code>java.time</code>, you can parse it to a <code>LocalDateTime</code> and then append the desired offset, which results in an <code>OffsetDateTime</code>. You can print that in a desired format using a <code>DateTimeFormatter</code>, either use a prebuilt one or define one yourself.</p>\n<p>Here's a small example:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static void main(String[] args) {\n    // input value\n    String dateTime = &quot;2022-10-01T00:00:00.000&quot;;\n    // parse it and append an offset\n    OffsetDateTime odt = LocalDateTime.parse(dateTime).atOffset(ZoneOffset.UTC);\n    // define a formatter that formats as desired\n    DateTimeFormatter dtf = DateTimeFormatter.ofPattern(&quot;uuuu-MM-dd'T'HH:mm:ss.SSSX&quot;);\n    // and print the OffsetDateTime using that formatter\n    System.out.println(odt.format(dtf));\n}\n</code></pre>\n<p>Output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>2022-10-01T00:00:00.000Z\n</code></pre>\n<hr />\n<h3>Clarification update:</h3>\n<p>There is just a single instance <code>OffsetDateTime</code> in my example with the following values:</p>\n<ul>\n<li>year (2022)</li>\n<li>month of year (10)</li>\n<li>day of month (1)</li>\n<li>hour of day (0)</li>\n<li>minute of hour (0)</li>\n<li>second of minute (0)</li>\n<li>franctions of second (0)</li>\n<li>offset (UTC / +00:00)</li>\n</ul>\n<p>This instance of <code>OffsetDateTime</code> can be used for calculations (e.g. add/subtract days, months or other units) and it can be formatted as <code>String</code>. It also has a <code>toString()</code> method we don't have under control, but is used if you don't explicitly format it.</p>\n<p>The following lines (first one is the last of my example above) show some different usages:</p>\n<pre><code>// print formatted by the DateTimeFormatter from the above example\nSystem.out.println(odt.format(dtf));\n// print the object directly, implicitly using its toString()\nSystem.out.println(odt);\n// print formatted by a prebuilt DateTimeFormatter (several are available)\nSystem.out.println(odt.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME));\n// print with a formatter that uses locale dependant expressions like month names\nSystem.out.println(odt.format(\n                DateTimeFormatter.ofPattern(&quot;EEEE, MMM dd HH:mm:ss xxx&quot;,\n                                            Locale.ENGLISH)));\n</code></pre>\n<p>the last one also uses a different representation for UTC: instead of <code>Z</code> it shows the offset in hours and minutes.</p>\n<p>Output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>2022-10-01T00:00:00.000Z\n2022-10-01T00:00Z\n2022-10-01T00:00:00Z\nSaturday, Oct 01 00:00:00 +00:00\n</code></pre>\n"}],"owner":{"user_id":19198847,"display_name":"Umang Pachaury"},"view_count":133,"up_vote_count":3,"accepted_answer_id":74994213,"answer_count":1,"score":3,"creation_date":1672752696,"question_id":74994050,"body":"<p>I am trying to update my existing elasticsearch springboot project and as the source code is fairly old it still uses joda time. Now I have to upgrade all the functions of Joda time to java time. Now in the project We use Date Time of Joda Time</p>\n<p>Code Sample for Joda Time</p>\n<pre><code>DateTime target = new DateTime(String targetDate, UTC);\n</code></pre>\n<p>We use this function currently in our code to convert a String to Date.\nUsing this function the String</p>\n<p><code>2022-10-01T00:00:00.000</code></p>\n<p>gets converted to</p>\n<p><code>2022-10-01T00:00:00.000Z</code></p>\n<p>I am trying to replicate the same in java time.</p>\n<p>I tried to parse the <code>targetDate</code> using <code>OffsetDateTime</code> and <code>ZonedDateTime</code> but both gave me errors.</p>\n<blockquote>\n<p>Text '2022-10-01T00:00:00.0000' could not be parsed at index 24</p>\n</blockquote>\n<p>After some attempts I was able to move forward by using <code>LocalDateTime</code></p>\n<pre><code>LocalDateTime target = LocalDateTime.parse(String targetDate);\n</code></pre>\n<p>Which was able to parse the String but the format was not correct the format I got was</p>\n<p><code>2022-10-01T00:00Z</code></p>\n<p>I also tried using the formatter with LocalDateTime</p>\n<pre><code>DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd'T'HH:mm:ss.SSSS'Z'&quot;);\nLocalDateTime target= LocalDateTime.parse(targetDate,formatter);\n</code></pre>\n<p>But This Still gave me the Error</p>\n<blockquote>\n<p>Text '2022-10-01T00:00:00.0000' could not be parsed at index 24</p>\n</blockquote>\n<p>Now I am a bit confused regarding this.</p>\n<p>Any help is appreciated.\nAnd Please correct me if my way of asking question or formatting is wrong at any point still new to this.</p>\n<p>Regards.</p>\n<p>EDIT: Sorry for the confusion but as pointed out I should have mentioned that I want the returned value as the <em>java.time datetime</em> object and not a <em>String</em> so that I can further perform some logic on it. Sorry for this.</p>\n<p>Thanks and Regards</p>\n"},{"tags":["java"],"comments":[{"owner":{"user_id":839733,"display_name":"Abhijit Sarkar"},"edited":false,"comment_id":134412851,"body":"Thereâ€™s a <code>String</code> constructor that takes a <code>char[]</code> and <code>StringBuffer.toString</code> yields a string. But you couldâ€™ve found these out easily from Javadocs, so, Iâ€™m not sure if thereâ€™s another question that you meant to ask. If youâ€™re using 3pp libraries that accept passwords as strings, thereâ€™s nothing you can do except use another library."},{"owner":{"user_id":438992,"display_name":"Dave Newton"},"edited":false,"comment_id":134412901,"body":"@AbhijitSarkar The question wasn&#39;t how to convert, the question was how to convert w/o ending up in the same place."},{"owner":{"user_id":839733,"display_name":"Abhijit Sarkar"},"edited":false,"comment_id":134412929,"body":"What is this â€œsame placeâ€? Is the question â€œhow to convert to string without converting to string?â€"},{"owner":{"user_id":13290159,"display_name":"0x150"},"edited":false,"comment_id":134412955,"body":"@AbhijitSarkar the question was how to avoid a password stored as String being possibly gc&#39;d and showing up in a heap dump, which is a valid concern. to my knowledge tho, i don&#39;t think this is possible"},{"owner":{"user_id":438992,"display_name":"Dave Newton"},"edited":false,"comment_id":134412994,"body":"@AbhijitSarkar It&#39;s unlikely you don&#39;t understand the question/concern. The last sentence of your comment is the correct answer and all that was necessary."},{"owner":{"user_id":15314575,"display_name":"QuinncyJones"},"edited":false,"comment_id":134413043,"body":"The problem isn&#39;t the String object, it&#39;s the fact that there is a &#39;secret&#39; or password in there!"},{"owner":{"user_id":6950847,"display_name":"zeg"},"edited":false,"comment_id":134413066,"body":"read the password from os.environment instead of placing it hardcoded into your application if possible. and do not store it in a string, but read it from os.env like needed. also you might want other libraries"},{"owner":{"user_id":13963086,"display_name":"k314159"},"edited":false,"comment_id":134413361,"body":"You could use reflection, e.g. <code>field = String.class.getDeclaredField(&quot;value&quot;); field.setAccessible(true);</code> and then fill it with 0s, but to do that you have to relax the JVM security mechanisms to an extend that will make it more risky than if you just stored the password in the String."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134413400,"body":"Only interned strings are in the string pool, and only string literals or strings explicitly interned with <code>String#intern()</code> are interned, so is this really a problem to focus on?"}],"answers":[{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"up_vote_count":4,"is_accepted":true,"creation_date":1683735728,"answer_id":76220662,"body":"<p>You can't avoid creating a <code>String</code> if you need to call an API that requires a <code>String</code>. As long as you avoid string literals or explicitly interned strings, strings don't end up in the string pool.</p>\n<p>This is also an impossible problem to solve. For example, if this is a password for a database connection pool, the password needs to be available for the lifetime of the program to be able to create new connections. And even if you could provide the password in some clearable way like a <code>char[]</code>, <code>CharBuffer</code>, <code>StringBuilder</code>, etc., there is no guarantee that the API you're calling doesn't transform it to a string, or makes a copy, etc., etc.</p>\n<p>Even using a <code>char[]</code> does not guarantee that you're able to correctly purge it from memory: Java garbage collectors can and will move objects around, so it is entirely possible that your password is still in memory at a previous location, even if you explicitly zeroed that <code>char[]</code>.</p>\n<p>If a threat actor has sufficient access to your system to inspect memory, make heapdumps, etc., you have bigger problems, and worrying about using a <code>String</code> vs <code>char[]</code> is just a waste of time, because that threat actor will have other means of finding your password, like finding configuration sources, modifying your program to record the password on a next run, etc.</p>\n<p>To be clear, being able to quickly clear certain sensitive information can reduce the window of attack, but unless you're working in high-security environments, it is unlikely to be the right thing to focus on given all the caveats.</p>\n"}],"owner":{"user_id":26510,"display_name":"Brad Parks"},"view_count":82,"up_vote_count":3,"accepted_answer_id":76220662,"answer_count":1,"score":3,"creation_date":1683732492,"question_id":76220222,"body":"<p>I'm working on a Java service that had a security bug logged against it, concerning a secret stored in a Java String object.</p>\n<p>The concern is that once a password is stored in a <code>String</code>, it stays in the string pool until it's garbage collected, and could show up in a dump as clear text.</p>\n<p>I understand that Java's <code>String</code> class is immutable, and it is preferred that secrets or passwords be stored in a mutable class, so it can be removed from memory as soon as possible after use.</p>\n<p>References</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/8881291/26510\">Why is char[] preferred over String for passwords?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/51242150/java-equivalent-of-securestring\">Java equivalent of SecureString</a></li>\n<li><a href=\"https://stackoverflow.com/q/73968791/26510\">In Java, is there still a point in using char[] instead of String to store passwords?</a></li>\n<li><a href=\"https://stackoverflow.com/a/12008117/26510\">Answer by StephenC to similar question</a></li>\n</ul>\n<p>However, I find this impractical when working with 3rd party libraries, as many of them want the password or secret passed in the request as a String object, which no matter how safe I am, in my code, ultimately converts the <code>char[]</code> array into a <code>String</code>, which takes us back to the original problem, doesn't it?</p>\n<p><strong>So, is there anyway to convert a <code>char[]</code>, or <code>StringBuffer</code> to a <code>String</code>, without getting back to the original problem?</strong></p>\n<p>EDIT: As pointed out by the comments in this question and other similar questions, many believe this is not a real concern, as there's no easy way to avoid the issue if you don't own ALL the code in your application (ie don't pass secrets to any 3rd party libraries). So given this, maybe the question becomes</p>\n<p><strong>How can I refute the bug? is there a good solid reference from Oracle/Owasp or whoever that says &quot;unsolvable problem&quot; ?</strong></p>\n"},{"tags":["java","classloader","classloading"],"comments":[{"owner":{"user_id":183406,"display_name":"meriton"},"edited":false,"comment_id":134395165,"body":"Is that the entire exception? Usually, a <code>NoClassDefFoundError</code> is &quot;Caused by:&quot; some <code>ClassNotFoundException</code>, whose stacktrace would yield valuable clues ..."}],"answers":[{"owner":{"user_id":183406,"display_name":"meriton"},"up_vote_count":3,"is_accepted":false,"creation_date":1683727083,"answer_id":76219307,"body":"<p>A <code>NoClassDefFoundError</code> indicates that a class, who was successfully loaded from some <code>ClassLoader</code>, is statically referring to another class, whose definition that <code>ClassLoader</code> can not find.</p>\n<p>That is, if a class A refers to a class B, the runtime does</p>\n<pre><code>A.class.getClassLoader().loadClass(&quot;the.fully.qualified.name.of.B&quot;);\n</code></pre>\n<p>Suppose you have the following ClassLoader hierarchy:</p>\n<pre><code>+---------+\n| parent  |\n+---------+\n| B.class |\n+---------+\n     ^\n     |\n+---------+\n| child   |\n+---------+\n| A.class |\n| C.class |\n+---------+\n</code></pre>\n<p>where <code>A</code> refers to <code>B</code>, and <code>B</code> refers to <code>C</code>, and we do <code>child.loadClass(&quot;A&quot;)</code>. Then, the following happens:</p>\n<ul>\n<li><code>child</code> is asked to load <code>A</code>, finds its definition, defines the class, and then proceecds to resolve its references:\n<ul>\n<li><code>child</code> is asked to load <code>B</code>, and can not find its definition. Therefore,\n<ul>\n<li><p><code>parent</code> is asked to load <code>B</code>, finds its definition, defines the class, and then proceeds to resolve its references</p>\n<ul>\n<li><code>parent</code> is asked to load <code>C</code>, can not find its definition, and throws a ClassNotFoundException</li>\n</ul>\n<p>since the reference to C could not be resolved, a NoClassDefFoundError for <code>C</code> is thrown</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>That is, loading <code>A</code> from <code>child</code> fails with a <code>NoClassDefFoundError</code> for <code>C</code>, even though <code>child</code> has a definition for <code>C</code>.</p>\n<blockquote>\n<p>I was expecting the references to library classes to be resolved correctly because the class loader of the Bootstrap class should delegate to the library class loader, which I confirmed to have successfully 'loaded' the libraries.</p>\n</blockquote>\n<p>As we've just seen, that doesn't follow. Each class resolves its dependencies using its defining class loader, not the class loader that originally triggered the loading attempt.</p>\n<p>So, how could this have happened? You have set up the following class loader hierarchy:</p>\n<pre><code>+-----------------+\n| rootLoader      |\n+-----------------+\n| Main.class      |\n| Bootstrap.class |\n| Y.class         |\n+-----------------+\n         ^\n         |\n+---------------------------+\n| libraryLoader             |\n+---------------------------+\n| CredentialsProvider.class |\n| X.class                   |\n+---------------------------+\n         ^\n         |\n+-----------------+\n| appLoader       |\n+-----------------+\n| Bootstrap.class |\n| Y.class         |\n+-----------------+\n</code></pre>\n<p>That is, your Bootstrap classes are on the classpath twice, in two different <code>ClassLoaders</code>. You're probably hoping that the extra classes in <code>rootLoader</code> do no harm, because the <code>appLoader</code> prefers its own definition over that of its ancestors. However, the <code>libraryLoader</code> doesn't see the definitions in the <code>appLoader</code>, and will delegate to the <code>rootLoader</code>.</p>\n<p>Suppose that <code>Bootstrap</code> uses <code>X</code>, who uses <code>Y</code>, who uses <code>CredentialsProvider</code>. Then, the following happens:</p>\n<ul>\n<li>Bootstrap is defined by appLoader</li>\n<li>X is defined by libraryLoader</li>\n<li>Y is defined by rootLoader (!)</li>\n<li>CredentialsProvider is not found by rootLoader</li>\n</ul>\n<p>That is, the extra class definitions obscure the origin of dependency problems. If a library class incorrectly depends on an application class, you don't get a NoClassDefFoundError for that application class, but a NoClassDefFoundError for one of its library dependencies. And if there are no library dependencies, the class will be loaded a second time, and you will have separate classes with the same name in the system, which can cause really hard to diagnose issues (for instance: why is that static field having different values depending on who uses it?).</p>\n<p>For the sake of your sanity, and those who come after you, I therefore recommend that you do not put your application classes into two different class loaders in the hierarchy.</p>\n<p>PS: I can't tell you the identity of X and Y, but you should be able to find them as follows:</p>\n<ol>\n<li>determine the runtime type of <code>rootLoader</code></li>\n<li>create a conditional breakpoint in its <code>loadClass()</code> implementation that triggers if the argument ends with <code>&quot;CredentialsProvider&quot;</code></li>\n<li>once your program hits the breakpoint, inspect the stack trace. You should see the recursive calls to loadClass, and can check their local variables to identify the classes in the dependency chain and the class loaders involved.</li>\n</ol>\n<p>(note that conditional breakpoints in library code can be a bit brittle. For instance, when I just tested this in a toy example, I had to briefly halt execution with a normal breakpoint, to give the conditional breakpoint enough time to hook into the ClassLoader code)</p>\n<p>Alternatively, you could write your own class for <code>libraryLoader</code>, which throws, logs, or halt in a breakpoint whenever it is asked for classes that should come from <code>appLoader</code>.</p>\n"},{"owner":{"user_id":21846363,"display_name":"asdafadsfadsfdaf"},"up_vote_count":1,"is_accepted":false,"creation_date":1683788554,"answer_id":76224906,"body":"<p>So I ended up figuring it out by <code>meriton</code>s answer. It wasn't a problem with the hyarchy, rather it was the fact that the URLClassLoader for some reason prefers ancestors for <code>findClass</code>. I ended up on <a href=\"https://stackoverflow.com/questions/5445511/how-do-i-create-a-parent-last-child-first-classloader-in-java-or-how-to-overr?rq=1\">this question</a> which had an answer I ended up copying (the <code>ParentLastURLClassLoader</code>) and it worked.</p>\n<p>Essentially the problem was that, since the <code>URLClassLoader</code> for <code>appLoader</code> delegated to the root class loader first, the <code>Bootstrap</code> class was loaded by the root loader. This meant it was not under the library class loader in the class loading chain, not giving it access to those classes.</p>\n"}],"owner":{"user_id":21846363,"display_name":"asdafadsfadsfdaf"},"view_count":68,"up_vote_count":3,"answer_count":2,"score":3,"creation_date":1683498189,"question_id":76196521,"body":"<p>I'm trying to dynamically load libraries instead of shading them into my JAR to reduce file size. It's a standalone application with a <code>Bootstrap</code> class and a <code>Main</code> class. The main class is responsible for loading libraries and calling the bootstrap class' <code>execute(...)</code> method.</p>\n<p>The downloading of the artifacts and loading of the library classes using <code>Class.forName(class, true, libraryLoader)</code> works, but when I try to load the <code>Bootstrap</code> class it can't find the class definitions for the library classes.</p>\n<p>Here is how I'm currently trying to achieve this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>//////// Main.java /////////\n/* ... public static void main(String[] args) { */\n\n// download libraries\n// these URLs reference the local JAR files downloaded\n// i'm not going to get into detail on how i'm doing this right now, as this works\nURL[] libraryUrls = ...;\n\n// create parent loader for libraries\nfinal ClassLoader rootLoader = Main.class.getClassLoader(); // app class loader\nClassLoader libraryLoader = new DelegatingClassLoader(new URLClassLoader(\n        libraryUrls,\n        rootLoader\n), rootLoader);\n\n/* this passes, so the libraries are successfully loaded onto the loaders ucp */\nClass.forName(&quot;org.eclipse.jgit.transport.CredentialsProvider&quot;, true, libraryLoader);\n\n// find URL for JAR of bootstrap class\nProtectionDomain domain = Main.class.getProtectionDomain();\nCodeSource source = domain.getCodeSource();\nURL file = source.getLocation();\n\n// create child loader with our JAR file\nClassLoader appLoader = new DelegatingClassLoader(new URLClassLoader(\n        new URL[] { file }, libraryLoader), libraryLoader);\n\n// load bootstrap class and execute\nClass&lt;?&gt; bootstrap = Class.forName( // the error occurs here\n        &quot;my.package.Bootstrap&quot;,\n        /* initialize */ true,\n        appLoader\n);\n\nbootstrap.getMethod(&quot;execute&quot;, String[].class)\n        .invoke(null, (Object) args);\n\n/* } ... */\n</code></pre>\n<p>The <code>DelegatingClassLoader</code> first tries to load a class through the delegate and if that fails delegates to the parent. <a href=\"https://pastes.dev/SHfmYFHRxQ\" rel=\"nofollow noreferrer\">Here</a> is the exact source.</p>\n<p>The specific error I get:</p>\n<pre><code>Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/eclipse/jgit/transport/CredentialsProvider \n    at java.base/java.lang.Class.forName0(Native Method) \n    at java.base/java.lang.Class.forName(Class.java:467) \n    at my.package.Main.main(Main.java:108)\n        // line 108 is the line where i call Class.forName(&quot;my.package.Bootstrap, ...) \n</code></pre>\n<p>I was expecting the references to library classes to be resolved correctly because the class loader of the <code>Bootstrap</code> class should delegate to the library class loader, which I confirmed to have successfully 'loaded' the libraries.</p>\n"},{"tags":["java","multithreading","java-19","virtual-threads"],"comments":[{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134345286,"body":"According to <a href=\"https://blogs.oracle.com/javamagazine/post/java-loom-virtual-threads-platform-threads\" rel=\"nofollow noreferrer\">this article</a> thread local will still be an instance local to the currently executing virtual thread."},{"owner":{"user_id":2695990,"display_name":"fascynacja"},"edited":false,"comment_id":134345337,"body":"@matt great article, puts more light on the topic"}],"answers":[{"owner":{"user_id":2695990,"display_name":"fascynacja"},"up_vote_count":1,"is_accepted":false,"creation_date":1683278744,"answer_id":76180707,"body":"<p>I am still not sure why the thread name is empty but the solution which I found for the moment might be to use ThreadFactory  as follows:</p>\n<pre><code>    final ThreadFactory factory = Thread.ofVirtual().name(&quot;named-thread-&quot;, 0).factory();\n    try (var virtualService = Executors.newThreadPerTaskExecutor(factory)) {\n        virtualService.submit(() -&gt; System.out.println(&quot;[&quot; + Thread.currentThread().getName() + &quot;] virtual task 1&quot;));\n        virtualService.submit(() -&gt; System.out.println(&quot;[&quot; + Thread.currentThread().getName() + &quot;] virtual task 2&quot;));\n    } \n</code></pre>\n<p>In this case the output is:</p>\n<pre><code>[named-thread-0] virtual task 1\n[named-thread-1] virtual task 2\n</code></pre>\n"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":3,"is_accepted":true,"creation_date":1683300350,"answer_id":76183754,"body":"<h1>tl;dr</h1>\n<pre><code>long threadId = Thread.currentThread().threadId() ;  // The thread ID is unique and remains unchanged during its lifetime.\n</code></pre>\n<h1>Thread name optional</h1>\n<p>The name of any thread is entirely optional.</p>\n<p>You may <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Thread.html#setName(java.lang.String)\" rel=\"nofollow noreferrer\">name a thread</a> if you so desire. This can be handy while debugging. But you should not expect any preset value.</p>\n<p>Virtual threads in particular are specified as having no set name. To quote <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Thread.html\" rel=\"nofollow noreferrer\">the Javadoc</a> (my emphasis):</p>\n<blockquote>\n<p>Virtual threads <strong>do <em>not</em> have a thread name</strong> by default. The getName method returns the empty string if a thread name is not set.</p>\n</blockquote>\n<h1>Thread ID</h1>\n<p>If you want to identify a <code>Thread</code>, use its ID, a <code>long</code>.</p>\n<ul>\n<li>In Java 19+, call <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Thread.html#threadId()\" rel=\"nofollow noreferrer\"><code>Thread#threadId</code></a>.</li>\n<li>In earlier Java, call <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Thread.html#getId()\" rel=\"nofollow noreferrer\"><code>Thread#getId</code></a></li>\n</ul>\n<p>To quote the Javadoc:</p>\n<blockquote>\n<p>Returns the identifier of this <code>Thread</code>. The thread ID is a positive <code>long</code> number generated when this thread was created. The thread ID is unique and remains unchanged during its lifetime.</p>\n</blockquote>\n"}],"owner":{"user_id":2695990,"display_name":"fascynacja"},"view_count":78,"up_vote_count":3,"accepted_answer_id":76183754,"answer_count":2,"score":3,"creation_date":1683276666,"question_id":76180420,"body":"<p>I am working with Java 19. I have tried to use newly introduced virtual threads as follows:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static void main(String[] args)  {\n\n    System.out.println(&quot;Started with virutal threads&quot;);\n    try (ExecutorService virtualService = Executors.newVirtualThreadPerTaskExecutor()) {\n        virtualService.submit(() -&gt; System.out.println(&quot;[&quot; + Thread.currentThread().getName() + &quot;] virtual task 1&quot;));\n        virtualService.submit(() -&gt; System.out.println(&quot;[&quot; + Thread.currentThread().getName() + &quot;] virtual task 2&quot;));\n    }\n    System.out.println(&quot;Finished&quot;);\n}\n</code></pre>\n<p>The output of this program is:</p>\n<pre><code>Started with virutal threads\n[] virtual task 2\n[] virtual task 1\nFinished\n</code></pre>\n<p>Why Thread.currentThread().getName() does not have any name?</p>\n<p>Followup question: How to identify virtual threads between eachother? (how to recognize them) So the output would look like</p>\n<pre><code>[thread-1] virtual task 2\n[thread-0] virtual task 1\n</code></pre>\n"},{"tags":["java","spring-boot","hibernate","spring-data-jpa","transactions"],"comments":[{"owner":{"user_id":19084192,"display_name":"Kaiak"},"edited":false,"comment_id":134147154,"body":"This answer should be what you are looking for: <a href=\"https://stackoverflow.com/questions/25738883/spring-transactional-annotation-when-using-try-catch-block\" title=\"spring transactional annotation when using try catch block\">stackoverflow.com/questions/25738883/&hellip;</a>"},{"owner":{"user_id":14294053,"display_name":"Mar-Z"},"edited":false,"comment_id":134147446,"body":"It&#39;s a shame that this question has been closed. It is about JPA and transactions. The linked question is only partially useful for JPA."},{"owner":{"user_id":3405171,"display_name":"v.ladynev"},"edited":false,"comment_id":134147458,"body":"@Mar-Z Agree. fixed :)"}],"answers":[{"owner":{"user_id":3405171,"display_name":"v.ladynev"},"up_vote_count":1,"is_accepted":false,"creation_date":1681992010,"answer_id":76063812,"body":"<p><code>saveAll()</code> method is implemented in the <code>SimpleJpaRepository</code> class.</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @Transactional\n    @Override\n    public &lt;S extends T&gt; List&lt;S&gt; saveAll(Iterable&lt;S&gt; entities) {\n\n    }\n</code></pre>\n<p>It has <code>@Transactional</code> annotation. Your service method doesn't have <code>@Transactional</code> annotation. So it means the rollback will still happen, even you catch an exception. You don't need to rethrow an exception in such case.</p>\n<p>Otherwise if you put <code>@Transactional</code> to your <code>saveAllBooks()</code> method, rollback will not happen. The reason that the annotation from <code>saveAllBooks()</code> cancel the annotation from <code>saveAll()</code>.</p>\n<pre><code>    @Transactional\n    public void saveAllBooks(List&lt;Book&gt; books) {\n        try {\n            bookRepository.saveAll(books);\n        } catch (DataAccessException e) {\n            // notify external service about failure\n            // log exception\n        }\n    }\n</code></pre>\n"},{"owner":{"user_id":14294053,"display_name":"Mar-Z"},"up_vote_count":2,"is_accepted":false,"creation_date":1681992115,"answer_id":76063829,"body":"<p>First thing what need a clarification. As you are using Spring Data JPA then the annotation @Repository is irrelevant and will be ignored. Spring will instead use the EnableJpaRepositories and configure a proxy of SimpleJPARepository for every interface which extends the JPARepository. What your BookRepository does. In consequence all methods of this repository will be transactional.</p>\n<p>All exceptions thrown in these methods will be translated by Spring and:</p>\n<ul>\n<li>any unchecked exception (like DataAccessException, IndexOutOfBoundsException) will trigger rollback of the transaction</li>\n<li>any checked exception (like SQLException) will NOT trigger rollback</li>\n</ul>\n<p>This will happen independent and before the try/catch logic.</p>\n"},{"owner":{"user_id":12085680,"display_name":"BugsOverflow"},"up_vote_count":1,"is_accepted":false,"creation_date":1682958823,"answer_id":76148544,"body":"<p>In adittion to the answers I received, I want to add the following tests I did to be 100% sure I understand the behaviour so here it goes:</p>\n<p>The method to test is this one:</p>\n<pre><code>@Transactional\npublic String execute() {\n    lock();\n    try {\n        saveEntities(entities);\n        doSomethingElse();\n        return &quot;OK&quot;;\n    } finally {\n        unlock();\n    }\n}\n</code></pre>\n<p><strong>Test #1:</strong>\nWhat happens if everything goes well but at the finally clause, the unlock method fails and throws a RunTimeException()\nAnswer: It rollbacks the transaction, even more interesting, if you check the database while the finally is executing, you wont see any entities saved yet, it will not save anything until all the function finishes (correctly not abruptly) including the finally.</p>\n<p><strong>Test #2</strong>: What happens if everything goes well but at the finally clause, the unlock methods fails and throws a RunTimeException(), BUT you catch it there. Answer: It does not rollback the transaction, because since nothing was thrown without being controlled/catched, then everything finishes OK. This example would look like so:</p>\n<pre><code>@Transactional\npublic String execute() {\n    lock();\n    try {\n        saveEntities(entities);\n        doSomethingElse();\n        return &quot;OK&quot;;\n    } finally {\n        try {\n            unlock();\n        } catch (RuntimeException e) {\n            log.info(&quot;Catched the problem from finally so no rollback happens&quot;);\n        }\n    }\n}\n</code></pre>\n<p>I did several more test but with this 2, we can conclude that the @Transactional will make sure of 2 things: the code inside the try{} body must execute without any problems (Exceptions/RunTimeExceptions) for it to not rollback, THEN the finally clause code must also execute without any problem for it to not rollback.</p>\n<p>If anything goes wrong inside the try{} body, it will already be marked as a Transaction to rollback, no matter what happens in the finally, if it fails inside the try{} body and then it also fails at the finally it will still rollback, even if you catch the problem from the finally, since the try is already finished abrupted/error</p>\n<p>So I hope this helps clarify, if you do not use @Transactional it has a completely different behaviour, for example without Transactional if your code in the body of the try{} goes well, you will se the records in your database already, but if the finally goes wrong you will still see them. Another scenario is that if you do not use @Transactional and anything goes wrong in the body of the try{} then you will not see anything in the database (it will &quot;rollback&quot;) even if you do not use Transactional, thanks to the Transactional annotations that JpaRepositories already use (Spring), this would be OK if you did not depend on the code that executes on finally, but in my case it is important that this code also succeds.</p>\n<p>Also if you are wondering how I managed to see this in the database, I used Thread.sleep after the save method, when catching the Exceptions, etc. That is how I could validate the theory step by step</p>\n<p>If you have any doubts feel free to post I will answer, if you imagine any scenario I probably did the test so feel free to ask</p>\n"}],"owner":{"user_id":12085680,"display_name":"BugsOverflow"},"view_count":66,"up_vote_count":3,"answer_count":3,"score":3,"creation_date":1681989277,"question_id":76063462,"body":"<p>In SpringBoot using spring data jpa, default configurations (not changing anything), if in my service layer I call the saveAll method of a given repository which is annotated with @Repository, and I have a catch clause that catches <a href=\"https://stackoverflow.com/a/28650987/12085680\">DataAccessException</a> which I understand is the one that covers all the possible exceptions that could go wrong with the database, will the rollback still be triggered thanks to the @Transactional annotation?</p>\n<p>For example:</p>\n<p><strong>Repository</strong>:</p>\n<pre><code>@Repository\npublic interface BookRepository extends JpaRepository&lt;Book, Integer&gt; {\n\n}\n</code></pre>\n<p><strong>Service:</strong></p>\n<pre><code>@Service\npublic class BookService {\n\n    private final BookRepository bookRepository;\n\n    public BookService(BookRepository bookRepository) {\n        this.bookRepository = bookRepository;\n    }\n\n    public void saveAllBooks(List&lt;Book&gt; books) {\n        try {\n            bookRepository.saveAll(books);\n        } catch (DataAccessException e) {\n            // notify external service about failure\n            // log exception\n        }\n    }\n\n}\n</code></pre>\n<p>If I do this, the rollback will still happen or do I need to rethrow the exception? I need to guarantee the atomicity of this kind of transaction, save all the books or not save any of the books. Thanks in advance :)</p>\n"},{"tags":["java"],"comments":[{"owner":{"user_id":1744230,"display_name":"QBrute"},"edited":false,"comment_id":134130631,"body":"<a href=\"https://docs.oracle.com/en/java/javase/17/language/pattern-matching-instanceof-operator.html\" rel=\"nofollow noreferrer\">Pattern matching for <code>instanceof</code></a>"},{"owner":{"user_id":2636929,"display_name":"Stultuske"},"edited":false,"comment_id":134130638,"body":"does this: if (!(o instanceof Point point)) actually compile? My guess, you meant to type: if (!(o instanceof Point))"},{"owner":{"user_id":1898563,"display_name":"Michael"},"edited":false,"comment_id":134130760,"body":"@Stultuske They didn&#39;t &quot;mean to type&quot; anything, because it was generated by IntelliJ. The declaration of the <code>point</code> variable is necessary for the line below that. See <a href=\"https://openjdk.org/jeps/394\" rel=\"nofollow noreferrer\">the part of the JEP starting &quot;The flow scoping analysis...&quot;</a>"},{"owner":{"user_id":11002,"display_name":"tgdavies"},"edited":false,"comment_id":134130868,"body":"I&#39;m still getting accustomed to the fact that the scope of the pattern variable can extend beyond the statement it&#39;s declared in."},{"owner":{"user_id":2636929,"display_name":"Stultuske"},"edited":false,"comment_id":134131243,"body":"@Michael which version was this added in?"},{"owner":{"user_id":1744230,"display_name":"QBrute"},"edited":false,"comment_id":134131374,"body":"@Stultuske It was introduced as a preview feature in version 14: <a href=\"https://openjdk.org/jeps/305\" rel=\"nofollow noreferrer\">openjdk.org/jeps/305</a>"}],"answers":[{"owner":{"user_id":2067492,"display_name":"matt"},"up_vote_count":4,"is_accepted":false,"creation_date":1681906211,"answer_id":76054344,"body":"<p>This is called &quot;Pattern matching for instanceof&quot;.</p>\n<p>I am going to assume you know the previous syntax which would be.</p>\n<pre><code>if( !(o instanceof Point) ) return;\n\nPoint point = (Point)o;\n\nreturn x == point.x &amp;&amp; y == point.y;\n</code></pre>\n<p>As of java 16 there is a new syntax that is supposed to be a bit more concise.</p>\n<pre><code>if( !(o instanceof Point point) ) return;\n\nreturn x == point.x &amp;&amp; y == point.y;\n</code></pre>\n<p>Instead of casting and creating a local variable, you can declare the variable within the instanceof statement.</p>\n<p>The scope of the pattern variable is described as &quot;flow scoping&quot; in <a href=\"https://openjdk.org/jeps/394\" rel=\"nofollow noreferrer\">JEP 394</a> which can be a bit non-intuitive. <a href=\"https://docs.oracle.com/en/java/javase/17/language/pattern-matching-instanceof-operator.html\" rel=\"nofollow noreferrer\">Pattern Matching for instanceof</a> has more examples.</p>\n"}],"owner":{"user_id":10688444,"display_name":"Elias"},"view_count":109,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1681901019,"question_id":76053586,"body":"<p>I have Point class as the following code:</p>\n<pre><code>public class Point {\n    private final int x;\n    private final int y;\n\n    public Point(int x, int y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (!(o instanceof Point point)) return false;\n        return x == point.x &amp;&amp; y == point.y;\n    }\n\n    @Override\n    public int hashCode() {\n        return Objects.hash(x, y);\n    }\n}\n\n</code></pre>\n<p>The equals function is generated by IntelliJ, which can also accept a subclass of Point as a parameter. But I don't understand the meaning of <code>if (!(o instanceof Point point))</code>. Why is there <code>point</code> after <code>Point</code>, and how is <code>point</code> defined in the equals function?</p>\n"},{"tags":["java","c#","language-agnostic"],"comments":[{"owner":{"user_id":8248570,"display_name":"SomeBody"},"edited":false,"comment_id":134128524,"body":"In the first version of C#, there were no generics. Maybe that is a reason why the language designers thought it would be easier to add the equals and gethashcode method to the object class."},{"owner":{"user_id":6395627,"display_name":"Slaw"},"edited":false,"comment_id":134128542,"body":"At least in Java, objects have a default equality (i.e., reference equality). It makes sense to me for <code>Object</code> to define <code>equals</code>. And given <code>equals</code> and <code>hashCode</code> are inherently related, it makes sense to me for <code>Object</code> to define the latter method as well."},{"owner":{"user_id":1033686,"display_name":"Matthew Layton"},"edited":false,"comment_id":134128554,"body":"@SomeBody That&#39;s a good point. I believe the same is true for Java. On that basis, would you consider that a hypothetical new programming language that did include generics from the start could be designed such that <code>equals</code> and <code>getHashCode</code> could be implemented via interfaces instead?"},{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":134128585,"body":"Yes. That&#39;s what Swift did. See the Swift protocols <a href=\"https://developer.apple.com/documentation/swift/equatable\" rel=\"nofollow noreferrer\"><code>Equatable</code></a> and <a href=\"https://developer.apple.com/documentation/swift/hashable\" rel=\"nofollow noreferrer\"><code>Hashable</code></a>."},{"owner":{"user_id":1033686,"display_name":"Matthew Layton"},"edited":false,"comment_id":134128602,"body":"@Slaw The same is true for C#, where <code>Equals</code> defaults to reference equality, but in C#, there is also a static <code>Object.ReferenceEquals</code>, so it seems unnecessary."},{"owner":{"user_id":6395627,"display_name":"Slaw"},"edited":false,"comment_id":134128823,"body":"For Java: Consider a class like <code>HashSet</code>. First it buckets based on <code>hashCode</code>, then checks for duplicates via <code>equals</code>. This needed to work pre-generics. In other words, <code>HashSet</code> needed to be able to work with any class. With scenarios like that, it makes sense for these methods to be defined by <code>Object</code>. There may be other solutions, though I don&#39;t think they&#39;d be as clean. But I think perhaps if Java always had generics, then an interface such as <code>Equatable</code> would have made sense."},{"owner":{"user_id":6395627,"display_name":"Slaw"},"edited":false,"comment_id":134136943,"body":"@user16320675 It needs both <code>Hashable</code> and <code>Equatable</code>. So, either they&#39;d need a combined interface, or have both methods defined in the root of the hierarchy."},{"owner":{"user_id":5483526,"display_name":"Matt Timmermans"},"edited":false,"comment_id":134164049,"body":"The default implementations of hashCode and equals are valid, useful, and commonly used."}],"answers":[{"owner":{"user_id":12342238,"display_name":"JonasH"},"up_vote_count":4,"is_accepted":true,"creation_date":1681895444,"answer_id":76052713,"body":"<p>There is no fundamental reason they <em>have</em> to be implemented at the root, for all the reasons you mention. This answer will be specifically for c#, but I would guess many of the arguments apply to java as well.</p>\n<p>We can only speculate why the language designers used this model, but it is likely influenced by the lack of generics in the first version of C#. Influence from java, that also lacked generics, may also have played a part. Note that in c# your proposed interface does exist in the form of <a href=\"https://learn.microsoft.com/en-us/dotnet/api/system.iequatable-1?view=net-8.0\" rel=\"nofollow noreferrer\"><code>IEquatable&lt;T&gt;</code></a>.</p>\n<p>However If I understand your argument correctly, <code>HashSet</code> would be constrained to <code>IEquatable&lt;T&gt;</code>. This would only be implemented for types using value equality. Therefore <code>HashSet</code> could not be used with types using reference equality, and this seem like an obvious problem. Dictionaries and HashSets are still very useful for objects using reference equality.</p>\n<p>That is not to say I think the equality system, as it is now, is well designed. To compare two objects you may use</p>\n<ol>\n<li><code>.Equals(object obj)</code></li>\n<li><code>IEquatable&lt;T&gt;.Equals(T obj)</code></li>\n<li>Equality operators, <code>==</code> / <code>!=</code>, (and each of these require explicit implementation)</li>\n<li><code>IEqualityComparer&lt;T&gt;.Equals(T a, T b)</code></li>\n</ol>\n<p>This is confusing for new developers, and tend to lead to a quite significant amount of boiler plate code. This, as many other things, is partially due to the language evolution. New features have to be carefully designed work with existing code. If c# where rewritten from scratch you could almost certainly make improvements, and that would likely include removal or redesign of <code>.Equals(object obj)</code>. But that is not really feasible since it would break decades of existing code.</p>\n<p>If you are designing a new language please <em>do</em> consider ways to handle equality better. But I would expect this to require some major design work to make it as easy to understand and use as possible while still allowing for necessary flexibility. Designing languages is not easy! Looking around at other languages there are several that has problems in the equality area, C# is at least better than <a href=\"https://dorey.github.io/JavaScript-Equality-Table/\" rel=\"nofollow noreferrer\">javascript</a>.</p>\n<p>As for similar languages, both java and c# where in some sense intended as an easier to use c++. And that just avoid the problem by not having a common type root at all. But there are some usability downsides with that approach.</p>\n"}],"owner":{"user_id":1033686,"display_name":"Matthew Layton"},"view_count":95,"up_vote_count":4,"accepted_answer_id":76052713,"answer_count":1,"score":3,"creation_date":1681891812,"question_id":76052122,"body":"<p>Many object-oriented programming languages where something like <code>Object</code> is the root of the type hierarchy provide some default equality and hash code methods; for example:</p>\n<ul>\n<li>C# <code>System.Object</code>: <code>Equals</code> and <code>GetHashCode</code></li>\n<li>Java <code>java.lang.Object</code>: <code>equals</code> and <code>hashCode</code></li>\n</ul>\n<p>It is valuable to override these methods for objects that exhibit value semantics; for example, <code>Boolean</code>, <code>Integer</code> and <code>Guid</code>, but it is uncommon to override these methods for objects that exhibit behaviour semantics; for example services and controllers. These methods also serve as the mechanism to determine duplicates for <code>Set&lt;T&gt;</code> and <code>Map&lt;K, V&gt;</code> insertion.</p>\n<p>Let's assume that <code>Object</code> does not contain these methods, and instead they are provided by interfaces; for example:</p>\n<pre><code>interface Equatable&lt;T&gt; {\n    Boolean equals(T other)\n}\n\ninterface Hashable {\n    Integer getHashCode()\n}\n</code></pre>\n<p>Now, objects that exhibit behaviour semantics don't implement the methods because they're not required, but objects that exhibit value semantics can implement them; for example:</p>\n<pre><code>class Guid : Equatable&lt;Guid&gt;, Hashable {\n    public Boolean equals(Guid other) {\n        ...\n    }\n\n    public Integer getHashCode() {\n        ...\n    }\n}\n</code></pre>\n<p>Also <code>Set&lt;T&gt;</code> and <code>Map&lt;K, V&gt;</code> could declare constraints on <code>T</code> and <code>K</code>, such that objects should implement <code>Equatable&lt;T&gt;</code> and <code>Hashable</code>; for example:</p>\n<pre><code>interface Set&lt;T&gt; where T extends Equatable&lt;T&gt;, Hashable {\n    ...\n}\n\ninterface Map&lt;K, V&gt; where K extends Equatable&lt;T&gt;, Hashable {\n    ...\n}\n</code></pre>\n<p>Given that not all objects (i.e. those that exhibit behaviour semantics) require these methods to be overridden, it seems plausible that equals and hash code methods did not need to be declared at the root of the type hierarchy, so why <strong>are</strong> they defined at the root of the type hierarchy, rather than something expected to be implemented as required?</p>\n<p>Is there some other underlying or fundamental reason that these methods are implemented at the root of the type hierarchy, and are there any <em>similar</em> languages where this isn't the case?</p>\n"},{"tags":["java","functional-programming","java-stream"],"comments":[{"owner":{"user_id":2442804,"display_name":"luk2302"},"edited":false,"comment_id":134085403,"body":"Having side effects in stream methods, e.g. mutating the secondsInt state is frowned upon / not a good idea. It works here because you have a terminal operation and no parallelism but it is still not a good idea."},{"owner":{"user_id":13928301,"display_name":"Lior Derei"},"edited":false,"comment_id":134085426,"body":"the whole idea behind for each is doing side effect operations (it&#39;s not part of pure functional programming theory). side effect in general should be avoided, but I can&#39;t find a strong argument why use one and not the other in this example"},{"owner":{"user_id":207421,"display_name":"user207421"},"edited":false,"comment_id":134085932,"body":"The major advantage is the possible parallelism. Everything else is just opinion."},{"owner":{"user_id":112968,"display_name":"knittl"},"edited":false,"comment_id":134086003,"body":"map/filter are composable and lazy. forEach is eager and cannot be composed. Heavily opinion-based."},{"owner":{"user_id":4712734,"display_name":"DuncG"},"edited":false,"comment_id":134089116,"body":"<a href=\"https://stackoverflow.com/questions/76004826/java-stream-filter-performance\">Duplicate?</a>"}],"answers":[{"owner":{"user_id":8041003,"display_name":"John Williams"},"up_vote_count":1,"is_accepted":false,"creation_date":1681638579,"answer_id":76027018,"body":"<p>I donâ€™t think itâ€™s an issue of advantages. Each mechanism has a specific purpose.</p>\n<p>.forEach() returns void so it doesnâ€™t have an output. The intent is that the elements that the forEach iterates through are not modified. The data in the elements are used for some sort of calculation. I find that forEach is used much less than map. Itâ€™s a terminal point in a pipeline.</p>\n<p>.filter() takes a stream as input and emits a filtered stream as output. It is for filtering.</p>\n<p>.map() is like forEach but it emits a stream of modified objects. It allows the same modification to be done on each each element so that it can be saved, filtered or manipulated further.</p>\n<p>.toList is a handy shortcut to turn a stream into a list. Using forEach(List::add) where a toList() will do the work is a terrible idea. Youâ€™re preventing Java from bulking the activity.</p>\n"},{"owner":{"user_id":7928721,"display_name":"samabcde"},"up_vote_count":3,"is_accepted":true,"creation_date":1681639305,"answer_id":76027076,"body":"<h2>Alternative 2 looks best to me in this case</h2>\n<h3>1. Readability</h3>\n<ul>\n<li>Alternative 2 has less number of lines</li>\n<li>Alternative 2 read more close to <code>return a list containing number divisible by 6 from numList</code>, while forEach approach means add number divisible by 6 from numList to <code>secondInts</code></li>\n<li><code>filter(i -&gt; i % 6 == 0)</code> is straight forward and\n<pre><code>if(i % 6 != 0) {\n    return;\n}\n</code></pre>\nrequire some time for human brain to process.</li>\n</ul>\n<h3>2. Performance</h3>\n<p>From <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/Stream.html#toList()\" rel=\"nofollow noreferrer\"><code>Stream.toList()</code></a></p>\n<blockquote>\n<p>Implementation Note:\nMost instances of Stream will override this method and provide an implementation that is highly optimized compared to the implementation in this interface.</p>\n</blockquote>\n<p>We benefit from optimization from JDK by using Stream API.</p>\n<p>And in this case, using forEach and adding element one by one will be slower, especially when the list is large. It is because <code>ArrayList</code> will need to extend it capacity whenever the list full, while Stream implementation <code>ImmutableCollections.listFromTrustedArrayNullsAllowed</code> just store the result array into <code>ListN</code>.</p>\n<p>One more point to note about parallelism:<br />\nFrom <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/Stream.html#forEach(java.util.function.Consumer)\" rel=\"nofollow noreferrer\"><code>Stream#forEach</code></a></p>\n<blockquote>\n<p>The behavior of this operation is explicitly nondeterministic. For parallel stream pipelines, this operation does not guarantee to respect the encounter order of the stream, as doing so would sacrifice the benefit of parallelism. For any given element, the action may be performed at whatever time and in whatever thread the library chooses. If the action accesses shared state, it is responsible for providing the required synchronization.</p>\n</blockquote>\n<pre><code>numbersList.stream().parallel()\n       .forEach(i -&gt; {\n           if(i % 6 != 0) {\n               return;\n           }\n           secondInts.add(i);\n       });\n</code></pre>\n<p>Will provide unexpected result, while</p>\n<pre><code>List&lt;Integer&gt; third = numbersList.stream().parallel()\n      .filter(i -&gt; i % 6 == 0).sorted().forEach()\n      .toList();\n</code></pre>\n<p>is totally fine.</p>\n<h3>3. Flexibility</h3>\n<p>Imagine you want the filtered list to be sorted, in forEach approach, you can do it like:</p>\n<pre><code>numbersList.stream().sorted().\n       .forEach(i -&gt; {\n           if(i % 6 != 0) {\n               return;\n           }\n           secondInts.add(i);\n       });\n</code></pre>\n<p>Which is much slower compared to</p>\n<pre><code>numbersList.stream()\n        .filter(i -&gt; i % 6 == 0)\n        .sorted()\n        .toList();\n</code></pre>\n<p>As we need to sort the whole numbersList instead of filtered.</p>\n<p>Or if you want to limit your result to 10 elements, it is not straight forward to do so with forEach, but just as simple as adding <code>limit(10)</code> when using stream.</p>\n<h3>4. Less error prone</h3>\n<p>Stream API usually return Immutable object by default.</p>\n<p>From <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/Stream.html#toList()\" rel=\"nofollow noreferrer\"><code>Stream.toList()</code></a></p>\n<blockquote>\n<p>Implementation Requirements:\nThe implementation in this interface returns a List produced as if by the following:\nCollections.unmodifiableList(new ArrayList&lt;&gt;(Arrays.asList(this.toArray())))</p>\n</blockquote>\n<p>Meaning that the returned list is immutable by default. Some advantages of immutability are:</p>\n<ol>\n<li>You can safely pass the list around to different method without worrying the list is modified.</li>\n<li>Immutable list are thread safe.</li>\n</ol>\n<p>Read <a href=\"https://stackoverflow.com/questions/1863515/pros-cons-of-immutability-vs-mutability\">Pros. / Cons. of Immutability vs. Mutability</a> for further discussion.</p>\n"},{"owner":{"user_id":1552534,"display_name":"WJS"},"up_vote_count":0,"is_accepted":false,"creation_date":1681650463,"answer_id":76027950,"body":"<p>Streams provide for more readable, functional solution.  But that does come at a cost since the stream API is complex and does a lot under the hood.</p>\n<p>If one is going to do everything in a <code>forEach</code> block I would just skip the stream solution and go for an imperative solution using a <code>for loop</code>.</p>\n<p>Otherwise, I would go with <code>alternative 2</code> for the reasons cited (lends itself to parallelism, easier to read, etc).  I seldom use <code>forEach</code> for anything other than printing although there are always exceptions.</p>\n<p>And whether its safe to modify external state in some cases (as in <code>alternative 1</code>) I just presume it won't be safe and, with that in mind, focus on the a solution (functional or imperative) that provides the desired result.</p>\n"}],"owner":{"user_id":13928301,"display_name":"Lior Derei"},"view_count":95,"up_vote_count":3,"accepted_answer_id":76027076,"answer_count":3,"score":3,"creation_date":1681633342,"question_id":76026638,"body":"<p>I have a teammate that did all his stream operations in a foreach execution. I tried to come up with advantages of using the filter, map and to list methods instead.</p>\n<p>What are other advantages it has other than readability (arguably the foreach is pretty readable as well)\nHere is a snippet for something close to what he did:</p>\n<pre class=\"lang-java prettyprint-override\"><code>List&lt;Integer&gt; firstInts = new ArrayList&lt;&gt;();\nList&lt;Integer&gt; secondInts = new ArrayList&lt;&gt;();\nList&lt;Integer&gt; numbersList = IntStream.range(0, max).boxed().toList();\n\n\n//his stream\nnumbersList.stream()\n       .forEach(i -&gt; {\n           if(i % 6 != 0) {\n               return;\n           }\n           secondInts.add(i);\n       });\n\n\n//alternative 1\nnumbersList.stream()\n        .filter(i -&gt; i % 6 == 0)\n        .forEach(firstInts::add);\n\n\n//alternative 2\nList&lt;Integer&gt; third = numbersList.stream()\n        .filter(i -&gt; i % 6 == 0)\n        .toList();\n</code></pre>\n<p>what is the motivation of using stream methods other than readability?</p>\n"},{"tags":["java","multithreading","java-threads","thread-synchronization"],"comments":[{"owner":{"user_id":992484,"display_name":"MadProgrammer"},"edited":false,"comment_id":133354899,"body":"<a href=\"https://docs.oracle.com/javase/tutorial/essential/concurrency/guardmeth.html\" rel=\"nofollow noreferrer\">Guarded Blocks</a>; <a href=\"https://docs.oracle.com/javase/tutorial/essential/concurrency/newlocks.html\" rel=\"nofollow noreferrer\">Lock Objects</a>"},{"owner":{"user_id":869736,"display_name":"Louis Wasserman"},"edited":false,"comment_id":133354960,"body":"I might recommend using a <code>BlockingQueue</code> or the like; <code>wait</code> and <code>notify</code> are almost certainly too low-level.  Just have a queue of messages."},{"owner":{"user_id":2338547,"display_name":"markspace"},"edited":false,"comment_id":133354990,"body":"A queue of some type would have been my recommendation also.  I think one of the methods to poll the queue allows you to pass in a timeout value."},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"edited":false,"comment_id":133358750,"body":"Are you only receiving a single message once? You use the plural &quot;messages&quot; in your first sentence. But your code shows a singe effort to wait until a singe message appears."},{"owner":{"user_id":981953,"display_name":"Tejas jain"},"edited":false,"comment_id":133369425,"body":"I will be receiving messages of different type."}],"answers":[{"owner":{"user_id":14965614,"display_name":"Andrea"},"up_vote_count":2,"is_accepted":false,"creation_date":1677564949,"answer_id":75588446,"body":"<p>This is an exampre with wait / notify</p>\n<p>public class SignalReceiver{\nString message;</p>\n<pre><code>public static void main(String[] args) {\n    final SignalReceiver sr=new SignalReceiver();\n    \n    new Thread(() -&gt; {\n        try {\n            Thread.sleep(2000L);\n        } catch (InterruptedException e) {\n        }\n        System.out.println(&quot;message sent&quot;);\n        sr.receive(&quot;hello&quot;);\n    }).start();;\n    \n    System.out.println(&quot;waiting...&quot;);\n    String mess=sr.waitTillMessageReceived(5000L);\n    \n    System.out.println(&quot;message: &quot;+mess);\n}\n\npublic synchronized  void receive(String message){\n    this.message = message;\n    notify();\n}\n\npublic synchronized String waitTillMessageReceived(long timeout){\n   try {\n       wait(timeout);\n   }\n   catch (InterruptedException e) {\n      \n   }\n   return message;\n}\n</code></pre>\n<p>}</p>\n<p>The example presents some problems. For example it does not handle properly the arrival of many simultaneous messages.\nAs suggested in comments, it is better to use proper synchronised classes like java.util.concurrent.LinkedBlockingDeque.</p>\n"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":2,"is_accepted":false,"creation_date":1677569071,"answer_id":75588961,"body":"<h1><code>BlockingQueue</code></h1>\n<p>I followed the lead provided <a href=\"https://stackoverflow.com/questions/75586559/wait-till-i-receive-signal-in-java-multi-thread#comment133354960_75586559\">by Louis Wasserman</a> and <a href=\"https://stackoverflow.com/questions/75586559/wait-till-i-receive-signal-in-java-multi-thread#comment133354990_75586559\">by markspace</a>, suggesting the use of a queue.</p>\n<p>I went with a <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/BlockingQueue.html\" rel=\"nofollow noreferrer\"><code>BlockingQueue</code></a> which is (a) thread-safe, and (b) can block when adding &amp; removing elements. I started with the example code given on the Javadoc for that interface.</p>\n<p>For an implementation of the <code>BlockingQueue</code> interface, I chose <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/ArrayBlockingQueue.html\" rel=\"nofollow noreferrer\"><code>ArrayBlockingQueue</code></a>.</p>\n<p>I created a pair of producer-consumer classes. They produce and consume a randomly-generated <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier\" rel=\"nofollow noreferrer\">UUID</a> value via the <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/UUID.html\" rel=\"nofollow noreferrer\"><code>UUID</code></a> class.</p>\n<p>Here is the producer class. In an endless loop, the <code>run</code> method attempts to add a UUID object to the queue. The attempt to add blocks if the queue is currently busy, continuing when the queue becomes available. If interrupted, such as by the closure of the executor service, this <code>run</code> method completes, thereby ending the submitted task.</p>\n<pre class=\"lang-java prettyprint-override\"><code>package work.basil.example.async;\n\nimport java.time.Duration;\nimport java.time.Instant;\nimport java.util.UUID;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.ThreadLocalRandom;\n\npublic class Producer implements Runnable\n{\n    // Member fields.\n    private final BlockingQueue &lt; UUID &gt; queue;\n\n    // Constructor.\n    Producer ( BlockingQueue &lt; UUID &gt; q ) { queue = q; }\n\n    public void run ( )\n    {\n        System.out.println( &quot;`Producer` object is starting its `run` method. &quot; + Instant.now() );\n        try\n        {\n            while ( true )\n            {\n                // Sleep, to simulate some lengthy work.\n                Duration timeToSleep = Duration.ofMillis( ThreadLocalRandom.current().nextInt( 1_000 , 3_000 ) );\n                try { Thread.sleep( timeToSleep ); } catch ( InterruptedException e ) { break; }\n                queue.put( produce() );  // Post a new value to our BlockingQueue.\n            }\n        }\n        catch ( InterruptedException e )\n        {\n            // Could be interrupted by an executor service closing, or other reasons.\n            // Simply let this `Runnable` object end its `run` method.\n            // No code needed here.\n        }\n        System.out.println( &quot;`Producer` object is ending its `run` method, after being interrupted. &quot; + Instant.now() );\n    }\n\n    // Logic\n    UUID produce ( )\n    {\n        UUID uuid = UUID.randomUUID();\n        System.out.println( &quot;Producing UUID = &quot; + uuid + &quot; at &quot; + Instant.now() );\n        return uuid;\n    }\n}\n</code></pre>\n<p>And the consumer class. The <code>run</code> method asks for the next available element from the queue. The call blocks until an element becomes available. While waiting, if an interrupt happens such as when the executor service closes, the <code>run</code> method completes, thereby ending the submitted task.</p>\n<pre class=\"lang-java prettyprint-override\"><code>package work.basil.example.async;\n\nimport java.time.Instant;\nimport java.util.UUID;\nimport java.util.concurrent.BlockingQueue;\n\npublic class Consumer implements Runnable\n{\n    private final BlockingQueue &lt; UUID &gt; queue;\n\n    Consumer ( BlockingQueue &lt; UUID &gt; q ) { queue = q; }\n\n    public void run ( )\n    {\n        System.out.println( &quot;`Consumer` object is starting its `run` method. &quot; + Instant.now() );\n        try\n        {\n            while ( true ) { consume( queue.take() ); }\n        }\n        catch ( InterruptedException e )\n        {\n            // Could be interrupted by an executor service closing, or other reasons.\n            // Simply let this `Runnable` object end its `run` method.\n            // No code needed here.\n        }\n        System.out.println( &quot;`Consumer` object is ending its `run` method, after being interrupted. &quot; + Instant.now() );\n    }\n\n    void consume ( UUID uuid )\n    {\n        System.out.println( &quot;Consuming UUID: &quot; + uuid + &quot; at &quot; + Instant.now() );\n    }\n}\n</code></pre>\n<p>And an app class to demonstrate the queue in action.</p>\n<p>Be aware that you are responsible for gracefully closing your executor service at some point, at least by the end of your appâ€™s execution. Otherwise the backing pool of threads may run indefinitely, like a zombie ðŸ§Ÿâ€â™‚ï¸.</p>\n<pre class=\"lang-java prettyprint-override\"><code>package work.basil.example.async;\n\nimport java.time.Duration;\nimport java.time.Instant;\nimport java.util.concurrent.*;\n\npublic class App\n{\n    public static void main ( String[] args )\n    {\n        System.out.println( &quot;INFO - Demo start. &quot; + Instant.now() );\n\n        BlockingQueue q = new ArrayBlockingQueue( 10 , true );\n        Consumer c = new Consumer( q );\n        Producer p = new Producer( q );\n\n        ExecutorService executorService = Executors.newFixedThreadPool( 2 );\n        executorService.submit( c );\n        executorService.submit( p );\n\n        // Let the background threads do their work for a while.\n        try { Thread.sleep( Duration.ofSeconds( 8 ) ); } catch ( InterruptedException e ) { throw new RuntimeException( e ); }\n        System.out.println( &quot;INFO - Main thread is interrupting tasks run by executor service.&quot; );\n        executorService.shutdownNow();\n        try\n        {\n            if ( ! executorService.awaitTermination( 30 , TimeUnit.SECONDS ) )\n            {\n                System.err.println( &quot;Executor service failed to terminate. &quot; + Instant.now() );\n            }\n        }\n        catch ( InterruptedException e ) { throw new RuntimeException( e ); }\n\n        System.out.println( &quot;INFO - Demo end. &quot; + Instant.now() );\n    }\n}\n</code></pre>\n<p>This seems to be working.</p>\n<pre class=\"lang-none prettyprint-override\"><code>INFO - Demo start. 2023-02-28T07:24:03.603169Z\n`Consumer` object is starting its `run` method. 2023-02-28T07:24:03.614092Z\n`Producer` object is starting its `run` method. 2023-02-28T07:24:03.614092Z\nProducing UUID = 5fe7dd8a-9cc1-47b8-93aa-87bc031c2534 at 2023-02-28T07:24:04.855110Z\nConsuming UUID: 5fe7dd8a-9cc1-47b8-93aa-87bc031c2534 at 2023-02-28T07:24:04.863520Z\nProducing UUID = 97a31391-8c5c-4430-9737-b967a8c63987 at 2023-02-28T07:24:06.678767Z\nConsuming UUID: 97a31391-8c5c-4430-9737-b967a8c63987 at 2023-02-28T07:24:06.679680Z\nProducing UUID = af485e45-5dd5-4b68-82c8-41e1443c4566 at 2023-02-28T07:24:08.337011Z\nConsuming UUID: af485e45-5dd5-4b68-82c8-41e1443c4566 at 2023-02-28T07:24:08.337917Z\nProducing UUID = 4853a43c-feb6-41ec-91b0-1520c9f67347 at 2023-02-28T07:24:10.927173Z\nConsuming UUID: 4853a43c-feb6-41ec-91b0-1520c9f67347 at 2023-02-28T07:24:10.928794Z\nINFO - Main thread is interrupting tasks run by executor service.\n`Consumer` object is ending its `run` method, after being interrupted. 2023-02-28T07:24:11.619844Z\n`Producer` object is ending its `run` method, after being interrupted. 2023-02-28T07:24:11.619725Z\nINFO - Demo end. 2023-02-28T07:24:11.621988Z\n</code></pre>\n<p><strong>Caveat:</strong> I am no expert on concurrency matters. Use at your own risk.</p>\n"},{"owner":{"user_id":1503538,"display_name":"snovelli"},"up_vote_count":0,"is_accepted":false,"creation_date":1681549670,"answer_id":76021315,"body":"<h2><code>BlockingQueue</code> is the probably the easiest way to implement it</h2>\n<pre><code>import java.util.concurrent.*;\n\nclass SignalReceiver {\n    private final BlockingQueue&lt;String&gt; queue = new LinkedBlockingQueue&lt;&gt;();\n\n    public void receive(String message) {\n        queue.offer(message);\n    }\n\n    public String waitTillMessageReceived() throws InterruptedException {\n        return queue.take();\n    }\n}\n</code></pre>\n"}],"owner":{"user_id":981953,"display_name":"Tejas jain"},"view_count":65,"up_vote_count":3,"answer_count":3,"score":3,"creation_date":1677540961,"question_id":75586559,"body":"<p>I have a multi threaded application which receives asynchronous messages. How to wait till message is received (or timeout)?Is there a better way to do this with wait() and notify()?</p>\n<p>I tried to do this with raw thread sleep with atomic references.</p>\n<pre><code>class SignalReceiver{\n    String message;\n    Boolean messageReceived; // used AtomicBoolean\n\n    void receive(String message){\n        this.message = message;\n        messageReceived = true; // set message flag\n    }\n\n    void waitTillMessageReceived(long timeout){\n       if(!messageReceived){ // message could be received before \n          while(!messageReceived){\n              Thread.sleep(100);\n              // wait only till timeout\n          }\n       }\n       messageReceived = false; // reset message flag\n    }\n}\n</code></pre>\n"},{"tags":["java","java-stream"],"comments":[{"owner":{"user_id":1477418,"display_name":"Islam Elbanna"},"edited":false,"comment_id":133286404,"body":"Could you share a complete example of the input and output?"},{"owner":{"user_id":13963086,"display_name":"k314159"},"edited":false,"comment_id":133286600,"body":"What if collection B has more than one element satisfying the condition <code>A.id == B.identifier</code>?"}],"answers":[{"owner":{"user_id":3703819,"display_name":"dey"},"up_vote_count":2,"is_accepted":true,"creation_date":1677163534,"answer_id":75546377,"body":"<p>Can you use the temporary collection? If yes, I would suggest to convert <code>List&lt;B&gt;</code> into <code>Map&lt;Identifier, Bar&gt; mapOfB</code>, so you can much easier and faster find the specified <code>B.identifier</code> without need to traverse the B list for each A element.</p>\n<p>Then you can simply do something like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>listOfA.stream()\n.collect(toMap(a -&gt; a, a -&gt; {\n    var bar = mapOfB.get(a.getId());\n    if (bar == null) {\n        bar = getDefault();\n    }\n    return a.getFoo() + bar;\n}));\n</code></pre>\n<p>If you can't create the temporary Map:</p>\n<pre><code>listOfA.stream()\n.collect(toMap(a -&gt; a, a -&gt; {\n    var bar = getBarFromBOrDefault(listOfB, a.getId());\n    return a.getFoo() + bar;\n}))\n\nprivate Bar getBarFromBOrDefault(List&lt;B&gt; listOfB, Id id) {\n    return listOfB.stream()\n        .filter(b -&gt; b.getIdentity() == id) // or use .equals() here if it's not a primitive type\n        .findFirst()\n        .map(B::getBar)\n        .orElseGet(() -&gt; getDefault());\n}\n</code></pre>\n"},{"owner":{"user_id":402428,"display_name":"michid"},"up_vote_count":2,"is_accepted":false,"creation_date":1677165809,"answer_id":75546849,"body":"<p>You can map each <code>A</code> to the list of matching <code>B</code>s:</p>\n<pre><code>List&lt;A&gt; as = ...\nList&lt;B&gt; bs = ...\n\nas.stream()\n    .map(a -&gt; new Pair&lt;&gt;(a, bs.stream()\n                .filter(b -&gt; matches(a, b))\n                .toList()))\n    .collect(Collectors.toMap(p -&gt; p.fst, p -&gt; p.snd));\n</code></pre>\n<p>For this to work you need to declare you own <code>Pair</code> type, which is prominently missing from the JDK.</p>\n<pre><code>record Pair&lt;F, S&gt;(F fst, S snd) {}\n</code></pre>\n<p>Note that even there is no nested for loops, there is still nested iteration:  each <code>A</code> is mapped to a list of <code>B</code>s, which is obtained by traversing all <code>B</code>s to find the ones that match.</p>\n<p><strong>Update</strong></p>\n<p>To account for the case where you want to return a default value should there be no matches, you can move the joining to a helper method:</p>\n<pre><code>private List&lt;B&gt; join(A a, List&lt;B&gt; bs, B defaultB) {\n    List&lt;B&gt; matchingBs = bs.stream()\n        .filter(b -&gt; matches(a, b))\n        .toList();\n\n    return matchingBs.isEmpty()\n        ? List.of(defaultB)\n        : matchingBs;\n}\n</code></pre>\n<p>and supply a default value from within the stream processing</p>\n<pre><code>as.stream()\n    .map(a -&gt; new Pair&lt;&gt;(a, join(a, bs, defaultB(a))))\n    .collect(Collectors.toMap(p -&gt; p.fst, p -&gt; p.snd));\n</code></pre>\n"}],"owner":{"user_id":4695271,"display_name":"x80486"},"view_count":86,"up_vote_count":3,"accepted_answer_id":75546377,"answer_count":2,"score":3,"creation_date":1677162102,"question_id":75546093,"body":"<p>Say I have two collections of <code>A { id, foo }</code> and <code>B { identifier, bar }</code>.</p>\n<p>Initially I solved this problem using nested <code>for</code>-loops, but I did try to solve it (unsuccessful I would say) using the Stream API. Basically I need to traverse both collections looking for matches based on a given condition: <code>A.id === B.identifier</code>, in order to create a final map of <code>A</code> elements as keys and the values would be the corresponding <code>A.foo + B.bar</code> for the matches.</p>\n<p>The problem for me in the solution using the Stream API was the second part of the requirements: if some element(s) from <code>A</code> did not satisfy the condition, a default value should be assigned (based on a function call)... and I don't know how to plug this while using the Stream API along with the rest of the conditions.</p>\n<blockquote>\n<p>Notice that the final collection will have as many elements as (initial) <code>A</code> â€” with the modifications.</p>\n</blockquote>\n<p>Is there an efficient way to accomplish this using the Stream API rather than using nested <code>for</code>-loops and a couple of <code>if</code> conditions?</p>\n"},{"tags":["java","dynamic","predicate","functional-interface","lambda-metafactory"],"comments":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":133132859,"body":"The fourth parameter of <code>metafactory</code> should be <code>signature.erase()</code>. That said, do you realise that a <code>Predicate&lt;Cat&gt;</code> is not a <code>Predicate&lt;Animal&gt;</code>? The latter can test a dog, but the former cannot. It&#39;s the other way around - a <code>Predicate&lt;Animal&gt;</code> is a <code>Predicate&lt;? super Cat&gt;</code>."},{"owner":{"user_id":14614743,"display_name":"zuzuri"},"edited":false,"comment_id":133132908,"body":"I had tried it before with &#39;Object.class&#39; and not &#39;erase()&#39; to perform type erasure. So does that make a difference? Anyway, it finally works now, thank you very much! And yes, I mean to understand the difference between &#39;Predicate&lt;Cat&gt;&#39; and &#39;Predicate&lt;Animal&gt;&#39; - that&#39;s simple inheritance after all. Or do you still see a mistake somewhere in my approach?"},{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":133132933,"body":"My point is that &quot;This method returns a boolean and always has an object as parameter, which always inherits from another fixed object.&quot; is not a <code>Predicate&lt;Parent&gt;</code>. It is not type safe to cast it to that."},{"owner":{"user_id":14614743,"display_name":"zuzuri"},"edited":false,"comment_id":133133044,"body":"I think I understand. But how would you get around that and what other problems might arise otherwise?"}],"answers":[{"owner":{"user_id":3699139,"display_name":"Jorn Vernee"},"up_vote_count":4,"is_accepted":true,"creation_date":1676422260,"answer_id":75454577,"body":"<p>Since you know the target interface type is <code>Predicate</code> you could use a lambda expression as well:</p>\n<pre><code>private Predicate&lt;Parent&gt; toPredicate(final ExampleInterface instance, final Method method) {\n    final MethodHandle handle = LOOKUP.unreflect(method)\n        .bindTo(instance)\n        .asType(MethodType.methodType(boolean.class, Parent.class);\n    \n    return parent -&gt; {\n        try {\n            return (boolean) handle.invokeExact(parent);\n        } catch (Throwable t) {\n            throw new RuntimeException(&quot;Should not happen&quot;, t);\n        }\n    };\n}\n</code></pre>\n<p>Using LambdaMetafactory is only really beneficial in specific cases where a particular call site only sees 1 or 2 implementations of the interface. Also note that every time you create a metafactory, a new class is generated (unless it can be loaded from the CDS archive), which has its own costs associated with it.</p>\n<p>Also, depending on the Java version you are using, these classes are strongly tied to the defining class loader. This started when the implementation was switched to <a href=\"https://bugs.openjdk.org/browse/JDK-8238358\" rel=\"nofollow noreferrer\">hidden classes</a> in Java 15. So, e.g. if the defining class loader is the application class loader, the classes are in practice never unloaded, and this can lead to metaspace exhaustion if <code>metafactory</code> is called a lot. (for regular use through <code>invokedynamic</code> the resolved instruction keeps the class alive any way, and strongly tying the class to the class loader saves memory elsewhere).</p>\n<p>The thing you're getting wrong is the interface method type. It should be the erasure of the <code>test</code> method in <code>Predicate</code>:</p>\n<pre><code>final MethodHandle handle = LOOKUP.unreflect(method);\n\nfinal CallSite callSite = LambdaMetafactory.metafactory(\n    LOOKUP,\n    &quot;test&quot;,\n    MethodType.methodType(Predicate.class, instance.getClass()),\n    MethodType.methodType(boolean.class, Object.class),\n    handle,\n    MethodType.methodType(boolean.class, Parent.class)\n);\n</code></pre>\n"}],"owner":{"user_id":14614743,"display_name":"zuzuri"},"view_count":131,"up_vote_count":3,"accepted_answer_id":75454577,"answer_count":1,"score":3,"creation_date":1676420489,"question_id":75454466,"body":"<p>I have a few classes that each implement an interface. From these classes I search out a method using an annotation. This method returns a boolean and always has an object as parameter, which always inherits from another fixed object. Now I want to create a functional interface from this method. Optimally of course a Predicate, which takes over the mentioned parameter. This I have now tried for some time to implement with LambdaMetafactory:</p>\n<pre><code>private Predicate&lt;Parent&gt; toPredicate(final ExampleInterface instance, final Method method) {\n    try {\n        final MethodHandle handle = LOOKUP.unreflect(method);\n        final MethodType signature = MethodType.methodType(boolean.class, method.getParameters()[0].getType());\n\n        final CallSite callSite = LambdaMetafactory.metafactory(\n            LOOKUP,\n            &quot;test&quot;,\n            MethodType.methodType(Predicate.class, instance.getClass()),\n            signature,\n            handle,\n            signature\n        );\n\n        return (Predicate&lt;Parent&gt;) callSite.getTarget().invoke(instance);\n    } catch (Throwable e) {\n        e.printStackTrace();\n        return null;\n    }\n}\n</code></pre>\n<p>My problem now is that when I call the Predicate's test method, an AbstractMethodError is thrown. When I use signature with (boolean.class, Parent.class) I get a LambdaConversionException. Is it even possible to implement it that dynamically? If yes, how?</p>\n"},{"tags":["java","jvm"],"comments":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":132905156,"body":"Why do you think the <i>size</i> of the object is needed to read object&#39;s data? To read object data, you just need to know where that data is..."},{"owner":{"user_id":21131141,"display_name":"korjun1993"},"edited":false,"comment_id":132906574,"body":"I think it need to do bound check"}],"answers":[{"owner":{"user_id":1374678,"display_name":"rolve"},"up_vote_count":4,"is_accepted":true,"creation_date":1675327077,"answer_id":75320497,"body":"<p>The difference between an array and a &quot;normal&quot; object is that arrays can have different sizes, while every object of a given class has the same size. In a way, the size of non-array objects <em>is</em> stored, but not with every object, but only once in the respective class data (hence the class pointer).</p>\n<p>Regarding accessing the data in an array/object, there is another difference: When accessing the element of an array, the JVM has to do a bounds check, which requires knowing the size of the array. When accessing the field of a normal object, however, this is not the case, as the number/positions of all fields is fixed (and known at class loading time) for every object of a given class. So usually, knowing the size of an object is not actually required to access its data. However, I want to relativize Sweeper's comment: The JVM <em>does</em> need to know the size of non-array objects, e.g., when moving them around as part of garbage collection compaction.</p>\n"}],"owner":{"user_id":21131141,"display_name":"korjun1993"},"view_count":99,"up_vote_count":3,"accepted_answer_id":75320497,"answer_count":1,"score":3,"creation_date":1675323835,"question_id":75320007,"body":"<p>I studied the following.\nObject header consists of a mark word and a klass pointer.\nIn the case of an <strong>array</strong>, it additionally has <strong>size header</strong>.</p>\n<p>In other words, there is no size information in the header of object data. So, how does the JVM know how far to read from the start address when reading object data?</p>\n"},{"tags":["java","java-stream"],"comments":[{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132765448,"body":"<code>Stream.of(...).filter(value -&gt; value != 3)...</code>?"},{"owner":{"user_id":6202210,"display_name":"s1n7ax"},"edited":false,"comment_id":132765469,"body":"@Turing85 It should be filtered from the index, not the value"},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132765544,"body":"A stream does not have an &quot;index&quot;."},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132765588,"body":"What&#39;s more: the encounter-order is not guaranteed, especially not in parallel streams."}],"answers":[{"owner":{"user_id":5176992,"display_name":"Eritrean"},"up_vote_count":4,"is_accepted":true,"creation_date":1674670657,"answer_id":75238199,"body":"<p>A Stream is not a data structure and doesnâ€™t hold the data. It represent a pipeline through which data will flow and which functions to operate on the data. Especially you cannot point to a location in the stream where a certain element exists. What you could do is stream over the indices, filter out the index which you don't need and map to the list elements:</p>\n<pre><code>int n = 3;\nList&lt;Integer&gt; myList = List.of(1, 2, 3, 4, 5);\nIntStream.range(0, myList.size())\n         .filter(i -&gt; i !=n)\n         .map(myList::get)\n         .forEach(System.out::println);\n</code></pre>\n<p>or include only elements you need from the source when streaming:</p>\n<pre><code>Stream.concat(myList.subList(0, n).stream(), myList.subList(n+1, myList.size()).stream())\n          .forEach(System.out::println);\n</code></pre>\n"}],"owner":{"user_id":6202210,"display_name":"s1n7ax"},"view_count":109,"up_vote_count":4,"accepted_answer_id":75238199,"answer_count":1,"score":3,"creation_date":1674668353,"question_id":75237786,"body":"<p>In a given list of Integer, I want to skip one element at <code>n</code>th index.</p>\n<p>Input:</p>\n<pre><code>{ 1, 2, 3, 4, 5 }\n</code></pre>\n<p>Expected output after skipping 3rd element:</p>\n<pre><code>{ 1, 2, 4, 5 }\n</code></pre>\n<p>I can see even when running parallelly, stream consistently returns the last 3 elements though their order is different. So, stream can knows the index of each or is this a random coincidence?</p>\n<pre class=\"lang-java prettyprint-override\"><code>Stream.of(1,2,3,4,5)\n    .parallel()\n    .skip(2)\n    .forEach(System.out::println);\n</code></pre>\n<p>So my question is, is it possible to skip only one element from a list withing Java Streams?</p>\n"},{"tags":["java","spring","spring-boot","spring-batch"],"answers":[{"owner":{"user_id":5019386,"display_name":"Mahmoud Ben Hassine"},"up_vote_count":4,"is_accepted":true,"creation_date":1674230973,"answer_id":75186566,"body":"<p>With Spring Boot 3, there is no need for <code>@EnableBatchProcessing</code>. If you add it, the auto-configuration of Spring Batch (meta-data tables creation, launching of jobs at startup, etc) will back off.</p>\n<p>This is mentioned in the <a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide#spring-batch-changes\" rel=\"nofollow noreferrer\">migration guide</a> of Spring Boot 3.</p>\n"}],"owner":{"user_id":8707914,"display_name":"fragilepriCe"},"view_count":309,"up_vote_count":3,"accepted_answer_id":75186566,"answer_count":1,"score":3,"creation_date":1674229986,"question_id":75186378,"body":"<p>I am experiencing this error in my Spring Boot app using Spring Batch.\nI am expecting Spring Batch to autogenerate those meta tables. Please help!!!</p>\n<pre><code>Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table &quot;BATCH_JOB_INSTANCE&quot; not found (this database is empty); SQL statement:\nSELECT JOB_INSTANCE_ID, JOB_NAME from BATCH_JOB_INSTANCE where JOB_NAME = ? and JOB_KEY = ? [42104-214]\n</code></pre>\n<p>pom.xml</p>\n<pre><code>Spring Boot: 3.0.1\nSpring Batch starter: 3.0.1\nSpring Batch Core: 5.0.0\n</code></pre>\n<p>application.properties - I am using H2 database for the meantime</p>\n<pre><code>spring.datasource.url=jdbc:h2:mem:testdb\nspring.datasource.driverClassName=org.h2.Driver\nspring.datasource.username=sa\nspring.datasource.password=\nspring.jpa.database-platform=org.hibernate.dialect.H2Dialect\nspring.h2.console.enabled=true\n</code></pre>\n<p>BatchConfig</p>\n<pre><code>@Configuration\n@EnableBatchProcessing\npublic class BatchConfig {\n\n\n    @Bean\n    public Job uploadSupplierJob(JobRepository jobRepository, Step step1) {\n        return new JobBuilder(&quot;uploadSupplierJob&quot;, jobRepository)\n                .start(step1)\n                .build();\n    }\n\n\n    @Bean\n    public Step step1(JobRepository jobRepository, PlatformTransactionManager transactionManager, FlatFileItemReader&lt;SupplierCsv&gt; supplierItemReader, ItemWriter supplierItemWriter) {\n        return new StepBuilder(&quot;step1&quot;, jobRepository)\n                .chunk(10, transactionManager)\n                .reader(supplierItemReader)\n                .writer(supplierItemWriter)\n                .build();\n    }\n\n\n    @Bean\n    @StepScope\n    public FlatFileItemReader&lt;SupplierCsv&gt; supplierItemReader(@Value(&quot;#{jobParameters['file']}&quot;) MultipartFile file) throws IOException {\n        return new FlatFileItemReaderBuilder&lt;SupplierCsv&gt;().name(&quot;supplierItemReader&quot;)\n                .resource(new InputStreamResource(file.getInputStream()))\n                .delimited()\n                .names(&quot;name&quot;, &quot;contactName&quot;, &quot;terms&quot;,&quot;notes&quot;,&quot;leadDays&quot;,&quot;address&quot;,&quot;phoneNumber&quot;)\n                .fieldSetMapper(new BeanWrapperFieldSetMapper&lt;SupplierCsv&gt;() {{\n                    setTargetType(SupplierCsv.class);\n                }})\n                .build();\n    }\n\n\n}\n</code></pre>\n"},{"tags":["java"],"answers":[{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"up_vote_count":3,"is_accepted":true,"creation_date":1674062962,"answer_id":75163078,"body":"<p><code>Collections.sort</code> is not <strong>required</strong> to throw this exception. It may or may not. Essentially, if you attempt to do sorting operations (such as invoking <code>Collections.sort</code>, or passing a broken comparator to the constructor of <code>TreeSet</code>, then adding some elements) with a broken comparator, undefined behaviour is 'allowed' by the JVM.</p>\n<p>The exception is simply a kindness, and not one you can reliably get. The spec doesn't explain in which specific circumstances you would.</p>\n<p>This should be somewhat obvious: If you have a list with 2 elements in it, and you ask to sort it, it's only going to call your comparator just the one time, and that is by definition insufficient to figure out that your comparator is broken. Java certainly isn't going to do some sort of code analysis prior to accepting the comparator (halting problem and such kinda make that impossible in any case).</p>\n<h2>But I really wanna see it!</h2>\n<p>No problem. Just toss a few more in there! Wrap</p>\n<pre><code>for (int i = 0; i &lt; 100; i++) {\n // your 3 add statements here\n}\n</code></pre>\n<p>around your add statements and, voila, a funny exception. Funny, in that it is itself broken - the message ends in an exclamation point which violates the exception messaging style guide. If you feel endeavourous, you should file a bug report over at OpenJDK about it:</p>\n<pre><code>Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Comparison method violates its general contract!\n    at java.base/java.util.TimSort.mergeLo(TimSort.java:781)\n    at java.base/java.util.TimSort.mergeAt(TimSort.java:518)\n    at java.base/java.util.TimSort.mergeCollapse(TimSort.java:448)\n    at java.base/java.util.TimSort.sort(TimSort.java:245)\n    at java.base/java.util.Arrays.sort(Arrays.java:1307)\n    at java.base/java.util.ArrayList.sort(ArrayList.java:1721)\n    at java.base/java.util.Collections.sort(Collections.java:179)\n    at Main.main(Main.java:13)\n</code></pre>\n"},{"owner":{"user_id":2288659,"display_name":"Silvio Mayolo"},"up_vote_count":1,"is_accepted":false,"creation_date":1674063089,"answer_id":75163104,"body":"<p>Java cannot possibly detect every possible violation of the <code>Comparator</code> contract. Doing so would run afoul of the <a href=\"https://en.wikipedia.org/wiki/Halting_problem\" rel=\"nofollow noreferrer\">halting problem</a>, and even if you <em>had</em> a guarantee that your comparator terminated, you still would have to test every possible input value of type <code>T</code>.</p>\n<p>Specifically, <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#sort-T:A-java.util.Comparator-\" rel=\"nofollow noreferrer\"><code>Arrays.sort</code></a> says this about <code>IllegalArgumentException</code>.</p>\n<blockquote>\n<p><strong>Throws:</strong></p>\n<p>...</p>\n<p><code>IllegalArgumentException</code> - (optional) if the comparator is found to violate the Comparator contract</p>\n</blockquote>\n<p>If the comparator is <em>found</em> to violate the contract, it throws the exception. But if your list happens to be sorted without Java noticing a problem, it silently succeeds but may produce incorrect results. So if Java, for instance, compares two values twice and gets a different result each time, that's a clear violation. But if there's some complex mathematical proof that your comparator fails in some corner case, it won't necessarily come up during this particular input to <code>Arrays.sort</code>. That doesn't mean the sorted result is correct, however. In fact, there <em>is</em> no correct sorted result if your ordering isn't actually an ordering. (What does it mean to sort a list of numbers in &quot;potato&quot; order?)</p>\n"}],"owner":{"user_id":21037846,"display_name":"SevenEli"},"view_count":182,"up_vote_count":3,"accepted_answer_id":75163078,"answer_count":2,"score":3,"creation_date":1674062525,"question_id":75162991,"body":"<p>I haven't faced this issue ever. I just wanted to understand the cause of this error.\nAs per <a href=\"https://stackoverflow.com/a/59313659\">this answer on SO</a>, the following scenario is a violation:</p>\n<pre><code>    A &gt; B\n    A == C\n    B == C\n</code></pre>\n<p>So I tried writing a simple code to create this scenario and see if it throws this error.\nHere's what I wrote.</p>\n<pre><code>    import java.util.*;\n\n    public class Main {\n        public static void main(String[] args) {\n          List&lt;A&gt; a = new ArrayList&lt;&gt;();\n        \n            a.add(new A(0,1)); // this is A\n            a.add(new A(0,0)); // this is B\n            a.add(new A(0,null)); // And this is C\n        \n        \n            Collections.sort(a, new Comparator&lt;A&gt;(){\n                public int compare(A a, A b){\n                    if(a.i.equals(b.i) &amp;&amp; a.j != null &amp;&amp; b.j != null){\n                        return a.j.compareTo(b.j);\n                    }else{\n                        return a.i.compareTo(b.i);\n                    }\n                }\n            });\n        \n            System.out.println(a);\n      }\n    }\n\n    class A{\n        Integer i;\n        Integer j;\n        A(Integer i, Integer j){\n            this.i = i;\n            this.j = j;\n        }\n    \n        public String toString(){\n            return &quot;[&quot;+i+&quot;,&quot;+j+&quot;]&quot;;\n        }\n    }\n</code></pre>\n<p>But this doesn't throw any violation error and runs successfully.\nAny idea why?</p>\n"},{"tags":["java","regex","matcher"],"answers":[{"owner":{"user_id":548225,"display_name":"anubhava"},"up_vote_count":4,"is_accepted":true,"creation_date":1674022375,"answer_id":75155271,"body":"<p>You should remove anchors from your regex and then use <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#lookingAt--\" rel=\"nofollow noreferrer\"><code>Matcher#end()</code></a> method to get the position where it stopped the previous match like this:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>String i = &quot;f698fec0-dd89-11e8-b06b-Ã¢ËœÂº&quot;;\nPattern p = Pattern.compile(&quot;[\\\\w$&amp;+,:;=\\\\[\\\\]{}?@#|\\\\\\\\'&lt;&gt;.^*()%!/~\\&quot;`  -]+&quot;);\nMatcher m = p.matcher(i);\nif (m.lookingAt() &amp;&amp; i.length() &gt; m.end()) { \n   System.out.println(&quot;Match &lt;&quot; + m.group() + &quot;&gt; failed at: &quot; + m.end());\n}\n</code></pre>\n<p><strong>Output:</strong></p>\n<pre class=\"lang-bash prettyprint-override\"><code>Match &lt;f698fec0-dd89-11e8-b06b-&gt; failed at: 24\n</code></pre>\n<p><strong>PS</strong>: I have used <code>lookingAt()</code> to ensure that we match the pattern starting from the beginning of the region. You can use <code>find()</code> as well to get the next match anywhere or else keep the start anchor in pattern as</p>\n<pre><code>&quot;^[\\\\w$&amp;+,:;=\\\\[\\\\]{}?@#|\\\\\\\\'&lt;&gt;.^*()%!/~\\&quot;`  -]+&quot;\n</code></pre>\n<p>and use <code>find()</code> to effectively make it behave like the above code with <code>lookingAt()</code>.</p>\n<p><a href=\"https://stackoverflow.com/questions/30008397/whats-the-difference-between-matcher-lookingat-and-find\">Read difference between <code>lookingAt()</code> and <code>find()</code></a></p>\n<p>I have refactored your regex to use <code>\\w</code> instead of <code>[a-zA-Z0-9_]</code> and used quantifier <code>+</code> (meaning match 1 or more) instead of <code>*</code> (meaning match 0 or more) to avoid returning success for zero-length matches.</p>\n"}],"owner":{"user_id":2485458,"display_name":"Panadol Chong"},"view_count":61,"up_vote_count":3,"accepted_answer_id":75155271,"answer_count":1,"score":3,"creation_date":1674021118,"question_id":75155125,"body":"<p>Good day,</p>\n<p>My java code is as follow:</p>\n<pre><code>Pattern p = Pattern.compile(&quot;^[a-zA-Z0-9$&amp;+,:;=\\\\[\\\\]{}?@#|\\\\\\\\'&lt;&gt;._^*()%!/~\\&quot;`Â  -]*$&quot;);\nString i = &quot;f698fec0-dd89-11e8-b06b-Ã¢ËœÂº&quot;;\nMatcher tagmatch = p.matcher(i);\nSystem.out.println(&quot;tagmatch is &quot; + tagmatch.find());\n</code></pre>\n<p>As expected, the answer will be false, because there is <code>Ã¢ËœÂº</code> character inside. However, I would like to show the column number that not match. For this example, it should show column 25th having the invalid character.</p>\n<p>May I know how can I do this?</p>\n"},{"tags":["java","intellij-idea","dry","code-duplication"],"comments":[{"owner":{"user_id":11873958,"display_name":"ma66ot"},"edited":false,"comment_id":132549075,"body":"@Anon edited the question but the user knittl solved it for me I think. Thank you!"}],"answers":[{"owner":{"user_id":2422776,"display_name":"Mureinik"},"up_vote_count":1,"is_accepted":false,"creation_date":1673625477,"answer_id":75111572,"body":"<p>The shared code can return a <code>Questionnaire</code> object or throw a <code>ResourceNotFoundException</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>private Questionnaire findQuestionnaire(long projectManagerId, long questionnaireId) {\n    ProjectManager projectManager = projectManagerRepository.findById(projectManagerId).orElseThrow(\n            () -&gt; new ResourceNotFoundException(&quot;ProjectManager&quot;, &quot;id&quot;, projectManagerId));\n\n    Questionnaire questionnaire = questionnaireRepository.findById(questionnaireId).orElseThrow(() -&gt;\n            new ResourceNotFoundException(&quot;Questionnaire&quot;, &quot;id&quot;, questionnaireId));\n\n    if (!questionnaire.getProjectManager().getId().equals(projectManager.getId())){\n        throw new QuestionnaireApiException(HttpStatus.BAD_REQUEST, &quot;Questionnaire not belonging to Project Manager&quot;);\n    }\n    \n    // return questionnaire if both IDs are valid\n    return questionnaire;\n}\n</code></pre>\n"},{"owner":{"user_id":112968,"display_name":"knittl"},"up_vote_count":2,"is_accepted":true,"creation_date":1673626480,"answer_id":75111783,"body":"<p>You can actually just move the code 1:1 to a new method:</p>\n<pre><code>public QuestionnaireDTO methodTwo(long projectManagerId, long questionnaireId) {\n    return mapToDto(findById(projectManagerId, questionnaireId));\n}\n\npublic QuestionnaireDTO methodOne(long projectManagerId, long questionnaireId) {\n    return questionnaireRepository.delete(findById(projectManagerId, questionnaireId));\n}\n\nprivate QuestionnaireDTO findById(long projectManagerId, long questionnaireId) {\n    ProjectManager projectManager = projectManagerRepository.findById(projectManagerId).orElseThrow(\n            () -&gt; new ResourceNotFoundException(&quot;ProjectManager&quot;, &quot;id&quot;, projectManagerId));\n\n    Questionnaire questionnaire = questionnaireRepository.findById(questionnaireId).orElseThrow(() -&gt;\n            new ResourceNotFoundException(&quot;Questionnaire&quot;, &quot;id&quot;, questionnaireId));\n\n    if(!questionnaire.getProjectManager().getId().equals(projectManager.getId())){\n        throw new QuestionnaireApiException(HttpStatus.BAD_REQUEST, &quot;Questionnaire not belonging to Project Manager&quot;);\n    }\n\n    return questionnaire;\n}\n</code></pre>\n"},{"owner":{"user_id":5730279,"display_name":"hc_dev"},"up_vote_count":1,"is_accepted":false,"creation_date":1673639614,"answer_id":75113904,"body":"<p><strong>TL;DR:</strong> When IntelliJ warns about &quot;duplicated code fragment&quot; then <em>Extract Method</em> refactoring is a solving IDE-shortcut.</p>\n<hr />\n<p>Always pays-off to add more context like used IDE and shown error-message to the question.</p>\n<p>Before posted answers (from <a href=\"https://stackoverflow.com/a/75111783/5730279\">knittl</a> and <a href=\"https://stackoverflow.com/a/75111572/5730279\">mureinik</a>) show you the resulting code: definition of extracted helper-method <code>findById</code> and its usage in given methods <code>methodOne</code> and <code>methodTwo</code>.</p>\n<p>This answer shows how IntelliJ supports you to follow the <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" rel=\"nofollow noreferrer\">DRY principle</a> and avoid duplication (most other IDEs have similar functions).</p>\n<h3>Extract Method refactoring</h3>\n<p>A common refactoring method, to either break code up and improve readability or to avoid duplication and follow DRY is: <a href=\"https://www.refactoring.com/catalog/extractFunction.html\" rel=\"nofollow noreferrer\"><em>Extract Function</em></a> or <em>Extract Method</em></p>\n<p>IntelliJÂ IDEA has an action for <a href=\"https://www.jetbrains.com/help/idea/extract-method.html\" rel=\"nofollow noreferrer\">Extract Method</a>:</p>\n<blockquote>\n<p>The <strong>Extract Method</strong> refactoring lets you take a code fragment that can be grouped, move it into a separated method, and replace the old code with a call to the method.</p>\n</blockquote>\n<p>To use the refactoring technique <em>Extract Method</em> select the code-block you want to extract (e.g. code enclosed in your given comments). Then you can choose among 4 ways as you prefer:</p>\n<ul>\n<li>hover over the code (sometimes bulb-symbol appears) and press <kbd>Alt + Enter</kbd> to show <strong>Intention Actions</strong></li>\n<li>right-click to open the <strong>context-menu</strong>, then navigate to: refactor, extract-method</li>\n<li><strong>Find action</strong> (Win/Linux: <kbd>Ctrl + Shift + A</kbd>) by name &quot;Extract Method&quot;</li>\n<li>press the <strong>keyboard-shortcut</strong> for <em>Extract Method</em> action <kbd>Ctrl + Alt + M</kbd> (Win/Linux, different on Mac)</li>\n</ul>\n<p>See also: <a href=\"https://blog.jetbrains.com/idea/2020/12/3-ways-to-refactor-your-code-in-intellij-idea/#Extract_Method\" rel=\"nofollow noreferrer\">3 Ways to Refactor Your Code in IntelliJ IDEA | The IntelliJ IDEA Blog</a>.</p>\n<h3>Intention Actions help on errors in IntelliJ</h3>\n<p>Since this error-message is shown as a result of IntelliJ's <a href=\"https://www.jetbrains.com/help/idea/resolving-problems.html\" rel=\"nofollow noreferrer\">Code Inspection</a>, it might be prepared to help you solving it.</p>\n<p>In many cases (like here) these 1-2 steps are the quickest way from error to fix:</p>\n<ol>\n<li><a href=\"https://www.jetbrains.com/help/idea/navigating-through-the-source-code.html#navigate-errors-warnings\" rel=\"nofollow noreferrer\">Jump to issues/errors</a> in code pressing <kbd>F2</kbd> (Win/Linux). Those issues/errors can also be found by yellow gutter-marker or a red gutter-marker and bulb-symbol showing up.</li>\n<li>Use <a href=\"https://www.jetbrains.com/help/idea/intention-actions.html\" rel=\"nofollow noreferrer\">Intention Actions</a>: Click on the bulb-symbol or press <kbd>Alt + Enter</kbd> (Win/Linux) to show IntelliJ's <em>Intention Actions</em>. Select &quot;Extract method from duplicate code&quot;</li>\n</ol>\n<p>See also: <a href=\"https://www.jetbrains.com/help/idea/analyzing-duplicates.html\" rel=\"nofollow noreferrer\">IntelliJÂ IDEA Documentation: Analyze duplicates</a> to learn about IDE-support in finding and fixing duplication.</p>\n<h3>When and how extract-method in IntelliJ works</h3>\n<p>First a modal-dialog opens where you can enter the name of the method.\nUsually IntelliJ suggests the name and parameters that are used as input.</p>\n<p>More important is the return-value or output. A method or function can only be extracted if either no or exactly one single return-value or output can be determined. In you case <code>Questionnaire questionnaire</code> is the singular output.</p>\n<p>After confirming the dialog, your extracted helper-method was created by IntelliJ and all previous locations from where the code was extracted are replaced by a respective method-call.</p>\n"}],"owner":{"user_id":11873958,"display_name":"ma66ot"},"view_count":82,"up_vote_count":3,"accepted_answer_id":75111783,"answer_count":3,"score":3,"creation_date":1673624970,"question_id":75111450,"body":"<p>I have two methods</p>\n<ul>\n<li><code>methodOne</code> (e.g. for a GET on questionaire)</li>\n<li><code>methodTwo</code> (e.g. for a DELETE on questionaire)</li>\n</ul>\n<p>Both have almost same lines of code.</p>\n<p>IntelliJ also underlines the code and shows a warning:</p>\n<blockquote>\n<p>duplicated code fragment</p>\n</blockquote>\n<h3><code>methodOne</code></h3>\n<pre class=\"lang-java prettyprint-override\"><code>@Override\npublic QuestionnaireDTO methodOne(long projectManagerId, long questionnaireId) {\n\n    //the part I want to write into a helper method\n    ProjectManager projectManager = projectManagerRepository.findById(projectManagerId).orElseThrow(\n            () -&gt; new ResourceNotFoundException(&quot;ProjectManager&quot;, &quot;id&quot;, projectManagerId));\n\n    Questionnaire questionnaire = questionnaireRepository.findById(questionnaireId).orElseThrow(() -&gt;\n            new ResourceNotFoundException(&quot;Questionnaire&quot;, &quot;id&quot;, questionnaireId));\n\n    if(!questionnaire.getProjectManager().getId().equals(projectManager.getId())){\n        throw new QuestionnaireApiException(HttpStatus.BAD_REQUEST, &quot;Questionnaire not belonging to Project Manager&quot;);\n    }\n    // end of helper method\n\n    // return of methodOne \n    return mapToDto(questionnaire);\n    \n}\n</code></pre>\n<h3><code>methodTwo</code></h3>\n<pre class=\"lang-java prettyprint-override\"><code>@Override\npublic QuestionnaireDTO methodTwo(long projectManagerId, long questionnaireId) {\n\n    //the part I want to write into a helper method\n    ProjectManager projectManager = projectManagerRepository.findById(projectManagerId).orElseThrow(\n            () -&gt; new ResourceNotFoundException(&quot;ProjectManager&quot;, &quot;id&quot;, projectManagerId));\n\n    Questionnaire questionnaire = questionnaireRepository.findById(questionnaireId).orElseThrow(() -&gt;\n            new ResourceNotFoundException(&quot;Questionnaire&quot;, &quot;id&quot;, questionnaireId));\n\n    if(!questionnaire.getProjectManager().getId().equals(projectManager.getId())){\n        throw new QuestionnaireApiException(HttpStatus.BAD_REQUEST, &quot;Questionnaire not belonging to Project Manager&quot;);\n    }\n    // end of helper method\n\n    // return of methodTwo \n    return questionnaireRepository.delete(questionnaire);\n    \n}\n</code></pre>\n<h3>Questions</h3>\n<p>I want to write the duplicated part of the code (enclosed in comments above) into a helper method.\nI want to avoid duplicate code but I'm not sure how to structure the helper method.</p>\n<p>How can I achieve it?</p>\n"},{"tags":["java","regex"],"comments":[{"owner":{"user_id":256196,"display_name":"Bohemian"},"edited":false,"comment_id":132537702,"body":"change <code>^</code> to <code>(^|&gt;)</code> and <code>$</code> to <code>($|&lt;)</code>"},{"owner":{"user_id":16034206,"display_name":"experiment unit 1998X"},"edited":false,"comment_id":132537719,"body":"you could take a look at <a href=\"https://stackoverflow.com/a/24350326/16034206\">this</a> which trims html tags so that you get regular strings then you can apply the regular regex. You would of course need to apply some logic to trim the XML tags"}],"answers":[{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"up_vote_count":4,"is_accepted":true,"creation_date":1673621169,"answer_id":75110719,"body":"<p>You have put <code>^</code> at the beginning which means the &quot;Start of the string&quot;, and <code>$</code> at the end which means the &quot;End of the string&quot;. Now, look at your string:</p>\n<pre><code>&lt;email&gt;paris@france.c&lt;/email&gt;\n</code></pre>\n<p>Do you think, it starts and ends with an email address?</p>\n<p>I have removed them and also escaped the <code>-</code> in your regex. <a href=\"https://regex101.com/r/XrJmBN/1/codegen?language=java\" rel=\"nofollow noreferrer\">Here</a> you can check the following auto-generated Java code with the updated regex.</p>\n<pre><code>import java.util.regex.Matcher;\nimport java.util.regex.Pattern;\n\npublic class Example {\n    public static void main(String[] args) {\n        final String regex = &quot;[\\\\w!#$%&amp;amp;'*+/=?`\\\\{|\\\\}~^\\\\-]+(?:\\\\\\\\.[\\\\w!#$%&amp;amp;'*+/=?`\\\\{|\\\\}~^\\\\-]+)*@(?:[a-zA-Z0-9-]+\\\\.)+[a-zA-Z]{1,6}&quot;;\n        final String string = &quot;paris@france.c\\n&quot;\n     + &quot;&lt;email&gt;paris@france.c&lt;/email&gt;&quot;;\n        \n        final Pattern pattern = Pattern.compile(regex, Pattern.MULTILINE);\n        final Matcher matcher = pattern.matcher(string);\n        \n        while (matcher.find()) {\n            System.out.println(&quot;Full match: &quot; + matcher.group(0));\n            \n            for (int i = 1; i &lt;= matcher.groupCount(); i++) {\n                System.out.println(&quot;Group &quot; + i + &quot;: &quot; + matcher.group(i));\n            }\n        }\n    }\n}\n</code></pre>\n<p><strong>Output</strong>:</p>\n<pre><code>Full match: paris@france.c\nFull match: paris@france.c\n</code></pre>\n"}],"owner":{"user_id":14252779,"display_name":"Robin Singh"},"view_count":60,"up_vote_count":4,"accepted_answer_id":75110719,"answer_count":1,"score":3,"creation_date":1673590478,"question_id":75105489,"body":"<p>Need to grab string text of email value in big XML/normal string.</p>\n<p>Been working with Regex for it and as of now below Regex is working correctly for normal String\nRegex : <code>^[\\\\w!#$%&amp;amp;'*+/=?`{|}~^-]+(?:\\\\.[\\\\w!#$%&amp;amp;'*+/=?`{|}~^-]+)*@(?:[a-zA-Z0-9-]+\\\\.)+[a-zA-Z]{1,6}$</code></p>\n<p>Text : <code>paris@france.c</code></p>\n<p>but in case when above text is enclosed in XML tag it fails to return.\n<code>&lt;email&gt;paris@france.c&lt;/email&gt;</code></p>\n<p>I am trying to amend some change to this regex so that it will work for both of the scenarios</p>\n"},{"tags":["java","design-patterns","uml","decorator","software-design"],"comments":[{"owner":{"user_id":522444,"display_name":"Hovercraft Full Of Eels"},"edited":false,"comment_id":132467301,"body":"AFAIUI, the only methods that you are guaranteed access to are the ones of the interface, these are methods that all decorators share, and in the concrete outer class. If you still have a reference to the decorated UndoStack object, the same one passed into the LockedStack constructor (meaning not constructed inline), then <code>undo()</code> is available."}],"answers":[{"owner":{"user_id":841221,"display_name":"Aakash"},"up_vote_count":1,"is_accepted":false,"creation_date":1673329359,"answer_id":75065908,"body":"<p>In my opinion, this type of design is actually breaking the Decorator Pattern, since this is adding new behavior in each decorator. The purpose of decorator is to add new functionality transparently, e.g.,</p>\n<pre><code>BufferedReader in = new BufferedReader(new FileReader(&quot;foo.in&quot;));\n</code></pre>\n<p>In above line, buffering is added without the need to invoke any new behavior.</p>\n<p>I hope you get the point.</p>\n"},{"owner":{"user_id":3723423,"display_name":"Christophe"},"up_vote_count":4,"is_accepted":true,"creation_date":1673334967,"answer_id":75066614,"body":"<p>The purpose of the decorator pattern is:</p>\n<blockquote>\n<p>to add new reponsibilities to objects dynamically.</p>\n</blockquote>\n<p>If the new responsibility is embedded in the <strong>existing operations</strong> (e.g. <code>push()</code> and <code>pop()</code>), the decorator will take care of forwarding the call to the decorated object before/after performing the additional responsibilities. It is then straightforward to chain decorators.  You could for example achieve this with a slightly different design of the secure stack in which cryptographic methods would be private, and pushing/poping would secure the content on the flow:</p>\n<p><a href=\"https://i.stack.imgur.com/txKBw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/txKBw.png\" alt=\"enter image description here\" /></a></p>\n<p>If the new responsibilities are about <strong>additional operations</strong>, the design is not wrong (in fact GoF provides such an example).  But it's another story when chaining decorators:</p>\n<ul>\n<li>The decorator pattern does not provide any way to cumulate the new operations of all the intermediary decorators along the line. (If you really need this,  consider rather the <a href=\"https://en.wikipedia.org/wiki/Entity_component_system\" rel=\"nofollow noreferrer\">entity component system pattern</a>)</li>\n<li>The decorator pattern does not either provide an access to the decorated object, since this would lead client code to break the <a href=\"https://en.wikipedia.org/wiki/Law_of_Demeter\" rel=\"nofollow noreferrer\">principle of least knowledge</a> (law of demeter). Moreover you'd need to use risky down-castings.</li>\n</ul>\n<p>The solution is then to use your decorator chain in another way: if you need a <code>LockStack</code> that offers lock operations and an <code>UndoStack</code> that offers undo, you'll need to keep a track of each of these decorator objects, and use the right object to obtain the corresponding operations:</p>\n<pre><code>UndoStack MyUndoStack = new UndoStack(new SecureStack (key,new Stack()));\nLockedStack MyLockStack = new LockedStack(MyUndoStack); \nMyLockStack.lock();\nMyUndoStack.undo();\nMyLockStack.unlock();\n</code></pre>\n<p>This its less elegant but far more robust than creating a delegate getter and assuming in some code that a lockstack allways delegates to an undostack (hidden coupling).</p>\n"}],"owner":{"user_id":19913094,"display_name":"Anna"},"view_count":146,"up_vote_count":3,"accepted_answer_id":75066614,"answer_count":2,"score":3,"creation_date":1673320583,"question_id":75065105,"body":"<p>I found this example for the decorator pattern in a text book.</p>\n<p><a href=\"https://i.stack.imgur.com/NYOx4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/NYOx4.png\" alt=\"Decorator pattern example\" /></a></p>\n<p>If we considered the object:</p>\n<p><code>LockedStack MyStack = new LockedStack(new UndoStack(new Stack()))</code></p>\n<p>How can I call the function undo on it?</p>\n<p><code>MyStack.delegate.undo()</code> won't work because <code>delegate</code> is private.</p>\n<p>Does this example not work in this situation or am I missing something?</p>\n"},{"tags":["java","spring","spring-boot"],"answers":[{"owner":{"user_id":608164,"display_name":"30thh"},"up_vote_count":0,"is_accepted":false,"creation_date":1673165353,"answer_id":75046324,"body":"<p>Here is a description of what you want (in a slightly simplified version):</p>\n<p><a href=\"https://www.baeldung.com/spring-same-class-multiple-beans\" rel=\"nofollow noreferrer\">https://www.baeldung.com/spring-same-class-multiple-beans</a></p>\n<p>You need to register you own Implementation of <code>BeanFactoryPostProcessor</code> adding the functionality you need.</p>\n<pre><code>@Configuration\npublic class MyAppConfig {\n    @Bean\n    public CustomBeanFactoryPostProcessor beanFactoryPostProcessor() {\n        return new CustomBeanFactoryPostProcessor();\n    }\n}\n</code></pre>\n<p>Using your own implementation you will be able to register the beans manually using <code>ConfigurableListableBeanFactory</code> like this:</p>\n<pre><code>@Override\npublic void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {\n\n    ....\n    beanFactory.registerSingleton(name, bean);\n    ....\n\n}\n</code></pre>\n<p>After all you need to create a generic factory, which will be used by the processor to create the beans. See the referenced <a href=\"https://www.baeldung.com/spring-same-class-multiple-beans\" rel=\"nofollow noreferrer\">baeldung article</a> for some more examples.</p>\n"},{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"up_vote_count":0,"is_accepted":false,"creation_date":1673169074,"answer_id":75046612,"body":"<p><a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/ImportBeanDefinitionRegistrar.html\" rel=\"nofollow noreferrer\">ImportBeanDefinitionRegistrar</a> seems to be what you actually need:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class DynamicBeanRegistrar implements ImportBeanDefinitionRegistrar, BeanFactoryAware {\n\n    @Setter\n    private BeanFactory beanFactory;\n\n    @Override\n    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry, BeanNameGenerator importBeanNameGenerator) {\n        BeanProperties properties = beanFactory.getBean(BeanProperties.class);\n\n        for (String beanName : properties.getBeans()) {\n            if (registry.containsBeanDefinition(beanName)) {\n                continue;\n            }\n\n            AbstractBeanDefinition beanDefinition = BeanDefinitionBuilder\n                    .genericBeanDefinition(BeanClass.class,\n                            () -&gt; new BeanClass(beanName))\n                    .getBeanDefinition();\n            registry.registerBeanDefinition(beanName, beanDefinition);\n        }\n    }\n\n\n    @Configuration\n    @EnableConfigurationProperties(BeanProperties.class)\n    static class BeanPropertiesConfiguration {\n        // spring parses nested classes first\n    }\n\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@EnableConfigurationProperties(BeanProperties.class)\n// !!!\n@Import(DynamicBeanRegistrar.class)\n// !!!\n@SpringBootApplication\npublic class DemoApplication {\n\n    public static void main(String[] args) {\n        final ConfigurableApplicationContext context = SpringApplication.run(DemoApplication.class, args);\n        final ServiceClass service = context.getBean(ServiceClass.class);\n        service.log();\n    }\n\n}\n\n</code></pre>\n"},{"owner":{"user_id":10231374,"display_name":"birca123"},"up_vote_count":4,"is_accepted":true,"creation_date":1673169165,"answer_id":75046618,"body":"<p>You can implement <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/support/BeanDefinitionRegistryPostProcessor.html\" rel=\"nofollow noreferrer\"><code>BeanDefinitionRegistryPostProcessor</code> interface</a> to register <code>BeanClass</code> beans' definitions as follows:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class DynamicBeanDefinitionRegistrar implements BeanDefinitionRegistryPostProcessor {\n\n  public static final String PROPERTIES_PREFIX = &quot;beans&quot;;\n  private final List&lt;String&gt; beanNames;\n\n  public DynamicBeanDefinitionRegistrar(Environment environment) {\n    beanNames =\n        Binder.get(environment)\n            .bind(PROPERTIES_PREFIX, Bindable.listOf(String.class))\n            .orElseThrow(IllegalStateException::new);\n  }\n\n  @Override\n  public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry)\n      throws BeansException {\n    beanNames.forEach(\n        beanName -&gt; {\n          GenericBeanDefinition beanDefinition = new GenericBeanDefinition();\n          beanDefinition.setBeanClass(BeanClass.class);\n          beanDefinition.setInstanceSupplier(() -&gt; new BeanClass(beanName));\n          registry.registerBeanDefinition(beanName, beanDefinition);\n        });\n  }\n\n  @Override\n  public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory)\n      throws BeansException {}\n}\n</code></pre>\n<p>Since properties are needed before beans are instantiated, to register <code>BeanClass</code> beans' definitions, <code>@ConfigurationProperties</code> are unsuitable for this case. Instead, <a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Release-Notes#configuration-property-binding\" rel=\"nofollow noreferrer\">Binder API</a> is used to bind them programmatically.</p>\n<p>Because <code>BeanDefinitionPostProcessor</code> objects must be instantiated very early in the container lifecycle, <code>@Bean</code> methods should be marked as static in <code>@Configuration</code> classes, according to <a href=\"https://docs.spring.io/spring-framework/docs/5.0.x/javadoc-api/org/springframework/context/annotation/Bean.html\" rel=\"nofollow noreferrer\">Spring documentation</a>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\npublic class DynamicBeanDefinitionRegistrarConfiguration {\n  @Bean\n  public static DynamicBeanDefinitionRegistrar beanDefinitionRegistrar(Environment environment) {\n    return new DynamicBeanDefinitionRegistrar(environment);\n  }\n}\n</code></pre>\n<p>As result, all beans you define in <code>application.yml</code>, are registered as <code>BeanClass</code> beans:</p>\n<pre><code>beans: \n    - fooBean\n    - barBean\n</code></pre>\n<p>For reference: <a href=\"https://stackoverflow.com/questions/53462889/create-n-number-of-beans-with-beandefinitionregistrypostprocessor\">Create N number of beans with BeanDefinitionRegistryPostProcessor</a>, <a href=\"https://stackoverflow.com/questions/48161636/spring-boot-dynamic-bean-creation-from-properties-file\">Spring Boot Dynamic Bean Creation From Properties File</a></p>\n"}],"owner":{"user_id":1795075,"display_name":"sooty1892"},"view_count":480,"up_vote_count":4,"accepted_answer_id":75046618,"answer_count":3,"score":3,"creation_date":1673164813,"question_id":75046275,"body":"<p>I'm using the latest Spring Boot version and trying to dynamically create n number of beans based upon what is defined in the <code>application.yaml</code> file. I would then like to inject these beans into other classes based upon the bean name.</p>\n<p>The code below is a much simplified example of what I am trying to achieve. The auto configuration would normally be part of a spring boot starter library so the number of beans needed to be registered is unknown.</p>\n<pre><code>@Slf4j\n@Value\npublic class BeanClass {\n\n    private final String name;\n\n    public void logName() {\n        log.info(&quot;Name: {}&quot;, name);\n    }\n\n}\n</code></pre>\n<pre><code>@Component\n@RequiredArgsConstructor\npublic class ServiceClass {\n\n    private final BeanClass fooBean;\n    private final BeanClass barBean;\n\n    public void log() {\n        fooBean.logName();\n        barBean.logName();\n    }\n\n}\n</code></pre>\n<pre><code>@Value\n@ConfigurationProperties\npublic class BeanProperties {\n\n    private final List&lt;String&gt; beans;\n\n}\n</code></pre>\n<pre><code>@Configuration\npublic class AutoConfiguration {\n\n    // Obviously not correct\n    @Bean\n    public List&lt;BeanClass&gt; beans(final BeanProperties beanProperties) {\n        return beanProperties.getBeans().stream()\n                .map(BeanClass::new)\n                .collect(Collectors.toList());\n    }\n\n}\n</code></pre>\n<pre><code>@EnableConfigurationProperties(BeanProperties.class)\n@SpringBootApplication\npublic class DemoApplication {\n\n    public static void main(String[] args) {\n        final ConfigurableApplicationContext context = SpringApplication.run(DemoApplication.class, args);\n        final ServiceClass service = context.getBean(ServiceClass.class);\n        service.log();\n    }\n\n}\n</code></pre>\n<pre><code>beansToMake:\n  - fooBean\n  - barBean\n</code></pre>\n<p>I've tried multiple suggestions on google but nothing works and seems outdated. I'm hoping a new feature of Spring makes this straight forward.</p>\n"},{"tags":["java","spring","spring-boot","hibernate","hibernate-search"],"answers":[{"owner":{"user_id":1034461,"display_name":"horvoje"},"up_vote_count":4,"is_accepted":false,"creation_date":1673110385,"answer_id":75042123,"body":"<p>Well, looks like the Internet is not ready for new versions of Hibernate 6 and Hibernate Search 6.\nTo avoid this error, I had to remove dependency <code>hibernate-search-mapper-orm</code> and add this one: <code>hibernate-search-mapper-orm-orm6</code>.</p>\n<p>When you search maven repository and enter &quot;hibernate search orm&quot;, this one comes up as a 10th result which I didn't see because 2nd place already did not have search terms I wrote.</p>\n<p>Looks like this one is to be used with Hibernate 6 and - at least for me - it was hard to find.</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.hibernate.search&lt;/groupId&gt;\n    &lt;artifactId&gt;hibernate-search-mapper-orm-orm6&lt;/artifactId&gt;\n    &lt;version&gt;6.1.7.Final&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n"}],"owner":{"user_id":1034461,"display_name":"horvoje"},"view_count":641,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1673106386,"question_id":75041644,"body":"<p>I'm trying to setup Spring Boot 3.0.1 project from scratch using latest versions. So far I managed to get working mvc and repositories, but while adding Hibernate Search, things won't work anymore.</p>\n<p>Below you can see my <code>pom.xml</code> file.</p>\n<p>When I go to &quot;Dependency Hierarchy&quot; (Eclipse STS), I can find <code>hibernate-core 5.6.11.Final</code> embedded with <code>hibernate-search-mapper-pojo-base 6.1.7.Final</code>  which is embedded into <code>hibernate-search-mapper-orm 6.1.7.Final</code>. Does it mean I have to manually exclude this one and include higher version? Also <code>hibernate-core 5.6.11.Final</code> has <code>hibernate-commons-annotations 5.1.2.Final</code> embedded. Why is it so complicated? Is there something I'm missing?</p>\n<p>In the console log I get this:</p>\n<pre><code>***************************\nAPPLICATION FAILED TO START\n***************************\n\nDescription:\n\nAn attempt was made to call a method that does not exist. The attempt was made from the following location:\n\n    org.hibernate.cfg.annotations.BasicValueBinder.resolveJavaType(BasicValueBinder.java:1002)\n\nThe following method did not exist:\n\n    'java.lang.reflect.Type org.hibernate.annotations.common.reflection.ReflectionManager.toType(org.hibernate.annotations.common.reflection.XClass)'\n\nThe calling method's class, org.hibernate.cfg.annotations.BasicValueBinder, was loaded from the following location:\n\n    jar:file:/C:/Users/Hrvoje/.m2/repository/org/hibernate/orm/hibernate-core/6.1.6.Final/hibernate-core-6.1.6.Final.jar!/org/hibernate/cfg/annotations/BasicValueBinder.class\n\nThe called method's class, org.hibernate.annotations.common.reflection.ReflectionManager, is available from the following locations:\n\n    jar:file:/C:/Users/Hrvoje/.m2/repository/org/hibernate/common/hibernate-commons-annotations/5.1.2.Final/hibernate-commons-annotations-5.1.2.Final.jar!/org/hibernate/annotations/common/reflection/ReflectionManager.class\n\nThe called method's class hierarchy was loaded from the following locations:\n\n    org.hibernate.annotations.common.reflection.ReflectionManager: file:/C:/Users/Hrvoje/.m2/repository/org/hibernate/common/hibernate-commons-annotations/5.1.2.Final/hibernate-commons-annotations-5.1.2.Final.jar\n\n\nAction:\n\nCorrect the classpath of your application so that it contains compatible versions of the classes org.hibernate.cfg.annotations.BasicValueBinder and org.hibernate.annotations.common.reflection.ReflectionManager\n</code></pre>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.0.1&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;net.horvoje&lt;/groupId&gt;\n    &lt;artifactId&gt;TheVegCat2&lt;/artifactId&gt;\n    &lt;version&gt;1.0&lt;/version&gt;\n    &lt;packaging&gt;war&lt;/packaging&gt;\n    &lt;name&gt;TheVegCat2&lt;/name&gt;\n    &lt;description&gt;The Vegan Catalog II&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;\n            &lt;artifactId&gt;thymeleaf-extras-springsecurity6&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.h2database&lt;/groupId&gt;\n            &lt;artifactId&gt;h2&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.mysql&lt;/groupId&gt;\n            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n\n&lt;!-- Hibernate Search begin --&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate.search&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-search-mapper-orm&lt;/artifactId&gt;\n            &lt;version&gt;6.1.7.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate.search&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-search-backend-lucene&lt;/artifactId&gt;\n            &lt;version&gt;6.1.7.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n\n&lt;!-- Hibernate Search end --&gt;\n\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;excludes&gt;\n                        &lt;exclude&gt;\n                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                        &lt;/exclude&gt;\n                    &lt;/excludes&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n\n</code></pre>\n"},{"tags":["java","jfr"],"answers":[{"owner":{"user_id":2049208,"display_name":"Kire Haglin"},"up_vote_count":4,"is_accepted":true,"creation_date":1672962572,"answer_id":75025586,"body":"<p>JFR is dumped in a Java shutdown hook, which doesn't get a chance to run if the JVM exits due to -XX:+ExitOnOutOfMemoryError.</p>\n<p>JFR does something called an emergency dump, a best effort to write contents in memory/disk to a file located next to  the hs_err_pid file if the JVM crashes (without executing Java code), possibly due to OOM. It may, or may not, succeed.</p>\n<p>If -XX:+ExitOnOutOfMemoryError is specified, that logic is also prevented from running.</p>\n"}],"owner":{"user_id":20325718,"display_name":"YutaSaito"},"view_count":71,"up_vote_count":3,"accepted_answer_id":75025586,"answer_count":1,"score":3,"creation_date":1672926509,"question_id":75019425,"body":"<p>I am using Java17 in the container environment.<br />\nI set <code>-XX:+ExitOnOutOfMemoryError</code> because I want the JVM to exit when an OutOfMemoryError occurs.<br />\nAnd I also set <code>dumponexit=true</code> to output the JFR on JVM exit.</p>\n<p>But when the JVM exits with an OutOfMemoryError, JFR does not print.<br />\nIs it possible to set it to output?</p>\n<p>Below is an example of a boot parameter.<br />\n<code>java -XX:+ExitOnOutOfMemoryError -XX:StartFlightRecording: dumponexit=true app.jar</code></p>\n"},{"tags":["java","spring-boot","swagger","spring-cloud"],"answers":[{"owner":{"user_id":2494311,"display_name":"Abc.Xyz"},"up_vote_count":3,"is_accepted":true,"creation_date":1684098272,"answer_id":76249669,"body":"<p>Since api gateway uses webflux, instead of using swagger dependency</p>\n<pre><code>implementation 'org.springdoc:springdoc-openapi-ui:1.6.15'\n</code></pre>\n<p>use swagger webflux dependency</p>\n<pre><code>implementation 'org.springdoc:springdoc-openapi-webflux-ui:1.6.15'\n</code></pre>\n<p>Please find working repo <a href=\"https://github.com/cricketbackground/docs\" rel=\"nofollow noreferrer\">here</a> for reference</p>\n<p>After updating this in build gradle swagger url works fine:</p>\n<p><code>http://localhost:8081/swagger-ui.html</code></p>\n<p><a href=\"https://i.stack.imgur.com/hhoBu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hhoBu.png\" alt=\"enter image description here\" /></a></p>\n"}],"owner":{"user_id":14564074,"display_name":"noob234"},"view_count":97,"up_vote_count":3,"accepted_answer_id":76249669,"answer_count":1,"score":3,"creation_date":1683643334,"question_id":76210544,"body":"<p>I am trying to add the Swagger API documentation in a Springboot application that uses the following dependency:</p>\n<pre><code>implementation 'org.springframework.cloud:spring-cloud-starter-gateway'\n</code></pre>\n<p>I am using the following configuration:</p>\n<pre><code>@OpenAPIDefinition\n@Configuration\npublic class SwaggerConfiguration {\n    @Bean\n    public OpenAPI baseOpenAPI(){\n        return new OpenAPI().info(\n                new Info()\n                        .title(&quot;This is a test&quot;)\n                        .version(&quot;0.1&quot;)\n        );\n    }\n}\n</code></pre>\n<p>This is my controller:</p>\n<pre><code>@RestController\npublic class HelloWorldController {\n    @GetMapping(&quot;/hello&quot;)\n    public String hello() {\n        return &quot;Hello, World!&quot;;\n    }\n}\n</code></pre>\n<p>and my build.gradle:</p>\n<pre><code>plugins {\n    id 'java'\n    id 'org.springframework.boot' version '2.7.11'\n    id 'io.spring.dependency-management' version '1.0.15.RELEASE'\n}\n\ngroup = 'com.noob234'\nversion = '0.0.1-SNAPSHOT'\nsourceCompatibility = '1.8'\n\nconfigurations {\n    compileOnly {\n        extendsFrom annotationProcessor\n    }\n}\n\nrepositories {\n    mavenCentral()\n}\n\next {\n    set('springCloudVersion', &quot;2021.0.7&quot;)\n}\n\ndependencies {\n    implementation 'org.springframework.boot:spring-boot-starter-webflux'\n    implementation 'org.springframework.cloud:spring-cloud-starter-gateway'\n    implementation 'org.springdoc:springdoc-openapi-ui:1.6.15'\n    compileOnly 'org.projectlombok:lombok'\n    annotationProcessor 'org.projectlombok:lombok'\n    testImplementation 'org.springframework.boot:spring-boot-starter-test'\n    testImplementation 'io.projectreactor:reactor-test'\n}\n\ndependencyManagement {\n    imports {\n        mavenBom &quot;org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}&quot;\n    }\n}\n\ntasks.named('test') {\n    useJUnitPlatform()\n}\n</code></pre>\n<p>I suspect that the issue is related to this dependency</p>\n<pre><code>implementation 'org.springframework.boot:spring-boot-starter-webflux'\n</code></pre>\n<p>because I tried the same steps without introducing the</p>\n<pre><code>implementation 'org.springframework.cloud:spring-cloud-starter-gateway'\n</code></pre>\n<p>dependency and it works when I access this page http://localhost:8082/swagger-ui/index.html#/.\nI don't get Whitelabel Error Page anymore.</p>\n<p><strong>EDIT:</strong></p>\n<p>I also tried to add these 2 dependencies:</p>\n<pre><code>implementation 'org.springdoc:springdoc-openapi-webflux-ui:1.6.15'\nimplementation 'org.springdoc:springdoc-openapi-webflux-core:1.6.15'\n</code></pre>\n<p>Instead of this one:</p>\n<pre><code>implementation 'org.springdoc:springdoc-openapi-ui:1.6.15'\n</code></pre>\n<p>And added these properties in my application.properties:</p>\n<pre><code>spring.application.name=gateway\nserver.port=8081\nspringdoc.swagger-ui.path=/swagger-ui.html\nspringdoc.api-docs.path=/v3/api-docs\nspringdoc.swagger-ui.enabled=true\nspring.cloud.gateway.routes[0].id=swagger-ui\nspring.cloud.gateway.routes[0].uri=http://localhost:8081\nspring.cloud.gateway.routes[0].predicates[0]=Path=/swagger-ui.html\n\nspring.cloud.gateway.routes[1].id=api-docs\nspring.cloud.gateway.routes[1].uri=http://localhost:8081\nspring.cloud.gateway.routes[1].predicates[0]=Path=/v3/api-docs\n</code></pre>\n<p>Please tell me if you can reproduce this issue if you follow the steps and what I should do to fix it.</p>\n"},{"tags":["java","jackson","escaping","nan"],"answers":[{"owner":{"user_id":721855,"display_name":"aled"},"up_vote_count":2,"is_accepted":false,"creation_date":1682337424,"answer_id":76091602,"body":"<p>That's impossible because <code>NaN</code> is not a valid JSON value. You could try converting it to null in your getter method.</p>\n"},{"owner":{"user_id":3246362,"display_name":"Sam"},"up_vote_count":1,"is_accepted":true,"creation_date":1682338726,"answer_id":76091796,"body":"<p>Add the annotation <code>@JsonRawValue</code>, like this</p>\n<pre><code>@JsonProperty\n@JsonRawValue\npublic Double getValue() {\n    return this.value;\n}\n</code></pre>\n<p>It will give you this result\n<code>{&quot;name&quot;:&quot;Joe&quot;,&quot;age&quot;:25,&quot;favoriteNumber&quot;:&quot;123&quot;,&quot;value&quot;:NaN}</code></p>\n"}],"owner":{"user_id":2028440,"display_name":"Báº±ng Rikimaru"},"view_count":35,"up_vote_count":3,"accepted_answer_id":76091796,"answer_count":2,"score":3,"creation_date":1682337016,"question_id":76091552,"body":"<p>I need to serialize a <code>Double</code> field containing <code>NaN</code> number, but Jackson always tries to write it as a <code>String</code>, e.g. <code>&quot;value&quot;: &quot;Nan&quot;</code>. How can I change it to <code>&quot;value&quot;: Nan</code> instead?</p>\n<p>Below is the code to reproduce:</p>\n<pre><code>import com.fasterxml.jackson.annotation.JsonProperty;\nimport com.fasterxml.jackson.core.JsonParser;\nimport com.fasterxml.jackson.core.json.JsonReadFeature;\nimport com.fasterxml.jackson.databind.ObjectMapper;\n\npublic class Test {\n    public String name;\n    public int age;\n    private int favoriteNumber;\n    private Double value = Double.NaN;\n\n    public Test(String name, int age, int favoriteNumber) {\n        this.name = name;\n        this.age = age;\n        this.favoriteNumber = favoriteNumber;\n    }\n\n    @JsonProperty\n    public String getFavoriteNumber() {\n        return String.valueOf(favoriteNumber);\n    }\n\n    @JsonProperty\n    public Double getValue() {\n        return this.value;\n    }\n\n    public static void main(String... args) throws Exception {\n        Test p = new Test(&quot;Joe&quot;, 25, 123);\n        ObjectMapper mapper = new ObjectMapper();\n        mapper.enable(JsonReadFeature.ALLOW_NON_NUMERIC_NUMBERS.mappedFeature());\n        mapper.configure(JsonParser.Feature.ALLOW_NON_NUMERIC_NUMBERS, true);\n        System.out.println(mapper.writeValueAsString(p));\n        // {&quot;name&quot;:&quot;Joe&quot;,&quot;age&quot;:25,&quot;favoriteNumber&quot;:&quot;123&quot;,&quot;value&quot;:&quot;NaN&quot;}\n    }\n}\n</code></pre>\n"},{"tags":["java","spring-boot","elasticsearch","exception","indexing"],"answers":[{"owner":{"user_id":6250010,"display_name":"Theara"},"up_vote_count":2,"is_accepted":false,"creation_date":1682235636,"answer_id":76083655,"body":"<p>plz change the index name to the lowercase in class below:</p>\n<pre><code>package br.com.uburu.spring.utils;\n\npublic final class Indices {\n\n    public static final String KEYWORD = &quot;keyword&quot;;\n    public static final String PATH = &quot;path&quot;;\n    public static final String FILTER = &quot;filter&quot;;\n    \n}\n</code></pre>\n<p>Result:</p>\n<pre><code>request [HEAD http://localhost:9200/filter] returned 1 warnings: [299 Elasticsearch-7.17.0-bee86328705acaa9a6daede7140defd4d9ec56bd &quot;Elasticsearch built-in security features are not enabled. Without authentication, your cluster could be accessible to anyone. See https://www.elastic.co/guide/en/elasticsearch/reference/7.17/security-minimal-setup.html to enable security.&quot;]\n2023-04-23T14:40:01.302+07:00  WARN 75565 --- [  restartedMain] org.elasticsearch.client.RestClient      : request [HEAD http://localhost:9200/filter] returned 1 warnings: [299 Elasticsearch-7.17.0-bee86328705acaa9a6daede7140defd4d9ec56bd &quot;Elasticsearch built-in security features are not enabled. Without authentication, your cluster could be accessible to anyone. See https://www.elastic.co/guide/en/elasticsearch/reference/7.17/security-minimal-setup.html to enable security.&quot;]\n2023-04-23T14:40:01.306+07:00  WARN 75565 --- [  restartedMain] org.elasticsearch.client.RestClient      : request [HEAD http://localhost:9200/filter] returned 1 warnings: [299 Elasticsearch-7.17.0-bee86328705acaa9a6daede7140defd4d9ec56bd &quot;Elasticsearch built-in security features are not enabled. Without authentication, your cluster could be accessible to anyone. See https://www.elastic.co/guide/en/elasticsearch/reference/7.17/security-minimal-setup.html to enable security.&quot;]\n2023-04-23T14:40:01.319+07:00  WARN 75565 --- [  restartedMain] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning\n2023-04-23T14:40:01.433+07:00  INFO 75565 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''\n2023-04-23T14:40:01.438+07:00  INFO 75565 --- [  restartedMain] br.com.uburu.spring.Application          : Started Application in 1.272 seconds (process running for 6.551)\n</code></pre>\n"},{"owner":{"user_id":17134498,"display_name":"Dheovani Xavier"},"up_vote_count":1,"is_accepted":true,"creation_date":1683770282,"answer_id":76223650,"body":"<p>Almost 2 months later, finally managed to solve it. It was a problem with the ssl connection. I've turned it all off and reconfigured it manually in <code>elasticsearch-8.7.0\\config\\elasticsearch.yml</code> to make it work</p>\n"}],"owner":{"user_id":17134498,"display_name":"Dheovani Xavier"},"view_count":80,"up_vote_count":3,"accepted_answer_id":76223650,"answer_count":2,"score":3,"creation_date":1682216810,"question_id":76082852,"body":"<h2>Problem</h2>\n<p>It seems like my SpringBoot application can't connect with ElasticSearch. I keep getting this error whenever i try to run my application:</p>\n<blockquote>\n<p>UnsatisfiedDependencyException: Error creating bean with name 'filterController': Unsatisfied dependency expressed through field 'service': Error creating bean with name 'filterService': Unsatisfied dependency expressed through field 'repository': Error creating bean with name 'filterRepository' defined in repository.FilterRepository defined in @EnableElasticsearchRepositories declared on ElasticsearchRepositoriesRegistrar.EnableElasticsearchRepositoriesConfiguration: Failed to instantiate [org.springframework.data.elasticsearch.repository.support.SimpleElasticsearchRepository]: Constructor threw exception</p>\n</blockquote>\n<h2>Code info</h2>\n<ul>\n<li>I didn't make any changes nor extra-configurations. I'm running ElasticSearch normally</li>\n<li>I did not create a custom configuration file, since <a href=\"https://stackoverflow.com/questions/66745757/how-to-use-elasticsearchrestclientautoconfiguration-with-spring-boot\">SpringBoot does it automatically</a></li>\n<li>You can find full source-code <a href=\"https://github.com/Dheovani/Uburu/tree/elasticsearch\" rel=\"nofollow noreferrer\">here</a></li>\n</ul>\n<p>This is my Application.java file:</p>\n<pre><code>package br.com.uburu.spring;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class Application {\n\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n\n}\n</code></pre>\n<p>This is my FilterController.java file:</p>\n<pre><code>package br.com.uburu.spring.controller;\n\n// Imports\n\n@RestController\n@RequestMapping(&quot;/api/v1/filter&quot;)\npublic class FilterController {\n\n    @Autowired\n    private FilterService service;\n\n    @GetMapping\n    public ResponseEntity&lt;List&lt;Filter&gt;&gt; getAll() {\n        List&lt;Filter&gt; filters = service.getAll();\n        return new ResponseEntity&lt;List&lt;Filter&gt;&gt;(filters, HttpStatus.OK);\n    }\n\n    @GetMapping(&quot;/{id}&quot;)\n    public ResponseEntity&lt;Filter&gt; getById(@PathVariable(&quot;id&quot;) long id) {\n        Filter filter = service.findById(id);\n        return new ResponseEntity&lt;Filter&gt;(filter, HttpStatus.OK);\n    }\n\n    // Some other methods\n    \n}\n</code></pre>\n<p>This is the FilterService.java file:</p>\n<pre><code>package br.com.uburu.spring.service;\n\n// Imports\n\n@Service\npublic class FilterService {\n\n    @Autowired\n    private FilterRepository repository;\n\n    public List&lt;Filter&gt; getAll() {\n        List&lt;Filter&gt; filters = new ArrayList&lt;&gt;();\n        repository.findAll().forEach(filters::add);\n\n        return filters;\n    }\n\n    public Filter findById(long id) {\n        return repository.findById(id).orElse(null);\n    }\n\n    public Filter save(Filter filter) {\n        return repository.save(filter);\n    }\n\n    public void delete(long id) {\n        repository.deleteById(id);\n    }\n    \n}\n</code></pre>\n<p>My FilterRepository.java file:</p>\n<pre><code>package br.com.uburu.spring.repository;\n\nimport org.springframework.data.elasticsearch.repository.ElasticsearchRepository;\n\nimport br.com.uburu.spring.document.Filter;\n\npublic interface FilterRepository extends ElasticsearchRepository&lt;Filter, Long&gt; {}\n</code></pre>\n<p>To finish, my project's dependencies:</p>\n<pre><code>&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n        &lt;scope&gt;runtime&lt;/scope&gt;\n        &lt;optional&gt;true&lt;/optional&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.h2database&lt;/groupId&gt;\n        &lt;artifactId&gt;h2&lt;/artifactId&gt;\n        &lt;scope&gt;runtime&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n        \n    &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-data-elasticsearch --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;\n        &lt;version&gt;3.0.5&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;!-- https://mvnrepository.com/artifact/org.springframework.data/spring-data-elasticsearch --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-data-elasticsearch&lt;/artifactId&gt;\n        &lt;version&gt;5.0.5&lt;/version&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre>\n<h2>Some solutions i've tried:</h2>\n<ul>\n<li>Initializing my service and repository variables without the <code>@Autowired</code> tag</li>\n<li>Initializing it inside a class constructor, passing the <code>@Autowired</code> tag above the constructor</li>\n<li>Running ElasticSearch as admin</li>\n<li>Cleaning Java Language Server Workspace (I'm using VSCode)</li>\n<li>Running <code>mvn clean install</code> once again before trying to run my application</li>\n</ul>\n<h2>Logs from ElasticSearch</h2>\n<p>I've noticed this logs in the ElasticSearch's console whenever i try to run my SpringBoot application:</p>\n<blockquote>\n<p>[2023-04-23T14:57:56,085][WARN ][o.e.h.n.Netty4HttpServerTransport] [DESKTOP-LO4MIAG] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel{localAddress=/127.0.0.1:9200, remoteAddress=/127.0.0.1:53007}</p>\n</blockquote>\n"},{"tags":["java","ordinals","icu4j"],"comments":[{"owner":{"display_name":"user15773347"},"edited":false,"comment_id":133944462,"body":"You can use PluralRules. <a href=\"https://unicode-org.github.io/icu-docs/apidoc/released/icu4j/com/ibm/icu/text/PluralRules.html\" rel=\"nofollow noreferrer\">unicode-org.github.io/icu-docs/apidoc/released/icu4j/com/ibm&zwnj;&#8203;/&hellip;</a>"},{"owner":{"user_id":12567365,"display_name":"andrewJames"},"edited":false,"comment_id":133945021,"body":"For me, your code does not return <code>0</code>. It throws <code>java.text.ParseException: Unparseable number: &quot;FOURTH&quot;</code>."},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"edited":false,"comment_id":133948154,"body":"Interestingly, I found several existing questions that ask about integer to ordinal text, but this is the only Question I could find asking about the opposite, ordinal text to integer."}],"answers":[{"owner":{"user_id":19347667,"display_name":"Christian Phillips"},"up_vote_count":3,"is_accepted":true,"creation_date":1680716846,"answer_id":75942580,"body":"<p>So I read up on the <a href=\"https://unicode-org.github.io/icu-docs/apidoc/released/icu4j/\" rel=\"nofollow noreferrer\">Javadoc documentation</a> of <a href=\"https://unicode-org.github.io/icu/userguide/icu4j/\" rel=\"nofollow noreferrer\">icu4j</a> and the <a href=\"https://unicode-org.github.io/icu-docs/apidoc/released/icu4j/com/ibm/icu/text/RuleBasedNumberFormat.html\" rel=\"nofollow noreferrer\"><code>RuleBasedNumberFormat</code></a> does not have FOURTH as a parsable string although it does support four. And instead of using <a href=\"https://unicode-org.github.io/icu-docs/apidoc/released/icu4j/com/ibm/icu/text/RuleBasedNumberFormat.html#ORDINAL\" rel=\"nofollow noreferrer\"><code>RuleBasedNumberFormat.ORDINAL</code></a> uses <a href=\"https://unicode-org.github.io/icu-docs/apidoc/released/icu4j/com/ibm/icu/text/RuleBasedNumberFormat.html#SPELLOUT\" rel=\"nofollow noreferrer\">RuleBasedNumberFormat.SPELLOUT</a>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>RuleBasedNumberFormat formatter = new RuleBasedNumberFormat( Locale.US , RuleBasedNumberFormat.SPELLOUT );\ntry\n{\n    int result = formatter.parse( &quot;FOURTH&quot;.toLowerCase( Locale.ROOT ) ).intValue();\n    System.out.println( &quot;result = &quot; + result );\n}\ncatch ( ParseException e )\n{\n    â€¦ add code to handle exception.\n}\n</code></pre>\n<p>When run:</p>\n<blockquote>\n<p>4</p>\n</blockquote>\n<p>This is what the code should look like and make sure to use .toLowerCase(Locale.ROOT) because parse does not work on upperCase strings.</p>\n"}],"owner":{"user_id":15281963,"display_name":"dojie"},"view_count":70,"up_vote_count":3,"accepted_answer_id":75942580,"answer_count":1,"score":3,"creation_date":1680707113,"question_id":75941066,"body":"<p>I am attempting to convert an ordinal string, say &quot;FOURTH&quot; to integer 4. How can I accomplish this with the <a href=\"https://en.wikipedia.org/wiki/International_Components_for_Unicode\" rel=\"nofollow noreferrer\"><em>International Components for Unicode</em></a> library for Java, <a href=\"https://unicode-org.github.io/icu/userguide/icu4j/\" rel=\"nofollow noreferrer\">icu4j</a>?</p>\n<pre><code>RuleBasedNumberFormat formatter = new RuleBasedNumberFormat(Locale.US, RuleBasedNumberFormat.ORDINAL);\n\nreturn formatter.parse(&quot;FOURTH&quot;).intValue();\n</code></pre>\n<p>Seems like this is not working, as 0 is being returned.\nI'm expecting this to return 4.</p>\n<p>Any help would be appreciated. Thank you.</p>\n"},{"tags":["java","android","nfc"],"comments":[{"owner":{"user_id":2425802,"display_name":"Michael Roland"},"edited":false,"comment_id":133540291,"body":"Could you reveal how you receive your tag handle and where you pass it around in your code?"},{"owner":{"user_id":6742793,"display_name":"autoimovil"},"edited":false,"comment_id":133540567,"body":"I edited the code block to show how I get de Tag handler from the intent."},{"owner":{"user_id":10418725,"display_name":"Jorn Rigter"},"edited":false,"comment_id":133540852,"body":"<a href=\"https://github.com/status-im/status-mobile/issues/14815\" rel=\"nofollow noreferrer\">This Github issue about this same problem</a> might be useful"},{"owner":{"user_id":2373819,"display_name":"Andrew"},"edited":false,"comment_id":133541624,"body":"This seems a logical change as you should not been trying to use old Tag Objects when you should have been dispatched a new one to handle. I note the that Android Bug that @Jorn Rigter indirrect linked to has been closed as won&#39;t fix. So I&#39;ve created a new documentation bug <a href=\"https://issuetracker.google.com/issues/272552420\" rel=\"nofollow noreferrer\">issuetracker.google.com/issues/272552420</a> to cover the fact that the NFC documentation does not reference this new Exception"}],"answers":[{"owner":{"user_id":2425802,"display_name":"Michael Roland"},"up_vote_count":4,"is_accepted":false,"creation_date":1678652306,"answer_id":75716148,"body":"<p>This is intended by design. The problem here is that you store a tag handle and try to use it later on (maybe even after letting the user press a button or so?). You should never have done this in the first place, NFC is user interaction and you should act immediately upon scanning the tag and keep the transaction as short as possible (after all user's are not good at holding two devices constantly together for a longer period). Android finally reduced the surface of bad programming habits in that regard (see <a href=\"https://android.googlesource.com/platform/frameworks/base/+/113f3a4a1d9171db7456aa9ae8b0a2b50545c326\" rel=\"nofollow noreferrer\">here</a>) by making sure that your tag handle is current when you try to access a tag. This change prevents access to an invalidated tag handle once tag disconnection or a new tag discovery takes place.</p>\n"},{"owner":{"user_id":6742793,"display_name":"autoimovil"},"up_vote_count":1,"is_accepted":true,"creation_date":1678866129,"answer_id":75741753,"body":"<p>It seems that on Android 13 you should manage NFC writing once the onResume() was called. I resolved it moving NFC writing from onNewIntent() to onResume().</p>\n"}],"owner":{"user_id":6742793,"display_name":"autoimovil"},"view_count":494,"up_vote_count":3,"accepted_answer_id":75741753,"answer_count":2,"score":3,"creation_date":1678448233,"question_id":75695662,"body":"<p>I have this code (Java) to write nfc tags:</p>\n<pre><code>private Tag tag;\n\n@Override\nprotected void onNewIntent(Intent intent) {\n    if (NfcAdapter.ACTION_TAG_DISCOVERED.equals(intent.getAction())) {\n        tag = intent.getParcelableExtra(NfcAdapter.EXTRA_TAG);\n    }\n}\n\nprivate boolean write(String message, Tag tag) throws IOException, FormatException {\n    Ndef ndef = Ndef.get(tag);\n    ndef.connect();\n    if (ndef.isWritable()) {\n        ndef.writeNdefMessage(message);\n    }\n    ndef.close();\n}\n</code></pre>\n<p>Said code was working until I updated my app to be compatible with the latest versions of Android.</p>\n<p>Now running this code on Android 13 gives me the following exception:</p>\n<pre><code>java.lang.SecurityException: Permission Denial: Tag ( ID: XX XX XX XX XX XX XX ) is out of date\n    at android.nfc.Tag.getTagService(Tag.java:388)\n    at android.nfc.tech.BasicTagTechnology.connect(BasicTagTechnology.java:73)\n    at android.nfc.tech.Ndef.connect(Ndef.java:71)\n</code></pre>\n<p>I understand that there is some compatibility problem but I don't know what exactly.</p>\n<p>I am thankful for any kind of help.</p>\n<p>UPDATE: Thanks to your feedback and some additional research I came to a solution.</p>\n<p>I was triggering this NFC write from the onNewIntent function. It seems that it is no longer possible due to some security issues. I solved it by triggering this NFC write from the onResume function instead.</p>\n<p>Thank you all for your help.</p>\n"},{"tags":["java","language-lawyer","annotation-processing","jls"],"comments":[{"owner":{"user_id":1079354,"display_name":"Makoto"},"edited":false,"comment_id":133492473,"body":"Wait, you&#39;re attaching an annotation to a generic type?  Why would one <i>want</i> to do that, let alone if it&#39;s legal??"},{"owner":{"user_id":208288,"display_name":"Laird Nelson"},"edited":false,"comment_id":133492527,"body":"I am a curious fellow."},{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":133492861,"body":"I think you should be asking on the relevant OpenJDK mailing list."},{"owner":{"user_id":208288,"display_name":"Laird Nelson"},"edited":false,"comment_id":133493119,"body":"Sure. I like to do my homework first. Anyway see <a href=\"https://mail.openjdk.org/pipermail/compiler-dev/2023-March/022408.html\" rel=\"nofollow noreferrer\">mail.openjdk.org/pipermail/compiler-dev/2023-March/022408.ht&zwnj;&#8203;ml</a> and following."},{"owner":{"user_id":6395627,"display_name":"Slaw"},"edited":false,"comment_id":133493368,"body":"@Makoto You can get the type variables at run-time (e.g., <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/Class.html#getTypeParameters()\" rel=\"nofollow noreferrer\">from a class</a>). And <code>TypeVariable</code> is an <code>AnnotatedType</code>. So, one might want to define behavior at run-time based on an annotation on the type parameter. Not sure if they&#39;re directly processed (via an annotation processor) at compile-time though."},{"owner":{"user_id":860630,"display_name":"Colin Alworth"},"edited":false,"comment_id":133608167,"body":"Indeed they are available at compile-time in an annotation processor, at least in Java 11+."}],"answers":[{"owner":{"user_id":4297386,"display_name":"Liam Miller-Cushon"},"up_vote_count":3,"is_accepted":true,"creation_date":1678232615,"answer_id":75668221,"body":"<p>The change to make <code>@Target</code>-less annotations &quot;applicable in all declaration contexts&quot; happened in <a href=\"https://bugs.openjdk.org/browse/JDK-8261610\" rel=\"nofollow noreferrer\">JDK-8261610</a>.</p>\n<p>I agree with your reading of <a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-9.html#jls-9.6.4.1\" rel=\"nofollow noreferrer\">JLS 19 Â§9.6.4.1</a>, which says that the 'declaration contexts' include\n&quot;type parameter declarations of generic classes, interfaces, methods, and constructors&quot;, and that</p>\n<blockquote>\n<p>If an annotation of type <code>java.lang.annotation.Target</code> is not present on the declaration of an annotation interface <code>A</code>, then <code>A</code> is applicable in all declaration contexts and in no type contexts.</p>\n</blockquote>\n<p>I think this is a bug: <a href=\"https://bugs.openjdk.org/browse/JDK-8303784\" rel=\"nofollow noreferrer\">https://bugs.openjdk.org/browse/JDK-8303784</a></p>\n"}],"owner":{"user_id":208288,"display_name":"Laird Nelson"},"view_count":67,"up_vote_count":3,"accepted_answer_id":75668221,"answer_count":1,"score":3,"creation_date":1678229389,"question_id":75667924,"body":"<p><a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-9.html#jls-9.6.4.1\" rel=\"nofollow noreferrer\">Section 9.6.4.1 of the Java Language Specification version 19</a> lists all declaration contexts in the Java language.  One of those declaration contexts is &quot;<a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-9.html#jls-9.6.4.1:%7E:text=Type%20parameter%20declarations,annotation.ElementType.TYPE_PARAMETER\" rel=\"nofollow noreferrer\">Type parameter declarations of generic classes, interfaces, methods, and constructors</a>&quot;.</p>\n<p>The Java Language Specification version 19 says &quot;<a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-9.html#jls-9.6.4.1:%7E:text=If%20an%20annotation%20of%20type%20java.lang.annotation.Target%20is%20not%20present%20on%20the%20declaration%20of%20an%20annotation%20interface%20A%2C%20then%20A%20is%20applicable%20in%20all%20declaration%20contexts%20and%20in%20no%20type%20contexts.\" rel=\"nofollow noreferrer\">If an annotation of type <code>java.lang.annotation.Target</code> is not present on the declaration of an annotation interface <code>A</code>, then <code>A</code> is applicable in all declaration contexts and in no type contexts</a>&quot;</p>\n<p>The <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/annotation/Target.html\" rel=\"nofollow noreferrer\">javadocs for <code>@Target</code> in Java 19 say</a> that if I have an annotation class not annotated with <code>@Target</code>, my annotation may be used &quot;<a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/annotation/Target.html#:%7E:text=If%20an%20%40Target%20meta%2Dannotation%20is%20not%20present%20on%20an%20annotation%20interface%20T%2C%20then%20an%20annotation%20of%20type%20T%20may%20be%20written%20as%20a%20modifier%20for%20any%20declaration.\" rel=\"nofollow noreferrer\">as a modifier for any declaration</a>&quot; (full stop).</p>\n<p>In the Java Language Specification version 13, but <em>not</em> in 14 and later, the text reads, instead: &quot;<a href=\"https://docs.oracle.com/javase/specs/jls/se13/html/jls-9.html#jls-9.6.4.1:%7E:text=If%20an%20annotation%20of%20type%20java.lang.annotation.Target%20is%20not%20present%20on%20the%20declaration%20of%20an%20annotation%20type%20T%2C%20then%20T%20is%20applicable%20in%20all%20declaration%20contexts%20except%20type%20parameter%20declarations%2C%20and%20in%20no%20type%20contexts.\" rel=\"nofollow noreferrer\">If an annotation of type <code>java.lang.annotation.Target</code> is not present on the declaration of an annotation type <code>T</code>, then <code>T</code> is applicable in all declaration contexts <strong>except type parameter declarations</strong>, and in no type contexts</a>&quot;.</p>\n<p>The javadocs for <code>@Target</code> in Java 13 (but not in 14 and later) read (similarly): &quot;<a href=\"https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/annotation/Target.html#:%7E:text=If%20an%20%40Target%20meta%2Dannotation%20is%20not%20present%20on%20an%20annotation%20type%20T%20%2C%20then%20an%20annotation%20of%20type%20T%20may%20be%20written%20as%20a%20modifier%20for%20any%20declaration%20except%20a%20type%20parameter%20declaration.\" rel=\"nofollow noreferrer\">If an annotation of type <code>java.lang.annotation.Target</code> is not present on the declaration of an annotation type <code>T</code>, then <code>T</code> is applicable in all declaration contexts <strong>except type parameter declarations</strong>, and in no type contexts</a>&quot;.</p>\n<p>The javadocs for <code>@Target</code> in Java 17 finally change (belatedly?) to match the specification (as changed in 14), reading (as they do today in Java 19): &quot;<a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Target.html#:%7E:text=If%20an%20%40Target%20meta%2Dannotation%20is%20not%20present%20on%20an%20annotation%20interface%20T%2C%20then%20an%20annotation%20of%20type%20T%20may%20be%20written%20as%20a%20modifier%20for%20any%20declaration.\" rel=\"nofollow noreferrer\">If an [sic] <code>@Target</code> meta-annotation is not present on an annotation interface <code>T</code>, then an annotation of type <code>T</code> may be written as a modifier for any declaration</a>&quot;.</p>\n<p>So given this in Java 19:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Retention(RetentionPolicy.RUNTIME)\npublic @interface A {}\n\npublic class B&lt;@A C&gt; {}\n</code></pre>\n<p>â€¦I would think it would be legal:</p>\n<ul>\n<li><code>C</code> is a type parameter declaration so</li>\n<li><code>@A</code>, which is <code>@Target</code>-less, should be able to apply to it, and</li>\n<li>this is not (seemingly) a type context listed in the <a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-4.html#jls-4.11\" rel=\"nofollow noreferrer\">Java Language Specification version 19 section 4.11</a>.</li>\n</ul>\n<p>But <code>javac</code> says that <code>@A</code> is <code>not applicable in this type context</code>.</p>\n<p>Is this a bug?  Or have I misread the Java Language Specification, version 19?</p>\n"},{"tags":["java","postgresql","jdbc","database-replication"],"comments":[{"owner":{"user_id":6464308,"display_name":"Laurenz Albe"},"edited":false,"comment_id":133361395,"body":"It looks like you got the bytes. Can you be specific about what is lacking?"},{"owner":{"user_id":2816429,"display_name":"HariHaravelan"},"edited":false,"comment_id":133362119,"body":"Yes, I am not sure what to do with it I am looking for a way to decode that byte array If I read from a logical replication slot I get the readable string"}],"answers":[{"owner":{"user_id":6464308,"display_name":"Laurenz Albe"},"up_vote_count":3,"is_accepted":true,"creation_date":1677584477,"answer_id":75591579,"body":"<p>With (physical) streaming replication, the transaction log (WAL) is transferred as it is, which is very low-level binary information. Think of it as â€œin file X, replace the 42 bytes starting at offset 123 with the following: ...â€. That is information that does not make any sense outside the database itself (or outside a streaming replication standby server, which is a physical copy).</p>\n<p>There is no way you can reliably extract useful information from WAL. If you need that, you have to use <em>logical decoding</em>, where a <em>logical decoding plugin</em> on the primary server reverse engineers the WAL information into useful logical information.</p>\n<p>The use cases for streaming physical information are very limited. One use case I can imagine is if you want to write a WAL archival program in Java, similar to the built-in <code>pg_receivewal</code>.</p>\n"}],"owner":{"user_id":2816429,"display_name":"HariHaravelan"},"view_count":53,"up_vote_count":3,"accepted_answer_id":75591579,"answer_count":1,"score":3,"creation_date":1677577596,"question_id":75590302,"body":"<p>I am trying to read the data from <code>physical</code> replication slot using JDBC's <code>ReplicationAPI</code></p>\n<p>I am using Postgres 13</p>\n<p>Here is the sample code</p>\n<pre><code>        LogSequenceNumber lsn = getCurrentLSN(sqlConnection);\n\n        PGReplicationStream stream =\n                pgConnection\n                        .getReplicationAPI()\n                        .replicationStream()\n                        .physical()\n                        .withStartPosition(lsn)\n                        .start();\n\n        ByteBuffer buffer = stream.read();\n\n        int offset = buffer.arrayOffset();\n        byte[] source = buffer.array();\n        int length = source.length - offset;\n        System.out.println(new String(source, offset, length));\n</code></pre>\n<p>My code outputs the garbled string, Is there right a way to read the <code>bytes</code> returned from the PGReplicationStream\nI have not found a single document as to  how to process the bytes being returned from PGReplicationStream</p>\n<p>The DML inserted to DB: <code>insert into t2(id,name) values(1,'Jane Doe');</code></p>\n<p>Garbled string Ouput: <code>D\u000Eï¿½3h ï¿½Lï¿½ \u0013ï¿½4@ï¿½\u0013Jane Doe.\u000Eï¿½3hï¿½A$ï¿½ï¿½ï¿½9ï¿½ï¿½'ï¿½ï¿½ï¿½4</code></p>\n<p>HexString of Byte Array: <code>7700000000016833c00000000001683438000298be27a1a28f440000000e0200008833680100000000000a0000f24ce4b1002013007f060000843400001f40000000000000ff0302000208180001000000134a616e6520446f65030008000000002e0000000e020000c03368010000000080010000412497e4ff14399ea127be98020001000000843400007f0600000000</code></p>\n"}],"has_more":true,"quota_max":300,"quota_remaining":185}