{"items":[{"tags":["java","dependencies","classloader","agent","byte-buddy"],"comments":[{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":133225235,"body":"You are mixing up two different tasks. First, creating a runtime environment which can cope with different versions of the same library. Second, implementing a Java Agent which can work correctly in such an environment. There is no way around the second task, so if <code>maven-shade-plugin</code> did already solve the first task but your Agent did not use the correct package, try fixing your Agent."},{"owner":{"user_id":21212592,"display_name":"Gourav Kumar"},"edited":false,"comment_id":133226673,"body":"Basically what i was thinking that i will set my custom classloader as the default and will not load the <code>integration</code> module by adding some check and when user application&#39;s flow will go to the <code>premain</code> method in <code>agent</code> module then i will get user external dependencies through getClass().getClassLoader().And then will load only those dependencies which user is using.And also i will have to make  submodules of <code>integration</code> module by different dependency versions). and will load only those modules for which interceptor is being used. For eg: okhttp 3.14.9 interceptor module. if user uses it."},{"owner":{"user_id":21212592,"display_name":"Gourav Kumar"},"edited":false,"comment_id":133226703,"body":"You can refer this repo[<a href=\"https://github.com/keploy/java-sdk]\" rel=\"nofollow noreferrer\">github.com/keploy/java-sdk]</a>. In this project i am trying to achieve the above task."}],"owner":{"user_id":21212592,"display_name":"Gourav Kumar"},"view_count":106,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1676391908,"question_id":75450643,"body":"<p>I have a multimodule project called <code>k-sdk</code>. It has modules like</p>\n<p><strong>---&gt;</strong> <code>agent</code></p>\n<p><strong>---&gt;</strong> <code>core</code></p>\n<p><strong>---&gt;</strong> <code>api</code></p>\n<p><strong>---&gt;</strong> <code>integration</code></p>\n<p><strong>---&gt;</strong> <code>sdk</code></p>\n<p>where (<strong>sdk</strong> module contains <strong>core</strong>, <strong>api</strong>, <strong>integration</strong> modules and acting as a shaded jar).\nThis jar can be imported as a dependency in the user application.</p>\n<p>Here <code>k-sdk</code> is acting as a middleware to capture <code>request</code> and <code>response</code> of the api calls (both external and internal) and do some custom processing. And to intercept the internal calls i am using <code>servlet-filter</code> &amp; for external calls, i am using <a href=\"http://bytebuddy.net/#/\" rel=\"nofollow noreferrer\">ByteBuddy</a> and wrote the required code in the <code>premain</code> method. The corresponding interceptors are written in <strong>integration</strong> module. User can use this <code>k-sdk</code> by running agent jar(present in agent module) of the <code>k-sdk</code>.</p>\n<p>Now comes to the actual problem. Suppose I have written an Interceptor for <code>OkHttp</code> client version <code>4.10.0</code> in the <code>integration</code> module and the user is using the same client of version <code>3.14.9</code>, now these two versions share completely same package name. And there are some uncommon apis, methods etc, which is being used in the <code>OkHttpInterceptor</code> which results in <strong>java.lang.NoSuchMethodError</strong> because maven only resolves that version of dependency which has the shortest path. And only 1 version of a dependency will be loaded in the classloader.</p>\n<p>Now, To resolve this version conflict what i was thinking that i will use the below custom classloader. (<a href=\"https://medium.com/@isuru89/java-a-child-first-class-loader-cbd9c3d0305\" rel=\"nofollow noreferrer\">ref</a>) as i know that the solution lies in this approach only.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class ChildFirstClassLoader extends URLClassLoader {\n\n    private final ClassLoader sysClzLoader;\n\n    public ChildFirstClassLoader(URL[] urls, ClassLoader parent) {\n        super(urls, parent);\n        sysClzLoader = getSystemClassLoader();\n    }\n\n    @Override\n    protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException {\n        // has the class loaded already?\n        Class&lt;?&gt; loadedClass = findLoadedClass(name);\n        if (loadedClass == null) {\n            try {\n                if (sysClzLoader != null) {\n                    loadedClass = sysClzLoader.loadClass(name);\n                }\n            } catch (ClassNotFoundException ex) {\n                // class not found in system class loader... silently skipping\n            }\n\n            try {\n                // find the class from given jar urls as in first constructor parameter.\n                if (loadedClass == null) {\n                    loadedClass = findClass(name);\n                }\n            } catch (ClassNotFoundException e) {\n                // class is not found in the given urls.\n                // Let's try it in parent classloader.\n                // If class is still not found, then this method will throw class not found ex.\n                loadedClass = super.loadClass(name, resolve);\n            }\n        }\n\n        if (resolve) {      // marked to resolve\n            resolveClass(loadedClass);\n        }\n        return loadedClass;\n    }\n\n\n\n    @Override\n    public Enumeration&lt;URL&gt; getResources(String name) throws IOException {\n        List&lt;URL&gt; allRes = new LinkedList&lt;&gt;();\n\n        // load resources from sys class loader\n        Enumeration&lt;URL&gt; sysResources = sysClzLoader.getResources(name);\n        if (sysResources != null) {\n            while (sysResources.hasMoreElements()) {\n                allRes.add(sysResources.nextElement());\n            }\n        }\n\n        // load resource from this classloader\n        Enumeration&lt;URL&gt; thisRes = findResources(name);\n        if (thisRes != null) {\n            while (thisRes.hasMoreElements()) {\n                allRes.add(thisRes.nextElement());\n            }\n        }\n\n        // then try finding resources from parent classloaders\n        Enumeration&lt;URL&gt; parentRes = super.findResources(name);\n        if (parentRes != null) {\n            while (parentRes.hasMoreElements()) {\n                allRes.add(parentRes.nextElement());\n            }\n        }\n\n        return new Enumeration&lt;URL&gt;() {\n            Iterator&lt;URL&gt; it = allRes.iterator();\n\n            @Override\n            public boolean hasMoreElements() {\n                return it.hasNext();\n            }\n\n            @Override\n            public URL nextElement() {\n                return it.next();\n            }\n        };\n    }\n\n    @Override\n    public URL getResource(String name) {\n        URL res = null;\n        if (sysClzLoader != null) {\n            res = sysClzLoader.getResource(name);\n        }\n        if (res == null) {\n            res = findResource(name);\n        }\n        if (res == null) {\n            res = super.getResource(name);\n        }\n        return res;\n    }\n}\n</code></pre>\n<p>And to improve the user experience, i have to make changes only in the <code>premain</code> method. Now i don't know how to use this classloader to resolve this conflicting issue.</p>\n<p>The above classloader is extending <code>URLClassLoader</code>, and the application class loader is no longer an instance of <code>java.net.URLClassLoader</code> in java 9+.</p>\n<p>I am very new to this complex solution, Please! help me out.</p>\n<p>Before this solution, i tried to repackage classes using <code>maven-shade-plugin</code> but that solution was not working because in <code>premain</code> method using ByteBuddy i was targeting a class of actual package and was using different package in the interceptor so the flow was not going to the interceptor as the class was not matching.</p>\n"},{"tags":["java","android","sharedpreferences","android-jetpack","datastore"],"answers":[{"owner":{"user_id":13533028,"display_name":"Narendra_Nath"},"up_vote_count":0,"is_accepted":false,"creation_date":1676345627,"answer_id":75443204,"body":"<p>It is very straightforward to migrate from sharedPreferences to dataStore.\nPass the old SharedPref name and the migration happens automatically.</p>\n<pre><code>private val dataStore: DataStore&lt;Preferences&gt; =\n    context.createDataStore(\n        name = &quot;data&quot;,\n        migrations = \n          listOf(SharedPreferencesMigration(context, &quot;shared_preferences_name&quot;))\n    )\n</code></pre>\n"},{"owner":{"user_id":20842131,"display_name":"maxvolk"},"up_vote_count":0,"is_accepted":false,"creation_date":1683285439,"answer_id":76181597,"body":"<p>I was at the exact same point in my project. Suddenly the sharedpreferences are deprecated, so what now.\nDataStore can be found rather quickly but I also think the <a href=\"https://developer.android.com/topic/libraries/architecture/datastore#preferences-datastore\" rel=\"nofollow noreferrer\">documentation</a> is not sufficient in clearing up what needs to be done.</p>\n<p>I did get it to work though:</p>\n<p><strong>1. Implementing</strong></p>\n<p>Implement this in the dependencies (app module):</p>\n<pre><code>//DataStore instead of SharedPreferences\nimplementation &quot;androidx.datastore:datastore-preferences:1.0.0&quot;\n//RxJava2 support\nimplementation &quot;androidx.datastore:datastore-preferences-rxjava2:1.0.0&quot;\n</code></pre>\n<p><strong>2. Initializing</strong></p>\n<p>I am using the RxDataStore and the associated RxDataStoreBuilder:</p>\n<pre><code>RxDataStore&lt;Preferences&gt; dataStoreRX; //Top Part\ndataStoreRX = new RxPreferenceDataStoreBuilder(this,&quot;your_datastorename&quot;).build(); //onCreate\n</code></pre>\n<p><strong>3. Storing Data</strong></p>\n<p>To save data in the DataStore you can use what is in the doc:</p>\n<pre><code>public boolean putStringValue(String Key, String value){\n  boolean returnvalue;\n  Preferences.Key&lt;String&gt; PREF_KEY = PreferencesKeys.stringKey(Key);\n  Single&lt;Preferences&gt; updateResult =  dataStoreRX.updateDataAsync(prefsIn -&gt; {\n  MutablePreferences mutablePreferences = prefsIn.toMutablePreferences();\n  mutablePreferences.set(PREF_KEY, value);\n  return Single.just(mutablePreferences);\n  }).onErrorReturnItem(pref_error);\n\n  returnvalue = updateResult.blockingGet() != pref_error;\n  return returnvalue;\n}\n</code></pre>\n<p>With the litte addition of error handling: onErrorReturnItem</p>\n<pre><code>Preferences pref_error = new Preferences() {...};\n</code></pre>\n<p>Doesnt matter whats in pref_error, it only exists to be returned and to check if it is returned.</p>\n<p><strong>4. Retreiving Data</strong></p>\n<p>To retreive, same thing but backwards and with error-handling:</p>\n<pre><code>String getStringValue(String Key) {\n  Preferences.Key&lt;String&gt; PREF_KEY = PreferencesKeys.stringKey(Key);\n  Single&lt;String&gt; value = dataStoreRX.data().firstOrError().map(prefs -&gt; prefs.get(PREF_KEY)).onErrorReturnItem(&quot;null&quot;);\n  return value.blockingGet();\n}\n</code></pre>\n<p><strong>5. More than that!</strong></p>\n<p>But there is way more to that. If you want to use the DataStore across several activities you need to use a Singleton and thore it as such. The reason is you cant create more than one instance of one DataStore. That is in the <a href=\"https://developer.android.com/topic/libraries/architecture/datastore#preferences-datastore\" rel=\"nofollow noreferrer\">documentation</a> but as I said, I think it is not complete.\nAlso error-handling is not described there.</p>\n<p>But you can use all datatypes to store them with the correct KEY and with the respective returnvalue as an error.</p>\n<p>I elaborate more on this and how to set up the Singleton here: <a href=\"https://medium.com/@deadmanapple/using-the-android-datastore-library-instead-of-sharedpreferences-in-java-d6744c348a05\" rel=\"nofollow noreferrer\">Link to Medium</a></p>\n<p>Hope it helps :)</p>\n"}],"owner":{"user_id":16653709,"display_name":"Chandu"},"view_count":267,"up_vote_count":3,"answer_count":2,"score":3,"creation_date":1676343518,"question_id":75443067,"body":"<p>I'm working on a Java based Android Project where I'm using sharedPreferences to store the data.</p>\n<p>I want to use Preferences DataStore in my project but unable to find any good example to take reference. Please suggest any reference examples in Java to implement preference data store in Android or how to migrate from shared prefs to DataStore.</p>\n<p>I tried to go through <a href=\"https://developer.android.com/topic/libraries/architecture/datastore?gclsrc=aw.ds&amp;&amp;gclid=Cj0KCQjwp86EBhD7ARIsAFkgakg-4Xc0UsX_xgNZmeSeNdZfTuoMoZ4JPUuZUyJq7dUOAV_JSY029GoaAgCHEALw_wcB#java\" rel=\"nofollow noreferrer\">developer documentation</a>, but couldn't understand the example provided</p>\n"},{"tags":["java","spring-boot","spring-mvc","spring-webflux","spring-webclient"],"comments":[{"owner":{"user_id":2094311,"display_name":"CoderBro"},"edited":false,"comment_id":133401299,"body":"Have you got the solution for this?"},{"owner":{"user_id":2353403,"display_name":"Coder"},"edited":false,"comment_id":133419845,"body":"@CoderBro Not yet"},{"owner":{"user_id":4752516,"display_name":"Samit Kumar Patel"},"edited":false,"comment_id":134366056,"body":"Wondering why we can’t set the default header for all of our exchange method when create an instance of WebClient.Builder and setting the baseURL."}],"owner":{"user_id":2353403,"display_name":"Coder"},"view_count":314,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1676298480,"question_id":75437177,"body":"<p>I'm exploring Spring Boot 3. I created 2 REST services where one communicates with the other. Both are using Spring-starter-web and also imported Webflux. I found we can use <em><a href=\"https://docs.spring.io/spring-framework/docs/6.0.0-RC3/javadoc-api/org/springframework/web/service/annotation/HttpExchange.html\" rel=\"nofollow noreferrer\">@HttpExchange</a></em> (My previous experience is Spring Boot 2.6 and also used only RestClient). I have followed <a href=\"https://howtodoinjava.com/spring-webflux/http-declarative-http-client-httpexchange/\" rel=\"nofollow noreferrer\">this link</a> to try.</p>\n<p>I have added @HttpExchange. Created <em>HttpServiceProxyFactory</em> bean as well. Below is my code.\nHow to pass custom headers dynamically? Let's say I want to pass the authenticated user data in the header or some other values that are to be set dynamically.</p>\n<p><strong>Client</strong></p>\n<pre><code>@HttpExchange(&quot;/blog&quot;)\npublic interface BlogClient {\n\n    @PostExchange\n    Mono&lt;Course&gt; create(@RequestBody BlogInfo blogInfo);\n    \n    @GetExchange\n    Mono&lt;Course&gt; get(@PathVariable Long id);\n}\n</code></pre>\n<p><strong>Configuration</strong></p>\n<pre><code>WebClient webClient(String url) {\n    return WebClient.builder().baseUrl(url).build();\n}\n\n@Bean\nBlogClient blogClient() {\n    \n    HttpServiceProxyFactory httpServiceProxyFactory = HttpServiceProxyFactory\n            .builder(WebClientAdapter.forClient(webClient(blogBaseURL))).build();\n    return httpServiceProxyFactory.createClient(BlogClient.class);\n\n}\n</code></pre>\n<hr />\n<p><strong>Update</strong></p>\n<p>I have figured out we can add <em>@RequestHeader</em> as a parameter and pass headers. <a href=\"https://www.baeldung.com/spring-rest-http-headers\" rel=\"nofollow noreferrer\">Similar to reading headers</a>. But then the parameter needs to be added in all methods of all exchange interfaces which seems too much.</p>\n<pre><code>@PostExchange\nMono&lt;Course&gt; create(@RequestBody BlogInfo blogInfo, @RequestHeader Map&lt;String, String&gt; headers);\n        \n@GetExchange\nMono&lt;Course&gt; get(@PathVariable Long id, @RequestHeader Map&lt;String, String&gt; headers);\n</code></pre>\n"},{"tags":["java","spring","asynchronous","tomcat","completable-future"],"owner":{"user_id":10660224,"display_name":"genzr"},"view_count":62,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1676265050,"question_id":75432080,"body":"<p>As I understand it, it is somewhat common practice in API development to return a CompletableFuture as a response type to an API request in situations where the requests could take quite some time to process.</p>\n<p>Handing off to ForkJoinPool threads, for example, would be done in order to free up request handling threads that would otherwise be blocked for the full duration of the request, allowing them to continue servicing more requests.</p>\n<p>Consider this example:</p>\n<pre><code>@GetMapping(&quot;/hello-world&quot;)\npublic CompletableFuture&lt;String&gt; helloWorld() {\n    return CompletableFuture.supplyAsync(() -&gt; {\n        //take 5 seconds to respond with Hello World\n        try {\n            Thread.sleep(5000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        return &quot;Hello World&quot;;\n    });     \n}\n</code></pre>\n<p>A tomcat request processing thread would handle the request and respond with the CompletableFuture. However, a ForkJoinPool thread would be responsible for handling the processing of the CompletableFuture itself.</p>\n<p>From the client's perspective, the request to retrieve the String &quot;Hello World&quot; is 'pending' and then finally resolves after 5 seconds... But the response does indeed contain the String &quot;Hello World&quot;.</p>\n<p>I was expecting the response to the client to be immediate <em>without</em> the resolved &quot;Hello World&quot; string seeing as the CompletableFuture was returned immediately by the request processing thread.</p>\n<p>As I understand it, the request processing thread was released almost immediately. So, How and what is responsible for getting the String &quot;Hello World&quot; back to the client? Is it the ForkJoinPool thread?</p>\n<p>There must be some HTTP protocol magic to keep the connection between the client and the server active until the ForkJoinPool thread finally resolves the CompletableFuture?</p>\n<p>What am I missing in my understanding... Please learn me in the ways of async programming...</p>\n"},{"tags":["java","android","c++","c"],"comments":[{"owner":{"user_id":12002570,"display_name":"Jason"},"edited":false,"comment_id":133085766,"body":"Asking for tools/books/recommendations is off-topic here."},{"owner":{"user_id":5878272,"display_name":"Fredrik"},"edited":false,"comment_id":133085812,"body":"@jason he didn&#39;t ask for any of that"},{"owner":{"user_id":5494370,"display_name":"Alan Birtles"},"edited":false,"comment_id":133085944,"body":"Yes it&#39;s possible. Google for &quot;android ndk&quot; or even just &quot;android c++&quot;"},{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":133086368,"body":"The gist of the question is <i>&quot;... and which are the limitations it has ...&quot;</i>.  The closure reason is arguably incorrect.  IMO it should have been closed as &quot;needs more focus&quot; ... or maybe &quot;opinion based&quot;.  But I also agree with Alan: google it and do some preliminary reading and you should get an idea of the limitations <i>that are relevant to your and your project</i>."},{"owner":{"user_id":1008957,"display_name":"prapin"},"edited":false,"comment_id":133088881,"body":"Our application is cross-platform and written in C++ for around 90%. It runs on Android, with some Kotlin (and Java) code to interface with Android UI, and on iOS with help of some Objective-C and Swift UI wrappers."},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"edited":false,"comment_id":133090119,"body":"I’m voting to reopen. This is a simple direct specific question. It deserves an answer."},{"owner":{"user_id":2985643,"display_name":"skomisa"},"edited":false,"comment_id":133090806,"body":"I&#39;m also voting to reopen. I agree with @BasilBourque - this question is not <i>&quot;seeking recommendations&quot;</i> at all, and the close reason is completely bogus. This is a simple question that has a factual answer. Can any of the close voters explain how they interpret this question to be <i>&quot;seeking recommendations&quot;</i> and <i>&quot;is likely to lead to opinion-based answers&quot;</i>?"},{"owner":{"user_id":2752075,"display_name":"HolyBlackCat"},"edited":false,"comment_id":133097850,"body":"Yes, possible, but you need to find a suitable framework. I know SDL2 can do this, but it&#39;s primarily targeted at games (lacks gui widgets)."},{"owner":{"user_id":2985643,"display_name":"skomisa"},"edited":false,"comment_id":133113143,"body":"[1] I voted to reopen your question yesterday. However, it seems to be a clear duplicate of <a href=\"https://stackoverflow.com/q/64369616/2985643\">Android application only in C++</a>. That has a useful and relevant accepted answer, so I&#39;m now voting to close your question. To avoid closure, can you possibly reframe it to ask something more specific? [2] The old, closed question <a href=\"https://stackoverflow.com/q/13773686/2985643\">Why shouldn&#39;t an Android app be written in C/C++ because you &quot;simply prefer to program in C/C++&quot;?</a> may also be of interest."}],"owner":{"user_id":21197133,"display_name":"David"},"view_count":97,"up_vote_count":7,"answer_count":0,"score":3,"creation_date":1676198065,"question_id":75426354,"body":"<p>I'm finishing my degree on electronics engeneering and I need to create an Android app for a project that I'm doing. The fact is that I've seen that Java is the most used language for doing that, however I'd like to know if it's possible to develop an Android application using C/C++ and which are the limitations it has. I have no experience on Java and I don't have much time to spend learning it right now.</p>\n<p>I haven't started the coding of the app.</p>\n"},{"tags":["java","deprecated","jsr"],"comments":[{"owner":{"user_id":14442758,"display_name":"Z-100"},"edited":false,"comment_id":132973270,"body":"Probably because it&#39;s easier to read in the JavaDoc, than the Annotation itself. Plus The Compiler won&#39;t have any problems if the &quot;useInstead&quot; class doesn&#39;t exist in yet, whilst using JavaDoc"},{"owner":{"user_id":2636929,"display_name":"Stultuske"},"edited":false,"comment_id":132973322,"body":"Let&#39;s say it&#39;s an explanation of three paragraphs, you really think reading that would be easier from a field in the annotation compared to from formatted documentation?"},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":132973564,"body":"Also, it is important to realise that the <code>@deprecated</code> javadoc tag (introduced in Java 1.1, I think) precedes the existence of the <code>@Deprecated</code> annotation (Java 5). The <code>since</code> and <code>forRemoval</code> fields of the annotation where only introduced in Java 9."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":132973757,"body":"When the <code>@Deprecated</code> annotation was introduced (in Java 5), it had no attributes at all. As someone once said <a href=\"https://ericlippert.com/2012/03/09/why-not-automatically-infer-constraints/#:~:text=I%E2%80%99m%20often%20asked,no%20feature.\" rel=\"nofollow noreferrer\">“<i>I’m often asked why the compiler does not implement this feature or that feature, and of course the answer is always the same: because no one implemented it. Features start off as unimplemented and only become implemented when people spend effort implementing them: no effort, no feature.</i>”</a>"}],"owner":{"user_id":1877010,"display_name":"DaHoC"},"view_count":108,"up_vote_count":4,"answer_count":0,"score":3,"creation_date":1675676743,"question_id":75359644,"body":"<p>I understand the Java <code>@Deprecated</code> annotation comes with fields <code>since</code> and <code>forRemoval</code>. However, this is not sufficient for developers to switch to the non-deprecated alternative(s) and therefore it is recommended to additionally put a Javadoc with the <code>@deprecated</code> flag and the link to the new method/class/interface to favor.</p>\n<p>Why is the <code>@Deprecated</code> annotation not already providing such a most relevant field like <code>useInstead</code>, or <code>inFavorOf</code> (even allowing multiple values)?</p>\n<p>It would definitely ease the transition and foster developers to put in the new methods/classes/interfaces to use instead - currently I have to draw dependency sources to get their Javadocs, and even then often times no alternative to the <code>@deprecated</code> method/class/interface is mentioned, so that I have to research what the developers of the original code already knew.</p>\n"},{"tags":["java","android","licensing"],"comments":[{"owner":{"user_id":-1,"display_name":"Community"},"edited":false,"comment_id":132961111,"body":"Please provide enough code so others can better understand or reproduce the problem."}],"answers":[{"owner":{"user_id":21248406,"display_name":"Nitin Ikokas"},"up_vote_count":0,"is_accepted":false,"creation_date":1676873505,"answer_id":75505802,"body":"<pre><code>cd /Applications/Android\\ Studio.app/Contents/jre\nln -s ../jre jdk\nln -s &quot;/Library/Internet Plug-Ins/JavaAppletPlugin.plugin&quot; jdk\nflutter doctor -v\n</code></pre>\n<p>For Mac users who are using JetBrains Toolbox, here is the</p>\n"},{"owner":{"user_id":15680379,"display_name":"Mahfuzur Rahman"},"up_vote_count":0,"is_accepted":false,"creation_date":1679827100,"answer_id":75847200,"body":"<p><strong>Windows:</strong></p>\n<p><strong>1.</strong> First check where is your java home path set by executing <code>echo %JAVA_HOME%</code> command in command prompt.</p>\n<p><strong>example:</strong></p>\n<pre><code>echo %JAVA_HOME%\nC:\\Apps\\Java\\jdk7-x64\n</code></pre>\n<p><strong>2.</strong> If the java version is lower than the Java11 then u need to download and install java version 11 or higher.</p>\n<p><strong>Class file version example:</strong></p>\n<pre><code>class file version 45 = Java 1.1\nclass file version 46 = Java 1.2\nclass file version 47 = Java 1.3\nclass file version 48 = Java 1.4\nclass file version 49 = Java 5\nclass file version 50 = Java 6\nclass file version 51 = Java 7\nclass file version 52 = Java 8\nclass file version 53 = Java 9\nclass file version 54 = Java 10\nclass file version 55 = Java 11\nclass file version 56 = Java 12\nclass file version 57 = Java 13\n</code></pre>\n<p><strong>3.</strong> Now go to 'Environment Variable' setting and in 'User variables' click New button and set <code>Varible name: JAVA_HOME</code> &amp;  <code>Varible value: C:\\Apps\\Java\\jdk11</code>(Put your jdk path).</p>\n<p><strong>4.</strong> Then inside User variables path, add a new path <code>%JAVA_HOME\\bin</code>.</p>\n<p><strong>5.</strong> Now again open command prompt and execute <code>echo %JAVA_HOME%</code> command and check if the new path updated or not. If everything looks fine, then execute this <code>flutter doctor --android-licenses</code> command.</p>\n"}],"owner":{"user_id":5888520,"display_name":"Mien"},"view_count":165,"up_vote_count":3,"answer_count":2,"score":3,"creation_date":1675544702,"question_id":75348372,"body":"<p>Error was: Exception in thread &quot;main&quot; java.lang.UnsupportedClassVersionError: com/android/prefs/AndroidLocationsProvider has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 52.0</p>\n<p>When I launched Android Studio after the re-installation, I never got a prompt to accept any license</p>\n"},{"tags":["javascript","java","reactjs","jsf"],"comments":[{"owner":{"user_id":880619,"display_name":"Jasper de Vries"},"edited":false,"comment_id":132908906,"body":"Please read <a href=\"https://stackoverflow.com/questions/4421839/what-is-the-need-of-jsf-when-ui-can-be-achieved-with-javascript-libraries-such\" title=\"what is the need of jsf when ui can be achieved with javascript libraries such\">stackoverflow.com/questions/4421839/&hellip;</a>"}],"owner":{"user_id":18058266,"display_name":"Ons belkhouja"},"view_count":111,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1675335594,"question_id":75322174,"body":"<p>I was trying to integrate a <strong>React project</strong> into a <strong>JSF framework</strong> as a module\nI'm still looking for the <strong>correct path</strong> to take ?\nwhat should I do and use to have the <strong>best performance and behaviors</strong> ?\nThanks in advance.</p>\n<p>I tried to use webpack to create a dist (bundle js) and then call that bundle as a script in xhtml page\nit works, but I want to know if there's a better way to do it.</p>\n"},{"tags":["java","json","spring"],"comments":[{"owner":{"user_id":10245558,"display_name":"Roland"},"edited":false,"comment_id":132884576,"body":"can you provide the REST endpoint that is receiving this JSON payload"}],"answers":[{"owner":{"user_id":9443176,"display_name":"Max Aminov"},"up_vote_count":0,"is_accepted":true,"creation_date":1675183483,"answer_id":75300365,"body":"<p>You do not need a Data class because <strong>data</strong> field in your json is not an object - it is an array of objects, in your case it is an array of <strong>Coin</strong> objects.</p>\n<p>Change it the next way:</p>\n<pre><code>public class MainDTO{\n    @JsonProperty(&quot;status&quot;)\n    private Status status;\n    @JsonProperty(&quot;data&quot;)\n    private List&lt;Coin&gt; data;\n}\n</code></pre>\n"},{"owner":{"user_id":10423604,"display_name":"Volodya Lombrozo"},"up_vote_count":0,"is_accepted":false,"creation_date":1675184433,"answer_id":75300556,"body":"<p>It's worth mentioning that the JSON in your example is incorrect due to extra commas. I presume the correct form should look like this:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n    &quot;status&quot;: {\n        &quot;timestamp&quot;: &quot;2023-01-31T14:06:45.210Z&quot;,\n        &quot;error_code&quot;: 0,\n        &quot;error_message&quot;: null\n    },\n    &quot;data&quot;: [\n        {\n            &quot;id&quot;: 7982,\n            &quot;name&quot;: &quot;wc4qtz6py1i&quot;,\n            &quot;tags&quot;: [\n                &quot;40rcevshzab&quot;,\n                &quot;3ja25pufu0z&quot;\n            ],\n            &quot;quote&quot;: {\n                &quot;USD&quot;: {\n                    &quot;price&quot;: 0.2\n                },\n                &quot;BTC&quot;: {\n                    &quot;price&quot;: 7159\n                }\n            }\n        },\n        {\n            &quot;id&quot;: 8742,\n            &quot;name&quot;: &quot;uhso98ca&quot;,\n            &quot;tags&quot;: [\n                &quot;84jsjsaesxx&quot;,\n                &quot;sasdd5dda76&quot;\n            ],\n            &quot;quote&quot;: {\n                &quot;USD&quot;: {\n                    &quot;price&quot;: 6\n                },\n                &quot;BTC&quot;: {\n                    &quot;price&quot;: 1230\n                }\n            }\n        }\n     ]\n }\n</code></pre>\n<p>As for classes I would suggest you the next:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@AllArgsConstructor\n@NoArgsConstructor\n@Getter\n@Setter\npublic class MainDTO {\n    @JsonProperty(&quot;status&quot;)\n    private Status status;\n    @JsonProperty(&quot;data&quot;)\n    private List&lt;Coin&gt; coins;\n}\n\n@AllArgsConstructor\n@NoArgsConstructor\n@Getter\n@Setter\npublic class Status {\n    @JsonProperty(&quot;timestamp&quot;)\n    private String timestamp;\n    @JsonProperty(&quot;error_code&quot;)\n    private Integer errorCode;\n    @JsonProperty(&quot;error_message&quot;)\n    private String errorMessage;\n}\n\n@AllArgsConstructor\n@NoArgsConstructor\n@Getter\n@Setter\npublic class Coin {\n    @JsonProperty(&quot;id&quot;)\n    private Integer id;\n    @JsonProperty(&quot;name&quot;)\n    private String name;\n    @JsonProperty(&quot;tags&quot;)\n    private List&lt;String&gt; tags;\n    @JsonProperty(&quot;quote&quot;)\n    private Map&lt;String, Quote&gt; quote;\n}\n\n@AllArgsConstructor\n@NoArgsConstructor\n@Getter\n@Setter\npublic class Quote {\n    @JsonProperty(&quot;price&quot;)\n    private Double price;\n}\n</code></pre>\n<p>The &quot;data&quot; array in the <code>JSON</code> response is an array of coins, so the coins property in the <code>MainDTO</code> class should be of type <code>List&lt;Coin&gt;</code>.</p>\n"}],"owner":{"user_id":10960565,"display_name":"Даниил "},"view_count":54,"up_vote_count":3,"accepted_answer_id":75300365,"answer_count":2,"score":3,"creation_date":1675176344,"question_id":75298861,"body":"<p>I'm trying to get responce from another API  convert it to Java clases and then sent to the front end using Spring Boot\nI have JSON response from external API like this</p>\n<pre><code>{\n    &quot;status&quot;: {\n        &quot;timestamp&quot;: &quot;2023-01-31T14:06:45.210Z&quot;,\n        &quot;error_code&quot;: 0,\n        &quot;error_message&quot;: null,\n    },\n    &quot;data&quot;: [\n        {\n            &quot;id&quot;: 7982,\n            &quot;name&quot;: &quot;wc4qtz6py1i&quot;,\n            &quot;tags&quot;: [\n                &quot;40rcevshzab&quot;,\n                &quot;3ja25pufu0z&quot;\n            ],\n            &quot;quote&quot;: {\n                &quot;USD&quot;: {\n                    &quot;price&quot;: 0.2,\n                },\n                &quot;BTC&quot;: {\n                    &quot;price&quot;: 7159,\n                }\n            }\n        },\n        {\n            &quot;id&quot;: 8742,\n            &quot;name&quot;: &quot;uhso98ca&quot;,\n            &quot;tags&quot;: [\n                &quot;84jsjsaesxx&quot;,\n                &quot;sasdd5dda76&quot;\n            ],\n            &quot;quote&quot;: {\n                &quot;USD&quot;: {\n                    &quot;price&quot;: 6,\n                },\n                &quot;BTC&quot;: {\n                    &quot;price&quot;: 1230,\n                }\n            }\n        }\n     ]\n }\n</code></pre>\n<p>I need to convert all of this to classes using Spring Boot. But how I should organize it?\nThe most question is about &quot;Data&quot; array.\nFor now I have something like this.</p>\n<pre><code>@AllArgsConstructor\n@NoArgsConstructor\n@Getter\n@Setter\npublic class MainDTO{\n    @JsonProperty(&quot;status&quot;)\n    private Status status;\n    @JsonProperty(&quot;data&quot;)\n    private Data data;\n}\n</code></pre>\n<pre><code>@AllArgsConstructor\n@NoArgsConstructor\n@Getter\n@Setter\npublic class Data {\n    Coin[] coins;\n}\n</code></pre>\n<pre><code>@AllArgsConstructor\n@NoArgsConstructor\n@Getter\n@Setter\npublic class Coin{\n    @JsonProperty(&quot;id&quot;)\n    private Integer id;\n    @JsonProperty(&quot;name&quot;)\n    private String name;\n    private Map&lt;String, Coin&gt; quote;\n}\n</code></pre>\n<p>But it doesn't work. I have error:</p>\n<pre><code>I have error\nTue Jan 31 16:13:45 EET 2023\nThere was an unexpected error (type=Internal Server Error, status=500).\nError while extracting response for type [class com.example.myCoolApp.entity.MainDTO] and content type [application/json;charset=utf-8]\norg.springframework.web.client.RestClientException: Error while extracting response for type [class com.example.myCoolApp.entity.CryptoDTO] and content type [application/json;charset=utf-8]\n</code></pre>\n"},{"tags":["java","multithreading","for-loop","javafx","concurrency"],"comments":[{"owner":{"user_id":2189127,"display_name":"James_D"},"edited":false,"comment_id":132824031,"body":"Don’t post images of code. Post the code as text, properly formatted."},{"owner":{"user_id":19415089,"display_name":"asad"},"edited":false,"comment_id":132824125,"body":"I did it! I am new to stackoverflow and didn&#39;t know the features."},{"owner":{"user_id":1155209,"display_name":"jewelsea"},"edited":false,"comment_id":132824312,"body":"Don’t use a loop.  Use events.  See this example for <a href=\"https://stackoverflow.com/questions/74309273/javafx-webview-call-method-on-returned-java-object/74310505#74310505\">calling Java from JavaScript</a>.  Have JavaScript asynchronously do whatever it does and notify your Java app when complete,  then your app can instruct the JavaScript to perform the next task in the list if any are left, otherwise you are done."},{"owner":{"user_id":19415089,"display_name":"asad"},"edited":false,"comment_id":132824617,"body":"@jewelsea thank you for your answer,  but can you please clarify what you mean by events? Also, I need to come back to java after the JS function is done executing to execute some other gui events and then go back to the loop to load another html page and execute some other JS function in the new html page...thats why I am using a loop unless there are any other alternatives that are substitutable here."},{"owner":{"user_id":3956070,"display_name":"Jos&#233; Pereda"},"edited":false,"comment_id":132827946,"body":"This bug could be related: <a href=\"https://bugs.openjdk.org/browse/JDK-8286633\" rel=\"nofollow noreferrer\">bugs.openjdk.org/browse/JDK-8286633</a>"},{"owner":{"user_id":1155209,"display_name":"jewelsea"},"edited":false,"comment_id":132829123,"body":"By &quot;event&quot; in this context, I just mean some kind of future notification that something occurred (sorry maybe wasn&#39;t a good word choice or clearly explained).  If you already have the code to &quot;come back to java after the JS function is done executing&quot;, then that is really what I referring to.  Maintain a list or queue of items to service and each time you receive such a callback, remove the next item from the list or queue and submit it for execution in JavaScript."},{"owner":{"user_id":2423906,"display_name":"SedJ601"},"edited":false,"comment_id":132830884,"body":"Have your tried to see if <a href=\"https://www.selenium.dev/documentation/\" rel=\"nofollow noreferrer\"><code>Selenium</code></a> could help you?"},{"owner":{"user_id":19415089,"display_name":"asad"},"edited":false,"comment_id":132833614,"body":"@jewelsea, makes sense, thank you for clarifying. I did try doing that, but it made my program very slow so thats why I scratched that idea."},{"owner":{"user_id":19415089,"display_name":"asad"},"edited":false,"comment_id":132833625,"body":"@Jos&#233;Pereda, thanks for that. Looks like it kinda is related to that bug. No wonder I wasn&#39;t able to figure out why. I will look into how I could work my way around it."},{"owner":{"user_id":19415089,"display_name":"asad"},"edited":false,"comment_id":132833641,"body":"@SedJ601, not really sure what that is but I will look into it, thank you! also my question got closed, don&#39;t know why. I thought the problem is clear enough"},{"owner":{"user_id":2423906,"display_name":"SedJ601"},"edited":false,"comment_id":132852472,"body":"@asad, ` I thought the problem is clear enough` - Based on what? Your own viewpoint or the viewpoint of the people who are trying to help you. Create a watered-down full app that demos your current issue. Explain what is happening and what you are trying to achieve."},{"owner":{"user_id":6395627,"display_name":"Slaw"},"edited":false,"comment_id":132855039,"body":"Note, in many cases, if you have a bunch of actions that occur asynchronously yet must execute sequentially, then using a loop is (nearly?) always wrong in the context of a GUI application. This is where <a href=\"https://en.wikipedia.org/wiki/Event-driven_programming\" rel=\"nofollow noreferrer\">event-driven programming</a> comes into play. GUI applications are the quintessential example of <i>event-driven</i>. You don&#39;t &quot;wait&quot; for an action to complete, you &quot;react&quot; to an action completing. As noted, you could register some kind of callback that the JavaScript code calls when complete so that the Java code knows to start the next action"},{"owner":{"user_id":6395627,"display_name":"Slaw"},"edited":false,"comment_id":132855052,"body":"This doesn&#39;t involve communication between Java and JavaScript, but <a href=\"https://stackoverflow.com/a/61297536/6395627\">here&#39;s an example</a> of playing the next media after the current one completes without using a loop."},{"owner":{"user_id":19415089,"display_name":"asad"},"edited":false,"comment_id":133077629,"body":"Thank you guys for your suggestions! Finally figured it out and turns out event-Driven programming was the way to go."}],"owner":{"user_id":19415089,"display_name":"asad"},"view_count":81,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1674950532,"question_id":75271757,"body":"<p>So I been stuck on this problem for a while now and have not been able to come up with a solution that works without bugs. Basically I have this code:</p>\n<pre><code>public void startExp() {\n    root.setCenter(webView);\n\n    //length depends on the exp selected\n    for (String expMode : expModes) {\n        int r = -1;\n        for (int j = 0; j &lt; 2; j++) { // This is the # of the times I would like the same experiment/html page load)\n            int temp = r;\n            while (r == temp)\n                r = ThreadLocalRandom.current().nextInt(0, 2);\n\n            String mode = expMode + &quot;.html&quot;;\n            System.out.println(mode);\n            url = this.getClass().getResource(mode);\n\n            webEngine.getLoadWorker().stateProperty().addListener(\n                    (ov, oldState, newState) -&gt; {\n                        if (newState == Worker.State.SUCCEEDED) {\n                            System.out.println(&quot;here&quot;);\n                            webEngine.executeScript(&quot;timer('passage');&quot;);\n                            // webEngine.executeScript(&quot;move('&quot; + textBold + &quot;');&quot;);\n                            // window.setMember(&quot;invoke&quot;, new change());\n                        }\n                    }\n            );\n\n            webEngine.load(url.toString());\n\n            // Want this loop to pause here until the JS function finishes executing in webview\n        }\n    }\n}\n</code></pre>\n<p>I want the for loop to somehow &quot;pause&quot; until the javascript function finishes executing and then continue again. The reason I need a for loop and webview for this, is because I need to repeat a given set of experiments (that continuously updates the GUI) that could only (it was also easier) be coded through embedding html pages.</p>\n<p>For reference, this is one of the html pages where the JS function takes a string variable from the java function 'startExp()':</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;!DOCTYPE html&gt;\n\n&lt;html lang=\"en\"&gt;\n    &lt;head&gt;\n        &lt;title&gt;Hello World&lt;/title&gt;\n        &lt;link rel=\"stylesheet\" href=\"./style.css\"&gt;\n    &lt;/head&gt;\n\n    &lt;body&gt;\n        &lt;p id=\"demo\"&gt;&lt;/p&gt;\n        &lt;script type=\"application/javascript\"&gt;\n            let i = 0;\n\n            function timer(a) {\n                const splitted = a.split(\" \");\n                const timerID = setInterval(function() {highlight()} , 500);\n\n                function highlight() {\n                    if (i == splitted.length) {\n                        clearInterval(timerID);\n                        invoke.change();\n                    }\n\n                    let markS = \"&lt;mark&gt;\";\n                    let markE = \"&lt;/mark&gt;\";\n                    let temp =  splitted[i];\n\n                    splitted[i] = markS + splitted[i] + markE;\n\n                    let passage = splitted.join(\" \");\n                    document.getElementById(\"demo\").innerHTML = passage;\n                    splitted[i] = temp;\n\n                    i = i + 1;\n                }\n            }\n        &lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n<p>Also for reference, the variables:</p>\n<pre><code>BorderPane root;\nstatic WebView webView ;\nstatic WebEngine webEngine;\nstatic String[] expModes = {&quot;porbTest&quot;, &quot;highlightWordsTest&quot;};\nString passage = &quot;this is passage 1 and we are seeing if this works. Right now it doesn't but one day it will.&quot;;\n</code></pre>\n<p>I tried taking the multithreading approach and using Thread.join() but found out that the webview can only be updated in the Javafx application thread.</p>\n<p>Thread.sleep() also doesn't work for me since it sleeps the GUI too (but I need the gui to be updated).</p>\n<p>Platform.runlater() defeats the purpose of the for loop since the application goes through the whole for loop and then only runs the last 'mode', this also only works 1% of the time.</p>\n<p>I would appreciate if I could get some insight into how I can make this possible .</p>\n<p>Thank you</p>\n"},{"tags":["java","multithreading","httpclient","executorservice"],"owner":{"user_id":362531,"display_name":"adamw"},"view_count":82,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1674739518,"question_id":75246754,"body":"<p>I'm trying to send an HTTP request using the <code>HttpClient</code> bundled with Java (tested using JDK17), but using a custom thread pool / executor. Such an executor can be specified when building the client, as in the code below:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package test;\n\nimport java.io.IOException;\nimport java.net.URI;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.Executors;\n\npublic class Test {\n    public static void main(String[] args) throws IOException, InterruptedException, ExecutionException {\n        var executor = Executors.newCachedThreadPool();\n        var client = HttpClient.newBuilder().executor(executor).build();\n\n        client.sendAsync(\n                HttpRequest\n                        .newBuilder()\n                        .uri(URI.create(&quot;https://www.google.com&quot;))\n                        .build(),\n                HttpResponse.BodyHandlers.ofInputStream()\n        ).get();\n\n        System.out.println(&quot;Done&quot;);\n        System.in.read();\n    }\n}\n</code></pre>\n<p>However, some additional threads are always started. One is a <code>SelectorManager</code>, which is hard-coded to be started <a href=\"https://github.com/openjdk/jdk/blob/master/src/java.net.http/share/classes/jdk/internal/net/http/HttpClientImpl.java#L507-L531\" rel=\"nofollow noreferrer\">here</a>. It has a clear scope and probably needs to be a separate thread.</p>\n<p>Additionally, when using <code>.sendAsync</code>, the default fork-join pool is also <em>always</em> started. I think this is due to the <a href=\"https://github.com/openjdk/jdk/blob/master/src/java.net.http/share/classes/jdk/internal/net/http/HttpClientImpl.java#L990-L995\" rel=\"nofollow noreferrer\">following code in <code>HttpClient</code></a>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>// makes sure that any dependent actions happen in the CF default\n// executor. This is only needed for sendAsync(...), when\n// exchangeExecutor is non-null.\nif (exchangeExecutor != null) {\n    res = res.whenCompleteAsync((r, t) -&gt; { /* do nothing */}, ASYNC_POOL);\n}\n</code></pre>\n<p>I suspect this is needed to always shift any further processing of the response (which might block) to another thread pool (to avoid blocking the thread that processes incoming HTTP data). However:</p>\n<ol>\n<li>shouldn't this shifting happen onto the provided executor, instead of shifting to <code>ASYNC_POOL</code> always?</li>\n<li>is my justification for the existence of the above <code>HttpClient</code> snippet correct?</li>\n<li>maybe there are other reasons why the ForkJoin pool must be started?</li>\n</ol>\n"},{"tags":["java","jenkins","groovy","jenkins-pipeline","jenkins-plugins"],"answers":[{"owner":{"user_id":2627018,"display_name":"ycr"},"up_vote_count":0,"is_accepted":false,"creation_date":1674521983,"answer_id":75216540,"body":"<p>Try moving the groovy logic to an external function.</p>\n<pre><code>def getRoles() {\n   def authStrategy = Jenkins.instance.getAuthorizationStrategy()\n   permissions = authStrategy.roleMaps.inject([:]){map, it -&gt; map + it.value.grantedRoles}\n\n   return permissions.findAll{ it.value.contains(RUNNER_USER) }.collect{it.key.name}\n\n}\n</code></pre>\n<p>In pipeline</p>\n<pre><code>if(&quot;admin&quot; in getRoles()) {\n    timeout(time: TIMEOUT, unit: 'SECONDS') {\n      input(message: &quot;Do you want to overwrite the lock?&quot;, ok: &quot;Yes&quot;)\n}\n</code></pre>\n<p>Complete Pipeline</p>\n<pre><code>pipeline {\n    agent any\n    stages {\n        stage(&quot;Run Tests&quot;) {\n            steps {\n                script {\n                    def RUNNER_USER = 'admin'\n                    def TIMEOUT = 30\n                    \n                      if(&quot;admin&quot; in getRoles(RUNNER_USER)) {\n                        timeout(time: TIMEOUT, unit: 'SECONDS') {\n                          input(message: &quot;Do you want to overwrite the lock?&quot;, ok: &quot;Yes&quot;)\n                        }\n                      }\n                      println &quot;job finished&quot;\n                        \n                }\n                \n            }\n        }\n    }\n}\n\ndef getRoles(RUNNER_USER){\n    def authStrategy = Jenkins.instance.getAuthorizationStrategy()\n    def permissions = authStrategy.roleMaps.inject([:]){map, it2 -&gt; map + it2.value.grantedRoles}\n    def Roles = permissions.findAll{ it.value.contains(RUNNER_USER) }.collect{it.key.name}\n    return Roles\n    \n}\n</code></pre>\n"}],"owner":{"user_id":21065139,"display_name":"Amir Taghia"},"view_count":101,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1674494711,"question_id":75212973,"body":"<p>I have used RoleBaseStrategy plugin.\nI have this block code in my Jenkinsfile :</p>\n<pre><code>def authStrategy = Jenkins.instance.getAuthorizationStrategy()\npermissions = authStrategy.roleMaps.inject([:]){map, it -&gt; map + it.value.grantedRoles}\nRoles = permissions.findAll{ it.value.contains(RUNNER_USER) }.collect{it.key.name}\n\n  if(&quot;admin&quot; in Roles) {\n    timeout(time: TIMEOUT, unit: 'SECONDS') {\n      input(message: &quot;Do you want to overwrite the lock?&quot;, ok: &quot;Yes&quot;)\n    }\n  println &quot;job finished&quot;\n\n</code></pre>\n<p>at the end I got my Role list but for <a href=\"/questions/tagged/authstrategy\" class=\"post-tag\" title=\"show questions tagged &#39;authstrategy&#39;\" aria-label=\"show questions tagged &#39;authstrategy&#39;\" rel=\"tag\" aria-labelledby=\"authstrategy-container\">authstrategy</a> Function I got this error and</p>\n<blockquote>\n<p>Caused: java.io.NotSerializableException: com.michelin.cio.hudson.plugins.rolestrategy.RoleBasedAuthorizationStrategy</p>\n</blockquote>\n<p>and it doesn't let my pipeline work properly.\nwhat am I doing wrong?</p>\n"},{"tags":["java","amazon-web-services","eclipse"],"comments":[{"owner":{"user_id":2670892,"display_name":"greg-449"},"edited":false,"comment_id":132691536,"body":"The <code>PojoObservables</code> class the plug-in is looking for is no longer part of Eclipse, the plug-in needs to be updated."},{"owner":{"user_id":6206806,"display_name":"Lpuche"},"edited":false,"comment_id":132692674,"body":"@greg-449 That is very, probably it then. Many thanks, I&#39;m surprised I&#39;ve seem absolutely nothing about this."},{"owner":{"user_id":542205,"display_name":"Heiner"},"edited":false,"comment_id":133035510,"body":"The class is obsolete since 2014 and in the list of removed APIs: <a href=\"https://help.eclipse.org/latest/index.jsp?topic=%2Forg.eclipse.platform.doc.isv%2Fporting%2Fremovals.html\" rel=\"nofollow noreferrer\">help.eclipse.org/latest/&hellip;</a>"}],"owner":{"user_id":6206806,"display_name":"Lpuche"},"view_count":208,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1674319255,"question_id":75194929,"body":"<p>So I have always used Eclipse for development and I just got myself a more capable computer. While resetting all my environments and installing the AWS Eclipse Plugin. However, in the current plugin, there are no 'Global Configuration' option. Am I missing something? Was there some type of update? I have tried to re-install the AWS toolkit multiple times and I am somewhat lost now.</p>\n<p>Running Windows 11 (Eclipse Version: 2022-12 (4.26.0)), if that is worth noting. This below is what it currently looks like.</p>\n<p><a href=\"https://i.stack.imgur.com/Cc7ii.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Cc7ii.png\" alt=\"Image\" /></a></p>\n<p>This error in the Eclipse error log may be relevant.</p>\n<pre><code>    java.lang.NoClassDefFoundError: org/eclipse/core/databinding/beans/PojoObservables\n    at com.amazonaws.eclipse.core.ui.setupwizard.ConfigureAccountWizardPage.createControl(ConfigureAccountWizardPage.java:113)\n    at org.eclipse.jface.wizard.Wizard.createPageControls(Wizard.java:178)\n    at org.eclipse.jface.wizard.WizardDialog.createPageControls(WizardDialog.java:744)\n    at org.eclipse.jface.wizard.WizardDialog.createContents(WizardDialog.java:636)\n    at org.eclipse.jface.window.Window.create(Window.java:431)\n    at org.eclipse.jface.dialogs.Dialog.create(Dialog.java:1094)\n    at org.eclipse.jface.window.Window.open(Window.java:788)\n    at com.amazonaws.eclipse.core.ui.setupwizard.InitialSetupUtils$1.run(InitialSetupUtils.java:54)\n    at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:40)\n    at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:132)\n    at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:4029)\n    at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3645)\n    at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$5.run(PartRenderingEngine.java:1155)\n    at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:338)\n    at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine.run(PartRenderingEngine.java:1046)\n    at org.eclipse.e4.ui.internal.workbench.E4Workbench.createAndRunUI(E4Workbench.java:155)\n    at org.eclipse.ui.internal.Workbench.lambda$3(Workbench.java:643)\n    at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:338)\n    at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:550)\n    at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:171)\n    at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:152)\n    at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:203)\n    at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:136)\n    at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:104)\n    at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:402)\n    at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:255)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n    at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:659)\n    at org.eclipse.equinox.launcher.Main.basicRun(Main.java:596)\n    at org.eclipse.equinox.launcher.Main.run(Main.java:1467)\nCaused by: java.lang.ClassNotFoundException: org.eclipse.core.databinding.beans.PojoObservables cannot be found by com.amazonaws.eclipse.core_2.3.1.v201807201743\n    at org.eclipse.osgi.internal.loader.BundleLoader.generateException(BundleLoader.java:541)\n    at org.eclipse.osgi.internal.loader.BundleLoader.findClass0(BundleLoader.java:536)\n    at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:416)\n    at org.eclipse.osgi.internal.loader.ModuleClassLoader.loadClass(ModuleClassLoader.java:168)\n    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:520)\n    ... 33 more\n</code></pre>\n<p>Has anyone faced this issue before? Any help that can be provided would be amazingly appreciated!</p>\n"},{"tags":["java","windows","jpackage","java-18"],"comments":[{"owner":{"user_id":4712734,"display_name":"DuncG"},"edited":false,"comment_id":132658178,"body":"Perhaps check JDK bug db. I see same as you - Task manager lists a duplicated exe via JDK20-jpackage, no duplicated exe on JDK14-jpackage for exact same packaged code. Following <code>ProcessHandle.current().parent() ...</code> shows extra value, a parent with same command  &quot;someapp.exe&quot; but which isn&#39;t visible to <code>jps</code> or <code>jstack</code> so isn&#39;t a JVM."},{"owner":{"user_id":20306007,"display_name":"life888888"},"edited":false,"comment_id":132666281,"body":"I use Eclipse Adoptium JDK 17 + JPackage to package it into a .msi file. After the installation is complete, a startup shortcut will be generated on the desktop. No matter whether you click the startup shortcut or directly click the app exe, there will not be multiple exe executions. My program UI is using Eclipse SWT, not SWING package."},{"owner":{"user_id":21043917,"display_name":"aauclair"},"edited":false,"comment_id":132672672,"body":"I&#39;ve been unable to find anything on the JDK bug db for this issue. Tried to look for quite a while before writing this question. I just removed Swing entirely and just added a large sleep. The app still creates multiple exe&#39;s. Unfortunately I can&#39;t use jpackage to build an installer. We use app-image to generate executables that we then add to our own installer because we have multiple Java Swing UIs together in a single installer (plus tons of C++ apps)."},{"owner":{"user_id":4712734,"display_name":"DuncG"},"edited":false,"comment_id":132678080,"body":"Yes it&#39;s not related to Swing: I made my check using my own app deployment, not your example above."}],"owner":{"user_id":21043917,"display_name":"aauclair"},"view_count":93,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1674137347,"question_id":75173536,"body":"<p>The following small Java program and <code>jpackage</code> command create an app-image which when launched on Windows 10 launches multiple exe's. This does not happen before JDK 17. The same code and command using the JDK 16 jpackage results in only a single instance of Main.exe running in the Task Manager Details tab. Issue appears to still happen in JDK 18 and 19.</p>\n<pre class=\"lang-java prettyprint-override\"><code>import javax.swing.*;\n\npublic class Main {\n    public static void main(String[] args) {\n        JDialog dialog = new JDialog();\n\n        dialog.setVisible(true);\n    }\n}\n\n</code></pre>\n<p><code>jpackage --type app-image --input jpackage_test_jar --dest install/tmp --main-jar jpackage_test.jar --main-class Main</code></p>\n<p><a href=\"https://i.stack.imgur.com/BWf0a.png\" rel=\"nofollow noreferrer\">Result (Main.exe twice in Task Manager Details)</a></p>\n<p>Tested the same code and jpackage command on JDKs 15, 16, 17, 18 and 19. Multiple exe's are launched on Windows 10 in JDKs 17, 18 and 19, but not in 15 or 16. JDK 15 was from AdoptOpenJDK, the rest were Eclipse Temurin from Eclipse Adoptium.</p>\n"},{"tags":["java","multithreading","completable-future","threadpoolexecutor"],"owner":{"user_id":6635386,"display_name":"LisekKL"},"view_count":47,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1674068691,"question_id":75164104,"body":"<p>I'm trying to gather specific data on how long a task waits between being submitted and actually being executed. The idea is to be able to closely monitor the existing threadpool and tasks that are submitted for execution.</p>\n<p>Let's assume I have an <code>ExecutorService</code> with a <code>fixedThreadPool</code>.</p>\n<p>I'm also using a composition of completableFutures to perform a set of tasks asynchronously.\nI'd like to be able to track within my logs the exact time a certain task had to wait in the queue before being taken for execution.\nThe way I see it I need two things:</p>\n<ol>\n<li>A way to label <code>CompletableFuture</code> (or the <code>Supplier</code> functions passed to <code>CompletableFuture.supplyAsync()</code>)<br>\nThis I could potentially do by providing a wrapper method for the Supplier as mentioned here <a href=\"https://stackoverflow.com/a/57888886\">https://stackoverflow.com/a/57888886</a> and overwrite the <code>CompletableFuture.supplyAsync()</code> method so it will internally log which named supplier was provided</li>\n<li>A way to monitor the time between the submission and execution of a specific Runnable to the threadpool executor.<br>\nThis I can achieve by extending the <code>ThreadPoolExecutor</code>and providing some custom logging in the <code>beforeExecute()</code> and <code>execute()</code> method</li>\n</ol>\n<p>What I'm kind of 'stuck' on now is linking both of them together. The <code>beforeExecute()</code> method override gives me the thread and the runnable - but the thread in itself doesn't tell me much yet, and the runnable isn't named in any way so I can't really know which exact task is taken for execution. Of course I can add additional logs in the task implementations themselves and then assume that they will be right next to the log from <code>beforeExecute()</code>. The problem still remains for <code>execute()</code> itself, since that one is called internally after using the <code>CompletableFuture</code> composition.</p>\n<p>So how can I properly link the information from the executor service, with some labelling of the exact tasks provided as CompletableFutures as in the example below?</p>\n<pre><code>List&lt;Foo&gt; results = createResults();\nresults.forEach(r -&gt; CompletableFuture.completedFuture(r)\n  .thenCompose(result -&gt; addSomething(result, something)\n  .thenCombine(addSomethingElse(result, somethingElse), (r1, r2) -&gt; result)\n  .thenCompose(r -&gt; doSomething(result).thenCompose(this::setSomething))\n  .thenApply(v -&gt; result))));\n\n...\n\n// At some point join() is called to actually wait for execution and completion\nlistOfFutures.join()\n\n</code></pre>\n<p>And each of the functions called within return a <code>CompletableFuture&lt;Foo&gt;</code> created by:</p>\n<pre><code>    private CompletableFuture&lt;Foo&gt; setSomething(Foo foo) {\n        return CompletableFuture.supplyAsync(() -&gt; {\n            foo.description = &quot;Setting something&quot;;\n            return foo;\n        }, myExecutorService);\n    }\n</code></pre>\n<p>So even by wrapping the <code>Supplier&lt;T&gt;</code> to have it labeled, how am I able to link this with the tracking within the <code>execute()</code> and <code>beforeExecute()</code> method of the <code>ThreadPoolExecutor</code> when that one operates on Runnables instead of Suppliers?</p>\n"},{"tags":["java","spring","spring-boot","security","spring-security"],"comments":[{"owner":{"user_id":7970787,"display_name":"Alex R"},"edited":false,"comment_id":132638057,"body":"Have you read the <a href=\"https://docs.spring.io/spring-security/reference/5.8/migration/servlet/authorization.html\" rel=\"nofollow noreferrer\">migration guide</a>?"},{"owner":{"user_id":1613869,"display_name":"Schokea"},"edited":false,"comment_id":132640728,"body":"@AlexR yes that’s what I followed hence why I’m a bit stumped as to why it’s not working :("},{"owner":{"user_id":7970787,"display_name":"Alex R"},"edited":false,"comment_id":132647546,"body":"Reading the logs it seems to me that the <code>Authenticated</code> status of your <code>PreAuthenticatedAuthenticationToken</code> is never set to true. Maybe you have to call <code>http. authenticationManager(...)</code> and set the <code>AuthenticationManager</code> you want to use this way?"},{"owner":{"user_id":1613869,"display_name":"Schokea"},"edited":false,"comment_id":132653525,"body":"@AlexR tried that still same result"},{"owner":{"user_id":5454842,"display_name":"Marcus Hert da Coregio"},"edited":false,"comment_id":132654491,"body":"What is the logic inside the <code>preAuthProvider</code> class? Can you share its whole implementation?"},{"owner":{"user_id":1613869,"display_name":"Schokea"},"edited":false,"comment_id":132656776,"body":"@MarcusHertdaCoregio Added now. They code never gets this far but I expect it to after the Auth0TokenConverter.convert method is ran which returns PreAuthenticatedAuthenticationToken. The code gets as far as this method."},{"owner":{"user_id":13956589,"display_name":"HamsterofDeath"},"edited":false,"comment_id":133403779,"body":"same problem here, it just stopped working and i don&#39;t even use any authentication"}],"owner":{"user_id":1613869,"display_name":"Schokea"},"view_count":212,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1674045956,"question_id":75159435,"body":"<p>I'm currently upgrading from Spring Boot 2.7 to Spring 3 but I'm having issues when upgrading my HTTP Security Config.</p>\n<p>I am using Azure B2C for my oauth server and that part is working fine as I can see the valid JWT being returned.\nI've changed from using authorizeRequests to authorizeHttpRequests as suggested but all my HTTP requests are returning 403.</p>\n<p>If I use authorizeRequests with all of the other Spring 3 suggested updates it still works as expected.</p>\n<p><strong>Configuration File:</strong></p>\n<pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n\n  @Autowired\n  private AuthenticationProvider authenticationProvider;\n\n  @Autowired\n  @Qualifier(&quot;preAuthProvider&quot;)\n  private AuthenticationProvider preAuthProvider;\n\n  @Value(&quot;${oauthTokenChecks.audience}&quot;)\n  private String audience;\n\n  @Value(&quot;${oauthTokenChecks.issuer}&quot;)\n  private String issuer;\n  @Value(&quot;${spring.security.oauth2.resourceserver.jwt.jwk-set-uri}&quot;)\n  private String jwkUri;\n\n  @Bean\n  CorsConfigurationSource corsConfigurationSource() {\n    CorsConfiguration configuration = new CorsConfiguration();\n    configuration.setAllowedOrigins(Arrays.asList(&quot;*&quot;));\n    configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;, &quot;POST&quot;));\n    configuration.setAllowedHeaders(Collections.singletonList(&quot;*&quot;));\n    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n    source.registerCorsConfiguration(&quot;/**&quot;, configuration);\n    return source;\n  }\n\n  @Bean\n  public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n    http.cors().\n        configurationSource(corsConfigurationSource()).and()\n        .sessionManagement()\n        .sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n        .and()\n        .authorizeRequests((authorize) -&gt; authorize\n            .requestMatchers(&quot;/api/**&quot;)\n            .authenticated()\n        )\n        .exceptionHandling()\n        .authenticationEntryPoint(new HttpStatusEntryPoint(HttpStatus.UNAUTHORIZED))\n        .and()\n        .csrf()\n        .disable()\n        .oauth2ResourceServer()\n        .jwt()\n        .jwtAuthenticationConverter(new Auth0TokenConverter());\n\n    return http.build();\n  }\n\n  @Bean\n  public AuthenticationManager authManager(HttpSecurity http) throws Exception {\n    AuthenticationManagerBuilder authenticationManagerBuilder = http.getSharedObject(AuthenticationManagerBuilder.class);\n    authenticationManagerBuilder.authenticationProvider(authenticationProvider);\n    authenticationManagerBuilder.authenticationProvider(preAuthProvider);\n    return authenticationManagerBuilder.build();\n  }\n\n  @Bean\n  JwtDecoder jwtDecoder() {\n    NimbusJwtDecoder jwtDecoder =\n        NimbusJwtDecoder.withJwkSetUri(jwkUri).build();\n\n    OAuth2TokenValidator&lt;Jwt&gt; audienceValidator = new AudienceValidator(audience);\n    OAuth2TokenValidator&lt;Jwt&gt; withIssuer = JwtValidators.createDefaultWithIssuer(issuer);\n    OAuth2TokenValidator&lt;Jwt&gt; withAudience =\n        new DelegatingOAuth2TokenValidator&lt;&gt;(withIssuer, audienceValidator);\n//    jwtDecoder.setClaimSetConverter(new UsernameSubClaimAdapter());\n    jwtDecoder.setJwtValidator(withAudience);\n\n    return jwtDecoder;\n  }\n}\n</code></pre>\n<p><strong>Auth Converter:</strong></p>\n<pre><code>public class Auth0TokenConverter implements Converter&lt;Jwt, AbstractAuthenticationToken&gt; {\n\n  @Override\n  public AbstractAuthenticationToken convert(final Jwt jwt) {\n\n    var emails = jwt.getClaimAsStringList(&quot;emails&quot;);\n    if (emails == null || emails.size() != 1) {\n      throw new RuntimeException(&quot;One and only one email expected in token claim&quot;);\n    }\n\n    var user =\n        ImplementUser.builder()\n            .username(emails.get(0))\n            .auth0Id(null)\n            .enabled(true)\n            .accountNonExpired(true)\n            .accountNonLocked(true)\n            .credentialsNonExpired(true)\n            .build();\n    return new PreAuthenticatedAuthenticationToken(user, jwt);\n  }\n} \n</code></pre>\n<p><strong>CustomPreAuthProvider:</strong></p>\n<pre><code>@Component(&quot;preAuthProvider&quot;)\npublic class CustomPreAuthProvider extends PreAuthenticatedAuthenticationProvider {\n\n  @Autowired\n  private CustomPreAuthUserDetailsService userService;\n\n  public CustomPreAuthProvider() {\n    super();\n  }\n\n  @PostConstruct\n  public void init() {\n    super.setPreAuthenticatedUserDetailsService(userService);\n  }\n}\n</code></pre>\n<p><strong>CustomPreAuthUserDetailsService:</strong></p>\n<pre><code>@Service\n@RequiredArgsConstructor(onConstructor = @__(@Autowired))\npublic class CustomPreAuthUserDetailsService\n    implements AuthenticationUserDetailsService&lt;PreAuthenticatedAuthenticationToken&gt; {\n\n  private final AuthUserDetailsService authUserDetailsService;\n\n  @Override\n  public final UserDetails loadUserDetails(PreAuthenticatedAuthenticationToken token) {\n    var principal = (ImplementUser) token.getPrincipal();\n    var email = principal.getUsername();\n    var user = authUserDetailsService.loadUserDetails(email);\n\n    var implementUser = (ImplementUser) token.getPrincipal();\n    return implementUser.toBuilder()\n        .firstName(user.getFirstName())\n        .lastName(user.getLastName())\n        .globalUserId(user.getGlobalUserId())\n        .profiles(user.getProfiles())\n        .activeProfile(user.getActiveProfile())\n        .defaultProfileId(user.getDefaultProfileId())\n        .build();\n\n  }\n}\n</code></pre>\n<p>Below are the error logs</p>\n<p><a href=\"https://pastebin.com/VHJXB5iX\" rel=\"nofollow noreferrer\">Log output</a></p>\n"},{"tags":["java","spring","spring-security","spring-rest"],"comments":[{"owner":{"user_id":5277820,"display_name":"dur"},"edited":false,"comment_id":132564844,"body":"You have to permit <code>&#47;error</code> to see the error message instead 401."},{"owner":{"user_id":11339268,"display_name":"30james00"},"edited":false,"comment_id":132565191,"body":"Thanks! That solved my problem. I have not come across this in any JWT guide."}],"owner":{"user_id":11339268,"display_name":"30james00"},"view_count":833,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1673727668,"question_id":75120991,"body":"<p>My application uses Spring Boot 3 with Spring Security and JWT authentication. It is simple REST API. This is my <code>SecurityFilterChain</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Bean\n  protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n      // No need for CSRF in this example\n      http\n          .cors()\n              .and()\n          .csrf().disable()\n          // No authentication\n          .authorizeHttpRequests()\n              .requestMatchers(&quot;/login&quot;, &quot;/register&quot;).permitAll()\n              // Authentication for other requests\n              .anyRequest().authenticated()\n              .and()\n          // Session is stateless\n          .exceptionHandling()\n              .authenticationEntryPoint(jwtAuthenticationEntryPoint)\n              .and()\n          .sessionManagement()\n              .sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n              .and()\n          .addFilterBefore(jwtRequestFilter, UsernamePasswordAuthenticationFilter.class);\n      return http.build();\n  }\n</code></pre>\n<p>And this is my <code>JwtAuthenticationEntryPoint</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Component\npublic class JwtAuthenticationEntryPoint implements AuthenticationEntryPoint {\n    @Override\n    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException {\n        response.sendError(HttpServletResponse.SC_UNAUTHORIZED, &quot;Unauthorized&quot;);\n    }\n}\n</code></pre>\n<p>I prepared exception classes as described in point 3.3 <a href=\"https://www.baeldung.com/exception-handling-for-rest-with-spring\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://www.stackoverflow.com/\">here</a> like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ResponseStatus(value = HttpStatus.NOT_FOUND)\npublic class RecipeNotFoundException extends RuntimeException {\n}\n\n</code></pre>\n<p>I use them like this.</p>\n<pre class=\"lang-java prettyprint-override\"><code>if (recipeFound.isEmpty()) throw new RecipeNotFoundException();\n</code></pre>\n<p>I would like to send appropriate HTTP codes ex. when user tries to edit recipe that does not exist. Unfortunately I always get 401 Unauthorized. It also prevents my app from sending 500 code (I get 401 instead).</p>\n<p>Here is my <code>JwtRequestFilter</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Component\npublic class JwtRequestFilter extends OncePerRequestFilter {\n    private final JwtUserDetailsService jwtUserDetailsService;\n    private final JwtTokenUtil jwtTokenUtil;\n\n    public JwtRequestFilter(JwtUserDetailsService jwtUserDetailsService, JwtTokenUtil jwtTokenUtil) {\n        this.jwtUserDetailsService = jwtUserDetailsService;\n        this.jwtTokenUtil = jwtTokenUtil;\n    }\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException {\n        if (!request.getRequestURI().equals(&quot;/register&quot;) &amp;&amp; !request.getRequestURI().equals(&quot;/login&quot;)) {\n            final String requestTokenHeader = request.getHeader(&quot;Authorization&quot;);\n\n            String username = null;\n            String jwtToken = null;\n\n            // Remove Bearer word from token\n            if (requestTokenHeader != null &amp;&amp; requestTokenHeader.startsWith(&quot;Bearer &quot;)) {\n                jwtToken = requestTokenHeader.substring(7);\n                try {\n                    username = jwtTokenUtil.getUsernameFromToken(jwtToken);\n                } catch (IllegalArgumentException e) {\n                    System.out.println(&quot;Unable to get JWT Token&quot;);\n                } catch (ExpiredJwtException e) {\n                    System.out.println(&quot;JWT Token has expired&quot;);\n                }\n            } else {\n                logger.warn(&quot;JWT Token does not start with Bearer String&quot;);\n            }\n\n            // Validate token\n            if (username != null &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == null) {\n                UserDetails userDetails = this.jwtUserDetailsService.loadUserByUsername(username);\n\n                // Configure authentication in Spring Security\n                if (jwtTokenUtil.validateToken(jwtToken, userDetails)) {\n                    UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken =\n                            new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());\n                    usernamePasswordAuthenticationToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));\n\n                    // Successful Authentication\n                    SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);\n                }\n            }\n        }\n        chain.doFilter(request, response);\n    }\n}\n</code></pre>\n"},{"tags":["java","hibernate","spring-data-rest","hibernate-envers","spring-hateoas"],"owner":{"user_id":10329676,"display_name":"Dignity"},"view_count":36,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1673602952,"question_id":75107371,"body":"<p>Currently i'm worrking on a Java project which uses JPA and under the hood Hibernate as its ORM.\nFurthermore we're using Enverse as our auditing Library.</p>\n<p>Now, when i query an entity which contains a @ManyToMany or @OneToMany relation directly through Hibernate, the embedded collections will get mapped to &quot;Bag-Types&quot; (PersistentBag for Lists and PersistentSet for Sets).\nThese Wrapper implement the &quot;PersistentCollection&quot; Interface, which handles the lazy Loading.\nWhen the parentobject ist accessed, no database query will be executed (seen in the debugger). Only when i access an element of the collection, a database query is submittet.</p>\n<p>But when i query the Revision through an AuditReader, the Collections will be wrapped in a ListProxy or a SetProxy, this leads to an &quot;unexpected&quot; behaviour (since enverse is a core element of hibernate). In this case, when i just access the parent object, every element in the embedded collection is directly queried. This leads to an enormous performance drop.\nThe Response from the Revision Endpoint is wrapped into RepresntationModel (from the Spring Hateos project). This leads to the access of the parent object and the generell collection, to create the &quot;_embedded&quot; Object of the response. With the PersistentBag there is no problem, but with the ListProxy, every Element gets queried from the database, leading to thousands of requests.</p>\n<p>Is there a way to &quot;teach&quot; enverse to use PeristentBag (or PersistentSet) instead of the internal Proxy Collections or is there another workaround to not load the entire Collection?</p>\n<p>Ignoring the embedded Ressources in the Revision boosts the performance, but is no solution since the references are Lost.</p>\n<p>Enverse ignores the &quot;fetch&quot; configurations on Collection-Annotations (every Collection is fetched lazy), so this also does not do the trick.</p>\n<p>Since the revision endpoint is highly generic, using projections is not an option.</p>\n"},{"tags":["java","reactive-programming","project-reactor"],"owner":{"user_id":20996684,"display_name":"shull.xy"},"view_count":43,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1673580346,"question_id":75104571,"body":"<p>In a simple demo program I compared the output of <code>Mono.just().map().subscribe()</code> and <code>Mono.just().flatMap().subscribe()</code>, to my surprise <code>map()</code> is executed after <code>onSubscribe()</code> but <code>flatMap()</code> is before.</p>\n<p>The program:</p>\n<pre class=\"lang-java prettyprint-override\"><code>    public static void main(@Nonnull String[] args) {\n        // 1. Case with map()\n        Mono.just(1).map(number -&gt; {\n            System.out.printf(&quot;[%s] mapping:%d%n&quot;, threadName(), number);\n            return number * 10;\n\n        }).subscribe(buildSubscriber());\n\n        // 2. Case with flatMap()\n        System.out.println();\n        Mono.just(1).flatMap(number -&gt; {\n            System.out.printf(&quot;[%s] flat-mapping:%d%n&quot;, threadName(), number);\n            return Mono.just(number * 10);\n\n        }).subscribe(buildSubscriber());\n    }\n\n    @SuppressWarnings(&quot;ReactiveStreamsSubscriberImplementation&quot;)\n    @Nonnull\n    private static Subscriber&lt;Integer&gt; buildSubscriber() {\n        return new Subscriber&lt;&gt;() {\n            private Subscription subscription;\n\n            @Override\n            public void onSubscribe(Subscription subscription) {\n                System.out.printf(&quot;[%s] onSubscribe%n&quot;, threadName());\n                this.subscription = subscription;\n                subscription.request(1);\n            }\n\n            @Override\n            public void onNext(Integer item) {\n                System.out.printf(&quot;[%s] onNext:%s%n&quot;, threadName(), item);\n                subscription.request(1);\n            }\n\n            @Override\n            public void onError(Throwable throwable) {\n                System.out.printf(&quot;[%s] onError:%s%n&quot;, threadName(), throwable);\n            }\n\n            @Override\n            public void onComplete() {\n                System.out.printf(&quot;[%s] onComplete%n&quot;, threadName());\n            }\n        };\n    }\n\n    @Nonnull\n    private static String threadName() {\n        return Thread.currentThread().getName();\n    }\n</code></pre>\n<p>The output:</p>\n<pre><code>[main] onSubscribe\n[main] mapping:1\n[main] onNext:10\n[main] onComplete\n\n[main] flat-mapping:1\n[main] onSubscribe\n[main] onNext:10\n[main] onComplete\n</code></pre>\n<p>In the output of the first case <code>onSubscribe</code> is before <code>mapping:1</code>. It's conceivable that the subscriber made a request for one event and then the publisher produced one, and then this very event went through the transformation and other operations if any.</p>\n<p>In the output of the second case <code>flat-mapping:1</code> comes first, which means <code>onSubscribe()</code> is not yet called but the event is emitted already. The <a href=\"https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html\" rel=\"nofollow noreferrer\">documentation</a> says that <code>map()</code> is implemented <a href=\"https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html#map-java.util.function.Function-\" rel=\"nofollow noreferrer\">by applying a synchronous function</a>, and <code>flatMap()</code> <a href=\"https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html#flatMap-java.util.function.Function-\" rel=\"nofollow noreferrer\">transforms asynchronously</a>. What we witness here is that everything happens in the <code>main</code>  thread.</p>\n<p>Things seem in contradiction, neither <code>flatMap()</code> is performed asynchronously, nor the publisher emits on subscriber's demand, so what's going on under the hood in reactor？</p>\n"},{"tags":["java","spring-boot","concurrency","spring-data-jpa","spring-data"],"comments":[{"owner":{"user_id":5381672,"display_name":"Sridhar Patnaik"},"edited":false,"comment_id":132536755,"body":"Did you tried using cyclic barrier?"}],"answers":[{"owner":{"user_id":1886904,"display_name":"egeorge"},"up_vote_count":0,"is_accepted":false,"creation_date":1673571492,"answer_id":75103832,"body":"<p>I think you are best off creating a service layer with an async method.</p>\n<pre><code>import org.springframework.data.repository.Repository;\nimport java.util.concurrent.CompletableFuture;\nimport org.springframework.stereotype.Service;\nimport org.springframework.scheduling.annotation.AsyncResult;\n\n@Service\npublic class MyPojoPersister {\n\n  @Async\n  @CompletableFuture&lt;MyPojo&gt; savePojo(Repository repo, MyPojo pojo) {\n    return CompletableFuture.completedFuture(repo.save(pojo));\n  }\n}\n</code></pre>\n<p>Then your controller would look something like this:</p>\n<pre><code>@RestController\npublic class SaveController {\n\n    @Autowired\n    MyElasticRepository myElasticRepository;\n    @Autowired\n    MyMongoRepository myMongoRepository;\n    @Autowired\n    MyAARepository myAARepository;\n    \n    //@Autowired MyBBRepository, MyCCRepository, ... MyYYRepository\n    \n    @Autowired\n    MyZZRepository myZZRepository;\n\n    @Autowired MyPojoPersister myPojoPersister;\n\n    @GetMapping(&quot;/saveSequential&quot;)\n    public String saveSequential(@RequestBody MyPojo myPojo) {\n        var futureList = Stream.of(myElasticRepository, myMongoRepository, myAARepository, myZZRepository)\n          .map(repo -&gt; myPojoPersister.savePojo(repo, myPojo))\n          .collect(Collectors.toList());\n        CompletableFuture.allOf(futureList.toArray(new CompletableFuture[list.size()])).join();\n\n        var someString = futureList.stream()\n          .map(CompletableFuture::get())\n          .map(MyPojo::getId())\n          .collect(Collectors.joining(&quot;,&quot;));      \n  \n        return someString;\n    }\n}\n</code></pre>\n<p>I added some assumptions that you want to return a comma separated list of the ids of the pojos since they would presumably be different for each repo. But do whatever you need to with the values of the futures.</p>\n<p>Don't forget to enable asynchronicity!</p>\n<pre><code>@SpringBootApplication\n@EnableAsync\npublic class MyPojoApplication {\n  public static void main(String[] args) {\n    SpringApplication.run(AsyncMethodApplication.class, args).close();\n  }\n}\n</code></pre>\n"}],"owner":{"user_id":10461625,"display_name":"PatPanda"},"view_count":375,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1673562999,"question_id":75103005,"body":"<p>Small question regarding SpringBoot and SpringData, and how to save a pojo into many databases concurrently, in parallel please.</p>\n<p>I have a very simple SpringBoot application which does nothing but expose a rest endpoint to save a pojo:</p>\n<pre><code>@RestController\npublic class SaveController {\n\n    @Autowired\n    MyElasticRepository myElasticRepository;\n    @Autowired\n    MyMongoRepository myMongoRepository;\n    @Autowired\n    MyAARepository myAARepository;\n    \n    //@Autowired MyBBRepository, MyCCRepository, ... MyYYRepository\n    \n    @Autowired\n    MyZZRepository myZZRepository;\n\n    @GetMapping(&quot;/saveSequential&quot;)\n    public String saveSequential(@RequestBody MyPojo myPojo) {\n        MyPojo myPojoFromElastic = myElasticRepository.save(myPojo);\n        MyPojo myPojoFromMongo = myMongoRepository.save(myPojo);\n        MyPojo myPojoFromAA = myAARepository.save(myPojo);\n        // myBBRepository.save(myPojo) myCCRepository.save(myPojo) ... myYYRepository.save(myPojo)\n        MyPojo myPojoFromZZ = myZZRepository.save(myPojo);\n        return ...;\n    }\n}\n</code></pre>\n<p>However, the pojo needs to be saved in many databases, by many, imagine a good dozens of different databases.</p>\n<p>As of now, as you can see from the code, the pojo is saved in each of the databases sequentially. I timed the application, as well as monitoring the DBs, the inserts come one after another.</p>\n<p>Hypothetically, if one save takes one second, and I have 20 DB, the rest endpoints takes 20ish seconds to complete.</p>\n<p>Since the operation is not dependent of any others, i.e. saving the pojo in Mongo, has no dependency on the data saved in Oracle, etc... I would like to optimize the performance by doing the operation in parallel.</p>\n<p><a href=\"https://i.stack.imgur.com/vKObd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vKObd.png\" alt=\"enter image description here\" /></a></p>\n<p>I.e, if each save takes one second, and I have 20 DBs, to parallel the save, which should still take something like oneish second. (I am exaggerating)</p>\n<p>For the sake of the question, let us imagine the machine doing the save has many cores, is a very good machine, etc.</p>\n<p>What I tried:</p>\n<p>I tried using the <code>@Async</code> annotation on the repository, such as:</p>\n<pre><code>@Async\n@Repository\npublic interface MyElasticRepository extends ElasticsearchRepository&lt;MyPojo, String&gt; {\n\n}\n\n</code></pre>\n<p>But unfortunately, timing the endpoint, it still takes a sequential time.</p>\n<p>May I ask how to achieve this parallel, concurrent save please?\nIf possible, I would like to leverage existing features of Spring Framework, and not having to rewrite boiler plate concurrency code.</p>\n<p>Thank you!</p>\n"},{"tags":["java","postgresql","spring-boot","jpa"],"comments":[{"owner":{"user_id":496099,"display_name":"Chris"},"edited":false,"comment_id":132533582,"body":"52 rows missing is pretty specific. Take a look at what is persisted in the database and the diff from your data and it might help tell you why. First guess is that spread sheets don&#39;t filter out duplicate rows - does it maybe have multiple rows with duplicated CsvStations.id values? For reference, save just takes the current data and merges it into the existing row if the IDs are duplicated - so the first data is overwritten by the last."},{"owner":{"user_id":20894830,"display_name":"Erkan Isuf"},"edited":false,"comment_id":132539042,"body":"@Chris You are correct! Issue was that I set id of the entity with the csv&#39;s ids. Made new column for csv ids and let the entity generate auto ids and now it saves all of them."}],"owner":{"user_id":20894830,"display_name":"Erkan Isuf"},"view_count":715,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1673559248,"question_id":75102529,"body":"<p>I am trying to get some data from CSV file and then save it on start of the application. But when i run saveAll() of the repo it will save only up to 348 rows to the DB while the file has over 400 rows in. I can see in the debbuger that correct amount of data is passed to the saving method.</p>\n<pre><code>@SpringBootApplication\n@EnableJpaRepositories(&quot;com.example.demo&quot;)\npublic class DemoApplication {\n\n    private final StationsServicesImpl stationsServices;\n\n    public DemoApplication(StationsServicesImpl stationsServices) {\n        this.stationsServices = stationsServices;\n    }\n\n    public static void main(String[] args) {\n        SpringApplication.run(DemoApplication.class, args);\n    }\n\n    public List&lt;CsvStations&gt; parseCSVToCSVStationsObject() throws IOException {\n        Reader reader = Files.newBufferedReader(Paths.get(&quot;src/main/resources/stations.csv&quot;));\n        CsvToBean&lt;CsvStations&gt; csvToBean = new CsvToBeanBuilder(reader).withType(CsvStations.class).withIgnoreLeadingWhiteSpace(false).build();\n        List&lt;CsvStations&gt; csvStations = csvToBean.parse();\n        return csvStations;\n    }\n\n    @EventListener(ApplicationReadyEvent.class)\n    public void onStartApp() throws IOException {\n        List&lt;StationsDAO&gt; stations = parseCSVToCSVStationsObject().stream()\n                    .map(s -&gt; new StationsDAO(\n                                Long.parseLong(s.getId()),\n                                s.getName(),\n                                s.getAdress(),\n                                s.getKaupunki(),\n                                s.getKapasiteet(),\n                                s.getOperaattor(),\n                                s.getX(),\n                                s.getY()\n                    )).collect(Collectors.toList());\n\n        stationsServices.addStations(stations);\n    }\n}\n</code></pre>\n<p>the <code>addStations()</code> method inside has just basically .saveAll() of JpaRepository;</p>\n<p>I've tried also to loop and use just the .save() method but still same thing and tried to change this too <code>spring.jpa.properties.hibernate.jdbc.batch_size=100</code>.</p>\n"},{"tags":["java","spring","spring-mvc","thymeleaf"],"answers":[{"owner":{"user_id":19199234,"display_name":"Rayyan Karimi"},"up_vote_count":0,"is_accepted":false,"creation_date":1673411143,"answer_id":75078332,"body":"<p>This is already the best method to populate attributes at each request, compared to the earlier methods defined in the <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/ui/Model.html\" rel=\"nofollow noreferrer\">Spring framework documentations.</a></p>\n"},{"owner":{"user_id":8430554,"display_name":"leachim"},"up_vote_count":0,"is_accepted":true,"creation_date":1673447164,"answer_id":75084573,"body":"<p>I learned that <code>@ControllerAdvice</code> can be used in this case (see <a href=\"https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc\" rel=\"nofollow noreferrer\">https://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc</a>).</p>\n<p>Classes annotated with <code>@ControllerAdvice</code>, can have methods annotated with <code>@ModelAttribute</code> to populate attributes over <em>multiple</em> Controllers (all of them if not specified otherwise).</p>\n<p>In my case:</p>\n<pre><code>@ControllerAdvice\npublic class CommonDataAdvice {\n     @Autowired\n     private HttpServletRequest request;\n\n     @ModelAttribute(&quot;request&quot;)\n     public HttpServletRequest populateRequest(){\n           return request;\n     }\n}\n</code></pre>\n"}],"owner":{"user_id":8430554,"display_name":"leachim"},"view_count":103,"up_vote_count":3,"accepted_answer_id":75084573,"answer_count":2,"score":3,"creation_date":1673366644,"question_id":75072676,"body":"<p>Thymeleaf dropped template expressions like <code>#session</code>, <code>#httpServletRequest</code> etc. in Version 3.1 (<a href=\"https://www.thymeleaf.org/doc/articles/thymeleaf31whatsnew.html\" rel=\"nofollow noreferrer\">https://www.thymeleaf.org/doc/articles/thymeleaf31whatsnew.html</a>).</p>\n<p>We used those a lot in relatively large applications. I wrote an interceptor to populate those attributes at every request since I don't want to add them in every Controller needed (like described in the migration guide).</p>\n<p>Does anybody know a better way of achieving this?</p>\n"},{"tags":["java","java-9"],"comments":[{"owner":{"user_id":11291844,"display_name":"happy songs"},"edited":false,"comment_id":132474318,"body":"From what I know, you can&#39;t exit a stream early and return a value. So the way is to use a classic for loop on a collection (maybe convert your stream to a list). There you can implement the logic mentioned above."},{"owner":{"user_id":1180351,"display_name":"Rob Spoor"},"edited":false,"comment_id":132474807,"body":"A classic loop isn&#39;t necessary, but you will need to collect the stream into a <code>List&lt;Optional&gt;</code>. You can then use its <code>isEmpty()</code> method for the &quot;stream is empty case&quot;, and get a new stream from it otherwise for the remainder of the code."},{"owner":{"user_id":12053423,"display_name":"Urben"},"edited":false,"comment_id":132474881,"body":"@RobSpoor Would I get the closest to my intention to not always get all elements if I used <code>stream.iterator()</code> instead of collecting it? I just would have to make sure to only use the iterator once, in one for loop, right?"},{"owner":{"user_id":637853,"display_name":"Thomas"},"edited":false,"comment_id":132475421,"body":"@happysongs you <i>can</i> exit a stream early using <code>findFirst()</code> or <code>findAny()</code> etc. - this basically exists the stream on the first value encountered."},{"owner":{"user_id":637853,"display_name":"Thomas"},"edited":false,"comment_id":132475458,"body":"&quot;Variables used in Lambda expressions have to be final&quot; - that&#39;s true but the values of those don&#39;t have to be immutable. So you <i>could</i> try to replace <code>boolean empty</code> with <code>AtomicBoolean empty</code> - there might be other considerations that I&#39;m missing atm though."},{"owner":{"user_id":11291844,"display_name":"happy songs"},"edited":false,"comment_id":132475625,"body":"@Thomas , I meant you can&#39;t exit a stream while filtering for present optionals. It could be done with a classic for loop."},{"owner":{"user_id":637853,"display_name":"Thomas"},"edited":false,"comment_id":132475752,"body":"@happysongs I&#39;m not sure I get your meaning but you wouldn&#39;t wait for the filtering of all elements to be done before further processing, i.e. with <code>findFirst()</code> you&#39;d exit stream processing which includes filtering - so if the first element is non-empty there&#39;d be only one filter operation done (assuming the stream is not a parallel one). This is quite similar to how a classic loop would do it (think of the loop body as being like the stream operations until a terminal operation is encountered)."},{"owner":{"user_id":11291844,"display_name":"happy songs"},"edited":false,"comment_id":132477072,"body":"@Thomas, it&#39;s correct what you&#39;re saying. What I understood from the question is that he wants to get the first element which is present. If one is found, it should immediately return it and stop checking <code>isPresent()</code> for other elements in the stream. In case all optionals are empty, it throws an exception. He doesn&#39;t want to filter the entire stream before calling <code>findFirst()</code>."},{"owner":{"user_id":637853,"display_name":"Thomas"},"edited":false,"comment_id":132477286,"body":"@happysongs exactly. Assuming the stream is sequential this should amount to an ordered processing where filtering only happens until the first element has been found. In a parallel stream this should come down to local sequential processing until each batch has a first element and then checking which one was the actual first."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":132518401,"body":"Why do you have a <code>Stream&lt;Optional&lt;MyType&gt;&gt;</code> to begin with? That’s the real problem."}],"owner":{"user_id":12053423,"display_name":"Urben"},"view_count":72,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1673345804,"question_id":75068486,"body":"<p>I have a <code>Stream&lt;Optional&lt;T&gt;&gt;</code>.</p>\n<p>I want to use the <code>findFirst()</code>/<code>findAny()</code> methods to return a value. However I want to throw different exceptions depending on the Stream being empty or not.</p>\n<pre class=\"lang-java prettyprint-override\"><code>Stream&lt;Optional&lt;MyType&gt;&gt; stream = ...;\nreturn stream\n  .flatMap(Optional::stream)\n  .findFirst()\n  .orElseThrow(() -&gt; {\n    // I want to know here if the stream was empty or not but flatMap forgot that\n});\n</code></pre>\n<p>The logic should still be lazily evaluated, once I found a non-empty Optional, the stream should not be further progressed and the value should be returned early.</p>\n<p>I tried to mutate a variable in the upper scope in a map to read from it but variables used in Lambda expressions have to be final.</p>\n<pre class=\"lang-java prettyprint-override\"><code>boolean empty = true;\nStream&lt;Optional&lt;MyType&gt;&gt; stream = ...;\nreturn stream\n  .map(t -&gt; {\n    empty = false; //error, must be final\n    return t;\n  })\n  .flatMap(Optional::stream)\n  .findFirst()\n  .orElseThrow(() -&gt; {\n    if (empty) {\n      throw ...;\n    } else {\n      throw ...;\n    }\n});\n</code></pre>\n<p>I tried to write a plain for loop but this does not work with streams:</p>\n<pre class=\"lang-java prettyprint-override\"><code>boolean empty = true;\nStream&lt;Optional&lt;MyType&gt;&gt; stream = ...;\nfor (Optional&lt;MyType&gt; o: stream) { //error, can't for loop on type Stream&lt;...&gt;\n  if (o.isEmpty()) {\n    empty = false;\n  } else {\n    return o.get();\n  }\n}\nif (empty) {\n  throw ...;\n} else {\n  throw ...;\n}\n</code></pre>\n<p>What can I do here?</p>\n"},{"tags":["java","spring-boot","unit-testing","lombok","builder"],"comments":[{"owner":{"user_id":10026074,"display_name":"Jan Rieke"},"edited":false,"comment_id":132473427,"body":"Just use <code>@SuperBuilder</code>. Everything else is a big hassle. &quot;Experimental&quot; just means here: if you find a bug, its fix may have a lower priority than fixes for non-experimental features. But as <code>@SuperBuilder</code> has been around for a few years, you probably won&#39;t find any. ;)"},{"owner":{"user_id":20972057,"display_name":"Harshad k"},"edited":false,"comment_id":132709671,"body":"agree but for the project, I am working they don&#39;t allow Experimental features."}],"answers":[{"owner":{"user_id":1651107,"display_name":"Piro"},"up_vote_count":0,"is_accepted":false,"creation_date":1675685934,"answer_id":75361234,"body":"<p>Since using @SuperBuilder is not an option for you, there is not much to do. One option is to create BaseCustomer &quot;copy&quot; constructor and create Customer by passing BaseCustomer to copy . Like this:</p>\n<pre><code>@NoArgsConstructor\n@AllArgsConstructor\n@Getter\n@Builder(builderMethodName = &quot;BaseBuilder&quot;)\npublic class BaseCustomer {\n    \n    \n    protected String customerId;\n    protected String age;\n    @Default\n    protected Boolean isActive = true;\n    @Default\n    protected String type = &quot;XYZ&quot;;\n    \n    public BaseCustomer(BaseCustomer base) {\n        this.customerId = base.customerId;\n        this.age = base.getAge();\n        this.isActive = base.isActive;\n        this.type = base.type;\n    }\n}\n\n@Data\npublic class Customer extends BaseCustomer {\n    String name;\n    \n    @Builder\n    private Customer(BaseCustomer base, String name) {\n        super(base);\n        this.name = name;\n    }\n}\n</code></pre>\n<p>So as can be seen above, I marked Customer constructor with BaseCustomer parameter as @Builder. I added new parameter to Customer to see how it will work with additional fields. Now we can create Customer by building BaseCustomer first and then pass it with additional fields. For example:</p>\n<pre><code>Customer c2 = Customer.builder().base(BaseCustomer.BaseBuilder().customerId(&quot;1&quot;).age(&quot;23&quot;).build()).name(&quot;Name&quot;).build();\nSystem.out.println(c2.getAge());\nSystem.out.println(c2.getCustomerId());\nSystem.out.println(c2.getType());\nSystem.out.println(c2.getIsActive());\nSystem.out.println(c2.getName());\n</code></pre>\n<p>This will print:</p>\n<pre><code>23\n1\nXYZ\ntrue\nName\n</code></pre>\n<p>This has some advantages - you only pass single parameter (for base class) to Customer constructor and Customer constructor does not have to be changed for BaseCustomer field changes.</p>\n"}],"owner":{"user_id":20972057,"display_name":"Harshad k"},"view_count":271,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1673338813,"question_id":75067210,"body":"<p>I am having two classes:\n1]BaseCustomer.java</p>\n<pre><code>@NoArgsConstructor\n@AllArgsConstructor\n@Getter\n@Builder(builderMethodName=&quot;BaseBuilder&quot;)\npublic class BaseCusmtomer {\n       private String cutomerId;\n       private String age;\n        @Default\n       private Boolean isActive= true;\n        @Default\n       private String type = &quot;XYZ&quot;;  \n    }\n</code></pre>\n<p>2] Customer.java</p>\n<pre><code>\n@Builder\npublic class Customer extends BaseCustomer{\n      private Customer(String cutomerId, String age, Boolean isActive, String type){\n        super(customerId,age,isActive,type);\n           }  \n        }\n</code></pre>\n<p>3]Test Object</p>\n<pre><code>\n     Customer.builder().cutomerId(&quot;1&quot;).age(&quot;23&quot;).build();\n\n\n</code></pre>\n<p>ut while creating object using Customer builder it always take values of isActive and type as null, it should take default values from superclass. Is there anyway to do this?</p>\n<p>Tried to call Child builder with default parent class values\nbut getting null values instead of default value.</p>\n<p>Note: can't use Superbuilder as it is experimental feature.</p>\n"},{"tags":["java","spring-boot","inheritance","design-patterns","factory-pattern"],"comments":[{"owner":{"user_id":481528,"display_name":"selalerer"},"edited":false,"comment_id":133055262,"body":"You&#39;re presenting a problem in Spring but other than <code>@Autowired</code> there is nothing springy about the code. Either that is exactly the problem (this is not a spring application) or you left out the relevant parts"}],"answers":[{"owner":{"user_id":1651107,"display_name":"Piro"},"up_vote_count":0,"is_accepted":false,"creation_date":1676013454,"answer_id":75407990,"body":"<p>In your example env is null because you need to initialize spring boot first. For example this works:</p>\n<pre><code>import org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.core.env.Environment;\n\nimport jakarta.annotation.PostConstruct;\n\npublic class NotificationService {\n    @Autowired\n    Environment env;\n\n    public static void main(String[] args) {\n        SpringApplication.run(NotificationService.class, args);\n    }\n    \n    @PostConstruct\n    public void testNotifications() {\n        System.out.println(env);\n        NotificationFactory notificationFactory = new NotificationFactory();\n        Notification notification = notificationFactory.createNotification(&quot;SMS&quot;);\n        notification.notifyUser();\n    }\n}\n</code></pre>\n<p>Now env is not null before creating NotificationFactory.</p>\n<blockquote>\n<p>ApplicationEnvironment {activeProfiles=[],\ndefaultProfiles=[default],...</p>\n<p>Sending an SMS notification</p>\n</blockquote>\n<p>So now you can pass env to NotificationFactory/Notification.</p>\n<p>If you do not want to pass env to notifyUser method you could also do autowiring manually. Here I pass DefaultListableBeanFactory that does the job on each created Notification:</p>\n<pre><code>import org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.support.DefaultListableBeanFactory;\nimport org.springframework.boot.SpringApplication;\n\nimport jakarta.annotation.PostConstruct;\n\npublic class NotificationService {\n    \n    @Autowired\n    private DefaultListableBeanFactory beanFactory;\n\n    public static void main(String[] args) {\n        SpringApplication.run(NotificationService.class, args);\n    }\n    \n    @PostConstruct\n    public void testNotifications() {\n        NotificationFactory notificationFactory = new NotificationFactory(beanFactory);\n        Notification notification = notificationFactory.createNotification(&quot;SMS&quot;);\n        notification.notifyUser();\n    }\n}\n\npublic class NotificationFactory {\n    private final DefaultListableBeanFactory beanFactory;\n    \n    public NotificationFactory(DefaultListableBeanFactory beanFactory) {\n        this.beanFactory = beanFactory;\n    }\n    public Notification createNotification(String channel){\n        if (channel == null || channel.isEmpty()) {\n            return null;\n        }\n        final Notification notification;\n        switch (channel) {\n        case &quot;SMS&quot;:\n            notification = new SMSNotification();\n            break;\n        case &quot;EMAIL&quot;:\n            notification = new EmailNotification();\n            break;\n        case &quot;PUSH&quot;:\n            notification = new PushNotification();\n            break;\n        default:\n            throw new IllegalArgumentException(&quot;Unknown channel &quot;+channel);\n        }\n        beanFactory.autowireBeanProperties(notification, AutowireCapableBeanFactory.AUTOWIRE_BY_NAME, false);\n        return notification;\n    }\n}\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.core.env.Environment;\n\npublic class SMSNotification implements Notification {\n    \n    @Autowired\n    Environment env;\n    \n    @Override\n    public void notifyUser(){\n        System.out.println(&quot;Sending an SMS notification &quot; + env);\n    }\n}\n</code></pre>\n<p>This will print:</p>\n<blockquote>\n<p>Sending an SMS notification ApplicationEnvironment {activeProfiles=[],\ndefaultProfiles=[default],\npropertySources=[ConfigurationPropertySourcesPropertySource...</p>\n</blockquote>\n<p>With this you can just autowire additional fields as needed without changing interface</p>\n"}],"owner":{"user_id":9952551,"display_name":"Soph_dev"},"view_count":110,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1673325137,"question_id":75065501,"body":"<p>I'm not able to inject Environment dependencies in the classes that extend the base interface in a factory pattern. My architect advised me to pass the dependency through method parameters, but now the requirement has changed to add more dependencies. I don't feel comfortable in adding more parameters to the same function anymore. The parameter change in one function has to be updated in base interface along with all the classes implementing it. Please suggest a better way of solving this issue.</p>\n<p>I tried to add more parameters in the function to accommodate new dependencies, but this doesn't look like a scalable and clean approach.</p>\n<p>Taking the example of this NotifierFactory:</p>\n<pre><code>\npublic interface Notification {\n    void notifyUser();\n}\n\npublic class SMSNotification implements Notification {\n \n    @Override\n    public void notifyUser()\n    {\n        // TODO Auto-generated method stub\n        System.out.println(&quot;Sending an SMS notification&quot;);\n    }\n}\n\npublic class EmailNotification implements Notification {\n \n    @Override\n    public void notifyUser()\n    {\n        // TODO Auto-generated method stub\n        System.out.println(&quot;Sending an e-mail notification&quot;);\n    }\n}\n\npublic class PushNotification implements Notification {\n \n    @Override\n    public void notifyUser()\n    {\n        // TODO Auto-generated method stub\n        System.out.println(&quot;Sending a push notification&quot;);\n    }\n}\n\npublic class NotificationFactory {\n    public Notification createNotification(String channel)\n    {\n        if (channel == null || channel.isEmpty())\n            return null;\n        switch (channel) {\n        case &quot;SMS&quot;:\n            return new SMSNotification();\n        case &quot;EMAIL&quot;:\n            return new EmailNotification();\n        case &quot;PUSH&quot;:\n            return new PushNotification();\n        default:\n            throw new IllegalArgumentException(&quot;Unknown channel &quot;+channel);\n        }\n    }\n}\n\npublic class NotificationService {\n@Autowired\nEnvironment env;\n    public static void main(String[] args)\n    {\n        NotificationFactory notificationFactory = new NotificationFactory();\n        Notification notification = notificationFactory.createNotification(&quot;SMS&quot;);\n        notification.notifyUser();\n    }\n}\n\n</code></pre>\n<p>Now, say I need to use the Environment bean that is autowired in NotificationService inside notifyUser() method of EmailNotification class. If I try to do simple autowiring, the value of env is resolved to null. So the workaround I used was to pass env in notifiyUser() function like, notifyUser(env). The drawback of this approach is that now I need to change the definition of notifyUser() method in all classes implementing Notfication class, even though the env dependency is not used there. And in future, if I need to add more such dependencies, every time the function signature will change.</p>\n"},{"tags":["java","selenium","maven","testng","maven-surefire-plugin"],"comments":[{"owner":{"user_id":53897,"display_name":"Thorbj&#248;rn Ravn Andersen"},"edited":false,"comment_id":132472118,"body":"Does your native language use commas in this location?"}],"answers":[{"owner":{"user_id":8343843,"display_name":"Alexey R."},"up_vote_count":0,"is_accepted":false,"creation_date":1673443527,"answer_id":75083777,"body":"<p>Unfortunately there is no way to fix this other that surefire code change and re-build.</p>\n<p>The string is formed using <a href=\"https://github.com/apache/maven-surefire/blob/61f03c6903ee19afd7d1e5f37c047dc77b3cf49f/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/report/ReporterUtils.java#L40\" rel=\"nofollow noreferrer\">this logic</a>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>static String formatElapsedTime( double runTime )\n{\n    NumberFormat numberFormat = NumberFormat.getInstance( Locale.ENGLISH );\n    numberFormat.setGroupingUsed( true );\n    numberFormat.setMinimumFractionDigits( 0 );\n    numberFormat.setMaximumFractionDigits( 3 );\n    return numberFormat.format( runTime / MS_PER_SEC );\n}\n</code></pre>\n<p>So no environmental settings would change this behavior. You can change <code>true</code> to false and rebuild your surefire classes to get what you need.</p>\n"}],"owner":{"user_id":7707732,"display_name":"Sarayu"},"view_count":46,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1673292244,"question_id":75062048,"body":"<p>I have a long running test suite and once run is completed, maven build logs are available in console. The issue is it is not in proper decimal format. Is there anyway to make it decimal.</p>\n<p>Current log: <code>Tests run: 13, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3,289.634 s - in TestSuite</code></p>\n<p>Due to comma in time elapsed <code>3,289.634 s</code> facing issue. This is effecting in parsing xml <code>cvc-datatype-valid.1.2.1: '3,289.634' is not a valid value for 'decimal'.</code></p>\n<p>Appreciate any help here.</p>\n<p>Thanks!</p>\n<p>Desire to change the time format.</p>\n"},{"tags":["java","spring","spring-security"],"comments":[{"owner":{"user_id":9513184,"display_name":"Unmitigated"},"edited":false,"comment_id":132458894,"body":"Please post all the relevant code (see <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>). Are you trying to autowire <code>AuthenticationManagerBuilder</code> somewhere in your code?"},{"owner":{"user_id":20757012,"display_name":"Cineczeq"},"edited":false,"comment_id":132459034,"body":"I updated post, now there is more info."}],"answers":[{"owner":{"user_id":9513184,"display_name":"Unmitigated"},"up_vote_count":0,"is_accepted":false,"creation_date":1673283439,"answer_id":75060564,"body":"<p>Instead of using <code>AuthenticationManagerBuilder</code>, create a <code>UserDetailsService</code> bean.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Bean\npublic UserDetailsService users() {\n    UserDetails admin = User.withUsername(&quot;admin&quot;)\n        .password(passwordEncoder().encode(&quot;admin&quot;))\n        .roles(&quot;ADMIN&quot;, &quot;EMPLOYEE&quot;).build();\n    UserDetails employee = User.withUsername(&quot;employee&quot;)\n        .password(passwordEncoder().encode(&quot;employee&quot;))\n        .roles(&quot;EMPLOYEE&quot;).build();\n    UserDetails client = User.withUsername(&quot;client&quot;)\n        .password(passwordEncoder().encode(&quot;client&quot;))\n        .roles(&quot;CLIENT&quot;).build();\n    return new InMemoryUserDetailsManager(admin, employee, client);\n}\n</code></pre>\n"}],"owner":{"user_id":20757012,"display_name":"Cineczeq"},"view_count":881,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1673282612,"question_id":75060414,"body":"<p>I am trying to migrate my project to spring security 6. I can't use anymore 'extends WebSecurityConfigurerAdapter'. In that case I don't know how I can rebuild my code to use my own login page.\nThere is old code:</p>\n<pre><code>package main.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.crypto.factory.PasswordEncoderFactories;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.web.util.matcher.AntPathRequestMatcher;\n\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return PasswordEncoderFactories.createDelegatingPasswordEncoder();\n    }\n\n    @Override\n    protected void configure(AuthenticationManagerBuilder auth) throws Exception {\n        auth\n            .inMemoryAuthentication()\n            .withUser(&quot;admin&quot;).password(passwordEncoder().encode(&quot;admin&quot;)).roles(&quot;ADMIN&quot;, &quot;EMPLOYEE&quot;)\n            .and()\n            .withUser(&quot;employee&quot;).password(passwordEncoder().encode(&quot;employee&quot;)).roles(&quot;EMPLOYEE&quot;)\n            .and()\n            .withUser(&quot;client&quot;).password(passwordEncoder().encode(&quot;client&quot;)).roles(&quot;CLIENT&quot;);\n    }\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.authorizeRequests()\n            .antMatchers(&quot;/&quot;, &quot;/login&quot;)\n                .permitAll()\n            .and()\n                .formLogin()\n                .loginPage(&quot;/login&quot;)\n                .loginProcessingUrl(&quot;/checkUserAccount&quot;)\n                .defaultSuccessUrl(&quot;/&quot;)\n                .permitAll()\n            .and()\n                .logout()\n                .logoutRequestMatcher(new AntPathRequestMatcher(&quot;/logout&quot;))\n                .logoutSuccessUrl(&quot;/&quot;)\n                .invalidateHttpSession(true)\n                .permitAll();\n    }\n    \n}\n</code></pre>\n<p>So I saw in documentation that I can replace it with SecurityFilterChain method.\nMy code after a long time looks like:</p>\n<pre><code>package main.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.core.userdetails.User;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.crypto.factory.PasswordEncoderFactories;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.provisioning.InMemoryUserDetailsManager;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.util.matcher.AntPathRequestMatcher;\n\n\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return PasswordEncoderFactories.createDelegatingPasswordEncoder();\n    }\n\n    @Bean\n    public UserDetailsService users() {\n        UserDetails admin = User.withUsername(&quot;admin&quot;)\n            .password(passwordEncoder().encode(&quot;admin&quot;))\n            .roles(&quot;ADMIN&quot;, &quot;EMPLOYEE&quot;).build();\n        UserDetails employee = User.withUsername(&quot;employee&quot;)\n            .password(passwordEncoder().encode(&quot;employee&quot;))\n            .roles(&quot;EMPLOYEE&quot;).build();\n        UserDetails client = User.withUsername(&quot;client&quot;)\n            .password(passwordEncoder().encode(&quot;client&quot;))\n            .roles(&quot;CLIENT&quot;).build();\n        return new InMemoryUserDetailsManager(admin, employee, client);\n    }\n    \n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http.authorizeHttpRequests() \n        .requestMatchers(&quot;/&quot;, &quot;/login&quot;)\n        .permitAll()\n        .and()\n            .formLogin()\n            .loginPage(&quot;/login&quot;)\n            .loginProcessingUrl(&quot;/checkUserAccount&quot;)\n            .defaultSuccessUrl(&quot;/&quot;)\n            .permitAll()\n        .and()\n            .logout()\n            .logoutRequestMatcher(new AntPathRequestMatcher(&quot;/logout&quot;))\n            .logoutSuccessUrl(&quot;/&quot;)\n            .invalidateHttpSession(true)\n            .permitAll();\n        return http.build();\n    }\n\n\n}\n</code></pre>\n<p>but sadly it's thrown:</p>\n<pre><code>&gt; \nSEVERE: Exception sending context initialized event to listener instance of class [org.springframework.web.context.ContextLoaderListener]\norg.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration': Unsatisfied dependency expressed through method 'setFilterChains' parameter 0: Error creating bean with name 'filterChain' defined in main.config.SecurityConfiguration: Failed to instantiate [org.springframework.security.web.SecurityFilterChain]: Factory method 'filterChain' threw exception with message: No bean named 'A Bean named mvcHandlerMappingIntrospector of type org.springframework.web.servlet.handler.HandlerMappingIntrospector is required to use MvcRequestMatcher. Please ensure Spring Security &amp; Spring MVC are configured in a shared ApplicationContext.' available\n    \n</code></pre>\n<p>I'm a newbie, thanks for help.</p>\n<p>Edit:</p>\n<p>There is also SecurityInitializer:</p>\n<pre><code> package main.config;\n\n\nimport org.springframework.security.web.context.AbstractSecurityWebApplicationInitializer;\n\npublic class SecurityInitializer extends AbstractSecurityWebApplicationInitializer {\n\n}\n</code></pre>\n<p>And this is my login.html:</p>\n<pre><code>    &lt;!DOCTYPE html&gt;\n&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;\n      xmlns:th=&quot;http://www.thymeleaf.org&quot;\n      xmlns:sec=&quot;http://www.thymeleaf.org/extras/spring-security&quot;&gt;\n&lt;head&gt;\n&lt;meta charset=&quot;UTF-8&quot;&gt;\n&lt;title&gt;Home page&lt;/title&gt;\n&lt;script src=&quot;https://code.jquery.com/jquery-3.4.1.slim.min.js&quot; integrity=&quot;sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js&quot; integrity=&quot;sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;\n&lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&quot; integrity=&quot;sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh&quot; crossorigin=&quot;anonymous&quot;&gt;\n&lt;script src=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js&quot; integrity=&quot;sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;\n\n&lt;link rel=&quot;stylesheet&quot; href=&quot;http://use.fontawesome.com/releases/v5.3.1/css/all.css&quot;&gt;\n&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;resources/css/login.css&quot;&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div class=&quot;container&quot;&gt;\n        &lt;div class=&quot;d-flex justify-content-center h-100&quot;&gt;\n            &lt;div class=&quot;card&quot;&gt;\n                &lt;div class=&quot;card-header&quot;&gt;\n                    &lt;h2&gt;Sign In&lt;/h2&gt;\n                &lt;/div&gt;\n                &lt;div class=&quot;card-body&quot;&gt;\n                    &lt;form action=&quot;#&quot; th:action=&quot;@{/checkUserAccount}&quot; method=&quot;post&quot;&gt;\n                        &lt;div th:if=&quot;${param.error}&quot; class=&quot;alert alert-login&quot;&gt;\n                            Invalid username and password.\n                        &lt;/div&gt;\n                        \n                        &lt;div class=&quot;input-group form-group&quot;&gt;\n                            &lt;div class=&quot;input-group-prepend&quot;&gt;\n                                &lt;span class=&quot;input-group-text&quot;&gt;&lt;i class=&quot;fas fa-user&quot;&gt;&lt;/i&gt;&lt;/span&gt;\n                            &lt;/div&gt;\n                            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;username&quot; placeholder=&quot;Login&quot;&gt;\n                        &lt;/div&gt;\n                        &lt;div class=&quot;input-group form-group&quot;&gt;\n                            &lt;div class=&quot;input-group-prepend&quot;&gt;\n                                &lt;span class=&quot;input-group-text&quot;&gt;&lt;i class=&quot;fas fa-key&quot;&gt;&lt;/i&gt;&lt;/span&gt;\n                            &lt;/div&gt;\n                            &lt;input type=&quot;password&quot; class=&quot;form-control&quot; name=&quot;password&quot; placeholder=&quot;Password&quot;&gt;\n                        &lt;/div&gt;\n                        &lt;div class=&quot;form-group&quot;&gt;\n                            &lt;input type=&quot;submit&quot; value=&quot;Login&quot; class=&quot;btn login-button&quot;&gt;\n                            &lt;a th:href=&quot;@{/}&quot; class=&quot;btn btn-warning float-right&quot;&gt;Back&lt;/a&gt;\n                        &lt;/div&gt;\n                    &lt;/form&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>Edit2: Without SecurityFilterChain it is working but obviously it's not pointing me to my own login. When i running this now I can see this:</p>\n<blockquote>\n<p>Error creating bean with name\n'org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration':\nUnsatisfied dependency expressed through method 'setFilterChains'\nparameter 0: Error creating bean with name 'filterChain' defined in\nmain.config.SecurityConfiguration: Failed to instantiate\n[org.springframework.security.web.SecurityFilterChain]: Factory method\n'filterChain' threw exception with message: No bean named 'A Bean\nnamed mvcHandlerMappingIntrospector of type\norg.springframework.web.servlet.handler.HandlerMappingIntrospector is\nrequired to use MvcRequestMatcher. Please ensure Spring Security &amp;\nSpring MVC are configured in a shared ApplicationContext.' available</p>\n</blockquote>\n<p>Also I have those dependencies:</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;\n    &lt;version&gt;6.0.1&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;\n    &lt;version&gt;6.0.1&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;\n    &lt;version&gt;6.0.3&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n"},{"tags":["java","azure","apache-kafka","azure-functions","spring-kafka"],"comments":[{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"edited":false,"comment_id":132454807,"body":"You&#39;d seen some pre-initialization function or an external Spring library that downloads the values from Azure. Spring-kafka alone doesn&#39;t do this. Otherwise, Azure functions would maybe pass them through environment variables but you still need to download files."},{"owner":{"user_id":5284909,"display_name":"Nilesh"},"edited":false,"comment_id":132468595,"body":"Hi @OneCricketeer, Thanks for the suggestion but we can not use spring library because spring container will start after the function is triggered. I will check any pre initialization function functionality."},{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"edited":false,"comment_id":132468617,"body":"You have full control over when Kafka containers get started."},{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"edited":false,"comment_id":132468634,"body":"You might want to see <a href=\"https://learn.microsoft.com/en-us/azure/developer/java/spring-framework/configure-spring-boot-starter-java-app-with-azure-key-vault\" rel=\"nofollow noreferrer\">learn.microsoft.com/en-us/azure/developer/java/spring-framew&zwnj;&#8203;ork/&hellip;</a>"},{"owner":{"user_id":5284909,"display_name":"Nilesh"},"edited":false,"comment_id":132469010,"body":"Yeah..but to start kafka itself I need the certificate properties in @Kafkatrigger iannotation..so If connection to kafka is possible then the function will get triggered and the function will invoke spring app."},{"owner":{"user_id":5284909,"display_name":"Nilesh"},"edited":false,"comment_id":132469013,"body":"Once spring app started we have full control to keyvault but it will start only after the successful connection with kafka."},{"owner":{"user_id":5284909,"display_name":"Nilesh"},"edited":false,"comment_id":132469022,"body":"Let us <a href=\"https://chat.stackoverflow.com/rooms/250993/discussion-between-nilesh-and-onecricketeer\">continue this discussion in chat</a>."},{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"edited":false,"comment_id":132481860,"body":"I dont use Azure. I&#39;m just saying you need to connect to the key vault before you even attempt to connect to Kafka (start the trigger as disabled) since you are requiring secrets to be injected into your app. You would then use SPEL expressions with <code>${someSecret}</code> syntax, not <code>%value%</code>"}],"owner":{"user_id":5284909,"display_name":"Nilesh"},"view_count":362,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1673266152,"question_id":75057071,"body":"<p>I am developing kafka trigger based azure functions in JAVA where the function uses below configuration for connection:</p>\n<pre><code>@KafkaTrigger(name = &quot;kafkatrigger&quot;, topic = &quot;kafka.topic&quot;, brokerList = &quot;%BrokerList%&quot;,\n                    consumerGroup = &quot;default-consumer&quot;, protocol = BrokerProtocol.SSL,\n                    sslCertificateLocation = &quot;%sslCertificateLocation%&quot;, sslCaLocation = &quot;%sslCaLocation%&quot;,\n                    sslKeyLocation = &quot;%sslKeyLocation%&quot;, sslKeyPassword = &quot;%keyStorePassword%&quot;,\n                    cardinality = Cardinality.ONE, dataType = &quot;string&quot;)\n</code></pre>\n<p>So, In above configuration I do not want to upload the <code>client private key, client public key and ca certificate</code> through artifact on the container for security purpose. So, I want to keep the certificates at secure location like <code>key vault, secret management</code> and use their reference location in @KafkaTrigger annotation. How can I achieve that?</p>\n"},{"tags":["java","android","android-fragments","android-animation","shared-element-transition"],"comments":[{"owner":{"user_id":1676363,"display_name":"ianhanniballake"},"edited":false,"comment_id":132410346,"body":"Did you read the <a href=\"https://developer.android.com/guide/fragments/animate#recyclerview\" rel=\"nofollow noreferrer\">documentation specifically about return shared element transitions when using RecyclerView</a>?"},{"owner":{"user_id":15573213,"display_name":"shybaka"},"edited":false,"comment_id":132410567,"body":"@ianhanniballake yes, but if I got it in the right way, that case is from a fragment to a recycler view, and it&#39;s not my case"},{"owner":{"user_id":1676363,"display_name":"ianhanniballake"},"edited":false,"comment_id":132412474,"body":"That&#39;s exactly what your return transition is."}],"answers":[{"owner":{"user_id":549372,"display_name":"Martin Zeitler"},"up_vote_count":0,"is_accepted":false,"creation_date":1673865596,"answer_id":75133056,"body":"<p>Your so called <code>sharedElementName</code> is actually a <code>transitionName</code>.</p>\n<p>a) The reference example doesn't directly manipulate the backstack:<br/>\n<a href=\"https://github.com/android/animation-samples/tree/master/GridToPager\" rel=\"nofollow noreferrer\">Android Fragment Transitions: RecyclerView to ViewPager</a> &amp; <a href=\"https://android-developers.googleblog.com/2018/02/continuous-shared-element-transitions.html\" rel=\"nofollow noreferrer\">Blog</a>.</p>\n<p>b) Manual transactions might require another order of method calls:</p>\n<pre><code>getSupportFragmentManager().beginTransaction()\n    .addSharedElement(sharedElement, transitionName)\n    .replace(R.id.container, newFragment)\n    .addToBackStack(null)\n    .commit();\n</code></pre>\n<p>Also see this <a href=\"https://medium.com/@bherbst/fragment-transitions-with-shared-elements-7c7d71d31cbb\" rel=\"nofollow noreferrer\">example</a>, how alternate transitions could be be set, compared to:</p>\n<pre><code>TransitionInflater.from(this).inflateTransition(R.transition.default_transition)\n</code></pre>\n<p>Whatever <code>R.transition.default_transition</code> may be.</p>\n<p>It may look strange when using the same transition for both ways, instead of enter/exit transitions, alike <code>NavAction</code> would feature. <a href=\"https://developer.android.com/guide/navigation/navigation-animate-transitions#set-fragment\" rel=\"nofollow noreferrer\"><code>FragmentNavigator.Extras</code></a> could be used to apply enter/exit transitions, when using navigation component; this also can be combined with <code>ActionBar</code>. Option a) is probably less complicated. b) something alike <a href=\"https://www.kodeco.com/8279305-navigation-component-for-android-part-3-transition-and-navigation\" rel=\"nofollow noreferrer\">this</a> Kotlin example might make more sense.\nIt's pointless to build clunky navigation FX when enter/exit transitions would be supported <a href=\"https://developer.android.com/guide/navigation/navigation-animate-transitions\" rel=\"nofollow noreferrer\">out-of-the-box</a>. Maybe consider loading with <a href=\"https://github.com/bumptech/glide\" rel=\"nofollow noreferrer\">Glide</a>, when loading images.</p>\n<hr />\n<p>Assume the following <code>build.gradle</code>; there's no need to reinvent the wheel.</p>\n<pre><code>dependencies {\n    androidTestImplementation &quot;androidx.navigation:navigation-testing:2.5.3&quot;\n    implementation 'androidx.navigation:navigation-runtime:2.5.3'\n    implementation 'androidx.navigation:navigation-fragment:2.5.3'\n    implementation 'androidx.navigation:navigation-ui:2.5.3'\n    annotationProcessor 'com.github.bumptech.glide:compiler:4.14.2' \n    implementation 'com.github.bumptech.glide:glide:4.14.2' \n}\n</code></pre>\n<p>Then <code>Navigation</code> with <code>FragmentNavigator.Extras</code> might rather be the current method:</p>\n<pre><code>Bundle navArgs = new Bundle();\nnavArgs.putInt(&quot;position&quot;, position);\n\nFragmentNavigator.Extras extras = new FragmentNavigator.Extras.Builder()\n    .addSharedElement(sharedElement, transitionName)\n    .build();\n\nNavigation.findNavController(view).navigate(\n    R.id.details, // ID of Nav destination\n    navArgs,      // Bundle of args\n    null,         // NavOptions\n    extras);\n</code></pre>\n<p>One can also define transitionName in XML <code>&lt;action/&gt;</code> nodes.</p>\n"},{"owner":{"user_id":17682395,"display_name":"Heet Changela"},"up_vote_count":0,"is_accepted":false,"creation_date":1673872205,"answer_id":75134258,"body":"<p>I think your problem is related to exit transition as you get solution of empty list, now for exit transition effect check below code.</p>\n<pre><code> public void showFragmentWithTransition(Fragment current, Fragment newFragment, String tag, View sharedView, String sharedElementName) {\n        FragmentManager fragmentManager = getSupportFragmentManager();\n        // check if the fragment is in back stack\n        boolean fragmentPopped = fragmentManager.popBackStackImmediate(tag, 0);\n        if (fragmentPopped) {\n\n        } else {\n            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n                current.setSharedElementReturnTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n                current.setExitTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n\n                newFragment.setSharedElementEnterTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n                newFragment.setEnterTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n                newFragment.setExitTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n                newFragment.setSharedElementReturnTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n            }\n             getSupportFragmentManager().beginTransaction()\n                 .addSharedElement(sharedElement, transitionName)\n                 .replace(R.id.container, newFragment)\n                 .addToBackStack(null)\n                 .commit();\n        }\n    }\n</code></pre>\n<p>Here I add two new lines for exit transitions.</p>\n<blockquote>\n<pre><code>            newFragment.setExitTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n            newFragment.setSharedElementReturnTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n</code></pre>\n</blockquote>\n<p>If its not work then follow below link, I think it will help you.\n<a href=\"https://medium.com/@bherbst/fragment-transitions-with-shared-elements-7c7d71d31cbb\" rel=\"nofollow noreferrer\">https://medium.com/@bherbst/fragment-transitions-with-shared-elements-7c7d71d31cbb</a></p>\n"}],"owner":{"user_id":15573213,"display_name":"shybaka"},"view_count":144,"up_vote_count":3,"answer_count":2,"score":3,"creation_date":1673019979,"question_id":75033089,"body":"<p>shared element transition replace the fragment, so I can't add it to the backstack and call popbackstack when the back arrow button is pressed.\nI have a main activity with inside a mainfragment, the main fragment handle a table layout so each tab is a fragment with inside a recycler view, when a recycler view element is clicked the shared element transition start to a new fragment that shows element details.</p>\n<p>This is the adapter, where the element is clicked:</p>\n<pre><code>holder.image.setTransitionName(&quot;transition&quot; + holder.getAdapterPosition());\nif (fragment instanceof tab1_anime) {\n     ((tab1_anime) fragment).openShowElementFragment(holder.getAdapterPosition(), v.findViewById(R.id.main_image));\n}\n</code></pre>\n<p>This is the openShowElementFragment inside my tab fragment:</p>\n<pre><code>public void openShowElementFragment(int position, View view) {\n        AddElement element = anime_list.get(position);\n        ShowElementFragment showElementFragment = new ShowElementFragment();\n        Bundle bundle = new Bundle();\n        bundle.putString(&quot;transitionName&quot;, &quot;transition&quot; + position);\n        bundle.putSerializable(&quot;element&quot;, element);\n        bundle.putInt(&quot;position&quot;, position);\n        bundle.putInt(&quot;from&quot;, 0);\n        showElementFragment.setArguments(bundle);\n        ((MainActivity) context).showFragmentWithTransition(this, showElementFragment, &quot;showElementFragment&quot;, view, &quot;transition&quot; + position);\n    }\n</code></pre>\n<p>this is the openshowelementfragment function called in the previous code block:</p>\n<pre><code>public void showFragmentWithTransition(Fragment current, Fragment newFragment, String tag, View sharedView, String sharedElementName) {\n        FragmentManager fragmentManager = getSupportFragmentManager();\n        // check if the fragment is in back stack\n        boolean fragmentPopped = fragmentManager.popBackStackImmediate(tag, 0);\n        if (fragmentPopped) {\n\n        } else {\n            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n                current.setSharedElementReturnTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n                current.setExitTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n\n                newFragment.setSharedElementEnterTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n                newFragment.setEnterTransition(TransitionInflater.from(this).inflateTransition(R.transition.default_transition));\n            }\n            fragmentManager.beginTransaction()\n                    .replace(R.id.fragmentHolder, newFragment)\n                    .addToBackStack(null)\n                    .addSharedElement(sharedView, sharedElementName)\n                    .commit();\n        }\n    }\n</code></pre>\n<p>and this is the backarrow button:</p>\n<pre><code>back_arrow.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                getSupportFragmentManager().popBackStack();\n            }\n        });\n</code></pre>\n<p>If I try to add the new fragment instead of replace the old one, then there is not animations at all.</p>\n<p>If I try to replace the old fragment with the new one and using anyway the addtobackstack(null) then the shared element transition works from start to end BUT the fragment at the end is without data, empty:</p>\n<p><a href=\"https://i.stack.imgur.com/5fptg.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5fptg.gif\" alt=\"enter image description here\" /></a></p>\n<p>I tried also:</p>\n<pre><code>getSupportFragmentManager()\n                .beginTransaction()\n                .replace(R.id.fragmentHolder,  new MainFragment())\n                .addToBackStack(null)\n                .commit();\n</code></pre>\n<p>but in this way the shared element transition doesn't work on exit:</p>\n<p><a href=\"https://i.stack.imgur.com/x8yt5.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/x8yt5.gif\" alt=\"enter image description here\" /></a></p>\n"},{"tags":["java","spring","spring-boot","dependency-injection","spring-framework-beans"],"comments":[{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":132401853,"body":"Why are you even refreshing the context, that is pretty dangerous actually..."},{"owner":{"user_id":12734082,"display_name":"FireBreather"},"edited":false,"comment_id":132483299,"body":"When our service starts up right after being installed we configure it at run time with things like database configuration. Our beans rely on that configuration and so we start up with dummy beans and swap them out once configuration input is added."},{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":132483390,"body":"Which seems wrong as you now have doubled the amount of beans. Why isn&#39;t this part of the startup process or regular configuration phase. What is so special about it?"}],"answers":[{"owner":{"user_id":10438820,"display_name":"sina zarei"},"up_vote_count":0,"is_accepted":false,"creation_date":1682701344,"answer_id":76131759,"body":"<p>I am not sure about Injecting ApplicationContext in that way that you have done,i think it could be error prone; if you want to Inject ApplicationContaxt in your beans, its better to  implements ApplicationContextAware with target bean and let to spring container do that.</p>\n"}],"owner":{"user_id":12734082,"display_name":"FireBreather"},"view_count":87,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1672966881,"question_id":75025944,"body":"<p>Our application somehow gets into an unusable state very intermittently and in a hard to reproduce fashion. We found it follows a path that uses this code that we think is likely the cause of the issue but aren't sure why or how to fix it. We don't see this around specific if statements so it doesn't seem like it's going down a different path of code but rather more likely a timing issue.</p>\n<pre><code>`import org.springframework.context.ApplicationContext;\nimport org.springframework.web.context.support.AnnotationConfigWebApplicationContext;\n\n((AnnotationConfigWebApplicationContext) applicationContext).refresh();`\n</code></pre>\n<p>It seems like the refresh triggers the following error so the next time we try and go through normal code paths spring is in a bad state.</p>\n<pre><code>`Unsatisfied dependency expressed through constructor parameter 0; nested exception is     org.springframework.beans.factory.BeanCreationException:Error creating bean with name 'MyCodeClass' defined in URL [jar:file:/path/repo-version.jar!/com/mypathtoMyCodeClassImpl.class]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'org.springframework.cache.annotation.ProxyCachingConfiguration': Initialization of bean failed; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'org.springframework.context.annotation.ConfigurationClassPostProcessor.importRegistry' available`\n</code></pre>\n<p>MyCodeClass semi looks like</p>\n<pre><code>`import org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.ApplicationContext;\nimport org.springframework.context.annotation.Lazy;\nimport org.springframework.stereotype.Component;\n\n@Component(&quot;MyCodeClass&quot;)\npublic class MyCodeClassImpl implements MyCodeClass, AnotherInterface {\n\n    @Autowired\n    @Lazy\n    private ApplicationContext applicationContext;\n\n... Other code\n}`\n</code></pre>\n"},{"tags":["java","android","kotlin"],"comments":[{"owner":{"user_id":7954210,"display_name":"Mouaad Abdelghafour AITALI"},"edited":false,"comment_id":132390365,"body":"Have you tried <code>isWiredHeadsetOn</code> from the <code>AudioManager</code>, e.g. <code>boolean isWiredHeadsetOn = mAudioManager.isWiredHeadsetOn();</code>"},{"owner":{"user_id":1000626,"display_name":"Chris Watts"},"edited":false,"comment_id":132390557,"body":"I&#39;m looking for wireless headphones but yes, I presume that would be another way to check wired headphones. It does appear to require a permission as well but I think it doesn&#39;t need user intervention so perhaps there&#39;s something there that works for wireless too."}],"owner":{"user_id":1000626,"display_name":"Chris Watts"},"view_count":44,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1672936318,"question_id":75021583,"body":"<p>I've been trying to look for a good solution to detect when headphones are connected in Android regardless of whether they are wired or wireless.</p>\n<p>The case for wired headphones is <a href=\"https://stackoverflow.com/questions/6249023/detecting-whether-a-headset-is-plugged-into-an-android-device-or-not\">fairly straight-forward</a>. However, when detecting if a wireless headset is connected, the APIs I have been using require <code>Manifest.permission.BLUETOOTH</code> or <code>Manifest.permission.BLUETOOTH_CONNECT</code>.</p>\n<p>For some time I've accepted that only if those permissions are granted will I know for sure if headphones are connected, but this is now increasingly becoming problematic.</p>\n<p>Does anyone know of an alternative that would determine if a headset is connected without user-facing 'dangerous' permission prompts like the BluetoothHeadset solution does? Is there anything in the AudioManager that can be used instead?</p>\n<p>Here is what I have today:</p>\n<pre><code>package ai.numbereight.sdk.platform.sensors\n\nimport android.bluetooth.BluetoothAdapter\nimport android.bluetooth.BluetoothHeadset\nimport android.bluetooth.BluetoothProfile\nimport android.content.BroadcastReceiver\nimport android.content.Context\nimport android.content.Intent\nimport android.content.IntentFilter\nimport android.util.Log\n\nprivate val listener = object : BroadcastReceiver() {\n    override fun onReceive(context: Context, intent: Intent) {\n        val connection = when (intent.getIntExtra(BluetoothHeadset.EXTRA_STATE,\n                BluetoothHeadset.STATE_DISCONNECTED)) {\n            BluetoothHeadset.STATE_CONNECTED -&gt; &quot;Connected&quot;\n            BluetoothHeadset.STATE_DISCONNECTED -&gt; &quot;Disconnected&quot;\n            else -&gt; &quot;Unknown&quot;\n        }\n\n        Log.d(&quot;Connection&quot;, connection)\n    }\n}\n\nfun register(context: Context) {\n    // Register for changes - events will only be received\n    // if Manifest.permission.BLUETOOTH (&lt; Android 10)\n    // or Manifest.permission.BLUETOOTH_CONNECT (&gt;= Android 10)\n    // are granted.\n    val filter = IntentFilter()\n    filter.addAction(BluetoothHeadset.ACTION_CONNECTION_STATE_CHANGED)\n    context.registerReceiver(listener, filter)\n\n    // Fire initial event - this API call requires the above Bluetooth permissions\n    // For brevity I assume that the default adapter is not null\n    val currentState = BluetoothAdapter.getDefaultAdapter()!!.getProfileConnectionState(BluetoothProfile.HEADSET)\n    val initialIntent = Intent(BluetoothHeadset.ACTION_CONNECTION_STATE_CHANGED)\n    initialIntent.putExtra(BluetoothHeadset.EXTRA_STATE, currentState)\n    listener.onReceive(context, initialIntent)\n}\n</code></pre>\n"},{"tags":["java","android","webrtc","webrtc-android"],"owner":{"user_id":2298490,"display_name":"grill2010"},"view_count":113,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1672909356,"question_id":75015968,"body":"<p>I'm currently using a self compiled WebRtc lib for my Android project and I try to get lowest latency for game streaming/ cloud gaming. I found out that on browsers you can use playoutDelayHint and or jitterBufferDelayHint to fine tune latency and how the underlying peer connection will handle things.</p>\n<p><a href=\"https://discourse.wicg.io/t/hint-attribute-in-webrtc-to-influence-underlying-audio-video-buffering/4038\" rel=\"nofollow noreferrer\">https://discourse.wicg.io/t/hint-attribute-in-webrtc-to-influence-underlying-audio-video-buffering/4038</a></p>\n<p>Unfortunately I have no idea of how to use these functionality within a native WebRtc project (no browser)?</p>\n<p>Is there a way to access and modify these flags in a native project and if not what actually must be adjusted in the WebRtc lib to achieve the same result? As I compile the WebRtc lib by my own I could just add this functionality by my own, I just don't have any idea what the playoutDelayHint and jitterBufferDelayHint flag is modifying in the background?</p>\n<p>I found this in the native code which could be the correct part for the playbackDelayHint but not sure</p>\n<p><a href=\"https://github.com/maitrungduc1410/webrtc/blob/c2b1bad4c87a43d7e1af85e809d5abe04baf3104/api/video/video_timing.h#L116\" rel=\"nofollow noreferrer\">https://github.com/maitrungduc1410/webrtc/blob/c2b1bad4c87a43d7e1af85e809d5abe04baf3104/api/video/video_timing.h#L116</a></p>\n"},{"tags":["java","spring-boot","properties-file"],"comments":[{"owner":{"user_id":13070,"display_name":"Mark B"},"edited":false,"comment_id":132365446,"body":"Does the application actually give you errors that it can&#39;t find the properties during runtime? Or is it just the IDE flagging your custom properties as &quot;unexpected&quot;? For example in IntelliJ it has always flagged custom properties like that for me, because IntelliJ is trying to validate it against known Spring properties, but I can just ignore that warning from the IDE and the application runs fine."},{"owner":{"user_id":20306007,"display_name":"life888888"},"edited":false,"comment_id":132365448,"body":"<code>@Configuration</code> <code>@ConfigurationProperties(prefix = &quot;custom&quot;)</code>"},{"owner":{"user_id":4687402,"display_name":"Benjamin Basmaci"},"edited":false,"comment_id":132380086,"body":"@MarkB The application doesn&#39;t run anymore as soon as I make the change. I updated my question accordingly."},{"owner":{"user_id":4687402,"display_name":"Benjamin Basmaci"},"edited":false,"comment_id":132380200,"body":"@life888888 I tried adding the config properties but all that did was change the error a bit. It basically still says the same though. Thank you for the suggestion, I updated my question accordingly."},{"owner":{"user_id":1527544,"display_name":"Antoniossss"},"edited":false,"comment_id":132380277,"body":"Well error clearly says that Spring fails to inject some <code>i18nService</code> of which in one case you have multiple candidates, and on the other case no candidates, while exactly single candidate is expected. I think taht this might be related to the mess with bean profiles and how you are activating them"},{"owner":{"user_id":1527544,"display_name":"Antoniossss"},"edited":false,"comment_id":132380304,"body":"For satrters, remove spring.profile.active properties from your properties/yml files and set them from cli, then you will see where the problem is."},{"owner":{"user_id":4687402,"display_name":"Benjamin Basmaci"},"edited":false,"comment_id":132380567,"body":"@Antoniossss I guess thats the symptom but the root of the problem is still not clear to me. Because as I stated, the only thing I changed was to go from one application file format to another. I dont know what&#39;s best practice here but that&#39;s not the point. As I said Im currently working through a tutorial and that tutorial has the step where it shows me how to use yml instead of properties and I would like to get it to work like that. Thats why a workaround is not a satisfying solution to me here."},{"owner":{"user_id":1527544,"display_name":"Antoniossss"},"edited":false,"comment_id":132380708,"body":"<i>(...)one application file format to another</i> and apparently you did it wrong, I would probably have problems myself If I would try to specify active profiles via yml as I dont know if it is a single string, array of strings etc. In props it sclear NAME1,NAME2 etc."},{"owner":{"user_id":5599966,"display_name":"Mor Blau"},"edited":false,"comment_id":132476761,"body":"Have you tried using a .yml but with only the spring.profiles.active properties? This will allow you to assert the issue is with your properties, and not with the .yml not being recognized, or some other issue."},{"owner":{"user_id":4687402,"display_name":"Benjamin Basmaci"},"edited":false,"comment_id":132492680,"body":"@MorBlau Only putting the <code>spring.profiles.active</code> in the yml file works. It compiles and chooses the appropriate profiles."},{"owner":{"user_id":112968,"display_name":"knittl"},"edited":false,"comment_id":132528668,"body":"I cannot reproduce with the given pom file and a simple application comprising 2 user-defined beans/components. But your error message states that <code>GreetingService</code> cannot be injected. Find out why that is: are the multiple beans? no beans? beans only active with certain profiles? Can you (temporarily) change your application to to use the GreetingService as a dependency?"},{"owner":{"user_id":6066470,"display_name":"Nick"},"edited":false,"comment_id":132585174,"body":"It seems that the problem is in some other parameters from the application file"},{"owner":{"user_id":4687402,"display_name":"Benjamin Basmaci"},"edited":false,"comment_id":132588419,"body":"@Nick There are none. Thats the literal file structure. The only difference is that I used the word &quot;custom&quot; here instead of the one I used in the real project that came from the tutorial: &quot;guru&quot;."}],"answers":[{"owner":{"user_id":9983181,"display_name":"HakerMSL"},"up_vote_count":0,"is_accepted":false,"creation_date":1673434335,"answer_id":75081885,"body":"<p>As you're using spring-boot-starter SnakeYAML library should be on your classpath, but please double-check with <code>mvn dependency:list</code>, search the output for a line <code>[INFO]    org.yaml:snakeyaml:jar:1.33:compile -- module org.yaml.snakeyaml [auto]</code> .</p>\n<p>If it's missing, then please add SnakeYAML dependency: <a href=\"https://mvnrepository.com/artifact/org.yaml/snakeyaml\" rel=\"nofollow noreferrer\">https://mvnrepository.com/artifact/org.yaml/snakeyaml</a></p>\n<p>Eclipse IDE has auto-convertion mechanism which converts properties into yaml format. Just right click on the file and click &quot;convert&quot; it works like a charm. I'm using Eclipse STS edition.</p>\n<p><a href=\"https://i.stack.imgur.com/LLUiI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LLUiI.png\" alt=\"enter image description here\" /></a></p>\n<p>I guess that you're not sharing full properties file and there is a syntax error or something is missing in your yaml configuration. Please give a try with plugins which are available for InteliJ IDEA: <a href=\"https://plugins.jetbrains.com/plugin/8000-properties-to-yaml-converter\" rel=\"nofollow noreferrer\">https://plugins.jetbrains.com/plugin/8000-properties-to-yaml-converter</a> or online converters like: <a href=\"https://www.javainuse.com/app2yaml\" rel=\"nofollow noreferrer\">https://www.javainuse.com/app2yaml</a> .</p>\n<hr />\n<h2><strong>UPDATE:</strong></h2>\n<p>I Decided to reproduce your example code on my machine with exactly the same version of SpringBoot and Java. First of all I've created a properties files and tested (it worked fine) and then migrated properties file into YAML format and it also works fine with exactly the same result.</p>\n<p><a href=\"https://i.stack.imgur.com/POfGG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/POfGG.png\" alt=\"enter image description here\" /></a></p>\n<p>When it comes to unexpected key <code>custom</code> it only says that this key if unknown (more like warning then error), and you can define it in <code>META-INF</code> like below.</p>\n<p><a href=\"https://i.stack.imgur.com/qqz3s.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qqz3s.png\" alt=\"enter image description here\" /></a></p>\n<p>So as other comments suggest I'm sure that it's connected to code which relays on properties file in some hardcoded way (for example <code>@PropertySource</code> annotation, see also my comment below).</p>\n"}],"owner":{"user_id":4687402,"display_name":"Benjamin Basmaci"},"view_count":1292,"up_vote_count":4,"answer_count":1,"score":3,"creation_date":1672845309,"question_id":75007514,"body":"<p>I'm following a tutorial on Java Spring Boot and the current topic is that one can use both <code>application.properties</code> and <code>application.yml</code></p>\n<p>So my <code>application.properties</code> looked like this:</p>\n<pre><code>spring.profiles.active=EN, cat\ncustom.username=user\ncustom.password=pass\n</code></pre>\n<p>I deleted it and created an <code>application.yml</code> instead. IntelliJ even marks it with the little green start button icon. <code>application.yml</code> looks like this:</p>\n<pre><code>spring:\n  profiles:\n    active: EN, cat\ncustom:\n  username: user\n  password: pass\n</code></pre>\n<p>But when I do the <code>custom</code> properties don't get recognized any more. The IDE marks them red and shows this error: &quot;Key 'custom' is not expected here&quot;</p>\n<p>I wasn't sure if that's correct so I tried what the IDE suggested when using autocomplete to write <code>spring.profiles.active</code> which was writing the list elements like this:</p>\n<pre><code>spring:\n  profiles:\n    active:\n      - EN\n      - cat\ncustom:\n  username: user\n  password: pass\n</code></pre>\n<p>But that also didn't help.</p>\n<p>I'm not sure where to go from here. I've tried to research the issue, however the only hits I get that come somewhat close all just mention that it's possible to use <code>yml</code> instead of <code>properties</code> and some even use custom properties like I displayed above.</p>\n<p>Is this maybe a version issue? My pom looks like this:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;myID&lt;/groupId&gt;\n    &lt;artifactId&gt;myArtifact&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;myName&lt;/name&gt;\n    &lt;description&gt;myDescription&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;11&lt;/java.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n            &lt;exclusions&gt;\n                &lt;exclusion&gt;\n                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;\n                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;\n                &lt;/exclusion&gt;\n            &lt;/exclusions&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n\n</code></pre>\n<h1>Update</h1>\n<p>To answer the question Mark B posed in the comments. This is the error message:</p>\n<pre><code>\nError starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.\n2023-01-05T08:58:07.711+01:00 ERROR 5026 --- [           main] o.s.b.d.LoggingFailureAnalysisReporter   : \n\n***************************\nAPPLICATION FAILED TO START\n***************************\n\nDescription:\n\nParameter 0 of constructor in my.package.controllers.I18nController required a bean of type 'my.package.services.GreetingService' that could not be found.\n\nThe injection point has the following annotations:\n    - @org.springframework.beans.factory.annotation.Qualifier(&quot;i18nService&quot;)\n\nThe following candidates were found but could not be injected:\n    - User-defined bean\n    - User-defined bean\n    - User-defined bean method 'primaryGreetingService' in 'GreetingServiceConfig'\n    - User-defined bean method 'propertyInjectedGreetingService' in 'GreetingServiceConfig'\n    - User-defined bean method 'setterInjectedGreetingService' in 'GreetingServiceConfig'\n    - User-defined bean\n\n\nAction:\n\nConsider revisiting the entries above or defining a bean of type 'my.package.services.GreetingService' in your configuration.\n\n\nProcess finished with exit code 1\n</code></pre>\n<p>At first glance this looks like maybe I messed up something within the definition or configuration of my beans. However, when I revert my repository back to the state where I used the <code>application.properties</code> file as described above, everything works as expected.</p>\n<p>I retook the steps to isolate the problem as much as possible.</p>\n<p>All I did was:</p>\n<ol>\n<li>delete <code>application.properties</code></li>\n<li>create <code>application.yml</code></li>\n</ol>\n<p>I have changed nothing else.</p>\n<h3>git status (translated and simplified):</h3>\n<pre><code>On Branch master\nYour Branch is in the same state as 'origin/master'.\n\nStaged changes:\n        deleted:       src/main/resources/application.properties\n        new file:     src/main/resources/application.yml\n\nUnstaged changes::\n        changed:       src/main/resources/application.yml\n</code></pre>\n<p><code>src/main/resources/application.yml</code> is staged as new file and then has unstaged changes because the IDE staged the new file on creation. Just to clear out any confusion. Though this shouldn't affect the outcome.</p>\n<h1>Update 2</h1>\n<p>As suggested in the comments I tried to add <code>@ConfigurationProperties(prefix = &quot;custom&quot;)</code>, but all that did was change the error slightly:</p>\n<pre><code>Error creating bean with name 'i18nController' defined in file\n[/path/target/classes/my/package/controllers/I18nController.class]:\nUnsatisfied dependency expressed through constructor parameter 0:\nNo qualifying bean of type 'my.package.services.GreetingService' available:\nexpected at least 1 bean which qualifies as autowire candidate.\nDependency annotations:\n{@org.springframework.beans.factory.annotation.Qualifier(&quot;i18nService&quot;)}\n</code></pre>\n"},{"tags":["java","scala","generics","design-patterns","finagle"],"comments":[{"owner":{"user_id":6656833,"display_name":"Pavel"},"edited":false,"comment_id":132347548,"body":"I am afraid this might not work because of the type erasure and you would need to use reflection"},{"owner":{"user_id":5389127,"display_name":"Ga&#235;l J"},"edited":false,"comment_id":132347805,"body":"Is this a single id or a list of IDs as input parameter? Anyway you can probably achieve what you wrote with a <code>ClassTag</code> but you&#39;ll need to define 3 types for the 3 IDs and wrap/unwrap them, I don&#39;t think you can achieve it with <code>A</code> being a subtype of <code>UUID</code>."},{"owner":{"user_id":5389127,"display_name":"Ga&#235;l J"},"edited":false,"comment_id":132347829,"body":"You could also just go with an enum (sealed trait or similar) not related to UUID at all and pass it as a second parameter with the list of IDs."},{"owner":{"user_id":4046516,"display_name":"CodeSsscala"},"edited":false,"comment_id":132349853,"body":"Yeah the inputs is a list of Ids. So the sealed trait would be an identifier for what type of ID it is? Not sure what the standard pattern is in the industry for these types of endpoints"},{"owner":{"user_id":4254517,"display_name":"Dima"},"edited":false,"comment_id":132350282,"body":"Yeah, make an enum ... or pass a <code>ClassTag</code>. Either way works. I also don&#39;t see what your &quot;coordinator serivice&quot; helps: if you still three endpoints and three database side functions, how is this reducing any repetition. I would just combine the tree DB-functions into one, that takes an enum parameter, and uses it to derive the where clause."}],"owner":{"user_id":4046516,"display_name":"CodeSsscala"},"view_count":34,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1672767118,"question_id":74996720,"body":"<p>I'm designing a Scala service which has 3 endpoints which are very similar -\na. <code>getUserByUserID(userIds: List[UserID]): List[User]</code>\nb. <code>getUserByEmployeeID(employeeIDs: List[EmployeeID]): List[User]</code>\nc. <code>getUserByDepartmentID(departmentIDs: List[DepartmentID]): List[User]</code></p>\n<p>Think of User as a case class having many fields but 3 of them for the above endpoints are:</p>\n<pre><code>case class User(\n  userId: UserID,\n  employeeID: EmployeeID,\n  departmentID: DepartmentID,\n)\n</code></pre>\n<p>All these IDs are of type <code>java.util.UUID</code>.</p>\n<p>All 3 endpoints return the <code>User</code> object as a list where the appropriate IDs match.</p>\n<p>My concern is that there's a lot of repetitive work in this. Only difference is that the <code>WHERE</code> clause in the query changes to one of <code>userID</code>, <code>employeeID</code>, <code>departmentID</code>.</p>\n<p>I want to minimize this duplication. Is Scala generics a way to do that?</p>\n<p>I was thinking of creating a coordinator service that takes in any form of ID and returns the <code>List[User]</code> from it</p>\n<p>so something like</p>\n<p>endpoint1, endpoint2, endpoint3 -&gt; call CoordinatorService --&gt; call Database service</p>\n<p>Coordinator service only has 1 method\n<code>def getUserFromAnyID[A &lt;: UUID](id: A): List[User]</code></p>\n<p>and somehow match the generic <code>A</code> to ID to call appropriate database service. At a high level it would look like:</p>\n<pre><code>def getUserFromAnyID[A &lt;: UUID](id: A): List[User] = {\n  // A is a list\n  A match {\n    case Nil =&gt; List.empty()\n    case someList =&gt;\n     // How to match the type of the object in someList?? It can be any of userId, employeeID, departmentID\n     // After matching, it will call the database service:\n     &lt;type of list object&gt; match {\n        case userID: UserID =&gt; databaseService.getUsersByUserID(&lt;pass list of userIds)\n        case employeeIds: EmployeeID =&gt; databaseService.getUsersByEmployeeIDs(&lt;pass list of employee IDs)\n       .\n       .\n       .\n     }  \n  }\n}\n\n</code></pre>\n<p>Is there an efficient pattern to achieve this?</p>\n"},{"tags":["java","spring-boot","xss","checkmarx"],"comments":[{"owner":{"user_id":112968,"display_name":"knittl"},"edited":false,"comment_id":132340641,"body":"Is it untrusted (i.e. user-provided) data? Can you sanitize or escape/encode it? What happens with the data?"},{"owner":{"user_id":13418510,"display_name":"TomStroemer"},"edited":false,"comment_id":132340796,"body":"Checkmarx wants you to sanitize/validate the data before you send it to the client. This can be done with libraries like Antisamy or Jsoup. See here for example: <a href=\"https://jsoup.org/cookbook/cleaning-html/safelist-sanitizer\" rel=\"nofollow noreferrer\">jsoup.org/cookbook/cleaning-html/safelist-sanitizer</a>"}],"owner":{"user_id":10207534,"display_name":"Anonymous"},"view_count":2847,"up_vote_count":3,"answer_count":0,"score":3,"creation_date":1672748376,"question_id":74993277,"body":"<p>I am currently facing <em>Checkmarx</em> scan issue for the below snippet:</p>\n<blockquote>\n<p>The application's <code>getResponse</code> embeds untrusted data in the generated output with <code>setCatList</code>, at <code>line 10</code> of <code>MyClass.java</code>.\nThis untrusted data is embedded straight into the output without proper sanitization or encoding, enabling an attacker to inject malicious code into the output.\nThis can enable a <em>Reflected Cross-Site Scripting (XSS)</em> attack.</p>\n</blockquote>\n<pre class=\"lang-java prettyprint-override\"><code>GetCatSP sp = getCatSP(); // GetCatSP extends StoredProcedure\nMap&lt;String, Object&gt; output = sp.getMyData(inParams); // This executes super.execute(inParams) and returns it\nList&lt;Cat&gt; catList = (List&lt;Cat&gt;) output.get(&quot;cat_info&quot;);\n\nresponse.setCatList(catList); \n</code></pre>\n<p>How do I handle this?</p>\n"},{"tags":["java","android","firebase","firebase-app-check","google-play-integrity-api"],"comments":[{"owner":{"user_id":3804613,"display_name":"Abzal Serekov"},"edited":false,"comment_id":132592266,"body":"Consider filing an issue via <a href=\"https://github.com/firebase/firebase-android-sdk/issues\" rel=\"nofollow noreferrer\">github.com/firebase/firebase-android-sdk/issues</a> with more details (e.g. package name)"},{"owner":{"user_id":16167525,"display_name":"Victor Fan"},"edited":false,"comment_id":132592828,"body":"<i>Firebaser here.</i>  Agree with Abzal&#39;s response -- please file an issue at the above link, and include details you are comfortable sharing. You can also file a support ticket directly with <a href=\"https://firebase.google.com/support/troubleshooter/contact\" rel=\"nofollow noreferrer\">Firebase Support</a> without publicizing those details."}],"answers":[{"owner":{"user_id":4896784,"display_name":"ismail alaoui"},"up_vote_count":0,"is_accepted":false,"creation_date":1678447838,"answer_id":75695611,"body":"<p>if you are under debug mode you should add debug token to your appcheck :</p>\n<p><strong>Appcheck</strong> -- &gt; <strong>Application</strong> -- &gt; <strong>Manage debug token</strong></p>\n<p>add this line to your gradle :</p>\n<pre><code>    implementation 'com.google.firebase:firebase-appcheck-debug:16.1.2'\n</code></pre>\n<p>And then instantiate your appcheck this way :</p>\n<pre><code>   FirebaseApp.initializeApp(getApplicationContext());\n   FirebaseAppCheck firebaseAppCheck = FirebaseAppCheck.getInstance();\n   firebaseAppCheck.installAppCheckProviderFactory(\n            DebugAppCheckProviderFactory.getInstance());\n</code></pre>\n<p>After that , lunch your application , in your logcat , look for this :</p>\n<pre><code>D DebugAppCheckProvider: Enter this debug secret into the allow list in\nthe Firebase Console for your project: 123a4567-b89c-12d3-e456-789012345678\n</code></pre>\n<p>So you need to add this token <code>123a4567-b89c-12d3-e456-789012345678</code> in your Appcheck debug token .</p>\n<p>this should work for you !</p>\n"}],"owner":{"display_name":"user20918628"},"view_count":723,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1672745158,"question_id":74992711,"body":"<p>I am trying to implement <code>firebase app check</code> in my android app using <code>Play-Integrity API</code>. I have added both my <strong>SHA-1</strong> &amp; <strong>SHA-256</strong> fingerprints in my firebase app (acquired from <code>Google play console</code> and <code>Android studio gradle signing report</code> both) into my firebase app.</p>\n<p>I have added this code inside all my activities in my app, before using any other <code>Firebase SDKs</code>:</p>\n<pre><code>@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    FirebaseApp.initializeApp(this);\n    FirebaseAppCheck firebaseAppCheck = FirebaseAppCheck.getInstance();\n    firebaseAppCheck.installAppCheckProviderFactory(PlayIntegrityAppCheckProviderFactory.getInstance());\n}\n</code></pre>\n<hr />\n<p>Now no matter how many times I run my app, I keep getting the error in my console:</p>\n<pre><code>pc_0 - Detected invalid AppCheck token. Reconnecting (2 attempts remaining)\npc_0 - Detected invalid AppCheck token. Reconnecting (1 attempts remaining)\npc_0 - Detected invalid AppCheck token. Reconnecting (0 attempts remaining)\n\npc_0 - Firebase Database connection was forcefully killed by the server. Will not attempt reconnect. Reason: Invalid appcheck token\n</code></pre>\n<p>I have followed all the steps exactly as mentioned in <a href=\"https://firebase.google.com/docs/app-check/android/play-integrity-provider\" rel=\"nofollow noreferrer\">this</a> page. My app is already uploaded in <strong>Google play store</strong>, and <strong>Google Play Integrity API</strong> is already enabled in <code>Google cloud console</code>. What more do I need to do? Please help me.</p>\n"},{"tags":["java","spring-boot","hibernate","bytecode-manipulation"],"comments":[{"owner":{"user_id":2165146,"display_name":"muhammed ozbilici"},"edited":false,"comment_id":132322147,"body":"you can check use properties like -&gt;  <code>lazy=&quot;proxy|no-proxy|false&quot;</code>"},{"owner":{"user_id":3672398,"display_name":"Blockost"},"edited":false,"comment_id":132323051,"body":"Can you please indicate where I should set this property ? Also, I tried setting <code>spring.jpa.hibernate.bytecode.allow_enhancement_as_proxy: true</code> in application.yml, but it didn&#39;t work"},{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":132323299,"body":"@Blockost have you checked <code>org.hibernate.Hibernate#isPropertyInitialized</code> method?"},{"owner":{"user_id":3672398,"display_name":"Blockost"},"edited":false,"comment_id":132330056,"body":"I did not know about this method, thank you for pointing that out. It will definitely help me at some point!   However, my problem is that property getters are called in the mapper and it&#39;s not always guaranteed that a Hibernate session is available. So I get a <code>LazyInitializationException</code> there. Mappers are generated at build time by Mapstruct so I don&#39;t  have full control over them (and I don&#39;t want to add too much logic on Mapstruct side anyway)"},{"owner":{"user_id":1092818,"display_name":"crizzis"},"edited":false,"comment_id":132887499,"body":"Just to expand on @muhammedozbilici&#39;s suggestion, <a href=\"https://docs.jboss.org/hibernate/orm/5.4/topical/html_single/bytecode/BytecodeEnhancement.html\" rel=\"nofollow noreferrer\">the docs</a> actually show you the way in which you can opt-out of each particular enhancement. And, since you&#39;re using compile-time enhancement with the Maven plugin, spring properties obviously won&#39;t work"},{"owner":{"user_id":1092818,"display_name":"crizzis"},"edited":false,"comment_id":132887561,"body":"Alternatively, <a href=\"https://medium.com/cloud-workers/mapstruct-and-hibernate-jpa-lazy-loading-1c1c6f416e\" rel=\"nofollow noreferrer\">see here</a> for making MapStruct work with Hibernate&#39;s lazy associations - in short, you <i>do</i> have some control over the mappers, just enough to make it work"}],"answers":[{"owner":{"user_id":412446,"display_name":"Christian Beikov"},"up_vote_count":0,"is_accepted":false,"creation_date":1675252805,"answer_id":75309867,"body":"<p>If you want to avoid <code>LazyInitializationException</code> for your DTO mapping, you should rather try to avoid doing the mapping in Java code and instead use a solution that can take the mapping down to the HQL/SQL level.</p>\n<p>I think this is a perfect use case for <a href=\"https://github.com/Blazebit/blaze-persistence#entity-view-usage\" rel=\"nofollow noreferrer\">Blaze-Persistence Entity Views</a>.</p>\n<p>I created the library to allow easy mapping between JPA models and custom interface or abstract class defined models, something like Spring Data Projections on steroids. The idea is that you define your target structure(domain model) the way you like and map attributes(getters) via JPQL expressions to the entity model.</p>\n<p>A DTO model for a possible use case could look like the following with Blaze-Persistence Entity-Views:</p>\n<pre><code>@EntityView(User.class)\npublic interface UserDto {\n    @IdMapping\n    Long getId();\n    String getName();\n    Set&lt;RoleDto&gt; getRoles();\n\n    @EntityView(Role.class)\n    interface RoleDto {\n        @IdMapping\n        Long getId();\n        String getName();\n    }\n}\n</code></pre>\n<p>Querying is a matter of applying the entity view to a query, the simplest being just a query by id.</p>\n<p><code>UserDto a = entityViewManager.find(entityManager, UserDto.class, id);</code></p>\n<p>The Spring Data integration allows you to use it almost like Spring Data Projections: <a href=\"https://persistence.blazebit.com/documentation/entity-view/manual/en_US/index.html#spring-data-features\" rel=\"nofollow noreferrer\">https://persistence.blazebit.com/documentation/entity-view/manual/en_US/index.html#spring-data-features</a></p>\n<pre><code>Page&lt;UserDto&gt; findAll(Pageable pageable);\n</code></pre>\n<p>The best part is, it will only fetch the state that is actually necessary!</p>\n"}],"owner":{"user_id":3672398,"display_name":"Blockost"},"view_count":191,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1672663314,"question_id":74982566,"body":"<p>I'm using Spring Boot 2.7.5 with Hibernate 5.6.12.Final and apply bytecode enhancement at build-time via <code>hibernate-enhance-maven-plugin</code>. It works great and prevents eagerly fetching <code>@OneToOne</code> relationships, as described here <a href=\"https://vladmihalcea.com/hibernate-lazytoone-annotation/\" rel=\"nofollow noreferrer\">https://vladmihalcea.com/hibernate-lazytoone-annotation/</a>.</p>\n<p>However, I found that all lazy relationships do not use proxies anymore but are fetched from the database when I use the getter (which has been instrumented by the maven plugin at build time). Basically, what I would like to do is to still use proxies with bytecode enhancement. Something similar is available at runtime <a href=\"https://in.relation.to/2019/07/30/bytecode-proxy/\" rel=\"nofollow noreferrer\">https://in.relation.to/2019/07/30/bytecode-proxy/</a>, but I can't find a way to do it at build-time.</p>\n<p>For a bit of context, I need proxies for lazy-loaded properties because it allows me to apply custom logic in entity-&gt;dto mapper (using Mapstruct) based on whether the proxy has been initialized or not. In some cases, I must trigger an initialization manually if a Hibernate session is available (and prevent <code>LazyInitializationException</code>).</p>\n<p>Any suggestion is greatly appreciated!</p>\n"},{"tags":["java","arrays","sparse-matrix"],"comments":[{"owner":{"user_id":102937,"display_name":"Robert Harvey"},"edited":false,"comment_id":132310786,"body":"The third option is to use linked lists.  The fourth option is to use a Row-Column-Value array.   See <a href=\"https://www.geeksforgeeks.org/what-is-meant-by-sparse-array/\" rel=\"nofollow noreferrer\">geeksforgeeks.org/what-is-meant-by-sparse-array</a>"},{"owner":{"user_id":102937,"display_name":"Robert Harvey"},"edited":false,"comment_id":132310824,"body":"Note that the source code for the  Android <code>SparseArray</code> class is <a href=\"https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/util/SparseArray.java\" rel=\"nofollow noreferrer\">available online</a>, under an Apache license."},{"owner":{"user_id":19370273,"display_name":"Leaderboard"},"edited":false,"comment_id":132310856,"body":"@RobertHarvey   The problem with a linked list (which I considered) is that lookups by index won&#39;t work (without a manual iteration), which is difficult.   A &quot;Row-Value&quot; array won&#39;t work either, as that simply reduces to a hashmap (with row as the key) from an implementation point of view (or alternatively something like the <code>Pair</code> class).  It should be noted that my array is one-dimensional. If I have misunderstood you, please clarify."},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132310890,"body":"We could use a <code>Map&lt;Integer, Integer&gt;</code> to simulate a sparse array. This could be extended for matrices, e.g. by using a <code>Map&lt;Pair&lt;Integer, Integer&gt;, Integer&gt;</code> with <code>public record Pair&lt;T, U&gt;(T first, U second)</code>."},{"owner":{"user_id":19370273,"display_name":"Leaderboard"},"edited":false,"comment_id":132310913,"body":"@Turing85 That is my current approach, but it appears to have a significant penalty in memory usage from my understanding (due to its relative complexity - see <a href=\"https://stackoverflow.com/questions/25560629/sparsearray-vs-hashmap\" title=\"sparsearray vs hashmap\">stackoverflow.com/questions/25560629/sparsearray-vs-hashmap</a> for an example). In this case, I have to optimise memory usage as much as possible; if the array was relatively full, I would have gone with a primitive array."},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132310969,"body":"How did you confirm your suggestion that the <code>Map</code> is the root cause for the memory consumption? What limitations wrt. memory do you have?"},{"owner":{"user_id":19370273,"display_name":"Leaderboard"},"edited":false,"comment_id":132310989,"body":"@Turing85 My program is a bunch of hashmaps chained together (<a href=\"https://github.com/Leader-board/Wikimedia-statistics/blob/main/Global%20user%20table%20generator/Main.java\" rel=\"nofollow noreferrer\">github.com/Leader-board/Wikimedia-statistics/blob/main/&hellip;</a>). As it currently stands, this takes up almost 100 GB of RAM. I want to change the nested hashmap into one with a sparse array as its value."},{"owner":{"user_id":112968,"display_name":"knittl"},"edited":false,"comment_id":132311035,"body":"So you&#39;re okay with your arrays not being able to store <code>0</code>? Or how else do you want to distinguish between present and not-present? Note that using reference types such as <code>Integer</code> to store null will require even more memory (4 bytes for the number and even more bytes for the reference)"},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132311043,"body":"And which parts <b>do</b> actually consume that memory? Have analyzed the memory consumption at runtime, e.g. through VisualVM?"},{"owner":{"user_id":19370273,"display_name":"Leaderboard"},"edited":false,"comment_id":132311045,"body":"&quot;So you&#39;re okay with your arrays not being able to store 0?&quot; - That is fine by me; in other words, it&#39;s fine to treat 0 as &quot;not-present&quot;."},{"owner":{"user_id":19370273,"display_name":"Leaderboard"},"edited":false,"comment_id":132311053,"body":"&gt; And which parts do actually consume that memory?   It&#39;s the hashmaps - I haven&#39;t used VisualVM, but can consider running it if it helps. I do monitor the memory usage when running the program."},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132311072,"body":"Yes, it would help. In particular, it would help to know which <code>Map</code> consumes the most memory, and why. For further analysis, however, we would most probably also need a description on what the program actually does."},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132311123,"body":"From what I can see, it seems that there might be a bunch of non-closed <code>Stream</code>s. I am not sure whether <code>System.setOut(...)</code> closes the current <code>System.out</code>-stream."},{"owner":{"user_id":19370273,"display_name":"Leaderboard"},"edited":false,"comment_id":132311150,"body":"@Turing85  * It isn&#39;t <code>System.setOut</code>; that phase kicks in only after importing. The majority of RAM is used up in the importing stage. Additionally, I changed it to buffered writes, with the same result. * I am reasonably sure that it&#39;s the nested hashmap <code>static HashMap&lt;String, HashMap&lt;String, Integer&gt;&gt; users = new HashMap&lt;&gt;(); </code> that is most intensive in memory. This can be shown by the fact that <code>analyser()</code> does not increase memory usage substantially despite it having a treemap of its own. I need to run a profiler though to fully answer your previous question."},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132311242,"body":"is replacing the inner map with an, for example, <code>public record WikiEditCount(String wikiName, int edits){}</code> an option? This would mean to change <code>Map&lt;String, Map&lt;String, Integer&gt;&gt; users</code> to a <code>Map&lt;String, Set&lt;WikiEditCount&gt;&gt; users</code>."},{"owner":{"user_id":19370273,"display_name":"Leaderboard"},"edited":false,"comment_id":132311260,"body":"@Turing85 Would that not potentially increase the memory usage instead, plus require <code>WikiEditCount</code> to be hashable anyway? I could be mistaken there though."},{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132311279,"body":"It is defined as a record, thus is it is implicitly hashable. My gut instinct tells me that the overhead of a <code>Set</code> of records is lower than the overhead of a <code>Map</code>. But to be sure, we&#39;d need to run some tests... If you can provide me a test data set of relevant size, I can take a look."},{"owner":{"user_id":5103317,"display_name":"Old Dog Programmer"},"edited":false,"comment_id":132324683,"body":"&quot;Options like linked lists or an arraylist (of Pairs for instance) won&#39;t work since lookups are difficult that way.&quot; .   Creating software sometimes uses the art of compromise. You might have to sacrifice some desirable characteristic at the expense of improving some other characteristic.  A sparse array is used to reduce memory requirements at the expense of some reduction in the time needed to access an element."},{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":132444839,"body":"If you are asking if there is a sparse array data structure that has O(1) get and set operations and also has low space overheads ... there isn&#39;t one.  You need to compromise on some of the requirements."},{"owner":{"user_id":19370273,"display_name":"Leaderboard"},"edited":false,"comment_id":132454324,"body":"@StephenC <i>Some</i> compromise is indeed fine to me. For example, amortised O(1) (as the accepted answer does) or O(log n) are both OK. I was simply looking for the best option."}],"answers":[{"owner":{"user_id":112968,"display_name":"knittl"},"up_vote_count":1,"is_accepted":true,"creation_date":1672597733,"answer_id":74976583,"body":"<p>How large are your collections? Do note that <code>Integer</code> (boxed reference type) adds significant memory overhead. Standard Java collection types (<code>Map</code>, <code>List</code>) only support reference types.</p>\n<p>What does <em>significant</em> mean? An <code>int</code> takes 4 bytes of memory, a <code>long</code> takes 8 bytes. Compare that to an <code>Integer</code> (16 bytes) or a <code>Long</code> (24 bytes). Reference: <a href=\"https://stackoverflow.com/questions/9037468/what-is-the-storage-cost-for-a-boxed-primitive-in-java\">What is the storage cost for a boxed primitive in Java?</a></p>\n<p><a href=\"https://trove4j.sourceforge.net/html/overview.html\" rel=\"nofollow noreferrer\">GNU Trove</a> implements most collections with primitive types, which increases cache locality and decreases memory consumption. Perhaps this will work for you.</p>\n"}],"owner":{"user_id":19370273,"display_name":"Leaderboard"},"view_count":162,"up_vote_count":4,"accepted_answer_id":74976583,"answer_count":1,"score":3,"creation_date":1672595813,"question_id":74976391,"body":"<p>As the title says, is there a way for me to have a sparse int array in Java? Something like <code>int[]</code> or <code>Integer[]</code>, but each element in the array should not take up space until it is actually written to with a non-zero value. This is because I want to optimise memory as much as possible (as most of the elements in the array would be 0/empty), yet have the option to look up by index, as with a standard array. I've considered the below options before asking this question:</p>\n<ul>\n<li>I am aware of options such as <a href=\"https://developer.android.com/reference/android/util/SparseIntArray\" rel=\"nofollow noreferrer\">https://developer.android.com/reference/android/util/SparseIntArray</a>. The problem is that they seem to be Android-specific, and I could not find a desktop equivalent.</li>\n<li>My understanding is that <code>int[]</code> and <code>Integer[]</code> are not sparse arrays; even if I were to keep the elements of an <code>Integer</code> array as <code>null</code>, it would still take up space, which wouldn't work for me.</li>\n<li>The other option is to use hashmaps. While that works, it does take up non-insignificant amount of space (which is an issue in this particular case).</li>\n<li>Options like linked lists or an arraylist (of <code>Pairs</code> for instance) won't work since lookups are difficult that way.</li>\n</ul>\n"},{"tags":["java","android","android-studio","android-studio-electric-eel"],"comments":[{"owner":{"user_id":3649629,"display_name":"Gleichmut"},"edited":false,"comment_id":132630771,"body":"It is recommended to use <code>jdk</code> supplied together with <code>Gradle JDK</code>."},{"owner":{"user_id":7589309,"display_name":"Mike"},"edited":false,"comment_id":133133991,"body":"I have the same issue. after Eel upgrade.  When it fails, this notification appears at the bottom:   Multiple Gradle daemons might be spawned because the Gradle JDK and JAVA_HOME locations are different. Project &#39;Auth Module&#39; is using the following JDK location when running Gradle: &#39;C:/Users/Mike/.jdks/corretto-1.8.0_332&#39; The system environment variable JAVA_HOME is: &#39;C:\\Program Files\\Android\\Android Studio\\jbr&#39; If you dont need to use different paths (or if JAVA_HOME is undefined), youcan avoid spawning multiple daemons by setting JAVA_HOME and the JDK locationto the same path."},{"owner":{"user_id":7589309,"display_name":"Mike"},"edited":false,"comment_id":133134000,"body":"It is fixed (temporarily) by selecting one of the others like &quot;Use embedded LDK version&quot;"}],"answers":[{"owner":{"user_id":10624174,"display_name":"Md Fazle Rabby"},"up_vote_count":0,"is_accepted":false,"creation_date":1676102333,"answer_id":75418828,"body":"<p>Update JAVA_HOME to C:\\Program Files\\Android\\Android Studio\\jbr</p>\n<p>Open File Explorer and Navigate to C:\\Program Files\\Android\\Android Studio\\jbr and copy everything and paste it to C:\\Program Files\\Android\\Android Studio\\jre</p>\n<p>Restart your PC and try to run the project again.</p>\n"}],"owner":{"user_id":20444195,"display_name":"Sezai"},"view_count":756,"up_vote_count":3,"answer_count":1,"score":3,"creation_date":1674045483,"question_id":75159353,"body":"<p>I updated my Android Studio to Electric Eel. The problem is that every time I create a new project, I have to select the correct Gradle JDK from the Gradle of Settings. Otherwise, it gets the wrong JDK path and throws an error. In Dolphin, it was always getting the correct JDK.</p>\n<p>How can I set Android Studio to automatically choice my java home version?</p>\n<p>The other JDK choices are in below. Should I delete others? Or should I give specified location?</p>\n<p><a href=\"https://i.stack.imgur.com/Z0VI6.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Z0VI6.jpg\" alt=\"enter image description here\" /></a></p>\n"},{"tags":["java"],"comments":[{"owner":{"user_id":10942864,"display_name":"Stitt"},"edited":false,"comment_id":134511239,"body":"You are checking if 2300 is before midnight of the <i>same</i> day, hence why its returning false. See this link for more info <a href=\"http://www.java2s.com/Tutorials/Java/java.time/LocalTime/1040__LocalTime.MIDNIGHT.htm\" rel=\"nofollow noreferrer\">java2s.com/Tutorials/Java/java.time/LocalTime/&hellip;</a>  I would suggest checking if the startTime and Endtime have the same date, and if not, it is bleeding over"},{"owner":{"user_id":11521276,"display_name":"thottivelli"},"edited":false,"comment_id":134511341,"body":"I appreciate the answers everyone. I have a better understanding of the same day limitations that LocalTime has. I marked an answer of accepted that accomplished my needs without having to use a LocalDateTime object."},{"owner":{"user_id":869736,"display_name":"Louis Wasserman"},"edited":false,"comment_id":134511427,"body":"<i>All</i> LocalTimes are technically after midnight"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":134516329,"body":"@LouisWasserman Correct (except 00:00 <i>is</i> midnight). Or if talking midnight at the end of the day they are all before midnight since they only go up to 23:59:59.999999999."}],"answers":[{"owner":{"user_id":10118965,"display_name":"davidalayachew"},"up_vote_count":3,"is_accepted":false,"creation_date":1684384537,"answer_id":76277763,"body":"<p>As with all things, when in doubt, check the documentation.</p>\n<p>Here is the documentation for the various parts of your code.</p>\n<ul>\n<li><a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/LocalTime.html#parse(java.lang.CharSequence)\" rel=\"nofollow noreferrer\"><code>LocalTime#parse(String)</code></a></li>\n<li><a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/LocalTime.html#MIDNIGHT\" rel=\"nofollow noreferrer\"><code>LocalTime#MIDNIGHT</code></a></li>\n<li><a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/LocalTime.html#isBefore(java.time.LocalTime)\" rel=\"nofollow noreferrer\"><code>LocalTime#isBefore(LocalTime)</code></a></li>\n</ul>\n<p>The important one is the <code>LocalTime::isBefore</code> method. Look at what it says.</p>\n<p><em>Checks if this time is before the specified time. The comparison is based on the time-line position of the time <strong>within a day</strong>.</em></p>\n<p>That bolded part isn't completely clear, but what that means is that, it is going to ask if <code>23</code> is before <code>0</code> <em><strong>on the same day</strong></em>.</p>\n<p>More specifically, if May 18 23:00 is before May 18 00:00. As you can see, the answer is false because you accidentally asked for the same day.</p>\n<p>You need to use a different tool, likely <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/LocalDateTime.html\" rel=\"nofollow noreferrer\"><code>LocalDateTime</code></a>, to be able to solve this problem. Let me know if you have trouble using that tool instead and I can post an example.</p>\n"},{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":6,"is_accepted":true,"creation_date":1684384577,"answer_id":76277769,"body":"<p>According to the <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/LocalTime.html#isAfter(java.time.LocalTime)\" rel=\"noreferrer\">documentation</a>, for both <code>isBefore</code> and <code>isAfter</code>:</p>\n<blockquote>\n<p>The comparison is based on the time-line position of the time within a day.</p>\n</blockquote>\n<p>These methods assume that the times you are comparing are on the same day, so you cannot use these to check if the period &quot;bleeds into&quot; the second day.</p>\n<p>Assuming a shift must be less than 24 hours, you can check if it &quot;bleeds into&quot; the second day by checking if the end is before the start. This takes advantage of this &quot;assuming the two times are in the same day&quot; characteristic of <code>isBefore</code>. If <code>isBefore</code> thinks that <code>endTime</code> is before <code>startTime</code>, that must mean <code>endTime</code> is in the next day.</p>\n<pre><code>endTime.isBefore(startTime)\n</code></pre>\n"},{"owner":{"user_id":7214091,"display_name":"Gast&#243;n Schabas"},"up_vote_count":3,"is_accepted":false,"creation_date":1684384691,"answer_id":76277780,"body":"<p><code>LocalTime</code> only knows the time. It doesn't know anything about the date. <a href=\"https://docs.oracle.com/javase/8/docs/api/java/time/LocalTime.html#MIDNIGHT\" rel=\"nofollow noreferrer\">LocalTime.MIDNIGHT</a> is <code>The time of midnight at the start of the day, '00:00'.</code>. That's the reason why your code is working like that.</p>\n<pre><code>startTime.isBefore(LocalTime.MIDNIGHT) == false\n</code></pre>\n<p>because <code>23:00</code> is after <code>00:00</code>.</p>\n<p>In the case of</p>\n<pre><code>endTime.isAfter(LocalTime.MIDNIGHT)) == true\n</code></pre>\n<p>because <code>7:00</code> is after <code>00:00</code></p>\n<p>You should consider to use <a href=\"https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html\" rel=\"nofollow noreferrer\">LocalDateTime</a></p>\n"},{"owner":{"user_id":5059698,"display_name":"Leonardo"},"up_vote_count":1,"is_accepted":false,"creation_date":1684384825,"answer_id":76277786,"body":"<p>The behavior you're observing is due to the way the <strong>isBefore</strong> and <strong>isAfter</strong> methods work in the <strong>LocalTime</strong> class in Java.</p>\n<p>In the <strong>LocalTime</strong> class, the <strong>isBefore</strong> method compares the time of day represented by the LocalTime object with another <strong>LocalTime</strong> object. If the time of day is earlier (i.e., occurs chronologically before) the specified <strong>LocalTime</strong>, the <strong>isBefore</strong> method returns true. Conversely, if the time of day is equal to or later than the specified LocalTime, it returns false.</p>\n<p>In your code snippet, you're comparing the <strong>startTime</strong> with <strong>LocalTime.MIDNIGHT</strong>, which represents exactly midnight (00:00). Since the <strong>startTime</strong> is 23:00, it is not chronologically before midnight (00:00), hence the <strong>isBefore</strong> method returns <strong>false</strong>.</p>\n<p>To achieve the desired behavior and check if a shift's start time is before midnight, you can modify your code as follows:</p>\n<pre><code>public boolean checkTime() {\n    final LocalTime startTime = LocalTime.parse(&quot;23:00&quot;);\n    final LocalTime endTime = LocalTime.parse(&quot;07:00&quot;);\n\n    return startTime.isAfter(LocalTime.MIDNIGHT)\n            || endTime.isBefore(LocalTime.MIDNIGHT);\n}\n</code></pre>\n<p>In this modified code, we're using the isAfter method for the startTime check. Since 23:00 is after midnight, the condition will evaluate to true for shifts that start before midnight.</p>\n<p>Similarly, the <strong>endTime</strong> check is using the <strong>isBefore</strong> method to determine if the shift's end time is before midnight. Since 07:00 is after midnight, the condition will evaluate to true for shifts that end after midnight.</p>\n<p>By combining these conditions with an OR <strong>(||)</strong> operator, the method will return <strong>true</strong> if the shift's start or end time bleeds into the next day.</p>\n<p>Remember that <strong>LocalTime</strong> only represents time of day without considering the date component. If you need to handle shifts that span across different dates, you may need to work with <strong>LocalDateTime</strong> or <strong>ZonedDateTime</strong>, which include date and time components.</p>\n"}],"owner":{"user_id":11521276,"display_name":"thottivelli"},"view_count":62,"up_vote_count":2,"accepted_answer_id":76277769,"answer_count":4,"score":2,"creation_date":1684383788,"question_id":76277716,"body":"<p>I am trying to determine if a particular LocalTime is before Midnight. Background basically I want to know if a shift's start/end time bleed over into the next day. For example if a shift was scheduled for 23:00 - 07:00, then this would be considered bleeding into the next day since the end time is after midnight and the start time is before.</p>\n<p>I began to implement this by seeing if the start time is before midnight, and seeing if the end time is after midnight. This would meet the criteria of being overlapping into the next day.</p>\n<p>In Java my code looks like this</p>\n<pre><code>public boolean checkTime() {\n        \n        final LocalTime startTime = LocalTime.parse(&quot;23:00&quot;);\n        final LocalTime endTime = LocalTime.parse(&quot;07:00&quot;);\n\n        return startTime.isBefore(LocalTime.MIDNIGHT) //false\n                &amp;&amp; endTime.isAfter(LocalTime.MIDNIGHT)) //true;\n}\n</code></pre>\n<p>Why does it return false for the start time being not before midnight? Isn't the time of 23:00 one hour before midnight? I would expect this to return true. Maybe I am misunderstanding something? I am working with LocalTimes and not using LocalDateTimes</p>\n"},{"tags":["java","java-8"],"comments":[{"owner":{"user_id":256196,"display_name":"Bohemian"},"edited":false,"comment_id":134055982,"body":"Do you really want a default value? IMHO null would be a reasonable choice if all values are null. Or return an Optional. Thoughts?"},{"owner":{"user_id":21307309,"display_name":"noob555"},"edited":false,"comment_id":134059641,"body":"@Bohemian yes, unfortunately the default value is needed for what i am trying to do"},{"owner":{"user_id":256196,"display_name":"Bohemian"},"edited":false,"comment_id":134060613,"body":"You could pass the default value into the method as the first parameter. That would make for a cleaner implementation and make its behaviour more obvious."}],"answers":[{"owner":{"user_id":1786065,"display_name":"Rogue"},"up_vote_count":0,"is_accepted":false,"creation_date":1681409889,"answer_id":76008640,"body":"<p>Use preconditional checks:</p>\n<pre><code>public Integer getMaxValue(Integer one, Integer two, Integer thr) {\n    //Assign nulls min values, or keep if non-null\n    one = one == null ? Integer.MIN_VALUE : one;\n    two = two == null ? Integer.MIN_VALUE : two;\n    thr = thr == null ? Integer.MIN_VALUE : thr;\n    //perform comparison on non-null values\n    return Math.max(Math.max(one, two), three);\n}\n</code></pre>\n<p>By using <code>Integer.MIN_VALUE</code>, you ensure any other <code>Integer</code> will be greater than (or equal to) the result of the <code>null</code> inputs.</p>\n<p>It should be noted that <code>getMaxValue(null, null, null)</code> in this case would result in a <code>Integer.MIN_VALUE</code>. If you want that case handled, then you could do a precheck for all three being null, and return something else accordingly.</p>\n<p>(Note the streams solutions works well for N inputs, but in this specific case may be overkill).</p>\n"},{"owner":{"user_id":1108305,"display_name":"M. Justin"},"up_vote_count":1,"is_accepted":false,"creation_date":1681410056,"answer_id":76008658,"body":"<p>Here's a one-liner solution that uses <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/package-summary.html\" rel=\"nofollow noreferrer\">streams</a>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Stream.of(value1, value2, value3)\n        .filter(Objects::nonNull)\n        .reduce(Math::max)\n        .orElse(defaultValue);\n</code></pre>\n<p>This creates a <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/stream/Stream.html\" rel=\"nofollow noreferrer\"><code>Stream</code></a> containing the three values, filters out the nulls, calls <code>Math.max</code> on the elements pairwise, returning the given value or <code>defaultValue</code> if all values were null.</p>\n"},{"owner":{"user_id":256196,"display_name":"Bohemian"},"up_vote_count":6,"is_accepted":true,"creation_date":1681410091,"answer_id":76008663,"body":"<p>How about</p>\n<pre><code>public Integer getMaxValue(Integer... numbers) {\n    return Arrays.stream(numbers)\n      .filter(Objects::nonNull)\n      .max(naturalOrder())\n      .orElse(1);\n}\n</code></pre>\n<p>This handles any number of Integers, any or all of which can be null.</p>\n<hr />\n<p>You could convert this to a generic method that returns <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Optional.html\" rel=\"nofollow noreferrer\"><code>Optional&lt;T&gt;</code></a> rather than <code>T</code> since there is no common default value for <code>T</code>.</p>\n<pre><code>public &lt;T extends Comparable&lt;? super T&gt;&gt; Optional&lt;T&gt; getMaxValue(T... numbers) {\n    return Arrays.stream(numbers)\n      .filter(Objects::nonNull)\n      .max(naturalOrder());\n}\n</code></pre>\n"},{"owner":{"user_id":8748083,"display_name":"RobOhRob"},"up_vote_count":3,"is_accepted":false,"creation_date":1681410101,"answer_id":76008665,"body":"<p>I would recommend using Java Streams. They provide a very clean neat way to filter out nulls and return a max value, or default if all of the inputted numbers were null.</p>\n<pre><code>public Integer getMaxValue( Integer value1, Integer value2, Integer value3 ) {\n    Integer defaultValue = 1;\n\n    return Stream.of( value1, value2, value3 ) // create a stream of the values\n            .filter( Objects::nonNull ) // filter out the non-null values\n            .max( Comparator.naturalOrder() ) // grab the max value\n            .orElse( defaultValue ); // if all of the values were null, return the default\n}\n</code></pre>\n"},{"owner":{"user_id":5176992,"display_name":"Eritrean"},"up_vote_count":0,"is_accepted":false,"creation_date":1681411944,"answer_id":76008898,"body":"<p>Another approach by sorting nulls first: Add your values into a list, sort them in natural order and nulls first, check if last element after sorting is null, if yes return default value else return the last value:</p>\n<pre><code>public Integer getMaxValue(Integer... numbers) {\n\n    List&lt;Integer&gt; list = Arrays.asList(numbers);\n    list.sort(Comparator.nullsFirst(Comparator.naturalOrder()));\n\n    return list.get(list.size() - 1) == null ? 1 : list.get(list.size() - 1);\n}\n</code></pre>\n"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":2,"is_accepted":false,"creation_date":1681420160,"answer_id":76009852,"body":"<p>Some good Answers already. Here is a variation if you want <em>both</em> min and max, and you have a small set of data residing in memory.</p>\n<h1>For min <em>and</em> max</h1>\n<p>Define a <a href=\"https://openjdk.org/jeps/395\" rel=\"nofollow noreferrer\">record</a> to hold the result.</p>\n<pre><code>record MinMax( Integer min , Integer max ) { }\n</code></pre>\n<p>Some example data.</p>\n<pre><code>List &lt; Integer &gt; integers = List.of( 7 , 99 , 42 , 3 );\n</code></pre>\n<p>Make a <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Deque.html\" rel=\"nofollow noreferrer\"><code>Deque</code></a> from that list, after (a) skipping nulls, and (b) sorting.</p>\n<pre class=\"lang-java prettyprint-override\"><code>Deque &lt; Integer &gt; deque =\n        integers\n                .stream()\n                .filter( Objects :: nonNull )\n                .sorted()\n                .collect( Collectors.toCollection( ArrayDeque :: new ) );\n</code></pre>\n<p>Pull the first (min) and last (max) from the deque. Construct a <code>MinMax</code> record.</p>\n<pre class=\"lang-java prettyprint-override\"><code>MinMax minMax = new MinMax( deque.peekFirst() , deque.peekLast() );\n</code></pre>\n<p>When run:</p>\n<blockquote>\n<p>minMax.toString() = MinMax[min=3, max=99]</p>\n</blockquote>\n<p>If the input list contains no integers, both fields of <code>MinMax</code> are null.</p>\n<p>If the input list contains 1 integer, both fields of <code>MinMax</code> contain the same number.</p>\n<p>You might want to add a convenience method to your record named something like <code>minEqualsMax</code> to see <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Objects.html#equals(java.lang.Object,java.lang.Object)\" rel=\"nofollow noreferrer\">if both fields have the same number or both are null</a>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>record MinMax( Integer min , Integer max ) \n{ \n    boolean minEqualsMax () { return Objects.equals( min , max ) ; }\n}\n</code></pre>\n<p>We can move our deque code into a static factory method on the record <code>MinMax</code>. We could name this method <code>fromList</code>, but actually, this code works on any <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Collection.html\" rel=\"nofollow noreferrer\"><code>Collection</code></a>. So we name it <code>fromCollection</code>.</p>\n<p>Full class example.</p>\n<pre class=\"lang-java prettyprint-override\"><code>package work.basil.example.minmax;\n\nimport java.util.ArrayDeque;\nimport java.util.Deque;\nimport java.util.List;\nimport java.util.Objects;\nimport java.util.stream.Collectors;\n\npublic record MinMax( Integer min , Integer max )\n{\n    static MinMax fromCollection ( final Collection &lt; Integer &gt; integers )\n    {\n        Deque &lt; Integer &gt; deque =\n                integers\n                        .stream()\n                        .filter( Objects :: nonNull )\n                        .sorted()\n                        .collect( Collectors.toCollection( ArrayDeque :: new ) );\n        return new MinMax( deque.peekFirst() , deque.peekLast() );\n    }\n\n    boolean minEqualsMax ( ) { return Objects.equals( min , max ); }\n}\n</code></pre>\n<p>Now we can write simple code like:</p>\n<pre><code>MinMax minMax = MinMax.fromCollection( List.of( 7 , 99 , 42 , 3 ) ) ;\n</code></pre>\n<p>Demo code.</p>\n<pre class=\"lang-java prettyprint-override\"><code>List &lt; List &lt; Integer &gt; &gt; lists =\n        List.of(\n                List.of( 7 , 99 , 42 , 3 ) ,\n                List.of( 42 ) ,\n                List.of()\n        );\nlists.forEach(\n        list -&gt; System.out.println( MinMax.fromCollection( list ) )\n);\n</code></pre>\n<p>When run:</p>\n<pre class=\"lang-none prettyprint-override\"><code>MinMax[min=3, max=99]\nMinMax[min=42, max=42]\nMinMax[min=null, max=null]\n</code></pre>\n<p>Caveat: Sorting is expensive if you have a very large number of elements, or if the elements are not all loaded into memory. For those cases, do not use the approach of this Answer. But for common cases such as processing line items on an invoice, this approach is reasonable.</p>\n"}],"owner":{"user_id":21307309,"display_name":"noob555"},"view_count":152,"up_vote_count":2,"accepted_answer_id":76008663,"answer_count":6,"score":2,"creation_date":1681409639,"question_id":76008610,"body":"<p>I am wondering if there a better, short and elegant way to achieve this than what i am trying. Let's say i have 3 Integers(value1, value2, value3) and i want to find max value out of those Integers and null values are allowed for them. I cannot use below code because it could throw NullPointerException:</p>\n<pre><code>Math.max(Math.max(value1, value2), value3)\n</code></pre>\n<p>I have written a barbaric code(shown below) but it won't scale for more than 3 integers:</p>\n<pre><code>public Integer getMaxValue(Integer value1, Integer value2, Integer value3) {\n\n    Integer defaultValue = 1;\n\n    if (value1 == null &amp;&amp; value2 == null &amp;&amp; value3 == null) {\n        return defaultValue;\n    } else if (value1 == null &amp;&amp; value2 != null &amp;&amp; value3 != null) {\n        return Math.max(value2, value3);\n    } else if (value2 == null &amp;&amp; value1 != null &amp;&amp; value3 != null) {\n        return Math.max(value1, value3);\n    } else if (value3 == null &amp;&amp; value1 != null &amp;&amp; value2 != null) {\n        return Math.max(value1, value2);\n    } else if (value1 == null &amp;&amp; value2 == null) {\n        return value3;\n    } else if (value2 == null &amp;&amp; value3 == null) {\n        return value1;\n    } else if (value1 == null &amp;&amp; value3 == null) {\n        return value2;\n    } else {\n        return Math.max(Math.max(value1, value2), value3);\n    }\n}\n</code></pre>\n"},{"tags":["java","java-stream","reduce","reduction"],"comments":[{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132370152,"body":"Streams are meant for stateless operations. The maximum difference in a list is not a stateless operation. What you want is not possible (well... it is, but is against the idea of streams and most probably slower than an imperative approauch). The easiest way to solve this with streams is most probably to determine the <code>min()</code> and <code>max()</code> of the list, and subtract the <code>min()</code> from the <code>max()</code>."},{"owner":{"user_id":2846138,"display_name":"cyberbrain"},"edited":false,"comment_id":132370206,"body":"as <code>max</code> and <code>min</code> are already specialized methods of <code>reduce</code>, are you searching for their non-terminal implementation?"},{"owner":{"user_id":4469165,"display_name":"Andy"},"edited":false,"comment_id":132370412,"body":"@cyberbrain - actually I was searching for a customized accumulator and combiner for the reduce(U identity, BiFunction&lt;U,? super T,U&gt; accumulator, BinaryOperator&lt;U&gt; combiner) method. But I doubt, like Turing85 stated, that there is a practicable and performant solution."}],"answers":[{"owner":{"user_id":5176992,"display_name":"Eritrean"},"up_vote_count":9,"is_accepted":false,"creation_date":1672860463,"answer_id":75010350,"body":"<p>You can avoid streaming over the list twice by using the teeing collector:</p>\n<pre><code>double diff = list.stream()\n                  .collect(Collectors.teeing(\n                          Collectors.reducing(Double::max),\n                          Collectors.reducing(Double::min),\n                          (max,min) -&gt; max.get() - min.get()));\n</code></pre>\n<p>Or using summaryStatistics</p>\n<pre><code>DoubleSummaryStatistics statistics = list.stream()\n                                         .mapToDouble(Double::doubleValue)\n                                         .summaryStatistics();\ndouble diff = statistics.getMax() - statistics.getMin();\n</code></pre>\n"},{"owner":{"user_id":12125351,"display_name":"wannaBeDev"},"up_vote_count":1,"is_accepted":false,"creation_date":1672862076,"answer_id":75010624,"body":"<p>For small list you could possibly make a Cartesian product of the list with itself and calculate the difference of every combination before reducing:</p>\n<pre><code>double maxDiff = list.stream()\n                     .flatMap(a -&gt; list.stream().map(b -&gt; a - b))\n                     .reduce(Double::max)\n                     .get();\nSystem.out.println(maxDiff);\n</code></pre>\n"}],"owner":{"user_id":4469165,"display_name":"Andy"},"view_count":62,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1672858811,"question_id":75010049,"body":"<p>I am searching for a suitable stream-based reduction operation to find the maximum difference of a double-list. (Please no solutions with old-style nested for-loops...)</p>\n<p>Lets say my double list is<br />\n<code>List&lt;Double&gt; list = List.of(1.1, 0.3, 7.8, 1.0, 9.1, 2.3);</code><br />\nthen the maximum difference would result to the value<br />\n<code>9.1 - 0.3 = 8.8</code><p><br />\nMy first working approach with the use of java-streams is:</p>\n<pre><code>List&lt;Double&gt; list = List.of(1.1, 0.3, 7.8, 1.0, 9.1, 2.3);\ndouble maxDiff = list.stream().max(Double::compareTo).get()\n    - list.stream().min(Double::compareTo).get();\n</code></pre>\n<p><strong>How to implement a custom accumulator and combiner for the reduction operation <strong><code>Stream.reduce()</code></strong> to achieve the same?</strong></p>\n"},{"tags":["java","scala","generics","variance"],"comments":[{"owner":{"user_id":2970947,"display_name":"Elliott Frisch"},"edited":false,"comment_id":132727189,"body":"Scala was implemented after Java; why would you expect extra flexibility in the earlier language? In fact, Java generics were implemented as compile time type safety and are erased at runtime (to be fair, a bridge method is also generated and inserted)."},{"owner":{"user_id":978917,"display_name":"ruakh"},"edited":false,"comment_id":132727265,"body":"@ElliottFrisch: Bridge methods are only generated in fairly special circumstances (see <a href=\"https://docs.oracle.com/javase/tutorial/java/generics/bridgeMethods.html\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/tutorial/java/generics/&hellip;</a>), though there are also plenty of other situations where generics aren&#39;t fully erased (see <a href=\"https://softwareengineering.stackexchange.com/questions/280169/if-scala-runs-on-the-jvm-how-can-scala-do-things-that-java-seemingly-cannot/280189#280189\" title=\"if scala runs on the jvm how can scala do things that java seemingly cannot\">softwareengineering.stackexchange.com/questions/280169/&hellip;</a>)."},{"owner":{"user_id":5249621,"display_name":"Dmytro Mitin"},"edited":false,"comment_id":132727578,"body":"@IgorUrisman In Scala you could also have invariant <code>trait Function[T, R]</code> and declare variance at a call site <code>type VarFunction[-T, +R] = Function[_ &gt;: T, _ &lt;: R]</code> like in Java <a href=\"https://stackoverflow.com/questions/75035824/in-scala3-if-generic-type-arguments-is-mapped-to-dependent-type-how-are-cova\" title=\"in scala3 if generic type arguments is mapped to dependent type how are cova\">stackoverflow.com/questions/75035824/&hellip;</a> So there is no extra flexibility in Java."}],"answers":[{"owner":{"user_id":978917,"display_name":"ruakh"},"up_vote_count":2,"is_accepted":false,"creation_date":1674517860,"answer_id":75216220,"body":"<blockquote>\n<p>In other words, does Java's way offer useful extra flexibility not found in Scala, or is it just a lot of repetitive unwieldy boilerplate?</p>\n</blockquote>\n<p>Suppose that class <code>Foo</code> extends class <code>Parent</code> and is in turn extended by class <code>Child</code>.</p>\n<p>Then, as you know, we can pass an instance of <code>ArrayList&lt;Foo&gt;</code> to a method that takes a <code>List&lt;? extends Parent&gt;</code>, or to a method that takes a <code>List&lt;? super Child&gt;</code>.</p>\n<p>A reason that a method might take <code>List&lt;? extends Parent&gt;</code> is if it only reads from the list (it never writes to it), and can happily support any element that's an instance of <code>Parent</code> (because it doesn't need anything specific to <code>Foo</code> or another subtype).</p>\n<p>A reason that a method might take <code>List&lt;? super Child&gt;</code> is if it only writes to the list (it never reads from it), and the elements that it writes are always instances of <code>Child</code> (so it doesn't care whether the list can accept arbitrary instance of <code>Foo</code> or another supertype).</p>\n<p>That said, yes, it <em>is</em> a lot of repetitive unwieldy boilerplate! As a result, it's not uncommon to come across a method that <em>could</em> take a <code>List&lt;? extends Parent&gt;</code> or a <code>List&lt;? super Child&gt;</code> but instead just takes a <code>List&lt;Parent&gt;</code> or a <code>List&lt;Child&gt;</code> (respectively).</p>\n"},{"owner":{"user_id":21069312,"display_name":"Reza"},"up_vote_count":1,"is_accepted":false,"creation_date":1674518028,"answer_id":75216233,"body":"<p>I am not an expert on this but it can be argued that the use of wildcard capture syntax in Java's Function interface allows for more flexibility in expressing variance relationships compared to Scala's Function1 trait, where variance is inherent in the type. The wildcard capture syntax allows for variance to be declared specifically in the context of a method's parameter or return type, rather than being inherent to the type itself. However, it can also be seen as repetitive and unwieldy boilerplate. It depends on the perspective of the developer and their use case.</p>\n"},{"owner":{"user_id":2288659,"display_name":"Silvio Mayolo"},"up_vote_count":4,"is_accepted":false,"creation_date":1674519128,"answer_id":75216313,"body":"<p>For <code>Function</code> specifically, no. <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html\" rel=\"nofollow noreferrer\"><code>Function</code></a> defines exactly one abstract method, <code>apply</code>, which uses <code>T</code> contravariantly and <code>R</code> covariantly. But <code>Function</code> isn't what they had in mind when they designed that feature.</p>\n<p>When the Java devs designed call-site variance, they were imagining classes that had <em>both</em> covariant and contravariant uses. For instance, in principle, the <code>E</code> in <code>List&lt;E&gt;</code> must be invariant. It appears in covariant position in <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/List.html#get-int-\" rel=\"nofollow noreferrer\"><code>get</code></a> and in contravariant position in <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/List.html#add-E-\" rel=\"nofollow noreferrer\"><code>add</code></a>.</p>\n<p>So the rationale was this. Suppose we have a type hierarchy <code>X &lt;= Y &lt;= Z</code>. That is, <code>X</code> is a class that subclasses <code>Y</code>, and <code>Y</code> in turn subclasses <code>Z</code>. A <code>List&lt;Y&gt;</code> can do anything with type <code>Y</code>. It can have <code>Y</code>s added to the end, and a user can retrieve elements of type <code>Y</code> from it. But it can never be a <code>List&lt;Z&gt;</code> or a <code>List&lt;X&gt;</code>, since adding to a <code>List&lt;X&gt;</code> would be unsound, and so would retrieving as a <code>List&lt;Z&gt;</code>.</p>\n<p>But we can express our intention. <code>List&lt;? extends Y&gt;</code> is a type we can only ever read from. It actually <em>can</em> take a <code>List&lt;Z&gt;</code> under the hood, since a list of <code>Z</code> elements is genuinely still (at least for covariant methods) a list of <code>Y</code> elements. We can get elements from this list, but we can't add to the end of it, since we said we're using the type argument in covariant position but <code>add</code> uses the type argument contravariantly. Essentially, <code>List&lt;? extends Y&gt;</code> is a smaller interface that includes some of the methods from the <em>actual</em> interface <code>List</code>.</p>\n<p>The same is true of <code>List&lt;? super Y&gt;</code>. We can't read from it, since we don't know that every element is of type <code>Y</code>. But we can add to it, since we know that the list at least <em>supports</em> elements of type <code>Y</code>. We can use all of the contravariant methods, like <code>add</code>, but none of the covariant ones.</p>\n<p>For a type like <code>List</code> that uses its type arguments in different ways, the call-site variance makes some amount of sense. For a special-purpose interface like <code>Function</code> that does one thing, it makes little sense.</p>\n<p>That was the Java developers' rationale some twenty years ago when generics were added to Java. A lot has happened since then. If someone wrote an interface like <code>List</code> in today's world, an interface with upwards of 20 abstract methods, half of which have &quot;this method may not be supported and might just throw <code>UnsupportedOperationException</code>&quot; <em>built-in</em> to the contract, they'd rightly be laughed off the stage.</p>\n<p>Today's world is one of small, tight interfaces. We follow the SOLID principles. An interface does one thing and does it well. If an interface defines more than two or three (non-defaulted, non-inherited) methods, we give pause and ask if we can make it more modular. And we try to design systems that are more immutable by design, to support scaling and concurrency. We have <code>record</code>s, or <code>data class</code>es or whatever your favorite language calls them, that are immutable by default.</p>\n<p>So twenty years ago, the idea of a massive super-interface that does twenty things and that can be narrowed down dynamically via type projections seemed pretty cool. Today, it makes far more sense to specify the variance at the declaration site, since most interfaces are small and have a clear use case in mind.</p>\n<p>The <a href=\"https://www.scala-lang.org/api/current/scala/collection/Seq.html\" rel=\"nofollow noreferrer\"><code>scala.collection.Seq</code></a> trait defines three abstract, non-inherited methods (<code>apply</code>, <code>iterator</code>, and <code>length</code>), and all of those use the type argument covariantly, so <code>Seq</code> is defined with a covariant type. The <a href=\"https://www.scala-lang.org/api/current/scala/collection/mutable/Seq.html\" rel=\"nofollow noreferrer\">corresponding mutable trait</a> adds one more method (<code>update</code>), which uses its type argument contravariantly, so it has an invariant argument.</p>\n<p>In Scala, if you want to modify a sequence, you take a <code>scala.collection.mutable.Seq</code>. If you want to read, you take a <code>scala.collection.Seq</code>. And those interfaces are small enough and narrow enough in purpose that the fact that there are several of those doesn't affect the code quality (and the fact that traits and classes in Scala are cheap to write, compared to the boilerplate necessary in Java to make even a simple class).</p>\n"},{"owner":{"user_id":183406,"display_name":"meriton"},"up_vote_count":2,"is_accepted":true,"creation_date":1674523653,"answer_id":75216658,"body":"<p>Actually, Scala supports both declaration and use site variance. Specifically, you can <a href=\"https://docs.scala-lang.org/scala3/reference/changed-features/wildcards.html\" rel=\"nofollow noreferrer\">specify bounded wildcards just like in Java</a>.</p>\n<p>This already hints that declaration site variance can not replace use site variance in all cases. The reason is that a declaration can only be variant if it is variant in all possible uses. If some uses are variant, but other uses are not, we can't use declaration site variance, but we can use use site variance.</p>\n<p>For instance, class <code>Array[A]</code> can not be declared variant, but the method <a href=\"https://www.scala-lang.org/api/2.13.3/scala/collection/ArrayOps.html\" rel=\"nofollow noreferrer\">appendedAll from ArrayOps</a> can employ use site variance</p>\n<pre><code>def appendedAll[B &gt;: A](suffix: Array[_ &lt;: B])(implicit arg0: ClassTag[B]): Array[B]\n</code></pre>\n<p>since it uses covariant methods of <code>suffix</code>.</p>\n"}],"owner":{"user_id":6357920,"display_name":"Igor Urisman"},"view_count":130,"up_vote_count":3,"accepted_answer_id":75216658,"answer_count":4,"score":2,"creation_date":1674517032,"question_id":75216147,"body":"<p>In a modern functional language like Scala, type variance is inherent in the type. Here's e.g. Scala's <code>Function1</code>:</p>\n<pre><code>trait Function1[-T1, +R] { ... }\n</code></pre>\n<p>contravariant in parameter type and covariant in return type. And here's java's counterpart:</p>\n<pre><code>interface Function&lt;T,R&gt; { ... }\n</code></pre>\n<p>Now, to express variance relationship, the &quot;wildcard capture&quot; special syntax is used. For example, the stream's <code>map</code> function is declared as</p>\n<pre><code>&lt;R&gt; Stream&lt;T&gt; map(Function&lt;? super T, ? extends R&gt; mapper);\n</code></pre>\n<p>Here, Java shifts the declaration of variance relationship from the type itself to its use as a param in some method signature.</p>\n<p>Here's my question. Would I be amiss to say that there cannot be any legitimate usages of <code>Function&lt;T,R&gt;</code> that are not contravariant in T and covariant in R? In other words, does Java's way offer useful extra flexibility not found in Scala, or is it just a lot of repetitive unwieldy boilerplate?</p>\n"},{"tags":["java","java-io","java-nio"],"comments":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":134064002,"body":"What do you mean by &quot;at the same time&quot;? Concurrency? Or do you just want to read the input stream once?"},{"owner":{"user_id":3227319,"display_name":"Jordi"},"edited":false,"comment_id":134064064,"body":"Some kind of chaining... I need to store inputstream to a file, but I&#39;d like to calculate checksum since inputstream is being read... At the end, I need checksum and a file stored. Yes I want to read input stream once."}],"answers":[{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"up_vote_count":5,"is_accepted":false,"creation_date":1681464814,"answer_id":76013607,"body":"<p>You can use the <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/security/DigestInputStream.html\" rel=\"nofollow noreferrer\"><code>DigestInputStream</code></a> to calculate a hash while reading from a stream. That is, you wrap the original input stream with a <code>DigestInputStream</code> and read through the <code>DigestInputStream</code>. While reading the data, the message digest is automatically updated, and you can retrieve the digest after you read the entire stream.</p>\n<p>Alternatively, you can use <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/security/DigestOutputStream.html\" rel=\"nofollow noreferrer\"><code>DigestOutputStream</code></a> to calculate a hash while writing to a stream.  In a similar vein, you wrap the destination output stream with a <code>DigestOutputStream</code> and write through the <code>DigestOutputStream</code>.</p>\n<p>A quick and dirty example:</p>\n<pre class=\"lang-java prettyprint-override\"><code>var inputFile = Path.of(&quot;D:\\\\Development\\\\data\\\\testdata-csv\\\\customers-1000.csv&quot;);\nvar outputFile = Files.createTempFile(&quot;testoutput&quot;, &quot;.dat&quot;);\nvar md = MessageDigest.getInstance(&quot;SHA-256&quot;);\ntry (var in = new DigestInputStream(Files.newInputStream(inputFile), md);\n     var out = Files.newOutputStream(outputFile)) {\n    in.transferTo(out);\n} finally {\n    Files.deleteIfExists(outputFile);\n}\n\nSystem.out.println(HexFormat.of().formatHex(md.digest()));\n</code></pre>\n<p>In terms of your existing code, you could do something like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public String transferAndHash(InputStream in) throws IOException {\n    try {\n        var md = MessageDigest.getInstance(&quot;SHA-256&quot;);\n        try (var digestIn = new DigestInputStream(in, md)) {\n            transferTo(digestIn);\n        }\n        return HexFormat.of().formatHex(md.digest());\n    } catch (NoSuchAlgorithmException e) {\n        // all recent Java versions are required to support SHA-256\n        throw new AssertionError(&quot;Expected SHA-256 to be supported&quot;, e);\n    }\n}\n</code></pre>\n<p>(NOTE: <code>HexFormat</code> was introduced in Java 17, if you're using an earlier version, you'll need an alternative.)</p>\n"},{"owner":{"user_id":2705702,"display_name":"Keijack"},"up_vote_count":1,"is_accepted":false,"creation_date":1681467038,"answer_id":76013971,"body":"<p>If you want to read the input stream once, you might manual read the bytes from the input string and write it to you file by yourself.</p>\n<pre><code>    private static final String SHA_256 = &quot;SHA-256&quot;;\n    private static final int BUFFER = 1024;\n\n    public String writeToFile(InputStream fis, File outputFile) throws IOException {\n        try (var fout = new FileOutputStream(outputFile); fis) {\n            MessageDigest md5Digest = MessageDigest.getInstance(SHA_256);\n            var buffer = new byte[BUFFER];\n            var bytesRead = 0;\n            while (true) {\n                bytesRead = fis.read(buffer);\n                if (bytesRead &lt; 0)\n                    break;\n                md5Digest.update(buffer, 0, bytesRead);\n                fout.write(buffer, 0, bytesRead);\n            }\n            var checksume = md5Digest.digest();\n            return Hex.encodeHexString(checksume);\n        } catch (NoSuchAlgorithmException e) {\n            return &quot;KO&quot;;\n        }\n    }\n</code></pre>\n"},{"owner":{"user_id":6028807,"display_name":"Miss Chanandler Bong"},"up_vote_count":2,"is_accepted":true,"creation_date":1681467919,"answer_id":76014100,"body":"<p>Here is an example using <code>DigestInputStream</code> based on <a href=\"https://stackoverflow.com/users/466862/mark-rotteveel\">Mark Rotteveel</a>'s suggestion (which I liked):</p>\n<pre class=\"lang-java prettyprint-override\"><code>Path input = Paths.get(&quot;input_file&quot;);\nPath output = Paths.get(&quot;output_file&quot;);\nMessageDigest algorithm = MessageDigest.getInstance(&quot;SHA-256&quot;);\ntry (InputStream is = Files.newInputStream(input);\n     DigestInputStream hashingStream = new DigestInputStream(is, algorithm)) {\n    Files.copy(hashingStream, output);\n}\nbyte[] digest = algorithm.digest();\n// this line uses Apache Commons Codec to show the hex representation of the byte[]\nString hash = Hex.encodeHexString(digest);\n</code></pre>\n"}],"owner":{"user_id":3227319,"display_name":"Jordi"},"view_count":92,"up_vote_count":2,"accepted_answer_id":76014100,"answer_count":3,"score":2,"creation_date":1681464005,"question_id":76013476,"body":"<p>Here are my two code snippets:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Uploader {\n\n  private static final String SHA_256 = &quot;SHA-256&quot;;\n\n  public String getFileSHA2Checksum(InputStream fis) throws IOException {\n    try {\n      MessageDigest md5Digest = MessageDigest.getInstance(SHA_256);\n      return getFileChecksum(md5Digest, fis);\n    } catch (NoSuchAlgorithmException e) {\n      return &quot;KO&quot;;\n    }\n  }\n\n  public void transferTo(InputStream fis) throws IOException {\n    FileUtils.copyInputStreamToFile(fis, file2);\n  }\n</code></pre>\n<p>My code uses this class as:</p>\n<p>Is it possible to <code>copyToFile</code> and <code>calculateChecksum</code> at the same time leveraging <code>InputStream</code> is open?</p>\n"},{"tags":["java","java-stream"],"answers":[{"owner":{"user_id":22656,"display_name":"Jon Skeet"},"up_vote_count":3,"is_accepted":false,"creation_date":1679409943,"answer_id":75802678,"body":"<p>Firstly, I wouldn't expect <code>(char) c + 1</code> to work anyway, as that doesn't cast the <em>result</em> to <code>char</code>. It only casts <code>c</code> to <code>char</code>. You really wanted <code>.map(c -&gt; (char) (c + 1))</code>.</p>\n<p>However, that <em>still</em> results in an <code>IntStream</code>, because there's no such type as &quot;a stream of characters&quot;. <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/String.html#chars()\" rel=\"nofollow noreferrer\"><code>String.chars()</code></a> returns an <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/stream/IntStream.html\" rel=\"nofollow noreferrer\"><code>IntStream</code></a>, and your call to <code>IntStream.map</code> resolves to <code>IntStream map​(IntUnaryOperator mapper)</code>.</p>\n<p>Basically what you <em>want</em> is a <code>CharStream</code> type (like <code>IntStream</code> but for <code>char</code>) - but that doesn't exist.</p>\n"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":5,"is_accepted":true,"creation_date":1679411077,"answer_id":75802907,"body":"<p>As to <em>why</em> you have the problem, see the <a href=\"https://stackoverflow.com/a/75802678/642706\">Answer by Jon Skeet</a>.</p>\n<p>You can avoid the entire problem easily by using <a href=\"https://en.m.wikipedia.org/wiki/Code_point\" rel=\"nofollow noreferrer\">code point</a> integers rather than the broken legacy type <code>char</code>.</p>\n<p>Furthermore, your code fails with most characters.  Again, solved by using code points.</p>\n<h1>Code point, not <code>char</code></h1>\n<p>The <code>char</code> type has been essentially broken since Java 2, and legacy since Java 5. As a 16-bit value, the <code>char</code> is physically incapable of representing most of the over 149,000 characters defined in <a href=\"https://en.m.wikipedia.org/wiki/Unicode\" rel=\"nofollow noreferrer\">Unicode</a>.</p>\n<p>While <code>char</code> is limited to a range of 0 to just over 65,000, code points range from zero to just over a million. Most of that range is not yet assigned, and some is set aside permanently for private use.</p>\n<p>Let’s modify your code:</p>\n<ul>\n<li>Replace your <code>.chars</code> call with <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html#codePoints()\" rel=\"nofollow noreferrer\"><code>.codePoints</code></a>.</li>\n<li>Call <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/StringBuilder.html#appendCodePoint(int)\" rel=\"nofollow noreferrer\"><code>appendCodePoint</code></a> instead of that first <code>append</code>.</li>\n</ul>\n<p>Voilà, no more casting confusion.</p>\n<pre class=\"lang-java prettyprint-override\"><code>String s =\n    &quot;abdc&quot;\n    .codePoints()  // Returns an `IntStream` object. \n    .map( codePoint -&gt; codePoint + 1 )\n    .collect( \n        StringBuilder::new , \n        StringBuilder::appendCodePoint , \n        StringBuilder::append \n    )              // Returns a `StringBuilder` object. \n    .toString() ;\n</code></pre>\n<p>See this code run <a href=\"https://ideone.com/LL7P6E\" rel=\"nofollow noreferrer\">at Ideone.com</a>.</p>\n<blockquote>\n<p>bced</p>\n</blockquote>\n"},{"owner":{"user_id":1831987,"display_name":"VGR"},"up_vote_count":0,"is_accepted":false,"creation_date":1679411778,"answer_id":75803064,"body":"<p>The <code>+</code> operator will always produce an int (or float or double, if any operand is float or double).  This is because both operands are promoted to int values (or long values, if either operand is already a long).</p>\n<p>So, your first attempt, <code>c -&gt; (char)c + 1</code>, is really doing this:</p>\n<pre><code>c -&gt; (int) ((char) c) + 1\n</code></pre>\n<p>because that’s how numeric promotion works.</p>\n<p>Your second attempt’s outcome is due to the fact that <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/String.html#chars()\" rel=\"nofollow noreferrer\">String.chars() returns an IntStream</a>.  When you do <code>map(c1 -&gt; (char)c1)</code> you are actually calling the <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/stream/IntStream.html#map(java.util.function.IntUnaryOperator)\" rel=\"nofollow noreferrer\">map method of IntStream</a>, whose argument is an IntUnaryOperator.  Thus, the lambda's returned value (<code>(char)c1</code>) is promoted to int.</p>\n<p>Using <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/stream/IntStream.html#mapToObj(java.util.function.IntFunction)\" rel=\"nofollow noreferrer\">mapToObj</a> would probably work, though you’d be creating java.lang.Character instances which would have less than ideal efficiency.</p>\n<p>Your final attempt works because you are explicitly appending a char value, so it doesn’t matter whether it was an int in the stream.</p>\n<p>Basil is right: working with code points is better than char values, both because it removes ambiguity and because the char type is not able to represent all valid Unicode characters.</p>\n"}],"owner":{"user_id":2908871,"display_name":"hughj"},"view_count":127,"up_vote_count":2,"accepted_answer_id":75802907,"answer_count":3,"score":2,"creation_date":1679409098,"question_id":75802528,"body":"<p>java.util.stream is challenging my notion of chars.  I am attempting to perform a simple character rotation of a string, where I simply add 1 to the int value of each character.  I start with &quot;abcd&quot;.chars() (a stream), and then I map.  But I don't seem to be able to cast the ints -&gt; char during the map.  Why am I not getting the desired result?</p>\n<p>This is vanilla JDK17 (temurin).</p>\n<pre><code>    jshell&gt; &quot;abdc&quot;.chars().map(c -&gt; c + 1).collect(StringBuilder::new, StringBuilder::append, StringBuilder::append)\n$43 ==&gt; 9899101100\n</code></pre>\n<p>Wait; thats not what I want.  These are the int values! Let's try a cast to char:</p>\n<pre><code>jshell&gt; &quot;abdc&quot;.chars().map(c -&gt; (char)c + 1).collect(StringBuilder::new, StringBuilder::append, StringBuilder::append)\n$44 ==&gt; 9899101100\n</code></pre>\n<p>Ok, that had zero effect.  Let's use an explicit map step:</p>\n<pre><code>jshell&gt; &quot;abdc&quot;.chars().map(c -&gt; c + 1).map(c1 -&gt; (char)c1).collect(StringBuilder::new, StringBuilder::append, StringBuilder::append)\n$45 ==&gt; 9899101100\n</code></pre>\n<p>Huh? wtf?  Ok, let's force the cast during the reduce step:</p>\n<pre><code>jshell&gt; &quot;abcd&quot;.chars().map(c -&gt; c + 1).collect(()-&gt;new StringBuilder(), (c,d)-&gt;c.append((char)d), (c1, c2)-&gt;c1.append(c2))\n$46 ==&gt; bcde\n</code></pre>\n<p>Finally!  But WHY?  Why doesn't the map to char flow across the stream?  What am I missing?  I know this is a newbie question, but I would appreciate being educated.</p>\n"},{"tags":["java","sorting","collections"],"comments":[{"owner":{"user_id":16320675,"display_name":"user16320675"},"edited":false,"comment_id":132845056,"body":"I would add a <code>getSpread()</code> (or <code>calcSoread()</code>) method to <code>Quotation</code> and sort by that. (kind of <code>sort(sortedBySpread, Comparator.comparingInt(Quotation::getSpread)</code>)"},{"owner":{"user_id":1531124,"display_name":"GhostCat"},"edited":false,"comment_id":132845360,"body":"Err, what happens when the delta between those two fields isn&#39;t a valid int? What is the point to use BigDecimal, when you then rely on such an errorprone way to substract them? (BigDecimal has a <code>subtract</code> method for example ... if you are worried about the overhead, why not compute that value when building the quotation objects)?"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"edited":false,"comment_id":132854125,"body":"By the way, reduce code as a <a href=\"https://openjdk.org/jeps/395\" rel=\"nofollow noreferrer\">record</a>: <code>public record Quotation ( long id , BigDecimal askPrice , BigDecimal bidPrice ) {}</code>"}],"answers":[{"owner":{"user_id":2442804,"display_name":"luk2302"},"up_vote_count":4,"is_accepted":true,"creation_date":1675081449,"answer_id":75284332,"body":"<p><code>Collections.sort(sortedBySpread, (a, b) -&gt; (a.getBidPrice().intValue() - b.getAskPrice().intValue()));</code> does some math that makes little since since it subtracts the ask from the bid of two different quotes.</p>\n<p>Instead you should calculate the spread of <code>a</code> and then subtract the spread of <code>b</code>:</p>\n<pre><code>Collections.sort(sortedBySpread, (a, b) -&gt; (a.getBidPrice().intValue() - a.getAskPrice().intValue()) - (b.getBidPrice().intValue() - b.getAskPrice().intValue()));\n</code></pre>\n<p>Generally this could be expanded into the following to make it more clear what is going on:</p>\n<pre><code>Collections.sort(sortedBySpread, (Quotation a, Quotation b) -&gt; {\n    int spreadA = a.getBidPrice().intValue() - a.getAskPrice().intValue();\n    int spreadB = b.getBidPrice().intValue() - b.getAskPrice().intValue();\n    return spreadA - spreadB;\n});\n</code></pre>\n<p>But starting with the first snippet IntelliJ suggest the arguably far cleaner solution</p>\n<pre><code>Collections.sort(sortedBySpread, Comparator.comparingInt(a -&gt; (a.getBidPrice().intValue() - a.getAskPrice().intValue())));\n</code></pre>\n<p>And going from there it might make sense to have a <code>getSpread</code> on <code>Quotation</code>:</p>\n<pre><code>public int getSpread() {\n    return bidPrice.intValue() - askPrice.intValue();\n}\n</code></pre>\n<p>which would then allow</p>\n<pre><code>Collections.sort(sortedBySpread, Comparator.comparingInt(Quotation::getSpread));\n</code></pre>\n<p>And finally</p>\n<pre><code>sortedBySpread.sort(Comparator.comparingInt(Quotation::getSpread));\n</code></pre>\n<p>without the need for <code>Collections.sort</code>.</p>\n"},{"owner":{"user_id":1552534,"display_name":"WJS"},"up_vote_count":4,"is_accepted":false,"creation_date":1675083138,"answer_id":75284663,"body":"<p>For demo, I put your values in a list.  I also added the following to your class.</p>\n<pre><code>public BigDecimal getSpread() {\n       return askPrice.subtract(bidPrice);\n}\npublic String toString() {\n       return &quot;id - %d    bid - %6.2f     ask - %6.2f     spread - %6.2f&quot;.formatted(id, bidPrice, askPrice,getSpread());   \n}\n</code></pre>\n<p><strong>The data</strong></p>\n<pre><code> List&lt;Quotation&gt; quotes = new ArrayList&lt;&gt;(List.of(\n   (new Quotation(1000,new BigDecimal(&quot;99&quot;), new BigDecimal(&quot;104&quot;))),\n   (new Quotation(1001,new BigDecimal(&quot;69&quot;), new BigDecimal(&quot;72&quot;))),\n   (new Quotation(1002,new BigDecimal(&quot;65&quot;), new BigDecimal(&quot;69&quot;))),\n   (new Quotation(1003,new BigDecimal(&quot;70&quot;), new BigDecimal(&quot;71&quot;))),\n   (new Quotation(1004,new BigDecimal(&quot;71&quot;), new BigDecimal(&quot;73&quot;))),\n   (new Quotation(1005,new BigDecimal(&quot;90&quot;), new BigDecimal(&quot;95&quot;))),\n   (new Quotation(1006,new BigDecimal(&quot;92&quot;), new BigDecimal(&quot;93&quot;))),\n   (new Quotation(1007,new BigDecimal(&quot;94&quot;), new BigDecimal(&quot;98&quot;))),\n   (new Quotation(1008,new BigDecimal(&quot;90&quot;), new BigDecimal(&quot;92&quot;))),\n   (new Quotation(1009,new BigDecimal(&quot;92&quot;), new BigDecimal(&quot;95&quot;)))));\n</code></pre>\n<p>The sorting part is simple.  Just use a comparator, referencing the spread.</p>\n<pre><code>quotes.sort(Comparator.comparing(Quotation::getSpread));\n</code></pre>\n<p><strong>And print</strong></p>\n<pre><code>for(Quotation q : quotes) {\n    System.out.println(q);\n} \n</code></pre>\n<p><strong>Prints</strong></p>\n<pre><code>id - 1003    bid -  70.00     ask -  71.00     spread -   1.00\nid - 1006    bid -  92.00     ask -  93.00     spread -   1.00\nid - 1004    bid -  71.00     ask -  73.00     spread -   2.00\nid - 1008    bid -  90.00     ask -  92.00     spread -   2.00\nid - 1001    bid -  69.00     ask -  72.00     spread -   3.00\nid - 1009    bid -  92.00     ask -  95.00     spread -   3.00\nid - 1002    bid -  65.00     ask -  69.00     spread -   4.00\nid - 1007    bid -  94.00     ask -  98.00     spread -   4.00\nid - 1000    bid -  99.00     ask - 104.00     spread -   5.00\nid - 1005    bid -  90.00     ask -  95.00     spread -   5.00\n\n      \n</code></pre>\n"}],"owner":{"user_id":5564060,"display_name":"Anatolii"},"view_count":64,"up_vote_count":2,"accepted_answer_id":75284332,"answer_count":2,"score":2,"creation_date":1675081093,"question_id":75284279,"body":"<p>Please help with sorting in Java. I have a simple example (looks like this).\nI need to sort list by the difference between two BigDecimals.</p>\n<p>My Data class (I cut getters)</p>\n<pre><code>    public class Quotation {\n    private final long id;\n    private final BigDecimal askPrice;\n    private final BigDecimal bidPrice;\n\n    public Quotation(long id, BigDecimal bidPrice, BigDecimal askPrice) {\n        this.id = id;\n        this.askPrice = askPrice;\n        this.bidPrice = bidPrice;\n    }\n    }\n</code></pre>\n<p>Here we store our records.</p>\n<pre><code>        storeQuotation(new Quotation(1000,new BigDecimal(&quot;99&quot;), new BigDecimal(&quot;104&quot;)));\n        storeQuotation(new Quotation(1001,new BigDecimal(&quot;69&quot;), new BigDecimal(&quot;72&quot;)));\n        storeQuotation(new Quotation(1002,new BigDecimal(&quot;65&quot;), new BigDecimal(&quot;69&quot;)));\n        storeQuotation(new Quotation(1003,new BigDecimal(&quot;70&quot;), new BigDecimal(&quot;71&quot;)));\n        storeQuotation(new Quotation(1004,new BigDecimal(&quot;71&quot;), new BigDecimal(&quot;73&quot;)));\n        storeQuotation(new Quotation(1005,new BigDecimal(&quot;90&quot;), new BigDecimal(&quot;95&quot;)));\n        storeQuotation(new Quotation(1006,new BigDecimal(&quot;92&quot;), new BigDecimal(&quot;93&quot;)));\n        storeQuotation(new Quotation(1007,new BigDecimal(&quot;94&quot;), new BigDecimal(&quot;98&quot;)));\n        storeQuotation(new Quotation(1008,new BigDecimal(&quot;90&quot;), new BigDecimal(&quot;92&quot;)));\n        storeQuotation(new Quotation(1009,new BigDecimal(&quot;92&quot;), new BigDecimal(&quot;95&quot;)));\n</code></pre>\n<pre><code>out - Not Sorted\n    id - 1000.   Bid - 99.   Ask - 104.   Spread = 5\n    id - 1001.   Bid - 69.   Ask - 72.   Spread = 3\n    id - 1002.   Bid - 65.   Ask - 69.   Spread = 4\n    id - 1003.   Bid - 70.   Ask - 71.   Spread = 1\n    id - 1004.   Bid - 71.   Ask - 73.   Spread = 2\n    id - 1005.   Bid - 90.   Ask - 95.   Spread = 5\n    id - 1006.   Bid - 92.   Ask - 93.   Spread = 1\n    id - 1007.   Bid - 94.   Ask - 98.   Spread = 4\n    id - 1008.   Bid - 90.   Ask - 92.   Spread = 2\n    id - 1009.   Bid - 92.   Ask - 95.   Spread = 3\n</code></pre>\n<p>And I just need to sort this list by the difference between bidPrice and askPrice.\nI tried this method...</p>\n<pre><code>    public static List&lt;Quotation&gt; getSpreadsList(boolean decreasing) {\n        List&lt;Quotation&gt; sortedBySpread = QuotationsStoreImpl.quotationList;\n\n        Collections.sort(sortedBySpread, (a, b) -&gt;\n     (a.getBidPrice().intValue() - b.getAskPrice().intValue()));\n\n//        sortedBySpread.sort((a, b) -&gt; \n//    (a.getBidPrice().intValue() - b.getAskPrice().intValue()));\n\n        if (decreasing) {\n            Collections.reverse(sortedBySpread);\n        }\n        return sortedBySpread;\n    }\n    }\n</code></pre>\n<p>But without success...</p>\n<pre><code>out - Sorted\n    id - 1002.   Bid - 65.   Ask - 69.   Spread = 4\n    id - 1003.   Bid - 70.   Ask - 71.   Spread = 1\n    id - 1004.   Bid - 71.   Ask - 73.   Spread = 2\n    id - 1001.   Bid - 69.   Ask - 72.   Spread = 3\n    id - 1008.   Bid - 90.   Ask - 92.   Spread = 2\n    id - 1009.   Bid - 92.   Ask - 95.   Spread = 3\n    id - 1006.   Bid - 92.   Ask - 93.   Spread = 1\n    id - 1007.   Bid - 94.   Ask - 98.   Spread = 4\n    id - 1005.   Bid - 90.   Ask - 95.   Spread = 5\n    id - 1000.   Bid - 99.   Ask - 104.   Spread = 5\n</code></pre>\n<p>The list is mixed but not sorted according to my criteria !\nSpread not sorted !</p>\n<p>How can I sort this list correct, by spread ?</p>\n<p>I don't have much experience in java.\nAnd all my attempts have come to nothing.</p>\n"},{"tags":["java","sorting","arraylist","comparator"],"comments":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":132384077,"body":"What&#39;s the problem with the code exactly?"},{"owner":{"user_id":7825572,"display_name":"4ulls"},"edited":false,"comment_id":132385063,"body":"I does not sort, but after some debugging I have replaced the line: return (int)(a.getX() - b.getX()); by: return (int)Math.signum(a.getX() - b.getX()); and now it does."}],"answers":[{"owner":{"user_id":2422776,"display_name":"Mureinik"},"up_vote_count":8,"is_accepted":true,"creation_date":1672921591,"answer_id":75018378,"body":"<p><code>nextFloat()</code> will generate a <code>float</code> in the range [0,1), and by subtracting any two such values in the comparator, you'll get a value in the range (-1, 1). When you cast this to an <code>int</code> you'll get a 0, meaning that according to this comparator they are all equivalent, and the list will retain its order.</p>\n<p>You can solve this by not implementing the comparator with <code>-</code>, but by reusing <code>Float</code>'s <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/Float.html#compare(float,float)\" rel=\"noreferrer\"><code>compare</code></a> method:</p>\n<pre class=\"lang-java prettyprint-override\"><code>class sorter implements Comparator&lt;someObj&gt; {\n    \n    public int compare(someObj a, someObj b) {\n        return Float.compare(a.getX(), b.getX());\n    }\n}\n</code></pre>\n<p>Or better yet, use <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/Comparator.html#comparing(java.util.function.Function)\" rel=\"noreferrer\"><code>Comparator.comparing</code></a> to create this comparator on the fly:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Collections.sort(oList, Comparator.comparing(someObj::getX));\n</code></pre>\n<p><strong>EDIT:</strong><br />\nAs Andy Turner noted in the comments, <code>Collections.sort</code> is a bit outdated. Since JDK 8, lists have their own <code>sort</code> method you can invoke directly:</p>\n<pre class=\"lang-java prettyprint-override\"><code>oList.sort(Comparator.comparing(someObj::getX));\n</code></pre>\n"}],"owner":{"user_id":7825572,"display_name":"4ulls"},"view_count":66,"up_vote_count":3,"accepted_answer_id":75018378,"answer_count":1,"score":2,"creation_date":1672920583,"question_id":75018160,"body":"<p>In the code below the object <code>someObj</code> has two properties, a <code>float x</code> and an <code>int pnt</code>.\nAn <code>ArrayList&lt;someObj&gt;</code> is created and is then sorted using a <code>Comparator</code> interface according to x. The property <code>pnt</code> is intended to keep track of the elements after the sorting.</p>\n<p>I've copied the code from <a href=\"https://www.geeksforgeeks.org/collections-sort-java-examples/\" rel=\"nofollow noreferrer\">https://www.geeksforgeeks.org/collections-sort-java-examples/</a>\nand modified it a little to suit my needs. I wonder what might be wrong, it just does not do its sorting job.</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.Comparator;\nimport java.util.Random;\n\npublic class ArrayListSorting {\n\n   public static void main(String[] args) {\n       \n       // 20 random numbers will be used for the test\n       final int sz=20;\n       Random rand = new Random();\n       \n       ArrayList&lt;someObj&gt; oList=new ArrayList&lt;someObj&gt;();\n      \n      // Build the list\n      for(int i=0;i&lt;sz;i++) {\n          oList.add(new someObj(i,rand.nextFloat()));\n      }\n    \n      // Print the list before sorting\n      for(int i=0;i&lt;sz;i++) {\n          System.out.println(i+&quot;\\t&quot;+oList.get(i).getX());\n      }\n\n      Collections.sort(oList, new sorter());\n\n      // ...and after sorting\n      for(int i=0;i&lt;sz;i++) {\n          int j=oList.get(i).getPnt();\n          System.out.println(j+&quot;\\t&quot;+oList.get(i).getX());\n      }\n\n   }\n}\n\nclass someObj {\n\n    private float x;\n    private int pnt;\n    \n    public someObj(int pnt,float x) {\n        this.pnt=pnt;\n        this.x=x;\n    }\n    \n    public int getPnt() {\n        return pnt;\n    }\n    \n    public float getX() {\n        return x;\n    }\n}\n\nclass sorter implements Comparator&lt;someObj&gt; {\n    \n    public int compare(someObj a, someObj b) {\n        return (int)(a.getX() - b.getX());\n    }\n}\n</code></pre>\n"},{"tags":["java","jvm","hashcode"],"comments":[{"owner":{"user_id":6073886,"display_name":"OH GOD SPIDERS"},"edited":false,"comment_id":134411023,"body":"You might be confusing hashcode and identity-hashcode. Only the identity hashcode is saved in the objects header and it is different to the hashcode that might be generated and returned by calling the hashcode() method."},{"owner":{"user_id":19173162,"display_name":"SadMan"},"edited":false,"comment_id":134411057,"body":"SO how is a 32-bit identity-hashcode stored in a 25-bit mark word in Java without data loss? Or it will lead to data loss?"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":134411929,"body":"The 32 bit hash code is <i>not</i> stored into that 25 bit field (and yes, it would lead to data loss if you had tried, unconditionally)."}],"answers":[{"owner":{"user_id":40342,"display_name":"Joachim Sauer"},"up_vote_count":7,"is_accepted":false,"creation_date":1683728794,"answer_id":76219627,"body":"<p>First of all and most importantly: <strong>all of this is very much an implementation detail</strong> and not defined by the specification. I'm specifically discussing recent OpenJDK builds (I'm testing JDK 17, but this behaviour seems to exist for a while), but nothing says that other JDKs or even future versions of OpenJDK could change any of this.</p>\n<p>Next it's important to distinguish an objects <em>identity hash code</em> from its <em>hash code</em>.</p>\n<ul>\n<li><p>the <em>identity hash code</em> is a value decided by the JVM that's constant over the lifetime of an object and can not be influenced by Java code (i.e. overriding <code>hashCode()</code> has no effect on this). This value can be gotten by <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/System.html#identityHashCode(java.lang.Object)\" rel=\"nofollow noreferrer\">calling <code>System.identityHashCode(obj)</code></a>.</p>\n</li>\n<li><p>the <em>hash code</em> on the other hand is what Java programmers mostly interact with: the return value of <code>hashCode()</code> when called on an object. While this is an important value whenever anything is stored in a <code>HashMap</code> or <code>HashSet</code> (or similar structures), the JVM itself does not particularly care about it. And even if it did, it couldn't store it in an object header, as <code>hashCode()</code> could conceivably return a different value every time it's called.</p>\n</li>\n</ul>\n<p>These two definitions interact in one important way: The <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()\" rel=\"nofollow noreferrer\"><code>hashCode()</code> method of <code>java.lang.Object</code></a> (and thus also of any other object where that method isn't overridden) will return the identity hash code. So one could say that the identity hash code is the default value for the hash code, if nothing else is defined.</p>\n<p>After looking at <a href=\"https://github.com/openjdk/jdk/blob/master/src/hotspot/share/oops/markWord.hpp\" rel=\"nofollow noreferrer\">the relevant code</a> it does indeed seem like there's at most 25 bits of space to store the identity hash code on 32bit platforms.</p>\n<p>But <code>hashCode</code> is defined to be 32bits wide, so how can that be?</p>\n<p>Simple: the <em>identity hash code</em> on those platforms simply never <em>uses</em> any more bits than 25, so all the bits that are not stored are known/assumed to be zero.</p>\n<p>While I didn't find the specific place where that is decided (I also didn't look too closely), one can easily verify this with code like this:</p>\n<pre><code>public class MyClass {\n    public static void main(String args[]) {\n      int minLeadingZeroes = 32;\n      for (int i = 0; i &lt; 1_000_000; i++) {\n          int hash = System.identityHashCode(new Object());\n          minLeadingZeroes = Math.min(minLeadingZeroes, Integer.numberOfLeadingZeros(hash));\n      }\n\n      System.out.println(&quot;Smallest number of leading zeroes in identity hash codes of 1000000 objects = &quot; + minLeadingZeroes);\n    }\n}\n</code></pre>\n<p>When run with a 64bit JVM this prints</p>\n<pre class=\"lang-none prettyprint-override\"><code>Smallest number of leading zeroes in identity hash codes of 1000000 objects = 1\n</code></pre>\n<p>Whereas on a 32bit JVM it prints</p>\n<pre class=\"lang-none prettyprint-override\"><code>Smallest number of leading zeroes in identity hash codes of 1000000 objects = 7\n</code></pre>\n<p>Granted, this is not absolute proof, but it would be extremely unlikely that those values are a coincidence when testing a million objects.</p>\n<p>Also note that even in a 64bit OpenJDK build the identity hash code uses at most 31bits (as noted also in the comments of the implementation linked to above), despite there being plenty of spare room (many bits are unused in this case).</p>\n"}],"owner":{"user_id":19173162,"display_name":"SadMan"},"view_count":65,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1683726412,"question_id":76219209,"body":"<p>I've been looking into the internals of Java objects and am puzzled about how hashCode values are managed. As I understand it, the hashCode method in Java returns a 32-bit integer. However, this hashCode is stored in the object's header, specifically in the 25-bit mark word.</p>\n<p>This raises a couple of questions for me:</p>\n<p>How is it possible to store a 32-bit hashCode in a 25-bit mark word without losing some bits of data?\nEven if data loss occurs due to this bit-length discrepancy, why is it that when I call <code>hashCode()</code> again, it still retrieves the original hashCode value without any apparent data loss?</p>\n<p>Any insights into how Java manages to do this would be greatly appreciated.</p>\n"},{"tags":["java","sleep"],"comments":[{"owner":{"user_id":992484,"display_name":"MadProgrammer"},"edited":false,"comment_id":134266298,"body":"Because seing is single threaded (and not thread safe), you can’t block the event dispatching thread, otherwise ui can’t be updated. Use a swing Timer instead"}],"answers":[{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"up_vote_count":7,"is_accepted":true,"creation_date":1682728138,"answer_id":76134000,"body":"<p>Almost all UI systems, and swing (which is what you are using here) is one of them, has this concept called the Event Dispatcher Thread, or EDT.</p>\n<p>The EDT has a bunch of properties:</p>\n<ul>\n<li>There is only one such thread.</li>\n<li>Any interaction with the UI (as in, <code>jLabel.setText(&quot;Hello&quot;)</code>, removing or adding widgets, changing the colour of something, and so on) <strong>must</strong> be done from the EDT. If you do it from any other thread, weird things will happen.</li>\n<li>All event handlers (so, your on mouse click code and such) runs inside the EDT.</li>\n<li><strong>You must never block the EDT</strong>. The EDT is the thread that is taking caring of ensuring your program repaints itself if the user drags another window across your app's window (the OS doesn't remember those pixels! The OS just asks the app to redraw itself; sometimes the mouse pointer isn't a hardware sprite and leaves a 'trail' in its wake). The EDT is also the thread that is taking care of e.g. if the user presses a button but doesn't let go, that the button is re-painted in a 'it is now pressed down' look.</li>\n</ul>\n<p>Ever seen a napp crash such that even pressing buttons doesn't do anything, or the thing just becomes a dull grey colour once you hide it and re-show it and even drag any window across it?</p>\n<p>That'd be an app that violated that rule.</p>\n<p>Here you are sleeping in the EDT. <strong>This is forbidden</strong>.</p>\n<p>Blocking acts:</p>\n<ul>\n<li>Talking to a DB</li>\n<li>Opening a file</li>\n<li>Interacting with anything on the network</li>\n<li>Waiting for a thread.</li>\n<li>A <code>synchronized</code> anything.</li>\n<li><code>Thread.sleep</code></li>\n<li>and much, much more. Anything that would cause the thread to sleep as it cannot continue until some event occurs (disk ready with bytes, some time passes, a lock becomes free, and so on).</li>\n</ul>\n<p>The solution is not to sleep 400 millisec and then act. The solution is instead to create a new thread which waits 400 milliseconds, and which then injects the code to remove, revalidate, and repaint back into the EDT (after all, that thread is not the EDT, so you can wait 400 millis in it, but you cannot act on the UI, because you must only do that from the EDT).</p>\n<p>This is annoying, but somewhat common, so swing has a thing for it: <a href=\"https://docs.oracle.com/javase/tutorial/uiswing/misc/timer.html\" rel=\"noreferrer\"><code>SwingTimer</code></a>.</p>\n"}],"owner":{"user_id":21768610,"display_name":"OwerTheBlobfish"},"view_count":61,"up_vote_count":2,"accepted_answer_id":76134000,"answer_count":1,"score":2,"creation_date":1682727241,"question_id":76133959,"body":"<p>My code currently looks like this, and I want to delay the process AFTER the release code takes place, but before the game starting, but currently it looks as if the release code doesn't occur at all. It looks as if after the delay, the start happens immediately after, which I don't want. If anyone can help, thanks.</p>\n<p>This is my code.</p>\n<pre class=\"lang-java prettyprint-override\"><code>startButton.addMouseListener(new MouseListener() {\n    @Override\n    public void mouseClicked(MouseEvent e) {\n    }\n\n    @Override\n    public void mousePressed(MouseEvent e) {\n        // Press\n        startButton.setPreferredSize(new Dimension(240, 240));\n        startButton.setIcon(startButtonHover);\n        FRAME.pack();\n    }\n\n    @Override\n    public void mouseReleased(MouseEvent e) {\n        // Release\n        // NOT TRIGGERING AT ALL\n        startButton.setPreferredSize(new Dimension(256, 256));\n        startButton.setIcon(startButtonImage);\n        FRAME.pack();\n\n        try {\n            Thread.sleep(400);\n        } catch (InterruptedException e1) {\n            Thread.currentThread().interrupt();\n        }\n\n        // Game Start\n        FRAME.remove(menuPanel);\n        FRAME.revalidate();\n        FRAME.repaint();\n\n    }\n\n});\n</code></pre>\n"},{"tags":["java","spring","spring-boot","docker","docker-image"],"comments":[{"owner":{"user_id":1299533,"display_name":"Scott Frederick"},"edited":false,"comment_id":133390714,"body":"Please show the full output of the build, especially the output from the image builder (lines that start with <code>[INFO]     [creator]</code>)."},{"owner":{"user_id":10591439,"display_name":"vapan"},"edited":false,"comment_id":133399555,"body":"@ScottFrederick I added the full output in my post"}],"answers":[{"owner":{"user_id":1299533,"display_name":"Scott Frederick"},"up_vote_count":6,"is_accepted":true,"creation_date":1677781220,"answer_id":75619418,"body":"<p>Your image build is failing when trying to download a JRE or JDK to use in the resulting image. The output shows <code>Using Java version 18 extracted from MANIFEST.MF</code>, but the Paketo Buildpack for BellSoft Liberica shown in the output (<code>paketo-buildpacks/bellsoft-liberica 9.10.3</code>) does not support Java 18 (see <a href=\"https://github.com/paketo-buildpacks/bellsoft-liberica/releases/tag/v9.10.3\" rel=\"nofollow noreferrer\">release notes</a> for the versions it does support).</p>\n<p>The <code>Using Java version 18 extracted from MANIFEST.MF</code> output indicates that the <code>META-INF/MANIFEST.MF</code> file in the jar file generated by Spring Boot contains the line <code>Build-Jdk-Spec: 18</code>. This should not be the case since your <code>pom.xml</code> above has <code>&lt;java.version&gt;17&lt;/java.version&gt;</code>, so something does not look right there.</p>\n<p>You should make sure that the <code>Build-Jdk-Spec</code> entry in the jar manifest matches one of the JRE entries supported by the Paketo Buildpack for Bellsoft Liberica (that is, <code>17</code> or <code>19</code>). Maven should set this  automatically unless something else in the build is modifying the jar manifest.</p>\n<p>You also have the option of explicitly configuring the buildpack to use the JRE version you want, as shown in the <a href=\"https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#build-image.examples.builder-configuration\" rel=\"nofollow noreferrer\">Spring Boot documentation</a>.</p>\n<p><strong>Example:</strong><BR/>\nPOM.xml with Java 17:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\nproject xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n     xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    ...\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n        ...\n    &lt;/properties&gt;\n    ...\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;!-- Make sure `mvn spring-boot:build-image` uses the Java version defined in this project --&gt;\n                    &lt;image&gt;\n                        &lt;env&gt;\n                            &lt;BP_JVM_VERSION&gt;${java.version}&lt;/BP_JVM_VERSION&gt;\n                        &lt;/env&gt;\n                    &lt;/image&gt;\n                    ...\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            ...\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n"},{"owner":{"user_id":1067015,"display_name":"Pravin Mohol"},"up_vote_count":1,"is_accepted":false,"creation_date":1682279980,"answer_id":76086988,"body":"<p>Solved my issue, I have java-19 installed in system but app running was on java 17. So adding below line into pom XML solved my problem and created image. &lt;BP_JVM_VERSION&gt;${java.version}&lt;/BP_JVM_VERSION&gt;</p>\n"}],"owner":{"user_id":10591439,"display_name":"vapan"},"view_count":571,"up_vote_count":2,"accepted_answer_id":75619418,"answer_count":2,"score":2,"creation_date":1677668272,"question_id":75602761,"body":"<p>In my spring boot application i issue a problem when i 'm trying to build my docker image by this command</p>\n<pre><code>mvn spring-boot:build-image -DskipTests\n</code></pre>\n<p>i see as a result a build failure:</p>\n<pre><code>  [INFO] Scanning for projects...\n[INFO] \n[INFO] ------&lt; com.in28minutes.microservices:currency-exchange-service &gt;-------\n[INFO] Building currency-exchange-service-docker 0.0.1-SNAPSHOT\n[INFO] --------------------------------[ jar ]---------------------------------\n[INFO] \n[INFO] &gt;&gt;&gt; spring-boot-maven-plugin:3.0.2:build-image (default-cli) &gt; package @ currency-exchange-service &gt;&gt;&gt;\n[INFO] \n[INFO] --- maven-resources-plugin:3.3.0:resources (default-resources) @ currency-exchange-service ---\n[INFO] Copying 1 resource\n[INFO] Copying 1 resource\n[INFO]\n[INFO] --- maven-compiler-plugin:3.10.1:compile (default-compile) @ currency-exchange-service ---\n[INFO] Nothing to compile - all classes are up to date\n[INFO]\n[INFO] --- maven-resources-plugin:3.3.0:testResources (default-testResources) @ currency-exchange-service ---\n[INFO] skip non existing resourceDirectory C:\\Users\\vavil\\Desktop\\spring-microservices\\spring-microservices-v3-main\\04.docker\\currency-exchange-service\\src\\test\\resources\n[INFO]\n[INFO] --- maven-compiler-plugin:3.10.1:testCompile (default-testCompile) @ currency-exchange-service ---\n[INFO] Nothing to compile - all classes are up to date\n[INFO]\n[INFO] --- maven-surefire-plugin:2.22.2:test (default-test) @ currency-exchange-service ---\n[INFO] Tests are skipped.\n[INFO]\n[INFO] --- maven-jar-plugin:3.3.0:jar (default-jar) @ currency-exchange-service ---\n[INFO] \n[INFO] --- spring-boot-maven-plugin:3.0.2:repackage (repackage) @ currency-exchange-service ---\n[INFO] Replacing main artifact with repackaged archive\n[INFO]\n[INFO] &lt;&lt;&lt; spring-boot-maven-plugin:3.0.2:build-image (default-cli) &lt; package @ currency-exchange-service &lt;&lt;&lt;\n[INFO]\n[INFO] \n[INFO] --- spring-boot-maven-plugin:3.0.2:build-image (default-cli) @ currency-exchange-service ---\n[INFO] Building image 'docker.io/in28min/mmv3-currency-exchange-service:0.0.1-SNAPSHOT'\n[INFO]\n[INFO]  &gt; Executing lifecycle version v0.16.0\n[INFO]  &gt; Using build cache volume 'pack-cache-3c5bb71319ef.build'\n[INFO]\n[INFO]  &gt; Running creator\n[INFO]     [creator]     ===&gt; ANALYZING\n[INFO]     [creator]     Previous image with name &quot;docker.io/in28min/mmv3-currency-exchange-service:0.0.1-SNAPSHOT&quot; not found\n[INFO]     [creator]     ===&gt; DETECTING\n[INFO]     [creator]     6 of 24 buildpacks participating\n[INFO]     [creator]     paketo-buildpacks/ca-certificates   3.5.1\n[INFO]     [creator]     paketo-buildpacks/bellsoft-liberica 9.10.3\n[INFO]     [creator]     paketo-buildpacks/syft              1.24.2\n[INFO]     [creator]     paketo-buildpacks/executable-jar    6.6.0\n[INFO]     [creator]     paketo-buildpacks/dist-zip          5.5.0\n[INFO]     [creator]     paketo-buildpacks/spring-boot       5.22.1\n[INFO]     [creator]     ===&gt; RESTORING\n[INFO]     [creator]     ===&gt; BUILDING\n[INFO]     [creator]\n[INFO]     [creator]     Paketo Buildpack for CA Certificates 3.5.1\n[INFO]     [creator]       https://github.com/paketo-buildpacks/ca-certificates\n[INFO]     [creator]       Launch Helper: Contributing to layer\n[INFO]     [creator]         Creating /layers/paketo-buildpacks_ca-certificates/helper/exec.d/ca-certificates-helper\n[INFO]     [creator]\n[INFO]     [creator]     Paketo Buildpack for BellSoft Liberica 9.10.3\n[INFO]     [creator]       https://github.com/paketo-buildpacks/bellsoft-liberica\n[INFO]     [creator]       Build Configuration:\n[INFO]     [creator]         $BP_JVM_JLINK_ARGS           --no-man-pages --no-header-files --strip-debug --compress=1  configure custom link arguments (--output must be omitted)\n[INFO]     [creator]         $BP_JVM_JLINK_ENABLED        false                                                        enables running jlink tool to generate custom JRE\n[INFO]     [creator]         $BP_JVM_TYPE                 JRE                                                          the JVM type - JDK or JRE\n[INFO]     [creator]         $BP_JVM_VERSION              11                                                           the Java version\n[INFO]     [creator]       Launch Configuration:\n[INFO]     [creator]         $BPL_DEBUG_ENABLED           false                                                        enables Java remote debugging support\n[INFO]     [creator]         $BPL_DEBUG_PORT              8000                                                         configure the remote debugging port\n[INFO]     [creator]         $BPL_DEBUG_SUSPEND           false                                                        configure whether to suspend execution until a debugger has attached\n[INFO]     [creator]         $BPL_HEAP_DUMP_PATH                                                                       write heap dumps on error to this path\n[INFO]     [creator]         $BPL_JAVA_NMT_ENABLED        true                                                         enables Java Native Memory Tracking (NMT)\n[INFO]     [creator]         $BPL_JAVA_NMT_LEVEL          summary                                                      configure level of NMT, summary or detail\n[INFO]     [creator]         $BPL_JFR_ARGS                                                                             configure custom Java Flight Recording (JFR) arguments\n[INFO]     [creator]         $BPL_JFR_ENABLED             false                                                        enables Java Flight Recording (JFR)\n[INFO]     [creator]         $BPL_JMX_ENABLED             false                                                        enables Java Management Extensions (JMX)\n[INFO]     [creator]         $BPL_JMX_PORT                5000                                                         configure the JMX port\n[INFO]     [creator]         $BPL_JVM_HEAD_ROOM           0                                                            the headroom in memory calculation\n[INFO]     [creator]         $BPL_JVM_LOADED_CLASS_COUNT  35% of classes                                               the number of loaded classes in memory calculation\n[INFO]     [creator]         $BPL_JVM_THREAD_COUNT        250                                                          the number of threads in memory calculation\n[INFO]     [creator]         $JAVA_TOOL_OPTIONS                                                                        the JVM launch flags\n[INFO]     [creator]         Using Java version 18 extracted from MANIFEST.MF\n[INFO]     [creator]       No valid JRE available, providing matching JDK instead. Using a JDK at runtime has security implications.\n[INFO]     [creator]        : Contributing to layer\n[INFO]     [creator]       Warning: Dependency has no SHA256. Skipping cache.\n[INFO]     [creator]         Downloading from\n[INFO]     [creator]     unable to invoke layer creator\n[INFO]     [creator]     unable to get dependency\n[INFO]     [creator]     unable to download\n[INFO]     [creator]     unable to request\n[INFO]     [creator]     Get &quot;&quot;: unsupported protocol scheme &quot;&quot;\n[INFO]     [creator]     ERROR: failed to build: exit status 1\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  13.631 s\n[INFO] Finished at: 2023-03-02T10:31:09+02:00\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.springframework.boot:spring-boot-maven-plugin:3.0.2:build-image (default-cli) on project currency-exchange-service: Execution default-cli of goal org.springframework.boot:spring-boot-maven-plugin:3\n.0.2:build-image failed: Builder lifecycle 'creator' failed with status code 51 -&gt; [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/PluginExecutionException\n</code></pre>\n<p>I tried to change my pom.xml and also some versions to check if there is version compatibility problem but i still facing the same issue.</p>\n<p>Here is my <strong>pom.xml</strong>:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.0.2&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.in28minutes.microservices&lt;/groupId&gt;\n    &lt;artifactId&gt;currency-exchange-service&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;currency-exchange-service-docker&lt;/name&gt;\n    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\n\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n        &lt;spring-cloud.version&gt;2022.0.0&lt;/spring-cloud.version&gt;\n    &lt;/properties&gt;\n\n\n    &lt;dependencies&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.h2database&lt;/groupId&gt;\n            &lt;artifactId&gt;h2&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n\n        &lt;!--        &lt;dependency&gt;\n                    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n                    &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;\n                &lt;/dependency&gt;\n         --&gt;\n        &lt;!-- Spring Boot 3+ Tracing --&gt;\n\n        &lt;!-- Micrometer &gt; Brave/OpenTelemetry &gt; Zipkin --&gt;\n\n        &lt;!-- Micrometer - Vendor-neutral application observability facade. Instrument your JVM-based application code without vendor lock-in.  Observation (Metrics &amp; Logs) + Tracing.--&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;\n            &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Brave as Bridge --&gt;\n\n        &lt;!--\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;\n            &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId\n            &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        --&gt;\n\n        &lt;!-- Open Telemetry as Bridge --&gt;\n        &lt;!-- Open Telemetry - Simplified Observability (metrics, logs, and traces) --&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;\n            &lt;artifactId&gt;micrometer-tracing-bridge-otel&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.opentelemetry&lt;/groupId&gt;\n            &lt;artifactId&gt;opentelemetry-exporter-zipkin&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.github.resilience4j&lt;/groupId&gt;\n            &lt;artifactId&gt;resilience4j-spring-boot2&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;\n                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;\n                &lt;type&gt;pom&lt;/type&gt;\n                &lt;scope&gt;import&lt;/scope&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;image&gt;\n                        &lt;name&gt;in28min/mmv3-${project.artifactId}:${project.version}&lt;/name&gt;\n                    &lt;/image&gt;\n                    &lt;pullPolicy&gt;IF_NOT_PRESENT&lt;/pullPolicy&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n    &lt;repositories&gt;\n        &lt;repository&gt;\n            &lt;id&gt;spring-milestones&lt;/id&gt;\n            &lt;name&gt;Spring Milestones&lt;/name&gt;\n            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;\n        &lt;/repository&gt;\n    &lt;/repositories&gt;\n\n&lt;/project&gt;\n</code></pre>\n<p>I also tried to change this version:</p>\n<pre><code>&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.0.2&lt;/version&gt;\n</code></pre>\n<p>to:</p>\n<pre><code>  &lt;version&gt;2.7.4&lt;/version&gt;\n</code></pre>\n<p>but i m getting error in some classes because i use imports such as:</p>\n<pre><code>import jakarta.persistence.Column;\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.Id;\n</code></pre>\n"},{"tags":["java","ffmpeg","video-streaming","h.264","javacv"],"comments":[{"owner":{"user_id":5726027,"display_name":"Gyan"},"edited":false,"comment_id":133278801,"body":"This appears to be fragmented MP4 rather than a raw H264 bitstream with some proprietary data at front. The fragment starts at <code>0x10d</code> (4th byte before <code>moof</code>). The video payload starts at <code>0x17d</code> but if you ignore the container, you will lose timing info."},{"owner":{"user_id":5750634,"display_name":"ashif-ismail"},"edited":false,"comment_id":133278823,"body":"could you please explain more.. regarding the decode part (this is a live stream)"},{"owner":{"user_id":5726027,"display_name":"Gyan"},"edited":false,"comment_id":133278927,"body":"It has syntax elements of an MP4 like moof, mdat..etc. To decode the container, you will need a MP4 demuxer. To decode just the H264, locate <code>mdat</code> in each packet and start decode from next byte."},{"owner":{"user_id":5750634,"display_name":"ashif-ismail"},"edited":false,"comment_id":133278983,"body":"hi @gyan can u suggest some java based libraries to demux/decode the bitstream. an example code would be great"},{"owner":{"user_id":5726027,"display_name":"Gyan"},"edited":false,"comment_id":133279042,"body":"Not familiar with Java packages."},{"owner":{"user_id":2602877,"display_name":"Christoph Rackwitz"},"edited":false,"comment_id":133286169,"body":"hexdump looks like it contains length-prefixed strings/blobs. initial 01h, no clue why, but then follow frames: [00 00 00 04h]&quot;H264&quot; and [00 00 00 24h]&quot;&lt;some guid&gt;&quot; and [D4h]&quot;&lt;some json&gt;&quot; and [3F 50h]&quot;&lt;mp4/mov file&gt;&quot; -- try dumping that. it&#39;s probably a MOV or MP4 file (mp4 is a subset of mov)."},{"owner":{"user_id":5750634,"display_name":"ashif-ismail"},"edited":false,"comment_id":133288811,"body":"I need to transmit these byte stream to any playable format and then transmit to my frontend, any possible solutions pls."},{"owner":{"user_id":5750634,"display_name":"ashif-ismail"},"edited":false,"comment_id":133288910,"body":"the GUID, in the dump is signalR socked connection ID thru which the byte stream is received. please guide me through some possible ways to decode the mov/mp4 to any playable format"},{"owner":{"user_id":2057709,"display_name":"VC.One"},"edited":false,"comment_id":133320018,"body":"@al_mukthar <b>(1)</b> You need to show a full hex sequence of bytes for a packet like: <code>01 00 00 00 04 48 32 36 34 ...etc</code> otherwise your currently shown hex dump (with the offsets and the UTF texts included) is un-usable to us for testing. <b>(2)</b> Show a hex sequence for the first received packet, it should have the main metadata. <b>(3)</b> Show a hex sequence for the 2nd received packet, it should have a keyframe&#39;s data (needed to display other pictures). <b>(4)</b> You only need <code>start += 4;</code> at the code ending, the second While loop is not needed. <b>(5)</b> How do you play MP4 files in Java?"},{"owner":{"user_id":5750634,"display_name":"ashif-ismail"},"edited":false,"comment_id":133322031,"body":"@VC.One I have updated the question to include the 1 and 2 received packet hex. also I have modified the code to read only MDAT as per Gyans comment above to get only H264 stream. answering your 5th question, I don&#39;t want to play the video in Java. I need to transmit the stream(H264) or somehow to my frontend to play"},{"owner":{"user_id":2602877,"display_name":"Christoph Rackwitz"},"edited":false,"comment_id":133322191,"body":"then DON&#39;T do any of that, and simply take that entire MP4 file and serve it"},{"owner":{"user_id":5750634,"display_name":"ashif-ismail"},"edited":false,"comment_id":133323097,"body":"@ChristophRackwitz that doesnt seems working, i served the bytes[] array received as is to the frontend through a websocket and tried playing the stream, it doesnt work.. any possible ways to decode just video frames. Im ok with losing the audio"},{"owner":{"user_id":2602877,"display_name":"Christoph Rackwitz"},"edited":false,"comment_id":133325677,"body":"can&#39;t see what you did, can&#39;t debug it. this should not be construed as an offer to debug java code or anything running in a browser. just review <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and remember that &quot;it doesn&#39;t work&quot; is never debuggable."},{"owner":{"user_id":2057709,"display_name":"VC.One"},"edited":false,"comment_id":133401932,"body":"@al_mukthar <b>(1)</b> Although you have an accepted Answer, I suspect you do not need to actually extract the H.264 out of MP4 (but your wording makes it seem like that&#39;s what you need to do). You might be creating harder work than needed for displaying frames. <b>(2)</b> Try connecting to the camera before it transmits so that the first frame is maybe a keyframe, if you connect later than camera&#39;s first transmitted packet then you might miss the keyframe."}],"answers":[{"owner":{"user_id":646173,"display_name":"Markus Schumann"},"up_vote_count":4,"is_accepted":false,"creation_date":1677610031,"answer_id":75596149,"body":"<p>Your hex dump looks like a partial fragmented MP4 prefixed with some JSON.\nTypically H.264 uses inter frame compression.\nSo not every frame is a full frame but just the differences between two frames.\nTherefore you can't decode H.264 at arbitrary points.\nYou need to look for an IDR (instant decoder refresh) frame in your stream.\nIDR frames may only be transmitted every 10-100 frames.\nNow I am looking at your 'mdat' hex dump</p>\n<p>00 00 3E E8 6D 64 61 74 00 00 3E DC 41</p>\n<p>00 00 3E E8 : size of 'mdat'</p>\n<p>6D 64 61 74 : 'mdat'</p>\n<p>00 00 3E DC : size of the NAL unit (part of the H.264) stream</p>\n<p>41 : indicates NAL unit type of '1' (lower 4 bits indicate NAL unit type)</p>\n<p>NAL unit of type '1' is a coded slice of a non-IDR picture.</p>\n<p>So your 'mdat' does not contain an IDR (or key) frame therefore it is not decodable.</p>\n<p>If you look at your JSON - you'll get another datapoint indicating the lack of a keyframe (&quot;IsKeyFrame&quot;:false).</p>\n<pre><code>{\n&quot;IsInit&quot;:false,\n&quot;IsAudio&quot;:false,\n&quot;TotalSeconds&quot;:0.06,\n&quot;FrameTime&quot;:&quot;2023-02-23T04:21:53.531Z&quot;,\n&quot;SequenceId&quot;:1,\n&quot;BaseDecodeTime&quot;:26587,\n&quot;MediaTime&quot;:26587,\n&quot;IsFrameHidden&quot;:false,\n&quot;IsKeyFrame&quot;:false,\n&quot;Id&quot;:445,&quot;Generation&quot;:1\n}\n</code></pre>\n<p>So you could modify your code and start decoding once you receive and IDR or key frame.\nBut there is potentially another issue.\nYou may need certain metadata to prime the H.264 decoder that you typically find in 'moov' (and not 'moof') part of the fragmented mp4.</p>\n<p>The stream metadata is called Sequence Parameter Set (SPS) and Picture Parameter Set (PPS).\nIt is legal to omit SPS and PPS in 'mdat' since it is usually factored out into the 'moov'.</p>\n<p>Handing just the 'mdat' to a H.264 decoder may not work if SPS/PPS is missing.</p>\n<p>In any case - if your IDR frames are prefixed with SPS/PPS - you still have to remove the size field(s) from the 'mdat' and replace them with start codes (00 00 00 01)</p>\n<p>Essentially you have to convert the mp4-style H.264 stream from 'mdat' into a 'AnnexB'-style before feeding it into a decoder:</p>\n<p>Your 'mdat':</p>\n<pre><code>'mdat' = &lt;size&gt; data[0] | &lt;size&gt; data[1] | ... | &lt;size&gt; data[n] |\n</code></pre>\n<p>Replace the size with a start code and break the multiple Access Units into individual Access Units.</p>\n<p>Required decoder input:</p>\n<pre><code>00 00 00 01 data[0]\n00 00 00 01 data[1]\n...\n00 00 00 01 data[n]\n</code></pre>\n<p>If your 'mdat' does not contain SPS/PPS then your best bet is to wait or request the 'moov' or init part of the fragmented mp4 and hand the complete fragmented mp4 to ffmpeg.</p>\n<p>I am guessing that the 'moov' or init part of the fragmented MP4 will be prefixed with the JSON member (&quot;IsInit&quot;:true).</p>\n<p>A previous answer <a href=\"https://stackoverflow.com/questions/73036143/decoding-h264-stream-always-returns-mf-e-transform-need-more-input/73085083#73085083\">Decoding H264 Stream Always Returns MF_E_TRANSFORM_NEED_MORE_INPUT</a></p>\n<p>links a self contained example parsing 'mdat' and handing it to Media Foundation for decoding.</p>\n"},{"owner":{"user_id":2057709,"display_name":"VC.One"},"up_vote_count":4,"is_accepted":true,"creation_date":1677753111,"answer_id":75614199,"body":"<blockquote>\n<p><em>&quot;I have incoming byte streams <strong>probably encoded in H264</strong> from a Genetec\ncamera...&quot;</em><br> <em>&quot;I need to decode the <strong>incoming H264 streams</strong> to transmit the video to my frontend...&quot;</em></p>\n</blockquote>\n<p><strong>Note</strong>: If your <em>&quot;frontend&quot;</em> playback system can play MP4 then you already have a playable file as given. There is no need to extract H.264 bytes from within MP4 bytes, or convert bytes to AnnexB format, or adding Start-codes, or skipping audio frames, etc. Simply remove the starting Genetec header and the rest of data is a playable MP4.</p>\n<p>This answer below is for when the playback system accepts chunked MP4 data (H.264 contained in MP4).\nIf the player expects actual raw H.264 frames then for extraction: see the Answer by <a href=\"https://stackoverflow.com/a/75596149/2057709\">Markus Schumann</a>.</p>\n<h4> ## Shortest version: </h4>\n<p>From each packet:</p>\n<ul>\n<li>At offset <code>[49]</code> read a skippable <em>&quot;Size&quot;</em> from the 32-bit integer (is in Big-Endian format).</li>\n<li>MP4 data begins at <code>int mp4_data_pos = (49 + skipSize);</code>.</li>\n<li>Extract MP4 data parts only, and use them for testing as video playback.</li>\n<li>In MP4 data: <code>[moov]</code> is metadata and then chunks are <code>[moof+mdat]</code> ... <code>[moof+mdat]</code>.</li>\n<li>Find <strong>moov</strong> as: <code>0x6D6F6F76</code>, find <strong>moof</strong> as: <code>0x6D6F6F66</code>, find <strong>mdat</strong> as: <code>0x6D646174</code>.</li>\n<li>Get a size of each atom by reading a 32-bit integer from the previous four bytes.<br> (<em>eg:</em> <code>int size_mdat = read_32_bits_from( pos_mdat - 4);</code> since one array slot holds 8 bits).</li>\n<li>First <code>[moof + mdat]</code> chunk after the metadata part must contain a keyframe for display.</li>\n<li>Find keyframe through checking for a frame type <strong>5</strong> with:<br>\n<code>int frame_type = ( byteArray[ mdat_pos + 8 ] &amp; 0x1F );</code><br>\n(<em>NB 1:</em> This will only find a keyframe if it's the first frame in a chunk (<em>eg:</em> a <code>[moof + mdat]</code> package).<br>\n(<em>NB 2:</em> It's possible your Genetec device outputs a keyframe later (<em>eg:</em> every 25th frame) or else maybe it only emits a keyframe at device start-up? Check for such an issue if not getting a keyframe.</li>\n<li>If testing with an HTML5 video tag, then your codec setup is: <code>avc1.640028</code>.</li>\n<li>If testing as file then save N-amount of &quot;MP4 data&quot; parts as one file (<em>ie:</em> file is the joined MP4 chunks).</li>\n</ul>\n<h4> ## Short version: </h4>\n<p>[ to add later: Image of header sections to skip + with 32-bit integers highlighted ]</p>\n<p>In each packet...</p>\n<ul>\n<li>Skip ahead, past the first 49 bytes.</li>\n<li>At offset 49, read a 32-bit integer (<em>ie:</em> to update some &quot;skipSize&quot; variable).</li>\n<li>Skip ahead (past some Object bytes) by the new amount from skipSize variable.</li>\n<li>MP4 data begins here (<em>eg:</em> <code>mp4_begins_pos = (49 + skipSize);</code>.</li>\n</ul>\n<p>Some notes about MP4 data in packets:</p>\n<ul>\n<li>MP4 data is up to end of packet, and may have a larger size than the current packet size.</li>\n<li>MP4 data which is larger than the packet's own size will continue in the next packet.</li>\n<li>in bytes: <code>moov</code> atom has required MP4 metadata, and <code>moof</code> atom is a playable MP4 chunk.</li>\n<li>in bytes: an MP4 atom begins with a SIZE (32-bits or 4 bytes), followed by atom NAME.</li>\n<li>in bytes: Copy all atoms (in order of appearance) by their SIZEs into a new bytes array.<br> This array can be saved as a file or sent to a decoder for playback.</li>\n</ul>\n<p><strong>(Option A)</strong> For <strong>online playback</strong> (<em>using HTML5 video tag</em>): <br>Send the array of &quot;<strong>MP4 data</strong>&quot; parts only to your front-end.<br>\n<em>(meaning all packet bytes <strong>minus the first 49 bytes</strong> and also <strong>minus the Object bytes</strong> (by its <strong>size</strong>))</em>.</p>\n<p>Web playback means choosing either: <br></p>\n<ul>\n<li><p>Using <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Media_Source_Extensions_API\" rel=\"nofollow noreferrer\">MediaSource Extensions</a> API to manually feed received chunks to the browser's MPEG decoder.</p>\n</li>\n<li><p>Using a server-side script as tag's <code>src</code>, where the script &quot;pipes&quot; the MP4 data back into the video tag.</p>\n</li>\n<li><p>Pre-saving the chunks on server as they arrive, then using HLS <a href=\"https://developer.apple.com/documentation/http_live_streaming/example_playlists_for_http_live_streaming/live_playlist_sliding_window_construction\" rel=\"nofollow noreferrer\">Live Playlist</a> format to serve frontend clients.</p>\n</li>\n</ul>\n<p>From the STSD atom I can see you have: H.264 &quot;High&quot; profile @ level 4.0 (or <strong>avc1.640028</strong>).</p>\n<pre><code>type= video/mp4; codecs= &quot;avc1.640028&quot;;\n</code></pre>\n<p><strong>(Option B)</strong> To <strong>save as a file</strong> for quick testing: <br><strong>Concat</strong> (join) your required N-amount of &quot;<strong>MP4 data</strong>&quot; parts into one long array, then save that array as a file. Test the new MP4 file from your storage folder in a player like <a href=\"https://www.videolan.org/vlc/index.en_GB.html\" rel=\"nofollow noreferrer\">VLC Media Player</a>.</p>\n<h4> ## Long version: </h4>\n<p>The format of Genetec's MP4 header is easy enough to understand:</p>\n<p><strong>(1)</strong> Each packet begins with some <strong>49 bytes</strong> of skippable values.</p>\n<ul>\n<li><p><strong>(a)</strong> Each packet's <strong>first byte</strong> value is <strong>0x01</strong>.</p>\n<ul>\n<li>Confirm with a <code>if (byteArray[0] == 1) { /* is OK packet */ }</code>.</li>\n<li>Else assume there is some packet corruption. Skip/ignore such packets.</li>\n</ul>\n</li>\n<li><p><strong>(b)</strong> Followed by 32-int for size of data, and then data itself: is type <strong>String</strong> (<em>eg:</em> <code>H264</code>).</p>\n<ul>\n<li>example packet-1 bytes: <code>00 00 00 04</code> (=4) then <code>48 32 36 34</code> (=H264)</li>\n</ul>\n</li>\n<li><p><strong>(c)</strong> Followed by 32-int size for possible GUUID (seems to be enough hex values for 16 bytes).</p>\n<ul>\n<li>example packet-1 bytes: <code>00 00 00 24</code> (=36) then <code>XXXX-XX-XX-etc</code> style hex values.</li>\n</ul>\n</li>\n</ul>\n<p>This above data seems to be always 49 bytes. Confirm by checking other packets, (is there a pattern of 49 bytes that are: a string of &quot;H264&quot; followed by a sequence of &quot;XXXX-XX-XX-etc&quot; style values?).</p>\n<ul>\n<li><strong>Skip</strong> past these 49 bytes (of Genetec's custom header bytes).</li>\n<li>Skip range is <code>[byte 0] ... [byte 48]</code>, since these bytes are not needed for playback.</li>\n</ul>\n<p><strong>(2)</strong> After skipping, there is an <a href=\"https://www.w3schools.com/java/java_classes.asp\" rel=\"nofollow noreferrer\">Object</a> (added by Genetec) of side metadata (<em>eg</em>: <code>{&quot;IsAudio&quot;:false} </code>).</p>\n<ul>\n<li><strong>(a)</strong> From <strong>offset 49</strong> onwards, read a 32-bit integer for the <strong>size</strong> (bytes length) of the Object.\n<ul>\n<li>example packet-1 bytes: <code>00 00 00 C8</code> == is <strong>size</strong> of 36 bytes</li>\n</ul>\n</li>\n<li><strong>(b)</strong> Skip the Object bytes by using the found size (to land at example position: <strong>offset N</strong>).\n<ul>\n<li>These custom Object's bytes are not needed for playback.</li>\n</ul>\n</li>\n</ul>\n<p><strong>(3)</strong> At <strong>offset N</strong>, the actual MP4 data begins.</p>\n<p>Here is a starting example code to check the packet for MP4 data size to extract for playback.</p>\n<p>Use the <strong>read_int32</strong> function that I've provided to get a 32-bit integer from some Array position.</p>\n<pre><code>import java.util.Arrays;\n\npublic class Main \n{\n    //# Vars for MP4 data\n    public static int size_MP4_data = 0;\n    public static int size_expected_MP4_data = 0;\n    public static int size_received_MP4_data = 0;\n    public static int offset_MP4_data = 0;\n    \n    public static boolean need_more_MP4_data = false;\n     \n    public static void main(String[] args) \n    {\n        //# Example Array to represent a received input Packet\n        //# Array contents are from the first 320 bytes of your first example packet\n        //# See full bytes at: https://pastebin.com/embed_js/3Ca8ZDFk \n        int[] bytes_Packet =    {\n\n                                    0x01, 0x00, 0x00, 0x00, 0x04, 0x48, 0x32, 0x36, 0x34, 0x00, 0x00, 0x00, 0x24, 0x39, 0x33, 0x65, \n                                    0x63, 0x35, 0x39, 0x31, 0x30, 0x2D, 0x65, 0x65, 0x35, 0x38, 0x2D, 0x34, 0x39, 0x37, 0x32, 0x2D, \n                                    0x61, 0x30, 0x66, 0x66, 0x2D, 0x32, 0x65, 0x62, 0x33, 0x61, 0x33, 0x61, 0x34, 0x32, 0x66, 0x35, \n                                    0x66, 0x00, 0x00, 0x00, 0xC8, 0x7B, 0x22, 0x49, 0x73, 0x49, 0x6E, 0x69, 0x74, 0x22, 0x3A, 0x74, \n                                    0x72, 0x75, 0x65, 0x2C, 0x22, 0x49, 0x73, 0x41, 0x75, 0x64, 0x69, 0x6F, 0x22, 0x3A, 0x66, 0x61, \n                                    0x6C, 0x73, 0x65, 0x2C, 0x22, 0x54, 0x6F, 0x74, 0x61, 0x6C, 0x53, 0x65, 0x63, 0x6F, 0x6E, 0x64, \n                                    0x73, 0x22, 0x3A, 0x30, 0x2E, 0x30, 0x2C, 0x22, 0x46, 0x72, 0x61, 0x6D, 0x65, 0x54, 0x69, 0x6D, \n                                    0x65, 0x22, 0x3A, 0x22, 0x32, 0x30, 0x32, 0x33, 0x2D, 0x30, 0x32, 0x2D, 0x32, 0x35, 0x54, 0x31, \n                                    0x36, 0x3A, 0x35, 0x30, 0x3A, 0x32, 0x37, 0x2E, 0x32, 0x36, 0x31, 0x5A, 0x22, 0x2C, 0x22, 0x53, \n                                    0x65, 0x71, 0x75, 0x65, 0x6E, 0x63, 0x65, 0x49, 0x64, 0x22, 0x3A, 0x31, 0x2C, 0x22, 0x42, 0x61, \n                                    0x73, 0x65, 0x44, 0x65, 0x63, 0x6F, 0x64, 0x65, 0x54, 0x69, 0x6D, 0x65, 0x22, 0x3A, 0x30, 0x2C, \n                                    0x22, 0x4D, 0x65, 0x64, 0x69, 0x61, 0x54, 0x69, 0x6D, 0x65, 0x22, 0x3A, 0x30, 0x2C, 0x22, 0x49, \n                                    0x73, 0x46, 0x72, 0x61, 0x6D, 0x65, 0x48, 0x69, 0x64, 0x64, 0x65, 0x6E, 0x22, 0x3A, 0x66, 0x61,\n                                    0x6C, 0x73, 0x65, 0x2C, 0x22, 0x49, 0x73, 0x4B, 0x65, 0x79, 0x46, 0x72, 0x61, 0x6D, 0x65, 0x22, \n                                    0x3A, 0x66, 0x61, 0x6C, 0x73, 0x65, 0x2C, 0x22, 0x49, 0x64, 0x22, 0x3A, 0x30, 0x2C, 0x22, 0x47,\n                                    0x65, 0x6E, 0x65, 0x72, 0x61, 0x74, 0x69, 0x6F, 0x6E, 0x22, 0x3A, 0x31, 0x7D, 0x00, 0x00, 0x02,\n                                    0xC4, 0x00, 0x00, 0x00, 0x1C, 0x66, 0x74, 0x79, 0x70, 0x64, 0x61, 0x73, 0x68, 0x00, 0x00, 0x00,\n                                    0x00, 0x69, 0x73, 0x6F, 0x6D, 0x64, 0x61, 0x73, 0x68, 0x6D, 0x70, 0x34, 0x31, 0x00, 0x00, 0x02, \n                                    0xA8, 0x6D, 0x6F, 0x6F, 0x76, 0x00, 0x00, 0x00, 0x78, 0x6D, 0x76, 0x68, 0x64, 0x01, 0x00, 0x00, \n                                    0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x1F, 0xEC, 0xD3, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x1F, 0xEC\n                                  \n                                };\n\n        //# Process the packet to extract MP4 data\n        int[] data_MP4 = process_Packet( bytes_Packet ); //# returns a trimmed array\n    }\n    \n    static int[] process_Packet( int[] input ) \n    {\n        //# (optional) Confirm function code is running ....\n        System.out.println( &quot;## Checking received Packet byte values .... &quot; );\n        \n        //# NOTE: \n        //# &quot;size_header_Genetec&quot; is the mentioned &quot;skipSize&quot; variable equivalent.\n        //# it stores how much bytes length (size) to skip past to reach MP4 data.\n        \n        int temp_int = 0; //# temp number for counting\n        int size_total_packet = input.length; //# using size of &quot;input&quot; packet given to this function\n        int size_header_Genetec = 0;\n        \n        //# first check if this packet's MP4 data needs to be added to another previous packet's data to make a full (uncorrupt) chunk.\n        if( need_more_MP4_data == true)\n        {\n            //## to fix later (if needed)\n            //## solution: extract needed remainder and append to an existing array\n        }\n        \n        ///////////////////////////////\n        //### Phase 1: Find MP4 attoms\n        ///////////////////////////////\n        \n        //# Account for starting &quot;0x01&quot; byte\n        size_header_Genetec = 1;\n        \n        //# since the size is increased with a &quot;+=&quot; we can re-use\n        //# the newly increased &quot;size_header_Genetec&quot; value.\n        \n        //# get next size (usually String of 4 letters: &quot;H264&quot;)\n        temp_int = read_int32( input, size_header_Genetec );\n        size_header_Genetec += (temp_int + 4);\n        \n        //# get next size (usually a GUUID of hex values)\n        temp_int = read_int32( input, size_header_Genetec );\n        size_header_Genetec += (temp_int + 4);\n        \n        //# get next size (usually an Object of metadata values)\n        temp_int = read_int32( input, size_header_Genetec );\n        size_header_Genetec += (temp_int + 4);\n        \n        //# skip next 4 bytes\n        size_header_Genetec += 4;\n       \n        //# Update offset for later use ...\n        offset_MP4_data = size_header_Genetec;\n        \n        //# final check before next steps\n        System.out.println( &quot;- MP4 data begins at offset: [&quot; + offset_MP4_data + &quot;] until end of this packet&quot; );\n        \n        ////////////////////////////////\n        //### Phase 2: Handle MP4 atoms\n        ////////////////////////////////\n        \n        //# check atom NAME\n        temp_int = read_int32( input, offset_MP4_data + 4 );\n        \n        if( \n            //# IF atom &quot;name&quot; is one of these (as expected from your packet MP4 structure)...\n            ( temp_int == 0x66747970 )    //# is &quot;ftyp&quot;\n            || ( temp_int == 0x6D6F6F76 ) //# is &quot;moov&quot;\n            || ( temp_int == 0x6D6F6F66 ) //# is &quot;moof&quot;\n            || ( temp_int == 0x6D646174 ) //# is &quot;mdat&quot;\n            \n        )\n        {\n            //# THEN check all MP4 atoms in this packet for total size of MP4 data\n            //# do this by adding together all the atom sizes\n            //# note: if size is bigger than packet, then store data for completion with next packet\n            \n            //# add sizes of MP4 atoms...\n            \n            temp_int = offset_MP4_data;\n                \n            while(true)\n            {\n                size_expected_MP4_data += read_int32( input, temp_int );\n                temp_int = ( offset_MP4_data + size_expected_MP4_data );\n                \n                //# avoid reading past end of packet\n                if( size_expected_MP4_data &gt;= ( size_total_packet - offset_MP4_data ) )\n                {\n                    break;\n                }\n            }\n        \n        }\n        \n        /////////////////////////////////////////////////////////////////////////////\n        //# confirm MP4 data positions are correct (double-check by a hex view of same bytes)...\n        System.out.println( &quot;&gt;&gt; MP4 data offset: &quot; + offset_MP4_data );\n        System.out.println( &quot;&gt;&gt; MP4 data length is : &quot; + size_expected_MP4_data );\n        /////////////////////////////////////////////////////////////////////////////\n        \n        ///////////////////////////////\n        //# Phase 3: Copy the MP4 data\n        ///////////////////////////////\n        \n        int copyStartPos = offset_MP4_data;\n        int copyEndPos = (size_total_packet-1);\n        \n        //# prepare for when getting the next new packet\n        \n        if( size_expected_MP4_data &gt; ( size_total_packet - offset_MP4_data ) ) { need_more_MP4_data = true; }\n        \n        if( need_more_MP4_data == false )\n        {\n            //# reset the count for this new MP4 chunk\n            //size_received_MP4_data = 0;\n            //size_expected_MP4_data = 0;\n        }\n        \n        //# slice the Array to keep only the MP4 data parts\n        return ( Arrays.copyOfRange( input , copyStartPos, copyEndPos) );\n        \n    }\n    \n    //# function expects:    \n    //# &quot;input&quot; = array to search, \n    //# &quot;pos&quot; = start position of reading a 4-byte sequence \n    static int read_int32( int[] input, int pos ) \n    {\n        \n        //# integer to hold combined 4-byte values as one result/number\n        int temp_int = 0;\n        \n        //# join the four byte values into &quot;temp_int&quot;\n        temp_int = ( input[ pos+0 ] &lt;&lt; 24 );\n        temp_int |= ( input[ pos+1 ] &lt;&lt; 16 );\n        temp_int |= ( input[ pos+2 ] &lt;&lt; 8 );\n        temp_int |= ( input[ pos+3 ] &lt;&lt; 0 );\n\n        return ( temp_int ); \n        \n    }\n        \n}\n</code></pre>\n<p>Options for stream playback:</p>\n<p><strong>(a)</strong> If your player expects MP4 data:</p>\n<ul>\n<li>Your data is already playable in most video players</li>\n<li>Send all data of each packet, after skipping past the first 49 bytes and also the <code>{ ... }</code> Object bytes.</li>\n</ul>\n<p><strong>(b)</strong> If your player expects raw H.264 data (<em>ie:</em> It does not play the MP4 data, only H.264 data):</p>\n<ul>\n<li>Then you will have to extract each H.264 video frame from inside the MP4 data.</li>\n<li>Your H.264 data is in <strong>AVCC</strong> format (<em><strong>.mp4</strong></em>), which means each frame comes with a &quot;size in bytes&quot; value.</li>\n<li>Most players will expect raw H.264 to be in <strong>AnnexB</strong> format (<em><strong>.h264</strong></em>).<br> Replace all four bytes of frame's size with this four byte sequence <code>00 00 00 01</code>.<br>\n(correctly: Use <code>00 00 00 01</code> for SPS, PPS and Keyframes, then <code>00 00 01</code> for  other frames <em>eg:</em> P-frames).</li>\n</ul>\n"}],"owner":{"user_id":5750634,"display_name":"ashif-ismail"},"view_count":585,"up_vote_count":3,"accepted_answer_id":75614199,"answer_count":2,"score":2,"creation_date":1677129792,"question_id":75540855,"body":"<p>I have incoming byte streams probably encoded in H264 from a RTSP camera through a websocket in my spring boot application,</p>\n<p>I need to decode the incoming H264 streams to transmit the video to my frontend clients.\nI have tried using javaCV/FFMpeg but nothing works.</p>\n<p><strong>Any help would be appreciated</strong></p>\n<p>this is the part of hex dump received through socket</p>\n<pre><code>00000000: 01 00 00 00 04 48 32 36 34 00 00 00 24 38 65 34    .....H264...$8e4\n00000010: 32 39 65 37 61 2D 32 66 34 66 2D 34 37 31 61 2D    29e7a-2f4f-471a-\n00000020: 39 61 63 30 2D 66 66 62 38 64 64 37 63 37 64 37    9ac0-ffb8dd7c7d7\n00000030: 32 00 00 00 D4 7B 22 49 73 49 6E 69 74 22 3A 66    2...T{&quot;IsInit&quot;:f\n00000040: 61 6C 73 65 2C 22 49 73 41 75 64 69 6F 22 3A 66    alse,&quot;IsAudio&quot;:f\n00000050: 61 6C 73 65 2C 22 54 6F 74 61 6C 53 65 63 6F 6E    alse,&quot;TotalSecon\n00000060: 64 73 22 3A 30 2E 30 36 2C 22 46 72 61 6D 65 54    ds&quot;:0.06,&quot;FrameT\n00000070: 69 6D 65 22 3A 22 32 30 32 33 2D 30 32 2D 32 33    ime&quot;:&quot;2023-02-23\n00000080: 54 30 34 3A 32 31 3A 35 33 2E 35 33 31 5A 22 2C    T04:21:53.531Z&quot;,\n00000090: 22 53 65 71 75 65 6E 63 65 49 64 22 3A 31 2C 22    &quot;SequenceId&quot;:1,&quot;\n000000a0: 42 61 73 65 44 65 63 6F 64 65 54 69 6D 65 22 3A    BaseDecodeTime&quot;:\n000000b0: 32 36 35 38 37 2C 22 4D 65 64 69 61 54 69 6D 65    26587,&quot;MediaTime\n000000c0: 22 3A 32 36 35 38 37 2C 22 49 73 46 72 61 6D 65    &quot;:26587,&quot;IsFrame\n000000d0: 48 69 64 64 65 6E 22 3A 66 61 6C 73 65 2C 22 49    Hidden&quot;:false,&quot;I\n000000e0: 73 4B 65 79 46 72 61 6D 65 22 3A 66 61 6C 73 65    sKeyFrame&quot;:false\n000000f0: 2C 22 49 64 22 3A 34 34 35 2C 22 47 65 6E 65 72    ,&quot;Id&quot;:445,&quot;Gener\n00000100: 61 74 69 6F 6E 22 3A 31 7D 00 00 3F 50 00 00 00    ation&quot;:1}..?P...\n00000110: 68 6D 6F 6F 66 00 00 00 10 6D 66 68 64 00 00 00    hmoof....mfhd...\n00000120: 00 00 00 01 BD 00 00 00 50 74 72 61 66 00 00 00    ....=...Ptraf...\n00000130: 10 74 66 68 64 00 02 00 00 00 00 00 01 00 00 00    .tfhd...........\n00000140: 14 74 66 64 74 01 00 00 00 00 00 00 00 00 00 67    .tfdt..........g\n00000150: DB 00 00 00 24 74 72 75 6E 01 00 0F 01 00 00 00    [...$trun.......\n00000160: 01 00 00 00 70 00 00 00 3C 00 00 3E E0 00 01 00    ....p...&lt;..&gt;`...\n00000170: 00 00 00 00 00 00 00 3E E8 6D 64 61 74 00 00 3E    .......&gt;hmdat..&gt;\n00000180: DC 41 E1 81 80 93 BE 16 2B 33 77 3D 4C B6 55 8B    \\Aa...&gt;.+3w=L6U.\n00000190: D2 55 60 92 05 F7 F7 A4 97 54 4B 6C A6 68 48 84    RU`..ww$.TKl&amp;hH.\n000001a0: 68 FF D2 B6 6C 02 31 FC 24 01 78 EA BD 20 AD 15    h.R6l.1|$.xj=.-.\n000001b0: F1 73 31 4B EB EF 18 1B 50 B3 13 F2 DC C6 4C E1    qs1Kko..P3.r\\FLa\n000001c0: 75 8B 94 52 6B C5 09 37 55 1E 45 66 6A 92 39 23    u..RkE.7U.Efj.9#\n000001d0: C9 2D FD BB EC AD FD CF C4 30 75 FF 44 66 FA 85    I-};l-}OD0u.Dfz.\n000001e0: D9 7C 18 72 AE 63 45 60 DD D7 65 44 84 49 95 8D    Y|.r.cE`]WeD.I..\n000001f0: 2C 70 6C 57 8E E9 A9 EB B6 F6 78 BD D6 88 99 F6    ,plW.i)k6vx=V..v\n00000200: FC 25 B1 0A FF DF CB 77 6A 67 37 24 A5 3D 8F A1    |%1.._Kwjg7$%=.!\n00000210: 27 9B 4F 42 0E CD B8 87 6E C9 99 FC 6F 4C 53 4B    '.OB.M8.nI.|oLSK\n00000220: 01 EA B6 AF 99 F8 22 C1 8F 1E C1 66 D6 8A 09 D6    .j6/.x&quot;A..AfV..V\n00000230: 99 79 91 F7 C1 2A 08 1F 81 CB 5E DD C3 CA 86 8F    .y.wA*...K^]CJ..\n00000240: 57 BF 17 A2 64 6B 69 56 AE 19 1F 57 AD A6 D8 C2    W?.&quot;dkiV...W-&amp;XB\n00000250: 06 28 EB 46 D3 E4 85 51 3E E2 A5 40 50 50 85 7D    .(kFSd.Q&gt;b%@PP.}\n00000260: 72 6B 20 87 1A 6E 73 E1 B8 88 9E 20 23 48 6D FE    rk...nsa8...#Hm~\n00000270: C2 0D 39 ED 24 B2 6D B5 9B 81 B6 BC F4 EE DE A2    B.9m$2m5..6&lt;tn^&quot;\n00000280: CF A1 08 D0 D2 5B EE FA 0D DA FD 3B 79 C7 89 E5    O!.PR[nz.Z};yG.e\n00000290: 4F 64 73 37 98 D6 2D 47 1D 8B A3 47 DD EA C9 8E    Ods7.V-G..#G]jI.\n000002a0: 3E 8C 97 E2 42 15 FB 22 A6 83 A1 34 18 52 5E 35    &gt;..bB.{&quot;&amp;.!4.R^5\n000002b0: 2A A6 E2 71 D7 4F 96 0A EC AE 8D 39 27 B8 CF 61    *&amp;bqWO..l..9'8Oa\n000002c0: CC ED E9 AF 74 C3 95 D3 E3 96 32 20 E6 31 0B E4    Lmi/tC.Sc.2.f1.d\n000002d0: DC F4 FF 41 37 36 E7 DB 87 AE B3 7D BF CA F8 05    \\t.A76g[..3}?Jx.\n000002e0: 72 2A 38 AB B8 8E 98 43 97 C8 5E 80 57 C6 E7 1E    r*8+8..C.H^.WFg.\n000002f0: 86 75 CE CD CE BF CF 10 C9 8A C2 C9 6E 33 41 AC    .uNMN?O.I.BIn3A,\n00000300: 91 AC A8 F3 1B E6 D5 0A 22 A1 2C 4C 68 19 51 4D    .,(s.fU.&quot;!,Lh.QM\n00000310: 17 DA AE E1 D7 BC 0E 2D F8 14 61 E2 4F BA 26 A3    .Z.aW&lt;.-x.abO:&amp;#\n00000320: 0A E4 A6 BE 08 EA 3C 28 E6 C5 6B CA 3A 86 D2 59    .d&amp;&gt;.j&lt;(fEkJ:.RY\n00000330: 34 C2 ED 91 72 5A EF 2C BE D7 38 A4 60 D7 F3 97    4Bm.rZo,&gt;W8$`Ws.\n00000340: BB E6 FD C2 D0 29 10 B5 A4 79 D8 3E 61 48 8A F9    ;f}BP).5$yX&gt;aH.y\n00000350: C6 D8 13 D0 FD DB D6 FA 24 7F CD 5A BF 06 57 49    FX.P}[Vz$.MZ?.WI\n00000360: 51 EC ED B2 74 AB 92 1D 37 68 70 A2 A5 31 B5 5F    Qlm2t+..7hp&quot;%15_\n00000370: EA CF 9E 3E 6A B1 78 16 B7 94 D1 46 7B 63 C1 67    jO.&gt;j1x.7.QF{cAg\n00000380: D2 B0 08 44 64 1E 68 15 39 80 E3 DD EB C0 E1 71    R0.Dd.h.9.c]k@aq\n00000390: E8 EE D0 4D DF 4F 41 E0 96 C5 34 AD BC D3 9E 88    hnPM_OA`.E4-&lt;S..\n000003a0: 0B 17 D8 7D 3A A8 3B 06 78 79 93 B7 30 92 C8 D8    ..X}:(;.xy.70.HX\n000003b0: 5D 27 04 D7 00 9F E3 EA A3 C6 BD B9 05 21 5C 68    ]'.W..cj#F=9.!\\h\n000003c0: 45 DB 90 2A 05 38 79 D9 84 60 C7 F2 BB DE 1B 5A    E[.*.8yY.`Gr;^.Z\n000003d0: 44 0B ED 67 34 DF 07 8B F5 04 27 9E 1A F0 04 CA    D.mg4_..u.'..p.J\n000003e0: 86 B1 2C 0B 78 D0 58 86 81 62 D8 70 3D BA 9D 51    .1,.xPX..bXp=:.Q\n000003f0: D8 2C 6C 6A 10 88 B9 F8 89 3D 6F 39 C2 52 49 CF    X,lj..9x.=o9BRIO\n00000400: 9F C1 50 6A D4 9E A5 96 B2 0A 99 1D 6B BC 63 03    .APjT.%.2...k&lt;c.\n00000410: A4 8C 7E 1D BD DF 8B D8 97 EE 9A 59 78 63 FC 74    $.~.=_.X.n.Yxc|t\n00000420: 3B 40 75 AF A7 1A B7 F0 56 A5 5F 3E 81 54 83 A0    ;@u/'.7pV%_&gt;.T..\n00000430: 7F FC AD 71 CE AF 54 8B 5D DC 27 34 20 A3 0A 73    .|-qN/T.]\\'4.#.s\n00000440: 76 A5 81 33 22 31 56 6B 1D 82 C4 32 FB 82 15 F6    v%.3&quot;1Vk..D2{..v\n00000450: 97 C8 47 29 3C 9E 59 9A C0 83 48 A0 55 CB C8 D6    .HG)&lt;.Y.@.H.UKHV\n00000460: 36 92 CC 54 A7 00 E3 28 9E 99 45 B2 E5 7E 88 A7    6.LT'.c(..E2e~.'\n00000470: 28 4E CA 75 17 3C D3 B5 6C F5 FD AC 05 55 BF F7    (NJu.&lt;S5lu},.U?w\n00000480: 98 61 92 30 D8 0F 0E A5 DD 61 4D 80 27 5B A7 68    .a.0X..%]aM.'['h\n00000490: E5 B9 C2 B8 EE 31 F6 63 29 37 C5 C9 11 39 90 8D    e9B8n1vc)7EI.9..\n000004a0: D8 00 35 F4 7A 2D 79 D0 6A BB 9C 98 E4 41 CF 3F    X.5tz-yPj;..dAO?\n000004b0: DE 9D 8B BF 04 69 1D BC 5C E7 E1 F2 49 01 8D F5    ^..?.i.&lt;\\garI..u\n000004c0: 41 3E 3F FB AE 54 B2 D9 F2 A0 E8 0A F7 59 47 77    A&gt;?{.T2Yr.h.wYGw\n000004d0: 3C 19 C8 7B 81 9B 17 19 E9 81 A0 36 AD C6 62 71    &lt;.H{....i..6-Fbq\n000004e0: DB 68 72 8F 6A 37 45 D9 0E 6E DC 2C 5E 52 C2 75    [hr.j7EY.n\\,^RBu\n000004f0: 51 2F F9 CE 8A 10 12 E9 C8 68 A9 D6 A6 D7 5B 14    Q/yN...iHh)V&amp;W[.\n00000500: 11 51 42 FD BE B5 09 56 7F 19 C3 EB A7 A6 DF 6C    .QB}&gt;5.V..Ck'&amp;_l\n00000510: 55 A3 11 DC EF 81 C3 CD DD 63 BF 38 F8 5A 4A 45    U#.\\o.CM]c?8xZJE\n00000520: 33 24 7B A4 55 B3 85 A6 87 75 3B 85 51 5C 03 B7    3${$U3.&amp;.u;.Q\\.7\n</code></pre>\n<p><strong>UPDATE TO THE CODE</strong></p>\n<p>1st Packet <a href=\"https://pastebin.com/embed_js/3Ca8ZDFk\" rel=\"nofollow noreferrer\">find here</a>\n2nd Packet <a href=\"https://pastebin.com/embed_js/FEuwQay6\" rel=\"nofollow noreferrer\">find here</a></p>\n<p>I have updated the code as per one of the comment to read only MDAT box to retrieve H264 stream from the incoming bytes[] through the socket, now I send only MDAT box contents (next byte after MDAT box)</p>\n<pre><code>public Map.Entry&lt;Boolean, List&lt;Integer&gt;&gt; hasMdat(byte[] byteArray) {\n    for (int i = 0; i &lt; byteArray.length - 3; i++) {\n        if (byteArray[i] == (byte) 109 &amp;&amp;\n                byteArray[i + 1] == (byte) 100 &amp;&amp;\n                byteArray[i + 2] == (byte) 97 &amp;&amp;\n                byteArray[i + 3] == (byte) 116) {\n\n            return Map.entry(true, Arrays.asList(i, i + 1, i + 2, i + 3));\n        }\n    }\n    return Map.entry(false, List.of(0));\n}\n</code></pre>\n<p>This is my code which handles the byte stream</p>\n<pre><code>initSocketConnection(new VideoStreamCallback() {\n        @Override\n        public void onVideoStreamReceived(byte[] bytes) {\n           \nMap.Entry&lt;Boolean, List&lt;Integer&gt;&gt; b = hasMdat(bytes);\n        if (b.getKey()) {\n            byte[] b1 = Arrays.copyOfRange(bytes, b.getValue().get(3) + 1, bytes.length);\n  //write b1 back to client using spring SSE\n            \n        }\n\n        }\n    });\n</code></pre>\n"},{"tags":["java","dictionary","stream","sum","reduce"],"answers":[{"owner":{"user_id":4405757,"display_name":"Thiyagu"},"up_vote_count":3,"is_accepted":false,"creation_date":1672982990,"answer_id":75027254,"body":"<p>Your approach using <em>reduce</em> is (almost) correct. It should look like the second code snippet where you multiply the neuron's <code>output</code> with the value from the map (<code>inputConnections.get(..)</code>)</p>\n<pre><code>inputConnections.entrySet()\n        .stream()\n        .reduce(0f,\n                (result, entry) -&gt; result + entry.getKey().getOutput() * entry.getValue(),\n                Float::sum);\n</code></pre>\n"},{"owner":{"user_id":6656833,"display_name":"Pavel"},"up_vote_count":4,"is_accepted":false,"creation_date":1672983287,"answer_id":75027286,"body":"<p>you can also achieve the same with map and sum</p>\n<pre class=\"lang-java prettyprint-override\"><code>inputConnections.entrySet().stream().mapToDouble(entry -&gt; entry.getKey().getOutput() * entry.getValue()).sum()\n</code></pre>\n"},{"owner":{"user_id":6275236,"display_name":"Roland J."},"up_vote_count":0,"is_accepted":false,"creation_date":1672988256,"answer_id":75027878,"body":"<p>You can also use <a href=\"https://docs.oracle.com/javase/tutorial/collections/streams/parallelism.html#executing_streams_in_parallel\" rel=\"nofollow noreferrer\">parallel streams</a> (be careful: only makes sense with huge datasets). In case you need some statistics additional to the <code>sum</code>, the collector <code>summarizingDouble</code> is helpful:</p>\n<pre><code>DoubleSummaryStatistics sumStat = connections.entrySet().parallelStream()\n                .map(entry -&gt; Double.valueOf(entry.getKey().getOutput() * entry.getValue()))\n                .collect(Collectors.summarizingDouble(Double::doubleValue));\nSystem.out.println(sumStat);\n</code></pre>\n<p>Example output:\nDoubleSummaryStatistics{count=3, sum=18.000000, min=4.000000, average=6.000000, max=8.000000}</p>\n<p>Here is a shorter version (thank you <a href=\"https://stackoverflow.com/users/1180351/rob-spoor\">Rob</a> for your comment):</p>\n<pre><code>sumStat = connections.entrySet().parallelStream()\n        .mapToDouble(entry -&gt; entry.getKey().getOutput() * entry.getValue())\n        .summaryStatistics();\n</code></pre>\n"}],"owner":{"user_id":19056337,"display_name":"Wewius"},"view_count":127,"up_vote_count":2,"answer_count":3,"score":2,"creation_date":1672981114,"question_id":75027081,"body":"<p>I'll try to keep it as brief as possible.</p>\n<p>I hava this map: Map&lt;Neuron,Float&gt; connections. It contains a Neuron-Objekt as Key and the weight of the connection as value.</p>\n<p>The Neuron class has a method &quot;getOutput&quot; to get the output-Value of the neuron.</p>\n<p>What I want to do is to go over every neuron in the map, calculate neuron.getOutput * connections.get(neuron) and sum all of that into one variable together.</p>\n<p>Is there an elegant way to do this with Java-Streams? Maybe with reduce? I tried it but couldn't get it to work properly.</p>\n<pre><code>inputConnections.keySet().stream().reduce(\n            0f,\n            (accumulatedFloat, inputNeuron) -&gt; accumulatedFloat + inputConnections.get(inputNeuron),\n            Float::sum);\n</code></pre>\n<p>I guess the 0f results in everything getting multiplied with 0.</p>\n<p>This code seems to work, but I'd like a more elegant solution.</p>\n<pre><code>AtomicReference&lt;Float&gt; tmp = new AtomicReference&lt;&gt;(0f);\n    inputConnections.keySet().forEach(inputNeuron -&gt; {\n        tmp.updateAndGet(v -&gt; new Float((float) (v + inputNeuron.getOutput() * inputConnections.get(inputNeuron))));\n    });\n</code></pre>\n"},{"tags":["java","regex"],"comments":[{"owner":{"user_id":4679320,"display_name":"prasad_"},"edited":false,"comment_id":134310915,"body":"That is a single string <code>inString</code> variable. The<code>^Z</code> is applied only once as there is only one instance of <code>Z</code> at the start of the string."},{"owner":{"user_id":14772414,"display_name":"Nijith"},"edited":false,"comment_id":134310958,"body":"@prasad_ since we used \\n it will come as multiline."},{"owner":{"user_id":4679320,"display_name":"prasad_"},"edited":false,"comment_id":134310968,"body":"It is still a single string."}],"answers":[{"owner":{"user_id":6890912,"display_name":"blhsing"},"up_vote_count":6,"is_accepted":true,"creation_date":1683086402,"answer_id":76160337,"body":"<p>You can make <code>^</code> match the beginning of every line instead of the entire string by enabling multi-line mode with the <code>(?m)</code> flag:</p>\n<pre><code>inString = inString.replaceAll(&quot;(?m)^Z&quot;, &quot;&quot;);\n</code></pre>\n"},{"owner":{"user_id":7214091,"display_name":"Gast&#243;n Schabas"},"up_vote_count":0,"is_accepted":false,"creation_date":1683086865,"answer_id":76160366,"body":"<p><code>&quot;^Z&quot;</code>means that the string should start with letter <code>Z</code>. In the provided example, there is only one string that starts with <code>Z</code> and after that there are more characters. The next <code>Z</code> is preceded by a <code>\\n</code>. A regex that could work in that case could be <code>(^Z|\\nZ)</code>, which means that you want to capture an string that starts with <code>Z</code> or a <code>Z</code> that is preceded by a <code>\\n</code>. Not sure if that could cover all the case that you have</p>\n"}],"owner":{"user_id":14772414,"display_name":"Nijith"},"view_count":51,"up_vote_count":2,"accepted_answer_id":76160337,"answer_count":2,"score":2,"creation_date":1683085841,"question_id":76160310,"body":"<p>I need help to remove the first character (Z) of each line of text given below using Java. The number of lines can vary.</p>\n<p>Input lines:</p>\n<pre><code>Z301052023KDE12   0000.062500000 0000.000000000 0000.000000000\n\nZ301052023KDE11   0000.000000000 0000.000000000 0000.000000000\n</code></pre>\n<p>I am using below Java code:</p>\n<pre><code>import java.util.*;\nimport java.lang.*;\nimport java.util.regex.*;\n\nclass Rextester {\n    public static void main(String args[]) {\n\n\n        String inString = &quot;Z301052023KDE12   0000.062500000 0000.000000000 0000.000000000 \\n&quot; +\n                          &quot;Z301052023KDE11   0000.000000000 0000.000000000 0000.000000000&quot;;\n\n        inString = inString.replaceAll(&quot;^Z&quot;, &quot;&quot;);\n        System.out.println(inString);\n    }\n}\n</code></pre>\n<p>Actual output:</p>\n<pre><code>301052023KDE12   0000.062500000 0000.000000000 0000.000000000 \n\nZ301052023KDE11   0000.000000000 0000.000000000 0000.000000000\n</code></pre>\n<p>Expected output:</p>\n<pre><code>301052023KDE12   0000.062500000 0000.000000000 0000.000000000 \n\n301052023KDE11   0000.000000000 0000.000000000 0000.000000000\n</code></pre>\n"},{"tags":["java","c#","double","ieee-754"],"comments":[{"owner":{"user_id":4739488,"display_name":"Flydog57"},"edited":false,"comment_id":134283060,"body":"Ah, how to evaluate the equality of two double values! One of the eternal &quot;why doesn&#39;t my program act <i>correctly</i>&quot; questions. To my eyes, those two values are <i>equal</i>"},{"owner":{"user_id":1033686,"display_name":"Matthew Layton"},"edited":false,"comment_id":134285218,"body":"@Flydog57 certainly their binary representation should be equal, otherwise one, or the other has implemented IEEE-754 incorrectly, but it does seem odd that they differ in representation."}],"answers":[{"owner":{"user_id":298225,"display_name":"Eric Postpischil"},"up_vote_count":6,"is_accepted":true,"creation_date":1682900307,"answer_id":76144150,"body":"<blockquote>\n<p>Given that the maximum value of Double is 1.7976931348623157E+308…</p>\n</blockquote>\n<p>This is incorrect. The format used for <code>Double</code> is the <em>binary64</em> or “double precision” format specified in the IEEE 754-2019 standard. In this format, a finite number is represented as ±<em>f</em>•2<sup>e</sup>, where <em>f</em>, the fraction portion of the representation, is the number represented by a binary numeral with one digit (0 or 1) before the radix point and 52 bits after it and <em>e</em>, the exponent, is an integer in [−1022, 1023]. So the maximum representable finite value is +1.1111111111111111111111111111111111111111111111111111<sub>2</sub>•2<sup>1023</sup>, which equals +(2<sup>1</sup>−2<sup>−52</sup>)•2<sup>1023</sup> = 2<sup>1024</sup>−2<sup>971</sup>, which is exactly 179,769,313,486,231,570,814,527,423,731,704,356,798,070,567,525,844,996,598,917,476,803,157,260,780,028,538,760,589,558,632,766,878,171,540,458,953,514,382,464,234,321,326,889,464,182,768,467,546,703,537,516,986,049,910,576,551,282,076,245,490,090,389,328,944,075,868,508,455,133,942,304,583,236,903,222,948,165,808,559,332,123,348,274,797,826,204,144,723,168,738,177,180,919,299,881,250,404,026,184,124,858,368, so the C# output is correct.</p>\n<p>The Java output elides significant digits and conceals the true value. This is because the Java specification says that for the default formatting <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Double.html#toString(double)\" rel=\"nofollow noreferrer\">“There must be at least one digit to represent the fractional part, and beyond that as many, but only as many, more digits as are needed to uniquely distinguish the argument value from adjacent values of type <code>double</code>.”</a></p>\n"}],"owner":{"user_id":1033686,"display_name":"Matthew Layton"},"view_count":76,"up_vote_count":2,"accepted_answer_id":76144150,"answer_count":1,"score":2,"creation_date":1682893896,"question_id":76143839,"body":"<p>Consider the following Java code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Program {\n    public static void main(String args[]) {\n      double number = Double.MAX_VALUE;\n      String formattedNumber = String.format(&quot;%f&quot;, number);\n      System.out.println(formattedNumber);\n    }\n}\n</code></pre>\n<blockquote>\n<p>179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.000000</p>\n</blockquote>\n<p>Consider the equivalent C# code:</p>\n<pre class=\"lang-cs prettyprint-override\"><code>public class Program\n{\n    public static void Main(string[] args)\n    {\n        double value = double.MaxValue;\n        Console.WriteLine(value.ToString(&quot;F&quot;));\n    }\n}\n</code></pre>\n<blockquote>\n<p>179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000</p>\n</blockquote>\n<p>Given that the maximum value of <code>Double</code> is 1.7976931348623157E+308, to my knowledge, the Java output is correct; i.e. the floating-point value actually represents an integer where the first 17 digits are 17976931348623157, followed by 292 zeros.</p>\n<p>Note: Converting <code>double</code> to <code>BigInteger</code> in C# yields the same result:</p>\n<pre class=\"lang-cs prettyprint-override\"><code>BigInteger value = (BigInteger)double.MaxValue;\nConsole.WriteLine(value);\n</code></pre>\n<blockquote>\n<p>179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368</p>\n</blockquote>\n<p><strong>Questions</strong></p>\n<ul>\n<li>Why are the values wildly different, and which one should be considered correct?</li>\n<li>If C# is actually incorrect, how would I obtain the correct, or identical output that Java produced?</li>\n</ul>\n"},{"tags":["java","lambda","java-8"],"comments":[{"owner":{"user_id":2837741,"display_name":"daniu"},"edited":false,"comment_id":134244008,"body":"Yes, a lambda becomes an inner class. What do you mean &quot;what is an implication of $$Lambda&quot;? That&#39;s part of the autogenerated <code>toString</code> of the inner class."},{"owner":{"user_id":2513200,"display_name":"Hulk"},"edited":false,"comment_id":134244125,"body":"Well, for most purposes it is the same as an anonymous inner class, like we wrote Comparators, EventHandlers etc for two decades: <code>new IntSupplier() { int getAsInt() {return 42;} };</code> If you want to dig deeper into how it is actually implemented in the JVM, your search term might be <a href=\"https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/lang/invoke/LambdaMetafactory.html\" rel=\"nofollow noreferrer\">LambdaMetafactory</a>."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134261895,"body":"See <a href=\"https://stackoverflow.com/q/36057007/2711488\">What does $$ in javac generated name mean?</a> and <a href=\"https://stackoverflow.com/q/44475789/2711488\">Meaning of class file on the file system</a>"}],"answers":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":6,"is_accepted":false,"creation_date":1682602291,"answer_id":76121024,"body":"<p>That is the name of a <em>hidden class</em>, as proposed in <a href=\"https://openjdk.org/jeps/371\" rel=\"noreferrer\">JEP 371</a>. Since Java 15, this is how lambdas are implemented.</p>\n<p>These are classes that are generated at runtime, using <code>Lookup.defineHiddenClass</code>, rather than <code>ClassLoader.defineClass</code>. Therefore, they are not loaded by a class loader.</p>\n<p>As for the output of your code, the part after the <code>@</code> is the identity hash code of the object, as usual. The part before that is the name of the hidden class, <code>Foo$$Lambda$15/0x0000000840064c40</code>. This can be separated into two parts: <code>Foo$$Lambda$15</code> is the name used in the class definition (the bytes, in the <em>class file format</em> that is passed to <code>defineHiddenClass</code>), and <code>0x0000000840064c40</code> is an unqualified name generated by the JVM. The <code>$$</code> doesn't mean anything special. <code>$</code> is a valid character to be used in a class name.</p>\n<p>Towards the end of the JEP, it discusses the lifetime of hidden classes. The gist of it is that hidden classes can be unloaded as soon as there are no longer any live instances of the class. e.g. when the object created by the lambda expression is garbage collected.</p>\n"}],"owner":{"user_id":6612731,"display_name":"RBS"},"view_count":63,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1682601194,"question_id":76120849,"body":"<p>To exploring lambda and its working, i write below code.</p>\n<pre><code>public class Foo { // enclose class\n\npublic static void main(String[] args) {\n    System.out.println(new Foo().new InnerFoo());\n    IntSupplier intSupplier = () -&gt; 42;\n    System.out.println(intSupplier);\n}\n\nclass InnerFoo{} // inner class\n\n}\n</code></pre>\n<p>After execution of code, i come across below output.</p>\n<pre><code>Foo$InnerFoo@3af49f1c\nFoo$$Lambda$15/0x0000000840064c40@13221655\n</code></pre>\n<p>i have basically 2 question based on output.</p>\n<ol>\n<li>To best of my knowledge, when every inner class is instantiated, it can be represent as <strong>EnclosingClass$InnerClass@hashcode</strong> as toString()(in case we do not override toString()). so does that mean, my <strong>Foo$$Lambda$15/0x0000000840064c40@13221655</strong> is a definition of inner class ? if is to so, than how long that inner class loaded remains in JVM ?</li>\n<li>What is an implication of <strong>$$Lambda</strong>. How JVM will interpret it ?</li>\n</ol>\n"},{"tags":["java","windows","maven"],"comments":[{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":133740244,"body":"And ... what about my second question?   And is that setting correct?"},{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":133740351,"body":"OK ... but the point is that the Windows shell etc will be using the shell&#39;s <i>effective</i> settings for %PATH% and %MAVEN_HOME% <i>for the user</i> to work out where the <code>mvn</code> command is.  Did you check what the environment variable settings were <i>in the shell</i>?"},{"owner":{"user_id":15435022,"display_name":"mattsmith5"},"edited":false,"comment_id":133740369,"body":"hi @StephenC doing &quot;set&quot; command in windows, shows the exact same as control panel"},{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":133740409,"body":"Is that in the shell running as the normal user?  Also ... did you try setting the %PATH% entry to &quot;C:\\apache-maven-3.9.1\\bin&quot; directly?"},{"owner":{"user_id":2540471,"display_name":"Robert Scholte"},"edited":false,"comment_id":133819083,"body":"How did you install it? <code>choco install maven</code> doesn&#39;t require adding/changing environment variables."},{"owner":{"user_id":2540471,"display_name":"Robert Scholte"},"edited":false,"comment_id":133819103,"body":"If you are touching the environment variables, make sure to start a new console after you applied the changes, otherwise they won&#39;t be picked up."},{"owner":{"user_id":1757756,"display_name":"Mavaddat Javid"},"edited":false,"comment_id":133899055,"body":"It&#39;s not enough to start a new console, unless you have a <a href=\"https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_profiles?view=powershell-7.3\" rel=\"nofollow noreferrer\">startup profile</a> that reads the environment variables and sets the <code>%PATH%</code>. If you don&#39;t, then you need to sign out and sign in again."},{"owner":{"user_id":5415234,"display_name":"Bernhard Stadler"},"edited":false,"comment_id":133920158,"body":"@MavaddatJavid Feel free to try it yourself: The changed environment variables are available in new console windows the second you&#39;ve clicked the &quot;OK&quot; button of the &quot;Environment Variables&quot; dialog. No need to sign off and on. Maybe that is necessary for environment variables defined via a group policy when the computer belongs to a domain, but not for environment variables defined locally using the &quot;Environment Variables&quot; dialog under the &quot;System Properties&quot;/&quot;Advanced System Settings&quot; dialog."}],"answers":[{"owner":{"user_id":5415234,"display_name":"Bernhard Stadler"},"up_vote_count":6,"is_accepted":true,"creation_date":1680026145,"answer_id":75869547,"body":"<p>Judging from your screenshots, your <strong>System</strong> PATH tries to substitute the environent variable MAVEN_HOME, which is only defined as a <strong>User</strong> environment variable. The values of the user environment variables are not available at the time the system environment variables are set, so the actual PATH will contain the unsubstituted, literal string <code>%MAVEN_HOME%\\bin</code>. Removing all user variables called MAVEN_HOME (for all users) and adding a system variable MAVEN_HOME with the correct path should resolve the issue.</p>\n<p>I can't find any current official documentation of this behavior, but the Internet Archive contains an old version of <a href=\"https://web.archive.org/web/20120112040128/https://support.microsoft.com/kb/100843\" rel=\"noreferrer\">the Windows 2000 documentation</a> with a short explanation of the mechanism under the heading &quot;How environment variables are set&quot;. The <code>autoexec.bat</code> part doesn't apply to newer versions of Windows.</p>\n"}],"owner":{"user_id":15435022,"display_name":"mattsmith5"},"view_count":196,"up_vote_count":2,"accepted_answer_id":75869547,"answer_count":1,"score":2,"creation_date":1679526501,"question_id":75817999,"body":"<p>I setup Maven properly on Windows, adding System Variable and Path Variable.\nHowever, <code>mvn -v</code> only works, if I am logged in as Administrator in CommandLine,  (not as regular user). That means I right click on command prompt and do &quot;Run as Administrator&quot;. How can I ensure mvn works for regular users? Java command doesn't have this issue on my computer.</p>\n<p><a href=\"https://i.stack.imgur.com/sUgCn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sUgCn.png\" alt=\"enter image description here\" /></a></p>\n<p><a href=\"https://i.stack.imgur.com/qWSWV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qWSWV.png\" alt=\"enter image description here\" /></a></p>\n<p>Note: I can go to the actual Maven folder as regular user in command prompt C:\\apache-maven-3.9.1 and get the verrsion.</p>\n<p><a href=\"https://i.stack.imgur.com/tKron.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tKron.png\" alt=\"enter image description here\" /></a></p>\n"},{"tags":["java","spring","rest","validation","javax-validation"],"answers":[{"owner":{"user_id":14183092,"display_name":"kerbermeister"},"up_vote_count":6,"is_accepted":true,"creation_date":1676327185,"answer_id":75441780,"body":"<p>Yes, you could write your own annotations and validators for them.</p>\n<p>Your annotation would look like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Documented\n@Constraint(validatedBy = Base64Validator.class)\n@Target( { ElementType.FIELD })\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface IsBase64 {\n    String message() default &quot;The string is not base64 string&quot;;\n    Class&lt;?&gt;[] groups() default {};\n    Class&lt;? extends Payload&gt;[] payload() default {};\n}\n</code></pre>\n<p>Constraint validator <code>javax.validation</code> implementation (I'm using here your code for the actual validation):</p>\n<pre><code>public class Base64Validator implements ConstraintValidator&lt;IsBase64, String&gt; {\n    \n    @Override\n    public boolean isValid(String value, ConstraintValidatorContext cxt) {\n        try {\n            Base64.getDecoder().decode(value);\n            return true;\n        } catch(IllegalArgumentException iae) {\n            return false;\n        }\n    }\n}\n</code></pre>\n<p>Example data class with the annotated field:</p>\n<pre><code>@Data\npublic class MyPayload {\n    @IsBase64\n    private String value;\n}\n</code></pre>\n<p>And controller method example with <code>@Valid</code> annotation which is required:</p>\n<pre><code>@PostMapping\npublic String test(@Valid @RequestBody MyPayload myPayload) {\n    return &quot;ok&quot;;\n}\n</code></pre>\n"}],"owner":{"user_id":11714220,"display_name":"Alfredo Morales"},"view_count":787,"up_vote_count":2,"accepted_answer_id":75441780,"answer_count":1,"score":2,"creation_date":1676324766,"question_id":75441493,"body":"<p>I have a rest service with my request body bean annotated with javax.validation like <code>@NotBlank @NotNull @Pattern</code> etc., and in one specific field I receive a file encoded as a <strong>string base64</strong>,</p>\n<p>so, <em>is there an annotation, or how could I write a custom validation annotation, so it would check if the string is really a base64 string?</em></p>\n<p>I just need a validation like this in annotation form:</p>\n<pre><code>try {\n    Base64.getDecoder().decode(someString);\n    return true;\n} catch(IllegalArgumentException iae) {\n    return false;\n}\n</code></pre>\n<p>thnx in advance</p>\n"},{"tags":["java","forkjoinpool"],"answers":[{"owner":{"user_id":12881733,"display_name":"Bill Mair"},"up_vote_count":2,"is_accepted":false,"creation_date":1676150567,"answer_id":75423379,"body":"<p>Don't create any threads, that is the job of the ExecutorService.</p>\n<p>You don't want to <code>execute</code> the task, you want to <code>submit</code> the task. Then you get a <code>Future&lt;T&gt;</code> returned.</p>\n<p>As you already have a collection, consider <code>invokeAll</code> that returns <code>List&lt;Future&lt;T&gt;&gt;</code> and saves you iterating through your list.</p>\n"},{"owner":{"user_id":4222206,"display_name":"Queeg"},"up_vote_count":3,"is_accepted":false,"creation_date":1676150576,"answer_id":75423381,"body":"<p>It is a bit strange that your code example contains ExecutorService.invoke and ExecutorService.execute where you should be calling <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/ExecutorService.html#submit(java.lang.Runnable)\" rel=\"nofollow noreferrer\">ExecutorService.submit</a>.</p>\n<p>The <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/ExecutorService.html\" rel=\"nofollow noreferrer\">ExecutorService documentation</a> also contains a usage example.\nAnd then there is some nice <a href=\"https://docs.oracle.com/javase/tutorial/essential/concurrency/executors.html\" rel=\"nofollow noreferrer\">Java Tutorial</a> on the topic.</p>\n"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":1,"is_accepted":true,"creation_date":1676153964,"answer_id":75423674,"body":"<h1>tl;dr</h1>\n<ul>\n<li>Change <code>execute</code> to <code>submit</code>.</li>\n<li>Await termination when shutting down an executor service.</li>\n</ul>\n<h1><code>Executor#execute</code> is not necessarily async</h1>\n<p>You need to carefully read the documentation. This is a tricky area.</p>\n<p>The <code>ExecutorService#execute</code> method is inherited from the super interface <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/Executor.html#execute(java.lang.Runnable)\" rel=\"nofollow noreferrer\"><code>Executor</code></a>.</p>\n<p>The Javadoc for <code>Executor</code> says:</p>\n<blockquote>\n<p>However, the <code>Executor</code> interface does not strictly require that execution be asynchronous</p>\n</blockquote>\n<p>So any <code>Runnable</code> you pass to <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/Executor.html#execute(java.lang.Runnable)\" rel=\"nofollow noreferrer\"><code>execute</code></a> may or <em>may not</em> be run on a background thread.</p>\n<h1><code>ExecutorService#submit</code> is always async</h1>\n<p>If you definitely want your <code>Runnable</code> to run on a background thread, pass to <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/ExecutorService.html#submit(java.lang.Runnable)\" rel=\"nofollow noreferrer\"><code>ExecutorService#submit</code></a>.</p>\n<p>Change this line:</p>\n<pre><code>threadList.forEach(executorService::execute);\n</code></pre>\n<p>… to this:</p>\n<pre><code>threadList.forEach(executorService::submit);\n</code></pre>\n<h1>Shutdown</h1>\n<p>Your call to <code>ExecutorService#shutdown</code> is insufficient. You need to wait for submitted tasks to complete.</p>\n<p>See the boilerplate method <code>shutdownAndAwaitTermination</code> given to you in the Javadoc for <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/ExecutorService.html\" rel=\"nofollow noreferrer\"><code>ExecutorService</code></a>.</p>\n<p>Or, in Java 19+, call <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/ExecutorService.html#close()\" rel=\"nofollow noreferrer\"><code>ExecutorService#close</code></a>.</p>\n"}],"owner":{"user_id":16886349,"display_name":"Kirill"},"view_count":94,"up_vote_count":2,"accepted_answer_id":75423674,"answer_count":3,"score":2,"creation_date":1676149565,"question_id":75423292,"body":"<p>I have a recursive bulk task that I put into execution in a ForkJoinPool thread pool.</p>\n<pre><code>public class SomeTask extends RecursiveAction {\n    @Override\n    protected void compute() {\n       //Some recursive logic...\n    }\n}\n\npublic class Main {\n\n    public static void main(String[] args) {\n        startForkJoinPool();\n    }\n\n    private void startForkJoinPool() {\n       SomeTask someTask = new SomeTask();\n\n       ForkJoinPool pool = new ForkJoinPool(4);\n       pool.invoke(someTask);\n       pool.shutdown();\n    }\n}\n</code></pre>\n<p>Now I need to execute this logic in two more parallel threads.</p>\n<p>I decided to try to use the ExecutorService thread pool, and when I put entities into it for execution, I found out that they are not executed in parallel, but, as it were, one of the threads is parked for the duration of the first one.</p>\n<pre><code>public class SomeTask extends RecursiveAction {\n    @Override\n    protected void compute() {\n       //Some recursive logic...\n    }\n}\n\npublic class Main {\n\n    public static void main(String[] args) {\n        List&lt;Thread&gt; threadList = new ArrayList&lt;&gt;();\n        threadList.add(new Thread(() -&gt; startForkJoinPool()));\n        threadList.add(new Thread(() -&gt; startForkJoinPool()));\n\n        ExecutorService executorService = Executors.newFixedThreadPool(2);\n        threadList.forEach(executorService::execute);\n        executorService.shutdown();\n    }\n\n    private void startForkJoinPool() {\n       SomeTask someTask = new SomeTask();\n\n       ForkJoinPool pool = new ForkJoinPool(4);\n       pool.invoke(someTask);\n       pool.shutdown();\n    }\n}\n</code></pre>\n<p>Tell me, please, what can I do wrong?\nMany thanks in advance to anyone who can point me in the right direction.</p>\n"},{"tags":["java","reflection","record","java-synthetic-methods"],"comments":[{"owner":{"user_id":865910,"display_name":"Ordiel"},"edited":false,"comment_id":132860073,"body":"I wonder if it is because its considered as <i>implicitly declared</i> being its code implicitly defined as part of the component"}],"answers":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":3,"is_accepted":false,"creation_date":1675144892,"answer_id":75293217,"body":"<blockquote>\n<p>I wonder if it is because its considered as implicitly declared being its code implicitly defined as part of the component</p>\n</blockquote>\n<p>This is exactly it. Note how the old spec only says that &quot;synthetic&quot; should be marked on constructs that</p>\n<blockquote>\n<p>do not have a corresponding construct in the source code</p>\n</blockquote>\n<p>with the exception of the implicitly declared <code>Enum.values</code> and <code>Enum.valueOf</code>. Back then, those were the only two implicitly declared (in the sense that the new spec uses the phrase) things, apparently. :D</p>\n<p>On the other hand, the new spec says</p>\n<blockquote>\n<p>does not correspond to a construct <em><strong>declared explicitly or implicitly</strong></em> in source code</p>\n</blockquote>\n<p>Note that this wording automatically handles the <code>Enum</code> exceptions, but also handles the plethora of implicitly declared things that got added since. This includes record components.</p>\n<p>From the <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-8.html#jls-8.10.3\" rel=\"nofollow noreferrer\">Java 17 spec §8.10.3. Record Members</a>,</p>\n<blockquote>\n<p>Furthermore, for each record component, a record class has a method with the same name as the record component and an empty formal parameter list. This method, which is declared explicitly or implicitly, is known as an accessor method.</p>\n<p>...</p>\n<p>If a record class has a record component for which an accessor method is not declared explicitly, then an accessor method for that record component is declared implicitly [...]</p>\n</blockquote>\n<p>The method <code>a</code> is implicitly declared in your component, therefore it is not synthetic.</p>\n<p>Generally speaking (there might be exceptions to this that I don't know of), synthetic constructs are constructs that are not <em>specified</em> by the language spec, but are required for a particular implementation of a compiler to work. The spec is basically saying that such constructs must be marked as &quot;synthetic&quot; in the binary. See some examples <a href=\"https://stackoverflow.com/a/47634858/5133585\">here</a>.</p>\n"},{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"up_vote_count":3,"is_accepted":false,"creation_date":1675149403,"answer_id":75293769,"body":"<p>Any members of a type that have the <code>synthetic</code> flag on are <strong>ignored entirely by <code>javac</code></strong>. Javac acts exactly as if those things don't exist at all.</p>\n<p>As a consequence, obviously, the 'getters' you get for a record aren't synthetic. If they were, it would be impossible to call them from <code>.java</code> code - the only way to call them is to write a hacky <code>javac</code> clone that <em>does</em> compile access to synthetics, or to use bytecode manipulation to remove the synthetic flag, or to emit bytecode directly, or to use reflection.</p>\n"}],"owner":{"user_id":865910,"display_name":"Ordiel"},"view_count":78,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1675143708,"question_id":75293090,"body":"<p>Based on the older <a href=\"https://docs.oracle.com/javase/specs/jls/se7/html/jls-13.html\" rel=\"nofollow noreferrer\">Java (7) Language Specifications (13.1.7)</a>:</p>\n<blockquote>\n<p>Any constructs introduced by a Java compiler that do not have a corresponding construct in the source code must be marked as synthetic, except for default constructors, the class initialization method, and the values and valueOf methods of the Enum class.</p>\n</blockquote>\n<p>On newer ones (<a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-13.html\" rel=\"nofollow noreferrer\">Java (17) Language Specifications (13.1.7)</a>: ) that wording changes to:</p>\n<blockquote>\n<p>A construct emitted by a Java compiler must be marked as synthetic if it does not correspond to a construct declared explicitly or implicitly in source code, unless the emitted construct is a class initialization method (JVMS §2.9).</p>\n</blockquote>\n<p>I wonder how would this apply to the accesor methods created for the components of java <a href=\"https://openjdk.org/jeps/395\" rel=\"nofollow noreferrer\">Records (JEP 395)</a></p>\n<p>For example</p>\n<pre class=\"lang-java prettyprint-override\"><code>record ARecord(int a){}\n</code></pre>\n<p>would have a method <code>int a()</code> yet there is no code representing such method, according to the wording of the older JLS such method is added by the compiler so I would expect it to be synthetic but its not, as it can be corroborated by running the following 2 lines on <a href=\"https://docs.oracle.com/javase/9/jshell/introduction-jshell.htm\" rel=\"nofollow noreferrer\"><code>JShell</code></a></p>\n<pre class=\"lang-java prettyprint-override\"><code>jshell\n|  Welcome to JShell -- Version 17.0.1\n|  For an introduction type: /help intro\n\njshell&gt; record ARecord(int a){}\n|  created record ARecord\n\njshell&gt; ARecord.class.getDeclaredMethod(&quot;a&quot;).isSynthetic();\n$2 ==&gt; false\n\njshell&gt;\n</code></pre>\n<p>The reason I ask is because I would like to use reflection (or any other programmatic mean at runtime) to determine which elements on the class have a matching code structure, basically those have code representing them, meaning:</p>\n<p>For the following code</p>\n<pre class=\"lang-java prettyprint-override\"><code>record ARecord(int a){\n\n  pubic void someMethod() {}\n\n}\n</code></pre>\n<p>that <em>entity</em> would have 2 methods (<code>a</code> and <code>someMethod</code>), <code>a</code> has no code representing it and <code>someMethod</code> does, I need a way to differentiate those based on that criteria</p>\n"},{"tags":["java","intellij-idea"],"answers":[{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"up_vote_count":3,"is_accepted":false,"creation_date":1674205485,"answer_id":75181799,"body":"<p>OpenJDK is basically a source only project (though they do release reference binaries for the first six months, which usually results in three releases, e.g. 17.0.0 - 17.0.2). After those three months, newer releases are only available through the vendors (e.g. for Java 17.0.5). All those listed <strong>are</strong> variants of OpenJDK 17 (except IBM Semeru, which is OpenJ9, which itself is a variant of OpenJDK). And bar vendor specific extras, or optional features like garbage collectors, they are basically the same, and have been tested for compliance with the Java specification.</p>\n<p>In the Java world, you pick a vendor, and use its binaries instead of the binaries from OpenJDK itself (which generally don't go further then x.0.2, while vendor specific versions continue to receive updates if they are LTS versions). Personally, I usually use Eclipse Temurin builds.</p>\n"},{"owner":{"user_id":139985,"display_name":"Stephen C"},"up_vote_count":3,"is_accepted":true,"creation_date":1674205510,"answer_id":75181805,"body":"<p>I don't know for sure the rational of the Intellij for (no longer?) including a link to a &quot;vanilla&quot; OpenJDK 17 download site.  However my guess is that it is related to this notice on the <a href=\"https://jdk.java.net/17/\" rel=\"nofollow noreferrer\">https://jdk.java.net/17/</a> release page:</p>\n<blockquote>\n<h2>JDK 17 Releases</h2>\n<p>JDK 17 has been superseded. Please visit jdk.java.net for the current version.</p>\n<p>Older releases, <strong>which do not include the most up to date security  vulnerability fixes and are no longer recommended for use in production,</strong>  remain available in the OpenJDK Archive.</p>\n</blockquote>\n<p>Note that the OpenJDK team are no longer publishing new builds for OpenJDK 17.  If you want the current Java 17 LTS build, you get it as an Oracle release or you get it from a 3rd-party vendor.  These should all include the most recent security patches.</p>\n<p>The Intellij team would be doing users a <strong>disservice</strong> if they provided an easy way for users to download an old and potentially insecure OpenJDK Java 17 build.</p>\n"}],"owner":{"user_id":9545125,"display_name":"TheStranger"},"view_count":684,"up_vote_count":2,"accepted_answer_id":75181805,"answer_count":2,"score":2,"creation_date":1674204717,"question_id":75181671,"body":"<p>I have a Spring Boot application and I'm trying to set the JDK to OpenJDK-17. I've downloaded it from Java, then I go to <strong>IDE and Project Settings</strong> &gt; <strong>Project Structure</strong> &gt; SDKs, and then I click on the '<strong>+</strong>' &gt; <strong>Download JDK</strong>. Then when I set the version to 17, I don't see OpenJDK-17 anywhere...</p>\n<p>I get the following options:</p>\n<p>Amazon Corretto <em>17.0.6</em><br>\nAzul Zulu Community <em>17.0.6</em><br>\nBellSoft Liberica JDK <em>17.0.5</em><br>\nEclipse Temurin (AdoptOpenJDK HotSpot) <em>17.0.5</em><br>\nGraalVM Community Edition <em>17</em><br>\nIBM Semeru (AdoptOpenJDK OpenJ9) <em>17.0.5</em><br>\nSAP SapMachine <em>17.0.5</em><br>\n---------<strong>Other Versions</strong>---------<br>\nOracle OpenJDK <em>19.0.2</em></p>\n"},{"tags":["java","reflection","annotation-processing"],"comments":[{"owner":{"user_id":7970787,"display_name":"Alex R"},"edited":false,"comment_id":132567823,"body":"It looks like a bug but maybe they are going to explain why it&#39;s not if you open a bug report."},{"owner":{"user_id":139985,"display_name":"Stephen C"},"edited":false,"comment_id":132567856,"body":"But this begs the question: what are you actually trying to achieve with this?  (Apart from trying to see if it ... erm ... works.)"},{"owner":{"user_id":208288,"display_name":"Laird Nelson"},"edited":false,"comment_id":132567888,"body":"It was a class encountered during some reflection-based traversal of <code>String.clasd</code>."}],"answers":[{"owner":{"user_id":2711488,"display_name":"Holger"},"up_vote_count":4,"is_accepted":false,"creation_date":1673873397,"answer_id":75134473,"body":"<p>Keep in mind, that you are looking at very special code for Java/JVM interaction. You get a hint when looking at the comment right before the source code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>/* Placeholder class for DirectMethodHandles generated ahead of time */\nfinal class Holder {}\n</code></pre>\n<p><sup>emphasis on “placeholder” and “generated”</sup></p>\n<p>When I run <code>jdk-17\\bin\\javap java.lang.invoke.DirectMethodHandle$Holder</code>, I get the following output:</p>\n<pre class=\"lang-java prettyprint-override\"><code>final class java.lang.invoke.DirectMethodHandle$Holder {\n  static int invokeInterface(java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, int);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, long);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static void invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, double);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, int, int);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, int, java.lang.Object);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, int);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, int);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, int);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, long);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, long, long);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, java.lang.Object, java.lang.Object, java.lang.Object);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, java.lang.Object, int, java.lang.Object);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, java.lang.Object, int);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, java.lang.Object, long, java.lang.Object);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, java.lang.Object, long);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, java.lang.Object, java.lang.Object);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long, java.lang.Object);\n  static long invokeSpecial(java.lang.Object, java.lang.Object, long);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object, long);\n  static int invokeSpecial(java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeSpecial(java.lang.Object, java.lang.Object);\n  static void invokeSpecial(java.lang.Object, java.lang.Object);\n  static int invokeSpecialIFC(java.lang.Object, java.lang.Object, java.lang.Object, int);\n  static int invokeSpecialIFC(java.lang.Object, java.lang.Object, int);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, double, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, double);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, int, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, int);\n  static int invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, long);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static void invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, double);\n  static int invokeStatic(java.lang.Object, int, int, int);\n  static int invokeStatic(java.lang.Object, int, int);\n  static int invokeStatic(java.lang.Object, int);\n  static java.lang.Object invokeStatic(java.lang.Object, int);\n  static long invokeStatic(java.lang.Object, long, int);\n  static long invokeStatic(java.lang.Object, long, long);\n  static long invokeStatic(java.lang.Object, long, java.lang.Object, java.lang.Object, java.lang.Object);\n  static long invokeStatic(java.lang.Object, long, java.lang.Object, int, java.lang.Object);\n  static long invokeStatic(java.lang.Object, long, java.lang.Object, long, java.lang.Object);\n  static long invokeStatic(java.lang.Object, long, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, long);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object, long);\n  static int invokeStatic(java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeStatic(java.lang.Object);\n  static void invokeStatic(java.lang.Object);\n  static java.lang.Object invokeStaticInit(java.lang.Object, java.lang.Object);\n  static void invokeVirtual(java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object invokeVirtual(java.lang.Object, java.lang.Object);\n  static java.lang.Object newInvokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object newInvokeSpecial(java.lang.Object, java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object newInvokeSpecial(java.lang.Object, int, int);\n  static java.lang.Object newInvokeSpecial(java.lang.Object, int);\n  static java.lang.Object newInvokeSpecial(java.lang.Object, java.lang.Object);\n  static java.lang.Object newInvokeSpecial(java.lang.Object);\n  static int getBoolean(java.lang.Object, java.lang.Object);\n  static int getBooleanVolatile(java.lang.Object, java.lang.Object);\n  static void putBoolean(java.lang.Object, java.lang.Object, int);\n  static void putBooleanVolatile(java.lang.Object, java.lang.Object, int);\n  static int getBoolean(java.lang.Object);\n  static int getBooleanVolatile(java.lang.Object);\n  static void putBoolean(java.lang.Object, int);\n  static void putBooleanVolatile(java.lang.Object, int);\n  static int getByte(java.lang.Object, java.lang.Object);\n  static int getByteVolatile(java.lang.Object, java.lang.Object);\n  static void putByte(java.lang.Object, java.lang.Object, int);\n  static void putByteVolatile(java.lang.Object, java.lang.Object, int);\n  static int getByte(java.lang.Object);\n  static int getByteVolatile(java.lang.Object);\n  static void putByte(java.lang.Object, int);\n  static void putByteVolatile(java.lang.Object, int);\n  static int getShort(java.lang.Object, java.lang.Object);\n  static int getShortVolatile(java.lang.Object, java.lang.Object);\n  static void putShort(java.lang.Object, java.lang.Object, int);\n  static void putShortVolatile(java.lang.Object, java.lang.Object, int);\n  static int getShort(java.lang.Object);\n  static int getShortVolatile(java.lang.Object);\n  static void putShort(java.lang.Object, int);\n  static void putShortVolatile(java.lang.Object, int);\n  static int getChar(java.lang.Object, java.lang.Object);\n  static int getCharVolatile(java.lang.Object, java.lang.Object);\n  static void putChar(java.lang.Object, java.lang.Object, int);\n  static void putCharVolatile(java.lang.Object, java.lang.Object, int);\n  static int getChar(java.lang.Object);\n  static int getCharVolatile(java.lang.Object);\n  static void putChar(java.lang.Object, int);\n  static void putCharVolatile(java.lang.Object, int);\n  static int getInt(java.lang.Object, java.lang.Object);\n  static int getIntVolatile(java.lang.Object, java.lang.Object);\n  static void putInt(java.lang.Object, java.lang.Object, int);\n  static void putIntVolatile(java.lang.Object, java.lang.Object, int);\n  static int getInt(java.lang.Object);\n  static int getIntVolatile(java.lang.Object);\n  static void putInt(java.lang.Object, int);\n  static void putIntVolatile(java.lang.Object, int);\n  static long getLong(java.lang.Object, java.lang.Object);\n  static long getLongVolatile(java.lang.Object, java.lang.Object);\n  static void putLong(java.lang.Object, java.lang.Object, long);\n  static void putLongVolatile(java.lang.Object, java.lang.Object, long);\n  static long getLong(java.lang.Object);\n  static long getLongVolatile(java.lang.Object);\n  static void putLong(java.lang.Object, long);\n  static void putLongVolatile(java.lang.Object, long);\n  static float getFloat(java.lang.Object, java.lang.Object);\n  static float getFloatVolatile(java.lang.Object, java.lang.Object);\n  static void putFloat(java.lang.Object, java.lang.Object, float);\n  static void putFloatVolatile(java.lang.Object, java.lang.Object, float);\n  static float getFloat(java.lang.Object);\n  static float getFloatVolatile(java.lang.Object);\n  static void putFloat(java.lang.Object, float);\n  static void putFloatVolatile(java.lang.Object, float);\n  static double getDouble(java.lang.Object, java.lang.Object);\n  static double getDoubleVolatile(java.lang.Object, java.lang.Object);\n  static void putDouble(java.lang.Object, java.lang.Object, double);\n  static void putDoubleVolatile(java.lang.Object, java.lang.Object, double);\n  static double getDouble(java.lang.Object);\n  static double getDoubleVolatile(java.lang.Object);\n  static void putDouble(java.lang.Object, double);\n  static void putDoubleVolatile(java.lang.Object, double);\n  static java.lang.Object getReference(java.lang.Object, java.lang.Object);\n  static java.lang.Object getReferenceVolatile(java.lang.Object, java.lang.Object);\n  static void putReference(java.lang.Object, java.lang.Object, java.lang.Object);\n  static void putReferenceVolatile(java.lang.Object, java.lang.Object, java.lang.Object);\n  static java.lang.Object getReference(java.lang.Object);\n  static java.lang.Object getReferenceVolatile(java.lang.Object);\n  static void putReference(java.lang.Object, java.lang.Object);\n  static void putReferenceVolatile(java.lang.Object, java.lang.Object);\n}\n</code></pre>\n<p>which is a strong hint that the class is not the one you get by compiling the empty one-line definition. It seems that the generator for this actual class file did not care to produce an equivalent <a href=\"https://docs.oracle.com/javase/specs/jvms/se17/html/jvms-4.html#jvms-4.7.6\" rel=\"nofollow noreferrer\"><code>InnerClasses</code> attribute</a> for the replacement class file. Since this attribute has no impact on the actual execution of the code, it shouldn’t matter.</p>\n<p>So there’s no bug, neither in the compiler nor reflections, the mismatch is caused by the fact that the class does not originate from the source code.</p>\n"},{"owner":{"user_id":3699139,"display_name":"Jorn Vernee"},"up_vote_count":2,"is_accepted":false,"creation_date":1674051951,"answer_id":75160735,"body":"<p>As Holger already said, the class file does not correspond to the source code. This class file is overwritten with a different one by a jlink plugin that runs when the JDK is created.</p>\n<p><a href=\"https://github.com/openjdk/jdk/blob/754f6e6116b8889c49abf34d01f6fc3e9f1b3cb7/src/jdk.jlink/share/classes/jdk/tools/jlink/internal/plugins/GenerateJLIClassesPlugin.java#L157-L164\" rel=\"nofollow noreferrer\">There are several such holder classes in the jdk</a>:</p>\n<pre><code>private static final String DIRECT_METHOD_HOLDER_ENTRY =\n        &quot;/java.base/java/lang/invoke/DirectMethodHandle$Holder.class&quot;;\nprivate static final String DELEGATING_METHOD_HOLDER_ENTRY =\n        &quot;/java.base/java/lang/invoke/DelegatingMethodHandle$Holder.class&quot;;\nprivate static final String BASIC_FORMS_HOLDER_ENTRY =\n        &quot;/java.base/java/lang/invoke/LambdaForm$Holder.class&quot;;\nprivate static final String INVOKERS_HOLDER_ENTRY =\n        &quot;/java.base/java/lang/invoke/Invokers$Holder.class&quot;;\n</code></pre>\n<p>These hold the contents of certain pre-generated <code>java.lang.invoke</code> implementation classes. Pre-generating these classes during jlink-time avoids having to generate them at runtime. So, this is essentially done for performance reasons.</p>\n"}],"owner":{"user_id":208288,"display_name":"Laird Nelson"},"view_count":121,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1673756622,"question_id":75122911,"body":"<p>Consider the <a href=\"https://github.com/openjdk/jdk/blob/jdk-19+36/src/java.base/share/classes/java/lang/invoke/DirectMethodHandle.java#L938\" rel=\"nofollow noreferrer\"><code>DirectMethodHandle$Holder</code> class</a>.  (It is one of the classes returned by <code>Class.forName(&quot;java.lang.invoke.DirectMethodHandle&quot;).getDeclaredClasses()</code>, which is <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/Class.html#getDeclaredClasses()\" rel=\"nofollow noreferrer\">documented to return member classes</a>.)</p>\n<p>The following assertion fails under JDK 19:</p>\n<pre><code>assert Class.forName(&quot;java.lang.invoke.DirectMethodHandle$Holder&quot;).isMemberClass();\n</code></pre>\n<p>Why? Which <a href=\"https://docs.oracle.com/javase/specs/jls/se19/html/jls-8.html#jls-8.5\" rel=\"nofollow noreferrer\">rule of section 8.5</a> does it violate?</p>\n<p>Like some of the commenters, I am coming to the conclusion that this is a very weird bug.  For example, using some <code>javax.annotation.processing</code> and some <code>javax.lang.model.*</code> classes, the following assertion does not fail:</p>\n<pre><code>assert NestingKind.MEMBER == ((TypeElement)processingEnvironment.getElementUtils().getTypeElement(&quot;java.lang.invoke.DirectMethodHandle.Holder&quot;)).getNestingKind();\n</code></pre>\n<p>So the outputs of the mechanisms underpinning the compiler do not agree with the outputs of the reflection machinery. I've <a href=\"https://bugs.java.com/bugdatabase/view_bug.do?bug_id=JDK-8300181\" rel=\"nofollow noreferrer\">filed a bug against the JDK</a>.</p>\n"},{"tags":["java","android","datetime","datetime-comparison"],"comments":[{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132425757,"body":"Do we know in which time zone that string was created? Depending on time zone it may denote a time within a span of some 26 hours."},{"owner":{"user_id":10074628,"display_name":"DealZg"},"edited":false,"comment_id":132425766,"body":"The time zone is in Europe. Like Austria"},{"owner":{"user_id":3824919,"display_name":"Tom"},"edited":false,"comment_id":132425775,"body":"How would you do that if you tell you a time and you&#39;re supposed to check if a certain amount of minutes as passed? I guess you would &quot;parse&quot; my information as a datetime and then compare the time difference with &quot;now()&quot;? Java/Android can do that as well and those steps are researchable. Have you done some research? Tried anything?"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132425842,"body":"<code>LocalDateTime.parse(&quot;Sa. 07.01.2023 16:39:15&quot;, DateTimeFormatter.ofPattern(&quot;E dd.MM.uuuu H:mm:ss&quot;, Locale.GERMAN)) .atZone(ZoneId.systemDefault()) .plusMinutes(1) .isBefore(ZonedDateTime.now())</code>."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132425903,"body":"Or instead of <code>ZoneId.systemDefault()</code>  we need to give <code>ZoneId.of(&quot;Europe&#47;Vienna&quot;)</code> if you know that this is the server’s time zone."},{"owner":{"user_id":10074628,"display_name":"DealZg"},"edited":false,"comment_id":132426215,"body":"it allways shows false"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132435709,"body":"Weird. It produces <code>true</code> on my Java 18. Happy that you accepted the answer, though. I take it to mean you got your question answered."}],"answers":[{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"up_vote_count":6,"is_accepted":true,"creation_date":1673108343,"answer_id":75041882,"body":"<ol>\n<li>Parse the given date-time string into a <code>LocalDateTime</code>.</li>\n<li>Convert the obtained <code>LocalDateTime</code> into a <code>ZonedDateTime</code> by applying a <code>ZoneId</code>.</li>\n<li>Get the current <code>ZonedDateTime</code> in the applied <code>ZoneId</code>.</li>\n<li>Finally, find the minutes between the current <code>ZonedDateTime</code> and the <code>ZonedDateTime</code> obtained from the date-time string.</li>\n</ol>\n<p><strong>Demo</strong>:</p>\n<pre><code>import java.time.LocalDateTime;\nimport java.time.ZoneId;\nimport java.time.ZonedDateTime;\nimport java.time.format.DateTimeFormatter;\nimport java.time.temporal.ChronoUnit;\nimport java.util.Locale;\n\nclass Main {\n    public static void main(String[] args) {\n        String strDateTime = &quot;Sa. 07.01.2023 16:39:15&quot;;\n\n        DateTimeFormatter parser = DateTimeFormatter.ofPattern(&quot;EEE dd.MM.uuuu HH:mm:ss&quot;, Locale.GERMAN);\n\n        // Note: change the ZoneId as per your requirement\n\n        ZonedDateTime zdt = LocalDateTime.parse(strDateTime, parser)\n                                         .atZone(ZoneId.of(&quot;Europe/Vienna&quot;));\n        System.out.println(&quot;Date-time received from the server: &quot; + zdt);\n\n        ZonedDateTime now = ZonedDateTime.now(zdt.getZone());\n        System.out.println(&quot;Current date-time: &quot; + now);\n\n        System.out.println(ChronoUnit.MINUTES.between(zdt, now) &gt; 1);\n    }\n}\n</code></pre>\n<p><strong>Output from a sample run</strong>:</p>\n<pre><code>Date-time received from the server: 2023-01-07T16:39:15+01:00[Europe/Vienna]\nCurrent date-time: 2023-01-07T17:33:04.140599+01:00[Europe/Vienna]\ntrue\n</code></pre>\n<p><a href=\"https://ideone.com/o0ChQR\" rel=\"nofollow noreferrer\"><kbd>ONLINE DEMO</kbd></a></p>\n<p>Learn more about the modern Date-Time API from <strong><a href=\"https://docs.oracle.com/javase/tutorial/datetime/index.html\" rel=\"nofollow noreferrer\">Trail: Date Time</a></strong>.</p>\n<hr />\n<p>Incorporating the following valuable alternative solution <a href=\"https://stackoverflow.com/questions/75041789/how-to-check-for-this-date-time-pattern-if-some-minutes-are-over-for-java-androi/75041882#comment132426811_75041882\">suggested by Basil Bourque</a>:</p>\n<blockquote>\n<p>Might be more clear if you switch to <code>Instant</code> objects at the end.\nExtract an <code>Instant</code> from your first <code>ZonedDateTime</code>, and change\n<code>ZonedDateTime now</code> to <code>Instant now</code>.</p>\n</blockquote>\n<pre><code>class Main {\n    public static void main(String[] args) {\n        String strDateTime = &quot;Sa. 07.01.2023 16:39:15&quot;;\n\n        DateTimeFormatter parser = DateTimeFormatter.ofPattern(&quot;EEE dd.MM.uuuu HH:mm:ss&quot;, Locale.GERMAN);\n\n        // Note: change the ZoneId as per your requirement\n\n        Instant instantParsed = LocalDateTime.parse(strDateTime, parser)\n                                             .atZone(ZoneId.of(&quot;Europe/Vienna&quot;))\n                                             .toInstant();\n        System.out.println(&quot;Instant received from the server: &quot; + instantParsed);\n\n        Instant instantNow = Instant.now();\n        System.out.println(&quot;Current instant: &quot; + instantNow);\n\n        System.out.println(ChronoUnit.MINUTES.between(instantParsed, instantNow) &gt; 1);\n    }\n}\n</code></pre>\n<p><a href=\"https://ideone.com/KUFq0c\" rel=\"nofollow noreferrer\"><kbd>ONLINE DEMO</kbd></a></p>\n"}],"owner":{"user_id":10074628,"display_name":"DealZg"},"view_count":117,"up_vote_count":3,"accepted_answer_id":75041882,"answer_count":1,"score":2,"creation_date":1673107646,"question_id":75041789,"body":"<p>I receive this Date Time pattern from Server as a string.</p>\n<blockquote>\n<p>Sa. 07.01.2023 16:39:15</p>\n</blockquote>\n<p>Now i want to check if 1 minute is over.\nLike if the gap between the current time and the time (received as a string) from server is\nlonger than a minute.</p>\n<p>The time zone is in Europe. Like Austria.</p>\n"},{"tags":["java","jvm"],"comments":[{"owner":{"user_id":10871900,"display_name":"dan1st"},"edited":false,"comment_id":132368618,"body":"you could try reflectively getting the <code>classes</code> field of all existing <code>ClassLoader</code> instances but that might not work in newer Java versions (and is inherently unsafe)."},{"owner":{"user_id":10871900,"display_name":"dan1st"},"edited":false,"comment_id":132368668,"body":"But the actual question is: Why do you need this? This question seems like an <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">XY problem</a>."},{"owner":{"user_id":19964219,"display_name":"TheOneAndOnlyDanSan"},"edited":false,"comment_id":132369471,"body":"@dan1st i know this is a stupid answer but i have no reason to do this i just want to. i tryed getting the classes from the field in ClassLoader but i need the instance of the classloader which is a problem with custom ClassLoader also not all ClassLoaders save the classes (the bootloader and some custom ClassLoader)"},{"owner":{"user_id":10871900,"display_name":"dan1st"},"edited":false,"comment_id":132369779,"body":"theoretically, you could do some sort of memory dump and parse it."},{"owner":{"user_id":5646962,"display_name":"Thomas Kl&#228;ger"},"edited":false,"comment_id":132371057,"body":"Executing <code>jcmd &lt;pid&gt; VM.class_hierarchy</code> (replacing &lt;pid&gt; with the process id of some java process) prints a hierarchical listing of the loaded classes to stdout."},{"owner":{"user_id":19964219,"display_name":"TheOneAndOnlyDanSan"},"edited":false,"comment_id":132371542,"body":"i used jmap -dump"}],"answers":[{"owner":{"user_id":3448419,"display_name":"apangin"},"up_vote_count":6,"is_accepted":true,"creation_date":1672867019,"answer_id":75011440,"body":"<p>Here is a solution specific to HotSpot JVM.<br />\nWorks all JDK versions from 8 to 20.</p>\n<p>The output is equivalent to what is printed by <a href=\"https://stackoverflow.com/questions/49490073/what-does-jmap-histo-pid-print-exactly\"><code>jmap -histo:all</code></a>, but instead of printing to stdout, the result is returned as a <code>String</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static String getAllClassNames() throws JMException {\n    return (String) ManagementFactory.getPlatformMBeanServer().invoke(\n            new ObjectName(&quot;com.sun.management:type=DiagnosticCommand&quot;),\n            &quot;gcClassHistogram&quot;,\n            new Object[]{new String[]{&quot;-all&quot;}},\n            new String[]{&quot;[Ljava.lang.String;&quot;});\n}\n</code></pre>\n"}],"owner":{"user_id":19964219,"display_name":"TheOneAndOnlyDanSan"},"view_count":99,"up_vote_count":2,"accepted_answer_id":75011440,"answer_count":1,"score":2,"creation_date":1672851239,"question_id":75008706,"body":"<p>I'm trying to get a full list of <em>all</em> the classes loaded in the JVM including the classes loaded by the bootloader, platformclassloader and custom class loaders.  Without using the Instrumentation API.</p>\n<p>The methods exposed by the regular classLoaders return only the classes available in the package reference graph starting from the main function.   So I'm unable to get the list of classes loaded dynamically at runtime, and also can't get classes loaded by the bootloader and platformclassloader.</p>\n<p>I'm aware of the Instrumentation API but can't control the commandline arguements passed to the JVM so it's not an option for me.</p>\n<p>I don't have any specific Java version constraints so I can take any solution on any 'live' version (lets say &gt;=9)</p>\n"},{"tags":["java","date","date-formatting","localdate"],"comments":[{"owner":{"user_id":45364,"display_name":"Sean"},"edited":false,"comment_id":132344195,"body":"My idea is to use <code>DateTimeFormatBuilder.getLocalizedDateTimePattern(FormatStyl&zwnj;&#8203;e.FULL, ...)</code>, parse that string use the results containing E, d, and L."},{"owner":{"user_id":45364,"display_name":"Sean"},"edited":false,"comment_id":132344464,"body":"I&#39;m not trying to parse a date. I have a <code>LocalDate</code> that I&#39;m attempting to display according to rules of the user&#39;s locale. I&#39;m sorry that that wasn&#39;t obvious in my question. Do you think there&#39;s a better way for me to word this?"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132345141,"body":"It seems to me that <code>DateTimeFormatter.ofLocalizedDate()</code> will give you what you want. Or close enough that you and your users can live with it."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132345736,"body":"I don’t see any French example on the page you are linking to. I could suspect that you are inventing a requirement that doesn’t agree with what your French-speaking users want? Java’s localized formats are based on a much more thorough research than you will ever be able to carry out."}],"answers":[{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"up_vote_count":4,"is_accepted":false,"creation_date":1672760812,"answer_id":74995567,"body":"<p>Not as a pattern, no. A pattern encodes order, for example - it is not possible to have one pattern such that 'in french' it'll stick the month <em>after</em> the date-of-month, and 'in english' it'll be reversed. At best, the localization of a <em>single pattern</em> translates names; a single pattern can produce both <code>Tue, Jan 3</code> as well as <code>Mar., janv. 3</code>. Which isn't what you want.</p>\n<p>The method you're looking for is <a href=\"https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#ofLocalizedDate-java.time.format.FormatStyle-\" rel=\"nofollow noreferrer\"><code>ofLocalizedDate(dateStyle)</code></a>. This produces a DTF instance that is 'lazy' - it doesn't <em>have</em> a pattern, it simply knows 'I need whatever passes for 'medium standard format' in locale X' where X is the locale of the DTF.</p>\n<p>There is no pattern that encodes this behaviour.</p>\n<pre><code>for (var locale : List.of(Locale.ENGLISH, Locale.FRENCH)) {\n  for (var style : FormatStyle.values()) {\n    var dtf = DateTimeFormatter.ofLocalizedDate(style).withLocale(locale);\n    System.out.printf(&quot;%s %s: %s\\n&quot;, locale, style, dtf.format(LocalDate.of(2023, 1, 3)));\n  }\n}\n</code></pre>\n<p>ends up printing:</p>\n<pre><code>en FULL: Tuesday, January 3, 2023\nen LONG: January 3, 2023\nen MEDIUM: Jan 3, 2023\nen SHORT: 1/3/23\nfr FULL: mardi 3 janvier 2023\nfr LONG: 3 janvier 2023\nfr MEDIUM: 3 janv. 2023\nfr SHORT: 03/01/2023\n</code></pre>\n<p>Which shows the dynamic nature of this <code>ofLocalizedDate</code> variant of DTF.</p>\n<p>A thing to keep in mind that DateTimeFormatter is not <strong>necessarily</strong> a pattern-based concept. Patterns are merely one way to make them. That way does not allow you to change what they look like by calling <code>.withLocale</code>. Other ways of making DTFs, such as <code>.ofLocalizedDate</code>, <em>do</em> allow it.</p>\n<p>If you're storing a thing in a database or asking the user for something, then you'd have to make a divergent option: The user first picks if they want 'pattern' or 'style', so you store this (an enum col in your DB, or a radiobutton set in your UI), and then depending on what they picked, either store a style value (FULL, LONG, MEDIUM, or SHORT) - again a radio buttonset in a UI or again an enum in a db col, or, you store the pattern (string/VARCHAR/TEXT/JTextField, something along those lines). Depending on the 'style' you construct a DTF instance from such stored preferences by checking for the 'variant' option (style or pattern) and invoking either <code>.ofPattern</code> or <code>.ofLocalizedDate</code>. While you're at it, you might want that original radiobutton set ('pattern' or 'style') to also include ISO8601 style.</p>\n<p>NB: There is a reason the DTF class does <em>not</em> have a <code>.getPattern()</code> method; that's because not all DTF instances have one.</p>\n"},{"owner":{"user_id":1898563,"display_name":"Michael"},"up_vote_count":2,"is_accepted":false,"creation_date":1672762922,"answer_id":74995941,"body":"<p>I think it's very difficult without manually enumerating them. The JDK uses Locale data from Unicode, so it's limited by which formats are in its source data, for example these: <a href=\"https://github.com/openjdk/jdk/blob/master/make/data/cldr/common/main/en_GB.xml#L144\" rel=\"nofollow noreferrer\">https://github.com/openjdk/jdk/blob/master/make/data/cldr/common/main/en_GB.xml#L144</a></p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dateFormats&gt;\n    &lt;dateFormatLength type=&quot;full&quot;&gt;\n        &lt;dateFormat&gt;\n            &lt;pattern&gt;EEEE, MMMM d, y G&lt;/pattern&gt;\n            &lt;datetimeSkeleton&gt;GyMMMMEEEEd&lt;/datetimeSkeleton&gt;\n        &lt;/dateFormat&gt;\n    &lt;/dateFormatLength&gt;\n    &lt;dateFormatLength type=&quot;long&quot;&gt;\n        &lt;dateFormat&gt;\n            &lt;pattern&gt;MMMM d, y G&lt;/pattern&gt;\n            &lt;datetimeSkeleton&gt;GyMMMMd&lt;/datetimeSkeleton&gt;\n        &lt;/dateFormat&gt;\n    &lt;/dateFormatLength&gt;\n    &lt;dateFormatLength type=&quot;medium&quot;&gt;\n        &lt;dateFormat&gt;\n            &lt;pattern&gt;MMM d, y G&lt;/pattern&gt;\n            &lt;datetimeSkeleton&gt;GyMMMd&lt;/datetimeSkeleton&gt;\n        &lt;/dateFormat&gt;\n    &lt;/dateFormatLength&gt;\n    &lt;dateFormatLength type=&quot;short&quot;&gt;\n        &lt;dateFormat&gt;\n            &lt;pattern&gt;M/d/y GGGGG&lt;/pattern&gt;\n            &lt;datetimeSkeleton&gt;GGGGGyMd&lt;/datetimeSkeleton&gt;\n        &lt;/dateFormat&gt;\n    &lt;/dateFormatLength&gt;\n&lt;/dateFormats&gt;\n</code></pre>\n<p>The only date format which includes day-of-week at all is the so-called &quot;full&quot; format, and that uses the entire word, not an abbreviation for the word.</p>\n<p>With that in mind, here's a horrendously hacky solution that works for your 2 examples, and probably fails for lots of others. If you want to use it, I'd suggest unit testing it with a bunch of common Locales.</p>\n<p>It works by getting the &quot;full&quot; pattern and manipulating it a bit.</p>\n<pre><code>private static DateTimeFormatter getLocalDayMonthFormatter(Locale locale) {\n    String localizedDateTimePattern = DateTimeFormatterBuilder.getLocalizedDateTimePattern(\n        FormatStyle.FULL, null, Chronology.ofLocale(locale), locale\n    );\n    String pattern = localizedDateTimePattern\n        .replaceAll(&quot;[^MdE\\\\s,.]&quot;, &quot; &quot;)    // Remove anything except month, days, spaces, commas and periods\n        .replaceAll(&quot;(.)\\\\1{3}&quot;, &quot;$1$1$1&quot;) // Replace any char that occurs 4 times with 3 of them\n        .replaceAll(&quot;\\\\s+&quot;, &quot; &quot;)           // Conflate spaces\n        .trim()\n        .replaceAll(&quot;,$&quot;, &quot;&quot;);             // If there's a trailing comma, e.g. because of removal of the year, delete it\n    return DateTimeFormatter.ofPattern(pattern, locale);\n}\n</code></pre>\n<p>Sample usage:</p>\n<pre><code>DateTimeFormatter formatter = getLocalDayMonthFormatter(Locale.US);\nSystem.out.println(formatter.format(LocalDate.now()));\n</code></pre>\n"},{"owner":{"user_id":4222206,"display_name":"Queeg"},"up_vote_count":2,"is_accepted":false,"creation_date":1672766575,"answer_id":74996618,"body":"<p>If you have an internationalized application, just have an internationalized version of your date pattern. Depending on the configured locale the right formatting would be pulled and used to format your date.</p>\n<p>In case of an internationalized application you are doing this for all the strings the UI would display anyway, so it is a piece of cake.</p>\n"}],"owner":{"user_id":45364,"display_name":"Sean"},"view_count":129,"up_vote_count":3,"answer_count":3,"score":2,"creation_date":1672759371,"question_id":74995307,"body":"<p>My goal is to display a date in a format like:</p>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Country</th>\n<th>example</th>\n<th>pattern</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>US</td>\n<td>Tue, Jan 3</td>\n<td>EEE, LLL d</td>\n</tr>\n<tr>\n<td>France</td>\n<td>mar. 3 janv.</td>\n<td>EEE d LLL</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>I'm using <code>DateTimeFormatter.ofPattern</code> to format my dates.</p>\n<p>Is there a way to implement this without writing the pattern for every locale?</p>\n<p>Edit:  I'll be very specific with my use case: I'm trying to format a <code>LocalDate</code> to implement this date picker: <a href=\"https://m3.material.io/components/date-pickers/specs#84872587-cdca-4d06-9906-ed2dc2b35b99\" rel=\"nofollow noreferrer\">m3.material.io/components/date-pickers/… </a></p>\n"},{"tags":["java","javafx","datepicker","javafx-css"],"answers":[{"owner":{"display_name":"user18773012"},"up_vote_count":5,"is_accepted":true,"creation_date":1682961537,"answer_id":76148825,"body":"<p>To remove the blue effect, write this code in your CSS</p>\n<pre><code>.date-picker:focused {\n    -fx-faint-focus-color: transparent;\n    -fx-focus-color: transparent;\n}\n</code></pre>\n"}],"owner":{"user_id":19802322,"display_name":"Mira"},"view_count":41,"up_vote_count":2,"accepted_answer_id":76148825,"answer_count":1,"score":2,"creation_date":1682960063,"question_id":76148667,"body":"<p>Is there a way to change the default color that makes the DatePicker's textField appear to be highlighted in blue when it's clicked?\n<a href=\"https://i.stack.imgur.com/733jE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/733jE.png\" alt=\"See image\" /></a></p>\n<p>I have read all related questions that I came accross after hours of searching, and have modified all other elements, but I couldn't find anything on how to style this one. Still nothing after reading the <a href=\"https://gist.github.com/maxd/63691840fc372f22f470\" rel=\"nofollow noreferrer\">modena stylesheet</a>, and the <a href=\"https://docs.oracle.com/javase/8/javafx/api/javafx/scene/doc-files/cssref.html#datepicker\" rel=\"nofollow noreferrer\">oracle docs</a>.</p>\n<p>Here is the current CSS as seen in the picture:</p>\n<pre><code>.date-picker .arrow-button {\n    -fx-background-color: black;\n    -fx-background-radius: 0;\n}\n.date-picker .arrow-button:hover {\n    -fx-background-color: #585858ff;\n}\n.date-picker .arrow-button .arrow {\n    -fx-background-color: white;\n}\n.date-picker .arrow-button .arrow:hover {\n    -fx-background-color: #585858ff;\n}\n.date-picker .cell {\n    -fx-background-color: white;\n}\n.date-picker .cell:hover {\n    -fx-background-color: #a5a5a5;\n}\n.date-picker .cell:focused {\n    -fx-background-color: #a5a5a5;\n}\n.date-picker .selected {\n    -fx-background-color: #a5a5a5;\n    -fx-text-fill: white;\n}\n.date-picker .selected:focused {\n    -fx-background-color: #585858ff;\n    -fx-text-fill: white;\n}\n.date-picker-popup  {\n    -fx-border-color: transparent;\n}\n.date-picker-popup .month-year-pane {\n    -fx-background-color: #a5a5a5;\n}\n.date-picker-popup .month-year-pane .label {\n    -fx-text-fill: white;\n}\n.date-picker-popup .week-number-cell {\n    -fx-text-fill: white;\n}\n.date-picker-popup .spinner .button .left-arrow,\n.date-picker-popup .spinner .button .right-arrow {\n        -fx-background-color: white;\n} \n.date-picker-popup .spinner .button .left-arrow:hover,\n.date-picker-popup .spinner .button .right-arrow:hover {\n    -fx-background-color: #585858ff;\n} \n.date-picker-popup .spinner .button,\n.date-picker-popup .spinner .button {\n    -fx-background-color: transparent;\n}\n.date-picker .text-field {\n    -fx-control-inner-background: black;\n    -fx-text-fill: #a5a5a5;\n}\n</code></pre>\n<p>It might just be me overlooking something minor here, but any help would be appreciated regardless.</p>\n"},{"tags":["java","spring","spring-boot","atomic-long"],"comments":[{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":134225447,"body":"How are you going to restore the state of <code>AtomicLong</code> after restart?"},{"owner":{"user_id":3128213,"display_name":"George Lords of Castle"},"edited":false,"comment_id":134225575,"body":"I got what you mean. Actually, it is thought to clean the DB on restart, so there are no risks of &quot;id collisions&quot; on saving."}],"answers":[{"owner":{"user_id":20317450,"display_name":"Bastian Hologne"},"up_vote_count":2,"is_accepted":false,"creation_date":1682503584,"answer_id":76109523,"body":"<p>Personally I think that using UUIDs is a better solution. They are exactly designed for this use case.</p>\n<p>Here is a an article about UUID in Java :  <a href=\"https://www.baeldung.com/java-uuid\" rel=\"nofollow noreferrer\">https://www.baeldung.com/java-uuid</a></p>\n"},{"owner":{"user_id":217324,"display_name":"Nathan Hughes"},"up_vote_count":3,"is_accepted":true,"creation_date":1682507886,"answer_id":76110117,"body":"<p>No, that's the wrong way to go.  Most applications need to be able to stand up multiple instances of an application for availability, once there is a second instance of your service the ids won't be unique.</p>\n<p>Even if this is homework, it's an opportunity to learn how to do this. Picking the wrong way to allocate ids has made huge problems for real world projects so this is a good thing to know.</p>\n<p>There's already an easy, normal way to do this.\nPut a  @GeneratedValue annotation on the ID field of the entity, and have the database generate the ID using sequences or setting up the column as an identity, depending on the database, some have identity, some have sequences. See this tutorial <a href=\"https://www.baeldung.com/hibernate-identifiers\" rel=\"nofollow noreferrer\">https://www.baeldung.com/hibernate-identifiers</a>, or this very detailed one  <a href=\"https://jpa-buddy.com/blog/the-ultimate-guide-on-db-generated/\" rel=\"nofollow noreferrer\">https://jpa-buddy.com/blog/the-ultimate-guide-on-db-generated/</a> (Spring doesn't do anything with this actually, it's all JPA). The database can make sure these ids will be unique.</p>\n"}],"owner":{"user_id":3128213,"display_name":"George Lords of Castle"},"view_count":62,"up_vote_count":2,"accepted_answer_id":76110117,"answer_count":2,"score":2,"creation_date":1682501940,"question_id":76109284,"body":"<p>I am working on a SpringBoot application.\nThe strict requirement I have is to generate <em><strong>server-side</strong></em> a <em><strong>numeric id</strong></em> for an entity and then persist it through the repository.\nSince each @Service is stateless and so a singleton, is the usage of an AtomicLong a good way to implement it?</p>\n<p>Here is my code.</p>\n<p>In the service, I have this field</p>\n<pre><code>private final AtomicLong currentId = new AtomicLong();\n</code></pre>\n<p>In the service in the called method, I use the repository to persist data in this way:</p>\n<pre><code>myEntityRepository.save(MyEntity.builder()\n    .id(currentIdNumber.incrementAndGet())\n    //.... defining other fields\n    .build());\n</code></pre>\n<p>If the code I provided is not enough to answer me, I will happily edit my question according to the comments.</p>\n"},{"tags":["java","generics"],"answers":[{"owner":{"user_id":9513184,"display_name":"Unmitigated"},"up_vote_count":5,"is_accepted":true,"creation_date":1682052412,"answer_id":76069969,"body":"<p>You can use <code>&amp;</code> to ensure that <code>T</code> is an <code>enum</code> and implements <code>A</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>class C&lt;T extends Enum&lt;T&gt; &amp; A&gt; {\n    public C(Class&lt;T&gt; t) {\n        T test = Enum.valueOf(t, &quot;TEST&quot;);\n    }\n}\n</code></pre>\n"}],"owner":{"user_id":1650913,"display_name":"Scoopta"},"view_count":54,"up_vote_count":2,"accepted_answer_id":76069969,"answer_count":1,"score":2,"creation_date":1682050724,"question_id":76069867,"body":"<p>I have a setup like this</p>\n<pre><code>interface A {}\n\nenum B implements A {\n    TEST;\n}\n\nclass C&lt;T extends Enum&lt;? extends A&gt;&gt; {\n    public C(T t) {\n        T test = (T) T.valueOf(t.getClass(), &quot;TEST&quot;);\n    }\n}\n</code></pre>\n<p>which works...however ideally I'd like to change C to be something like</p>\n<pre><code>class C&lt;T extends Enum&lt;? extends A&gt;&gt; {\n    public C(Class&lt;T&gt; t) {\n        T test = (T) T.valueOf(t, &quot;TEST&quot;);\n    }\n}\n</code></pre>\n<p>however doing the second doesn't compile. What is the correct Class&lt;&gt; generic to use here? <code>Class&lt;? extends Enum&gt;</code> works but then I get a warning about a raw generic. Using <code>Class&lt;? extends Enum&lt;?&gt;&gt;</code> brings me back to an error. I know I can just use the first option and call <code>getClass()</code>, or even just suppress the warning for the raw generic but I want to understand what the correct generic type is...or am I just in Java generics hell and is there no right answer without suppressing the warning?</p>\n"},{"tags":["java"],"answers":[{"owner":{"user_id":139985,"display_name":"Stephen C"},"up_vote_count":5,"is_accepted":true,"creation_date":1680929130,"answer_id":75963353,"body":"<blockquote>\n<p>I don't understand why the 64 bit VM did not start pointer compression when checking the memory usage of the object ...</p>\n</blockquote>\n<p>The JVM doesn't dynamically start pointer compression; e.g. <em>&quot;... did not <strong>start</strong> pointer compression <strong>when checking the memory usage of the object</strong>...&quot;</em></p>\n<p>Rather, it decides whether or not to use compressed oops when the (64 bit) JVM starts.  It decides based on the command line options; i.e. <code>UseCompressedOops</code>, <code>ObjectAlignmentInBytes</code> and the maximum heap size.  The maximum heap size is either given by <code>-xmx</code> or determined by a platform-specific default algorithm.</p>\n<p>So ... you would need to look at the (actual and default) JVM options for your JVM to figure out why compressed oops are (apparently) not in effect.  Use <code>-XX:+PrintCommandLineFlags</code> to find out.</p>\n"}],"owner":{"user_id":15235253,"display_name":"ami who"},"view_count":45,"up_vote_count":2,"accepted_answer_id":75963353,"answer_count":1,"score":2,"creation_date":1680923674,"question_id":75963133,"body":"<p>maven pom.xml</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt;\n    &lt;artifactId&gt;jol-core&lt;/artifactId&gt;\n    &lt;version&gt;0.10&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Java class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class MyObjectData {\n\n    private  int i=66;\n    private  long l=6L;\n    private String string=new String(&quot;aaaa&quot;);\n\n}\n\npublic class ObjectTest {\n\n    @Test\n    public  void test1() {\n        Layouter l;\n        //64 bit vm object distribution, pointer compression not enabled\n        l = new HotSpotLayouter(new X86_64_DataModel());\n        System.out.println(&quot;***** &quot; + l);\n        System.out.println(ClassLayout.parseInstance(new MyObjectData(),l).toPrintable());\n        System.out.println(&quot;==============================================&quot;);\n    }\n\n}\n</code></pre>\n<p>Running results：</p>\n<pre class=\"lang-none prettyprint-override\"><code>OFFSET  SIZE               TYPE DESCRIPTION                               VALUE\n      0     4                    (object header)                           01 00 00 00 (00000001 00000000 00000000 00000000) (1)\n      4     4                    (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)\n      8     4                    (object header)                           01 23 01 f8 (00000001 00100011 00000001 11111000) (-134143231)\n     12     4                    (object header)                           42 00 00 00 (01000010 00000000 00000000 00000000) (66)\n     16     8               long MyObjectData.l                            6\n     24     4                int MyObjectData.i                            66\n     28     4                    (alignment/padding gap)\n     32     8   java.lang.String MyObjectData.string                       (object)\n     40    -8                    (loss due to the next object alignment)\nInstance size: 32 bytes\nSpace losses: 4 bytes internal + -8 bytes external = -4 bytes total`\n</code></pre>\n<p>I don't understand why the 64 bit VM did not start pointer compression when checking the memory usage of the object, resulting in -8 memory alignment.</p>\n"},{"tags":["java","kotlin"],"comments":[{"owner":{"user_id":214525,"display_name":"f1sh"},"edited":false,"comment_id":133900647,"body":"No. Unlike in java, assignments in kotlin are not expressions, so this cannot be done."},{"owner":{"user_id":9223264,"display_name":"Jaspalsinh Gohil"},"edited":false,"comment_id":133902542,"body":"yes you can do that using the init block serves the same purpose as the constructor in Java."}],"answers":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":5,"is_accepted":true,"creation_date":1680487114,"answer_id":75915578,"body":"<p>This works in Java because assignments are expressions that evaluate to the value that is assigned. However, assignments are not expressions in Kotlin, so the same syntax cannot be done.</p>\n<p>If you want to avoid writing <code>&quot;Matroskin&quot;</code> twice, you can use one of the many <a href=\"https://kotlinlang.org/docs/scope-functions.html\" rel=\"nofollow noreferrer\">scope functions</a> available. I'd use <code>let</code>:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>&quot;Matroskin&quot;.let {\n    firstName = it\n    lastName = it\n}\n</code></pre>\n<p>Since this is in a constructor, you can also do:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>var firstName = &quot;Matroskin&quot;\nvar lastName: String\n\ninit {\n    lastName = firstName\n}\n</code></pre>\n<hr>\n<p>(This part is for fun only)</p>\n<p>That said, you can <em>technically</em> abuse Kotlin's features to achieve similar syntax, by defining an infix function called <code>=</code>.</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>infix fun &lt;T&gt; T.`=`(prop: KMutableProperty&lt;T&gt;): T {\n    prop.setter.call(prop)\n    return this\n}\n</code></pre>\n<pre class=\"lang-kotlin prettyprint-override\"><code>&quot;Matroskin&quot; `=` ::lastName `=` ::firstName\n</code></pre>\n<p>Note that the value to be assigned is ordered first, because infix functions are left associative. You could declare <code>=</code> with the arguments reversed, but then the usage needs brackets:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>::lastName `=` (::firstName `=` &quot;Matroskin&quot;)\n</code></pre>\n<p>Also, this doesn't count as initialising properties, so Kotlin will complain that <code>firstName</code> and <code>lastName</code> aren't initialised if you don't give them default values:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>var firstName = &quot;&quot;\nvar lastName = &quot;&quot;\n</code></pre>\n<p>If you are using <code>val</code>s, then this way is not applicable.</p>\n"}],"owner":{"user_id":17846993,"display_name":"bighugedev"},"view_count":75,"up_vote_count":2,"accepted_answer_id":75915578,"answer_count":1,"score":2,"creation_date":1680477091,"question_id":75915077,"body":"<p>In Java, there is a syntactic sugar construction called <code>assignment chaining</code> as shown below:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Cat {\n    String firstName;\n    String lastName;\n\n    Cat() {\n        lastName = firstName = &quot;Matroskin&quot;; // compiles!\n    }\n}\n</code></pre>\n<p>Is there a way to perform exactly this in Kotlin?</p>\n"},{"tags":["java","jvm","methodhandle","varhandle"],"answers":[{"owner":{"user_id":3448419,"display_name":"apangin"},"up_vote_count":2,"is_accepted":true,"creation_date":1679351049,"answer_id":75795843,"body":"<p>You are right: this is because of the polymorphic signature where <code>this</code> results in a reference to a different class in the signature. The workaround is to explicitly cast <code>this</code> to <code>Object</code> to force <code>Ljava/lang/Object;</code> in the signature instead of <code>LHiddenClassTest$IntThing;</code></p>\n<pre><code>int oldIdx = (int) IDX.getOpaque((Object) this);\nIDX.setOpaque((Object) this, newIdx);\nreturn oldIdx;\n</code></pre>\n"},{"owner":{"user_id":3699139,"display_name":"Jorn Vernee"},"up_vote_count":3,"is_accepted":false,"creation_date":1679351495,"answer_id":75795893,"body":"<p>As you have found, a hidden class can not be referenced by name from byte code. It can only be referenced through the <code>this_class</code> constant pool entry. This excludes use from descriptor strings though.</p>\n<p>As <a href=\"https://stackoverflow.com/a/75795843/3699139\">apangin says</a>, you could explicitly cast the <code>this</code> argument to <code>Object</code> to avoid the class name from appearing in the descriptor.</p>\n<p>If you want to avoid the inexact invocation that results from this, you could further convert the VarHandle into a set of MethodHandles for which the first parameter is erased to <code>Object</code>, and then invoke those with an exact call:</p>\n<pre><code>  static final class IntThing implements IntUnaryOperator {\n    static final MethodHandle IDX_GET;\n    static final MethodHandle IDX_SET;\n\n    static {\n      try {\n        VarHandle VH_idx = MethodHandles.lookup().findVarHandle(IntThing.class, &quot;idx&quot;, int.class);\n        IDX_GET = VH_idx.toMethodHandle(VarHandle.AccessMode.GET_OPAQUE).asType(MethodType.methodType(int.class, Object.class));\n        IDX_SET = VH_idx.toMethodHandle(VarHandle.AccessMode.SET_OPAQUE).asType(MethodType.methodType(void.class, Object.class, int.class));\n      } catch (Exception e) {\n        throw new RuntimeException(e);\n      }\n    }\n\n    private int idx;\n    \n    private int getIdx() {\n      try {\n        return (int) IDX_GET.invokeExact((Object) this);\n      } catch (Throwable t) {\n        throw new RuntimeException(t);\n      }\n    }\n    \n    private void setIdx(int value) {\n      try {\n        IDX_SET.invokeExact((Object) this, value);\n      } catch (Throwable t) {\n        throw new RuntimeException(t);\n      }\n    }\n\n    @Override\n    public int applyAsInt(int newIdx) {\n      int oldIdx = getIdx();\n      setIdx(newIdx);\n      return oldIdx;\n    }\n  }\n</code></pre>\n"}],"owner":{"user_id":2598037,"display_name":"Carl Mastrangelo"},"view_count":46,"up_vote_count":2,"accepted_answer_id":75795843,"answer_count":2,"score":2,"creation_date":1679345617,"question_id":75795199,"body":"<p>I am trying to load a class as a hidden class in Java, but run into a VerifyError.   The class uses a VarHandle, which has a <code>PolymorphicSignature</code>.  I believe the error is implying that the polymorphic call is using the non-hidden class, but it's not obvious to me what to do to fix it.  What is the correct way to define hidden classes that contain calls to MethodHandles or VarHandles?</p>\n<pre class=\"lang-java prettyprint-override\"><code>package foo;\n\nimport java.lang.invoke.MethodHandles;\nimport java.lang.invoke.VarHandle;\nimport java.util.function.IntUnaryOperator;\nimport org.junit.jupiter.api.Test;\n\npublic class HiddenClassTest {\n\n  @Test\n  public void loadHidden() throws Exception {\n    MethodHandles.Lookup lookup;\n    try (var is = IntThing.class.getResourceAsStream(&quot;HiddenClassTest$IntThing.class&quot;)) {\n      lookup =\n          MethodHandles.lookup().defineHiddenClass(is.readAllBytes(), true);\n    }\n    var instance =\n        lookup.lookupClass()\n            .asSubclass(IntUnaryOperator.class)\n            .getConstructor()\n            .newInstance();\n    System.out.println(instance.applyAsInt(12));\n    System.out.println(instance.applyAsInt(24));\n  }\n\n  static final class IntThing implements IntUnaryOperator {\n    static final VarHandle IDX;\n\n    static {\n      try {\n        IDX = MethodHandles.lookup().findVarHandle(IntThing.class, &quot;idx&quot;, int.class);\n      } catch (Exception e) {\n        throw new RuntimeException(e);\n      }\n    }\n\n    private int idx;\n\n    @Override\n    public int applyAsInt(int newIdx) {\n      int oldIdx = (int) IDX.getOpaque(this);\n      IDX.setOpaque(this, newIdx);\n      return oldIdx;\n    }\n  }\n}\n</code></pre>\n<p>The error:</p>\n<pre><code>Bad type on operand stack\nException Details:\n  Location:\n    foo/HiddenClassTest$IntThing+0x0000000800d38c00.applyAsInt(I)I @4: invokevirtual\n  Reason:\n    Type 'foo/HiddenClassTest$IntThing+0x0000000800d38c00' (current frame, stack[1]) is not assignable to 'foo/HiddenClassTest$IntThing'\n  Current Frame:\n    bci: @4\n    flags: { }\n    locals: { 'foo/HiddenClassTest$IntThing+0x0000000800d38c00', integer }\n    stack: { 'java/lang/invoke/VarHandle', 'foo/HiddenClassTest$IntThing+0x0000000800d38c00' }\n  Bytecode:\n    0000000: b200 072a b600 0d3d b200 072a 1bb6 0013\n    0000010: 1cac                                   \n\njava.lang.VerifyError: Bad type on operand stack\nException Details:\n  Location:\n    foo/HiddenClassTest$IntThing+0x0000000800d38c00.applyAsInt(I)I @4: invokevirtual\n  Reason:\n    Type 'foo/HiddenClassTest$IntThing+0x0000000800d38c00' (current frame, stack[1]) is not assignable to 'foo/HiddenClassTest$IntThing'\n  Current Frame:\n    bci: @4\n    flags: { }\n    locals: { 'foo/HiddenClassTest$IntThing+0x0000000800d38c00', integer }\n    stack: { 'java/lang/invoke/VarHandle', 'foo/HiddenClassTest$IntThing+0x0000000800d38c00' }\n  Bytecode:\n    0000000: b200 072a b600 0d3d b200 072a 1bb6 0013\n    0000010: 1cac                                   \n\n    at java.base/java.lang.ClassLoader.defineClass0(Native Method)\n    at java.base/java.lang.System$2.defineClass(System.java:2307)\n    at java.base/java.lang.invoke.MethodHandles$Lookup$ClassDefiner.defineClass(MethodHandles.java:2439)\n    at java.base/java.lang.invoke.MethodHandles$Lookup$ClassDefiner.defineClassAsLookup(MethodHandles.java:2420)\n    at java.base/java.lang.invoke.MethodHandles$Lookup.defineHiddenClass(MethodHandles.java:2127)\n    at foo.HiddenClassTest.loadHidden(HiddenClassTest.java:16)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n    at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)\n    at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)\n</code></pre>\n"},{"tags":["java","firebase","macos","apple-m1","firebase-tools"],"comments":[{"owner":{"user_id":8475129,"display_name":"Jean Charles"},"edited":false,"comment_id":133704824,"body":"thanks . it won&#39;t change anything , already downgraded to node@18"}],"answers":[{"owner":{"user_id":2768937,"display_name":"Chris"},"up_vote_count":0,"is_accepted":false,"creation_date":1679351043,"answer_id":75795839,"body":"<p>Node 19 is experimental and not officially supported (by Node or Firebase):</p>\n<p><a href=\"https://github.com/firebase/firebase-tools/issues/5608\" rel=\"nofollow noreferrer\">https://github.com/firebase/firebase-tools/issues/5608</a></p>\n<p>Please downgrade to 18 and reply if you're still having issues.</p>\n"},{"owner":{"user_id":10259099,"display_name":"Rofie Sagara"},"up_vote_count":0,"is_accepted":false,"creation_date":1679365681,"answer_id":75796851,"body":"<p>You can use docker for that its more a clean way, Im use this image\n<a href=\"https://hub.docker.com/r/spine3/firebase-emulator\" rel=\"nofollow noreferrer\">https://hub.docker.com/r/spine3/firebase-emulator</a></p>\n"},{"owner":{"user_id":12614572,"display_name":"Dmitro Serdun"},"up_vote_count":2,"is_accepted":false,"creation_date":1679556121,"answer_id":75820160,"body":"<p>Downgrading the version helped me, as Chris.</p>\n<p>Also, for everything to work, you need to delete the cache, in my case, it is the path &quot;/Users/dmitroserdun/.cache/firebase&quot;</p>\n"},{"owner":{"user_id":13888343,"display_name":"Camille"},"up_vote_count":3,"is_accepted":false,"creation_date":1682535472,"answer_id":76114187,"body":"<p>It worked for me to downgrade to Node.js <code>v18.15.0</code>. I've had <code>v18.16.0</code> installed before.\n<a href=\"https://nodejs.org/dist/v18.15.0/\" rel=\"nofollow noreferrer\">https://nodejs.org/dist/v18.15.0/</a></p>\n"}],"owner":{"user_id":8475129,"display_name":"Jean Charles"},"view_count":520,"up_vote_count":2,"answer_count":4,"score":2,"creation_date":1679339226,"question_id":75794346,"body":"<p>Hello everybody: i can't launch my emulators , firebase init ok , ports ok , the problem seems to come from the ui . Anybody could help me ?</p>\n<pre><code>(base) jean-charlesdubien@airdejencharles firebase-demo-project % firebase emulators:start\ni  emulators: Starting emulators: auth, functions, firestore, hosting, storage\n⚠  functions: The following emulators are not running, calls to these services from the Functions emulator will affect production: database, pubsub\ni  firestore: Firestore Emulator logging to firestore-debug.log\n✔  firestore: Firestore Emulator UI websocket is running on 9150.\ni  hosting[flutter-ultimate-ae8a4]: Serving hosting files from: public\n✔  hosting[flutter-ultimate-ae8a4]: Local server: http://127.0.0.1:5002/\ni  ui: Emulator UI logging to ui-debug.log\n⚠  ui: Fatal error occurred: \n   Emulator UI has exited with code: 1, \n   stopping all running emulators\ni  ui: Stopping Emulator UI\n⚠  ui: Error stopping Emulator UI\ni  functions: Stopping Functions Emulator\ni  hosting: Stopping Hosting Emulator\ni  firestore: Stopping Firestore Emulator\ni  auth: Stopping Authentication Emulator\ni  storage: Stopping Storage Emulator\ni  eventarc: Stopping Eventarc Emulator\ni  hub: Stopping emulator hub\ni  logging: Stopping Logging Emulator\n</code></pre>\n<p>Node @19 then downgraded unsuccesfully. java jre19 mac M1 , tried on rosetta and M1 terminal</p>\n<p>Thank you</p>\n<p>downgrade node from 19 to 16\nretry init and download emulators\ntry from terminal M1 and rosetta .</p>\n<p>EDIT : mode -- debug</p>\n<p>Node.js v18.15.0\n{&quot;metadata&quot;:{&quot;emulator&quot;:{&quot;name&quot;:&quot;ui&quot;},&quot;message&quot;:&quot;/Users/jean-charlesdubien/.cache/firebase/emulators/ui-v1.11.4/server/server.js:569\\n        re&quot;use strict&quot;;\\n          ^^^^^^^^^^^^\\n\\nSyntaxError: Unexpected string\\n    at internalCompileFunction (node:internal/vm:73:18)\\n    at wrapSafe (node:internal/modules/cjs/loader:1176:20)\\n    at Module._compile (node:internal/modules/cjs/loader:1218:27)\\n    at Module._extensions..js (node:internal/modules/cjs/loader:1308:10)\\n    at Module.load (node:internal/modules/cjs/loader:1117:32)\\n    at Module._load (node:internal/modules/cjs/loader:958:12)\\n    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)\\n    at node:internal/main/run_main_module:23:47\\n\\nNode.js v18.15.0\\n&quot;}}\n⚠  ui: Fatal error occurred:\nEmulator UI has exited with code: 1,\nstopping all running emulators {&quot;metadata&quot;:{&quot;emulator&quot;:{&quot;name&quot;:&quot;ui&quot;},&quot;message&quot;:&quot;Fatal error occurred: \\n   Emulator UI has exited with code: 1, \\n   stopping all running emulators&quot;}}</p>\n"},{"tags":["java","multithreading","wait","scheduledexecutorservice"],"comments":[{"owner":{"user_id":11002,"display_name":"tgdavies"},"edited":false,"comment_id":133635136,"body":"I&#39;m not quite sure why this works at all, as you&#39;re waiting on an object you haven&#39;t synchronized on."},{"owner":{"user_id":2513200,"display_name":"Hulk"},"edited":false,"comment_id":133635402,"body":"@tgdavies exactly - it throws, and therefore the executor halts the sequence of task executions."},{"owner":{"user_id":11002,"display_name":"tgdavies"},"edited":false,"comment_id":133635426,"body":"Ah - missed that only InterruptedException was being caught!"},{"owner":{"user_id":11002,"display_name":"tgdavies"},"edited":false,"comment_id":133635437,"body":"Does this answer your question? <a href=\"https://stackoverflow.com/questions/2779484/why-must-wait-always-be-in-synchronized-block\">Why must wait() always be in synchronized block</a>"}],"answers":[{"owner":{"user_id":2513200,"display_name":"Hulk"},"up_vote_count":3,"is_accepted":false,"creation_date":1678960340,"answer_id":75754503,"body":"<p>It's because you are calling <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/Object.html#wait(long)\" rel=\"nofollow noreferrer\"><code>Object.wait()</code></a>, and that throws</p>\n<blockquote>\n<p>IllegalMonitorStateException - if the current thread is not the owner of the object's monitor</p>\n</blockquote>\n<p>your thread does not own the monitor for <code>this</code> (the worker), so it throws.</p>\n<p>As you only catch <code>InterruptedException</code>, it is not caught within the runnable (but the finally block executes).</p>\n<p><a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/concurrent/ScheduledThreadPoolExecutor.html#scheduleWithFixedDelay(java.lang.Runnable,long,long,java.util.concurrent.TimeUnit)\" rel=\"nofollow noreferrer\"><code>ScheduledThreadPoolExecutor.scheduleWithFixedDelay()</code></a> documents:</p>\n<blockquote>\n<p>The sequence of task executions continues indefinitely until one of the following exceptional completions occur:</p>\n<p>[...]<br />\nAn execution of the task throws an exception. [...]</p>\n</blockquote>\n<p>therefore it terminates.</p>\n<hr />\n<p>As the <a href=\"https://stackoverflow.com/a/75754750/2513200\">answer by rzwitserloot</a> already provides a great explanation about how <code>Object.wait()</code> and <code>Object.notify()</code> are meant to be used, let me just add that there is an alternative implementation of the underlying concept (called Condition Variable) in the class <a href=\"https://stackoverflow.com/a/75754750/2513200\"><code>Condition</code></a> which includes a code example for a use case in the JavaDocs.</p>\n"},{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"up_vote_count":2,"is_accepted":true,"creation_date":1678961509,"answer_id":75754750,"body":"<p>You're not using <code>wait</code> correctly.</p>\n<p>Here's a very short manual to wait/notify (these 2 methods go hand in hand, there is zero point using one of them without also using the other!)</p>\n<p>We have 2 threads, we shall name them Alice and Bob. Alice wants to wait, but, instead of the 'condition for when you can cease waiting' being: &quot;After X milliseconds have passed&quot;, the condition we want to wait for is &quot;When event Z happens, and Z is something another thread (Bob, in our case), will witness and will want to tell us about&quot;.</p>\n<p>To get the job done, <strong>first</strong>, we need Alice and Bob to both have a reference to <em>the same object</em>. Generally, because threading and locking is quite tricky, this should be <strong>non-global</strong> - i.e. something alice and bob have, but the rest of the wider code base doesn't. Failure to adhere to this rule makes it almost impossible to reason about code because you'll have no idea who is capable of messing with that 'lock' object. For the same reason you should replace public fields with private ones and if needed access methods (setters and getters), <strong>do not have public locks</strong>. Unfortunately, <code>synchronized</code> defaults to <code>this</code> if you stick it on a method, so, never do that unless you really, really know what you are doing. Instead, make private lock objects.</p>\n<p>Then, here's the flow:</p>\n<ol>\n<li>Alice <strong>LOCKS</strong> on the lock. (`synchronized (lock) { ... }).</li>\n<li>Whilst holding it (inside the braces that go with the block), alice runs into the situation where alice wants to wait until event Z happens. She calls <code>lock.wait()</code> on the lock. This will both freeze the Alice thread as well as release the lock.</li>\n<li>Bob locks on the exact same lock object. This will cause bob to wait (he didn't call <code>lock.wait</code>, he tried to entered a synchronized block which can also cause waiting to occur) until Alice either exits her synchronized block <em>or</em> invokes <code>wait</code> on the lock.</li>\n<li>Bob does some stuff and eventually wants to wake Alice up, so bob calls <code>lock.notifyAll()</code> (I generally advise not calling notify - the difference is mostly esoteric and usually irrelevant, though). Bob can only do this when he holds the lock (inside a <code>synchronized (lock) {}</code> block).</li>\n<li>This <strong>does not actually wake Alice up!</strong> - after all, for alice to wake up, alice has to re-acquire the lock (that <code>lock.wait()</code> call is inside <code>synchronized (lock) {}</code> after all, and bob holds that lock right now; has to be, because Bob can't call <code>lock.notifyAll()</code> unless bob holds that lock!). It merely sets alice up to wake when bob's done with their lock.</li>\n</ol>\n<p>And.. that's all there is to it.</p>\n<p>This isn't necessarily the best way to do locking; often something from the <code>java.util.concurrent</code> package is a better idea.</p>\n<p>The problem in your code is that you just call <code>wait()</code>, which therefore resolves to <code>this.wait()</code>, but you wanted <code>lock.wait()</code>.</p>\n"}],"owner":{"user_id":21410131,"display_name":"PleaseHlep123"},"view_count":55,"up_vote_count":2,"accepted_answer_id":75754750,"answer_count":2,"score":2,"creation_date":1678959115,"question_id":75754287,"body":"<p>I'm trying to wrap my head around threads and I've thought of this particular case:\nA scheduled runnable which will poll data from somewhere and when there is no data to poll the thread should wait for a while and then start polling again.</p>\n<p>This is an example code of what I was trying to accomplish</p>\n<pre><code>public class ThreadTest {\n    public static void main(String[] args) {\n        Object lock = new Object();\n        ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(10);\n        ScheduledFuture&lt;?&gt; scheduledFuture = scheduledExecutorService.scheduleWithFixedDelay(new Worker(lock), 100, 1000, TimeUnit.MILLISECONDS);\n\n        while(!scheduledFuture.isDone()) {\n        }\n\n        System.out.println(&quot;Main finished&quot;);\n    }\n\n    public static class Worker implements Runnable {\n\n        private final Object lock;\n        public Worker(Object lock) {\n            this.lock = lock;\n        }\n\n        @Override\n        public void run() {\n            long startMilis = 0;\n            try {\n                synchronized (lock) {\n                    System.out.println(Thread.currentThread().getName() + &quot; Simulating work by sleeping for 3 seconds&quot;);\n                    Thread.sleep(3000);\n                    startMilis = System.currentTimeMillis();\n                    System.out.println(Thread.currentThread().getName() + &quot; Work done. Initiating wait for 200ms&quot;);\n                    // this is supposed to pause the thread and release the lock and then wake up the thread after 200ms\n                    // however what it seems to do is it puts the thread in the waiting state but it does not wake up\n                    // after 200ms and resume, instead it skips to the finally block and completes the scheduled future\n                    // stopping any further threads to start... why?\n                    wait(200);\n                    // this pauses the thread, keeping the lock, and the thread finishes after sleep. Works as intended.\n                    //Thread.sleep(200); \n                }\n                System.out.println(Thread.currentThread().getName() + &quot; Done waiting. Exiting&quot;);\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            } finally {\n                long endMilis = System.currentTimeMillis();\n                long difference = endMilis - startMilis;\n                System.out.println(Thread.currentThread().getName() + &quot; Finally block reached after &quot; + difference + &quot;ms&quot;);\n            }\n        }\n    }\n}\n</code></pre>\n<p>If you run this code as-is it will spawn a thread running the <code>Worker</code> runnable, the runnable will sleep for 3 seconds simulating some long lasting work, then it will hit the <code>wait(200)</code>\ncall and the thread will immediately go to the finally block and exit and the <code>ScheduledFuture</code> will complete.\nWhy is that? I thought that <code>wait(milis)</code> could be used for low-power polling, having the thread release it's lock and wait for some time before running again but this is only causing me more confusion.\nCan anyone elaborate?</p>\n"},{"tags":["java","date","jodatime","leap-year"],"comments":[{"owner":{"user_id":1081110,"display_name":"Dawood ibn Kareem"},"edited":false,"comment_id":133607018,"body":"Try calling <code>withYear</code> first, before the other <code>with</code> methods.  That way, you won&#39;t have an invalid intermediate result."},{"owner":{"user_id":5043481,"display_name":"zforgo"},"edited":false,"comment_id":133607162,"body":"Please clarify which certain year we are talking about? The title states <code>2023</code> but question body contains <code>2024</code>. In this case is relevant I guess."},{"owner":{"user_id":11844224,"display_name":"Andrew"},"edited":false,"comment_id":133607225,"body":"This issue might be related to <a href=\"https://github.com/jodaorg/joda-time/issues/132\" rel=\"nofollow noreferrer\">github.com/jodaorg/joda-time/issues/132</a> and/or <a href=\"https://github.com/jodaorg/joda-time/issues/131\" rel=\"nofollow noreferrer\">github.com/jodaorg/joda-time/issues/131</a> where the DE incorrectly doubled down on that errant behavior reported."},{"owner":{"user_id":11844224,"display_name":"Andrew"},"edited":false,"comment_id":133607269,"body":"The error is correct if you actually used 2023; if 2024, report the bug"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":133673914,"body":"@Andrew This is no bug. <code>new DateTime()</code> gives a date in the current year, 2023, not a leap year, so setting the month to 2 and then the day of moth to 29 gives 29 February 2023, a non-existing date. That the code after that <i>would have</i> set the year to 2024 is not relevant because the exception causes that never to happen. Dawood Ibn Karieem is perfectly correct that the order matters."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":133674046,"body":"I would it do it this terse way: <code>final DateTime selectedDate = new DateTime().withDate(2024, 2, 29);</code>. On my computer it just gave me <code>2024-02-29T19:36:29.350+01:00</code>."},{"owner":{"user_id":11844224,"display_name":"Andrew"},"edited":false,"comment_id":133676368,"body":"@Ole V.V.  What does the .withYear(year) with tear = 2024 do? Nothing, with no error?"},{"owner":{"user_id":11844224,"display_name":"Andrew"},"edited":false,"comment_id":133678744,"body":"OK, I see it now, so it uses inits with default of 2023, and parese left to right; so what if the order was changed--that should work: &quot;.withMonthOfYear(month).withDayOfMonth(day).withYear(year)&quot; ==&gt; &quot;.withYear(year).withMonthOfYear(month).withDayOfMonth(day)&quot; (basically what  Dawood ibn Kareem said early on above).  Also, DateTime(2024, 2, 29, 1, 1, 1, 1) should work.  Thanks. :-)"},{"owner":{"user_id":11844224,"display_name":"Andrew"},"edited":false,"comment_id":133678824,"body":"@Dawood ibn Kareem  Why not post that as the Answer?  Seems you are correct."},{"owner":{"user_id":1081110,"display_name":"Dawood ibn Kareem"},"edited":false,"comment_id":133686305,"body":"@Andrew OK, done.  When I saw this question last week, I didn&#39;t have time to write a proper answer.  That was then - this is now."}],"answers":[{"owner":{"user_id":1081110,"display_name":"Dawood ibn Kareem"},"up_vote_count":5,"is_accepted":false,"creation_date":1679269747,"answer_id":75785639,"body":"<p>Whereas the final value of your expression appears to be a valid date, you've evaluated it in an order which requires an invalid date to be evaluated along the way.</p>\n<p>You wrote</p>\n<pre><code>final DateTime selectedDate = \n    new DateTime().withMonthOfYear(month).withDayOfMonth(day).withYear(year);\n</code></pre>\n<p>which is evaluated from left to right.  It's therefore equivalent to</p>\n<pre><code>DateTime result1 = new DateTime().withMonthOfYear(month);\nDateTime result2 = result1.withDayOfMonth(day);\nfinal DateTime selectedDate = result2.withYear(year);\n</code></pre>\n<p>Now, suppose I run this today (20 March 2023) with <code>month = 2, day = 29, year = 2024</code> as you specified.  Then I have</p>\n<pre><code>DateTime result1 = 20 February 2023 // all good so far\nDateTime result2 = 29 February 2023 // whoops!\n</code></pre>\n<p>and this is the point where your exception is thrown.  We never got as far as setting the year to 2024.</p>\n<p>Rearranging your code so that <code>withYear</code> gets called first would fix this, because all the intermediate results would be valid dates.</p>\n<pre><code>final DateTime selectedDate = \n    new DateTime().withYear(year).withMonthOfYear(month).withDayOfMonth(day);\n</code></pre>\n<p>A better idea is Ole's idea</p>\n<pre><code>final DateTime selectedDate = new DateTime().withDate(year, month, day);\n</code></pre>\n<p>which sets all three fields in a single call, so you don't need to be concerned about intermediate results.</p>\n<p>But the best idea of all would be for you to use the classes in the <code>java.time</code> package, instead of Joda.  Joda has been obsolete for almost 10 years now.</p>\n<pre><code>import java.time.LocalDate;\n\n// ...\n\nfinal LocalDate selectedDate = LocalDate.of(year, month, day);\n</code></pre>\n"}],"owner":{"user_id":3318489,"display_name":"quma"},"view_count":78,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1678821638,"question_id":75737510,"body":"<p>I use this code in my application:</p>\n<pre><code>final DateTime selectedDate = new DateTime().withMonthOfYear(month).withDayOfMonth(day).withYear(year);\n</code></pre>\n<p>where <code>month</code> = 2, <code>day</code> = 29, <code>year</code> = 2024</p>\n<p>and I get this exception:</p>\n<pre><code>Value 29 for dayOfMonth must be in the range [1,28]\n</code></pre>\n<p>but 2024 is a leap year.\nDoes anyone have a solution about this?</p>\n"},{"tags":["java"],"comments":[{"owner":{"user_id":1707427,"display_name":"S&#246;ren"},"edited":false,"comment_id":133371178,"body":"&quot;<b>an</b> error&quot;?"},{"owner":{"user_id":19468319,"display_name":"zachjohn987"},"edited":false,"comment_id":133371253,"body":"no &quot;the error&quot;."},{"owner":{"user_id":1707427,"display_name":"S&#246;ren"},"edited":false,"comment_id":133371333,"body":"I was asking what the error message is..."},{"owner":{"user_id":19468319,"display_name":"zachjohn987"},"edited":false,"comment_id":133371379,"body":"Please see revision."},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"edited":false,"comment_id":133374072,"body":"I would have thought this to be a duplicate. Yet I cannot find any existing Questions where &quot;cannot be resolved to a variable&quot; is caused by a lack of an <code>import</code>."}],"answers":[{"owner":{"user_id":1676941,"display_name":"Uday Shankar"},"up_vote_count":5,"is_accepted":true,"creation_date":1677612141,"answer_id":75596439,"body":"<p>you need additional import</p>\n<pre><code>import java.nio.charset.StandardCharsets;\n</code></pre>\n"}],"owner":{"user_id":19468319,"display_name":"zachjohn987"},"view_count":68,"up_vote_count":3,"accepted_answer_id":75596439,"answer_count":1,"score":2,"creation_date":1677610730,"question_id":75596248,"body":"<p>I getting an error line under <code>StandardCharsets</code>. I have imported it, so I am not sure why I am getting the <code>StandardCharsets cannot be resolved to a variable</code> error.</p>\n<pre><code>import java.util.*;\nimport java.nio.charset.Charset;\nimport java.nio.file.Path;\n\npublic class Training\n{\n    \n    public static void main(String[] args)\n    {\n        Scanner in = new Scanner(Path.of(&quot;text.txt&quot;),StandardCharsets.UTF_8);\n        \n        System.out.print(in);\n    }\n}\n</code></pre>\n<p>I am expecting to print the data in the <code>text.txt</code> file.</p>\n"},{"tags":["java","android","android-studio","gradle"],"answers":[{"owner":{"user_id":10449848,"display_name":"Real Noob"},"up_vote_count":4,"is_accepted":true,"creation_date":1677509914,"answer_id":75582056,"body":"<p>I figured it out. The Gradle version has to be changed to 7.6 for it to be compatible with Java 19.0.2.</p>\n"},{"owner":{"user_id":15389957,"display_name":"Dilshod Sh"},"up_vote_count":1,"is_accepted":false,"creation_date":1681825484,"answer_id":76045372,"body":"<p>In My case I upgraded gradle to 8.1,and its working now</p>\n"},{"owner":{"user_id":1889825,"display_name":"Somnath Kadam"},"up_vote_count":0,"is_accepted":false,"creation_date":1682766154,"answer_id":76135863,"body":"<p>For Java 19, need to set gradle version as 7.6 and above.\nAlso check below compatibility matrix</p>\n<p><a href=\"https://docs.gradle.org/current/userguide/compatibility.html\" rel=\"nofollow noreferrer\">https://docs.gradle.org/current/userguide/compatibility.html</a></p>\n"}],"owner":{"user_id":10449848,"display_name":"Real Noob"},"view_count":2999,"up_vote_count":2,"accepted_answer_id":75582056,"answer_count":3,"score":2,"creation_date":1677509436,"question_id":75581976,"body":"<p>I am getting this error when building my project:</p>\n<pre><code>Unsupported Java. \nYour build is currently configured to use Java 19.0.2 and Gradle 7.5.\n\nPossible solution:\n - Open Gradle wrapper settings, change `distributionUrl` property to use compatible Gradle version and reload the project\n</code></pre>\n<p>My <code>gradle-wrapper.properties</code> file looks like this:</p>\n<pre><code>#Mon Feb 27 20:08:12 IST 2023\ndistributionBase=GRADLE_USER_HOME\ndistributionUrl=https\\://services.gradle.org/distributions/gradle-7.5-bin.zip\ndistributionPath=wrapper/dists\nzipStorePath=wrapper/dists\nzipStoreBase=GRADLE_USER_HOME\n</code></pre>\n<p>So, the Gradle value is already 7.5. What other change do I need to make here?</p>\n<p>Thanks.</p>\n"},{"tags":["java","generics","types"],"comments":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":133316018,"body":"No. You would need to do the dispatching of <code>someMethod</code> manually."},{"owner":{"user_id":869736,"display_name":"Louis Wasserman"},"edited":false,"comment_id":133316040,"body":"You cannot actually do this, really."},{"owner":{"user_id":29470,"display_name":"Tim Moore"},"edited":false,"comment_id":133316121,"body":"Overloaded methods are resolved at compile time. They are essentially completely different methods that happen to share a name."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":133316929,"body":"If <code>input</code> cannot be <code>null</code>, you are not going to need the <code>Class&lt;T&gt;</code> parameter since you can always do <code>input.getClass()</code> inside your method to get the concrete runtime type."}],"answers":[{"owner":{"user_id":2563754,"display_name":"Seelenvirtuose"},"up_vote_count":2,"is_accepted":false,"creation_date":1677310073,"answer_id":75563921,"body":"<p><strong>First (and quick) &quot;solution&quot;</strong></p>\n<p>Actually, there is no Java built-in mechanism that handles this dispatching for you. That means, you have to do it yourself.</p>\n<p>But ... to avoid a longer if-else chain, you can use a mapping that maps the type to the consuming method you want to call. Example:</p>\n<pre><code>private final Map&lt;Class&lt;?&gt;, Consumer&lt;?&gt;&gt; dispatcher = new HashMap&lt;&gt;();\n\n{\n    dispatcher.put(String.class, (String value) -&gt; someMethod(value));\n    dispatcher.put(Integer.class, (Integer value) -&gt; someMethod(value));\n}\n</code></pre>\n<p>Now you can do the following:</p>\n<pre><code>public &lt;T&gt; void doSomething(T input, Class&lt;T&gt; clazz) {\n    Consumer&lt;T&gt; consumer = (Consumer&lt;T&gt;) dispatcher.get(clazz);\n    if (consumer != null) consumer.accept(input);\n}\n</code></pre>\n<p>Be careful when building the dispatcher map. Any mistake there will result in a  runtime error when calling the method <code>doSomething</code>. There is even a compiler warning for this.</p>\n<p>Not perfect, but maybe a way to go ...</p>\n<p><strong>Further considerations</strong></p>\n<p>This manual dispatching is a great hint for you that there might be more OOP like solution. Usually, there is a <em>type</em> lurking behind your thoughts ...</p>\n<p>So first create an interface for that type:</p>\n<pre><code>interface SomethingDoable {\n    void someMethod();\n}\n</code></pre>\n<p>Note, that the generic type is also eliminated here. Now you can create some classes for that:</p>\n<pre><code>class StringDoable implements SomethingDoable {\n    private final String value;\n    public StringDoable(String value) { this.value = value; }\n    @Override public void doSomething() { /* your code here using the string value */ }\n}\n\nclass IntegerDoable implements SomethingDoable {\n    private final Integer value;\n    public IntegerDoable(Integer value) { this.value = value; }\n    @Override public void doSomething() { /* your code here using the integer value */ }\n}\n</code></pre>\n<p>With that preparation, you can simplify your public method:</p>\n<pre><code>public void doSomething(SomethingDoable somethingDoable) {\n    somethingDoable.doSomething();\n}\n</code></pre>\n<p>Using it is as simple as this:</p>\n<pre><code>doSomething(new StringDoable(&quot;42&quot;));\ndoSomething(new IntegerDoable(42));\n</code></pre>\n<p>The main advantage with this approach is ... Extending this simply means to add another concrete class. No need to change anything else.</p>\n"},{"owner":{"user_id":20607467,"display_name":"ﾓｷｬﾃﾞ"},"up_vote_count":1,"is_accepted":true,"creation_date":1677310472,"answer_id":75563938,"body":"<p>You can use reflection API to achieve that.</p>\n<pre><code>public &lt;T&gt; void someMethod(Object value, Class&lt;T&gt; clazz) {\n    try {\n        getClass().getDeclaredMethod(&quot;someMethod&quot;, clazz).invoke(this, value);\n    } catch (IllegalAccessException | InvocationTargetException | NoSuchMethodException | SecurityException e) {\n        throw new RuntimeException(e);\n    }\n}\n</code></pre>\n"},{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":2,"is_accepted":false,"creation_date":1677311197,"answer_id":75563997,"body":"<p>At runtime, Java dynamically dispatches methods only based on the object on which you called the method, i.e. <code>this</code> from the callee's perspective, aka the &quot;receiver parameter&quot;, or whatever you call this part of the call:</p>\n<pre><code>animal.eat(food);\n^^^^^^\n\nthis.someMethod(input);\n^^^^\n</code></pre>\n<p>Which method is chosen at runtime solely depends on that part. If <code>foo</code> at runtime stores an instance of <code>Dog</code>, then <code>Dog.eat</code> is called. If it stores an instance of <code>Cat</code>, then <code>Cat.eat</code> is called.</p>\n<p>However, what you want to do here seems to be dynamic dispatch based on what type <code>food</code> stores at runtime. Since Java doesn't do that, you either have to dispatch it manually with a chain of if-else-ifs, or change the call so that <code>food</code> is the receiver:</p>\n<pre><code>food.getsEatenBy(animal);\n\ninput.someMethod(this); // not sure if your someMethod needs &quot;this&quot; or not...\n</code></pre>\n<p>Since the parameters in your case are <code>String</code> and <code>Integer</code>, you need to write wrapper classes for them in order to be able to add methods to them.</p>\n<pre><code>// let's also introduce an interface that all the inputs of someMethod implements\npublic interface SomeMethodInput {\n    // SomeMethodClass is the class where someMethod originally was\n    void someMethod(SomeMethodClass self);\n}\n\npublic class StringInput implements SomeMethodInput {\n\n    private String value;\n\n    public StringInput(String string) {\n        this.value = string;\n    }\n\n\n    public String getValue() {\n        return value;\n    }\n\n    @Override\n    public void someMethod(SomeMethodClass self) {\n        // do string things...\n    }\n}\n\npublic class IntegerInput implements SomeMethodInput {\n\n    private Integer value;\n\n    public IntegerInput(Integer integer) {\n        this.value = integer;\n    }\n\n    public Integer getValue() {\n        return value;\n    }\n\n    @Override\n    public void someMethod(SomeMethodClass self) {\n        // do integer things...\n    }\n}\n</code></pre>\n<p>Now <code>doSomething</code> just needs to take a <code>SomeMethodInput</code>:</p>\n<pre><code>public void doSomething(SomeMethodInput input) {\n    input.someMethod(this);\n}\n</code></pre>\n<p>You might notice some similarities between this and the visitor pattern, and you'd be right - this is exactly how the visitor pattern achieves double dispatch, on both <code>this</code>, and the parameter. What I have shown here is not quite that yet, because it only dispatches on the parameter.</p>\n"}],"owner":{"user_id":3946706,"display_name":"Kim Gentes"},"view_count":62,"up_vote_count":2,"accepted_answer_id":75563938,"answer_count":3,"score":2,"creation_date":1677308413,"question_id":75563811,"body":"<p>Given</p>\n<pre class=\"lang-java prettyprint-override\"><code>private someMethod(String value) {\n // do string things\n}\n\nprivate someMethod(Integer value) {\n // do number things\n}\n</code></pre>\n<p>Would the following work to call the proper <code>someMethod</code> depending on the type of <code>clazz</code> and the value of <code>input</code> ?</p>\n<pre class=\"lang-java prettyprint-override\"><code>public &lt;T&gt; void doSomething(T input, Class&lt;T&gt; clazz) {\n    // Cast the input to the type specified by clazz\n    // Call a method that expects a parameter of the type specified by clazz\n    someMethod(clazz.cast(input));\n}\n</code></pre>\n<p>if it can't be done this way, what is the best way to do this without getting into a long if/else of hard checks on static typed constants?</p>\n"},{"tags":["java","spring","spring-boot","vmware"],"answers":[{"owner":{"user_id":9681755,"display_name":"Dirk Deyne"},"up_vote_count":5,"is_accepted":true,"creation_date":1675273110,"answer_id":75314073,"body":"<p><em>spring-boot-<strong><strong>3</strong></strong></em> no longer uses <code>spring.factories</code> to register autoconfiguration classes.</p>\n<p>Create a file named <code>org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> in folder <code>META-INF/spring</code> where you can put (all) your <code>Configuration</code> classes.</p>\n<p>In your case this would be</p>\n<p><em>/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</em></p>\n<pre><code>com.javadevjournal.helloservicespringbootstart.config.HelloServiceAutoConfiguration\n</code></pre>\n<p><em>Note</em> this should not be a SpringBootApplication</p>\n<p><em>Reference:</em> <a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-auto-configuration\" rel=\"noreferrer\">Creating Your Own Auto-configuration</a></p>\n"}],"owner":{"user_id":13475269,"display_name":"himanshu_mishra"},"view_count":574,"up_vote_count":2,"accepted_answer_id":75314073,"answer_count":1,"score":2,"creation_date":1675269712,"question_id":75313425,"body":"<h1><strong>Custom starter project named as: hello-service-spring-boot-start</strong></h1>\n<p><strong>Project Directory Structure is:</strong>\n<a href=\"https://i.stack.imgur.com/iHsvw.png\" rel=\"nofollow noreferrer\">hello-service-spring-boot-start directory structure</a></p>\n<p><strong>In pom.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.0.2&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.javadevjournal&lt;/groupId&gt;\n    &lt;artifactId&gt;hello-service-spring-boot-start&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;hello-service-spring-boot-start&lt;/name&gt;\n    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-autoconfigure --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;excludes&gt;\n                        &lt;exclude&gt;\n                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                        &lt;/exclude&gt;\n                    &lt;/excludes&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n\n\n</code></pre>\n<p><strong>In Starter Class or HelloServiceSpringBootStartApplication.java</strong></p>\n<pre><code>package com.javadevjournal.helloservicespringbootstart;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class HelloServiceSpringBootStartApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(HelloServiceSpringBootStartApplication.class, args);\n        System.out.println(&quot;hello-service-spring-boot-start-application started...&quot;);\n    }\n\n}\n\n</code></pre>\n<p><strong>In HelloService.java</strong></p>\n<pre><code>package com.javadevjournal.helloservicespringbootstart.service;\n\npublic interface HelloService {\n    void sayHello();\n}\n\n</code></pre>\n<p><strong>In HelloServiceImpl.java</strong></p>\n<pre><code>package com.javadevjournal.helloservicespringbootstart.service;\n\npublic class HelloServiceImpl implements HelloService {\n    @Override\n    public void sayHello() {\n        System.out.println(&quot;Hello from the default starter hello service&quot;);\n    }\n}\n\n</code></pre>\n<p><strong>In HelloServiceAutoConfiguration.java</strong></p>\n<pre><code>package com.javadevjournal.helloservicespringbootstart.config;\n\nimport com.javadevjournal.helloservicespringbootstart.service.HelloService;\nimport com.javadevjournal.helloservicespringbootstart.service.HelloServiceImpl;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\n@ConditionalOnClass(HelloService.class)\npublic class HelloServiceAutoConfiguration {\n    @Bean\n    @ConditionalOnMissingBean\n    public HelloService helloService() {\n        return new HelloServiceImpl();\n    }\n}\n\n</code></pre>\n<p><strong>In spring.factories</strong></p>\n<pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.javadevjournal.helloservicespringbootstart.HelloServiceSpringBootStartApplication\n</code></pre>\n<p><strong>Then, I run mvn install to create jar file or to build the above starter.</strong></p>\n<h1>The project in which I have used above starter named as: custom-app</h1>\n<p><strong>Project Directory Structure is:</strong>\n<a href=\"https://i.stack.imgur.com/ERUMX.png\" rel=\"nofollow noreferrer\">custom-app project directory structure</a></p>\n<p><strong>In pom.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.0.2&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.javadevjournal&lt;/groupId&gt;\n    &lt;artifactId&gt;custom-app&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;custom-app&lt;/name&gt;\n    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.javadevjournal&lt;/groupId&gt;\n            &lt;artifactId&gt;hello-service-spring-boot-start&lt;/artifactId&gt;\n            &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;excludes&gt;\n                        &lt;exclude&gt;\n                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                        &lt;/exclude&gt;\n                    &lt;/excludes&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n\n</code></pre>\n<p><strong>In Starter class or CustomAppApplication.java class</strong></p>\n<pre><code>package com.javadevjournal.customapp;\n\nimport com.javadevjournal.helloservicespringbootstart.service.HelloService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.CommandLineRunner;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class CustomAppApplication implements CommandLineRunner {\n\n    @Autowired\n    HelloService helloService;\n\n    public static void main(String[] args) {\n        SpringApplication.run(CustomAppApplication.class, args);\n    }\n\n    @Override\n    public void run(String... args) throws Exception {\n        helloService.sayHello();\n    }\n}\n\n</code></pre>\n<p><strong>Output: Console.</strong></p>\n<pre><code>  .   ____          _            __ _ _\n /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\\n( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\\n \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )\n  '  |____| .__|_| |_|_| |_\\__, | / / / /\n =========|_|==============|___/=/_/_/_/\n :: Spring Boot ::                (v3.0.2)\n\n2023-02-01T21:49:48.215+05:30  INFO 11332 --- [  restartedMain] c.j.customapp.CustomAppApplication       : Starting CustomAppApplication using Java 18.0.2.1 with PID 11332 (G:\\Java\\IntelliJ Workspace\\Learning\\Spring Boot By Raghu\\CustomStarterAutoConfigurationActual\\custom-app\\target\\classes started by himan in G:\\Java\\IntelliJ Workspace\\Learning\\Spring Boot By Raghu\\CustomStarterAutoConfigurationActual\\hello-service-spring-boot-start)\n2023-02-01T21:49:48.217+05:30  INFO 11332 --- [  restartedMain] c.j.customapp.CustomAppApplication       : No active profile set, falling back to 1 default profile: &quot;default&quot;\n2023-02-01T21:49:48.261+05:30  INFO 11332 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable\n2023-02-01T21:49:48.623+05:30  WARN 11332 --- [  restartedMain] s.c.a.AnnotationConfigApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'customAppApplication': Unsatisfied dependency expressed through field 'helloService': No qualifying bean of type 'com.javadevjournal.helloservicespringbootstart.service.HelloService' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}\n2023-02-01T21:49:48.629+05:30  INFO 11332 --- [  restartedMain] .s.b.a.l.ConditionEvaluationReportLogger : \n\nError starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.\n2023-02-01T21:49:48.653+05:30 ERROR 11332 --- [  restartedMain] o.s.b.d.LoggingFailureAnalysisReporter   : \n\n***************************\nAPPLICATION FAILED TO START\n***************************\n\nDescription:\n\nField helloService in com.javadevjournal.customapp.CustomAppApplication required a bean of type 'com.javadevjournal.helloservicespringbootstart.service.HelloService' that could not be found.\n\nThe injection point has the following annotations:\n    - @org.springframework.beans.factory.annotation.Autowired(required=true)\n\n\nAction:\n\nConsider defining a bean of type 'com.javadevjournal.helloservicespringbootstart.service.HelloService' in your configuration.\n\n\nProcess finished with exit code 0\n\n</code></pre>\n<p><strong>Screenshot.</strong>\n<a href=\"https://i.stack.imgur.com/ayFQl.png\" rel=\"nofollow noreferrer\">output: console</a></p>\n<p>I am trying to create custom starter project in spring boot and use it in another. But I am getting Error which explains that the bean that has been created inside custom-starter is not initialized.\nI am expecting to print hello message of starter in the console.</p>\n"},{"tags":["java","spring-boot","amazon-sqs"],"answers":[{"owner":{"user_id":3692447,"display_name":"Tomaz Fernandes"},"up_vote_count":3,"is_accepted":false,"creation_date":1675297759,"answer_id":75317572,"body":"<p>Spring Cloud AWS 2.x is only compatible with Spring Boot 2.x, for Spring Boot 3.x, Spring Cloud AWS 3.0 is necessary.</p>\n<p>See compatibility <a href=\"https://github.com/awspring/spring-cloud-aws#compatibility-with-spring-project-versions\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p>The 3.0 RC version has just been released, feel free to try it out and provide feedback!</p>\n"},{"owner":{"user_id":20606083,"display_name":"KVSVK"},"up_vote_count":1,"is_accepted":false,"creation_date":1675361787,"answer_id":75327349,"body":"<p>Spring Boot 3.0x requires Spring Cloud AWS 3.0x and AWS Java SDK 2.x</p>\n<p>Visit this <a href=\"https://github.com/awspring/spring-cloud-aws#compatibility-with-spring-project-versions\" rel=\"nofollow noreferrer\">link</a> for info <br></p>\n<p>In order to create a Consumer in Spring Boot 3.0, you need to use <code>@EnableScheduling</code> Bean in your main application. Then you need to use <code>@Scheduled(fixedDelay = 5000)</code> above the <em>receive</em> method. <strong>@Scheduled</strong> bean replaces the <strong>@SqsListener</strong> here. You can visit this <a href=\"https://javatodev.com/how-to-use-amazon-sqs-with-spring-boot/\" rel=\"nofollow noreferrer\">link</a> for more info.</p>\n"},{"owner":{"user_id":10047760,"display_name":"Chris"},"up_vote_count":1,"is_accepted":false,"creation_date":1676904281,"answer_id":75510719,"body":"<p>In order for the <code>@SqsListener</code> annotation to work, the dependency <a href=\"https://mvnrepository.com/artifact/io.awspring.cloud/spring-cloud-aws-autoconfigure\" rel=\"nofollow noreferrer\">spring-cloud-aws-autoconfigure</a> is required - this autowires the containers etc. needed for the annotation to function. <a href=\"https://github.com/awspring/spring-cloud-aws/blob/main/spring-cloud-aws-autoconfigure/src/main/java/io/awspring/cloud/autoconfigure/sqs/SqsAutoConfiguration.java\" rel=\"nofollow noreferrer\">You can see the extra stuff it autowires here</a>.</p>\n"}],"owner":{"user_id":4733312,"display_name":"Eddie"},"view_count":1304,"up_vote_count":2,"answer_count":3,"score":2,"creation_date":1674200184,"question_id":75181017,"body":"<p>Currently, we have an SQS client configured using an IAM Role that is picked up on the cluster. However, migrating over to Springboot 3 the @SqsListener is no longer consuming the messages.</p>\n<p>NOTE: Same code, works on Springboot 2, but not on Springboot 3 is there something else that needs to be configured or am I missing something?</p>\n<p>Anyone else run into this issue?</p>\n"},{"tags":["java","javafx","javafx-8"],"comments":[{"owner":{"user_id":36223,"display_name":"DaveB"},"edited":false,"comment_id":132329820,"body":"Generally speaking, you should just launch your Application and get the GUI up and running.  Maybe it&#39;s just a Splash screen.  Then use Task to run your connection checking code on a background thread.  Use the &quot;OnSucceeded&quot; property of Task to specify the action that you want to have happen when the background Task completes.  If all is well, then load up your main screen, otherwise put up a different screen showing the problem."},{"owner":{"user_id":20913728,"display_name":"Matias S"},"edited":false,"comment_id":132330218,"body":"@DaveB To clarify, the preloader is currently serving as a splash screen to the main application. But so is using the Preloader class not viable? Because I am using the preloader class as a secondary thread to my main javafx application thread. If I used a Task, would it still be possible to run a javafx application thread, and do you possibly have any examples? Thanks : )"},{"owner":{"user_id":1155209,"display_name":"jewelsea"},"edited":false,"comment_id":132333132,"body":"There is some (very dated and somewhat obsolete) information on <a href=\"https://stackoverflow.com/questions/15126210/how-to-use-javafx-preloader-with-stand-alone-application-in-eclipse\">splash screens and JavaFX</a>, some is still relevant, but, in general, I&#39;d recommend following DaveB&#39;s suggestion and Slaw&#39;s example.  Also JavaFX 8 itself is obsolete, I&#39;d recommend a modern version (e.g. 19+)."}],"answers":[{"owner":{"user_id":6395627,"display_name":"Slaw"},"up_vote_count":5,"is_accepted":true,"creation_date":1672704989,"answer_id":74988103,"body":"<h1>Preloader</h1>\n<p>If you want to continue using <code>Preloader</code> for your splash screen, then you can call the desired method via a notification. Create your own notification class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>// You can modify this class to carry information to the Preloader, such\n// as a message indicating what kind of failure occurred.\npublic class ConnectionFailedNotification implements Preloader.PreloaderNotification {}\n</code></pre>\n<p>Send it to your <code>Preloader</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>notifyPreloader(new ConnectionFailedNotification());\n</code></pre>\n<p>And handle it in said <code>Preloader</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Override\npublic void handleApplicationNotification(PreloaderNotification info) {\n    if (info instanceof ConnectionFailedNotification) {\n        handleConnectionWarning();\n    }\n    // ...\n}\n</code></pre>\n<hr />\n<h1>No Preloader</h1>\n<p>The <code>Preloader</code> class makes more sense when you're deploying your application via Java Web Start (i.e., to web browsers), where the code has to be downloaded before it can be used. But Java Web Start is no longer supported (though I <em>think</em> there may be a third-party maintaining something at least similar). Given your application is likely targeted for a simple desktop deployment, using <code>Preloader</code> can make things unnecessarily complicated. Instead consider simply updating the primary stage's content after initialization.</p>\n<p>Move your <code>init()</code> stuff into a <code>Task</code> implementation:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.io.IOException;\nimport javafx.concurrent.Task;\n\npublic class InitTask extends Task&lt;Void&gt; {\n\n    private static final int COUNT_LIMIT = 10;\n\n    private final boolean shouldSucceed;\n\n    public InitTask(boolean shouldSucceed) {\n        this.shouldSucceed = shouldSucceed;\n    }\n\n    @Override\n    protected Void call() throws Exception {\n        for (int i = 1; i &lt;= COUNT_LIMIT; i++) {\n            updateProgress(i, COUNT_LIMIT);\n            Thread.sleep(500);\n        }\n        \n        // could use a Boolean return type for this, but your real code seems\n        // more complicated than a simple &quot;yes&quot; / &quot;no&quot; response. If you do\n        // change the implementation to use a return value, note that you would\n        // then need to check that return value in the 'onSucceeded' handler\n        if (!shouldSucceed) {\n            throw new IOException(&quot;service unavailable&quot;); // failure\n        }\n        return null; // success\n    }\n    \n}\n</code></pre>\n<p>And then launch that task on a background thread:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import javafx.application.Application;\nimport javafx.application.Platform;\nimport javafx.scene.Scene;\nimport javafx.scene.control.Alert;\nimport javafx.scene.control.Label;\nimport javafx.scene.control.ProgressBar;\nimport javafx.scene.control.Alert.AlertType;\nimport javafx.scene.layout.StackPane;\nimport javafx.stage.Stage;;\n\npublic class App extends Application {\n    \n    @Override\n    public void start(Stage primaryStage) throws Exception {\n        var task = new InitTask(false); // change to 'true' to simulate success\n        task.setOnSucceeded(e -&gt; primaryStage.getScene().setRoot(createMainScreen()));\n        task.setOnFailed(e -&gt; {\n            var alert = new Alert(AlertType.WARNING);\n            alert.initOwner(primaryStage);\n            alert.setTitle(&quot;Server Offline&quot;);\n            alert.setHeaderText(&quot;Cannot connect to service&quot;);\n            alert.setContentText(&quot;Please check your connection&quot;);\n            alert.showAndWait();\n\n            Platform.exit();\n        });\n\n        // Also see the java.util.concurrent.Executor framework\n        var thread = new Thread(task, &quot;init-thread&quot;);\n        thread.setDaemon(true);\n        thread.start();\n\n        var scene = new Scene(createSplashScreen(task), 600, 400);\n        primaryStage.setScene(scene);\n        primaryStage.show();\n    }\n\n    private StackPane createSplashScreen(InitTask task) {\n        var bar = new ProgressBar();\n        bar.progressProperty().bind(task.progressProperty());\n        return new StackPane(bar);\n    }\n\n    private StackPane createMainScreen() {\n        return new StackPane(new Label(&quot;Hello, World!&quot;));\n    }\n}\n</code></pre>\n<hr />\n<h1>Side Notes</h1>\n<p>Your <code>Application</code> subclass should not implement <code>Initializable</code>. That subclass represents the entire application and should never be used as an FXML controller.</p>\n"}],"owner":{"user_id":20913728,"display_name":"Matias S"},"view_count":85,"up_vote_count":2,"accepted_answer_id":74988103,"answer_count":1,"score":2,"creation_date":1672686416,"question_id":74986151,"body":"<p>In a JavaFX application's init() method I am doing some checks, one of them is a check to see if it can connect to a web address based using Http response codes. This app also has a preloader that runs while these checks are happening.</p>\n<p>Depending on the response code, I want it to display an alert window during the preloader application's lifecycle</p>\n<p>I am not sure if this is possible using the current javafx preloader class, but is there any workarround that could achieve this?</p>\n<p>below is an SSCCE of what I would want</p>\n<p>The Application</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class MainApplicationLauncher extends Application implements Initializable{\n\n    ...\n\n    public void init() throws Exception {       \n          \n        for (int i = 1; i &lt;= COUNT_LIMIT; i++) {\n            double progress =(double) i/10;\n            System.out.println(&quot;progress: &quot; +  progress);         \n            \n            notifyPreloader(new ProgressNotification(progress));\n            Thread.sleep(500);\n        }\n        \n        try {\n            URL url = new URL(&quot;https://example.com&quot;);\n            HttpURLConnection connection = (HttpURLConnection)url.openConnection();\n            connection.setRequestMethod(&quot;GET&quot;);\n            connection.connect();           \n            int code = connection.getResponseCode();\n            System.out.println(&quot;Response code of the object is &quot;+code);\n            if (code==200) {\n                System.out.println(&quot;Connected to the internet!&quot;);\n            }else if (code==503){\n                        //call the handleConnectionWarning() in preloader\n                System.out.println(&quot;server down !&quot;);\n            }\n        } catch (UnknownHostException e) {\n                //call the handleConnectionWarning() in preloader\n            System.out.println(&quot;cannot connect to the internet!&quot;);\n        }\n\n    public static void main(String[] args) {        \n       System.setProperty(&quot;javafx.preloader&quot;, MainPreloader.class.getCanonicalName());\n        Application.launch(MainApplicationLauncher.class, args);\n   }\n}\n</code></pre>\n<p>The preloader</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class MyPreloader extends Preloader{\n\n...\n\n//Method that should be called from application method\n\npublic void handleConnectionWarning() {\n        Alert alert = new Alert(AlertType.WARNING);\n        alert.setTitle(&quot;Server is Offline&quot;);\n        alert.setHeaderText(&quot;Cannot connect to service&quot;);\n        alert.setContentText(&quot;Please check your connection&quot;);\n\n        alert.showAndWait();\n    }\n\n}\n</code></pre>\n<p>Are there any ways to do this?</p>\n"},{"tags":["java","unit-testing","mocking","mockito"],"comments":[{"owner":{"user_id":112968,"display_name":"knittl"},"edited":false,"comment_id":132325729,"body":"Mockito cannot mock static classes or methods. You&#39;ll have to user PowerMock(ito). Even better to change your classes&#39; design to be testable :)"},{"owner":{"user_id":12772017,"display_name":"emanoellucas"},"edited":false,"comment_id":132325802,"body":"@knittl omg actually I&#39;ve created an example that is not equal to mine in reality. What if OtherClass. getConfiguration() weren&#39;t static? Btw I will edit and make it not static."},{"owner":{"user_id":112968,"display_name":"knittl"},"edited":false,"comment_id":132325851,"body":"This might be useful: <a href=\"https://stackoverflow.com/q/74027324/112968\">Why is my class not calling my mocked methods in unit test?</a>"}],"answers":[{"owner":{"user_id":893952,"display_name":"Harry Coder"},"up_vote_count":2,"is_accepted":false,"creation_date":1672677613,"answer_id":74984946,"body":"<blockquote>\n<p>Could I do the following?</p>\n</blockquote>\n<p>Yes you can do it but you are doing it the wrong way. As your method <code>OtherClass.getConfiguration(keys)</code> is a static method, you will have to write it by following this <a href=\"https://www.baeldung.com/mockito-mock-static-methods\" rel=\"nofollow noreferrer\">example</a>.\nAs your method is not <code>static</code> anymore, your code will look like this:</p>\n<pre><code>import org.mockito.Mock;\nimport org.mockito.Mockito;\n\n@ExtendWith(MockitoExtension.class)\npublic class MyClassTest {\n\n   @Mock\n   private Context context;\n   \n   @Mock\n   private OtherClass otherClass;\n\n   @InjectMocks    \n   private MyClass myClass;\n\n   @Test\n   public void testConfigure(){\n      Mockito.when(otherClass.getConfiguration(any(Key.class))).thenReturn(new Configuration());\n      MyClass.configure(context);\n      verify(context.configure(configurationMock), times(1))\n   }\n\n}\n</code></pre>\n<blockquote>\n<p>then I want to know if a mock of it inside the class of tests takes\neffect in MyClass instance when I run the test</p>\n</blockquote>\n<p>Yes your mock takes effect in your class, as it is the purpose of the mock to give you the ability to modify the behaviour of your dependencies.</p>\n<p>Also, when using the <code>@Mock</code> annotation, you don't need to create a <code>new</code> instance and your test did not define a class <code>undertest</code> with <code>@InjectMocks</code>.</p>\n<p>While calling the <code>when</code> method, you will declare the class type of <code>keys</code> with <code>any(Key.class)</code> parameter and you will provide a new instance of configuration.</p>\n"},{"owner":{"user_id":2422776,"display_name":"Mureinik"},"up_vote_count":3,"is_accepted":false,"creation_date":1672679174,"answer_id":74985180,"body":"<p>Modern versions of Mockito allow you to mock constructors.</p>\n<p>First, make sure you have the <code>mockito-inline</code> dependency instead of the <code>mockito-core</code> dependency. E.g., in Maven, you'll have something like this:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n    &lt;artifactId&gt;mockito-inline&lt;/artifactId&gt;\n    &lt;version&gt;4.10.0&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Then, you can use the <code>mockConstruction</code> method to replace the constructor of <code>OtherClass</code>, and mock what even behavior you need for it:</p>\n<pre class=\"lang-java prettyprint-override\"><code>class MyClassTest {\n    @Mock\n    Configuration mockedConfig;\n    @Mock\n    Context mockedContext;\n\n    @Test\n    public void testConfigure() {\n        try (MockedConstruction&lt;OtherClass&gt; mockedConstruction = \n             Mockito.mockConstruction(OtherClass.class, (mock, context) -&gt; {\n            Mockito.when(mock.getConfiguration(Mockito.any())).thenReturn(mockedConfig);\n            // Additional mocking you may need\n        })) {\n            MyClass.configure(mockedContext);\n            // assertions...\n        }\n    }\n}\n</code></pre>\n"}],"owner":{"user_id":12772017,"display_name":"emanoellucas"},"view_count":210,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1672676824,"question_id":74984807,"body":"<p>I have the following class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import name.package.OtherClass;\nimport name.package.Context;\nimport name.package.Configuration.keys;\n\npublic class MyClass{\n    public static void configure(Context context){\n       Configuration config = new OtherClass().getConfiguration(keys);\n       context.configure(config);\n    }\n}\n</code></pre>\n<p>I want to mock the method <code>OtherClass.getConfiguration()</code>. Could I do the following?</p>\n<pre class=\"lang-java prettyprint-override\"><code>import org.mockito.Mock;\nimport org.mockito.Mockito;\n\npublic class MyClassTest{\n   @Mock\n   private Context context  = Mockito.mock(Context.class);\n   \n   @Mock\n   private OtherClass otherClass  = Mockito.mock(OtherClass.class);\n   \n   @Mock\n   private Context configurationMock  = Mockito.mock(Configuration.class);\n\n   @Test\n   public void testConfigure(){\n      Mockito.when(otherClass.getConfiguration(keys)).thenReturn(configurationMock);\n      MyClass.configure(context);\n      verify(context.configure(configurationMock), times(1))\n   }\n}\n</code></pre>\n<p>Remember that <code>OtherClass</code> is not an argument of <code>MyClass</code>, and I want to know if a mock of it inside the class of tests takes effect in <code>MyClass</code> instance when I run the test.</p>\n<p>I have tried executing this but didn't get clear results.</p>\n"},{"tags":["java","inheritance","abstract-class"],"answers":[{"owner":{"user_id":773113,"display_name":"Mike Nakis"},"up_vote_count":4,"is_accepted":true,"creation_date":1684338090,"answer_id":76273886,"body":"<p>It is okay for <code>B.someFunction()</code> to return a class more derived than <code>A.someFunction()</code>. It is still the same method, and the override works.</p>\n<p>However, it is not okay for <code>B.someFunction()</code> to <em><strong>accept a parameter</strong></em> of a class more derived than <code>A.someFunction()</code>.  When you try to do that, the override breaks.</p>\n<p>Think of it this way: someone may have a reference to an <code>A</code> which is in fact an instance of <code>B</code>.  They may invoke it passing it an actual <code>A</code>. However, <code>B.someFunction()</code> expects an instance of <code>B</code>, and it will try to invoke methods of <code>B</code> which do not exist in the <code>A</code> that was passed. That would not work.</p>\n"}],"owner":{"user_id":10715700,"display_name":"BBloggsbott"},"view_count":24,"up_vote_count":2,"accepted_answer_id":76273886,"answer_count":1,"score":2,"creation_date":1684337720,"question_id":76273822,"body":"<p>I have the classes</p>\n<pre class=\"lang-java prettyprint-override\"><code>abstract class A&lt;T&gt; {\n\n    public abstract A&lt;T&gt; someFunction(A&lt;?&gt; obj);\n}\n\npublic class B extends A&lt;Integer&gt;{\n\n    public B someFunction(B obj){...}\n}\n</code></pre>\n<p>I get an error that says <code>Class B must be declared abstract or must implement the abstract method someFunction(A&lt;?&gt; obj) in A</code>. My return type and parameter type are children of A. I don't understand why I am still getting this error.</p>\n<p><a href=\"https://stackoverflow.com/questions/40072186/how-to-use-abstract-class-child-type-as-the-type-of-an-abstract-methods-parame\">This</a> is one solution I see where I can change <code>A</code> to something like <code>A&lt;T, ChildName&gt;</code> and use <code>ChildName</code> as the abstract function's parameter type. Is there a different way of doing this?</p>\n"},{"tags":["java","swing","gridbaglayout"],"comments":[{"owner":{"user_id":6280255,"display_name":"Just another Java programmer"},"edited":false,"comment_id":134484175,"body":"Why do you add cells that you don&#39;t want?"},{"owner":{"user_id":6276545,"display_name":"Ewe"},"edited":false,"comment_id":134484294,"body":"just to show that it works if they are there (I found this somewhere on internet, and wanted to use it without second row, and its not working)"},{"owner":{"user_id":992484,"display_name":"MadProgrammer"},"edited":false,"comment_id":134484557,"body":"I would start by adding 1 &amp; 2 to seperate container"},{"owner":{"user_id":525725,"display_name":"Emmanuel Bourg"},"edited":false,"comment_id":134486818,"body":"GridBagLayouts are never as expected ;) You should really look at another layout manager, such as MigLayout."}],"answers":[{"owner":{"user_id":300257,"display_name":"Gilbert Le Blanc"},"up_vote_count":1,"is_accepted":false,"creation_date":1684236441,"answer_id":76262489,"body":"<p>I finally got this GUI to work, but I had to use two hacks that I don't recommend using.</p>\n<p><a href=\"https://i.stack.imgur.com/hYhIL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hYhIL.png\" alt=\"Example\" /></a></p>\n<p>Oracle has a helpful tutorial, <a href=\"https://docs.oracle.com/javase/tutorial/uiswing/index.html\" rel=\"nofollow noreferrer\">Creating a GUI With Swing</a>.  Skip the Learning Swing with the NetBeans IDE section.</p>\n<p>The reason this GUI is difficult to achieve is that the <code>GridBagLayout</code> has nothing to use to size the four columns.  So, borrowing from the OP, I created a row of empty <code>JLabels</code> before creating the rows of <code>JButtons</code>.  I sized the <code>JLabels</code> based on the size of a <code>JButton</code>.</p>\n<p>I wasn't sure until I tried it, but a <code>gridheight</code> of zero keeps the <code>JLabels</code> in the same physical location as the first row of <code>JButtons</code>.</p>\n<p>Here's the complete, ugly, runnable code.</p>\n<pre><code>import java.awt.BorderLayout;\nimport java.awt.Dimension;\nimport java.awt.GridBagConstraints;\nimport java.awt.GridBagLayout;\nimport java.awt.Insets;\n\nimport javax.swing.JButton;\nimport javax.swing.JFrame;\nimport javax.swing.JLabel;\nimport javax.swing.JPanel;\nimport javax.swing.SwingUtilities;\n\npublic class GridBagLayoutTest2 implements Runnable {\n\n    public static void main(String[] args) {\n        SwingUtilities.invokeLater(new GridBagLayoutTest2());\n    }\n\n    @Override\n    public void run() {\n        JFrame frame = new JFrame();\n        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n\n        frame.add(createPanels(), BorderLayout.CENTER);\n\n        frame.pack();\n        frame.setLocationByPlatform(true);\n        frame.setVisible(true);\n    }\n\n    private JPanel createPanels() {\n        JPanel panel = new JPanel(new GridBagLayout());\n\n        GridBagConstraints gbc = new GridBagConstraints();\n        gbc.anchor = GridBagConstraints.LINE_START;\n        gbc.fill = GridBagConstraints.HORIZONTAL;\n        gbc.insets = new Insets(5, 5, 5, 5);\n        gbc.weightx = 0.0;\n        \n        JButton button1 = new JButton(&quot;Button 1&quot;);\n        Dimension d = button1.getPreferredSize();\n        \n        gbc.gridheight = 0;\n        gbc.gridwidth = 1;\n        gbc.gridx = 0;\n        gbc.gridy = 0;\n        for (int index = 0; index &lt; 4; index++) {\n            JLabel label = new JLabel();\n            label.setPreferredSize(d);\n            panel.add(label, gbc);\n            gbc.gridx++;\n        }\n\n        gbc.gridheight = 1;\n        gbc.gridwidth = 2;\n        gbc.gridx = 0;\n        gbc.gridy++;\n        gbc.weightx = 1.0;\n        panel.add(button1, gbc);\n        \n        gbc.gridx += 2;\n        JButton button2 = new JButton(&quot;Button 2&quot;);\n        panel.add(button2, gbc);\n        \n        gbc.gridwidth = 1;\n        gbc.gridx = 0;\n        gbc.gridy++;\n        JButton button3 = new JButton(&quot;Button 3&quot;);\n        panel.add(button3, gbc);\n        \n        gbc.gridwidth = 2;\n        gbc.gridx += 1;\n        JButton button4 = new JButton(&quot;Button 4&quot;);\n        panel.add(button4, gbc);\n        \n        gbc.gridwidth = 1;\n        gbc.gridx += 2;\n        JButton button5 = new JButton(&quot;Button 5&quot;);\n        panel.add(button5, gbc);\n\n        return panel;\n    }\n\n}\n</code></pre>\n"},{"owner":{"user_id":992484,"display_name":"MadProgrammer"},"up_vote_count":1,"is_accepted":true,"creation_date":1684237284,"answer_id":76262625,"body":"<p>Any suitable complex UI/layout should be split into multiple components.  This is commonly known as &quot;compound layouts&quot;.</p>\n<p>This allows you to better focus on the individual needs of each &quot;area&quot; of the layout independently.</p>\n<p>Sometimes, you just need to fake it.</p>\n<p><a href=\"https://i.stack.imgur.com/U9BFL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/U9BFL.png\" alt=\"enter image description here\" /></a></p>\n<p><em>Please note, I've used labels instead of button as a demonstration only, as MacOs buttons have a lot of space around them and this better illustrates the use of the <code>GridBagConstraints#insets</code></em></p>\n<pre><code>import java.awt.Color;\nimport java.awt.EventQueue;\nimport java.awt.GridBagConstraints;\nimport java.awt.GridBagLayout;\nimport java.awt.Insets;\nimport javax.swing.JFrame;\nimport javax.swing.JLabel;\nimport javax.swing.JPanel;\nimport javax.swing.border.EmptyBorder;\n\npublic class Main {\n    public static void main(String[] args) {\n        new Main();\n    }\n\n    public Main() {\n        EventQueue.invokeLater(new Runnable() {\n            @Override\n            public void run() {\n                JFrame frame = new JFrame();\n                frame.add(new TestPane());\n                frame.pack();\n                frame.setLocationRelativeTo(null);\n                frame.setVisible(true);\n            }\n        });\n    }\n\n    public class TestPane extends JPanel {\n\n        public TestPane() {\n            setLayout(new GridBagLayout());\n            GridBagConstraints gbc = new GridBagConstraints();\n            gbc.weightx = 1;\n            gbc.fill = gbc.HORIZONTAL;\n            gbc.insets = new Insets(4, 0, 4, 0);\n            gbc.gridwidth = GridBagConstraints.REMAINDER;\n\n            add(makeFirstRow(), gbc);\n            add(makeSecondRow(), gbc);\n            add(makeThirdRow(), gbc);\n        }\n\n        protected JLabel makeLabel(String text) {\n            JLabel label = new JLabel(text);\n            label.setHorizontalAlignment(JLabel.CENTER);\n            label.setOpaque(true);\n            label.setBackground(Color.RED);\n            label.setBorder(new EmptyBorder(8, 32, 8, 32));\n            return label;\n        }\n\n        protected JPanel makeFirstRow() {\n            JPanel rowPane = new JPanel(new GridBagLayout());\n            GridBagConstraints gbc = new GridBagConstraints();\n            gbc.weightx = 1;\n            gbc.fill = gbc.HORIZONTAL;\n            gbc.insets = new Insets(0, 4, 0, 4);\n\n            rowPane.add(makeLabel(&quot;1&quot;), gbc);\n            rowPane.add(makeLabel(&quot;2&quot;), gbc);\n\n            return rowPane;\n        }\n\n        protected JPanel makeSecondRow() {\n            JPanel rowPane = new JPanel(new GridBagLayout());\n            GridBagConstraints gbc = new GridBagConstraints();\n            gbc.weightx = 1;\n            gbc.fill = gbc.HORIZONTAL;\n            gbc.insets = new Insets(0, 4, 0, 4);\n\n            rowPane.add(makeLabel(&quot;3&quot;), gbc);\n            rowPane.add(makeLabel(&quot;4&quot;), gbc);\n            rowPane.add(makeLabel(&quot;5&quot;), gbc);\n\n            return rowPane;\n        }\n\n        protected JPanel makeThirdRow() {\n            JPanel rowPane = new JPanel(new GridBagLayout());\n            GridBagConstraints gbc = new GridBagConstraints();\n            gbc.weightx = 1;\n            gbc.fill = gbc.HORIZONTAL;\n            gbc.insets = new Insets(0, 4, 0, 4);\n\n            rowPane.add(makeLabel(&quot;6&quot;), gbc);\n            rowPane.add(makeLabel(&quot;7&quot;), gbc);\n            rowPane.add(makeLabel(&quot;8&quot;), gbc);\n\n            return rowPane;\n        }\n    }\n\n}\n</code></pre>\n<p>Now, I don't know about you, but I was tempted to create some kind of factory method which would create each row, based on the number of elements I needed in each row ... but that's me 😉</p>\n<blockquote>\n<p>but with a little bit different layout. button 4 (and 7 in your layout) should be same size as buttons 1 and 2, but in your case they are 2/3 of the size of 1 and 2, and buttons 3 and 5 should be 1/2 of 1 and 2, and here they are 2/3</p>\n</blockquote>\n<p>Then change the columns <code>weightx</code> property accordingly, for example...</p>\n<p><a href=\"https://i.stack.imgur.com/7GwLe.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/7GwLe.png\" alt=\"enter image description here\" /></a></p>\n<pre><code>protected JPanel makeSecondRow() {\n    JPanel rowPane = new JPanel(new GridBagLayout());\n    GridBagConstraints gbc = new GridBagConstraints();\n    gbc.fill = gbc.HORIZONTAL;\n    gbc.insets = new Insets(0, 4, 0, 4);\n\n    gbc.weightx = 0.25;\n    rowPane.add(makeLabel(&quot;3&quot;), gbc);\n    gbc.weightx = 0.5;\n    // This is simply adding an addition padding to the\n    // labels preferred size, otherwise all three buttons\n    // can be layed out at there preferred size with the\n    // avaliable space\n    gbc.ipadx = 64;\n    rowPane.add(makeLabel(&quot;4&quot;), gbc);\n    gbc.weightx = 0.25;\n    gbc.ipadx = 0;\n    rowPane.add(makeLabel(&quot;5&quot;), gbc);\n\n    return rowPane;\n}\n</code></pre>\n<p>Now, remember, the components own preferred size plays into this.  Without the additional <code>ipadx</code>, all three elements can be layed out their preferred size with in the available container area.</p>\n<p>And, no, you don't &quot;need&quot; to specify the <code>weightx</code> for each column, this is just a demonstration, but sometimes, you might find it more useful to be absolute in your desires.</p>\n"},{"owner":{"user_id":16320675,"display_name":"user16320675"},"up_vote_count":1,"is_accepted":false,"creation_date":1684244452,"answer_id":76263741,"body":"<p>I would use one additional <code>JPanel</code> for each line, and would not extend <code>JFrame</code> (unless needed, that is, adding functionality to it)):</p>\n<pre><code>public class SwingApp2 {\n    \n    public static void main(String[] args) {\n        SwingUtilities.invokeLater(SwingApp2::new);\n    }\n\n    private SwingApp2()\n    {\n        var jb1 = new JButton(&quot;1&quot;);\n        var jb2 = new JButton(&quot;2&quot;);\n        var jb3 = new JButton(&quot;3&quot;);\n        var jb4 = new JButton(&quot;4&quot;);\n        var jb5 = new JButton(&quot;5&quot;);\n\n        var line1 = new JPanel(new GridBagLayout());\n        var gbc = new GridBagConstraints(RELATIVE, 0, 1, 1, 1.0, 1.0, CENTER, BOTH, new Insets(0, 0, 0, 0), 0, 0);\n        line1.add(jb1, gbc);\n        line1.add(jb2, gbc);\n\n        var line2 = new JPanel(new GridBagLayout());\n        line2.add(jb3, gbc);\n        gbc.weightx *= 2;\n        line2.add(jb4, gbc);\n        gbc.weightx /= 2;\n        line2.add(jb5, gbc);\n\n        var frame = new JFrame();\n        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);\n        // using GridLayout so the lines are same height\n        frame.setLayout(new GridLayout(0, 1));\n        frame.add(line1);\n        frame.add(line2);\n        frame.setSize(700,200);\n        frame.setVisible(true);\n    }\n}\n</code></pre>\n<p>Result:<br />\n<a href=\"https://i.stack.imgur.com/RZT63.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RZT63.png\" alt=\"enter image description here\" /></a></p>\n<p><sub>Just one way to do it, very dependent of how the components should be resized if the GUI size is changed</sub><br />\n<sub>Also be aware that sizes will change according to preferred size, that is, labels content</sub></p>\n"},{"owner":{"user_id":1831987,"display_name":"VGR"},"up_vote_count":0,"is_accepted":false,"creation_date":1684246825,"answer_id":76264144,"body":"<p>GridBagLayout is concerned with alignment, not proportions.  Occasionally it can be used to lay out components with equal sizes, but it’s not good at that.</p>\n<p><a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.desktop/javax/swing/SpringLayout.html\" rel=\"nofollow noreferrer\">SpringLayout</a>, however, is quite good at that, and has methods specifically for doing that.  The trade-off is that SpringLayout is hard to use and easy to use incorrectly.  It works like the “form layouts” of the 1990s.  For each component in the layout, you have to state where at least one horizontal edge and one vertical edge should be located, relative to the edges of the container or relative to the edges of other child components.</p>\n<p>First, it’s better to create your container, rather than extending JFrame.  It doesn’t make sense to subclass JFrame, since you’re merely using JFrame, not changing its behavior:</p>\n<pre><code>SpringLayout layout = new SpringLayout();\nJPanel panel = new JPanel(layout);\n</code></pre>\n<p>Next, let’s compute a consistent size for the small buttons:</p>\n<pre><code>JButton[] buttons = { jb1, jb2, jb3, jb4, jb5 };\n\nSpring width = Spring.constant(0);\nSpring height = Spring.constant(0);\nfor (JButton button : buttons) {\n    width = Spring.max(width, Spring.width(button));\n    height = Spring.max(height, Spring.height(button));\n}\n</code></pre>\n<p>Next, let’s make buttons 1, 2, and 4 twice as wide:</p>\n<pre><code>Spring largeButtonWidth = Spring.scale(width, 2);\n</code></pre>\n<p>Now we can use those Springs to create <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.desktop/javax/swing/SpringLayout.Constraints.html\" rel=\"nofollow noreferrer\">constraints</a> for each button:</p>\n<pre><code>Spring zero = Spring.constant(0);\n\npanel.add(jb1, new SpringLayout.Constraints(\n    zero, zero, largeButtonWidth, height));\n\npanel.add(jb2, new SpringLayout.Constraints(\n    largeButtonWidth, zero, largeButtonWidth, height));\n\npanel.add(jb3, new SpringLayout.Constraints(\n    zero, height, width, height));\n\npanel.add(jb4, new SpringLayout.Constraints(\n    width, height, largeButtonWidth, height));\n\npanel.add(jb5, new SpringLayout.Constraints(\n    Spring.sum(width, largeButtonWidth), height, width, height));\n</code></pre>\n<p>Finally, we need to tell the layout how big the container itself should be.  It needs to be wide enough to accommodate jb2 and jb5, and tall enough to accommodate jb3, jb4, and jb5.  We could use any of those to specify the container’s preferred size, but jb5 is probably the easiest choice:</p>\n<pre><code>layout.putConstraint(\n    SpringLayout.EAST, panel, 0, SpringLayout.EAST, jb5);\nlayout.putConstraint(\n    SpringLayout.SOUTH, panel, 0, SpringLayout.SOUTH, jb5);\n</code></pre>\n<p>Putting it all together looks like this:</p>\n<pre><code>import java.awt.EventQueue;\n\nimport javax.swing.JButton;\nimport javax.swing.JPanel;\nimport javax.swing.JFrame;\nimport javax.swing.Spring;\nimport javax.swing.SpringLayout;\n\npublic class RelativeButtonSizesDemo {\n    private final JFrame frame;\n\n    public RelativeButtonSizesDemo() {\n        JButton jb1 = new JButton(&quot;1&quot;);\n        JButton jb2 = new JButton(&quot;2&quot;);\n        JButton jb3 = new JButton(&quot;3&quot;);\n        JButton jb4 = new JButton(&quot;4&quot;);\n        JButton jb5 = new JButton(&quot;5&quot;);\n\n        JButton[] buttons = { jb1, jb2, jb3, jb4, jb5 };\n\n        Spring width = Spring.constant(0);\n        Spring height = Spring.constant(0);\n        for (JButton button : buttons) {\n            width = Spring.max(width, Spring.width(button));\n            height = Spring.max(height, Spring.height(button));\n        }\n\n        // jb1, jb2, and jb4 will be twice as wide as the other buttons.\n        Spring largeButtonWidth = Spring.scale(width, 2);\n\n        SpringLayout layout = new SpringLayout();\n        JPanel panel = new JPanel(layout);\n\n        Spring zero = Spring.constant(0);\n\n        panel.add(jb1, new SpringLayout.Constraints(\n            zero, zero, largeButtonWidth, height));\n\n        panel.add(jb2, new SpringLayout.Constraints(\n            largeButtonWidth, zero, largeButtonWidth, height));\n\n        panel.add(jb3, new SpringLayout.Constraints(\n            zero, height, width, height));\n\n        panel.add(jb4, new SpringLayout.Constraints(\n            width, height, largeButtonWidth, height));\n\n        panel.add(jb5, new SpringLayout.Constraints(\n            Spring.sum(width, largeButtonWidth), height, width, height));\n\n        // Set preferred size of panel itself to accommodate buttons.\n        layout.putConstraint(\n            SpringLayout.EAST, panel, 0, SpringLayout.EAST, jb5);\n        layout.putConstraint(\n            SpringLayout.SOUTH, panel, 0, SpringLayout.SOUTH, jb5);\n\n        frame = new JFrame(&quot;Relative Button Sizes Demo&quot;);\n        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        frame.getContentPane().add(panel);\n        frame.pack();\n        frame.setLocationByPlatform(true);\n    }\n\n    public void show() {\n        frame.setVisible(true);\n    }\n\n    public static void main(String[] args) {\n        EventQueue.invokeLater(() -&gt; new RelativeButtonSizesDemo().show());\n    }\n}\n</code></pre>\n"},{"owner":{"user_id":131872,"display_name":"camickr"},"up_vote_count":1,"is_accepted":false,"creation_date":1684275800,"answer_id":76267435,"body":"<blockquote>\n<p>The reason this GUI is difficult to achieve is that the GridBagLayout has nothing to use to size the four columns</p>\n</blockquote>\n<p><code>GridBagLayout</code> does have properties that allow you to define default values for columns that don't have components as is demonstrated below:</p>\n<pre><code>import java.util.*;\nimport java.awt.BorderLayout;\nimport java.awt.Dimension;\nimport java.awt.GridBagConstraints;\nimport java.awt.GridBagLayout;\nimport java.awt.Insets;\n\nimport javax.swing.JButton;\nimport javax.swing.JFrame;\nimport javax.swing.JLabel;\nimport javax.swing.JPanel;\nimport javax.swing.SwingUtilities;\n\npublic class GridBagLayoutTest3 implements Runnable {\n\n    public static void main(String[] args) {\n        SwingUtilities.invokeLater(new GridBagLayoutTest3());\n    }\n\n    @Override\n    public void run() {\n        JFrame frame = new JFrame();\n        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n\n        frame.add(createPanels(), BorderLayout.CENTER);\n\n        frame.pack();\n        frame.setLocationByPlatform(true);\n        frame.setVisible(true);\n    }\n\n    private JPanel createPanels() {\n\n        //  Create the GridBagLayout and GridBagConstraints to be used by the panel\n\n        GridBagLayout gbl = new GridBagLayout();\n        JPanel panel = new JPanel(gbl);\n\n        GridBagConstraints gbc = new GridBagConstraints();\n        gbc.anchor = GridBagConstraints.LINE_START;\n        gbc.fill = GridBagConstraints.HORIZONTAL;\n        gbc.insets = new Insets(5, 5, 5, 5);\n\n        //  Create and add components to the panel\n\n        JButton button1 = new JButton(&quot;Button 1&quot;);\n        gbc.gridx = 0;\n        gbc.gridy = 0;\n        gbc.gridwidth = 2;\n        panel.add(button1, gbc);\n\n        gbc.gridx += 2;\n        JButton button2 = new JButton(&quot;Button 2&quot;);\n        panel.add(button2, gbc);\n\n        gbc.gridwidth = 1;\n        gbc.gridx = 0;\n        gbc.gridy++;\n        JButton button3 = new JButton(&quot;Button 3&quot;);\n        panel.add(button3, gbc);\n\n        gbc.gridwidth = 2;\n        gbc.gridx += 1;\n        JButton button4 = new JButton(&quot;Button 4&quot;);\n        panel.add(button4, gbc);\n\n        gbc.gridwidth = 1;\n        gbc.gridx += 2;\n        JButton button5 = new JButton(&quot;Button 5&quot;);\n        panel.add(button5, gbc);\n\n        //  Set properties of the GridBagLayout for columns without components in a single column\n\n        int[] columns = new int[4];\n        Arrays.fill(columns, button1.getPreferredSize().width);\n        gbl.columnWidths = columns;\n        double[] weights = new double[4];\n        Arrays.fill(weights, 1.0);\n        gbl.columnWeights = weights;\n\n        return panel;\n    }\n\n}\n</code></pre>\n<p>Note: you can also check out: <a href=\"https://stackoverflow.com/a/57463596/131872\">https://stackoverflow.com/a/57463596/131872</a> which has a more involved example showing how to use this approach for a &quot;keyboard&quot; layout of buttons.</p>\n"}],"owner":{"user_id":6276545,"display_name":"Ewe"},"view_count":68,"up_vote_count":2,"accepted_answer_id":76262625,"answer_count":5,"score":2,"creation_date":1684231058,"question_id":76261701,"body":"<p>Some how I can't get gridwidth to work in GridBagLayout in my simple SwingApp.</p>\n<p>I have this code in Java Swing:</p>\n<pre><code>import javax.swing.JFrame;\nimport javax.swing.JLabel;\nimport javax.swing.JPanel;\nimport javax.swing.border.Border;\nimport javax.swing.BorderFactory;\nimport javax.swing.JButton;\nimport java.awt.GridBagLayout;\nimport java.awt.GridBagConstraints;\n\nclass GridBagLayt extends JFrame {\n \n    GridBagLayt()\n    {\n        JButton jb1 = new JButton(&quot;1&quot;);\n        JButton jb2 = new JButton(&quot;2&quot;);\n        JButton jb3 = new JButton(&quot;3&quot;);\n        JButton jb4 = new JButton(&quot;4&quot;);\n        JButton jb5 = new JButton(&quot;5&quot;);\n        \n        GridBagLayout lay = new GridBagLayout();\n        GridBagConstraints cons = new GridBagConstraints();\n        \n        setLayout(lay);\n        cons.fill = GridBagConstraints.BOTH;\n        cons.gridheight = 1;\n        cons.weightx = 1;\n        cons.weighty = 1;\n\n\n        cons.gridx = 0; cons.gridy = 0; \n        cons.gridwidth = 2;\n        lay.setConstraints(jb1, cons);\n        add(jb1);\n        \n        cons.gridx = 2; \n        lay.setConstraints(jb2, cons);\n        add(jb2);\n         \n        cons.gridx = 0; cons.gridy = 1; \n        cons.gridwidth = 1;\n        lay.setConstraints(jb3, cons);\n        add(jb3);\n        \n        cons.gridx = 1;\n        cons.gridwidth = 2;\n        lay.setConstraints(jb4, cons);\n        add(jb4);\n        \n        cons.gridx = 3;\n        cons.gridwidth = 1;\n        lay.setConstraints(jb5, cons);\n        add(jb5);\n        \n        \n        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        setSize(700,200);\n        setVisible(true);\n    }\n  }\n\n    public class SwingApp {\n \n        public static void main(String[] args) {\n     \n            new GridBagLayt();\n        }\n    }\n</code></pre>\n<p>This is what I want to get:\n<a href=\"https://i.stack.imgur.com/Jtcf4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Jtcf4.png\" alt=\"enter image description here\" /></a></p>\n<p>But instead I get this:</p>\n<p><a href=\"https://i.stack.imgur.com/ZtvvA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZtvvA.png\" alt=\"enter image description here\" /></a></p>\n<p>I really don't know what the problem is, the coordinate and gridwidth seems ok to me, and I expected this to work, but it's not. And if I add four more buttons between this two rows, then the third row seems OK, but I don't want that:</p>\n<p>Example: If I add this code</p>\n<pre><code>cons.gridx = 0; cons.gridy = 0; \n        cons.gridwidth = 2;\n        lay.setConstraints(jb1, cons);\n        add(jb1);\n        \n        cons.gridx = 2; \n        lay.setConstraints(jb2, cons);\n        add(jb2);\n        \n        \n        cons.gridx = 0; cons.gridy = 1; \n        cons.gridwidth = 1;\n        lay.setConstraints(jb3, cons);\n        add(jb3);\n        \n        cons.gridx = 1;\n        lay.setConstraints(jb4, cons);\n        add(jb4);\n        \n        cons.gridx = 2;\n        lay.setConstraints(jb5, cons);\n        add(jb5);\n      \n        cons.gridx = 3;\n        lay.setConstraints(jb6, cons);\n        add(jb6);\n        \n        cons.gridx = 0; cons.gridy = 2; \n        lay.setConstraints(jb7, cons);\n        add(jb7);\n        \n        \n        cons.gridx = 1; cons.gridy = 2; \n        cons.gridwidth = 2;\n        lay.setConstraints(jb8, cons);\n        add(jb8);\n        \n        cons.gridx = 3; cons.gridy = 2; \n        cons.gridwidth = 1;\n        lay.setConstraints(jb9, cons);\n        add(jb9);\n</code></pre>\n<p>Then I got this:</p>\n<p><a href=\"https://i.stack.imgur.com/uOShA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uOShA.png\" alt=\"enter image description here\" /></a></p>\n<p><strong>But I don't want this second row</strong></p>\n"},{"tags":["java","kotlin","gradle","spring-webflux","testcontainers"],"comments":[{"owner":{"user_id":721855,"display_name":"aled"},"edited":false,"comment_id":134446814,"body":"How is that type used in your project? Add the gradle configuration to your post."},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":134446843,"body":"I am building using the code that I listed via the repository link under the <code>bootiful</code> sub-project (see above). Can you try doing a <code>git clone</code> and building using <code>gradle build</code>?"},{"owner":{"user_id":721855,"display_name":"aled"},"edited":false,"comment_id":134446881,"body":"That&#39;s not a minimal reproducible example appropriate for SO, as explained in the help center page: <a href=\"http://stackoverflow.com/help/minimal-reproducible-example\">stackoverflow.com/help/minimal-reproducible-example</a>. Also the warning is not an error. Does it fail without <code>--warning-mode=all</code>?"},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":134447045,"body":"Yes, it does fail without <code>--warning-mode=all</code> but the cause was ambiguous... This is why I used the warning mode, to begin with. Just edited my post to reflect this (see above)."},{"owner":{"user_id":77409,"display_name":"James Ward"},"edited":false,"comment_id":134447642,"body":"It looks like maybe a problem with Docker.  Is that the full stacktrace?"},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":134447677,"body":"@JamesWard - yes, but I don&#39;t have Docker daemon running, just cloned the repo and <code>cd&#39;d</code> into <code>bootiful</code> dir and did a <code>gradle build</code>..."},{"owner":{"user_id":77409,"display_name":"James Ward"},"edited":false,"comment_id":134447710,"body":"Testcontainers uses the docker daemon directly.  So you definitely need a working docker daemon for that part to work."},{"owner":{"user_id":77409,"display_name":"James Ward"},"edited":false,"comment_id":134447768,"body":"<code>.&#47;gradlew build</code> runs the tests and that uses Testcontainers."},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":134447842,"body":"<code>.&#47;gradlew build</code> didn&#39;t work, I already tried that as well and reported that in my post. Does the database or any other prerequisites need to be setup first?"},{"owner":{"user_id":77409,"display_name":"James Ward"},"edited":false,"comment_id":134448730,"body":"<code>.&#47;gradlew build</code> will not work without a docker daemon as it sets up a postgres db via docker using Testcontainers."},{"owner":{"user_id":77409,"display_name":"James Ward"},"edited":false,"comment_id":134470373,"body":"Can you run <code>.&#47;gradlew build --info</code> ?"}],"answers":[{"owner":{"user_id":6933090,"display_name":"Yevhenii Semenov"},"up_vote_count":2,"is_accepted":false,"creation_date":1684161306,"answer_id":76255159,"body":"<p>According to your stacktrace, the issue you are experiencing is related to Docker:</p>\n<pre><code>Caused by: java.lang.IllegalStateException at DockerClientProviderStrategy.java:256\n</code></pre>\n<p>The line 256 in <code>DockerClientProviderStrategy</code> has the following code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>log.error(\n    &quot;Could not find a valid Docker environment. Please check configuration. Attempted configurations were:\\n&quot; +\n        configurationFailures.stream().map(it -&gt; &quot;\\t&quot; + it).collect(Collectors.joining(&quot;\\n&quot;)) +\n        &quot;As no valid configuration was found, execution cannot continue.\\n&quot; +\n        &quot;See https://www.testcontainers.org/on_failure.html for more details.&quot;\n);\n\nFAIL_FAST_ALWAYS.set(true);\nreturn new IllegalStateException(\n    &quot;Could not find a valid Docker environment. Please see logs and check configuration&quot;\n);\n</code></pre>\n<p>Did you have the opportunity to try the instructions provided here? <a href=\"https://www.testcontainers.org/on_failure.html\" rel=\"nofollow noreferrer\">https://www.testcontainers.org/on_failure.html</a>\n<a href=\"https://www.testcontainers.org/supported_docker_environment/\" rel=\"nofollow noreferrer\">https://www.testcontainers.org/supported_docker_environment/</a></p>\n<p>My suggestion would be to try updating or reinstalling Docker. This could potentially solve the issue.</p>\n"},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"up_vote_count":2,"is_accepted":true,"creation_date":1684206849,"answer_id":76259166,"body":"<p>After running <code>./gradlew build --info</code>, the output was something similar to:</p>\n<pre><code>Caused by: java.lang.IllegalStateException: Could not find a valid Docker environment. Please see logs and check configuration\nat org.testcontainers.dockerclient.DockerClientProviderStrategy.lambda$getFirstValidStrategy$3(DockerClientProviderStrategy.java:158)\nat java.util.Optional.orElseThrow(Optional.java:290)\nat org.testcontainers.dockerclient.DockerClientProviderStrategy.getFirstValidStrategy(DockerClientProviderStrategy.java:150)\nat org.testcontainers.DockerClientFactory.client(DockerClientFactory.java:111)\n</code></pre>\n<p>Fixed this by running this from the command line:</p>\n<p><code>sudo ln -s $HOME/.docker/run/docker.sock /var/run/docker.sock</code></p>\n<p>Courtesy of a comment someone answered to this SO post:</p>\n<p><a href=\"https://stackoverflow.com/questions/61108655/test-container-test-cases-are-failing-due-to-could-not-find-a-valid-docker-envi\">Test Container test cases are failing due to &quot;Could not find a valid Docker environment&quot;</a></p>\n<p>Now, when I run <code>./gradlew build</code>:</p>\n<pre><code>2023-05-15T20:07:54.290-07:00  INFO 7818 --- [tainers-r2dbc-0] 🐳 [testcontainers/ryuk:0.3.4]           : Creating container for image: testcontainers/ryuk:0.3.4\n    2023-05-15T20:07:55.675-07:00  INFO 7818 --- [tainers-r2dbc-0] 🐳 [testcontainers/ryuk:0.3.4]           : Container testcontainers/ryuk:0.3.4 is starting: bc9d6884bf1fe1cc80d8df0754814059953607456dff07dcde380f128fcf00bd\n    2023-05-15T20:07:57.176-07:00  INFO 7818 --- [tainers-r2dbc-0] 🐳 [testcontainers/ryuk:0.3.4]           : Container testcontainers/ryuk:0.3.4 started in PT3.00059S\n    2023-05-15T20:07:57.202-07:00  INFO 7818 --- [tainers-r2dbc-0] o.t.utility.RyukResourceReaper           : Ryuk started - will monitor and terminate Testcontainers containers on JVM exit\n    2023-05-15T20:07:57.203-07:00  INFO 7818 --- [tainers-r2dbc-0] org.testcontainers.DockerClientFactory   : Checking the system...\n    2023-05-15T20:07:57.205-07:00  INFO 7818 --- [tainers-r2dbc-0] org.testcontainers.DockerClientFactory   : ✔︎ Docker server version should be at least 1.6.0\n    2023-05-15T20:07:57.207-07:00  INFO 7818 --- [tainers-r2dbc-0] 🐳 [postgres:13.3]                       : Creating container for image: postgres:13.3\n    2023-05-15T20:07:57.389-07:00  INFO 7818 --- [tainers-r2dbc-0] 🐳 [postgres:13.3]                       : Container postgres:13.3 is starting: a7af084644cc8f800f51b23ea0e3fab8ea83168f7697c009593262eff34f915c\n    2023-05-15T20:08:02.544-07:00  INFO 7818 --- [tainers-r2dbc-0] 🐳 [postgres:13.3]                       : Container postgres:13.3 started in PT5.337754S\n    2023-05-15T20:08:03.664-07:00  INFO 7818 --- [    Test worker] bootiful.kotlin.KotlinApplicationTests   : Started KotlinApplicationTests in 18.086 seconds (process running for 22.064)\n    Customer(id=1, name=James)\n    Customer(id=2, name=Josh)\n</code></pre>\n"}],"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"view_count":115,"up_vote_count":2,"accepted_answer_id":76259166,"answer_count":2,"score":2,"creation_date":1683923498,"question_id":76239764,"body":"<p>Was following along with <a href=\"https://www.youtube.com/watch?v=pXtTp4Uxuhk\" rel=\"nofollow noreferrer\">Spring + Kotlin = Modern + Reactive + Productive</a> presentation on YouTube! by creating a Kotlin-based Spring Web Flux Reactive app using <a href=\"https://start.spring.io/..\" rel=\"nofollow noreferrer\">https://start.spring.io/..</a>.</p>\n<p>Generated the project using these dependencies (please note the Spring Boot and Java versions, as well):</p>\n<p><a href=\"https://i.stack.imgur.com/YEPAR.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YEPAR.png\" alt=\"enter image description here\" /></a></p>\n<p>This generated the <code>build.gradle.kts</code> file:</p>\n<pre><code>plugins {\n        java\n        id(&quot;org.springframework.boot&quot;) version &quot;3.0.6&quot;\n        id(&quot;io.spring.dependency-management&quot;) version &quot;1.1.0&quot;\n        id(&quot;org.graalvm.buildtools.native&quot;) version &quot;0.9.20&quot;\n}\n\ngroup = &quot;bootiful&quot;\nversion = &quot;0.0.1-SNAPSHOT&quot;\njava.sourceCompatibility = JavaVersion.VERSION_17\n\nrepositories {\n        mavenCentral()\n}\n\nextra[&quot;testcontainersVersion&quot;] = &quot;1.18.1&quot;\n\ndependencies {\n        implementation(&quot;org.springframework.boot:spring-boot-starter-data-r2dbc&quot;)\n        implementation(&quot;org.springframework.boot:spring-boot-starter-webflux&quot;)\n        runtimeOnly(&quot;org.postgresql:postgresql&quot;)\n        runtimeOnly(&quot;org.postgresql:r2dbc-postgresql&quot;)\n        testImplementation(&quot;org.springframework.boot:spring-boot-starter-test&quot;)\n        testImplementation(&quot;io.projectreactor:reactor-test&quot;)\n        testImplementation(&quot;org.testcontainers:junit-jupiter&quot;)\n        testImplementation(&quot;org.testcontainers:postgresql&quot;)\n        testImplementation(&quot;org.testcontainers:r2dbc&quot;)\n}\n\ndependencyManagement {\n        imports {\n                mavenBom(&quot;org.testcontainers:testcontainers-bom:${property(&quot;testcontainersVersion&quot;)}&quot;)\n        }\n}\n\ntasks.withType&lt;Test&gt; {\n        useJUnitPlatform()\n}\n</code></pre>\n<p>Was getting an error when I tried to build it initially (after downloading &amp; extracting the zip file) using <code>gradle build</code> &amp; <code>./gradlew build</code> on macOS (both using IntelliJ &amp; command line).</p>\n<p>When I cloned the GitHub <a href=\"https://github.com/jamesward/nks\" rel=\"nofollow noreferrer\">project</a> that this presentation was based on, I got the same exact error:</p>\n<p>Using <code>gradle build</code> (also fails when using the wrapper e.g. <code>./gradlew build</code>):</p>\n<pre><code>KotlinApplicationTests &gt; contextLoads() FAILED\n    org.junit.jupiter.api.extension.ParameterResolutionException at ParameterResolutionUtils.java:159\n        Caused by: java.lang.IllegalStateException at DefaultCacheAwareContextLoaderDelegate.java:142\n            Caused by: org.springframework.beans.factory.BeanCreationException at AbstractAutowireCapableBeanFactory.java:1770\n                Caused by: org.springframework.r2dbc.connection.init.UncategorizedScriptException at DatabasePopulator.java:65\n                    Caused by: org.springframework.dao.DataAccessResourceFailureException at ConnectionFactoryUtils.java:90\n                        Caused by: java.util.concurrent.CompletionException at CompletableFuture.java:315\n                            Caused by: java.lang.IllegalStateException at DockerClientProviderStrategy.java:256\n</code></pre>\n<p>Using <code>gradle build --warning-mode=all</code>:</p>\n<pre><code>  .   ____          _            __ _ _\n /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\\n( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\\n \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )\n  '  |____| .__|_| |_|_| |_\\__, | / / / /\n =========|_|==============|___/=/_/_/_/\n :: Spring Boot ::                (v3.0.5)\n\n2023-05-12T13:12:54.326-07:00  INFO 50318 --- [           main] bootiful.kotlin.KotlinApplicationTests   : Starting KotlinApplicationTests using Java 20.0.1 with PID 50318 (/Users/pnwlover/nks/bootiful/build/classes/kotlin/test started by pnwlover/ in /Users/pnwlover/nks/bootiful)\n2023-05-12T13:12:54.328-07:00  INFO 50318 --- [           main] bootiful.kotlin.KotlinApplicationTests   : No active profile set, falling back to 1 default profile: &quot;default&quot;\n2023-05-12T13:12:55.184-07:00  INFO 50318 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data R2DBC repositories in DEFAULT mode.\n2023-05-12T13:12:55.378-07:00  INFO 50318 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 187 ms. Found 1 R2DBC repository interfaces.\n\n&gt; Task :compileAotTestJava\nNote: Some input files use unchecked or unsafe operations.\nNote: Recompile with -Xlint:unchecked for details.\n\n&gt; Task :test\nThe org.gradle.util.GFileUtils type has been deprecated. This is scheduled to be removed in Gradle 9.0. Consult the upgrading guide for further information: https://docs.gradle.org/8.1.1/userguide/upgrading_version_7.html#org_gradle_util_reports_deprecations\n\nKotlinApplicationTests &gt; contextLoads() FAILED\n    org.junit.jupiter.api.extension.ParameterResolutionException at ParameterResolutionUtils.java:159\n        Caused by: java.lang.IllegalStateException at DefaultCacheAwareContextLoaderDelegate.java:142\n            Caused by: org.springframework.beans.factory.BeanCreationException at AbstractAutowireCapableBeanFactory.java:1770\n                Caused by: org.springframework.r2dbc.connection.init.UncategorizedScriptException at DatabasePopulator.java:65\n                    Caused by: org.springframework.dao.DataAccessResourceFailureException at ConnectionFactoryUtils.java:90\n                        Caused by: java.util.concurrent.CompletionException at CompletableFuture.java:315\n                            Caused by: java.lang.IllegalStateException at DockerClientProviderStrategy.java:256\n\n</code></pre>\n<p>Gradle, Java &amp; Kotlin versions set in my local system:</p>\n<pre><code> gradle -v\n\n------------------------------------------------------------\nGradle 8.1.1\n------------------------------------------------------------\n\nBuild time:   2023-04-21 12:31:26 UTC\nRevision:     1cf537a851c635c364a4214885f8b9798051175b\n\nKotlin:       1.8.10\nGroovy:       3.0.15\nAnt:          Apache Ant(TM) version 1.10.11 compiled on July 10 2021\nJVM:          20.0.1 (Oracle Corporation 20.0.1+9-29)\nOS:           Mac OS X 12.6.5 x86_64\n</code></pre>\n<pre><code>java -version\njava version &quot;17.0.6&quot; 2023-01-17 LTS\nJava(TM) SE Runtime Environment (build 17.0.6+9-LTS-190)\nJava HotSpot(TM) 64-Bit Server VM (build 17.0.6+9-LTS-190, mixed mode, sharing)\n</code></pre>\n<pre><code>❯ kotlinc -version\ninfo: kotlinc-jvm 1.8.21 (JRE 20.0.1+9-29)\n</code></pre>\n<p>Why can't I build this when I do a fresh <code>git clone</code> from the repository?</p>\n<p>This is the project I am trying to build:</p>\n<p><a href=\"https://github.com/jamesward/nks/tree/main/bootiful\" rel=\"nofollow noreferrer\">https://github.com/jamesward/nks/tree/main/bootiful</a></p>\n<p>docker daemon was running, I ran the following command (before I tried building with <code>gradle build</code> and/or <code>./gradlew build</code>)</p>\n<p><code>docker ps</code>:</p>\n<p>output:</p>\n<pre><code>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n</code></pre>\n<p>Like, I said this also happened when I created a new project from within <a href=\"http://start.spring.io\" rel=\"nofollow noreferrer\">http://start.spring.io</a>. Is this due to TestContainers? Is there any steps/prerequisites required for TestContainers or any other config to be set?</p>\n<p>After running the Unix shell script located here:</p>\n<p><a href=\"https://github.com/jamesward/nks/blob/main/postgres.sh\" rel=\"nofollow noreferrer\">https://github.com/jamesward/nks/blob/main/postgres.sh</a></p>\n<p>And then checking the docker daemon:</p>\n<pre><code>CONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS                    NAMES\nd12e7449a853   postgres:13.3   &quot;docker-entrypoint.s…&quot;   36 seconds ago   Up 33 seconds   0.0.0.0:5432-&gt;5432/tcp   my-postgres\n</code></pre>\n<p>The Unix shell script's tail end:</p>\n<pre><code>PostgreSQL init process complete; ready for start up.\n\n2023-05-15 07:45:20.258 UTC [1] LOG:  starting PostgreSQL 13.3 (Debian 13.3-1.pgdg100+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 8.3.0-6) 8.3.0, 64-bit\n2023-05-15 07:45:20.258 UTC [1] LOG:  listening on IPv4 address &quot;0.0.0.0&quot;, port 5432\n2023-05-15 07:45:20.259 UTC [1] LOG:  listening on IPv6 address &quot;::&quot;, port 5432\n2023-05-15 07:45:20.264 UTC [1] LOG:  listening on Unix socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot;\n2023-05-15 07:45:20.272 UTC [66] LOG:  database system was shut down at 2023-05-15 07:45:20 UTC\n2023-05-15 07:45:20.285 UTC [1] LOG:  database system is ready to accept connections\n^C2023-05-15 08:00:13.887 UTC [1] LOG:  received fast shutdown request\n2023-05-15 08:00:13.890 UTC [1] LOG:  aborting any active transactions\n2023-05-15 08:00:13.894 UTC [1] LOG:  background worker &quot;logical replication launcher&quot; (PID 72) exited with exit code 1\n2023-05-15 08:00:13.894 UTC [67] LOG:  shutting down\n2023-05-15 08:00:13.919 UTC [1] LOG:  database system is shut down\n</code></pre>\n<p>When I look inside: <code>../build/reports/tests/test/index.html</code>:</p>\n<pre><code>Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'r2dbcScriptDatabaseInitializer' defined in class path resource [org/springframework/boot/autoconfigure/sql/init/R2dbcInitializationConfiguration.class]: Failed to execute database script\n    at app//org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1770)\n    at app//org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:598)\n    at app//org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:520)\n</code></pre>\n<p>Would appreciate it if someone else could try to replicate this issue...</p>\n<p>Remember, this doesn't work when I created a project via <a href=\"http://start.spring.io\" rel=\"nofollow noreferrer\">http://start.spring.io</a> using the same dependencies (see screenshot above) that the presenters in the YouTube presentation video used nor did the author's <a href=\"https://github.com/jamesward/nks/tree/main/bootiful\" rel=\"nofollow noreferrer\">code</a> work when I did a fresh <code>git clone</code>...</p>\n"},{"tags":["java","groovy","abstract-class"],"comments":[{"owner":{"user_id":395202,"display_name":"Adrian Shum"},"edited":false,"comment_id":134424078,"body":"I kinda remember cglib and javassist may be able to achieve similar thing, but I want to see if it is the correct direction to go before I dig into them"}],"answers":[{"owner":{"user_id":1682820,"display_name":"injecteer"},"up_vote_count":4,"is_accepted":true,"creation_date":1683803670,"answer_id":76227011,"body":"<p>In Groovy the following magic is called <em>&quot;Map to Interface coercion&quot;</em> and is available out of the box:</p>\n<pre><code>import static java.lang.annotation.ElementType.METHOD\nimport static java.lang.annotation.RetentionPolicy.RUNTIME\nimport java.lang.annotation.Retention\nimport java.lang.annotation.Target\n\n@Retention( RUNTIME )\n@Target( [ METHOD ] )\n@interface Some {\n  String value() default ''\n}\n\ninterface Foo {\n  @Some( 'AWESOME' )\n  void foo()\n}\n\nFoo magicFoo = [ foo:{-&gt;\n  String annotationValue = Foo.methods.first().annotations.first().value()\n  println &quot;the $annotationValue MAGIC printed!&quot;\n} ] as Foo\n\nassert Foo.isAssignableFrom( magicFoo.getClass() )\n\nmagicFoo.foo()\n</code></pre>\n<p>prints in the console:</p>\n<pre class=\"lang-none prettyprint-override\"><code>the AWESOME MAGIC printed!\n</code></pre>\n"}],"owner":{"user_id":395202,"display_name":"Adrian Shum"},"view_count":41,"up_vote_count":2,"accepted_answer_id":76227011,"answer_count":1,"score":2,"creation_date":1683803245,"question_id":76226949,"body":"<p>In Groovy or Java, assume I have an interface (or abstract class) with some unimplemented methods.  I would like to generate an instance of this interface/abstract class <em>dynamically in runtime</em>, and have some behaviour for those unimplemented methods (e.g. based on annotation on those methods)</p>\n<p>i.e. something like</p>\n<pre class=\"lang-java prettyprint-override\"><code>interface Foo {\n    @SomeAnnotation(...)\n    foo();\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>Foo foo = someMagic(Foo.class, somethingToProvideLogicOfUnimplementedMethods);\n</code></pre>\n<p>Are there any library or technique that can achieve this?</p>\n"},{"tags":["java","spring-boot","jackson","date-format"],"comments":[{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":134421878,"body":"Your mwl-calendar is intolerant. It should just assume the fraction of second is zero when it is not in the string. The format is <a href=\"https://en.wikipedia.org/wiki/ISO_8601\" rel=\"nofollow noreferrer\">ISO 8601</a> standard. According to the standard, the fraction of second is optional."},{"owner":{"user_id":3359605,"display_name":"Virkom"},"edited":false,"comment_id":134422086,"body":"@OleV.V., maybe. It uses date-fns library and it says &quot;Incorrect date&quot; if I use <code>yyyy-MM-ddTHH:mm:ssZ</code>. I didn&#39;t go deeper in this problem and tried to fix it on backend side."}],"answers":[{"owner":{"user_id":16810646,"display_name":"Ananta"},"up_vote_count":3,"is_accepted":false,"creation_date":1683793199,"answer_id":76225515,"body":"<p>You can create custom json serializer for Instant type:</p>\n<pre><code>    public static class InstantSerializer extends StdSerializer&lt;Instant&gt; {\n\n        public InstantSerializer() {\n            super(Instant.class);\n        }\n\n        @Override\n        public void serialize(\n            @Nullable final Instant value,\n            @NonNull final JsonGenerator jsonGenerator,\n            @NonNull final SerializerProvider serializerProvider\n        ) throws IOException {\n            if (value != null) {\n                final DateTimeFormatter formatter = DateTimeFormatter\n                    .ofPattern(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;)\n                    .withZone(ZoneId.systemDefault());\n                final String text = formatter.format(value);\n                jsonGenerator.writeString(text);\n            }\n        }\n\n    }\n</code></pre>\n<p>Then use it on the field that you want to follow the format:</p>\n<pre><code>    @Data\n    public class SlotResponse {\n\n        @JsonSerialize(using = InstantSerializer.class) // Add this\n        \n        private Instant start;\n        @JsonSerialize(using = InstantSerializer.class) // Add this\n        private Instant end;\n    }\n</code></pre>\n<p>In case you want to make this apply for your whole system, you can add the serializer to jackson:</p>\n<pre><code>    @Bean\n    public ObjectMapper objectMapper() {\n        ObjectMapper mapper = new ObjectMapper();\n        ...\n        final SimpleModule module = new SimpleModule();\n        module.addSerializer(new InstantSerializer());\n        mapper.registerModule(module);\n        ...\n        return mapper;\n    }\n\n</code></pre>\n"},{"owner":{"user_id":592355,"display_name":"xerx593"},"up_vote_count":1,"is_accepted":false,"creation_date":1683796724,"answer_id":76226027,"body":"<h3>Sorry, cannot reproduce</h3>\n<p>With (<em>only</em>)</p>\n<ul>\n<li>spring-boot-starter-web:2.7.0</li>\n<li>lombok</li>\n<li>(dev tools, spring-boot-starter-test)</li>\n</ul>\n<p>, (shortened) &quot;dto&quot;:</p>\n<pre><code>package com.example.soq76225352;\n\nimport java.time.Instant;\nimport lombok.Data;\n\n@Data\npublic class SomeResponse {\n  private Instant start = Instant.now();\n}\n</code></pre>\n<p>and:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RestController\nclass DemoController {\n\n  @GetMapping(value = &quot;/slots&quot;)\n  public SomeResponse timeSlots() {\n    return new SomeResponse();\n  }\n}\n</code></pre>\n<p>(no other settings, properties, only defaults..)\n, we get:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{&quot;start&quot;:&quot;2023-05-11T09:08:23.569050400Z&quot;}\n</code></pre>\n<p>which looks <em>very</em> like the desired format. (??)</p>\n<hr />\n<p>As soon I add:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@JsonFormat(pattern = &quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;)\n</code></pre>\n<p>, I get:</p>\n<pre class=\"lang-text prettyprint-override\"><code>2023-05-11 11:03:49.487  WARN 3732 --- [nio-8080-exec-3] .w.s.m.s.DefaultHandlerExceptionResolver :\n   Resolved [org.springframework.http.converter.HttpMessageNotWritableException:\n     Could not write JSON: Unsupported field: YearOfEra; nested exception is com.fasterxml.jackson.databind.JsonMappingException:\n       Unsupported field: YearOfEra (through reference chain: \n         com.example.soq76225352.SomeResponse[&quot;start&quot;])\n   ]\n</code></pre>\n<p>(-&gt; <code>/error</code> -&gt; <code>404</code>) !?</p>\n<hr />\n<h3>Going deeper</h3>\n<ul>\n<li>The format <code>'Z'</code> refers to a &quot;literal Z&quot;</li>\n<li>Whereas <code>Z</code> refers to the &quot;zone offset&quot; (in form <code>+HHMM</code>, see <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/format/DateTimeFormatterBuilder.html\" rel=\"nofollow noreferrer\">DateTimeFormatterBuilder</a> + source documentation)</li>\n<li>On the other hand: <code>X</code> is the &quot;zone offset&quot; (as described by <code>Z</code>) or (literal) <code>'Z'</code> in case of &quot;zero offset&quot;/UTC! <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/format/DateTimeFormatter.html\" rel=\"nofollow noreferrer\"><code>DateTimeFormatter</code></a> :)</li>\n</ul>\n<h3>To make it work:</h3>\n<ul>\n<li><p>in all cases (that's strange for the literal case!), we have to:</p>\n<ul>\n<li>or <code>@JsonFormat(timezone = &quot;...&quot; //,...</code></li>\n<li>or <code>spring.jackson.time-zone</code></li>\n</ul>\n<p>... (explicitly) set the &quot;config time zone&quot;, see <a href=\"https://stackoverflow.com/q/7556851/592355\">Set Jackson Timezone for Date deserialization</a></p>\n<ul>\n<li>additionally we need to ensure (it is by default):    <code>spring.jackson.serialization.WRITE_DATES_WITH_CONTEXT_TIME_ZONE=true</code>\n, see <a href=\"https://github.com/FasterXML/jackson-modules-java8/blob/jackson-modules-java8-2.13.5/datetime/src/main/java/com/fasterxml/jackson/datatype/jsr310/ser/InstantSerializerBase.java#L142-L148\" rel=\"nofollow noreferrer\">source code(your version)</a></li>\n</ul>\n</li>\n</ul>\n<h4>Given (e.g.)</h4>\n<pre class=\"lang-properties prettyprint-override\"><code>spring.jackson.time-zone=UTC\n</code></pre>\n<h4>When/Then</h4>\n<ul>\n<li>When format is <code>'Z'</code>, then we get <code>&quot;...Z&quot;</code></li>\n<li>When format is <code>Z</code>, then we get <code>&quot;...+0000&quot;</code></li>\n<li>When format is <code>X</code>, then we get (also) <code>&quot;...Z&quot;</code></li>\n</ul>\n<hr />\n<p>Relevant, but old:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/43622259/592355\">How to Use Spring Boot&#39;s &#39;spring.jackson.date-format&#39; Property?</a></li>\n<li><a href=\"https://stackoverflow.com/q/45662820/592355\">How to set format of string for java.time.Instant using objectMapper?</a></li>\n</ul>\n<p>Relevant, but not deep/exact (milliseconds) enough:</p>\n<ul>\n<li><a href=\"https://www.baeldung.com/spring-boot-formatting-json-dates\" rel=\"nofollow noreferrer\">https://www.baeldung.com/spring-boot-formatting-json-dates</a></li>\n</ul>\n"}],"owner":{"user_id":3359605,"display_name":"Virkom"},"view_count":107,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1683792112,"question_id":76225352,"body":"<p>I have a problem with Jackson in SpringBoot. My controller returns dates in format <code>yyyy-MM-dd'T'HH:mm:ss'Z'</code>, but I need <code>yyyy-MM-dd'T'HH:mm:ss.SSS'Z'</code> (for mwl-calendar in angular which uses date-fns library).</p>\n<p>Controller:</p>\n<pre><code>@GetMapping(value = &quot;/slots&quot;, produces = MediaType.APPLICATION_JSON_VALUE)\npublic Set&lt;SlotResponse&gt; timeSlots() {\n    return slotService.getSlots();\n}\n</code></pre>\n<p>SlotResponse:</p>\n<pre><code>@Data\npublic class SlotResponse {\n    private Instant start;\n    private Instant end;\n}\n</code></pre>\n<p>Additional dependency:</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;\n    &lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>I tried:</p>\n<ol>\n<li>to use <code>@JsonFormat(pattern=&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;)</code> annotation</li>\n<li>to use <code>spring.jackson.date-format=yyyyMMddTHH:mm:ss.SSSZ</code> configuration</li>\n<li>to create ObjectMapper manually:</li>\n</ol>\n<pre><code>@Bean\npublic ObjectMapper objectMapper() {\n    ObjectMapper mapper = new ObjectMapper();\n    mapper.registerModule(new JavaTimeModule());\n    mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);\n    mapper.setDateFormat(new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'&quot;));\n    return mapper;\n}\n</code></pre>\n<ol start=\"4\">\n<li>to enable options <code>SerializationFeature.WRITE_DATES_WITH_ZONE_ID</code> and <code>SerializationFeature.WRITE_DATES_WITH_CONTEXT_TIME_ZONE</code></li>\n</ol>\n<p>But all of this didn't take effect. Everytime I see this result:</p>\n<pre><code>[{&quot;start&quot;:&quot;2023-05-11T16:00:00Z&quot;,&quot;end&quot;:&quot;2023-05-11T17:00:00Z&quot;}]\n</code></pre>\n<p>I use Java 17, SpringBoot 2.7.0, Jackson 2.13.3</p>\n<p>What is wrong?</p>\n"},{"tags":["java","date","datetime","deprecated","java.util.date"],"comments":[{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"edited":false,"comment_id":134359308,"body":"You should be using Local or Zoned Date classes, not <code>java.util.Date</code> / Calendar"},{"owner":{"user_id":16320675,"display_name":"user16320675"},"edited":false,"comment_id":134359402,"body":"BTW <code>java.util.Date</code> was almost  completely replaced by <code>Calendar</code> as of Java 1.1 (one-point-one, not to be confused with Java 11); and these were all outdated by classes in the <code>java.time</code> package with Java 8 (year 2014)"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":134360486,"body":"As @OneCricketeer said, don’t use <code>Date</code>. Use <a href=\"https://docs.oracle.com/javase/tutorial/datetime/index.html\" rel=\"nofollow noreferrer\">java.time, the modern Java date and time API</a>. So you need not know the answer to your question. In any case they referred both to lacking support for locales (for example languages, date formats and definitions of week numbers), time zones and probably more."}],"answers":[{"owner":{"user_id":21473475,"display_name":"Arfur Narf"},"up_vote_count":0,"is_accepted":false,"creation_date":1683376776,"answer_id":76188941,"body":"<p>If you look at the suggested replacements, you'll see there are two - Calendar and GregorianCalendar.</p>\n<p>The programmer needs to make a choice, depending on the intention of the code. The old API would have been one or the other.  That is, it &quot;did not support internationalization&quot;.</p>\n"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":4,"is_accepted":true,"creation_date":1683402402,"answer_id":76190806,"body":"<h1>tl;dr</h1>\n<p>Use only <em>java.time</em> classes. Never use <code>Date</code>/<code>Calendar</code> etc.</p>\n<pre class=\"lang-java prettyprint-override\"><code>ZonedDateTime.now(\n                ZoneId.of( &quot;Asia/Tokyo&quot; )\n        )\n        .format(\n                DateTimeFormatter\n                        .ofLocalizedDateTime( FormatStyle.FULL )\n                        .withLocale( Locale.GERMANY )\n        )\n</code></pre>\n<blockquote>\n<p>Sonntag, 7. Mai 2023, 04:53:02 Japanische Normalzeit</p>\n</blockquote>\n<h1>Avoid legacy date-time classes</h1>\n<p>You asked:</p>\n<blockquote>\n<p>Is this the reason why the methods of the Date class were deprecated?</p>\n</blockquote>\n<p>The legacy date-time classes are rife with poor design decisions, written by people who did not understand date-time handling. The lack of internationalization is but one of <em>many</em> problems.</p>\n<p>Trying to understand these legacy classes is a waste of time, unless you want lessons on how to <em>not</em> do proper object-oriented programming. These classes were years ago supplanted by the modern <em>java.time</em> classes defined in <a href=\"https://jcp.org/en/jsr/detail?id=310\" rel=\"nofollow noreferrer\">JSR 310</a>.</p>\n<p>Use neither of the two <code>Date</code> classes, nor <code>Calendar</code>, <code>SimpleDateFormat</code>, <code>GregorianCalendar</code>, etc. 👉 Use only the date-time classes from the <em>java.time</em> package. Focus your precious learning time on <em>java.time</em>.</p>\n<h1><em>java.time</em></h1>\n<p>The <em>java.time</em> classes provide <a href=\"https://en.wikipedia.org/wiki/Internationalization_and_localization\" rel=\"nofollow noreferrer\">internationalization</a> through the 👉 <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/format/DateTimeFormatter.html\" rel=\"nofollow noreferrer\"><code>DateTimeFormatter</code></a> class.</p>\n<p>In modern Java, the localization information comes from the <a href=\"https://en.wikipedia.org/wiki/Common_Locale_Data_Repository\" rel=\"nofollow noreferrer\"><em>Common Locale Data Repository Project (CLDR)</em></a> published by the <a href=\"https://en.wikipedia.org/wiki/Unicode_Consortium\" rel=\"nofollow noreferrer\">Unicode Consortium</a>.</p>\n<p>Here is some example code.</p>\n<p>Capture the current moment as seen in the <a href=\"https://en.wikipedia.org/wiki/Japan_Standard_Time\" rel=\"nofollow noreferrer\">wall-clock time/calendar used by the people of Japan</a>. For this purpose, use <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/ZonedDateTime.html\" rel=\"nofollow noreferrer\"><code>ZonedDateTime</code></a> class. Specify the time zone of interest by using the <a href=\"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/ZoneId.html\" rel=\"nofollow noreferrer\"><code>ZoneId</code></a> class.</p>\n<pre class=\"lang-java prettyprint-override\"><code>ZoneId zoneIdTokyo = ZoneId.of( &quot;Asia/Tokyo&quot; );\nZonedDateTime zdtTokyo = ZonedDateTime.now( zoneIdTokyo );\n</code></pre>\n<p>Generate text representing that moment using <a href=\"https://en.wikipedia.org/wiki/French_Canadians\" rel=\"nofollow noreferrer\">French Canadian</a> localization (human language &amp; cultural norms).</p>\n<pre class=\"lang-java prettyprint-override\"><code>Locale locale = Locale.CANADA_FRENCH;\nDateTimeFormatter formatter =\n        DateTimeFormatter\n                .ofLocalizedDateTime( FormatStyle.FULL )\n                .withLocale( locale );\nString output = zdtTokyo.format( formatter );\n</code></pre>\n<p>Dump to console.</p>\n<pre class=\"lang-java prettyprint-override\"><code>System.out.println( &quot;zdtTokyo.toString() = &quot; + zdtTokyo );\nSystem.out.println( &quot;output = &quot; + output );\n</code></pre>\n<p>When run:</p>\n<pre class=\"lang-none prettyprint-override\"><code>zdtTokyo.toString() = 2023-05-07T04:47:54.551174+09:00[Asia/Tokyo]\noutput = dimanche 7 mai 2023, 04 h 47 min 54 s heure normale du Japon\n</code></pre>\n"}],"owner":{"user_id":12770029,"display_name":"Leveling_up"},"view_count":93,"up_vote_count":2,"accepted_answer_id":76190806,"answer_count":2,"score":2,"creation_date":1683375054,"question_id":76188805,"body":"<p>I was going through the different ways that we can get <strong>Date and Time</strong> in java, while reading the documentation could not understand what the below quote mean.</p>\n<blockquote>\n<p>Unfortunately, the API for these functions was not amenable to internationalization.</p>\n</blockquote>\n<p>The above quote is from documentation of Date class of java.\nWhat does that mean ??\nIs this the reason why the methods of the Date class were deprecated?</p>\n"},{"tags":["java","overloading","compile-time"],"answers":[{"owner":{"user_id":21473475,"display_name":"Arfur Narf"},"up_vote_count":2,"is_accepted":true,"creation_date":1683077863,"answer_id":76159908,"body":"<p>The actual call is</p>\n<pre><code> method1(Test3, String)\n</code></pre>\n<p>The applicable methods, on a Test2 object reference, are</p>\n<pre><code> method1(Test1, String)   // A\n method1(Test2, Object)   // B\n</code></pre>\n<p>For the first argument, type Test2, B is preferred - Test2 is more specific than Test1.</p>\n<p>For the second argument, type String, A is preferred - String is more specific than Object.</p>\n<p>Thus neither A or B is unambiguously selected. Resolution requires a target method that is the most specific for every actual argument.</p>\n<p><a href=\"https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.12.2.5\" rel=\"nofollow noreferrer\">Java Language Supplement</a></p>\n"},{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":2,"is_accepted":false,"creation_date":1683077872,"answer_id":76159910,"body":"<p>You can refer to <a href=\"https://docs.oracle.com/javase/specs/jls/se17/html/jls-15.html#jls-15.12.2.5\" rel=\"nofollow noreferrer\">section 15.12.2.5</a> for how all of this works.</p>\n<p>In this scenario, since the methods are not generic, there are no functional interfaces involved, you can ignore a lot of the sentences. For simple cases like this, the condition for one method <code>m1</code> to be more specific than another method <code>m2</code> just boils down to:</p>\n<p>(second bullet point of that section)</p>\n<blockquote>\n<p><code>m2</code> is not generic, and <code>m1</code> and <code>m2</code> are applicable by strict or loose invocation, and where <code>m1</code> has formal parameter types <code>S1</code>, ..., <code>Sn</code> and <code>m2</code> has formal parameter types <code>T1</code>, ..., <code>Tn</code>, the type <code>Si</code> is more specific than <code>Ti</code> for argument <code>ei</code> for all i (1 ≤ i ≤ n, n = k).</p>\n</blockquote>\n<p>That is to say, the types of <em>every</em> parameter in <code>m1</code> has to be more specific than the corresponding parameter type in <code>m2</code>.</p>\n<p>For a type to be more specific than another type, Java only looks at whether there <em>is</em> a subtype relationship. &quot;How far away&quot; it is does not matter.</p>\n<blockquote>\n<p>A type S is more specific than a type T for any expression if S &lt;: T</p>\n</blockquote>\n<p>Now you should see that <code>method1(Test1, String)</code> is not more specific than <code>method1(Test2, Object)</code>, because <code>Test1</code> is not more specific than <code>Test2</code>.</p>\n<p><code>method1(Test2, Object)</code> is not more specific than <code>method1(Test1, String)</code> either, because <code>Object</code> is not more specific than <code>String</code>.</p>\n<p>Then the spec goes on to say:</p>\n<blockquote>\n<p>A method is said to be maximally specific for a method invocation if it is accessible and applicable and there is no other method that is accessible and applicable that is strictly more specific.</p>\n<p>If there is exactly one maximally specific method, then that method is in fact the most specific method; it is necessarily more specific than any other accessible method that is applicable.</p>\n</blockquote>\n<p>Both overloads are maximally specific in this case. Some maximally specific methods are preferred if they meet some criteria (specified further down), but for simple cases like this, they don't apply.</p>\n<p>Therefore, the compiler can't choose between the two overloads, and the call is ambiguous.</p>\n"}],"owner":{"user_id":13514588,"display_name":"Kryptic Coconut"},"view_count":53,"up_vote_count":2,"accepted_answer_id":76159908,"answer_count":2,"score":2,"creation_date":1683073730,"question_id":76159719,"body":"<p>Consider the following code:</p>\n<pre><code>class Driver {\n    public static void main(String[] args) {\n        Test1 t1 = new Test1();\n        Test2 t2 = new Test2();\n        Test3 t3 = new Test3();\n        \n        Object o = &quot;&quot;;\n        String s = &quot;&quot;;\n        \n        t2.method1(t2, o); // calls method1 on Test1\n        t2.method1(t3, s); // compile error: reference to method1 is ambiguous\n    }\n}\n\nclass Test1 {\n    public void method1(Test2 v1, Object o) {\n        System.out.println(&quot;Test1 called&quot;);\n    }\n}\n\nclass Test2 extends Test1 {\n    public void method1(Test1 v1, String o) {\n        System.out.println(&quot;Test2 called&quot;);\n    }\n}\n\nclass Test3 extends Test2 {\n}\n</code></pre>\n<p>I essentially have a <code>Test1</code> class which has subclass <code>Test2</code> which has subclass <code>Test3</code>.<br />\nI just learned that to deal with overloaded methods which have arguments that are related to each other through some is-a relationship, java picks the <em>most specific</em> method.<br />\nI wanted to test how this worked when there are multiple parameters.</p>\n<p>The first call resolves to <code>Test1</code>'s implementation, which makes sense: Object is not a String, so <code>method1(Test1 v1, String o)</code> in <code>Test2</code> isn't a match.</p>\n<p>But for the second call, shouldn't the <code>t2.method1(t3, s)</code> just resolve to <code>method1(Test2 v1, Object o)</code>, as that is the most &quot;specific&quot;: <code>Test3</code> is 1 class away from <code>Test2</code> and <code>String</code> is 1 class away from <code>Object</code>?</p>\n<p>Instead the the compiler returns <code>reference to method1 is ambiguous</code>.</p>\n<p>How does Java deal with such cases?</p>\n"},{"tags":["java","hashmap","key","hashset","hashcode"],"comments":[{"owner":{"user_id":133203,"display_name":"Federico klez Culloca"},"edited":false,"comment_id":134301823,"body":"Why wonder when you have <a href=\"https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashSet.java\" rel=\"nofollow noreferrer\">the source code for <code>HashSet</code></a> available? :)"},{"owner":{"user_id":3788176,"display_name":"Andy Turner"},"edited":false,"comment_id":134301867,"body":"Have a look what happens when you have two keys with the same hash, e.g. <a href=\"https://stackoverflow.com/a/10102397/3788176\"><code>FB</code> and <code>Ea</code></a>."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134301883,"body":"I&#39;d say the book is wrong, or it is oversimplifying things (given you can have multiple objects with the exact same hash in a HashSet). It is probably talking about the fact the hash is used to index into the hash table, where you can then find the objects. BTW: It is more relevant to look at the source of <a href=\"https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashMap.java\" rel=\"nofollow noreferrer\"><code>HashMap</code></a> than of <code>HashSet</code>."}],"answers":[{"owner":{"user_id":768644,"display_name":"rzwitserloot"},"up_vote_count":3,"is_accepted":true,"creation_date":1683034529,"answer_id":76155431,"body":"<p>Of course it is the object and not the hash. Some facts which are individually obvious or at least easy to verify:</p>\n<ul>\n<li>Given that hashes are fixed size (2^32 different hashes exist, that's it though), and there are objects such as Strings for which more than 2^32 different values exist (An infinite amount of them), it is <strong>a mathematical certainty that different strings exist that hash to the same value</strong>. This is called the pigeon hole principle if you prefer to watch some videos or some such to explain this concept in more detail.</li>\n<li>It would be incredibly annoying if HashMap/HashSet considers <em>different strings</em> as nevertheless equal <em>just</em> because their hash codes so happen to collide. In fact, that would mean these types aren't conforming to their own specification (javadoc), because they clearly state collisions will slow things down but aren't otherwise a problem.</li>\n<li>Hence, HashSet/Map needs the original object so that it can use <code>.equals()</code> to verify that things are <em>actually equal</em>.</li>\n</ul>\n<p>The way hashmap/set works is as follows:</p>\n<ul>\n<li>Use the hashCode of an object to find the 'bucket' to look in.</li>\n<li>Then just scan, one at a time, each object in that bucket. Yes, this is slow - hence you don't <em>want</em> a ton of hash collisions.</li>\n</ul>\n<p>And thus this concludes:</p>\n<ul>\n<li>Given two objects <code>a</code> and <code>b</code>, <strong>if</strong> <code>a.equals(b)</code> is true, then <code>a.hashCode() == b.hashCode()</code> HAS to be true, or you can't use these objects in hashset/hashmap because bizarre things will happen if you do, with keys/objects you just added disappearing into thin air  but still showing up when iterating through, and so on.</li>\n<li>The reverse <strong>DOES NOT HOLD</strong> - If <code>a.hashCode() == b.hashCode()</code> is true, then <code>a.equals(b)</code> doesn't have to be. It could just be a collision which is fine.</li>\n<li>That means theoretically <code>@Override public int hashCode() { return 1; }</code> is valid. Indeed it is; HashMap and HashSet will operate as described, as long as the <code>equals</code> method is working fine. However, such maps/sets will be <code>O(n)</code> - their performance is linear to how many items are in there. Which is unexpected; the point of hashset/map is that their performance doesn't meaningfully change as they grow. HashMap/Set aren't magic - they need a good <code>hashCode()</code> impl to fulfill their performance promises.</li>\n</ul>\n<p>If you read some docs or books that say the hashcode is the key, then that's either from a section that is oversimplifying (accent on the <em>over</em> - that's probably not a good thing to put in a tutorial or explanation), or the author misunderstands how this stuff works, or its a description for hashmap impl in another system/language which takes the highly dubious shortcut of equating 'equal hashes' to '.. thus equal'. Given Pigeonhole Principle and all that, this is a bad idea. If you MUST do things that way, use a good hash algo and way more bits than 32!</p>\n"},{"owner":{"user_id":7237884,"display_name":"Panagiotis Bougioukos"},"up_vote_count":1,"is_accepted":false,"creation_date":1683035290,"answer_id":76155518,"body":"<p>In simple terms what actually happens is the following:</p>\n<p>A <code>HashSet</code> is backed by a <code>HashMap</code> meaning behind the scenes the <code>HashSet</code> uses a <code>HashMap</code> data structure.</p>\n<p>Whatever value you add to the <code>HashSet</code> is added as a <code>key</code> to the <code>HashMap</code> which exists behind the scenes. Since <code>HashMap</code> does not allow duplicate keys, during several insertions of the same key, only the latest key is the one that survives. Therefore it fulfils the need that a <code>HashSet</code> contains only unique values.</p>\n<p>For all above insertions in a <code>HashSet</code>, the value that you insert in <code>HashSet</code> is inserted as a key in the <code>HashMap</code>. At the same time as a value to the <code>HashMap</code> undisclosed to you is inserted always the same value for the specific <code>HashMap</code> instance from the line <code>static final Object PRESENT = new Object()</code> -&gt; <a href=\"https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashSet.java#L100\" rel=\"nofollow noreferrer\">reference.</a> . Therefore all values which are inserted behind the scenes to a <code>HashMap</code> backing up a specific <code>HashSet</code> are always a specific reference created from <code>new Object()</code>. For another <code>HashSet</code> there would be a different value, but for the same <code>HashSet</code> it always use the same reference.</p>\n<p>Having said the above, to answer the title of the question</p>\n<blockquote>\n<p>What is the key in the Set's underlying HashMap: hash code or the\nobject itself?</p>\n</blockquote>\n<p>The key in underlying <code>HashMap</code> would be the reference to the actual object which was inserted as a value to the <code>HashSet</code>. Now how the <code>HashMap</code> stores this reference in the <code>HashMap</code> data structure is that it calculates the <code>hashcode</code> of that object to identify the bucket of HashTable... (read more about <code>hashmap</code> to track it further how hashMap stores elements)</p>\n"}],"owner":{"user_id":11521880,"display_name":"bridgemnc"},"view_count":52,"up_vote_count":2,"accepted_answer_id":76155431,"answer_count":2,"score":2,"creation_date":1683032685,"question_id":76155171,"body":"<p>Is this sentence from an OCP book correct?</p>\n<blockquote>\n<p>A HashSet stores its elements in a hash table, which means the <strong>keys\nare a hash</strong> and the values are an Object.</p>\n</blockquote>\n<p>I have created below code snippet:</p>\n<pre><code>class A\n{\n    private String s;\n    public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException  {\n        HashSet&lt;A&gt; elems =  new HashSet&lt;&gt;(Set.of(new A(&quot;abc&quot;), new A(&quot;cba&quot;), new A(&quot;a&quot;)));\n        Field field = elems.getClass().getDeclaredField(&quot;map&quot;);\n        field.setAccessible(true);\n        HashMap privateMap = (HashMap) field.get(elems);\n    }\n\n    public A(String s)\n    {\n        this.s = s;\n    }\n}\n</code></pre>\n<p>And as a result I retrieved the following HashMap:<br />\n<a href=\"https://i.stack.imgur.com/fAVDo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fAVDo.png\" alt=\"enter image description here\" /></a></p>\n<p>It looks like it's the object itself being a key in the HashMap instead of its hash being the key. Is there an error in the book or am I looking at something irrelevant?</p>\n"},{"tags":["java","polymorphism","abstract-class","abstract-methods"],"comments":[{"owner":{"user_id":898478,"display_name":"m0skit0"},"edited":false,"comment_id":134191485,"body":"When the class is loaded by the JVM, its code becomes available. Code is not per-instance, so it&#39;s already there before the class instance has been reserved in memory. If it helps you understand it, you can think of the code as &quot;static&quot;: there&#39;s only one chunk code for all the instances of a class. It does not duplicate the code for each class instance."},{"owner":{"user_id":207421,"display_name":"user207421"},"edited":false,"comment_id":134192530,"body":"Because Java doesn&#39;t work like C++, which does behave the way you expect."}],"answers":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":4,"is_accepted":true,"creation_date":1682325800,"answer_id":76090102,"body":"<p>There is nothing special about abstract methods here. You can also just call non-abstract methods in the same way:</p>\n<pre><code>class Platypus {\n    {\n        System.out.println(chew());\n    }\n    \n    public Platypus() {\n        System.out.println(&quot;Platypus constructor&quot;);\n    }\n\n    String chew() {\n        return &quot;yummy!&quot;;\n    }\n}\n</code></pre>\n<blockquote>\n<p>I thought an instance of a class gets created when the constructor is called.</p>\n</blockquote>\n<p>No, the constructor is not responsible for <em>creating</em> the object. An object is created first, and then its constructor is called to <em>initialise</em> the object.</p>\n<p>This can be seen in the bytecode too. The bytecode for <code>new Platypus()</code> looks something like this:</p>\n<pre><code>NEW yourpackage/Platypus\nDUP\nINVOKESPECIAL yourpackage/Platypus.&lt;init&gt; ()V\n</code></pre>\n<p>The <a href=\"https://docs.oracle.com/javase/specs/jvms/se17/html/jvms-6.html#jvms-6.5.new\" rel=\"nofollow noreferrer\"><code>new</code></a> instruction creates the object, and then <code>&lt;init&gt;</code>, which is the JVM name for constructors, is invoked.</p>\n<p>So here, we can say that <code>chew()</code> is called before the object is <em>fully initialised</em>. The object already exists, so calling <code>chew</code> is technically possible.</p>\n<p>However, calling instance methods when the object is not fully initialised is usually not a good idea. The method might <em>depend</em> on the fact that the object is fully initialised (e.g. accessing fields that are expected to not be null). See also: <a href=\"https://stackoverflow.com/q/5230565/5133585\">Can I call methods in constructor in Java?</a></p>\n"}],"owner":{"user_id":5634777,"display_name":"kaka"},"view_count":35,"up_vote_count":3,"accepted_answer_id":76090102,"answer_count":1,"score":2,"creation_date":1682325068,"question_id":76090008,"body":"<p>We can initialize an abstract class through initialization of a concrete sub class. Therefore, should be able to call the abstract methods of an abstract class only after the initialization of a subclass However, the following initialization block in abstract class Mammal can call an abstract method before the initialization of the sub child class.</p>\n<p>If you call the constructor of Platypus with new Platypus(), it outputs:\n&quot;yummy!&quot;,\n&quot;Mammal constructor&quot;,\n&quot;Platypus constructor&quot; in the same order. I thought an instance of a class gets created when the constructor is called. But the initialization block in Mammal is able to call the method before Platypus initialization.</p>\n<pre><code>abstract class Mammal {\n\n    {\n        System.out.println(chew()); \n    }\n\n    abstract CharSequence chew();\n\n    public Mammal() {\n       System.out.println(&quot;Mammal constructor&quot;); \n    }\n}\n\npublic class Platypus extends Mammal {\n\n    public Platypus() {\n        System.out.println(&quot;Platypus constructor&quot;);\n    }\n    \n    String chew() {\n        return &quot;yummy!&quot;;\n    }\n\n\n}\n</code></pre>\n"},{"tags":["java","algorithm","depth-first-search"],"comments":[{"owner":{"user_id":1898563,"display_name":"Michael"},"edited":false,"comment_id":134021096,"body":"&quot;<i>Problem is this code is not correct and is not giving the required correct result</i>&quot; Give us a sample input. Tell us the expected result and the actual result. That both allows us to reproduce exactly what you&#39;re doing, and avoids the possibility that it&#39;s not the code, but <i>your expectations</i> that are wrong."},{"owner":{"user_id":1590011,"display_name":"John Doe"},"edited":false,"comment_id":134021180,"body":"Agreed, and those things are now added in the question. Please see and let me know any other shortcomings, thanks."},{"owner":{"user_id":12299000,"display_name":"kaya3"},"edited":false,"comment_id":134021396,"body":"Please see <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, emphasis on <i>minimal</i>."},{"owner":{"user_id":5459839,"display_name":"trincot"},"edited":false,"comment_id":134021524,"body":"Note that the linked problem is behind a subscription wall."},{"owner":{"user_id":5483526,"display_name":"Matt Timmermans"},"edited":false,"comment_id":134021817,"body":"DFS is not appropriate for this problem.  You should use BFS to find the distance to each cell from a gate."},{"owner":{"user_id":1590011,"display_name":"John Doe"},"edited":false,"comment_id":134021982,"body":"@MattTimmermans that would be easier, yes I agree, but we can use DFS, I mean in principle, may not be super efficient, the count value would decrement when we backtrack in DFS and the cells should be having an appropriate value!!  Please correct me if I am wrong!!"},{"owner":{"user_id":5483526,"display_name":"Matt Timmermans"},"edited":false,"comment_id":134022014,"body":"Yes, you are wrong.  A &quot;distance&quot; is a shortest path length.  BFS follows shortest paths.  DFS does not."},{"owner":{"user_id":1590011,"display_name":"John Doe"},"edited":false,"comment_id":134022058,"body":"So the count values in the above algorithm will not be giving us the correct distance of the cell from the gate cell. Hmm... Is this the logical flaw in my solution?"}],"answers":[{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"up_vote_count":3,"is_accepted":true,"creation_date":1681676703,"answer_id":76030150,"body":"<p>Your mistake is you are marking the room as seen before figuring out whether you have found shortest path or not:</p>\n<pre><code>    private void visitRommsDFS(int[][] rooms, int row, int col, int count, boolean[][] roomsBool){\n        if(... roomsBool[row][col] == true ...) {\n            return;\n        }\n        if(rooms[row][col] &gt; 0){\n            rooms[row][col] = Math.min(rooms[row][col], count);\n        }\n        roomsBool[row][col] = true;\n        // 1\n        visitRommsDFS(rooms, row-1, col, count + 1, roomsBool);\n        // 2\n        visitRommsDFS(rooms, row+1, col, count + 1, roomsBool);\n        // 3\n        visitRommsDFS(rooms, row, col+1, count + 1, roomsBool);\n        // 4\n        visitRommsDFS(rooms, row, col-1, count + 1, roomsBool);\n    }\n</code></pre>\n<p>i.e. call(1) is poisoning all reachable cells in <code>roomsBool</code> with <code>true</code> value, and, so, calls (2), (3) and (4) might have no effect.</p>\n<p>Quick fix is to revert <code>roomsBool</code> state back at the end of <code>visitRommsDFS</code> call:</p>\n<pre class=\"lang-java prettyprint-override\"><code>roomsBool[row][col] = true;\nvisitRommsDFS(rooms, row - 1, col, count + 1, roomsBool);\nvisitRommsDFS(rooms, row + 1, col, count + 1, roomsBool);\nvisitRommsDFS(rooms, row, col + 1, count + 1, roomsBool);\nvisitRommsDFS(rooms, row, col - 1, count + 1, roomsBool);\nroomsBool[row][col] = false;\n</code></pre>\n<hr />\n<p>Well... I'm actually not sure it is worth trying optimize that puzzle without relevant test data, by the way...</p>\n<p>your current algorithm is: let find all rooms with gates and traverse all rooms reachable from particular gate, time complexity for such naive algorithm is obviously <em>worse than</em> <code>O(MxNxG)</code>, the best you can get here is to stop traversing rooms if room is closer to &quot;another&quot; gate rather than to the current one, something like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static final int[][] DIRS = new int[][]{new int[]{-1, 0}, new int[]{1, 0}, new int[]{0, -1}, new int[]{0, 1}};\n\npublic void wallsAndGates(int[][] rooms) {\n    for (int i = 0; i &lt; rooms.length; ++i) {\n        for (int j = 0; j &lt; rooms[i].length; ++j) {\n            if (rooms[i][j] == 0) {\n                visitRoomsDFS(rooms, i, j);\n            }\n        }\n    }\n}\n\nprivate void visitRoomsDFS(int[][] rooms, int row, int col) {\n    int distance = rooms[row][col] + 1;\n    for (int[] dir : DIRS) {\n        int r = row + dir[0];\n        int c = col + dir[1];\n        if (r &lt; 0 || c &lt; 0 || r &gt;= rooms.length || c &gt;= rooms[row].length) {\n            continue;\n        }\n        // optimization: &quot;have seen better&quot; or not a room\n        if (rooms[r][c] &lt;= distance) {\n            continue;\n        }\n        rooms[r][c] = distance;\n        visitRoomsDFS(rooms, r, c);\n    }\n\n}\n</code></pre>\n<p>However, I believe that even with such optimization the time complexity is still <em>not better than</em> <code>O(MxNxG)</code>, on the other hand the <em>theoretical</em> time complexity for this puzzle should not be better than <code>O(MxN)</code> - we need to traverse all rooms anyway, and the problem is the algorithm with <code>O(MxN)</code> time complexity does exist:</p>\n<p>the main idea is to traverse rooms in very specific order:</p>\n<ul>\n<li>at first we traverse gates</li>\n<li>at second we traverse gate's neighbours - such rooms either have distance <code>1</code> to some gate or are the walls or we have seen them before</li>\n<li>at third we traverse all neighbours of rooms having distance <code>1</code> to some gate - such rooms either have distance <code>2</code> to some gate or are the walls or we have seen them before.</li>\n<li>etc</li>\n</ul>\n<pre class=\"lang-java prettyprint-override\"><code>public static final int[][] DIRS = new int[][]{new int[]{-1, 0}, new int[]{1, 0}, new int[]{0, -1}, new int[]{0, 1}};\n\npublic void wallsAndGates(int[][] rooms) {\n    int rows = rooms.length;\n    int cols = rooms[0].length;\n    Deque&lt;int[]&gt; deque = new LinkedList&lt;&gt;();\n    for (int i = 0; i &lt; rows; ++i) {\n        for (int j = 0; j &lt; cols; ++j) {\n            if (rooms[i][j] == 0) {\n                deque.add(new int[]{i, j});\n            }\n        }\n    }\n    int[] room;\n    while ((room = deque.pollFirst()) != null) {\n        int distance = rooms[room[0]][room[1]] + 1;\n        for (int[] dir : DIRS) {\n            int r = room[0] + dir[0];\n            int c = room[1] + dir[1];\n            if (r &lt; 0 || c &lt; 0 || r &gt;= rows || c &gt;= cols) {\n                continue;\n            }\n            // ignoring walls and rooms\n            // seen previously\n            if (rooms[r][c] &gt; distance) {\n                rooms[r][c] = distance;\n                deque.addLast(new int[]{r, c});\n            }\n        }\n    }\n}\n</code></pre>\n"},{"owner":{"user_id":1590011,"display_name":"John Doe"},"up_vote_count":1,"is_accepted":false,"creation_date":1681818181,"answer_id":76044163,"body":"<p>The answer given by @Andrey B. Panfilov is correct, but the implementation provided, idea wise, is not very distinct from what I have done, apart from, of course, the mistake that I was doing of, not backtracking correctly, by not marking the auxiliary boolean array cell value as false again, at the end, it should be done precisely at the end of all traversals on all of the various sides.</p>\n<pre><code>roomsBool[row][col] = false;\n</code></pre>\n<p>This above step is crucial, to backtrack.</p>\n<p>Also, just one check that the rooms[row][col] is less than count :-</p>\n<pre><code>if(rooms[row][col] &lt; count) {\n  rooms[row][col] = count;\n}\n</code></pre>\n<p>won't guarantee that the smallest value is being stored in that cell, we must let recursion decide this, that which one is the shortest path, this will be done when we recurse to the cell from the various directions, and to enable recursion do that, that is allow it to come from the various sides to the cell under consideration, we must make</p>\n<pre><code>roomsBool[row][col] = false;\n</code></pre>\n<p>after traversing in all 4 directions.</p>\n<p>And the optimization suggested, can be easily incorporated in my solution as well.\nHere is the complete working solution.</p>\n<pre><code>  class Solution {\n    public void wallsAndGates(int[][] rooms) {\n\n        boolean[][] roomsBool = new boolean[rooms.length][rooms[0].length];\n\n        for(int i = 0; i &lt; rooms.length; ++i){\n            for(int j = 0; j &lt; rooms[i].length; ++j){\n                if(rooms[i][j] == 0){\n                    //if it is a gate we will do a DFS and fill the cells with the appropriate values.\n                    visitRommsDFS(rooms, i, j, 0, roomsBool);\n                }\n            }\n        }\n    }\n\n    private void visitRommsDFS(int[][] rooms, int row, int col, int count, boolean[][] roomsBool){\n        if(row &lt; 0 || row &gt;= rooms.length || col &lt; 0 || col &gt;= rooms[row].length || rooms[row][col] == -1 || rooms[row][col] == 0 &amp;&amp; count &gt; 0) return;\n\n        rooms[row][col] =  count;\n        roomsBool[row][col] = true;\n\n        if(row &gt; 0 &amp;&amp; rooms[row-1][col] &gt; count + 1)\n          visitRommsDFS(rooms, row-1, col, count + 1, roomsBool);\n\n        if(row + 1 &lt; rooms.length &amp;&amp; rooms[row+1][col] &gt; count + 1)  \n          visitRommsDFS(rooms, row+1, col, count + 1, roomsBool);\n\n        if(col + 1 &lt; rooms[row].length &amp;&amp; rooms[row][col + 1] &gt; count + 1)  \n          visitRommsDFS(rooms, row, col+1, count + 1, roomsBool);\n\n        if(col &gt; 0 &amp;&amp; rooms[row][col - 1] &gt; count + 1) \n          visitRommsDFS(rooms, row, col-1, count + 1, roomsBool);\n\n        roomsBool[row][col] = false;\n    }\n }\n</code></pre>\n<p>In my humble opinion the morale of the story is to recurse definitely, recurse obviously, recurse forever, but recurse selectively and recurse wisely.</p>\n<p><strong>Time Complexity Analysis</strong>\nSince the search space is a m X n grid, the complexity of the DFS, the second helper function is O(m X n), as we are covering all the cells of the grid and there are m X n of them. And the pruning when we are making a recursive call, ensures that no more repetitive traversal of a cell happens, while doing DFS.</p>\n<p>Had I done it in BFS way then also the time complexity would have remained the same that is O(m X n), here the choice of BFS and DFS would not matter on the time complexity, as the grid size is fixed before hand and we are traversing each cell, only once, unless the distance value is smaller.</p>\n<p><em>If the distance value in the next call is smaller than the current value in the cell, then obviously we are traversing a cell more than 1 time.</em></p>\n<p>Whether we are going from a centre to larger and larger concentric circle, or we are going too deep in one direction, will not affect the complexity, in this case.</p>\n<p><strong>Why?</strong></p>\n<p>Because the number of cells in the given grid is limited, and even if DFS goes in one direction, it is forced to comeback from that direction by grid edges and walls.\nAnd continue exploration in another direction, and eventually DFS covers all cells.\nAlso, with the logic to curtail unnecessary traversal we are being efficient in our traversal.\nAs does the BFS, style of traversal.\nSo time complexity of both the traversals is asymptotically the same with the above pruning of unwanted recursive calls.</p>\n"}],"owner":{"user_id":1590011,"display_name":"John Doe"},"view_count":225,"up_vote_count":3,"accepted_answer_id":76030150,"answer_count":2,"score":2,"creation_date":1681227847,"question_id":75987782,"body":"<p>I am trying to solve the problem called Walls and Gates.</p>\n<p>Here is the problem link.\n<a href=\"https://leetcode.com/problems/walls-and-gates/description/\" rel=\"nofollow noreferrer\">https://leetcode.com/problems/walls-and-gates/description/</a></p>\n<blockquote>\n<p>You are given a m X n grid, rooms initialized with these three possible values.</p>\n<ul>\n<li><p>-1 A wall or an obstacle.</p>\n</li>\n<li><p>0 A gate.</p>\n</li>\n<li><p>INF Infinity means an empty room.</p>\n<p>We use the value 2<sup>31</sup> - 1 = 2147483647 to represent INF as you may assume that the distance to a gate is less than 2147483647.</p>\n</li>\n</ul>\n<p>Fill each empty room with the distance to its nearest gate. If it is impossible to reach a gate, it should be filled with INF.</p>\n</blockquote>\n<p>I am trying to use DFS to solve the above problem.</p>\n<p>My approach is to</p>\n<ul>\n<li><p>Traverse the grid using two indexes i and j.</p>\n</li>\n<li><p>And wherever I encounter a 0 cell value, I start a DFS, as this is a Gate as per the problem definition.</p>\n</li>\n<li><p>In the DFS algorithm, I first check the boundaries are satisfied or not.</p>\n<ul>\n<li>If out of boundary, then I return.</li>\n<li>If the cell value is -1 then also I return, since as per the problem condition it is a wall.</li>\n<li>If the cell is already traversed then also I return.</li>\n</ul>\n<p>After all the above cases, I find out the minimum of cell value and count, and update the current cell with the minimum.</p>\n</li>\n<li><p>Mark the cell as visited. For which I am using another boolean grid.</p>\n</li>\n<li><p>And then I traverse all the cell by doing, row + 1, row - 1, cell + 1, cell -1.</p>\n</li>\n</ul>\n<p>Here is the code:</p>\n<pre><code>class Solution {\n    public void wallsAndGates(int[][] rooms) {\n        boolean[][] roomsBool = new boolean[rooms.length][rooms[0].length];\n        for(int i = 0; i &lt; rooms.length; ++i){\n            for(int j = 0; j &lt; rooms[i].length; ++j){\n                if(rooms[i][j] == 0){\n                    //if it is a gate we will do a DFS and fill the cells with the appropriate values.\n                    visitRommsDFS(rooms, i, j, 0, roomsBool);\n                    roomsBool = new boolean[rooms.length][rooms[i].length];\n                }\n            }\n        }\n    }\n\n    private void visitRommsDFS(int[][] rooms, int row, int col, int count, boolean[][] roomsBool){\n        if(row &lt; 0 || row &gt;= rooms.length || col &lt; 0 || col &gt;= rooms[row].length || rooms[row][col] == -1 || roomsBool[row][col] == true || rooms[row][col] == 0 &amp;&amp; count &gt; 0) return;\n        if(rooms[row][col] &gt; 0){\n            rooms[row][col] = Math.min(rooms[row][col], count);\n        }\n        roomsBool[row][col] = true;\n        visitRommsDFS(rooms, row-1, col, count + 1, roomsBool);\n        visitRommsDFS(rooms, row+1, col, count + 1, roomsBool);\n        visitRommsDFS(rooms, row, col+1, count + 1, roomsBool);\n        visitRommsDFS(rooms, row, col-1, count + 1, roomsBool);\n    }\n}\n</code></pre>\n<p>Problem is this code is not correct and is not giving the required correct result, what is that is lacking in this solution? What should I add to make this solution to make it fool proof?</p>\n<p>Here is the sample input for the problem.</p>\n<pre><code>[\n    [0, 2147483647, -1, 2147483647, 2147483647, -1, -1, 0, 0, -1, 2147483647, 2147483647, 0, -1, 2147483647, 2147483647, 2147483647, 2147483647, 0, 2147483647, 0, -1, -1, -1, -1, 2147483647, -1, -1, 2147483647, 2147483647, -1, -1, 0, 0, -1, 0, 0, 0, 2147483647, 0, 2147483647, -1, -1, 0, -1, 0, 0, 0, 2147483647],\n    [2147483647, 0, -1, 2147483647, 0, -1, -1, -1, -1, 0, 0, 2147483647, 2147483647, -1, -1, 2147483647, -1, -1, 2147483647, 2147483647, -1, 0, -1, 2147483647, 0, 2147483647, -1, 2147483647, 0, 2147483647, 0, 2147483647, -1, 2147483647, 0, 2147483647, -1, 2147483647, 0, 2147483647, 2147483647, 0, -1, 2147483647, -1, -1, -1, 0, 2147483647]\n]\n</code></pre>\n<p>and here is my output.</p>\n<pre><code>[\n    [0, 1, -1, 2, 1, -1, -1, 0, 0, -1, 1, 2, 0, -1, 4, 3, 2, 1, 0, 1, 0, -1, -1, -1, -1, 2, -1, -1, 1, 2, -1, -1, 0, 0, -1, 0, 0, 0, 1, 0, 2, -1, -1, 0, -1, 0, 0, 0, 1],\n    [1, 0, -1, 3, 0, -1, -1, -1, -1, 0, 0, 2, 1, -1, -1, 4, -1, -1, 1, 2, -1, 0, -1, 1, 0, 1, -1, 1, 0, 1, 0, 1, -1, 1, 0, 1, -1, 1, 0, 1, 1, 0, -1, 1, -1, -1, -1, 0, 1]\n]\n</code></pre>\n<p>while here is the expected output.</p>\n<pre><code>[\n    [0, 1, -1, 2, 1, -1, -1, 0, 0, -1, 1, 1, 0, -1, 4, 3, 2, 1, 0, 1, 0, -1, -1, -1, -1, 2, -1, -1, 1, 2, -1, -1, 0, 0, -1, 0, 0, 0, 1, 0, 1, -1, -1, 0, -1, 0, 0, 0, 1],\n    [1, 0, -1, 1, 0, -1, -1, -1, -1, 0, 0, 1, 1, -1, -1, 4, -1, -1, 1, 2, -1, 0, -1, 1, 0, 1, -1, 1, 0, 1, 0, 1, -1, 1, 0, 1, -1, 1, 0, 1, 1, 0, -1, 1, -1, -1, -1, 0, 1]\n]\n</code></pre>\n<p>Some more sample input and their expected outputs are as follows :-</p>\n<blockquote>\n<ol>\n<li>Sample input</li>\n</ol>\n</blockquote>\n<pre><code>[\n    [2147483647, -1, 0, 2147483647],\n    [2147483647, 2147483647, 2147483647, -1],\n    [2147483647, -1, 2147483647, -1],\n    [0, -1, 2147483647, 2147483647]\n]\n</code></pre>\n<blockquote>\n<p>Expected output of Sample output 1.</p>\n</blockquote>\n<pre><code> [\n    [3, -1, 0, 1],\n    [2, 2, 1, -1],\n    [1, -1, 2, -1],\n    [0, -1, 3, 4]\n]\n</code></pre>\n<blockquote>\n<p>Sample input 2.</p>\n</blockquote>\n<pre><code>[\n    [-1]\n]\n</code></pre>\n<blockquote>\n<p>Expected output for sample input 2.</p>\n</blockquote>\n<pre><code>[\n    [-1]\n]\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","java.util.concurrent","concurrenthashmap"],"comments":[{"owner":{"user_id":773113,"display_name":"Mike Nakis"},"edited":false,"comment_id":134018742,"body":"I confirm that the code as posted exhibits the observed behavior.  <code>Map&lt;K,V&gt;</code> has a naive default implementation of <code>computeIfAbsent()</code> which could cause this behavior, but it is irrelevant, because <code>ConcurrentHashMap</code> provides its own implementation. According to the documentation of <code>ConcurrentHashMap</code>, (or at any rate according to my interpretation of that documentation,) the OP should be receiving what he expects, and not what he observes. The implementation of <code>ConcurrentHashMap.computeIfAbsent()</code> is waaaay too complex for me to tell whether it is working as intended."},{"owner":{"user_id":898478,"display_name":"m0skit0"},"edited":false,"comment_id":134021227,"body":"If anyone is interested at taking a look, <a href=\"https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/concurrent/ConcurrentHashMap.java#L1691\" rel=\"nofollow noreferrer\">here&#39;s the source code for OpenJDK</a>."}],"answers":[{"owner":{"user_id":4712734,"display_name":"DuncG"},"up_vote_count":3,"is_accepted":false,"creation_date":1681218753,"answer_id":75986298,"body":"<p>Your assumption is wrong, as many different threads could be executing the same mapping function concurrently for different keys.</p>\n<p><code>ConcurrentHashMap</code> is thread-safe but permits concurrent updates to the map. Some callers which are accessing similar parts of the underlying mapping tables may block while waiting for another thread to finish.</p>\n<p>You won't find that <code>computeIfAbsent(someKey,mapFunc)</code> runs the mapping function for the same key twice, because it is an atomic operation for that key. So second or concurrent caller would see the value of the first call. However another <code>computeIfAbsent(anotherKey,mapFunc)</code> could be running at exactly the same time which is why your mapping function may evaluate <code>size()</code> to be same value for multiple keys.</p>\n<p>The javadoc states:</p>\n<blockquote>\n<p>The supplied function is invoked exactly once per invocation of this method if the key is absent, else not at all.</p>\n</blockquote>\n<blockquote>\n<p>Some attempted update operations on this map by other threads may be blocked while computation is in progress, so the computation should be short and simple.</p>\n</blockquote>\n<p>If you wish to have unique values you could use <code>AtomicInteger</code> counter.</p>\n"},{"owner":{"user_id":1786065,"display_name":"Rogue"},"up_vote_count":1,"is_accepted":false,"creation_date":1681221926,"answer_id":75986826,"body":"<p>Something to note with ConcurrentHashMap is how the size of the map is calculated:</p>\n<pre><code>public int size() {\n    long n = sumCount();\n    return ((n &lt; 0L) ? 0 :\n            (n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE :\n            (int)n);\n}\n\nfinal long sumCount() {\n    CounterCell[] cs = counterCells;\n    long sum = baseCount;\n    if (cs != null) {\n        for (CounterCell c : cs)\n            if (c != null)\n                sum += c.value;\n    }\n    return sum;\n}\n</code></pre>\n<p>These &quot;counter cells&quot; are updated upon a call to <code>addCount</code> internally. <a href=\"https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/concurrent/ConcurrentHashMap.java#L1775\" rel=\"nofollow noreferrer\">At the end</a> of the <code>#computeIfAbsent</code> method we have:</p>\n<pre><code>if (val != null)\n    addCount(1L, binCount);\nreturn val;\n</code></pre>\n<p>However, before this code is reached, the lambda expression you are passing will have already been evaluated earlier on in the method. For instance, when we are first adding values, they will synchronize on a <code>ReservationNode</code>:</p>\n<pre><code>Node&lt;K,V&gt; r = new ReservationNode&lt;K,V&gt;();\nsynchronized (r) {\n    if (casTabAt(tab, i, null, r)) { //compare-and-swap\n        binCount = 1;\n        Node&lt;K,V&gt; node = null;\n        try {\n            if ((val = mappingFunction.apply(key)) != null) //runs the mapping function\n                node = new Node&lt;K,V&gt;(h, key, val);\n            } finally {\n                setTabAt(tab, i, node);\n            }\n        }\n    }\n}\n</code></pre>\n<p>src: <a href=\"https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/concurrent/ConcurrentHashMap.java#L1701-L1717\" rel=\"nofollow noreferrer\">ConcurrentHashMap#computeIfAbsent</a></p>\n<p>The above code is quite suspect to me, and leaves me thinking that nothing would be truly blocked/synchronized on the creation phase here. Later on in the method (once the table entry exists), you'll see it doing <code>synchronized(f)</code> (the hash bucket) in order to compute/put the new values, which then causes the sequential insertion you see above.</p>\n<p>So, those concurrent updates at the start (when we are first initializing the map) are not only capable of running in parallel, but even with proper synchronization in place could potentially retrieve a <code>0</code> for the Map's size before the end of the <code>#computeIfAbsent</code> call.</p>\n"}],"owner":{"user_id":13562867,"display_name":"Ahmad Darwich"},"view_count":98,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1681217739,"question_id":75986151,"body":"<p>I have tried below code in order to have a unique id for each jj.</p>\n<p>As far as I know, computeIfAbsent is thread-safe but:</p>\n<pre><code>    public static void main(String[] args) throws InterruptedException {\n        ExecutorService executorService =\n                Executors.newFixedThreadPool(4);\n\n        final Map&lt;String, ConcurrentHashMap&lt;String, Short&gt;&gt; threadSafeMap = new ConcurrentHashMap&lt;&gt;();\n        threadSafeMap.put(&quot;0&quot;, new ConcurrentHashMap&lt;&gt;());\n        threadSafeMap.put(&quot;1&quot;, new ConcurrentHashMap&lt;&gt;());\n\n        for (int i = 1; i &lt;= 10; i++) {\n            final int jj = i;\n            executorService.submit(() -&gt; {\n                int                                key              = jj % 2;\n                final ConcurrentMap&lt;String, Short&gt; idByName = threadSafeMap.get(String.valueOf(key));\n                return idByName.computeIfAbsent(String.valueOf(jj), x -&gt; (short) idByName.size());\n            });\n        }\n        executorService.shutdown();\n        executorService.awaitTermination(5, TimeUnit.SECONDS);\n        System.out.println(threadSafeMap);\n    }\n</code></pre>\n<p>Actual value:\n{0={2=0, 4=0, 6=2, 8=3, 10=4}, 1={1=0, 3=0, 5=2, 7=3, 9=4}}</p>\n<p>Expected value for example (due to concurrency):\n{0={2=0, 4=1, 6=2, 8=3, 10=4}, 1={1=1, 3=0, 5=2, 7=3, 9=4}}</p>\n<p>The problem is that I have with 2=0 and 4=0, which is wrong values should be unique!</p>\n<p>btw using interger instead of short solve the issue!\nCould you please help?</p>\n"},{"tags":["java","javafx","netbeans","sdk","platform"],"comments":[{"owner":{"user_id":1155209,"display_name":"jewelsea"},"edited":false,"comment_id":133978070,"body":"I think the new JavaFX platform stuff in NetBeans is obsolete and broken.  Instead follow the getting started instructions for NetBeans at openjfx.io."},{"owner":{"user_id":1155209,"display_name":"jewelsea"},"edited":false,"comment_id":133978072,"body":"If you have been stuck for a long time, try a different approach.  To quickly get started, I advise downloading idea and using the <a href=\"https://stackoverflow.com/questions/74764217/error-javafx-runtime-components-are-missing-with-intellij-idea-maven-and-jdk/74764297#74764297\">new JavaFX project wizard</a>."},{"owner":{"user_id":7587451,"display_name":"Giovanni Contreras"},"edited":false,"comment_id":133978210,"body":"you can make a maven javafx project in netbeans  <a href=\"https://stackoverflow.com/a/74924150/7587451\">like so</a>"},{"owner":{"user_id":230513,"display_name":"trashgod"},"edited":false,"comment_id":133978961,"body":"<a href=\"https://stackoverflow.com/a/73611827/230513\"><i>&quot;Don&#39;t try to create a JavaFX project.&quot;</i></a>"},{"owner":{"user_id":-1,"display_name":"Community"},"edited":false,"comment_id":133981284,"body":"Please provide enough code so others can better understand or reproduce the problem."}],"answers":[{"owner":{"user_id":2985643,"display_name":"skomisa"},"up_vote_count":4,"is_accepted":true,"creation_date":1680913922,"answer_id":75962754,"body":"<p>The good news is that your issue is fairly easy to fix. The bad news is that you are going to encounter another problem once that is resolved, for which there is no easy fix.</p>\n<p>First, note from your screen shot that you are invited to provide a &quot;<strong>JavaFX</strong> Platform&quot; rather than just a &quot;<strong>Java</strong> Platform&quot;. That is, you need to provide a JDK which includes the JavaFX modules, and presumably your selection of <em>JDK 20 (Default)</em> is not valid.</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Azul_Systems\" rel=\"nofollow noreferrer\">Azul Systems</a> and <a href=\"https://bell-sw.com/\" rel=\"nofollow noreferrer\">BellSoft</a> are two <a href=\"https://en.wikipedia.org/wiki/Java_Development_Kit\" rel=\"nofollow noreferrer\">JDK</a> vendors offering editions that bundle the necessary JavaFX (<a href=\"https://openjfx.io/\" rel=\"nofollow noreferrer\">OpenJFX</a>) libraries. Here is a screen shot of the Azul site, <a href=\"https://www.azul.com/downloads/?package=jdk#zulu\" rel=\"nofollow noreferrer\">https://www.azul.com/downloads/?package=jdk#zulu</a></p>\n<p><a href=\"https://i.stack.imgur.com/UkTK7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UkTK7.png\" alt=\"Azul Download\" /></a></p>\n<p>Be sure to specify <em>JDK FX</em> for the <strong>Java Package</strong>. I downloaded the zip (rather than the msi) and after unzipping had a top level directory named <strong>zulu19.32.15-ca-fx-jdk19.0.2-win_x64</strong>. Use <strong>Tools &gt; Java Platforms &gt; Add Platform...</strong> to create a new Java platform, specifying that directory. I named my new platform <strong>Java193215Azul</strong>:</p>\n<p><a href=\"https://i.stack.imgur.com/xLbqh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xLbqh.png\" alt=\"Add Platform\" /></a></p>\n<p>Now you should be able to avoid the problem shown in your screen shot. Navigate to <strong>File &gt; New Project... &gt; Java with Ant &gt; JavaFX &gt; JavaFX Application</strong>, and click <strong>Next &gt;</strong>. On the <strong>New JavaFX Application</strong> screen in the <strong>JavaFX Platform</strong> field select the Azul SDK you just downloaded and added as a Java platform:</p>\n<p><a href=\"https://i.stack.imgur.com/bL36W.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bL36W.png\" alt=\"NetBeans Wizard\" /></a></p>\n<p>There should be no error now, and you can click <strong>Finish</strong> to generate your project.</p>\n<p>That resolves your issue, but it's important to note that when you build the JavaFX application generated by the NetBeans wizard you will get an unrelated build error:</p>\n<p><a href=\"https://i.stack.imgur.com/m8HWO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/m8HWO.png\" alt=\"Build error\" /></a></p>\n<p>A bug report for that issue was raised almost a year ago, but has not been resolved. See the NetBeans Bug <a href=\"https://github.com/apache/netbeans/issues/3996\" rel=\"nofollow noreferrer\">Build Failed #3996</a>:</p>\n<blockquote>\n<p>When I build javafx app this error appear &quot;Unable to create javax\nscript engine for JavaScript in javafx&quot;.</p>\n</blockquote>\n<p>To avoid this issue there are alternative approaches for JavaFX development which may or may not suit you:</p>\n<ul>\n<li>Create a <a href=\"https://en.wikipedia.org/wiki/Apache_Maven\" rel=\"nofollow noreferrer\">Maven</a> project rather than an <a href=\"https://en.wikipedia.org/wiki/Apache_Ant\" rel=\"nofollow noreferrer\">Ant</a> project in NetBeans.</li>\n<li>Use an alternative IDE, such as <a href=\"https://en.wikipedia.org/wiki/IntelliJ_IDEA\" rel=\"nofollow noreferrer\">IntelliJ IDEA</a> offering a JavaFX template for new projects. See <a href=\"https://stackoverflow.com/a/74764297/642706\">this Answer</a> for details.</li>\n<li>Regress to a much earlier version of NetBeans (12.0 or earlier) and use <a href=\"https://en.wikipedia.org/wiki/Java_version_history#Java_8\" rel=\"nofollow noreferrer\">JDK 8</a>.</li>\n</ul>\n<p>One final point: although you can't build a JavaFX project generated by the wizard when using Ant, it is still possible to run the file containing the <strong>main()</strong> method that was generated by the wizard, using <strong>Run &gt; Run File</strong>. Here's a screen shot showing that file being run after I made a couple of cosmetic changes in the code:</p>\n<p><a href=\"https://i.stack.imgur.com/x6lO0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/x6lO0.png\" alt=\"Run File\" /></a></p>\n<p>Of course that approach has limited value, but I mention it for completeness.</p>\n"}],"owner":{"user_id":21591513,"display_name":"Enyko"},"view_count":67,"up_vote_count":2,"accepted_answer_id":75962754,"answer_count":1,"score":2,"creation_date":1680896328,"question_id":75961471,"body":"<p>I am using Netbeans IDE 17. I have a problem with setting a different JavaFX platform version. Therefore I cannot create new JavaFx project.</p>\n<p>Tools/Java Platforms:</p>\n<p><a href=\"https://i.stack.imgur.com/UrQxL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UrQxL.png\" alt=\"Add Platform\" /></a></p>\n<p>When creating a new JavaFX project I tried multiple times to add new platforms, but I cannot choose them in the combobox:</p>\n<p><a href=\"https://i.stack.imgur.com/KTFmW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KTFmW.png\" alt=\"New Project\" /></a></p>\n"},{"tags":["java","date","jackson"],"comments":[{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":133886832,"body":"I recommend you don’t use <code>Date</code>. It was a poorly designed class and is long outdated. Can you use <code>OffsetDateTime</code> from <a href=\"https://docs.oracle.com/javase/tutorial/datetime/index.html\" rel=\"nofollow noreferrer\">java.time, the modern Java date and til API</a>?"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":133886841,"body":"A locale problem? Is it failing on computers with non-English default locale?"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"edited":false,"comment_id":133887078,"body":"By the way, the work is so much easier if you  textually exchange date-time values in standard <a href=\"https://en.m.wikipedia.org/wiki/ISO_8601\" rel=\"nofollow noreferrer\">ISO 8601</a> format."}],"answers":[{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"up_vote_count":4,"is_accepted":true,"creation_date":1680361576,"answer_id":75907026,"body":"<h2>java.time</h2>\n<p>The <code>java.util</code> date-time API and their corresponding parsing/formatting type, <code>SimpleDateFormat</code> are outdated and error-prone. In March 2014, the <a href=\"https://www.oracle.com/technical-resources/articles/java/jf14-Date-Time.html\" rel=\"nofollow noreferrer\">modern Date-Time API</a> was released as part of the <strong>Java 8 standard library</strong> which supplanted the legacy date-time API and since then it is strongly recommended to switch to <code>java.time</code>, the modern date-time API.</p>\n<p>Also, <strong><a href=\"https://stackoverflow.com/a/65544056/10819573\">never use date-time parsing/formatting API without specifying a <code>Locale</code></a></strong>.</p>\n<h2>Solution using <code>java.time</code></h2>\n<p>Since your date-time string has timezone information, you should praise it into <code>ZonedDateTime</code>.</p>\n<pre><code>@JsonProperty(&quot;jcr:created&quot;)\n@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;EEE MMM dd yyyy HH:mm:ss VVXX&quot;, locale = Locale.ENGLISH)\nprivate ZonedDateTime created;\n</code></pre>\n<p><strong>Demo:</strong></p>\n<pre><code>class Main {\n    public static void main(String[] args) {\n        DateTimeFormatter dtf = DateTimeFormatter.ofPattern(&quot;EEE MMM dd yyyy HH:mm:ss VVXX&quot;, Locale.ENGLISH);\n        String created = &quot;Thu Feb 04 2016 09:32:14 GMT+0100&quot;;\n        ZonedDateTime zdt = ZonedDateTime.parse(created, dtf);\n        System.out.println(zdt);\n    }\n}\n</code></pre>\n<p><strong>Output</strong>:</p>\n<pre><code>2016-02-04T08:32:14Z[GMT]\n</code></pre>\n<p><a href=\"https://ideone.com/MwDDFf\" rel=\"nofollow noreferrer\"><kbd>ONLINE DEMO</kbd></a></p>\n<p>Learn more about the modern Date-Time API from <strong><a href=\"https://docs.oracle.com/javase/tutorial/datetime/index.html\" rel=\"nofollow noreferrer\">Trail: Date Time</a></strong>.</p>\n<p>If for any reason, you want to carry on with the error-prone legacy API, simply include <code>locale</code> in the annotation</p>\n<pre><code>@JsonProperty(&quot;jcr:created&quot;)\n@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;EEE MMM dd yyyy HH:mm:ss 'GMT'Z&quot;, locale = Locale.ENGLISH)\nprivate Date created;\n</code></pre>\n<p><strong>Demo</strong>:</p>\n<pre><code>class Main {\n    public static void main(String[] args) throws ParseException {\n        SimpleDateFormat sdf = new SimpleDateFormat(&quot;EEE MMM dd yyyy HH:mm:ss 'GMT'Z&quot;, Locale.ENGLISH);\n        String created = &quot;Thu Feb 04 2016 09:32:14 GMT+0100&quot;;\n        Date date = sdf.parse(created);\n        System.out.println(date);\n    }\n}\n</code></pre>\n<p><strong>Output</strong>:</p>\n<pre><code>Thu Feb 04 08:32:14 GMT 2016\n</code></pre>\n<p><a href=\"https://ideone.com/35JqGv\" rel=\"nofollow noreferrer\"><kbd>ONLINE DEMO</kbd></a></p>\n"}],"owner":{"user_id":3176495,"display_name":"user66875"},"view_count":52,"up_vote_count":2,"accepted_answer_id":75907026,"answer_count":1,"score":2,"creation_date":1680357927,"question_id":75906713,"body":"<p>I'm using Jackson to parse a JSON and the deserialization fails because of a date field defined as:</p>\n<pre><code>@JsonProperty(&quot;jcr:created&quot;)\n@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;EEE MMM dd yyyy HH:mm:ss 'GMT'Z&quot;)\nprivate Date created;\n</code></pre>\n<blockquote>\n<p>com.fasterxml.jackson.databind.exc.InvalidFormatException: Cannot\ndeserialize value of type <code>java.util.Date</code> from String &quot;Wed Sep 14\n2016 15:37:40 GMT+0200&quot;: expected format &quot;EEE MMM dd yyyy HH:mm:ss\n'GMT'Z&quot;</p>\n</blockquote>\n<p>The JSON content looks like this:</p>\n<blockquote>\n<p>&quot;jcr:created&quot;: &quot;Thu Feb 04 2016 09:32:14 GMT+0100&quot;</p>\n</blockquote>\n<p>What's the issue with the pattern?</p>\n"},{"tags":["java","time-complexity"],"comments":[{"owner":{"user_id":507738,"display_name":"MC Emperor"},"edited":false,"comment_id":133856422,"body":"Please fix the syntax errors in the code and format the code as code block. You can do this by surrounding your code by three backtick characters (<code>```</code>) both on top of the code and at the bottom."},{"owner":{"user_id":8343843,"display_name":"Alexey R."},"edited":false,"comment_id":133856423,"body":"First of all can you plese format your code so that we can read it conveniently"},{"owner":{"user_id":3890632,"display_name":"khelwood"},"edited":false,"comment_id":133856491,"body":"In the first function, the outer loop will only run once, because the inner loop raises <code>i</code> past the end of the outer loop&#39;s limit."}],"answers":[{"owner":{"user_id":20922506,"display_name":"Shubham Jangid"},"up_vote_count":1,"is_accepted":false,"creation_date":1680180762,"answer_id":75888535,"body":"<p>The first code has the time-complexity O(n^2), because we are using the same iterator <code>i</code> in both loops so it will run only when <code>i&lt;n</code> from outer-loop, doesn't matter if we put <code>i&lt;n^3 or i&lt;n^10</code> in inner-loop, it will exit the both loops as soon as it becomes <code>i=n</code>.</p>\n<p>&amp; the second loop certainly has the time-complexity of <code>O(n^3)</code></p>\n"},{"owner":{"user_id":11307336,"display_name":"zoobiE-"},"up_vote_count":3,"is_accepted":true,"creation_date":1680181153,"answer_id":75888596,"body":"<p>You are right in the case of the second example, the time complexity is O(n^3) since the outer loop iterates n-1 times and inner one n^2 which results in (n-1) * n^2 or n^3 - n^2 so considering constant time operations the complexity can be expressed as O(n^3).</p>\n<p>However in the first example the complexity is only O(n^2) which reflects the number of iterations of the inner loop since the outer loop will always execute  only once. This is because the inner loop will exit with i=n*n-1 after the first iteration of outer loop which is outside the first loop's bounds (i &lt; n).</p>\n"}],"owner":{"user_id":21527326,"display_name":"Coder1234"},"view_count":74,"up_vote_count":3,"accepted_answer_id":75888596,"answer_count":2,"score":2,"creation_date":1680179733,"question_id":75888355,"body":"<p>For the below code it is said that the time complexity is <code>O(n^2)</code></p>\n<p>If the inner loop runs for <code>n*n</code> times\nand outer loop runs for n times then shouldn't it be <code>O(n^3)</code></p>\n<pre><code>public static void func(int n){\n    int sum=0;\n    \n    for(int i=1;i&lt;n;i++) {\n      for(;i&lt;n*n;i++)\n       sum+=1;\n     \n      System.out.println(sum):\n    \n    }\n}\n</code></pre>\n<p>But similarily for below code,the time complexity is <code>O(n^3)</code></p>\n<pre><code>public static void func(int n) {\n    int sum=0;\n    \n    for(int i=1;i&lt;n;i++) {\n      for(int j=0;j&lt;n*n;j++) {\n        sum+=1;\n        System.out.println(sum);\n      }\n    }\n}\n</code></pre>\n<p>So can someone explain the reason ?</p>\n<p>I felt that time complexity for the cases should be O(n^3) but that's not the case.</p>\n"},{"tags":["java","android","xml","android-studio","kotlin"],"answers":[{"owner":{"user_id":19674027,"display_name":"user2357113"},"up_vote_count":4,"is_accepted":true,"creation_date":1679796560,"answer_id":75845530,"body":"<p>You should follow this add colors.xml file.</p>\n<blockquote>\n<p>app&gt;res&gt;values&gt;colors.xml add color using this tag</p>\n</blockquote>\n<pre><code>    &lt;color name=&quot;green&quot;&gt;#2eaf4d&lt;/color&gt;\n</code></pre>\n<p>If you don't have color file create using this method</p>\n<blockquote>\n<p>app&gt;res&gt;values&gt;Right click&gt;New&gt;Value resources file&gt;enter name <strong>colors</strong> then add this color on that <em>colors.xml</em> file</p>\n</blockquote>\n<pre><code>    &lt;color name=&quot;green&quot;&gt;#2eaf4d&lt;/color&gt;\n</code></pre>\n<p>If you already tried both methods you just need to try this universal rule of Android Studio</p>\n<blockquote>\n<p>Invalidate cache &amp; Restart</p>\n</blockquote>\n<blockquote>\n<p>Rebuild Project</p>\n</blockquote>\n"}],"owner":{"user_id":21345603,"display_name":"Labed Idris"},"view_count":101,"up_vote_count":2,"accepted_answer_id":75845530,"answer_count":1,"score":2,"creation_date":1679795709,"question_id":75845493,"body":"<p>The color &quot;color_name&quot; in values has no declaration in the base <code>values</code> folder; this can lead to crashes when the resource is queried in a configuration that does not match this qualifier</p>\n"},{"tags":["java","casting","binary"],"comments":[{"owner":{"user_id":9513184,"display_name":"Unmitigated"},"edited":false,"comment_id":133775654,"body":"<code>2</code> isn&#39;t a valid binary digit. What are you actually trying to do?"},{"owner":{"user_id":21196290,"display_name":"Dhwani Patel"},"edited":false,"comment_id":133775684,"body":"I want to convert a decimal number provided in the String format to binary."},{"owner":{"user_id":112968,"display_name":"knittl"},"edited":false,"comment_id":133775696,"body":"Then you must parse it as decimal (base 10) and convert. I don&#39;t think there&#39;s builtin conversion in the JDK, you have to implement it yourself. Just to be sure, you want to read <code>2</code> and output <code>10</code>?"},{"owner":{"user_id":21196290,"display_name":"Dhwani Patel"},"edited":false,"comment_id":133775708,"body":"@knittl yes!..."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":133775766,"body":"You need to do it the other way around. You may use <code>input.nextInt()</code> to read the decimal number and then for example <a href=\"https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/lang/Integer.html#toBinaryString(int)\" rel=\"nofollow noreferrer\"><code>Integer.toBinaryString()</code></a> to convert it to binary-"},{"owner":{"user_id":21196290,"display_name":"Dhwani Patel"},"edited":false,"comment_id":133775814,"body":"@OleV.V. Thanks for the answer. It worked for me. First I converted the number in String format to integer and then used your solution to convert to binary."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":133776234,"body":"It’s a good exercise in distinguishing between <i>a concept</i> and its <i>representation in the UI</i>. Here the number is the concept. In the UI it’s represented either as a decimal number (on input) or a binary number (on output). Use an <code>int</code> for the concept of a number and forget whether it’s binary, decimal or something else, those are implementation details not relevant to the task at hand. And apply the proper conversions on input and output."}],"answers":[{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":4,"is_accepted":true,"creation_date":1679724785,"answer_id":75839951,"body":"<p>As <a href=\"https://stackoverflow.com/questions/75839796/convert-decimal-number-provided-in-string-to-the-binary/75839951#comment133775766_75839796\">commented by Ole V.V.</a>, obtain an <code>int</code> from user:</p>\n<pre><code>Scanner scanner = new Scanner( System.in );\nint input = scanner.nextInt() ;\n</code></pre>\n<p>And <a href=\"https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/lang/Integer.html#toBinaryString(int)\" rel=\"nofollow noreferrer\">convert to binary string</a>.</p>\n<pre><code>String output = Integer.toBinaryString( input ) ;\n</code></pre>\n<p>To quote <a href=\"https://stackoverflow.com/questions/75839796/convert-decimal-number-provided-in-string-to-the-binary/75839951#comment133776234_75839796\">another wise comment</a> by Ole V.V.:</p>\n<blockquote>\n<p>It’s a good exercise in distinguishing between <em>a concept</em> and <em>its representation in the UI</em>. Here the number is the concept. In the UI it’s represented either as a decimal number (on input) or a binary number (on output). Use an <code>int</code> for the concept of a number and forget whether it’s binary, decimal or something else, those are implementation details not relevant to the task at hand. And apply the proper conversions on input and output.</p>\n</blockquote>\n"}],"owner":{"user_id":21196290,"display_name":"Dhwani Patel"},"view_count":53,"up_vote_count":2,"accepted_answer_id":75839951,"answer_count":1,"score":2,"creation_date":1679722371,"question_id":75839796,"body":"<p>I want to convert a decimal number which is in the String format to the binary. For example I want to read <code>2</code> and output <code>10</code>.</p>\n<p>I tried :</p>\n<pre><code>Scanner input = new Scanner(System.in);\nString dec;\ndec = input.next();\nint bin = Integer.parseInt(dec, 2);\nSystem.out.println(bin);\n</code></pre>\n<p>I got the following error for the input 2:</p>\n<pre><code>Exception in thread &quot;main&quot; java.lang.NumberFormatException: For input string: &quot;2&quot; under radix 2\n    at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:67)\n    at java.base/java.lang.Integer.parseInt(Integer.java:665)\n    at binarytest.BinaryTest.main(BinaryTest.java:23)\n</code></pre>\n"},{"tags":["java","hashmap","key","tostring"],"comments":[{"owner":{"user_id":9513184,"display_name":"Unmitigated"},"edited":false,"comment_id":133749642,"body":"What order did you want?"}],"answers":[{"owner":{"user_id":1552534,"display_name":"WJS"},"up_vote_count":4,"is_accepted":true,"creation_date":1679580159,"answer_id":75824027,"body":"<p>Maps are unordered due to the <code>hashCode</code> used to determine in which &quot;bucket&quot; the entry is to be placed.  If you want to preserve the insertion order, you can use a <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/LinkedHashMap.html\" rel=\"nofollow noreferrer\">LinkedHashMap</a> in place of <code>HashMap</code>.  If you want to ensure the keys (here <code>LocalDate</code>) are sorted (<code>LocalDate</code> implements <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/Comparable.html\" rel=\"nofollow noreferrer\">Comparable</a>) you can use a <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/TreeMap.html\" rel=\"nofollow noreferrer\">TreeMap</a></p>\n"}],"owner":{"user_id":20664407,"display_name":"Daleo dorito"},"view_count":40,"up_vote_count":2,"accepted_answer_id":75824027,"answer_count":1,"score":2,"creation_date":1679579688,"question_id":75823938,"body":"<p>I am doing a HashMap that uses dates as key and assigns them a pet obeject (pet of the month). Pet holds a bunch of values like name, age, type... (not relevant) and has a method that generates one randomly. It goes soemthing like this:</p>\n<pre><code>DateTimeFormatter date_format = DateTimeFormatter.ofPattern (&quot;dd/MM/yyyy&quot;);\nLocalDate date = LocalDate.of(2023, 1, 1);\nHashMap&lt;LocalDate, Pet&gt; pets = new HashMap&lt;&gt;();\n\n//* This next chunk generates a random pet (that has not yet been chosen) and makes it the pet of the month using the date as the key and the pet as the value\n\nfor (int i=0; i &lt; 12; i++){\n            Pet pet_of_the_month = Pet.randompet(); \n            if (!pets.containsValue(pet_of_the_month)){ \n                pets.put(date, pet_of_the_month); \n                date = date.plusMonths(1);\n            } else {\n                i--;\n            }\n        }\n\n//*This loops around the map taking every key and printing both the key (date) and the object (pet)\n\nfor (LocalDate month: pets.keySet()) {\n            System.out.println(&quot;Date of&quot; + month.format(date.format) + &quot;:&quot; + pets.get(month).toString());\n        }\n</code></pre>\n<p>The issue I have is that this for some reason ALWAYS prints the month 4 first and then the rest in order (4,1,2,3,5,6...); is there a reason for why it is doing that?;am I doing something wrong/missing something or is just some random interaction that I have to assume?</p>\n"},{"tags":["java","amazon-dynamodb","aws-cli"],"answers":[{"owner":{"user_id":17464257,"display_name":"Alex Chadyuk"},"up_vote_count":2,"is_accepted":false,"creation_date":1678630227,"answer_id":75713692,"body":"<p>You cannot delete items in DynamoDB without providing the primary key (partition + sort).</p>\n<p>You would have to do the following:</p>\n<ol>\n<li>Create a GSI with the partition key <code>date</code> (call it <code>date-index</code>):</li>\n</ol>\n<pre><code>aws dynamodb update-table \\\n    --table-name test-items \\\n    --attribute-definitions AttributeName=date,AttributeType=S  \\\n    --global-secondary-index-updates \\\n        &quot;[\n            {\n                \\&quot;Create\\&quot;: {\n                    \\&quot;IndexName\\&quot;: \\&quot;date-index\\&quot;,\n                    \\&quot;KeySchema\\&quot;: [{\\&quot;AttributeName\\&quot;:\\&quot;date\\&quot;,\\&quot;KeyType\\&quot;:\\&quot;HASH\\&quot;}],\n                    \\&quot;Projection\\&quot;:{\n                        \\&quot;ProjectionType\\&quot;:\\&quot;KEYS_ONLY\\&quot;\n                    }\n                }\n            }\n        ]&quot;\n</code></pre>\n<ol start=\"2\">\n<li><a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Query.html\" rel=\"nofollow noreferrer\">Query</a> the table for the items you want to remove</li>\n</ol>\n<pre><code>aws dynamodb query \\\n    --table-name test-items \\\n    --index-name date-index \\\n    --key-condition-expression &quot;#d = :badday&quot; \\\n    --expression-attribute-names '{&quot;#d&quot;: &quot;date&quot;}' \\\n    --expression-attribute-values  '{&quot;:badday&quot;:{&quot;S&quot;:&quot;20220212&quot;}}'\n</code></pre>\n<p>You will get a list of items:</p>\n<pre><code>{\n    &quot;Items&quot;: [\n        {\n            &quot;date&quot;: {\n                &quot;S&quot;: &quot;20220212&quot;\n            },\n            &quot;personKey&quot;: {\n                &quot;S&quot;: &quot;456&quot;\n            }\n        },\n        {\n            &quot;date&quot;: {\n                &quot;S&quot;: &quot;20220212&quot;\n            },\n            &quot;personKey&quot;: {\n                &quot;S&quot;: &quot;123&quot;\n            }\n        }\n    ],\n    &quot;Count&quot;: 2,\n    &quot;ScannedCount&quot;: 2,\n    &quot;ConsumedCapacity&quot;: null\n}\n</code></pre>\n<ol start=\"3\">\n<li><p>Record the primary keys of the offending records.</p>\n</li>\n<li><p>Delete them one-by-one:</p>\n</li>\n</ol>\n<pre><code>aws dynamodb delete-item \\\n    --table-name test-items \\\n    --key '{&quot;personKey&quot;: {&quot;S&quot;: &quot;456&quot;}, &quot;date&quot;: {&quot;S&quot;: &quot;20220212&quot;}}'\n</code></pre>\n<p>Note that a more cost-effective way to remove a large number of items from the table may be to copy the items you want to keep into a new table and then delete the old table.</p>\n"},{"owner":{"user_id":2860032,"display_name":"Jason Wadsworth"},"up_vote_count":2,"is_accepted":false,"creation_date":1678657651,"answer_id":75716576,"body":"<p>The answer to your question depends a bit on how much data is in the table and how often you’ll be doing this. If it’s going to be a regular part of your process then the answer that @alex-chadyuk gave is what you want. If this is a one time operation then I’d just use a Scan rather than a query and not add a GSI. If the dataset is small the scan isn’t a terrible option either. You just have to weigh the cost and performance benefits of each.</p>\n<p>Bottom line is that you need the full key, both partition and sort, to perform a delete. How you get that key is up to you, and should be based on your specific use case.</p>\n"}],"owner":{"user_id":21383218,"display_name":"Tim-Timer"},"view_count":177,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1678628697,"question_id":75713531,"body":"<p>I have the table in Dynamo DB called <strong>test-items</strong>\nwhere <code>personKey</code> is the partitionKey and <code>date</code> is the sortkey</p>\n<pre><code>personKey | date       | accountNumber|\n123       | 20220212   | A1           |\n456       | 20220212   | A1           |\n789       | 20220212   | A1           |\n789       | 20220214   | A1           |\n567       | 20220214   | A1           |\n</code></pre>\n<p>I have million such rows and the personKey is unpredictable , I want to delete all the items in the Dynamo DB Table deleted whose date is 20220212</p>\n<pre><code>\naws dynamodb delete-item \\\n    --table-name &quot;test-items&quot; \\\n    --key '{&quot;date&quot;: {&quot;S&quot;: &quot;20220212&quot;}}'\n</code></pre>\n<p>This is not deleting the items for me</p>\n"},{"tags":["java","arrays","hashmap"],"comments":[{"owner":{"user_id":2338547,"display_name":"markspace"},"edited":false,"comment_id":133556179,"body":"In Java you would typically define a <code>Person</code> class to hold that data.  Using a list of maps is possible, but I&#39;d call it far from the &quot;best&quot; way."},{"owner":{"user_id":1393766,"display_name":"Pshemo"},"edited":false,"comment_id":133556191,"body":"Please note that array is not the same as List. One dimensional arrays are in form <code>Type[]</code> like <code>int[]</code> or <code>String[]</code> while <code>List</code> is interface and <code>ArrayList</code> is class <i>implementing</i> that interface and <i>using internally</i> array to store its elements (but is not array itself). Your question is about List of HashMaps, not Array of HashMaps."}],"answers":[{"owner":{"user_id":2422776,"display_name":"Mureinik"},"up_vote_count":4,"is_accepted":true,"creation_date":1678551593,"answer_id":75706296,"body":"<p>You could do that, but a more idiomatic approach for Java would be to create a <code>Person</code> class that contains all the data members you want to collect. E.g.:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Person {\n    private String name;\n    private int age;\n    // other properties...\n\n    // Constructor using these properties\n    // Note: this is a stylistic choice. Some would prefer a default ctor and using setters later\n    public Person (String name, int age) {\n        this.name = name;\n        this.age = age;\n    }\n\n    // Getters and setters for all the properties\n\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        int numPeople = 7; // Arbitrary number for the example\n        List&lt;Person&gt; people = new ArrayList&lt;&gt;(numPeople);\n        for (int i = 0; i &lt; numPeople; ++i) {\n            System.out.print(&quot;Name: &quot;);\n            String name = sc.next();\n            System.out.print(&quot;Age: &quot;);\n            int age = sc.nextInt();\n            people.add(new Person(name, age));\n        }\n    }\n}\n</code></pre>\n"}],"owner":{"user_id":20095556,"display_name":"Nethum "},"view_count":58,"up_vote_count":2,"accepted_answer_id":75706296,"answer_count":1,"score":2,"creation_date":1678551089,"question_id":75706231,"body":"<p>In python, I'd use a list of dictionaries to collect data (like name, age, height, etc.) of several people that a user enters, but now I want to do the same thing in Java. Is an array of HashMaps the best way to do that?</p>\n<pre class=\"lang-java prettyprint-override\"><code>static List&lt;Map&lt;String, Object&gt;&gt; driverList = new ArrayList&lt;&gt;();\n</code></pre>\n"},{"tags":["java","maven","intellij-idea","adoptopenjdk","java-19"],"comments":[{"owner":{"user_id":104891,"display_name":"CrazyCoder"},"edited":false,"comment_id":133528841,"body":"Change IDE Project JDK to 20, you are using JDK 11 which cannot target level 20. Also do the same for Maven JDK: <a href=\"https://i.imgur.com/SbuV0a9.png\" rel=\"nofollow noreferrer\">i.imgur.com/SbuV0a9.png</a>."},{"owner":{"user_id":2540471,"display_name":"Robert Scholte"},"edited":false,"comment_id":133717647,"body":"off topic: please replace the source and target properties with <code>maven.compiler.release</code> to ensure code is compatible when it is being built with a newer JDK."}],"answers":[{"owner":{"user_id":21366363,"display_name":"Saco MongoDB"},"up_vote_count":2,"is_accepted":false,"creation_date":1678395568,"answer_id":75689986,"body":"<p>I would recommend using 15 above, i personally use 17version by amazon correto and that switch feature is available.\nits up to what new java features you want to use.</p>\n<p>however if you want to use the 20 version you had to set the sdk/jdk,language level to 20</p>\n<p><strong>like this:</strong></p>\n<p><a href=\"https://i.stack.imgur.com/SBena.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/SBena.png</a></p>\n<p><a href=\"https://i.stack.imgur.com/TbyJh.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/TbyJh.png</a></p>\n<p><a href=\"https://i.stack.imgur.com/BAAQJ.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/BAAQJ.png</a></p>\n<p><a href=\"https://i.stack.imgur.com/4tJmI.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/4tJmI.png</a></p>\n<p>you might be missing those points.</p>\n"},{"owner":{"user_id":4759176,"display_name":"parsecer"},"up_vote_count":0,"is_accepted":true,"creation_date":1679099399,"answer_id":75773195,"body":"<p>I think my problem was connected to this:</p>\n<p><a href=\"https://stackoverflow.com/questions/57490341/intellij-insists-on-compiling-with-javac-11-0-3-instead-of-java-7\">Intellij insists on compiling with javac 11.0.3 instead of Java 7</a></p>\n<pre><code>IntelliJ IDEA checks all JDKs that are used in the project: the JDKs that are defined on both the project and module levels.\n\nIntelliJ IDEA calculates the latest of these JDKs. This is necessary to make sure that all modules can be compiled.\n\nIf the version of the latest JDK configured is lower than 1.6, IntelliJ IDEA will pick the JDK version that is used for running the IDE. This limitation is related to the fact that the compiler API used by IntelliJ IDEA for building projects is supported starting from JDK 1.6.\n</code></pre>\n<p>I had</p>\n<pre><code>Information:javac 11 was used to compile java sources\n</code></pre>\n<p>message before the actual error message.</p>\n<p>So I think despite all the correct settings of JDK, Idea Intellij just insisted on using JDK 11 to compile and there was nothing that could be done about it.</p>\n<p>I ended up just downloading the latest Intellij version and now it works fine</p>\n"},{"owner":{"user_id":12354182,"display_name":"cherish sham"},"up_vote_count":1,"is_accepted":false,"creation_date":1679283052,"answer_id":75786380,"body":"<p>In Project settings you need to set\nProject SDK to 20\nand project language level to 20</p>\n"},{"owner":{"user_id":5082941,"display_name":"Bladimir Jimenez"},"up_vote_count":1,"is_accepted":false,"creation_date":1679671983,"answer_id":75835558,"body":"<p>You don't need to have Java 20 to use the <code>enhanced switch blocks</code> java 17 has it too. And you are building it in java 11, and compiling in java 20, which is the reason you are getting that error.</p>\n<p>Generaly you need to add java 20 to your project in the screenshot <code>file -&gt; Project Structure -&gt; project</code> to use the libraries of java 20 that are compilable in java 20.</p>\n<p>I hope that makes sense.</p>\n"}],"owner":{"user_id":4759176,"display_name":"parsecer"},"view_count":3570,"up_vote_count":2,"accepted_answer_id":75773195,"answer_count":4,"score":2,"creation_date":1678393127,"question_id":75689637,"body":"<p>I have a <code>Idea Intellij</code> project like this:</p>\n<p><strong>Test.java</strong>:</p>\n<pre><code>public class Test {\n    public static void main(String[] args) {\n        System.out.println(&quot;Test&quot;);\n    }\n}\n</code></pre>\n<p><strong>pom.xml</strong>:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;groupId&gt;test&lt;/groupId&gt;\n    &lt;artifactId&gt;test&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n     \n    &lt;properties&gt;\n        &lt;maven.compiler.target&gt;20&lt;/maven.compiler.target&gt;\n        &lt;maven.compiler.source&gt;20&lt;/maven.compiler.source&gt;\n    &lt;/properties&gt;\n&lt;/project&gt;\n</code></pre>\n<p><strong>Idea Intellij</strong></p>\n<pre><code>File -&gt; Settings -&gt; Build, Execution, Deployment -&gt; Compiler -&gt; Java Compiler\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/64YmG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/64YmG.png\" alt=\"enter image description here\" /></a></p>\n<pre><code>File -&gt; Project Structure -&gt; Project\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/UykIK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UykIK.png\" alt=\"enter image description here\" /></a></p>\n<pre><code>File -&gt; Project Structure -&gt; Modules -&gt; Sources\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/21OQy.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/21OQy.png\" alt=\"enter image description here\" /></a></p>\n<pre><code>File -&gt; Project Structure -&gt; Modules -&gt; Dependencies\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/CymXg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CymXg.png\" alt=\"enter image description here\" /></a></p>\n<p>When trying to run <code>Test.java</code> I get an error:</p>\n<pre><code>Error:java: error: release version 20 not supported\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/ZQ83T.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZQ83T.png\" alt=\"enter image description here\" /></a></p>\n<p>I use Ubuntu. When I type <code>java --version</code> in the terminal, I get:</p>\n<pre><code>openjdk 20 2023-03-21\nOpenJDK Runtime Environment (build 20+36-2344)\nOpenJDK 64-Bit Server VM (build 20+36-2344, mixed mode, sharing)\n</code></pre>\n<p>I'm not sure how I can make Intellij use Java 20</p>\n<p>When I use</p>\n<pre><code>   &lt;properties&gt;\n        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;\n        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;\n    &lt;/properties&gt;\n</code></pre>\n<p>the code runs fine. However I want a newer Java to be used, so that features like <code>enhanced switch blocks</code>:</p>\n<pre><code>switch (value)  {\n case 1 -&gt; {}\n}\n</code></pre>\n<p>are available</p>\n"}],"has_more":true,"quota_max":300,"quota_remaining":183}