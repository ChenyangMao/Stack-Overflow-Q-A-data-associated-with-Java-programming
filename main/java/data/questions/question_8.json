{"items":[{"tags":["java","android","firebase","google-cloud-platform","google-cloud-firestore"],"answers":[{"owner":{"user_id":5246885,"display_name":"Alex Mamo"},"up_vote_count":1,"is_accepted":true,"creation_date":1676536543,"answer_id":75469625,"body":"<p>You cannot use a batch to update a single document with multiple values, as the document will only contain only the most recent data that was written.</p>\n<p>If you need to have a document that looks like this:</p>\n<pre><code>docId (document)\n |\n --- k1 (object)\n |   |\n |   --- a: 1\n |   |\n |   --- b: 2\n |\n --- k2 (object)\n |   |\n |   --- b: 3\n |   |\n |   --- c: 4\n |\n --- k3 (object)\n     |\n     --- d: 5\n     |\n     --- e: 6\n</code></pre>\n<p>All you have to do is to create another class:</p>\n<pre><code>class Doc {\n    public K1 k1;\n    public K2 k2;\n    public K3 k3;\n\n    public Doc(K1 k1, K2 k2, K3 k3) {\n        this.k1 = k1;\n        this.k2 = k2;\n        this.k3 = k3;\n    }\n}\n</code></pre>\n<p>And then create a new instance of the class like this:</p>\n<pre><code>Doc doc = new Doc(new K1(1, 2), new K2(3, 4), new K3(5, 6));\ndocumentReference.set(doc);\n</code></pre>\n<p>Even if you pass three objects to the constructor, you'll always have to pay a single write operation.</p>\n<p>On the other hand, if you need to update multiple fields within the same document, then you should pass those values to the <a href=\"https://firebase.google.com/docs/reference/android/com/google/firebase/firestore/DocumentReference#update(java.util.Map%3Cjava.lang.String,java.lang.Object%3E)\" rel=\"nofollow noreferrer\">DocumentReference#update()</a> method, as explained in the official documentation:</p>\n<ul>\n<li><a href=\"https://firebase.google.com/docs/firestore/manage-data/add-data#update_fields_in_nested_objects\" rel=\"nofollow noreferrer\">https://firebase.google.com/docs/firestore/manage-data/add-data#update_fields_in_nested_objects</a></li>\n</ul>\n<p>P.S. Remember that a batch write is useful only when you want to perform operations at multiple different locations.</p>\n"}],"owner":{"user_id":21221401,"display_name":"Nsqr"},"view_count":34,"up_vote_count":2,"accepted_answer_id":75469625,"answer_count":1,"score":2,"creation_date":1676484207,"question_id":75463790,"body":"<p>I have 3 classes:</p>\n<pre><code>K1{int field A, int field B} \nK2{bool fA, bool fB, bool fC} \nK3{String fA}\n</code></pre>\n<p>And I want to write them into a single Document in a Firestore. When I try:</p>\n<pre><code>K1 k1 = new K1...\nK2 k2 = new K2...\nK3 k3 = new K3...\nWriteBatch writeBatch = db.batch();\nwriteBatch.set(documentReference, k1, SetOptions.merge());\nwriteBatch.set(documentReference, k2, SetOptions.merge());\nwriteBatch.set(documentReference, k3, SetOptions.merge());\nwriteBatch.commit();\n</code></pre>\n<p>only 1 of them gets written. If those were 3 different documentReference things would work, but not if it's same one. Of course, I could try simply:</p>\n<pre><code>documentReference.set(k1, SetOptions.merge()).addOnSuccesListener(\n   ...\n   documentReference.set(k2, SetOptions.merge()).addOnSuccesListener(\n      ...\n      documentReference.set(k3, SetOptions.merge());\n   )\n)\n</code></pre>\n<p>and that would have worked, but it would count as 3 writes to DB.</p>\n<p>Is there a way to do a batch write to the same document with a combination of multiple custom objects, or even a HashMap and a custom object?</p>\n"},{"tags":["java","database","hibernate","dto"],"answers":[{"owner":{"user_id":950558,"display_name":"Bastien Aracil"},"up_vote_count":1,"is_accepted":false,"creation_date":1676500551,"answer_id":75466059,"body":"<p>I do not have a project ready to test your code but I am pretty sure that you need to specify to Hibernate that the class <code>Address</code> is embedded in your entity by adding <code>@Embeddable</code> at the top of the class Address, like this :</p>\n<pre><code>@Entity\n@Table(name = &quot;my_class&quot;)\npublic class MyClassData {\n    private String id;\n    private String name;\n    private Address address;\n    // getter, setter\n}\n\n@Embeddable\npublic class Address {\n    private String street;\n    private boolean isPrimary;\n    // getter, setter\n}\n</code></pre>\n"}],"owner":{"user_id":13977702,"display_name":"Shelomi Silva"},"view_count":109,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1676482583,"question_id":75463524,"body":"<p>In the project I’m working on I have a hibernate data class which uses a DAO to save and update information. I need to set a value to the boolean property 'isPrimary' and save it in the my_class database.</p>\n<p>Below is the data class,</p>\n<pre><code>@Entity\n@Table(name = &quot;my_class&quot;)\npublic class MyClassData {\n    private String id;\n    private String name;\n    private Address address;\n    // getter, setter\n}\n\nclass Address {\n    private String street;\n    private boolean isPrimary;\n    // getter, setter\n}\n</code></pre>\n<p>when I try to update just the boolean value 'isPrimary' as shown below and try to update the database it is not updated.</p>\n<pre><code>\nMyClassData myClassData = myclassDAO.getById(id);\nmyClassData.getAddress().setIsPrimary(false);\nmyclassDAO.update(myClassData); // doesn’t update in the db\n</code></pre>\n<p>However if I try to update boolean value along with another string property both properties are updated in the database</p>\n<pre><code>MyClassData myClassData = myclassDAO.getById(id);\nmyClassData.setName(“John”)\nmyClassData.getAddress().setIsPrimary(false);\nmyclassDAO.update(myClassData); // updates both values in the db\n</code></pre>\n<p>Is there a specific reason why this is happening and how can I update just the boolean value in the database?</p>\n"},{"tags":["java","android","react-native","kotlin","okhttp"],"answers":[{"owner":{"user_id":860212,"display_name":"karllindmark"},"up_vote_count":0,"is_accepted":false,"creation_date":1676314369,"answer_id":75440096,"body":"<p>Have you considered adding your <code>CustomInterceptor</code> as a <a href=\"https://square.github.io/okhttp/features/interceptors/#network-interceptors\" rel=\"nofollow noreferrer\">&quot;network interceptor&quot;</a>? That might help to get more information from it (not completely sure that's actually what you need in the long run, though).</p>\n<pre><code>return clientBuilder\n    .certificatePinner(certificatePinner)\n    .addNetworkInterceptor(new CustomInterceptor())\n    .build();\n</code></pre>\n"},{"owner":{"user_id":18587725,"display_name":"Harjinder Singh"},"up_vote_count":1,"is_accepted":true,"creation_date":1676380628,"answer_id":75448410,"body":"<p>I have been able to get around this problem by adding the chain.proceed(request) in try-catch block and catching the exception. Exception object contains the message that request failed due to invalid SSL hash.</p>\n<pre><code>@Override\npublic Response intercept(Chain chain) throws IOException {\n    Request request = chain.request();\n    System.out.println(&quot;My Client::: Intercepted request: &quot; +request.toString());\n    Response res= null;\n    try{\n        res=chain.proceed(request);\n    }catch(Exception e){\n        System.out.println(e);\n    }\n    System.out.println(&quot;My Client::: Intercepted response: &quot; + res.toString());\n    return res;\n}\n</code></pre>\n"}],"owner":{"user_id":18587725,"display_name":"Harjinder Singh"},"view_count":79,"up_vote_count":2,"accepted_answer_id":75448410,"answer_count":2,"score":2,"creation_date":1676301219,"question_id":75437743,"body":"<p>I have implemented SSL pinning in my react-native app in the android code and i want to get some sort of message/warning when the request is rejected due to invalid SSL hash, so i added an interceptor to get the message from the response.</p>\n<p>Here is code of the added interceptor,</p>\n<pre><code>OkHttpClient.Builder clientBuilder = OkHttpClientProvider.createClientBuilder();\n         return clientBuilder\n                 .certificatePinner(certificatePinner)\n                 .addInterceptor(new CustomInterceptor())\n                 .build();\n</code></pre>\n<p>The problem is when i add an invalid key (for testing purposes), the code below <code>chain.proceed(request)</code> never runs, i am not familiar with OKHTTP or android, but i am guessing it automatically returns a null response in case the request is rejected.</p>\n<p>Is there any way to get the response object even if the request is rejected due to invalid SSL hash.</p>\n<p>Here is code for my interceptor.</p>\n<pre><code>public class CustomInterceptor implements Interceptor {\n    @Override\n    public Response intercept(Chain chain) throws IOException {\n        Request request = chain.request();\n        System.out.println(&quot;My Client::: Intercepted request: &quot; +request.toString());\n        Response res= chain.proceed(request);\n        System.out.println(&quot;My Client::: Intercepted response: &quot; + res.toString());\n        return res;\n    }\n}\n</code></pre>\n<p>In my app Axios is used as a network managing library and i haven't found any library for SSL pinning which works with Axios, that is the reason i had to add that directly at native code. Any other solution regarding this is also welcome.</p>\n"},{"tags":["java","spring","spring-boot","spring-mvc"],"comments":[{"owner":{"user_id":7553069,"display_name":"Deng"},"edited":false,"comment_id":133104312,"body":"There is no extra configuration, just only one <code>Controller</code>"},{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":133104488,"body":"What is the type of the parameters you are submitting? Each part has its own content-type, if that isn&#39;t compatible with the type you are trying to convert to it will fail. You are probably submitting things with a wrong content-type. A stream can be read directly into a <code>String</code> but not into an <code>Integer</code> (spring doesn&#39;t have a converter for that). So basically without knowing what and how you are sending things to this controller this will be impossible to answer."},{"owner":{"user_id":7553069,"display_name":"Deng"},"edited":false,"comment_id":133105095,"body":"Thanks, I got it, I did not set for each parameter, just set a form-data for the request, but how to set content-type for each parameter.  I just understand how to set the request content-type by code."},{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":133115422,"body":"You are sending it as text (that is the type you selected) you should specify it as a number which should create a better/proper type for the field."}],"answers":[{"owner":{"user_id":2688838,"display_name":"user2688838"},"up_vote_count":1,"is_accepted":false,"creation_date":1676642491,"answer_id":75485270,"body":"<p>I take the chance of this post because it pointed me to the right direction anyway so, for sake of anyone using <strong>Postman</strong>, receiving the error above here is my hint, learnt with pain and solved thanks to the hints above.</p>\n<p>In <strong>Postman</strong>, when you fill a <strong>form-data</strong> body, the table misses, by default I believe, the <strong>CONTENT TYPE</strong> column.\nYou can add the column the using the button on the right side, but then it will show <em>Auto</em> consequently, depending from your parameters, you should change it to the proper type.</p>\n<p><a href=\"https://i.stack.imgur.com/UaDgU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UaDgU.png\" alt=\"enter image description here\" /></a></p>\n<p>I hope it may help others :)\nRegards</p>\n"}],"owner":{"user_id":7553069,"display_name":"Deng"},"view_count":280,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1676300298,"question_id":75437563,"body":"<p>when using spring boot upload file with parameter, I used @RequestPart for all parameter.\nHere the code:</p>\n<blockquote>\n<p>spring boot: 2.7.8</p>\n</blockquote>\n<p>when one of them is <code>String</code> and the other is <code>Integer</code> and both of them annotated by @RequestPart will be cause Exception</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.interfaces.anti.mage.api;\n\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.interfaces.anti.mage.model.Address;\nimport com.interfaces.anti.mage.model.Order;\nimport com.interfaces.anti.mage.service.OrderService;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestPart;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.multipart.MultipartFile;\n\nimport java.math.BigDecimal;\nimport java.time.LocalDate;\nimport java.util.List;\n\n/**\n * @author dengbojing\n */\n@RestController\n@RequestMapping(&quot;/order&quot;)\npublic class OrderApi {\n\n    @PostMapping(&quot;/upload&quot;)\n    public String upload(@RequestPart(&quot;file&quot;)MultipartFile file, @RequestPart(&quot;id&quot;) String id, @RequestPart(&quot;number&quot;) Integer number) {\n        System.out.println(id);\n        System.out.println(number);\n        return &quot;success&quot;;\n\n    }\n}\n\n</code></pre>\n<p>Exception info:</p>\n<pre><code>2023-02-13 22:51:40,319 WARN  [http-nio-8099-exec-2] org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver: Resolved [org.springframework.web.HttpMediaTypeNotSupportedException: Content type 'application/octet-stream' not supported]\n</code></pre>\n<p>when all the other parameter type is <code>String</code> and annotated by @RequestPart, the method will be worked and print the info.</p>\n<pre class=\"lang-java prettyprint-override\"><code> @PostMapping(&quot;/upload&quot;)\n    public String upload(@RequestPart(&quot;file&quot;)MultipartFile file, @RequestPart(&quot;id&quot;) String id, @RequestPart(&quot;number&quot;) String number) {\n        System.out.println(id);\n        System.out.println(number);\n        return &quot;success&quot;;\n\n    }\n</code></pre>\n<p>So why this? the exception means the program treat the <code>String</code> and <code>Integer</code> paramter as <code>Stream</code>? but why all <code>String</code> will be fine?\nps: even change to this <code>@PostMapping(value = &quot;/upload&quot;, consumes = {MediaType.MULTIPART_FORM_DATA_VALUE, MediaType.APPLICATION_JSON_VALUE})</code> also got the same problem</p>\n<p>ps: this is the request info:</p>\n<p><a href=\"https://i.stack.imgur.com/BUPbG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/BUPbG.png\" alt=\"Here is the request\" /></a></p>\n"},{"tags":["java","multithreading","parallel-processing","synchronization","data-consistency"],"comments":[{"owner":{"user_id":11002,"display_name":"tgdavies"},"edited":false,"comment_id":133094943,"body":"At present your second process &quot;wins&quot;. You should modify the first process so that it doesn&#39;t update that value, then you can run them concurrently."}],"answers":[{"owner":{"user_id":4894473,"display_name":"Lam Le"},"up_vote_count":1,"is_accepted":false,"creation_date":1676254115,"answer_id":75431385,"body":"<p>To avoid race condition, you should wait for both thread collect all data from 2 rest calls then do the database modification, like example:</p>\n<pre><code>ExecutorService es = Executors.newFixedThreadPool(2);\nList&lt;Callable&lt;Object&gt;&gt; todo = new ArrayList&lt;Callable&lt;Object&gt;&gt;();\n\ntodo.add(Executors.callable(new TaskCallRest1())); \ntodo.add(Executors.callable(new TaskCallRest2())); \n\nList&lt;Future&lt;Object&gt;&gt; answers = es.invokeAll(todo);\n</code></pre>\n<p>For database synchronization, you can use optimistic lock to prevent multiple update. Optimistic lock simple is version of your record and the query look like:</p>\n<pre><code>update A set B = b, version = 2 where version = 1; \n</code></pre>\n<p>Only one thread can execute successful this query due to database ACID.\nIf you use Hibernate for persistence layer, you can looking for Hibernate Versioning</p>\n"},{"owner":{"user_id":9168200,"display_name":"Ilam"},"up_vote_count":0,"is_accepted":false,"creation_date":1676442169,"answer_id":75456150,"body":"<p>It is better to view this problem from data integrity perspective rather than threads. Because your application could run in a cluster (if not now, maybe later). There could be other users updating same table, from other applications.</p>\n<p>The solution depends on the level of contention(the number of threads trying to update the same database table).</p>\n<p>If there is high contention, use pessimistic locking. Refer <a href=\"https://www.baeldung.com/jpa-pessimistic-locking\" rel=\"nofollow noreferrer\">pessimistic locking</a></p>\n<p>If there is low contention, use optimistic locking. Refer <a href=\"https://www.baeldung.com/jpa-optimistic-locking\" rel=\"nofollow noreferrer\">optimistic locking</a></p>\n"}],"owner":{"user_id":11220219,"display_name":"Siva Sai kiran"},"view_count":60,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1676251029,"question_id":75431201,"body":"<p>I have a java class ,which has two methods .These methods will be called one after the other. These methods are making rest calls to different services. After getting data from rest call ,i'm updating multiple tables and some of the tables will be updated by both methods. My task is to implement multithreading to run both methods simultaneously but avoid threads to override data while they are updating the same table. What are the different ways to do it and how can i do it effectively in java8.</p>\n"},{"tags":["java","cpu-usage"],"answers":[{"owner":{"user_id":21197077,"display_name":"gneginskiy"},"up_vote_count":1,"is_accepted":false,"creation_date":1676206263,"answer_id":75427102,"body":"<p>Good one.</p>\n<p>On my machine (macos 13.2) jdk 17.06 demonstrates the same behaviour.\nIt does seem to be an implementation detail .</p>\n<p>please see the code by the link below:\n<a href=\"https://github.com/openjdk/jdk/blob/master/src/jdk.management/macosx/native/libmanagement_ext/UnixOperatingSystem.c\" rel=\"nofollow noreferrer\">https://github.com/openjdk/jdk/blob/master/src/jdk.management/macosx/native/libmanagement_ext/UnixOperatingSystem.c</a></p>\n<pre><code>    if (last_used == 0 || last_total == 0) {\n        // First call, just set the last values\n        last_used  = used;\n        last_total = total;\n        // return 0 since we have no data, not -1 which indicates error\n        return 0;\n    }\n</code></pre>\n<p>it's a bummer though, that they didn't specify this in the docs.</p>\n"}],"owner":{"user_id":3741571,"display_name":"chenzhongpu"},"view_count":82,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1676201064,"question_id":75426631,"body":"<p>I tried to get current CPU load:</p>\n<pre class=\"lang-java prettyprint-override\"><code>while (true) {\n     OperatingSystemMXBean os = (OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();\n     System.out.println(&quot;CPU Load: &quot; + os.getCpuLoad() * 100 + &quot;%&quot;);\n}\n</code></pre>\n<p>To my surprise, it is always 0! Note that in the mean time, I am running <code>stress --cpu 4</code>, and therefore the actual CPU load is around 20%. I checked out the JDK doc:</p>\n<blockquote>\n<p>Returns the &quot;recent cpu usage&quot; for the operating environment.</p>\n</blockquote>\n<p>However, if I add <code>Thread.sleep(1000)</code> inside the <code>while</code> loop, then the result is expected. It seems that <strong>some time gaps are required between calling <code>getCpuLoad()</code></strong> because it needs to collect some system statics in that interval.</p>\n<hr />\n<p>I also tried to print the CPU load after the sleeping (without any loop, only twice of printing):</p>\n<pre class=\"lang-java prettyprint-override\"><code>Thread.sleep(1000);\nOperatingSystemMXBean os = (OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();\nThread.sleep(1000);\nSystem.out.println(os.getCpuLoad() * 100 + &quot;%&quot;); // still always 0%\nThread.sleep(1000);\nSystem.out.println(os.getCpuLoad() * 100 + &quot;%&quot;); // about 20%\n</code></pre>\n<p>The result shows that the first calling of <code>getCpuLoad()</code> will always return 0. I think it is really confusing.</p>\n<p>Is it a pitfall of JDK's implementation? Why does not JDK doc add warnings about its usage?</p>\n<hr />\n<p>My settings:</p>\n<ul>\n<li>OS: 5.15.91-1-MANJARO</li>\n<li>JDK: openjdk 17.0.6 2023-01-17 LTS</li>\n</ul>\n"},{"tags":["java","parsing","antlr","antlr4"],"answers":[{"owner":{"user_id":50476,"display_name":"Bart Kiers"},"up_vote_count":1,"is_accepted":true,"creation_date":1676446978,"answer_id":75456758,"body":"<p>There is no way to tell up front which parser rule(s) are going to be invoked for a given input source.</p>\n<p>Since a visitor will not cause the entire parse tree to be visited (you determine that by overriding only the method you wish to visit), you could start off by writing a visitor that can be used up until the rule that contains the <code>(child1 | child2)</code> and inside that <code>visit...</code> method, invoke the specific listener.</p>\n<p>That could look something like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>class MainVisitor extends MainLangFileBaseVisitor&lt;Object&gt; {\n\n    @Override\n    public Object visitParse(MainLangFileParser.ParseContext ctx) {\n\n        if (ctx.child1() != null) {\n            ParseTreeWalker.DEFAULT.walk(new Child1Listener(), ctx);\n        }\n        else {\n            ParseTreeWalker.DEFAULT.walk(new Child2Listener(), ctx);\n        }\n\n        return null;\n    }\n}\n\nclass Child1Listener extends Child1LangFileBaseListener {\n    // ...\n}\n\nclass Child2Listener extends Child2LangFileBaseListener {\n    // ...\n}\n</code></pre>\n"}],"owner":{"user_id":7054753,"display_name":"Foreign"},"view_count":77,"up_vote_count":2,"accepted_answer_id":75456758,"answer_count":1,"score":2,"creation_date":1676069961,"question_id":75416884,"body":"<p><strong>MainLangFile.g4</strong></p>\n<pre><code>grammar MainLangFile;\n\nimport Child1LangFile, Child2LangFile;\n\nparse:\n    A (child1 | child2) EOF\n;\n\nA: 'A';\nB: 'B';\nC: 'C';\n</code></pre>\n<p><strong>Child1LangFile.g4</strong></p>\n<pre><code>grammar Child1LangFile;\n\nchild1:\n    CHILD1\n;\n\nCHILD1: 'CHILD1';\n</code></pre>\n<p><strong>Child2LangFile.g4</strong></p>\n<pre><code>grammar Child2LangFile;\n\nchild2:\n    CHILD2\n;\n\nCHILD2: 'CHILD2';\n</code></pre>\n<p><strong>My Java application:</strong></p>\n<pre><code>public static class MyApp {\n\n    public void execute(String query) {\n\n        MainLangFileLexer lexer = new MainLangFileLexer(CharStreams.fromString(query));\n        MainLangFileParser parser = new MainLangFileParser(new CommonTokenStream(lexer));\n        MainLangFileParser.ParseContext parse = parser.parse();\n\n        ParseTreeWalker walker = new ParseTreeWalker();\n        walker.walk(new Child1Listener(), parse);\n        walker.walk(new Child2Listener(), parse);\n    }\n\n    static class Child1Listener extends MainLangFileBaseListener {\n\n        @Override\n        public void enterChild1(MainLangFileParser.Child1Context ctx) {\n        }\n    }\n\n\n    static class Child2Listener extends MainLangFileBaseListener {\n\n        @Override\n        public void enterChild2(MainLangFileParser.Child2Context ctx) {\n        }\n    }\n}\n</code></pre>\n<p>I'm trying to have a multi-grammar structure. The solution I've above works perfectly in the sense that each <code>ChildXListener</code> is properly invoked based on the query. It would be the same as just having a single listener and implementing both methods.</p>\n<p>The issue begins where there is a <code>enterCommon()</code> method invoked, it is invoked for both listeners even though I &quot;forked&quot; the language and went only on one specific direction.</p>\n<p>I need a clever way of selecting which listener should be used by <code>ParseTreeWalker</code>.</p>\n<p>Also, I'd rather have each listener, extending their respective grammars, i.e.: <code>Child1Listener</code> should extends <code>Child1LangFileBaseListener</code>, by doing so I have a clear scope of what methods I can safely override as only <code>Child1LangFile.g4</code> rules will be available.</p>\n<p>I couldn't figure out a way of doing this without initializing <code>Child1Lexer</code>, <code>Child1Parser</code> and parsing everything again, either way, this brings me back to the previous issue, how do I know which lexer/parser to use?</p>\n<p>Any thoughts? Thanks in advance.</p>\n"},{"tags":["java","arrays","sorting","arraylist","indexing"],"comments":[{"owner":{"user_id":17795888,"display_name":"Chaosfire"},"edited":false,"comment_id":133066391,"body":"Don&#39;t print in the loop. Use <code>int</code> to store the index with matching value. Use special value for it meaning <b>not found</b>. Print message after the loop depending on the value stored."}],"answers":[{"owner":{"user_id":20766340,"display_name":"Amin Mousavi"},"up_vote_count":1,"is_accepted":true,"creation_date":1676286621,"answer_id":75435053,"body":"<pre class=\"lang-java prettyprint-override\"><code>import java.util.Scanner;\n\npublic class IndexWasNotFound {\n\n    public static void main(String[] args) {\n        Scanner scanner = new Scanner(System.in);\n        int[] array = new int[10];\n        array[0] = 6;\n        array[1] = 2;\n        array[2] = 8;\n        array[3] = 1;\n        array[4] = 3;\n        array[5] = 0;\n        array[6] = 9;\n        array[7] = 7;\n\n        int index = 0;\n        String ans = null;\n        boolean yn;\n        System.out.print(&quot;Search for? &quot;);\n        int searching = scanner.nextInt();\n\n        for(int i=0; i&lt;array.length; i++) {\n            if (searching == array[i]) {\n                index = i;\n                ans = searching + &quot; is at index &quot; + index + &quot;.&quot;;\n                yn = true;\n                break;\n            } else {\n                ans = searching + &quot; was not found.&quot;;\n                yn = false;\n            }\n        }\n        System.out.println(ans);\n    }\n}\n</code></pre>\n"}],"owner":{"user_id":20766340,"display_name":"Amin Mousavi"},"view_count":32,"up_vote_count":2,"accepted_answer_id":75435053,"answer_count":1,"score":2,"creation_date":1676050773,"question_id":75414437,"body":"<p>I write a program that has a list of numbers. You need to add code to find a specific number in the list. If the number is found, the program will show its location. If the number is not found, the program will say that it couldn't be found.</p>\n<p>The problem is, the output is looping, and I don't want that.</p>\n<pre class=\"lang-java prettyprint-override\"><code>int[] array = new int[10];\narray[0] = 6;\narray[1] = 2;\narray[2] = 8;\narray[3] = 1;\narray[4] = 3;\narray[5] = 0;\narray[6] = 9;\narray[7] = 7;\n\nSystem.out.print(&quot;Search for? &quot;);\nint searching = in.nextInt();\n\nfor(int i=0; i&lt;array.length; i++){\n    if(searching == array[i]){\n        System.out.println(searching + &quot; is at index &quot; + i + &quot;.&quot;);\n        break;\n    }\n    else{\n        System.out.println(searching + &quot; was not found.&quot;);\n    }\n}\n</code></pre>\n<p>My output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>Search for? 1\n1 was not found.\n1 was not found.\n1 was not found.\n1 is at index 3.\n</code></pre>\n<p>Expected output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>1 is at index 3.\n</code></pre>\n"},{"tags":["java","maven","security","digital-signature","hardware-security-module"],"comments":[{"owner":{"user_id":53897,"display_name":"Thorbj&#248;rn Ravn Andersen"},"edited":false,"comment_id":133065159,"body":"You may want to explain what an HSM is and why you need to do it this way."},{"owner":{"user_id":296328,"display_name":"khmarbaise"},"edited":false,"comment_id":133065251,"body":"@Thorbj&#248;rnRavnAndersen Thanks I wanted to ask the same question.."}],"answers":[{"owner":{"user_id":8334991,"display_name":"Alexandre Fenyo"},"up_vote_count":1,"is_accepted":true,"creation_date":1676800600,"answer_id":75499278,"body":"<p>The signature process you are talking about is done when calling <code>scripts/sign-gui.ps1 -input target/library.jar -output target/signature.asc</code>. So this is this powershell script that you need to update.</p>\n<p>Signing an artifact on Maven Central means using an asymmetric key among those supported by GPG (RSA, DSA, ...) that is a PGP <strong>primary</strong> key. For the GPG software to sign files using an asymmetric key that is provided by a HSM, you need to use the PKCS#11 library that is provided with you HSM: most HSM implement the PKCS#11 API by delivering a PKCS#11 library that offers remote cryptographic services from the HSM.</p>\n<p>When GPG does not know about the private or secret keys, it is using a daemon to perform cryptographic operations: scd (smart card daemon). This has been initially introduced in GPG to use locally connected smart cards readers, not for network HSM. But in your case, the key is stored inside a HSM and must not leave it, not inside a smart card, so you need to have a specially designed GPG daemon that is acting as a gateway between GPG and the HSM, using the PKCS#11 library that comes with your HSM: gnupg-pkcs11-scd (<a href=\"https://github.com/alonbl/gnupg-pkcs11-scd\" rel=\"nofollow noreferrer\">https://github.com/alonbl/gnupg-pkcs11-scd</a>) does the job. The network protocol between the library and the HSM is proprietary, but the library offers a fully specified standard cryptographic API with standard bindings in C and Java.</p>\n<p>Therefore you need to install the PKCS#11 library and configure it to talk to your HSM (you will have to create a X.509 certificate for mutual authentication, or a secret for login/password authentication, depending on your HSM). After that, you need to install the gnupg-pkcs11-scd daemon to offer cryptographic services to GPG using the PKCS#11 library. Finally, you need to configure GPG to talk the the daemon.</p>\n<p>Once all of those steps are done, you need to use GPG to create a GPG key that is able to be used with Maven Central. This is a special GPG key set that contains only a <strong>primary</strong> key to sign the binaries. This is very specific to Maven Central, see why and how to do that here: <a href=\"https://central.sonatype.org/publish/requirements/gpg/\" rel=\"nofollow noreferrer\">https://central.sonatype.org/publish/requirements/gpg/</a></p>\n<p>Finally, integrate into your powershell script the call to GPG to sign the binary with the primary asymmetric key.</p>\n<p>But since you are using a powershell script, I'm considering you want to do this on Windows. Note that you may encounter difficulties with this environment to install the aforementioned daemon that acts as a gateway between GPG and the PKCS#11 library. In this case, you may try to do all of that on a Linux host, this may be easier. When done, consider a migration back to Windows using a WSL2 environment: everything including the daemon are doing userland operations without requiring external devices, all of this may work correctly on a WSL2 environment.</p>\n"}],"owner":{"user_id":27342,"display_name":"ralien"},"view_count":70,"up_vote_count":2,"accepted_answer_id":75499278,"answer_count":1,"score":2,"creation_date":1676046675,"question_id":75413742,"body":"<p>My objective is to publish a library on Maven Central, while using a Hardware Security Module (HSM, explanation below) to sign the binary. The documentation I found explains how to use <code>maven-gpg-plugin</code>, but this requires the plugin to handle the key and its passphrase, whereas in my case the key is inside the HSM, and <em>cannot</em> leave it.</p>\n<p>To illustrate what I mean, here is a simplified draft of my <a href=\"https://github.com/ralienpp/cmp-ra-component/blob/sign-logic/.github/workflows/build-sign-publish.yml\" rel=\"nofollow noreferrer\">Github CI pipeline</a>:</p>\n<ul>\n<li>The <code>build</code> job produces the Jar and uploads it for subsequent reuse.</li>\n<li>The <code>sign</code> job runs on a <em>self-hosted</em> runner, it downloads the previously stored artifact, runs a graphical interface (implemented in <code>sign-gui.ps1</code>) which is responsible for the human-guided process of signing (e.g., the human connects the computer to a secure network, where the HSM is accessible, types the PIN for accessing the key; an alternative process could be to plug a smart-card into a reader and type the PIN, etc.)</li>\n</ul>\n<pre><code>jobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Set up JDK 11\n        uses: actions/setup-java@v3\n        with:\n          java-version: '11'\n          distribution: 'temurin'\n          cache: maven\n\n      - name: Build the jar\n        run: mvn package -DskipTests\n\n      - name: Upload jar for subsequent reuse by signer\n        uses: actions/upload-artifact@v3\n        with:\n          name: compiled-jar\n          path: target/library.jar\n\n  sign:\n    needs: build\n    runs-on: self-hosted\n    steps:\n      - uses: actions/checkout@v3\n      - uses: actions/download-artifact@v3\n        with:\n          name: compiled-jar\n          path: target\n\n      - name: Process retrieved files\n        run: scripts/sign-gui.ps1 -input target/library.jar -output target/signature.asc\n\n</code></pre>\n<p>In the end I have a <code>library.jar</code> and <code>signature.asc</code> (the detached armored GPG signature). The next step is to feed them into Maven Central, but the available tooling seems to be shaped around the &quot;maven-gpg-plugin signs it and takes care of everything&quot; paradigm. I was unable to find a way to tell Maven that it should take the signature produced by an external program, and then go on with the rest of its publishing logic. <em>Is this possible with <code>maven-gpg-plugin</code>, in principle?</em> If not, what alternatives are there?</p>\n<p>Having explored various open source projects, I found many CI pipelines that have the signing keys <em>and</em> the passphrases to them - thus the key isn't really private. If anyone could point me to repositories that take a different approach, I would greatly appreciate it.</p>\n<p>Note: an HSM is a physical device designed to securely store keys and perform operations (e.g., sign, encrypt) with them, without exposing the keys themselves. The keys are generated by the device and held internally in a secure way, to prevent one from making copies of them. The reason for this is to avoid <a href=\"https://nakedsecurity.sophos.com/2023/01/31/github-code-signing-certificates-stolen-but-will-be-revoked-this-week/\" rel=\"nofollow noreferrer\">incidents</a> in which someone can steal keys and potentially release their own binaries with your signature on them.</p>\n"},{"tags":["java","numbers","calculator","number-formatting"],"comments":[{"owner":{"user_id":6073886,"display_name":"OH GOD SPIDERS"},"edited":false,"comment_id":133062601,"body":"So do you want the user to be able to enter &quot;1k&quot; and have that translate to the int value 1000 internally?"},{"owner":{"user_id":14442758,"display_name":"Z-100"},"edited":false,"comment_id":133062722,"body":"If what @OHGODSPIDERS said is true, just check the string for k&#39;s and replace them. A pretty easy solution, but it can also be exploited as easily. To improve on this you could set the max k-count to 1 and always check for it to be at the last position in the string."},{"owner":{"user_id":21187677,"display_name":"sartep"},"edited":false,"comment_id":133062800,"body":"No, if for ex. user enters &quot;abc&quot;, I get = Exception in thread &quot;main&quot; java.util.InputMismatchException \tat java.base/java.util.Scanner.throwFor(Scanner.java:943) \tat java.base/java.util.Scanner.next(Scanner.java:1598) \tat java.base/java.util.Scanner.nextInt(Scanner.java:2263) \tat java.base/java.util.Scanner.nextInt(Scanner.java:2217) \tat com.petras.Main.main(Main.java:20)                                                                                   But I want to get the line &quot;Please enter valid number&quot; //not letter and let him put the number again, how should my code look?"}],"answers":[{"owner":{"user_id":200136,"display_name":"Andrew McGuinness"},"up_vote_count":1,"is_accepted":false,"creation_date":1676040463,"answer_id":75412633,"body":"<p>The simplest way to do what you want is to wrap the inside of your loop in a try {} block and <strong>catch</strong> the InputMismatchException</p>\n<p>If the input is an int it will process as it does now; if not then instead of carrying on after the Scanner.nextInt() line, java will execute the contents of your catch(InputMismatchException e) { } block</p>\n<p>There's an argument that you should validate the input more explicitly, but that will be more complex and for a beginner learning how to catch exceptions is probably more useful.</p>\n<pre><code>while (true) {\n    try {\n        principal = scanner.nextInt();\n        if (principal &gt;= 1000 &amp;&amp; principal &lt;= 1_000_000)\n            break;\n        System.out.println(&quot;Enter a value between 1k - 1m&quot;);\n    }\n    catch (InputMismatchException e) {\n        System.out.println(&quot;Please enter numbers&quot;);\n    }\n}\n</code></pre>\n"},{"owner":{"user_id":2851311,"display_name":"hfontanez"},"up_vote_count":0,"is_accepted":false,"creation_date":1676040853,"answer_id":75412697,"body":"<p>From the comments, the OP replied:</p>\n<blockquote>\n<p>No, if for ex. user enters &quot;abc&quot;, I get = <code>Exception in thread &quot;main&quot; java.util.InputMismatchException at java.base/java.util.Scanner.throwFor(Scanner.java:943) at java.base/java.util.Scanner.next(Scanner.java:1598) at java.base/java.util.Scanner.nextInt(Scanner.java:2263) at java.base/java.util.Scanner.nextInt(Scanner.java:2217) at com.petras.Main.main(Main.java:20)</code>\nBut I want to get the line &quot;<em>Please enter valid number</em>&quot; //not letter and let him put the number again, how should my code look?</p>\n</blockquote>\n<p>The problem is that your code assumes the user will always enter a valid integer value. Instead, as your comment reply indicates, you have to account for invalid inputs by wrapping <code>scanner.nextInt()</code> in a try/catch block</p>\n<pre><code>Scanner scanner = new Scanner(System.in);\n\nSystem.out.print(&quot;Enter Principal Amount (1k to 1m) &quot;) ;\nint principal = 0;\nwhile (true) {\n  try {\n    principal = scanner.nextInt();\n  } catch(InputMismatchException ime) {\n    System.out.println(&quot;Invalid input: &quot; + principal + &quot;. Please enter an integer value&quot;);\n    continue;\n  } catch (Exception e) {\n    // This is most likely a &quot;true&quot; error. Handle accordingly.\n  }\n  if (principal &gt;= 1000 &amp;&amp; principal &lt;= 1_000_000)\n    break;\n  System.out.println(&quot;Enter a value between 1k - 1m&quot;);\n}\n</code></pre>\n"}],"owner":{"user_id":21187677,"display_name":"sartep"},"view_count":48,"up_vote_count":3,"answer_count":2,"score":2,"creation_date":1676039075,"question_id":75412414,"body":"<p>we have this method</p>\n<pre><code> System.out.print(&quot;Enter Principal Amount (1k to 1m) &quot;) ;\n        while (true) {\n            principal = scanner.nextInt();\n            if (principal &gt;= 1000 &amp;&amp; principal &lt;= 1_000_000)\n                break;\n            System.out.println(&quot;Enter a value between 1k - 1m&quot;);\n</code></pre>\n<p>If person puts in letters instead of numbers the error occurs,\nI need to get the program to ask the question to put in numbers instead of letter</p>\n<pre><code> Scanner scanner = new Scanner(System.in);\n\n        System.out.print(&quot;Enter Principal Amount (1k to 1m) &quot;) ;\n        while (true) {\n            principal = scanner.nextInt();\n           // if (scanner.nextInt() != NumberFormat??) What should I write in my mortgage calculator that -&gt;\n            //  --&gt; if numbers are not put (for ex. letters) it would print out (&quot;Please enter numbers letters are invalid&quot;)\n            //System.out.println(&quot;Please enter numbers&quot;);\n            if (principal &gt;= 1000 &amp;&amp; principal &lt;= 1_000_000)\n                break;\n            System.out.println(&quot;Enter a value between 1k - 1m&quot;);\n        }\n</code></pre>\n"},{"tags":["java","opencv","image-processing"],"answers":[{"owner":{"user_id":4926757,"display_name":"Rotem"},"up_vote_count":1,"is_accepted":true,"creation_date":1676068632,"answer_id":75416755,"body":"<p>Here is a <a href=\"https://stackoverflow.com/q/4063965/4926757\">nice solution</a> implemented in MATLAB.<br />\nHere is <a href=\"https://stackoverflow.com/a/71542681/4926757\">my answer</a> using Python and OpenCV (translation of the original MATLAB code).<br />\nIn JAVA there are no vectorized matrix operations, so the solution relies on OpenCV.</p>\n<p>Since the solution is based on the Python implementation, it finds all the non-red pixels (instead of finding the red pixels).<br />\nThe HSV ranges of the non-red pixels are taken from the original solution:</p>\n<pre><code>int minHue = 21;\nint maxHue = 169; //340/2-1\n</code></pre>\n<p>Saturation and Value includes the full range of [0, 255].</p>\n<hr />\n<p>Important modification from your posted code:</p>\n<p><code>grey</code> image should be in BGR (3 channels) format before using <code>grey.copyTo(result, mask)</code>, because the destination image <code>result</code> has 3 color channels.</p>\n<p>We may convert grey to BGR, and than using <code>copyTo</code>:</p>\n<pre><code>Mat grey_as_bgr = new Mat();\nImgproc.cvtColor(grey, grey_as_bgr, Imgproc.COLOR_GRAY2BGR); //Convert from Gray to BGR where R=G=B (we need 3 color channels).\ngrey_as_bgr.copyTo(result, mask);\n</code></pre>\n<hr />\n<p>JAVA code sample:</p>\n<pre><code>package myproject;\n\nimport org.opencv.core.Core;\nimport org.opencv.core.Mat;\nimport org.opencv.core.Scalar;\nimport org.opencv.imgproc.Imgproc;\nimport org.opencv.imgcodecs.Imgcodecs;\n\nclass Sample {\n\nstatic { System.loadLibrary(Core.NATIVE_LIBRARY_NAME); }\n     \npublic static void main(String[] args) {\n    //The following JAVA code is partly based on the following Python and OpenCV code:\n    //Python code (my answer): https://stackoverflow.com/a/71542681/4926757\n    //The Python code is a conversion from the original MATLAB code:\n    //Original MATLAB code: https://stackoverflow.com/questions/4063965/how-can-i-convert-an-rgb-image-to-grayscale-but-keep-one-color\n \n    Mat image = Imgcodecs.imread(&quot;src/playground/input.png&quot;);  //Read input image //img = cv2.imread('src/playground/input.png')\n    Mat hsv = new Mat();\n    Imgproc.cvtColor(image, hsv, Imgproc.COLOR_BGR2HSV); //Convert the image to HSV color space. //hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)\n    \n    //Instead of finding red pixels, find all the non-red pixels.\n    //Note: in OpenCV hue range is [0,179]) The original MATLAB code is 360.*hsvImage(:, :, 1), when hue range is [0, 1].\n    int minHue = 21;  //non_red_idx = (h &gt; 20//2) &amp; (h &lt; 340//2)  # Select &quot;non-red&quot; pixels (divide the original MATLAB values by 2 due to the range differences).\n    int maxHue = 169; //340/2-1;\n    int minSaturation = 0;\n    int maxSaturation = 255;\n    int minValue = 0;\n    int maxValue = 255;    \n    \n    //Create a mask of all non-red pixels\n    Mat mask = new Mat();\n    Core.inRange(hsv, new Scalar(minHue, minSaturation, minValue), new Scalar(maxHue, maxSaturation, maxValue), mask);\n    \n    Mat grey = new Mat();\n    Mat grey_as_bgr = new Mat();\n    Imgproc.cvtColor(image, grey, Imgproc.COLOR_BGR2GRAY); //Convert image from BGR to Grey\n    Imgproc.cvtColor(grey, grey_as_bgr, Imgproc.COLOR_GRAY2BGR); //Convert from Gray to BGR where R=G=B (we need 3 color channels).\n    \n    Mat result = image.clone();  //Clone image, and store in result\n        \n    grey_as_bgr.copyTo(result, mask);  //Copy the non-red pixels from grey_as_bgr to result (the red pixels are kept unmodified).\n    \n    Imgcodecs.imwrite(&quot;src/playground/output.png&quot;, result); //Save the result\n}\n\n}\n</code></pre>\n<hr />\n<p>Output:<br />\n<a href=\"https://i.stack.imgur.com/fsgHA.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fsgHA.jpg\" alt=\"enter image description here\" /></a></p>\n"}],"owner":{"user_id":9103039,"display_name":"Starnec"},"view_count":116,"up_vote_count":2,"accepted_answer_id":75416755,"answer_count":1,"score":2,"creation_date":1676035086,"question_id":75411682,"body":"<p>I have the following class:</p>\n<pre><code>    public class ThresholdHSV {\n    static {\n        System.loadLibrary(Core.NATIVE_LIBRARY_NAME);\n    }\n\n    public static void main(String[] args) {\n        Mat image = Imgcodecs.imread(&quot;src/playground/input.png&quot;);\n        Mat hsv = new Mat();\n        Imgproc.cvtColor(image, hsv, COLOR_BGR2HSV);\n\n        int minHue = 168;\n        int maxHue = 180;\n        int minSaturation = 130;\n        int maxSaturation = 220;\n        int minValue = 120;\n        int maxValue = 220;\n\n        Mat mask = new Mat();\n        Core.inRange(hsv, new Scalar(minHue, minSaturation, minValue), new Scalar(maxHue, maxSaturation, maxValue), mask);\n\n        Mat grey = new Mat();\n        Imgproc.cvtColor(image, grey, COLOR_BGR2GRAY);\n\n        Mat result = new Mat();\n        grey.copyTo(result, mask);\n        image.copyTo(result, mask);\n\n        Imgcodecs.imwrite(&quot;src/playground/output.png&quot;, result);\n    }\n}\n</code></pre>\n<p>I would like to keep all the pixels of the image that have <strong>HSV</strong> values between the <em><strong>min</strong></em> and <em><strong>max</strong></em> provided values and set the rest to <strong>greyScale</strong>. To do so I am using <strong>OpenCV</strong>, I was able to keep all the <strong>pixels</strong> within the defined <strong>ranges</strong>, but the rest are all set to <strong>black</strong>.</p>\n<p>Here is what it looks like :</p>\n<p>Before:</p>\n<p><a href=\"https://i.stack.imgur.com/Vt2N9.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Vt2N9.jpg\" alt=\"enter image description here\" /></a></p>\n<p>And here is after executing the <em><strong>main</strong></em> <strong>method</strong> :</p>\n<p><a href=\"https://i.stack.imgur.com/b0TJk.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/b0TJk.png\" alt=\"enter image description here\" /></a></p>\n<p>This is a <a href=\"https://stackoverflow.com/questions/73680479/how-make-color-isolation-effect-like-in-photoshop-with-java\">link</a> to a question I posted before containing images of the result I want to achieve, where I used <strong>brute-force-image-processing</strong>.</p>\n<p>Why am I getting the rest of the pixels in black, and how to correct it?</p>\n"},{"tags":["java","go","mocking","microservices","bdd"],"comments":[{"owner":{"user_id":561422,"display_name":"marco.m"},"edited":false,"comment_id":133068253,"body":"It seems you already have a test setup with the real service B. Why do you want to mock it?"},{"owner":{"user_id":10520275,"display_name":"LukasDeco"},"edited":false,"comment_id":133076331,"body":"Are you creating an interface for Service B? You can mock the interface."},{"owner":{"user_id":11338512,"display_name":"Ranjan"},"edited":false,"comment_id":133083989,"body":"@macro.m thanks for replying, yes currently all the service are in the same VM, but running BDD the component-integration testing now we are looking at the component testing so that it wont be dependent on the service-B."},{"owner":{"user_id":11338512,"display_name":"Ranjan"},"edited":false,"comment_id":133084044,"body":"@LukasDeco thanks. There are no interface for service-B"},{"owner":{"user_id":10520275,"display_name":"LukasDeco"},"edited":false,"comment_id":133154046,"body":"@Ranjan you could create an interface though to wrap all the external calls and then mock that."}],"answers":[{"owner":{"user_id":363592,"display_name":"Lunivore"},"up_vote_count":1,"is_accepted":true,"creation_date":1676145913,"answer_id":75422987,"body":"<p>If your Service A is calling Service B internally, rather than via web or RPC, then you can use dependency injection to inject a &quot;fake&quot; version of your Service B. (Note that this doesn't necessarily involve a dependency injection framework; constructor-based and property-based injection are also valid). If Service B has no interface, extract one and use a thin adapter to call the real service or fake depending on environment.</p>\n<p>You won't need to change your scenarios as long as they are only interacting with Service A's user interface or API.</p>\n<p>You will need to change the way the build pipeline works, so that it deploys with your fake instead of the real code.</p>\n<p>You can even do this at runtime, switching over from the fake to the real thing by having the adapter call the relevant service. The switch or deployment can be triggered by environment variables or by build arguments.</p>\n<p>Be careful not to deploy your test service to production though!</p>\n<p>If you're using continuous deployment, then the last step in the build pipeline should ideally deploy and test interaction with the real service. If for some reason that's the only way you can work, there are still a couple of things you can do that might help:</p>\n<ul>\n<li><p>You can stub the data that Service B uses, so that it behaves in a predictable way</p>\n</li>\n<li><p>You can use a test instance. Reach out to your service provider and see if they have one for you. I recommend that you should still check that deployment of the real service succeeds, ideally with an automated test of some sort, even if that has to be run in production. It only needs to be a basic smoke test to check that the system is wired up. Note that the easier it is to deploy, the easier it will be to recover from any mistakes; if you can't deploy quickly then you will need to be more thorough in your checking.</p>\n</li>\n</ul>\n<p>If the RPM is created and deployed without any kind of fake or test instance, and you have no way to configure the environment to use such a fake or test instance, then you will not be able to mock it out. The build pipeline has to be a part of deploying a fake. That won't be a problem if you have control over your CI pipeline; otherwise reach out to your build team. They may have experience or be able to point you to someone else who can help you. Great BDD is driven by conversations, after all!</p>\n"}],"owner":{"user_id":11338512,"display_name":"Ranjan"},"view_count":68,"up_vote_count":2,"accepted_answer_id":75422987,"answer_count":1,"score":2,"creation_date":1676023442,"question_id":75409545,"body":"<p>I recently started looking into BDD(using Gherkin + Restassured). Need to mock third party servicd, below is my use case.</p>\n<ol>\n<li>Service-A internally calls Service-B</li>\n<li>The application is in goLang.</li>\n<li>The BDD are in Java.</li>\n</ol>\n<p>We have a CI pipeline running along, where it generates the rpm and deploys the rpm into VM.\nOn that VM we are running the BDD(Currently Service-A and Service-B are deployed on the same VM)</p>\n<p>Is ther a way i can mock the Service-B, so that i dont have to be dependent on Service-B? If yes what would be the best approach here.</p>\n<p>Have tried goLang httptest to mock the service at the unit-test level.\nBut how the mocking can be done after rpm gets created in pipeline with BDD in place.</p>\n<p>Thanks</p>\n"},{"tags":["java","angular","algorithm","aes","cbc-mode"],"answers":[{"owner":{"user_id":14016187,"display_name":"Antoine Dargouge"},"up_vote_count":0,"is_accepted":false,"creation_date":1676022693,"answer_id":75409381,"body":"<p>I finaly find a post who sayd they pkcs5 in java are the same as pkcs7 in angular\n--&gt;padding (128)</p>\n<p>source:\n<a href=\"https://crypto.stackexchange.com/questions/9043/what-is-the-difference-between-pkcs5-padding-and-pkcs7-padding\">https://crypto.stackexchange.com/questions/9043/what-is-the-difference-between-pkcs5-padding-and-pkcs7-padding</a></p>\n"},{"owner":{"user_id":20165976,"display_name":"Manali Lakhani"},"up_vote_count":1,"is_accepted":true,"creation_date":1676026593,"answer_id":75410149,"body":"<p>As per your code seems like, There is a issue with your PBEKeySpec and key length specification.\n<strong>JAVA</strong>: you must need to use &quot;AES/CBC/PKCS5Padding&quot; instead of &quot;AES/CBC/PKCS7Padding&quot;\n<strong>Angular</strong>: Make changes on key length and PBEKeySpec\nlet encrypted = CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(&quot;hasan test&quot;), key,\n{\nkeySize: 16,\niv: iv,\nmode: CryptoJS.mode.CBC,\npadding: CryptoJS.pad.Pkcs7\n}).toString();</p>\n"}],"owner":{"user_id":14016187,"display_name":"Antoine Dargouge"},"view_count":75,"up_vote_count":2,"accepted_answer_id":75410149,"answer_count":2,"score":2,"creation_date":1676019388,"question_id":75408841,"body":"<p>I have written this code in Angular to encrypt a string:</p>\n<pre><code>import { Injectable } from '@angular/core';\nimport * as CryptoJS from 'crypto-js';\n\n@Injectable({\n    providedIn: 'root',\n  })\nexport class CryptoService {\n  \n  encrypt(message: string, clef: string): string {\n\n    const salt = CryptoJS.SHA256(&quot;123456789123&quot;);\n\n    const key = CryptoJS.PBKDF2(clef, salt, {\n      keySize: 128 / 32,\n      iterations: 1000\n  });\n\n    // var key = CryptoJS.enc.Utf8.parse(clef);\n    let iv = CryptoJS.enc.Utf8.parse(clef);\n    let encrypted = CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(message.toString()), key,\n    {\n        keySize: 128 / 8,\n        iv: iv,\n        mode: CryptoJS.mode.CBC,\n        padding: CryptoJS.pad.Pkcs7\n    });\n\n\n    // var encryptedMessage = CryptoJS.AES.encrypt(message.trim(), key).toString();\n\n    return encrypted.toString();\n  }\n\n  generateKey(): string {\n      let result = '';\n      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n      const charactersLength = characters.length;\n      let counter = 0;\n      while (counter &lt; 16) {\n      result += characters.charAt(Math.floor(Math.random() * charactersLength));\n      counter += 1;\n      }\n      return result;\n  }\n}\n</code></pre>\n<p>I transfer my key and encriptedMessage to the back for the decryption.</p>\n<p>I code dat on java:</p>\n<pre><code>import java.security.InvalidAlgorithmParameterException;\nimport java.security.InvalidKeyException;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.spec.InvalidKeySpecException;\nimport java.security.spec.KeySpec;\nimport java.util.Base64;\n\nimport javax.crypto.BadPaddingException;\nimport javax.crypto.Cipher;\nimport javax.crypto.IllegalBlockSizeException;\nimport javax.crypto.NoSuchPaddingException;\nimport javax.crypto.SecretKey;\nimport javax.crypto.SecretKeyFactory;\nimport javax.crypto.spec.IvParameterSpec;\nimport javax.crypto.spec.PBEKeySpec;\n\npublic class AESUtilService {\n    \n    protected static final String salt = &quot;123456789123&quot;;\n    \n    public SecretKey getKeyFromPassword(String password)\n        throws NoSuchAlgorithmException, InvalidKeySpecException {\n        \n        SecretKeyFactory factory = SecretKeyFactory.getInstance(&quot;PBKDF2WithHmacSHA256&quot;);\n        KeySpec spec = new PBEKeySpec(password.toCharArray(), salt.getBytes(), 1000, 128/32);\n        SecretKey secret = factory.generateSecret(spec);\n        return secret;\n    }\n    public String decrypt(String cipherText, SecretKey key)\n        throws NoSuchPaddingException, NoSuchAlgorithmException,\n        InvalidAlgorithmParameterException, InvalidKeyException,\n        BadPaddingException, IllegalBlockSizeException {\n            \n        String algorithm = &quot;AES/CBC/PKCS7Padding&quot;;\n        IvParameterSpec iv = new IvParameterSpec(&quot;MnTQLHcWumIKTXpQ&quot;.getBytes());\n        \n        Cipher cipher = Cipher.getInstance(algorithm);\n        cipher.init(Cipher.DECRYPT_MODE, key, iv);\n        byte[] plainText = cipher.doFinal(Base64.getDecoder().decode(cipherText));\n        return new String(plainText);\n    }\n    \n}\n</code></pre>\n<p>My issue is the following.\nThe part of the code <code>Cipher cipher = Cipher.getInstance(algorithm);</code> crashes in java, if I use <code>String algorithm = &quot;AES/CBC/PKCS7Padding&quot;;</code>\nHowever it would pass with <code>String algorithm = &quot;AES/CBC/PKCS5Padding&quot;;</code>, but this time it's angular that would crash. <strong>padding: CryptoJS.pad.Pkcs5</strong></p>\n<p>I can't find a solution for this problem, and that's why I ask for your help.</p>\n"},{"tags":["java","maven","jenkins","maven-plugin"],"comments":[{"owner":{"user_id":14001175,"display_name":"Atxulo"},"edited":false,"comment_id":133119167,"body":"What are you trying to achieve? Why do you want to compile twice?"},{"owner":{"user_id":7512201,"display_name":"Amerousful"},"edited":false,"comment_id":133122128,"body":"@Atxulo It&#39;s just an example. Instead of <code>compile</code> can be any other goal"},{"owner":{"user_id":296328,"display_name":"khmarbaise"},"edited":false,"comment_id":133190198,"body":"First I would ask why do you use a post build action to call <code>compile</code> ? The build will run in the primary part ?"},{"owner":{"user_id":7512201,"display_name":"Amerousful"},"edited":false,"comment_id":133244916,"body":"@khmarbaise I&#39;ll try explain with abstract example. Imagine you run some code via Build and your build was aborted and you want to do something like send information about abort to database.  For this case I use the same repository and have two objects with scripts: <code>Main</code> and <code>BuildWasAborted</code>"}],"answers":[{"owner":{"user_id":8092868,"display_name":"Joep Weijers"},"up_vote_count":0,"is_accepted":false,"creation_date":1676558344,"answer_id":75473824,"body":"<p>One configuration that can cause this, is if you have selected &quot;Use private Maven repository&quot; under the Advanced settings of the Build step:\n<a href=\"https://i.stack.imgur.com/OmwFQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OmwFQ.png\" alt=\"Showing the advanced settings of the Maven build step\" /></a></p>\n<p>The build step then makes use of this private repository and downloads all dependencies in there.</p>\n<p>Your post action executes Maven from the command line without all the extra configuration of the Jenkins Maven jobtype. So it uses the default Maven repository instead of the private one, and hence has to download all your dependencies again.</p>\n<p>One solution can then be to figure out where the repository is (e.g. in your workspace as <code>.repository/</code>) and pass that to your Post-action Maven with <code>mvn compile -Dmaven.repo.local=.repository</code>.</p>\n<p>A better solution is to NOT use the Maven job type, but a Freestyle job instead, as recommended in <a href=\"https://www.youtube.com/watch?v=3dYM0XUrXHc&amp;t=657s\" rel=\"nofollow noreferrer\">one of the 40 Jenkins tips</a>. The Maven Job type provides convenience, but also hides the complexity and that is exactly what is causing these issues, so consider switching.</p>\n"},{"owner":{"user_id":7512201,"display_name":"Amerousful"},"up_vote_count":1,"is_accepted":true,"creation_date":1676988287,"answer_id":75521594,"body":"<p>I found solution!</p>\n<p>At first you need to know the path to your maven local repository and pass it into maven cli via param <code>maven.repo.local</code>:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>mvn -Dmaven.repo.local=/home/jenkins/maven-repositories/0 compile\n</code></pre>\n<p>And then the most important thing. For avoid download dependencies again you have to delete <code>*.sha1</code> and <code>*.repositories</code> from your local maven repository. I don't why... but it how works Maven...</p>\n<p>It's an example of full script:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>find /home/jenkins/maven-repositories/0 -type f \\( -iname &quot;*.repositories&quot; -o -iname &quot;*.sha1&quot; \\) -exec rm -f {} \\;\n\nmvn -Dmaven.repo.local=/home/jenkins/maven-repositories/0 compile\n</code></pre>\n"}],"owner":{"user_id":7512201,"display_name":"Amerousful"},"view_count":187,"up_vote_count":2,"accepted_answer_id":75521594,"answer_count":2,"score":2,"creation_date":1675958422,"question_id":75401208,"body":"<p>I have a Maven job. In <code>Build</code>, for example, I use <code>mvn compile</code> with my <code>settings.xml</code>.</p>\n<p>This <code>settings.xml</code> contains credentials to our Nexus Repository which stores some internal dependencies.</p>\n<p>The problem is that when build will execute <code>Post-build Actions</code> (Post build task - Shell) with the same maven goal <code>mvn compile</code> it fails. It depends on build <strong>tries to download all dependencies and plugins again</strong> (but now it's without .</p>\n<p>My question: How to share dependencies from <code>Build</code> step to step <code>Post-build Actions</code></p>\n<hr />\n<p><a href=\"https://i.stack.imgur.com/pCqyM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/pCqyM.png\" alt=\"enter image description here\" /></a></p>\n"},{"tags":["java","android","kotlin","mvvm","dagger-2"],"answers":[{"owner":{"user_id":3100601,"display_name":"ror"},"up_vote_count":1,"is_accepted":true,"creation_date":1675923600,"answer_id":75394919,"body":"<p>You mentioned you are using dagger. I see you are expecting the following to be injected, but doing nothing for that to happen:</p>\n<pre><code>    @Inject\n    lateinit var viewModelFactory: ViewModelFactory\n</code></pre>\n<p>So I can imagine your app is crashing because <code>viewModelFactory</code> is not initialized. Depending on your DI structure, you should either do component/subcomponent injection, or use <code>AndroidInjection.inject(this)</code></p>\n"},{"owner":{"user_id":331271,"display_name":"hlidka"},"up_vote_count":0,"is_accepted":false,"creation_date":1675923683,"answer_id":75394923,"body":"<p>One way to do this is to annotate the ViewModel with <code>@HiltViewModel</code> and the activity with <code>@AndroidEntryPoint</code>, then you can <code>import androidx.activity.viewModels</code> and then have</p>\n<pre><code>private val model: ReportsViewModel by viewModels()\n</code></pre>\n"}],"owner":{"user_id":17971278,"display_name":"kathir"},"view_count":52,"up_vote_count":2,"accepted_answer_id":75394919,"answer_count":2,"score":2,"creation_date":1675921871,"question_id":75394710,"body":"<p>I am new in android kotlin and dagger,I am facing above issue. I already provide the ViewModelFactory but facing issue i don't know why this issue is came, i have attached the MainActivity, Repository class and Viewmodel class,Please resolve my issue what I am take my mistake, Please help.</p>\n<p>//MainActivity.class</p>\n<pre><code>`class MainActivity  : AppCompatActivity() {\n    @Inject\n    lateinit var viewModelFactory: ViewModelFactory\n\n    private lateinit var reportViewModel: ReportsViewModel\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        //(application as PWEApplication).daggerComponent.inject(this)\n        reportViewModel = ViewModelProvider(this, viewModelFactory).get(ReportsViewModel::class.java)\n        reportViewModel.report.observe(this, Observer {\n            when(it.status){\n                NetworkResource.Status.LOADING -&gt; {\n                    // Show a loading indicator\n                }\n                NetworkResource.Status.SUCCESS -&gt; {\n                    // Show the data from the API\n                    Log.e(&quot;installationReport&quot;,&quot;&quot;+it.data)\n                }\n                NetworkResource.Status.ERROR -&gt; {\n                    // Show an error message\n                }\n            }\n        })\n    }\n}`\n</code></pre>\n<p>//Viewmodel.class</p>\n<pre><code>``open class ReportsViewModel @Inject constructor(private val repository: ReportsRepository) :ViewModel() {\n\n    private var reportLiveData = MediatorLiveData&lt;ReportRequest&gt;()\n\n    val report = Transformations.switchMap(reportLiveData) {\n        repository.getReports(it)\n    }\n\n    fun getInstallReport(idd: Int, fromDate: String, toDate: String) {\n        reportLiveData.value = ReportRequest(idd, fromDate, toDate)\n    }\n\n}`\n</code></pre>\n<p>//ReportRepository.class</p>\n<pre><code>class ReportsRepository @Inject constructor(\n    private val reportServiceNS: ReportsService,\n    private val schedulerProvider: SchedulerProvider\n) {\n    private val reportsMutableLiveData = MutableLiveData&lt;NetworkResource&lt;List&lt;ResponseItem&gt;&gt;&gt;()\n    private var disposable: Disposable? = null\n\n    fun getReports(reportRequest: ReportRequest): MutableLiveData&lt;NetworkResource&lt;List&lt;ResponseItem&gt;&gt;&gt;{\n        disposable = reportServiceNS.getReport(\n            reportRequest.script,\n            reportRequest.deploy,\n            reportRequest.compId,\n            reportRequest.h,\n            reportRequest.discId,\n            reportRequest.fromDate,\n            reportRequest.toDate)\n            .compose(schedulerProvider.getSchedulersForObservable())\n            .subscribeWith(object : DisposableObserver&lt;ReportResponse&gt;() {\n                override fun onComplete() {\n\n                }\n\n                override fun onNext(t: ReportResponse) {\n                    reportsMutableLiveData.value = NetworkResource.success(t.complaintData)\n                }\n\n                override fun onError(e: Throwable) {\n                    reportsMutableLiveData.value = NetworkResource.error(e, null)\n                }\n\n            })\n\n        return reportsMutableLiveData\n    }\n}`\n</code></pre>\n"},{"tags":["java","if-statement","conditional-statements"],"comments":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":133030588,"body":"What type are these statuses represented as? Do you have an enum? Or are they just strings? Or named integer constants?"},{"owner":{"user_id":438992,"display_name":"Dave Newton"},"edited":false,"comment_id":133030600,"body":"You’re describing a state machine; there are a ton of ways this can be implemented."},{"owner":{"user_id":3553434,"display_name":"时间只会一直走"},"edited":false,"comment_id":133030787,"body":"If the minimum complexity of achieving one thing is N, then no matter what method you use, it will not make its complexity less than N, just make it look more elegant, such as applying some design patterns, which may be better maintained later  ."},{"owner":{"user_id":3553434,"display_name":"时间只会一直走"},"edited":false,"comment_id":133030812,"body":"For example, if you want to eat in the morning, your request is that if there is milk, then you must eat bread. If there is a glass of milk on the table, then 1. You need to make a bread 2. Tell your mother that if there is milk, I will eat bread, no matter where  In this way, you can’t escape making bread, but you just add an object “Mom” and entrust the bread making to “Dear Mom”, so you, as the main body eating breakfast, will save you trouble"},{"owner":{"user_id":3553434,"display_name":"时间只会一直走"},"edited":false,"comment_id":133030829,"body":"Back to your question, you can completely extract the code for judging the state, because there may be new states in the future. At that time, if a new state is added, there is no need to change the main process, just focus on the code for managing the state  .  But in this case, you still need if else to achieve this (you can&#39;t reduce its complexity)."},{"owner":{"user_id":3553434,"display_name":"时间只会一直走"},"edited":false,"comment_id":133030911,"body":"@Dexygen I answered his question &quot;This can be done with a bunch of IF conditions but is there a better way to do it?&quot; My suggestion is to separate the state processing code from the main body, and I explained that in the end, these still have to be judged by if else. Maybe you can write some fancy algorithms, and then encapsulate them into a method, which can be judged by direct calling.  But in the end that algorithm may need more if else"},{"owner":{"user_id":3920066,"display_name":"Sauchin"},"edited":false,"comment_id":133031098,"body":"A bunch of IF/ELSE is definitely an option but the number of conditions that will be needed will be too many for any readable code."}],"answers":[{"owner":{"user_id":183406,"display_name":"meriton"},"up_vote_count":2,"is_accepted":true,"creation_date":1675910053,"answer_id":75393643,"body":"<p>This is quite straightforward if you use <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/Enum.html#ordinal()\" rel=\"nofollow noreferrer\"><code>ordinal()</code></a>:</p>\n<pre><code>public enum Status {\n    CREATED, PROCESSED, UPDATED_STAGE1, UPDATED_STAGE2, UPDATED_STAGE3, UPDATED_STAGE4;\n\n    public boolean isBefore(Status other) {\n        return this.ordinal() &lt; other.ordinal();\n    }\n}\n</code></pre>\n"}],"owner":{"user_id":3920066,"display_name":"Sauchin"},"view_count":71,"up_vote_count":2,"accepted_answer_id":75393643,"answer_count":1,"score":2,"creation_date":1675905280,"question_id":75393258,"body":"<p>I have an object that can have a bunch of statuses. A third party also sends an updated status for this object. I need to better way to check if the newly received status is allowed on the target object based on if the current status is logically ahead or not.</p>\n<p>For example, a <code>customer</code> can have a bunch of statutes <code>(CREATED, PROCESSED, UPDATED_STAGE1, UPDATED_STAGE2, UPDATED_STAGE3, UPDATED_STAGE4)</code> etc. These statuses are all chronologically next stages for the customer.</p>\n<p>For example, if the customer is in UPDATED_STAGE2 then it can only have new status as <code>UPDATED_STAGE3</code> or <code>UPDATED_STAGE4</code>. If the third party sends a status <code>UPDATED_STAGE1</code> then it is not allowed.</p>\n<p>How do I check if the newly received status is chronologically next status only? The status can be any next status. For example, a customer currently in <code>UPDATED_STAGE2</code> can receive <code>UPDATED_STAGE4</code> directly and that is ok. It can not however receive any status before <code>UPDATED_STAGE2</code>.</p>\n<p>This can be done with a bunch of if conditions but is there a better way to do it?</p>\n<pre><code>public void setNewCustomerStatus(newStatus) {\n  ... logic here that checks, the newStatus is only logically next to the current status.\n}\n</code></pre>\n<p><strong>Edit based on the comments:</strong></p>\n<ol>\n<li>These statuses are part of the enum</li>\n<li>Ideally a state machine will maintain this requirement really nicely but the cost of keeping a state machine outperforms the requirement. So trying to find a way that does not involve a state machine.</li>\n</ol>\n"},{"tags":["python","java","algorithm","dictionary","data-structures"],"answers":[{"owner":{"user_id":6426884,"display_name":"Pedro Cavalheiro"},"up_vote_count":1,"is_accepted":true,"creation_date":1675900290,"answer_id":75392865,"body":"<blockquote>\n<p>What are the benefits in space and time complexity in building graphs using node objects versus dictionaries</p>\n</blockquote>\n<p>In terms of space, the complexity is the same for both. But in terms of time, each has its' own advantages.</p>\n<p>As you said, if you need to query for a specific node, the dictionary is better, with an O(1) query. But if you need to add nodes, the graph version has only O(1) time complexity, while the dictionary has an amortized O(1) time complexity, becoming O(n) when an expansion is needed.</p>\n<p>Overall, think of the comparison as an ArrayList vs LinkedList, since the principles are the same.</p>\n<p>Finally, if you do opt to use the dictionary version and you predict you won't have a small number of adjecant nodes, you can store edges in a set instead of an array, since they're most likely not ordered and querying a node for the existance of an adjecant node becomes an O(1) operation instead of O(n). The same applies to the nodes version, using a set instead of a linked list. Just make sure the extra overhead of the insertions makes it worthwhile.</p>\n<blockquote>\n<p>My immediate intuition says that using objects would allow you make something much more complex (like each node representing a server, with an IP, mac address, cache, etc) while a dictionary is probably only useful for studying the structure of the graph. Is this correct?</p>\n</blockquote>\n<p>No. With the dictionary, you can either have a separate dictionary that associates with node (key) to its' value, or if the value is small enough, like an IPv4, and it's unique, you can just use it as a key.</p>\n"}],"owner":{"user_id":19170200,"display_name":"ring0-collections"},"view_count":102,"up_vote_count":2,"accepted_answer_id":75392865,"answer_count":1,"score":2,"creation_date":1675899147,"question_id":75392754,"body":"<p>I am practicing a couple algorithms (DFS, BFS). To set up the practice examples, I need to make a graph with vertices and edges. I have seen two approaches - defining an array of vertices and an array of edges, and then combining them into a &quot;graph&quot; using a dictionary, like so:</p>\n<pre><code>graph = {'A': ['B', 'E', 'C'],\n        'B': ['A', 'D', 'E'],\n        'C': ['A', 'F', 'G'],\n        'D': ['B', 'E'],\n        'E': ['A', 'B', 'D'],\n        'F': ['C'],\n        'G': ['C']}\n</code></pre>\n<p>But in a video series made by the author of &quot;cracking the coding interview&quot;, their approach was to define a &quot;node&quot; object, which holds an ID, and a list of adjacent/child nodes (in Java):</p>\n<pre><code>public static class Node {\nprivate int id;\nLinkedList&lt;Node&gt; adjacent = new LinkedList&lt;Node&gt;(); // nodes children\nprivate Node(int id) {\n    this.id = id; //set nodes ID\n    }\n}\n</code></pre>\n<p>The pitfall I see of using the latter method, is making a custom function to add edges, as well has lacking an immediate overview of the structure of the entire graph; To make edges, you have to first retrieve the node object associated with the ID by first traversing to it or using a hashmap, and then by using its reference, adding the destination node to that source node:</p>\n<pre><code>private Node getNode(int id) {} //method to retrieve node from hashmap\npublic void addEdge(int source, int destination) {\n    Node s = getNode(source);\n    Node d = getNode(destination);\n    s.adjacent.add(d);  \n}\n</code></pre>\n<p>While in comparison using a simple dictionary, it is trivial to add new edges:</p>\n<pre><code>graph['A'].append('D')\n</code></pre>\n<p>By using a node object, adding a new connection to every child of a node is more verbose (imagine the Node class as a Python class which takes an ID and list of node-object children):</p>\n<pre><code>node1 = Node('A', [])\nnode2 = Node('B', [node1])\nnode3 = Node('C', [node1, node2])\n\nnew_node = Node('F', [])\n\nfor node in node3.adjacent:\n    node.adjacent.append(new_node) # adds 'F' node to every child node of 'C'\n</code></pre>\n<p>while using dictionaries, if I want to add new_node to every connection/child of node3:</p>\n<pre><code>for node in graph['C']:\n    graph[node].append('F')\n</code></pre>\n<p>What are the benefits in space and time complexity in building graphs using node objects versus dictionaries? Why would the author use node objects instead of a dictionary? My immediate intuition says that using objects would allow you make something much more complex (like each node representing a server, with an IP, mac address, cache, etc) while a dictionary is probably only useful for studying the structure of the graph. Is this correct?</p>\n"},{"tags":["java","random","biginteger"],"comments":[{"owner":{"user_id":238704,"display_name":"President James K. Polk"},"edited":false,"comment_id":133008648,"body":"There&#39;s no reason to avoid <code>Random</code>."},{"owner":{"user_id":589259,"display_name":"Maarten Bodewes"},"edited":false,"comment_id":133008872,"body":"@PresidentJamesK.Polk <code>Random</code> implements one particular, not so brilliant randomization scheme (listed in the class definition, using only 48 bit seed), so I guess there may be some use cases for using <code>RandomGenerator.of(&quot;supportedAlgorithm&quot;)</code>."},{"owner":{"user_id":846563,"display_name":"datahaki"},"edited":false,"comment_id":133020413,"body":"I plan to change the distribution interface in the math library that implements certain probability distributions and generates random variates for them: <a href=\"https://github.com/datahaki/tensor/tree/master/src/main/java/ch/alpine/tensor/pdf/c\" rel=\"nofollow noreferrer\">github.com/datahaki/tensor/tree/master/src/main/java/ch/alpi&zwnj;&#8203;ne/&hellip;</a>"}],"answers":[{"owner":{"user_id":589259,"display_name":"Maarten Bodewes"},"up_vote_count":1,"is_accepted":true,"creation_date":1675812813,"answer_id":75380046,"body":"<p><strong>Just using <code>Random</code> &amp; <code>SecureRandom</code></strong></p>\n<p>Why do you need this? Because the <code>new Random()</code> gets you a relatively fast non-secure random number generator and <code>new SecureRandom()</code> provides a CSPRNG (Cryptographically Secure Pseudo Random Number Generator). <em>Both those instances are instances of the <code>RandomGenerator</code> interface.</em> So the only time you'd need this is if you want a specific Random generator <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/random/package-summary.html#algorithms\" rel=\"nofollow noreferrer\">defined in the random package</a>.</p>\n<p>If you don't need speed and you haven't any specific needs regarding the distribution - you'd probably know if you'd have any - then please just use <code>new BigInteger(n, new SecureRandom())</code>.</p>\n<p><strong>Implementing <code>Random</code></strong></p>\n<p>TL;DR: don't</p>\n<p>As <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/random/RandomGenerator.html\" rel=\"nofollow noreferrer\"><code>RandomGenerator</code> is an <strong>interface</strong></a>. The <code>Random</code> class has been refactored into a class that implements the interface. That means you can use the old <code>Random</code> wherever an interface specifies <code>RandomGenerator</code>. However, that doesn't work the other way around.</p>\n<p><code>Random</code> itself is not a <code>final</code> class, so it can be inherited from. So you could, <strong>in principle</strong>, create an adapter class by simply implementing all methods in <code>Random</code> and calling the similarly named methods of a wrapped <code>RandomGenerator</code>. This is however very dangerous practice as future extensions of <code>Random</code> may break everything. In the worst case it will show inconsistent behavior by mixing the state of the parent <code>Random</code> object and the wrapped <code>RandomGenerator</code>.</p>\n<p><strong>Move to Java 19</strong></p>\n<p>In Java 19 (build b21) there is an <a href=\"https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/Random.html#from(java.util.random.RandomGenerator)\" rel=\"nofollow noreferrer\">adapter method provided for <code>RandomGenerator</code> named <code>Random#from(RandomGenerator)</code></a>. You can see the feature request <a href=\"https://bugs.openjdk.org/browse/JDK-8279598\" rel=\"nofollow noreferrer\">here</a>. Note that this is an intermediate step; preferably the <code>BigInteger</code> method should be retrofitted to use <code>RandomGenerator</code> (as stated in the feature request).</p>\n<p>Beware that you should <em>never</em> use this wrapper class if you suspect that <code>setSeed</code> can ever be called, e.g. when generating a large prime in the <code>BigInteger</code> class. If it is called it will generate an <code>UnsupportedOperationException</code>.</p>\n<p>These kind of classes go through all kinds of testing so the Java provided method can be trusted. However, the fact that a method can be retrofitted to use <code>setSeed</code> could be a problem regarding forward compatibility - you have been warned.</p>\n<p><strong>The special case of <code>[0, n^2)</code></strong></p>\n<p>However, you've got one out: the range <code>0..2^n-1</code> or <code>[0, 2^n-1)</code> is a number consisting of a set of bits. So what you can do is use your <code>RandomGenerator</code>, fill an array of bytes, remove the most significant bits from the first byte (as Java is big endian), and then convert the array into a signed integer:</p>\n<pre><code>/**\n * Mimics the {@link BigInteger#BigInteger(int, Random)} function using a\n * {@link RandomGenerator} instance.\n * \n * @param numBits maximum bitLength of the new BigInteger.\n * @param rnd     source of randomness to be used in computing the new\n *                BigInteger.\n * @throws IllegalArgumentException {@code numBits} is negative.\n * @see #bitLength()\n */\npublic static BigInteger generateRandomBigInteger(int numBits, RandomGenerator rng) {\n    if (numBits &lt; 0) {\n        throw new IllegalArgumentException(&quot;numBits must be non-negative&quot;);\n    }\n\n    if (numBits == 0) {\n        return BigInteger.ZERO;\n    }\n\n    int bytes = (numBits + Byte.SIZE - 1) / Byte.SIZE;\n    // mask bits that we need the value of to 1, the others - if any -- will be set\n    // to zero\n    byte bitMask = (byte) ((1 &lt;&lt; ((numBits - 1) % Byte.SIZE + 1)) - 1);\n    byte[] randomBytes = new byte[bytes];\n    rng.nextBytes(randomBytes);\n    randomBytes[0] &amp;= bitMask;\n    return new BigInteger(1, randomBytes);\n}\n</code></pre>\n<p><code>numBits</code> is of course the same as your <code>n</code> variable.</p>\n<p><strong>The case for [0, max)</strong></p>\n<p>Actually, you can combine the comparison function and the random bit generator in such a way that you can create large random values in the range 0..max with max having <em>any value</em>, with a minimum amount of random bits and no nasty <code>BigInteger</code> operations (such as division) at all.</p>\n<p>You can find my implementation of that <a href=\"https://github.com/owlstead/RNG-BC\" rel=\"nofollow noreferrer\">here</a> but you may get weirded out. Sorry in advance, and yes, this is a shameless plug of my RNGBC algorithm :)</p>\n"}],"owner":{"user_id":846563,"display_name":"datahaki"},"view_count":103,"up_vote_count":2,"accepted_answer_id":75380046,"answer_count":1,"score":2,"creation_date":1675800815,"question_id":75378517,"body":"<p>The class BigInteger provides the constructor</p>\n<pre><code>public BigInteger(int numBits, Random rnd)\n</code></pre>\n<p>Since Java 17 the use of <code>RandomGenerator</code> is encouraged. How can I generate a random BigInteger in the range 0...(2^n)-1 using only an instance of <code>RandomGenerator</code>.</p>\n"},{"tags":["java","spring-boot","apache-kafka","spring-data-redis"],"answers":[{"owner":{"user_id":21162590,"display_name":"ke yan"},"up_vote_count":1,"is_accepted":false,"creation_date":1675751006,"answer_id":75369559,"body":"<ol>\n<li><p>Obtain all methods of adding annotation RedisListener through scanning</p>\n</li>\n<li><p>Get the values of the annotation, and listen to these topics through the reactiveRedisTemplate</p>\n</li>\n<li><p>Call the method through reflection in the callback method</p>\n</li>\n</ol>\n"}],"owner":{"user_id":4265824,"display_name":"Ganesh Gudghe"},"view_count":80,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1675682046,"question_id":75360572,"body":"<p>I am working on spring boot ReactiveRedis for the <strong>pub-sub mechanism</strong> following is my code and it is working fine, I am getting data in <strong>subscribe call back</strong>.</p>\n<pre><code>@Autowired\nprivate ReactiveRedisOperations&lt;String, Object&gt; reactiveRedisTemplate;\n \n@PostConstruct\n    public void init(){\n        System.out.println(&quot;*****SampleLoader***** initialized - SampleLoader&quot;);\n\n        this.reactiveRedisTemplate.listenTo(ChannelTopic.of(&quot;some-topic&quot;)).subscribe(data -&gt; {\n                System.out.println(\n                        &quot;data.getChannel():-&quot; + data.getChannel() + &quot;:&quot; + &quot;data.getMessage():-&quot; + data.getMessage());\n        });\n    }\n</code></pre>\n<p>But my question is how to create a custom annotation like</p>\n<pre><code>@Target({ ElementType.TYPE, ElementType.METHOD, ElementType.ANNOTATION_TYPE })\n@Retention(RetentionPolicy.RUNTIME)\n@MessageMapping\n@Documented\n@Repeatable(RedisListeners.class)\npublic @interface RedisListener{\n}\n\n@Target({ ElementType.TYPE, ElementType.METHOD, ElementType.ANNOTATION_TYPE })\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface RedisListeners {\n\n    RedisListener[] value();\n\n}\n\n\n  @RedisListener(&quot;some-topic&quot;)\n        public void redisData(String channel, Object data){\n        \n        }\n</code></pre>\n<p><strong>@RedisListener</strong> will subscribe to the topic and return the call-back data.</p>\n"},{"tags":["java","unicode","notepad++","utf-16","notepad"],"comments":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":132970666,"body":"I don&#39;t use notepad or notepad++, but are those options for decoding/reading/opening the text file, or is it for encoding/writing/saving the file?"},{"owner":{"user_id":1382647,"display_name":"fatherazrael"},"edited":false,"comment_id":132970770,"body":"In Notepad, While Saving ; and in Notepad++, while displaying file can check encoding options"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"edited":false,"comment_id":132970962,"body":"<a href=\"https://en.wikipedia.org/wiki/Byte_order_mark\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Byte_order_mark</a>"}],"answers":[{"owner":{"user_id":5133585,"display_name":"Sweeper"},"up_vote_count":1,"is_accepted":false,"creation_date":1675668987,"answer_id":75358483,"body":"<p>These are documented <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/charset/Charset.html#standard\" rel=\"nofollow noreferrer\">here</a>:</p>\n<blockquote>\n<ul>\n<li><p>When decoding, the UTF-16BE and UTF-16LE charsets interpret the initial byte-order marks as a ZERO-WIDTH NON-BREAKING SPACE; when\nencoding, they do not write byte-order marks.</p>\n</li>\n<li><p>When decoding, the UTF-16 charset interprets the byte-order mark at the beginning of the input stream to indicate the byte-order of the\nstream but defaults to big-endian if there is no byte-order mark; when\nencoding, it uses big-endian byte order and writes a big-endian\nbyte-order mark.</p>\n</li>\n</ul>\n</blockquote>\n<p>So in short, <code>UTF_16BE</code> and <code>UTF_16LE</code> do not care about BOM, and so does not correspond to the &quot;UTF-16 BE BOM&quot; or &quot;UTF-16 LE BOM&quot; options in notepad++ as you seem to imply.</p>\n<p>On the other hand, <code>UTF_16</code> does write a BE BOM when encoding, so would correspond to choosing the &quot;(Convert to) UTF-16 BE BOM&quot; option in notepad++. Note that for decoding, the BOM is &quot;optional&quot;.</p>\n<p>As for the NotePad options, they do not say whether they include a BOM, so I'm not sure if they do. If they do not, then it would be equivalent to <code>UTF_16BE</code> and <code>UTF_16LE</code>'s encoding behaviour.</p>\n<p>As for <em>why</em> notepad++ does not have the equivalent of the <code>UTF_16BE</code> and <code>UTF_16LE</code> options, or why Java doesn't have a &quot;UTF-16 LE BOM&quot; option, it is not really a useful question to ask. <a href=\"https://meta.stackoverflow.com/a/293819/5133585\">As Eric Lippert said</a>,</p>\n<blockquote>\n<p><strong>features are not magically implemented by default and then the implementations have to get removed by the development team for a good reason.</strong> Rather, all features are unimplemented by default and have to be <strong>thought of, designed, specified, implemented, tested, approved and shipped to customers.</strong> All that costs time and effort.</p>\n</blockquote>\n"}],"owner":{"user_id":1382647,"display_name":"fatherazrael"},"view_count":105,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1675667128,"question_id":75358262,"body":"<p><a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/nio/charset/StandardCharsets.html\" rel=\"nofollow noreferrer\"><code>StandardCharsets</code></a> provides three entries for <a href=\"https://en.wikipedia.org/wiki/UTF-16\" rel=\"nofollow noreferrer\">UTF-16</a>:</p>\n<pre><code>    /**\n     * Sixteen-bit UCS Transformation Format, big-endian byte order\n     */\n    public static final Charset UTF_16BE = new sun.nio.cs.UTF_16BE();\n    /**\n     * Sixteen-bit UCS Transformation Format, little-endian byte order\n     */\n    public static final Charset UTF_16LE = new sun.nio.cs.UTF_16LE();\n    /**\n     * Sixteen-bit UCS Transformation Format, byte order identified by an\n     * optional byte-order mark\n     */\n    public static final Charset UTF_16 = new sun.nio.cs.UTF_16();\n</code></pre>\n<p>Notepad (&amp; Notepad++) Provides following:</p>\n<p><a href=\"https://i.stack.imgur.com/lHky0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/lHky0.png\" alt=\"enter image description here\" /></a></p>\n<p>Why is UTF-16 missing in Notepad? (Is UTF-16 and UTF-16 BE same thing?)</p>\n"},{"tags":["java","spring-boot","maven","jenkins","cucumber"],"answers":[{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"up_vote_count":1,"is_accepted":true,"creation_date":1675553735,"answer_id":75349109,"body":"<p>Too many backslashes, should be:</p>\n<pre><code>sh '''mvn spring-boot:start \\\n exec:java \\\n -Dexec.classpathScope=test \\\n -Dexec.mainClass=io.cucumber.core.cli.Main \\\n -Dexec.args=\\&quot;src/test-bdd/resources/features/set02 --glue gluepackage\\&quot; \\\n spring-boot:stop\n'''\n</code></pre>\n<p>btw, for this particular case I would recommend to define execution for <code>exec-maven-plugin</code>:</p>\n<p><strong>I</strong>. <code>Java</code> as executable (I prefer this option - it does not affect <code>maven</code> VM):</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;\n    &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;set02&lt;/id&gt;\n            &lt;phase&gt;none&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;exec&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n                &lt;executable&gt;java&lt;/executable&gt;\n                &lt;arguments&gt;\n                    &lt;argument&gt;-classpath&lt;/argument&gt;\n                    &lt;classpath /&gt;\n                    &lt;argument&gt;io.cucumber.core.cli.Main&lt;/argument&gt;\n                    &lt;argument&gt;src/test-bdd/resources/features/set02&lt;/argument&gt;\n                    &lt;argument&gt;--glue&lt;/argument&gt;\n                    &lt;argument&gt;gluepackage&lt;/argument&gt;\n                &lt;/arguments&gt;\n                &lt;classpathScope&gt;test&lt;/classpathScope&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>\n<p><strong>II</strong>. Main class within the same VM as <code>maven</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;\n    &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;set02&lt;/id&gt;\n            &lt;phase&gt;none&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;java&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n                &lt;arguments&gt;\n                    &lt;mainClass&gt;io.cucumber.core.cli.Main&lt;/mainClass&gt;\n                    &lt;argument&gt;src/test-bdd/resources/features/set02&lt;/argument&gt;\n                    &lt;argument&gt;--glue&lt;/argument&gt;\n                    &lt;argument&gt;gluepackage&lt;/argument&gt;\n                &lt;/arguments&gt;\n                &lt;classpathScope&gt;test&lt;/classpathScope&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>\n<p>and run it via <code>exec:exec@exection-id</code> or <code>exec:java@exection-id</code>, i.e.:</p>\n<pre><code>sh '''mvn spring-boot:start \\\n exec:exec@set02 \\\n spring-boot:stop\n'''\n</code></pre>\n<p>also, it is not clear whether <code>maven</code> can stop <code>spring-boot</code> application in case of failure and that is better to split pipeline into separate steps protected by try/finally.</p>\n"}],"owner":{"user_id":4363025,"display_name":"hicnar"},"view_count":220,"up_vote_count":2,"accepted_answer_id":75349109,"answer_count":1,"score":2,"creation_date":1675544605,"question_id":75348362,"body":"<p>When trying to execute cucumber tests from Jenkins pipeline with the invocation looking like this:</p>\n<pre><code>sh '''mvn spring-boot:start \\\n                            exec:java \\\n                            -Dexec.classpathScope=test \\\n                            -Dexec.mainClass=io.cucumber.core.cli.Main \\\n                            -Dexec.args=\\\\&quot;src/test-bdd/resources/features/set02 --glue gluepackage\\\\&quot; \\\n                            spring-boot:stop\n                        '''\n</code></pre>\n<p>after that line gets invoked, Jenkins will output the following:</p>\n<pre><code>20:39:31  + mvn spring-boot:start exec:java -Dexec.classpathScope=test -Dexec.mainClass=io.cucumber.core.cli.Main -Dexec.args=&quot;src/test-bdd/resources/features/set02 --glue gluepackage&quot; spring-boot:stop\n20:39:31  Unable to parse command line options: Unrecognized option: --glue\n20:39:31  \n20:39:31  usage: mvn [options] [&lt;goal(s)&gt;] [&lt;phase(s)&gt;]\n</code></pre>\n<p>That basically means the shell is not passing the value of the -Dexec.args parameter to the exec plugin as a string but rather interprets that value as arguments to the <em>mvn</em> command. Obviously there's no <em>--glue</em> argument maven recognises, so the shell will print help on how to use maven and exit with a an error.</p>\n<p>If I copy-paste the generated command into my terminal in the project directory and hit enter, it will run perfectly fine meaning the contents between quotes will be passed to the exec:java plugin command and the cucumber tests start and run as they should.</p>\n<p>I tried quite a few things (single quotes, double quotes, groovy style string interpolation, passing as environment variable etc) except probably writing a simple shell script and invoking the command line inside it with params passed to the script which would probably be the closest to what happens when invoked directly from command line, but from all that I have tried nothing seems to work.</p>\n<p>I am running Jenkins 2.375.2. Both controller and nodes run on Mac.</p>\n<p>Will appreciate any suggestions.</p>\n"},{"tags":["java","concurrency","timeout","future","closeable"],"comments":[{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"edited":false,"comment_id":132942915,"body":"Why would you get a resource only to immediately close it? Your Question could use a bit more context. A <b>simple but semi-realistic example</b> would help. If you have in mind that a background task is handed a closable resource required for its work, that task should close the resource upon completing that work. The value returned by <code>Future#get</code> should be a <i>result</i>, not a resource used in producing a result."},{"owner":{"user_id":38663,"display_name":"jbu"},"edited":false,"comment_id":132943246,"body":"@BasilBourque as alluded to earlier, this is for the case where I&#39;ve given up waiting after some timeout threshold has passed. I want to give up and have the thread continue but I also want to make sure that the resource isn&#39;t left behind without proper cleanup"},{"owner":{"user_id":402428,"display_name":"michid"},"edited":false,"comment_id":132946498,"body":"But when timing out you didn&#39;t get the resource in the first place. Why and how do you want to close it then?"},{"owner":{"user_id":38663,"display_name":"jbu"},"edited":false,"comment_id":132947766,"body":"@michid I understand I didn&#39;t get the resource in the first place - I abandon it. But there is still an executor thread that is in the process of getting it and when it does, it won&#39;t have anyone to give it to, thus the resource won&#39;t get closed properly. Even though I won&#39;t get the resource (I abandon it) I still want some mechanism to properly dispose of it. I can&#39;t wait forever for the resource to come back properly."},{"owner":{"user_id":19450,"display_name":"Ben Manes"},"edited":false,"comment_id":132951507,"body":"A non-exhaustive list of simple approaches:  (1) Use <code>CompletableFuture</code> and on a timeout attach a handler to close the resource.  (2) Use finalization (deprecated) alternatives like phantom references (e.g. see <code>Cleaner</code>).  (3) Invert the problem by submitting the work to the resource, so that when ready it invokes a callback and closes. Cancel the callback to no-op on timeout."}],"answers":[{"owner":{"user_id":38663,"display_name":"jbu"},"up_vote_count":1,"is_accepted":false,"creation_date":1675528682,"answer_id":75346606,"body":"<p>I think one solution is to submit a task that has some state that keeps track of whether the request was abandoned. When the resource is retrieved the executor thread can check if the main thread had abandoned it and if so, close the resource. In the main thread, if the the timeout occurs and you want to abandon the resource, just set the abandoned flag. All of this would need to be written in a thread safe way of course.</p>\n"},{"owner":{"user_id":402428,"display_name":"michid"},"up_vote_count":0,"is_accepted":false,"creation_date":1675537949,"answer_id":75347687,"body":"<p>You can submit another task in the timeout case that closes the resource once it has been allocated:</p>\n<pre><code>Future&lt;Closeable&gt; crFuture = executorService.submit(this::getCloseableResource);\ntry {\n    Closeable cr = crFuture.get(TIMEOUT, TimeUnit.MILLISECONDS);\n    // ...\n} catch (TimeoutException e) {\n    executorService.submit(() -&gt; {\n        try {\n            crFuture.get().close();\n        } catch (IOException | InterruptedException | ExecutionException ex) {\n            // ...\n       }\n    });\n}\n</code></pre>\n"}],"owner":{"user_id":38663,"display_name":"jbu"},"view_count":133,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1675459413,"question_id":75341149,"body":"<p>Say I have a method <code>getCloseableResource()</code> which might take an unbounded amount of time to complete and returns something that needs to be closed or cleaned up.</p>\n<p>I want to submit a task to an executorService to get the closeable resource but only wait a limited amount of time.</p>\n<pre><code>Future&lt;CloseableResource&gt; crFuture = executorService.submit(() -&gt; getCloseableResource());\nCloseableResource cr = crFuture.get(TIMEOUT, TimeUnit.MILLISECONDS);\ncatch (TimeoutException e) {\n  // abandon the attempt\n}\n</code></pre>\n<p>The problem is that if I abandon waiting, I'll never be able to close the resource since I won't have a handle to it and the resource will never get cleaned up properly.</p>\n<p>Is there some mechanism to specify cleanup code to execute when getCloseableResource returns so that I can abandon waiting for it AND make sure it is disposed of cleanly? Or maybe there is a more advance construct rather than an executor service.</p>\n"},{"tags":["java","json","moshi"],"answers":[{"owner":{"user_id":13447729,"display_name":"wanderbild"},"up_vote_count":1,"is_accepted":true,"creation_date":1675421599,"answer_id":75334675,"body":"<p>It seems that to deserialize nested collections we have to pass nested parametrized types to the adapter. After changing this</p>\n<pre><code>ParameterizedType type = Types.newParameterizedType(Map.class, String.class, List.class, baseType);\n</code></pre>\n<p>to this</p>\n<pre><code>ParameterizedType type = Types.newParameterizedType(Map.class, String.class, Types.newParameterizedType(List.class, baseType));\n</code></pre>\n<p>I now have a working solution - I get a <code>Map</code> with <code>List&lt;SomeClass&gt;</code> values not <code>LinkedHashTreeMap</code>s.</p>\n"}],"owner":{"user_id":13447729,"display_name":"wanderbild"},"view_count":85,"up_vote_count":2,"accepted_answer_id":75334675,"answer_count":1,"score":2,"creation_date":1675353039,"question_id":75325675,"body":"<p>Can't deserialize json to this structure: <code>Map&lt;String, List&lt;SomeClass&gt;&gt;</code></p>\n<p>I can deserialize to <code>Map&lt;String, SomeClass&gt;</code> like this:</p>\n<pre><code>ParameterizedType type = Types.newParameterizedType(Map.class, String.class, SomeClass.class);\nJsonAdapter&lt;Map&lt;String, SomeClass&gt;&gt; adapter = moshi.adapter(type);\n</code></pre>\n<p>But when there are two collections nested, for example, <code>Map&lt;String, List&lt;SomeClass&gt;&gt;</code>, the next code</p>\n<pre><code>ParameterizedType type = Types.newParameterizedType(Map.class, String.class, List.class, SomeClass.class);\nJsonAdapter&lt;Map&lt;String, List&lt;SomeClass&gt;&gt;&gt; adapter = moshi.adapter(type);\n</code></pre>\n<p>returns <code>Map&lt;String, List&lt;LinkedHashTreeMap&gt;&gt;</code>, <code>LinkedHashTreeMap</code> has properties of <code>SomeClass</code> as keys and their values as values, and <code>&quot;type&quot;=&quot;SomeClass&quot;</code>.</p>\n<p>How can I solve this, so that deserialization runs okay, as in the first example?</p>\n"},{"tags":["java","shared-libraries","oracle-sqldeveloper","manjaro"],"comments":[{"owner":{"user_id":1156452,"display_name":"thatjeffsmith"},"edited":false,"comment_id":132912215,"body":"FYI the product is setup to be ran with Oracle JDK, and doesn&#39;t technically support OpenJDK."},{"owner":{"user_id":2522681,"display_name":"Michael Lang"},"edited":false,"comment_id":133125847,"body":"@thatjeffsmith I now tested the same with Oracle JDK 19. It was installed from the AUR (<a href=\"https://aur.archlinux.org/packages/jdk\" rel=\"nofollow noreferrer\">aur.archlinux.org/packages/jdk</a>). It yields the same problem! The only difference is the undefined symbol is now <code>undefined symbol: ipv6_available</code>."},{"owner":{"user_id":1156452,"display_name":"thatjeffsmith"},"edited":false,"comment_id":133126109,"body":"well we dont support 19 either, it&#39;s oracle java 11, that what we test for, and distribute for windows and macs"},{"owner":{"user_id":2522681,"display_name":"Michael Lang"},"edited":false,"comment_id":133135547,"body":"@thatjeffsmith thanks for the clarification! Unfortunately, it&#39;s exactly the same problem with Oracle JDK11. <code>jdk-11.0.17_linux-x64_bin.tar.gz</code> downloaded manually from oracle.com trying to reference <code>libjvm.so</code> that it can&#39;t locate in the <code>lib&#47;server</code> directory without explicitly setting the <code>LD_LIBRARY_PATH</code>."},{"owner":{"user_id":1156452,"display_name":"thatjeffsmith"},"edited":false,"comment_id":133144407,"body":"do we know your java is a valid home? Can you for example start sqlcl (it&#39;s the sql.sh in your sqldeveloper/bin) directory. From a cmd prompt, just run sql /nolog . Then if that gets you a prompt, run &#39;show java&#39; . Is it using the same home you think SQLDev is ?"},{"owner":{"user_id":2522681,"display_name":"Michael Lang"},"edited":false,"comment_id":133184725,"body":"@thatjeffsmith No, I cannot start it as my default jdk installation is openjdk8. This is required by my daily business and the reason that I&#39;ve used <code>SetJavaHome</code> in <code>product.conf</code>. <code>JAVA_HOME</code> is not explicitly set. Is there anything else that you&#39;d relate to &quot;a valid home&quot;?"},{"owner":{"user_id":1156452,"display_name":"thatjeffsmith"},"edited":false,"comment_id":133539929,"body":"we don&#39;t support openJDK, esp openJDK 8 - i would expect problems"}],"answers":[{"owner":{"user_id":402723,"display_name":"Raul Lapeira Herrero"},"up_vote_count":0,"is_accepted":false,"creation_date":1676324463,"answer_id":75441451,"body":"<p>As @thatjeffsmith has commented I would not expect SQLDeveloper to work 100% with OpenJDK (even if Oracle says so).</p>\n<p>About your specific scenario the only answer I can think of is having scripts (think of catalina.sh or catalina.bat) to specify diferent locations for that specific environment variable (LD_LIBRARY_PATH). This is not a Java problem, but more a specific JNI problem, which needs to be solved under the JVM (as opposed to IN the JVM).</p>\n"},{"owner":{"user_id":6142737,"display_name":"Lu&#237;s Aur&#233;lio"},"up_vote_count":1,"is_accepted":false,"creation_date":1676642646,"answer_id":75485294,"body":"<p>On my Manjaro installation, i've set the environment variables:</p>\n<p><code>export JAVA_HOME=/usr/lib/jvm/default</code></p>\n<p><code>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/jvm/default/lib/server</code></p>\n<p>I set the variables appointing to the <code>default</code> symlink, to appoint to default JVM set from the <code>archlinux-java</code> program. Before set this variables, the Oracle SQL Developer has opened normally.</p>\n<hr />\n<p>From the .desktop file, other change is necessary. To do this, you can use the <code>menulibre</code> to edit the Oracle SQL Developer SQL Entry. In the command field (equivalent to the line which starts from <code>Exec=</code> text), change to the below line:</p>\n<p><code>env LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/jvm/default/lib/server /usr/bin/oracle-sqldeveloper</code></p>\n<hr />\n<p>My solution is derived from the 'drslmr' solution to fix the Eclipse installation: <a href=\"https://aur.archlinux.org/packages/eclipse-java#news\" rel=\"nofollow noreferrer\">https://aur.archlinux.org/packages/eclipse-java#news</a></p>\n"},{"owner":{"user_id":2522681,"display_name":"Michael Lang"},"up_vote_count":0,"is_accepted":true,"creation_date":1679574764,"answer_id":75823044,"body":"<p>I'll leave my final solution here for reference in case anyone else also stumbles across that issue:</p>\n<p>Oracle SQLDeveloper, at least on arch installations, also requires the <a href=\"https://archlinux.org/packages/extra/x86_64/java11-openjfx/\" rel=\"nofollow noreferrer\">java11-openjfx</a> package. The <code>PKGBUILD</code> file even says so and lists it as an optional dependency. So all that was left to do after installing that was to reference the proper (on my system non-default) JDK installation to use in the <code>product.conf</code>:</p>\n<p><code>SetJavaHome /usr/lib/jvm/java-11-jdk</code></p>\n"}],"owner":{"user_id":2522681,"display_name":"Michael Lang"},"view_count":295,"up_vote_count":2,"accepted_answer_id":75823044,"answer_count":3,"score":2,"creation_date":1675322849,"question_id":75319884,"body":"<p>I am trying to run <code>Oracle SQL Developer 22.2.1</code> under <code>Manjaro 22.0.1</code> using <code>openjdk version &quot;17.0.6&quot; 2023-01-17</code>. For debugging purposes, I have experimented with and yielded the same results using <code>openjdk version &quot;11.0.18&quot; 2023-01-17</code>. Both have been installed using <code>pacman</code>from the official arch repositories (<code>jre17-openjdk</code> and <code>jre11-openjdk</code> respectively).</p>\n<p>This resulted in the following error:</p>\n<pre><code>&gt; oracle-sqldeveloper\nError occurred during initialization of boot layer\njava.lang.UnsatisfiedLinkError: /usr/lib/jvm/java-17-openjdk/lib/libnio.so: /usr/lib/jvm/java-17-openjdk/lib/libnio.so: undefined symbol: reuseport_available\n</code></pre>\n<p>Inspecting <code>libnio.so</code> more closely, the culprit seems to actually be <code>libjvm.so</code>:</p>\n<pre><code>&gt; ldd /usr/lib/jvm/java-17-openjdk/lib/libnio.so                                                                                                                                                                         \n        linux-vdso.so.1 (0x00007ffe0f1d7000)\n        libjava.so =&gt; /usr/lib/jvm/java-17-openjdk/lib/libjava.so (0x00007f7354ce7000)\n        libnet.so =&gt; /usr/lib/jvm/java-17-openjdk/lib/libnet.so (0x00007f7354ccf000)\n        libc.so.6 =&gt; /usr/lib/libc.so.6 (0x00007f7354abb000)\n        /usr/lib64/ld-linux-x86-64.so.2 (0x00007f7354d23000)\n        libjvm.so =&gt; not found\n        libjvm.so =&gt; not found\n</code></pre>\n<p>This is in turn located under <code>/usr/lib/jvm/java-17-openjdk/lib/server/libjvm.so</code>. A bit of research <a href=\"https://stackoverflow.com/questions/60414619/java-symbol-lookup-error-usr-lib64-jvm-java-11-openjdk-11-lib-libnio-so-undef\">here</a> and <a href=\"https://anhqle.github.io/rstudio-cannot-load-rjava-in-ubuntu/\" rel=\"nofollow noreferrer\">there</a> yields setting the <code>LD_LIBRARY_PATH</code> as a potential solution. And indeed, by doing so, the application starts just fine!</p>\n<p><strong>Now finally on to my actual questions:</strong></p>\n<ul>\n<li>Is this some problem with my JDK installation and those links are supposed to work out-of-the-box?</li>\n<li>I am regularly working with 2-3 different JDK installations (openjdk and GraalVM 8, 11 and 17). How would I best set the <code>LD_LIBRARY_PATH</code> for those different versions that each have their own <code>lib</code> directories?</li>\n</ul>\n<p>Currently, I am only facing the problems with SQL Developer. I have already explicitly set the Java version to use in <code>~/.sqldeveloper/22.2.1/product.conf</code>. Maybe there would also be a possibility to supply the library path in there? Using <code>-Djava.library.path</code> did not work so far.</p>\n"},{"tags":["java","multithreading"],"comments":[{"owner":{"user_id":1898563,"display_name":"Michael"},"edited":false,"comment_id":132889743,"body":"Because you can interrupt after the <code>!Thread.interrupted()</code> but before the <code>Thread.sleep(100);</code>. The exact timing of the interrupt is effectively random."},{"owner":{"user_id":19526554,"display_name":"Marcos"},"edited":false,"comment_id":132890050,"body":"@Michael Ohh, thanks, I didn&#39;t know that interrupt is random…"},{"owner":{"user_id":214525,"display_name":"f1sh"},"edited":false,"comment_id":132890071,"body":"With these sleep timings, the loop will be entered 20 times, possibly 21 - is that what you observe?"},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":132890491,"body":"The interrupt is not random, it is just not deterministic when it happens. For example, the new thread might not yet have entered <code>run()</code> when you interrupt (although extremely unlikely with a sleep of 2 seconds), or it might have already entered the while loop (it takes some time to spin up and launch a thread, but the main thread might also have been paused to let a different thread/application run on the CPU, etc)."},{"owner":{"user_id":19526554,"display_name":"Marcos"},"edited":false,"comment_id":132890879,"body":"@f1sh The loop enter 19 times"},{"owner":{"user_id":217324,"display_name":"Nathan Hughes"},"edited":false,"comment_id":132891928,"body":"Sleep resets the interrupt flag so if you don&#39;t use break  the while test never detects it. Add a call to Thread.currentThread.interrupt in the catch block."},{"owner":{"user_id":19526554,"display_name":"Marcos"},"edited":false,"comment_id":132892088,"body":"@NathanHughes Yes, I think your answer the most accurate"}],"answers":[{"owner":{"user_id":217324,"display_name":"Nathan Hughes"},"up_vote_count":1,"is_accepted":true,"creation_date":1675266180,"answer_id":75312691,"body":"<p>Whenever the sleep method detects an interruption it resets the interrupt flag before throwing an InterruptedException. So if you don't use break then the interrupt flag is set to false by the time the exception is caught and the while loop test never detects the interruption.</p>\n<p>The recommended practice is to add a line to your catch block like this</p>\n<pre><code>Thread.currentThread.interrupt();\n</code></pre>\n<p>if you want to keep the interrupt status.</p>\n<p>It's not a problem here but be aware that Thread.interrupted() resets the interrupt flag. It's a convenience method used by some JDK code so that resetting the interrupt flag and throwing the exception takes less code.</p>\n"}],"owner":{"user_id":19526554,"display_name":"Marcos"},"view_count":68,"up_vote_count":2,"accepted_answer_id":75312691,"answer_count":1,"score":2,"creation_date":1675259450,"question_id":75311178,"body":"<p>I have a question about threads in Java.</p>\n<p>I have the following code:</p>\n<pre><code>public static void main(String[] args) {\n    Runnable r = () -&gt; {\n        while (!Thread.interrupted()) {\n            System.out.println(&quot;Hola&quot;);\n            try {\n                Thread.sleep(100);\n            } catch (InterruptedException e) {\n                System.out.println(&quot;interrupted&quot;);\n                break;\n            }\n        }\n    };\n\n    Thread t = new Thread(r);\n    t.start();\n\n    try {\n        Thread.sleep(2000);\n    } catch (InterruptedException ie) {\n        ie.printStackTrace();\n    }\n\n    t.interrupt();\n}\n</code></pre>\n<p>Why if I introduce an interrupt does it still enter the loop? (without break).</p>\n<p>I understand the operation of the thread when there is an exception.</p>\n"},{"tags":["java","android","firebase","google-cloud-platform","google-cloud-firestore"],"answers":[{"owner":{"user_id":5246885,"display_name":"Alex Mamo"},"up_vote_count":1,"is_accepted":true,"creation_date":1675240631,"answer_id":75307448,"body":"<p>When you're using <a href=\"https://firebase.google.com/docs/reference/android/com/google/firebase/firestore/FirebaseFirestore#batch()\" rel=\"nofollow noreferrer\">FirebaseFirestore#batch()</a> you aren't performing a transaction, but creating a <a href=\"https://firebase.google.com/docs/reference/android/com/google/firebase/firestore/WriteBatch\" rel=\"nofollow noreferrer\">WriteBatch</a>:</p>\n<blockquote>\n<p>Creates a write batch, used for performing multiple writes as a single atomic operation.</p>\n</blockquote>\n<p>So, it's an atomic operation and not a transaction. If you need to perform a transaction, please check the official documentation below:</p>\n<ul>\n<li><a href=\"https://firebase.google.com/docs/firestore/manage-data/transactions#transactions\" rel=\"nofollow noreferrer\">https://firebase.google.com/docs/firestore/manage-data/transactions#transactions</a></li>\n</ul>\n<p>So you should use <a href=\"https://firebase.google.com/docs/reference/android/com/google/firebase/firestore/FirebaseFirestore#runTransaction(com.google.firebase.firestore.Transaction.Function%3CTResult%3E)\" rel=\"nofollow noreferrer\">FirebaseFirestore#runTransaction()</a> which:</p>\n<blockquote>\n<p>Executes the given updateFunction and then attempts to commit the changes applied within the transaction.</p>\n</blockquote>\n"}],"owner":{"user_id":7474282,"display_name":"Taha Sami"},"view_count":55,"up_vote_count":2,"accepted_answer_id":75307448,"answer_count":1,"score":2,"creation_date":1675238867,"question_id":75307153,"body":"<p>I aim to insert the name in Cloud Firestore when the button is clicked, but I don't want the save to be pending if the user is not connected to the internet. I don't like the behavior of Firebase where it saves pending writes, even if the internet connection is restored.</p>\n<p>I researched and found that <a href=\"https://stackoverflow.com/questions/54308344/how-can-i-discard-pending-documentreference-writes-when-offline/54308526#54308526\">Firebase developers suggest using transactions</a> to prevent pending writes when there is no internet. I have tried this, but the result is still the same: if there is no internet, it saves pending writes, and when the internet connection is restored, it rewrites to Firestore. Why aren't transactions working as expected?</p>\n<pre><code>HashMap &lt; String, Object &gt; hashMap = new HashMap &lt; &gt; ();\nhashMap.put(&quot;Name&quot;, &quot;Test&quot;);\n\nFirebaseFirestore.getInstance().batch().set(FirebaseFirestore.getInstance().collection(&quot;LISTS&quot;).document(), hashMap).commit().addOnCompleteListener(new OnCompleteListener &lt; Void &gt; () {\n    @Override\n    public void onComplete(@NonNull Task&lt;Void&gt; task) {\n        Toast.makeText(MainActivity.this, &quot;&quot; + task, Toast.LENGTH_SHORT).show();\n        if (task.isSuccessful())\n            activityMainBinding.activityMainMaterialToolbarTopBar.setTitle(&quot;Done&quot;);\n        else\n            activityMainBinding.activityMainMaterialToolbarTopBar.setTitle(task.getException().getMessage());\n    }\n});\n</code></pre>\n<p>I am short on time as I want to deliver this project to the company on the specified date, and I don't want to waste time. If it's not possible to solve the problem with transactions, please let me know so I can look for alternative solutions.</p>\n"},{"tags":["java","gradle","google-cloud-platform","cloudbuild.yaml"],"comments":[{"owner":{"user_id":4629025,"display_name":"Raushan Kumar"},"edited":false,"comment_id":132879056,"body":"add entry point with gradle in cloudbuild.yaml  entrypoint: gradle"}],"answers":[{"owner":{"user_id":20173297,"display_name":"Soundarrajan"},"up_vote_count":1,"is_accepted":false,"creation_date":1678554493,"answer_id":75706575,"body":"<pre><code>steps:\n- name: gradle:7.6-jdk17\n  args: ['build']\n</code></pre>\n<p>In the above code you are using the gradle image directly instead of gcr.io/cloudbuilders/gradle which internally have the entrypoint as gradle\nSo there it will works</p>\n<pre><code>steps:\n- name: gcr.io/cloudbuilders/gradle\n  args: ['build']\n</code></pre>\n<p>But In your case you have to mention the entrypoint as gradle like below</p>\n<pre><code>steps:\n- name: gradle:7.6-jdk17\n  entrypoint: gradle\n  args: ['build']\n</code></pre>\n<p>Or</p>\n<pre><code>steps:\n- name: gradle:7.6-jdk17\n  args: ['gradle','build']\n</code></pre>\n"}],"owner":{"display_name":"user8787347"},"view_count":283,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1675210267,"question_id":75304413,"body":"<p>Can't figure out how to use Cloud Build + Gradle + Java 17 to build a Java Jar file.  I can't find any example cloudbuild.yaml that uses Gradle 7.6, which is required for my Gradle build.  I'm not trying to build an image, just a jar file.  The project is stored in GCP Cloud Source and includes the Gradle Wrapper.</p>\n<p>Here's the cloudbuild.yaml</p>\n<pre><code>steps:\n- name: gradle:7.6-jdk17\n  args: ['build']\n</code></pre>\n<p>Here's the cloudbuild error</p>\n<blockquote>\n<p>Status: Downloaded newer image for gradle:7.6-jdk17\ndocker.io/library/gradle:7.6-jdk17\nERROR\nERROR: build step 0 &quot;gradle:7.6-jdk17&quot; failed: starting step container failed: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: &quot;build&quot;: executable file not found in $PATH: unknown</p>\n</blockquote>\n<p>tried searching for example cloudbuild.yaml files for Java 17 + Gradle 7.6 - no luck</p>\n<p>tried using Google's examples, but they all use java 8</p>\n"},{"tags":["java","spring","spring-boot","maven"],"answers":[{"owner":{"user_id":10615258,"display_name":"Vinnicius Santos"},"up_vote_count":0,"is_accepted":false,"creation_date":1675180945,"answer_id":75299836,"body":"<p>The function <code>getBean()</code> supports parameters to supplier bean constructors. You can pass the proper GamingSoftware instance when you calling the <code>getBean(Class, Args...)</code></p>\n<p>Read more about get beans <a href=\"https://www.baeldung.com/spring-getbean#5-retrieving-bean-by-type-with-constructor-parameters\" rel=\"nofollow noreferrer\">here</a></p>\n"},{"owner":{"user_id":9443176,"display_name":"Max Aminov"},"up_vote_count":0,"is_accepted":false,"creation_date":1675181469,"answer_id":75299953,"body":"<p>You can create a property in <em>application.properties (or application.yml)</em> for example</p>\n<p><code>myapp.gametype=mario</code></p>\n<p>Then add to your @Component annotation @ConditionalOnProperty</p>\n<pre><code>@Component\n@ConditionalOnProperty(name = &quot;myapp.gametype&quot;, havingValue = &quot;mario&quot;)\npublic class SuperMario implements GamingSoftware {\n    public void up() { System.out.println(&quot;Super Mario: up&quot;); }\n    public void down() { System.out.println(&quot;Super Mario: down&quot;); }\n    public void left() {  System.out.println(&quot;Super Mario: left&quot;); }\n    public void right() { System.out.println(&quot;Super Mario: right&quot;); }\n}\n\n@Component\n@ConditionalOnProperty(name = &quot;myapp.gametype&quot;, havingValue = &quot;contra&quot;)\npublic class SuperContra implements GamingSoftware {\n    public void up() { System.out.println(&quot;Super Contra: up&quot;); }\n    public void down() { System.out.println(&quot;Super Contra: down&quot;); }\n    public void left() {  System.out.println(&quot;Super Contra: left&quot;); }\n    public void right() { System.out.println(&quot;Super Contra: right&quot;); }\n}\n</code></pre>\n<p>Next time Spring will create only one Bean of GamingSoftware interface depends on what value has your property.</p>\n"},{"owner":{"user_id":8041003,"display_name":"John Williams"},"up_vote_count":0,"is_accepted":false,"creation_date":1675181648,"answer_id":75299990,"body":"<p>Beans are created with a name based on the concrete class name (with first letter made lowercase). Try</p>\n<pre><code>applicationContext.getBean(“superMario”)\n</code></pre>\n"},{"owner":{"user_id":4764122,"display_name":"Rub&#233;n Aguado"},"up_vote_count":1,"is_accepted":true,"creation_date":1675202171,"answer_id":75303567,"body":"<p>In springboot the context is not loaded while applicationContext.getBean(). The context is loaded in SpringApplication.run(GamingDevice.class, args), so in that line is when the exception is throw.</p>\n<p>For runnig you must eliminate the @Autowired on GamingSoftware and load it using a set property:</p>\n<pre><code>    @Component\n    public class GameRunner {\n    \n        private GamingSoftware game;\n        \n        public void run() {\n            game.up();\n            game.down();\n            game.left();\n            game.right();\n        }\n    \n        public GamingSoftware getGame() {\n            return game;\n        }\n    \n        public void setGame(GamingSoftware game) {\n            this.game = game;\n        }\n        \n    }\n\n@SpringBootApplication\npublic class GamingDevice {\n\n    public static void main(String[] args) {\n         ConfigurableApplicationContext applicationContext = SpringApplication.run(GamingDevice.class, args);\n         GameRunner gameRunner = applicationContext.getBean(GameRunner.class);\n         gameRunner.setGame(applicationContext.getBean(&quot;superContra&quot;,GamingSoftware.class));\n         gameRunner.run();\n    }\n\n}\n</code></pre>\n"}],"owner":{"user_id":15982740,"display_name":"Souvik Das"},"view_count":46,"up_vote_count":2,"accepted_answer_id":75303567,"answer_count":4,"score":2,"creation_date":1675179267,"question_id":75299460,"body":"<p>I have the following classes and interfaces:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface GamingSoftware {\n    public void up();\n    public void down();\n    public void left();\n    public void right();\n}\n\n@Component\npublic class SuperMario implements GamingSoftware {\n    public void up() { System.out.println(&quot;Super Mario: up&quot;); }\n    public void down() { System.out.println(&quot;Super Mario: down&quot;); }\n    public void left() {  System.out.println(&quot;Super Mario: left&quot;); }\n    public void right() { System.out.println(&quot;Super Mario: right&quot;); }\n}\n\n@Component\npublic class SuperContra implements GamingSoftware {\n    public void up() { System.out.println(&quot;Super Contra: up&quot;); }\n    public void down() { System.out.println(&quot;Super Contra: down&quot;); }\n    public void left() {  System.out.println(&quot;Super Contra: left&quot;); }\n    public void right() { System.out.println(&quot;Super Contra: right&quot;); }\n}\n\n@Component\npublic class GameRunner {\n    @Autowired\n    private GamingSoftware game;\n    public GameRunner(GamingSoftware game) {\n        this.game = game;\n    }\n    public void run() {\n        game.up();\n        game.down();\n        game.left();\n        game.right();\n    }\n}\n\n@SpringBootApplication\npublic class GamingDevice {\n\n    public static void main(String[] args) {\n        ConfigurableApplicationContext applicationContext = SpringApplication.run(GamingDevice.class, args);\n        GameRunner gameRunner = applicationContext.getBean(GameRunner.class);\n        gameRunner.run();\n    }\n\n}\n</code></pre>\n<p>While getting the bean <code>applicationContext.getBean(GameRunner.class)</code>, I want to be able to specify the game for instantiating the <code>GamingSoftware</code> variable in the <code>GameRunner</code> class.</p>\n<p>When I run the above code it gives me an error like, Constructor for game runner required a single bean but 2 found <code>SuperMario</code> and <code>SuperContra</code>.</p>\n<p>How do I specify which component to use in my <code>applicationContext.getBean()</code> method?</p>\n"},{"tags":["java","spring","spring-boot","spring-data-jpa","java-17"],"comments":[{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":132868373,"body":"Please salvage your question and use proper formatting. Currently it is unreadable. What should be formatted (the code and stacktrace) isn&#39;t formatted but your actual question is, looks like te wrong way around."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":132868924,"body":"You seem to be managing a lot of dependencies which should be managed through Spring Boot. However, the main factor is that Spring Boot 3.0.0 comes with the very big breaking change of moving from Jakarta EE 8 / Java EE 8 to Jakarta EE 9+, and that comes with a lot of classes moving from the <code>javax.*</code> package namespace to the <code>jakarta.*</code> package namespace, and this includes things like the Java Persistence API, so if your code references those classes, you need to update to the new packages, and if you import libraries or plugins, you need to ensure they are also Jakarta EE 9 compatible."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":132868969,"body":"For example, your code explicitly depends on Hibernate 5.4, but Spring Boot 3 should depend on Hibernate 6 (6.1.6.Final in case of Spring Boot 3.0.2), and Hibernate 5.4 will not work as it still uses the package <code>javax.persistence</code> instead of <code>jakarta.persistence</code>. Similarly, Spring Boot 3 depends on log4j2 2.19.0, but you pull in 2.17.2."},{"owner":{"user_id":5436257,"display_name":"Joe Clay"},"edited":false,"comment_id":132869231,"body":"The <a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide\" rel=\"nofollow noreferrer\">official migration guide</a> is worth reading, if you haven&#39;t already - it covers many of the things that the other commenters have mentioned."},{"owner":{"user_id":37213,"display_name":"duffymo"},"edited":false,"comment_id":132872404,"body":"This is why you should use spring-boot-starter-parent: use the same versions as Spring Boot in your app."}],"answers":[{"owner":{"user_id":7237884,"display_name":"Panagiotis Bougioukos"},"up_vote_count":1,"is_accepted":false,"creation_date":1675183781,"answer_id":75300428,"body":"<p>Here is your problem that probably causes the <code>entityManagerFactory</code> issue.</p>\n<blockquote>\n<p>Below is gradle.properties file</p>\n<pre><code>hibernateVersion=5.4.26.Final\n</code></pre>\n</blockquote>\n<p><code>Spring boot 3.0.x</code> supports <strong>Jakarta EE 9</strong> and <strong>Jakarta EE 10</strong>.</p>\n<p>So you need to use at least hibernate <code>5.5.0.Final</code> version but better to migrate to hibernate <code>6.x</code> version. Reason is that <code>Spring boot 3.0</code> complies with <a href=\"https://jakarta.ee/release/9/\" rel=\"nofollow noreferrer\">Jakarta EE 9</a> which is based on <a href=\"https://jakarta.ee/specifications/persistence/3.0/\" rel=\"nofollow noreferrer\">Jakarta Persistence 3.0</a> and this was first implemented into hibernate <code>5.5.0.Final</code>.</p>\n<p><code>Spring boot 3.0</code> also complies with <a href=\"https://jakarta.ee/release/10/\" rel=\"nofollow noreferrer\">Jakarta EE 10</a> which is based on <a href=\"https://jakarta.ee/specifications/persistence/3.1/\" rel=\"nofollow noreferrer\">Jakarta Persistence 3.1</a> and this was first implemented into hibernate <code>6.0</code> version.</p>\n<p>The current version of spring boot at the time speaking is <code>3.0.2</code> and so if you take a look on the <code>cli</code> <a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/dependency-versions.html#appendix.dependency-versions.coordinates\" rel=\"nofollow noreferrer\">version coordinates</a> which is also the same as what <code>spring-initializer</code> uses to create a spring boot project plugging in the right dependencies you can see that it uses for spring boot <code>3.0.2</code> the <code>hibernate-core</code> version <code>6.1.6.Final</code>.</p>\n"}],"owner":{"user_id":5611353,"display_name":"Meherban"},"view_count":1483,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1675173509,"question_id":75298267,"body":"<p>In below I am creating EntityManagerfactory object and EntityManager object</p>\n<pre><code>    @Override\n    public boolean isTenantSchemaExist(String tenantId) {\n        EntityManagerFactory factory = \n            Persistence.createEntityManagerFactory(PERSISTENCE_UNIT_NAME);\n        EntityManager manager = factory.createEntityManager();\n        Query getSchemasQuery = manager.createNativeQuery(TENANT_SCHEMA_EXIST_QUERY);\n        List&lt;String&gt; tenantSchemas = new ArrayList(getSchemasQuery.getResultList());\n        return tenantSchemas.contains(tenantId);\n    }\n</code></pre>\n<p>Below is build.gradle file content</p>\n<pre><code>dependencies {\n    implementation &quot;org.apache.logging.log4j:log4j-core:2.17.1&quot;\n    implementation &quot;org.apache.logging.log4j:log4j-api:2.17.1&quot;\n    implementation &quot;org.apache.logging.log4j:log4j-1.2-api:2.17.1&quot;\n    implementation 'org.apache.logging.log4j:log4j-to-slf4j:2.17.1'\n    implementation &quot;com.nexidia:nexidia-semanticanalysis:${semanticanalysisVersion}&quot;\n    implementation(group: 'com.nexidia', name: 'nexidia-workbench', version: '10.6.2.13',                 \n    implementation ('org.springframework.boot:spring-boot-starter-web'){\n    exclude group : 'org.yaml' , module : 'snakeyaml'\n    }\n    implementation 'org.springframework.retry:spring-retry'\n    implementation (&quot;org.springframework.boot:spring-boot-starter-data-jpa&quot;){\n    exclude group : 'org.yaml' , module : 'snakeyaml'\n    exclude group: 'org.hibernate.orm', module: 'hibernate-core'\n    }\n       \n    implementation &quot;com.amazonaws:aws-java-sdk-dynamodb:${awsSDKVersion}&quot;\n    implementation (&quot;com.amazonaws:aws-java-sdk-core:${awsSDKVersion}&quot;){\n    exclude group : 'org.yaml' , module : 'snakeyaml'\n    }\n    implementation &quot;com.amazonaws:aws-java-sdk-ssm:${awsSDKVersion}&quot;\n    implementation &quot;com.xyc.abc.cat:lib-feature-flags:${featureFlagsLibVersion}&quot;\n    implementation &quot;com.google.guava:guava:${guavaVersion}&quot;\n    implementation &quot;org.flywaydb:flyway-core:${flywayVersion}&quot;\n    implementation group: 'commons-io', name: 'commons-io', version: '2.7'\n    //  For assuming role in local dev mode\n    implementation &quot;com.amazonaws:aws-java-sdk-sts:${awsSDKVersion}&quot;\n    implementation &quot;org.postgresql:postgresql:${postgresJdbcVersion}&quot;\n    /*implementation (&quot;org.hibernate:hibernate-c3p0:${hibernateVersion}&quot;){\n    exclude group : 'javax.persistence' , module : 'javax.persistence-api'\n    }*/\n    implementation &quot;org.apache.httpcomponents.client5:httpclient5:${httpclient5}&quot;\n    implementation 'jakarta.persistence:jakarta.persistence-api'\n    testImplementation &quot;cloud.localstack:localstack-utils:${localStackUtilsVersion}&quot;\n        testImplementation &quot;org.testcontainers:postgresql:${testPostgresVersion}&quot;\n    testImplementation &quot;junit:junit:${junitVersion}&quot;\n    testImplementation 'jakarta.persistence:jakarta.persistence-api'\n    testImplementation('org.springframework.boot:spring-boot-starter-test') {\n    exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'\n    exclude group : 'org.yaml' , module : 'snakeyaml'\n    }\n    }\n</code></pre>\n<p>Below is gradle.properties file</p>\n<pre><code>    semanticanalysisVersion=10.6.2.13\n    workbenchVersion=10.6.2.13\n    junitVersion=4.13.1\n    awsSDKVersion=1.11+\n    testPostgresVersion=1.15.0\n    jacocoVersion=0.8.7\n    localStackUtilsVersion=0.1.22\n    guavaVersion=31.1-jre\n    servicePort=80\n    version=22.1.0\n    serviceName=auto-discovery-model-generator\n    featureFlagsLibVersion=1.0.0-RELEASE\n    postgresJdbcVersion=42.4.1\n    hibernateVersion=5.4.26.Final\n    secretsManagerJdbcVersion=1.0.5\n    secretsManagerCacheVersion=1.0.1\n    flywayVersion=6.4.3\n    httpclient5=5.2\n    httpclient5Fluent=5.2\n</code></pre>\n<p>while I am getting below error on Jenkins build</p>\n<pre><code>15:13:59      2023-01-31T09:43:59.527Z  INFO 1626 --- \\[    Test worker\\]                                             com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Start completed \n15:13:59      2023-01-31T09:43:59.528Z  WARN 1626 --- \\[    Test worker\\]           o.s.w.c.s.GenericWebApplicationContext   : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource \\[org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class\\]: Class org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider does not implement the requested interface jakarta.persistence.spi.PersistenceProvider\n15:13:59      2023-01-31T09:43:59.529Z  INFO 1626 --- \\[    Test worker\\] com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Shutdown initiated...\n15:13:59      2023-01-31T09:43:59.529Z  INFO 1626 --- \\[    Test worker\\] com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Shutdown completed.\n15:13:59      2023-01-31T09:43:59.533Z  INFO 1626 --- \\[    Test worker\\] .s.b.a.l.ConditionEvaluationReportLogger :\n15:13:59  \n15:13:59      Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.\n15:13:59      2023-01-31T09:43:59.534Z ERROR 1626 --- \\[    Test worker\\] o.s.boot.SpringApplication               : Application run failed\n</code></pre>\n<p>Other portion of log below</p>\n<pre><code>15:14:04      2023-01-31T09:44:04.890Z  WARN 1626 --- \\[    Test worker\\] o.s.w.c.s.GenericWebApplicationContext   : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jpaSharedEM_entityManagerFactory': Cannot resolve reference to bean 'entityManagerFactory' while setting constructor argument\n15:14:04      2023-01-31T09:44:04.892Z  INFO 1626 --- \\[    Test worker\\] .s.b.a.l.ConditionEvaluationReportLogger :\n15:14:04  \n15:14:04      Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.\n15:14:04      2023-01-31T09:44:04.894Z ERROR 1626 --- \\[    Test worker\\] o.s.b.d.LoggingFailureAnalysisReporter   :\n15:14:04  \n15:14:04      \\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\n15:14:04      APPLICATION FAILED TO START\n15:14:04      \\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\n15:14:04  \n15:14:04      Description:\n15:14:04  \n15:14:04      A component required a bean named 'entityManagerFactory' that could not be found.\n15:14:04  \n15:14:04  \n15:14:04      Action:\n15:14:04  \n15:14:04      Consider defining a bean named 'entityManagerFactory' in your configuration.\n15:14:04  \n15:14:04  \n15:14:04  STANDARD_ERROR\n15:14:04  \n15:14:04\n</code></pre>\n<p>I have searched on net and applied those solutions but did not work out\nPlease suggest any possible solution for this problem with spring boot 3.0</p>\n"},{"tags":["java","spring-boot","unit-testing","groovy","spock"],"answers":[{"owner":{"user_id":2145769,"display_name":"Leonard Br&#252;nings"},"up_vote_count":1,"is_accepted":false,"creation_date":1675208304,"answer_id":75304240,"body":"<p>I can only recommend not to mock <code>WebClient</code> calls, as the necessary steps are a pain to mock, as you have seen yourself, requiring a lot of intermediary mocks without actually adding much value. This basically repeats the implementation, thus locking it in, which is not a good thing.</p>\n<p>What I usually do is to extract all code that interacts with <code>WebClient</code> into a client class, and only mock this class interactions in my code. From the looks of it this is what you are already doing with <code>TransitApiClient</code>. For these client classes, I would recommend testing them with <code>MockServer</code>, <code>WireMock</code>, or any of the other frameworks. This way you actually make sure that the correct request/responses are sent/received, and you don't have to awkwardly deal with the <code>WebClient</code> interface.</p>\n"}],"owner":{"user_id":21091863,"display_name":"JavaEnthusiast27"},"view_count":110,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1675159658,"question_id":75295523,"body":"<p>Using the custom WebClient below:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Slf4j\n@RequiredArgsConstructor\n@Component\npublic class TransitApiClient {\n\n    private final TransitApiClientProperties transitApiClientProperties;\n\n    private final WebClient transitApiWebClient;\n\n    private final OAuth2CustomClient oAuth2CustomClient;\n\n    public ResponseEntity&lt;Void&gt; isOfficeOfTransitValidAndNational(String officeId){\n        try {\n            final String url = UriComponentsBuilder.fromUriString(transitApiClientProperties.getFindOfficeOfTransit())\n                    .queryParam(&quot;codelistKey&quot;, &quot;CL173&quot;)\n                    .queryParam(&quot;itemCode&quot;, officeId)\n                    .build()\n                    .toUriString();\n\n            return transitApiWebClient.get()\n                    .uri(url)\n                    .header(AUTHORIZATION, getAccessTokenHeaderValue(oAuth2CustomClient.getJwtToken()))\n                    .retrieve()\n                    .onStatus(status -&gt; status.value() == HttpStatus.NO_CONTENT.value(),\n                            clientResponse -&gt; Mono.error( new InvalidOfficeException(null,\n                                    &quot;Invalid Office exception occurred while invoking :&quot; + transitApiClientProperties.getFindOfficeOfTransit() + officeId)))\n                    .toBodilessEntity()\n                    .block();\n\n        } catch (WebClientResponseException webClientResponseException) {\n            log.error(&quot;Technical exception occurred while invoking :&quot; + transitApiClientProperties.getFindOfficeOfTransit(), webClientResponseException);\n            throw new TechnicalErrorException(null, &quot;Technical exception occurred while trying to find &quot; + transitApiClientProperties.getFindOfficeOfTransit(), webClientResponseException);\n        }\n    }\n\n</code></pre>\n<p>with its intended usage to hit an endpoint, and check if it returns a 200 code with a body or 204 NoContent code, and react accordingly with some custom exceptions.</p>\n<p>I've implemented the groovy-spock test below :</p>\n<pre><code>class TransitApiClientSpec extends Specification {\n\n    private WebClient transitApiWebClient\n    private TransitApiClient transitApiClient\n    private OAuth2CustomClient oAuth2CustomClient\n    private TransitApiClientProperties transitApiClientProperties\n    private RequestBodyUriSpec requestBodyUriSpec\n    private RequestHeadersSpec requestHeadersSpec\n    private RequestBodySpec requestBodySpec\n    private ResponseSpec responseSpec\n    private RequestHeadersUriSpec requestHeadersUriSpec\n\n    def setup() {\n        transitApiClientProperties = new TransitApiClientProperties()\n        transitApiClientProperties.setServiceUrl(&quot;https://test-url&quot;)\n        transitApiClientProperties.setFindOfficeOfTransit(&quot;/transit?&quot;)\n        transitApiClientProperties.setUsername(&quot;username&quot;)\n        transitApiClientProperties.setPassword(&quot;password&quot;)\n        transitApiClientProperties.setAuthorizationGrantType(&quot;grantType&quot;)\n        transitApiClientProperties.setClientId(&quot;clientId&quot;)\n        transitApiClientProperties.setClientSecret(&quot;clientSecret&quot;)\n\n        oAuth2CustomClient = Stub(OAuth2CustomClient)\n        oAuth2CustomClient.getJwtToken() &gt;&gt; &quot;token&quot;\n        transitApiWebClient = Mock(WebClient)\n        requestHeadersSpec = Mock(RequestHeadersSpec)\n        responseSpec = Mock(ResponseSpec)\n        requestHeadersUriSpec = Mock(RequestHeadersUriSpec)\n        transitApiClient = new TransitApiClient(transitApiClientProperties, transitApiWebClient, oAuth2CustomClient)\n    }\n\n    def &quot;request validation of OoTra and throw InvalidOfficeException&quot;(){\n        given :\n        def officeId = &quot;testId&quot;\n        def uri = UriComponentsBuilder\n                .fromUriString(transitApiClientProperties.getFindOfficeOfTransit())\n                .queryParam(&quot;codelistKey&quot;, &quot;CL173&quot;)\n                .queryParam(&quot;itemCode&quot;, officeId)\n                .build()\n                .toUriString()\n\n        1 * transitApiWebClient.get() &gt;&gt; requestHeadersUriSpec\n        1 * requestHeadersUriSpec.uri(uri) &gt;&gt; requestHeadersSpec\n        1 * requestHeadersSpec.header(HttpHeaders.AUTHORIZATION, &quot;Bearer token&quot;) &gt;&gt; requestHeadersSpec\n        1 * requestHeadersSpec.retrieve() &gt;&gt; responseSpec\n        1 * responseSpec.onStatus() &gt;&gt; Mono.error( new InvalidOfficeException(null,null) )\n\n        when :\n        def response = transitApiClient.isOfficeOfTransitValidAndNational(officeId)\n\n        then :\n        thrown(InvalidOfficeException)\n    }\n\n</code></pre>\n<p>But instead of an <code>InvalidOfficeException</code> being thrown, a <code>java.lang.NullPointerException</code> is thrown.</p>\n<p>It seems to be triggered when during the test run, the program calls the following :</p>\n<pre class=\"lang-java prettyprint-override\"><code>\nreturn transitApiWebClient.get()\n     .uri(url)\n     .header(AUTHORIZATION, getAccessTokenHeaderValue(oAuth2CustomClient.getJwtToken()))\n     .retrieve()\n     .onStatus(status -&gt; status.value() == HttpStatus.NO_CONTENT.value(),\n                            clientResponse -&gt; Mono.error( new InvalidOfficeException(null,\n                                    &quot;Invalid Office exception occurred while invoking :&quot; + transitApiClientProperties.getFindOfficeOfTransit() + officeId)))\n     .toBodilessEntity()   &lt;---------------------- **HERE**\n     .block();\n\n</code></pre>\n<p>I understand that I haven't mocked its behavior but seems to me that some other mock hasn't been done correctly.</p>\n"},{"tags":["java","exception"],"comments":[{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":132848487,"body":"Don&#39;t create multiple scanners. Just create one, and call nextLine twice."},{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":132848580,"body":"Actually, does JUnit4 let you access System.in? I don&#39;t know what you mean by &quot;When I uploaded it to the JUnit4&quot;. This error seems to be caused when System.in gets closed. When using JUnit4 you might not get a System.in at all. Which line throws the exception?"},{"owner":{"user_id":112968,"display_name":"knittl"},"edited":false,"comment_id":132848639,"body":"For completeness&#39; sake: exception are thrown at <i>runtime</i>, which happens after compilations. Code might compile fine, but still have all sorts of problems and bugs. (How great would it be if code that compiled meant that it works and doesn&#39;t have bugs? One can dream …)"},{"owner":{"user_id":19471125,"display_name":"Salome"},"edited":false,"comment_id":132850885,"body":"I updated the post with a few more details. When I refer to uploading, I mean that students are to upload their draft/finished code to a cloud application-&gt; automated &quot;assignment tester &amp; grading&quot; software that uses JUnit4. So the cloud application I&#39;m uploading to is what checks my code. But since it has this error, it won&#39;t even run the test. It won&#39;t show a line number for the error, and my IDE isn&#39;t showing it at all either.  I&#39;m not sure how to &quot;Don&#39;t create multiple scanners&quot; but I will look that up."},{"owner":{"user_id":2684,"display_name":"Martin Marconcini"},"edited":false,"comment_id":132850952,"body":"&quot;I&#39;m not sure how to &quot;Don&#39;t create multiple scanners&quot;: you&#39;re creating a scanner twice, instead of creating one and call nextLine two times on the <i>same</i> Scanner. This is  what @matt meant."},{"owner":{"user_id":2684,"display_name":"Martin Marconcini"},"edited":false,"comment_id":132851013,"body":"Since you cannot see the correct stacktrace, it&#39;s impossible for you to tell which class is missing in the &quot;cloud&#39;s java&quot;. I suggest you try -if possible- to upload a simple hello world first, and then start adding line by line (where it makes sense) to see which one is causing the issue."}],"answers":[{"owner":{"user_id":2330053,"display_name":"Idle_Mind"},"up_vote_count":1,"is_accepted":false,"creation_date":1675100194,"answer_id":75288115,"body":"<p>Here's an example of using just ONE SCANNER as suggested in the comments.</p>\n<p>I've also eliminated the second set of variables for lower case; just convert the input directly to lower case and store it in the original variable:</p>\n<pre><code>  public static void main(String[] args) {\n    Scanner sc = new Scanner(System.in);\n    \n    System.out.println(&quot;Type a word:\\n&quot;);    \n    String word = sc.nextLine().toLowerCase();\n\n    System.out.println(&quot;Type a sentence:\\n&quot;);\n    String sentence = sc.nextLine().toLowerCase();\n\n    boolean isContains = sentence.contains(word);\n    System.out.println(isContains);\n  }\n</code></pre>\n<p>If you need to preserve the exact user input for later, then you can convert to lower case only when you call contains() like this:</p>\n<pre><code>  public static void main(String[] args) {\n    Scanner sc = new Scanner(System.in);\n    \n    System.out.println(&quot;Type a word:\\n&quot;);    \n    String word = sc.nextLine();\n\n    System.out.println(&quot;Type a sentence:\\n&quot;);\n    String sentence = sc.nextLine();\n\n    boolean isContains = sentence.toLowerCase().contains(word.toLowerCase());\n    System.out.println(isContains);\n  }\n</code></pre>\n"}],"owner":{"user_id":19471125,"display_name":"Salome"},"view_count":87,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1675091356,"question_id":75286300,"body":"<p>I get an error from automated JUnit 4 unit testing software that my course instructor uses to automatically check assignments.</p>\n<p>We upload our draft code to a cloud program tester which automatically checks and grades the assignments.</p>\n<p>This is week 1 of first semester. I've never coded in Java before. And the lessons haven't taught if/else, while, loops, switch etc. so I don't think it's okay to use those (they appear next module.)</p>\n<p>I followed a class video tutorial, which doesn't throw any exceptions in the tutorial — so I don't know what's going on.</p>\n<p>The unit was on variables, input, printing out, Booleans, operators, and a few things like contains, replace, equals etc.</p>\n<p>Note: I am allowed to ask questions on StackOverflow per instructor.</p>\n<p><strong>The error is: java.util.NoSuchElementException: No line found</strong></p>\n<p>No line number is specified in the testing software where the exception occurs. And since it's not happening in my IDE, I don't know where it is.</p>\n<p>Other solutions I've found require while and other methods I'm not supposed to use.</p>\n<p>My code (below) runs okay in the VSCODE IDE cloud the school provided.</p>\n<pre><code>import java.util.Scanner;\n\npublic class ContainsAnyCase {\n\n  public static void main(String[] args) {\n    System.out.println(&quot;Type a word:\\n&quot;);\n\n    Scanner userInputWord = new Scanner(System.in);\n\n    String word = userInputWord.nextLine();\n\n    String wordlc = word.toLowerCase();\n\n    System.out.println(&quot;Type a sentence:\\n&quot;);\n\n    Scanner userInputSentence = new Scanner(System.in);\n\n    String sentence = userInputSentence.nextLine();\n\n    String sentencelc = sentence.toLowerCase();\n\n    boolean isContains = sentencelc.contains(wordlc);\n\n    System.out.println(isContains);\n\n  }\n}\n</code></pre>\n<p>I'm wondering if anyone can explain why there is an error and if there are ways to fix it or avoid the error without going into the territory of future modules? Also, I'm still learning how to use Stack Overflow appropriately. If I asked my question wrong, please advise how I can improve my question or post. Thank you.</p>\n<p>I expected for the program to tell me true/false if the word was in the sentence. In my IDE, it worked. When I uploaded it to the JUnit4, it said java.util.NoSuchElementException: No line found</p>\n"},{"tags":["java","kotlin","groovy","overloading"],"answers":[{"owner":{"user_id":869736,"display_name":"Louis Wasserman"},"up_vote_count":1,"is_accepted":true,"creation_date":1675019803,"answer_id":75277675,"body":"<p>The main problem is that in Kotlin, <em>everything</em> returns -- they may just return <code>Unit</code>.  There is no <code>void</code>.</p>\n<p>On the other hand, this may mean there is no need to distinguish between these types, you can just have the &quot;with return&quot; version.</p>\n"}],"owner":{"user_id":54684,"display_name":"Mykola Golubyev"},"view_count":53,"up_vote_count":2,"accepted_answer_id":75277675,"answer_count":1,"score":2,"creation_date":1675017844,"question_id":75277476,"body":"<p>very new to Kotlin and trying to make some of my API work in Kotlin without changing API much.</p>\n<p>I have a method, let's call it <code>client</code> that receives a <code>validation</code> function. There are two variants of <code>Validation</code>. One that only suppose to do a validation, and the other can also return a value. To streamline user experience, in Java, I exposed two variants of the method. And it works as expected as I believe Java distincts between <code>void</code> and <code>Object</code> (&lt;R&gt;).</p>\n<p>When I use my code in Kotlin, it can't distinct between two and I need to provide an explicit cast.</p>\n<p>To remove Java from equation, I tried to replicate the situation in Kotlin using functional interfaces:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>fun interface KotlinValidator {\n    fun validate()\n}\n\nfun interface KotlinValidatorWithReturn {\n    fun validateAndReturn(): Any\n}\n\nfun client(validator: KotlinValidator) {\n    println(&quot;validator NO return&quot;)\n    validator.validate()\n}\n\nfun client(validatorAndReturn: KotlinValidatorWithReturn): Any {\n    println(&quot;validator WITH return&quot;)\n    return validatorAndReturn.validateAndReturn()\n}\n\nfun test() {\n    val fromValidator = client {\n        100\n    }\n\n    val fromValidatorForced = client(KotlinValidatorWithReturn {\n        100\n    })\n\n    client {\n    }\n}\n</code></pre>\n<p>it prints</p>\n<pre><code>validator NO return\nvalidator WITH return\nvalidator NO return\n</code></pre>\n<p>Based on my googling, it seems to be not possible to make it work without an explicit cast. However I hope that I am wrong as Groovy and Java let me do it.</p>\n<p>To provide more context, I am trying to make <a href=\"https://github.com/testingisdocumenting/webtau\" rel=\"nofollow noreferrer\">WebTau</a> HTTP module work nicely with Kotlin.</p>\n<p>In Java and Groovy version I can do:</p>\n<pre class=\"lang-java prettyprint-override\"><code>int id = http.post(&quot;/customers&quot;, customerPayload, ((header, body) -&gt; {\n    return body.get(&quot;id&quot;); \n}));\n\nhttp.put(&quot;/customers/&quot; + id, changedCustomerPayload, ((header, body) -&gt; {\n    body.get(&quot;firstName&quot;).should(equal(&quot;FN&quot;));\n    body.get(&quot;lastName&quot;).should(equal(changedLastName));\n}));\n</code></pre>\n<p>In Groovy:</p>\n<pre><code>def id = http.post(&quot;/customers&quot;, customerPayload) {\n    body.id \n}\n</code></pre>\n<p>But in Kotlin:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>val id: Int = http.post(&quot;/customers&quot;, customerPayload, HttpResponseValidatorWithReturn { _, body -&gt;\n    body.get(&quot;id&quot;)\n})\n</code></pre>\n<p>The reason I brought this example is at the moment I am reluctant to change API and rename functions to distinct between the ones that return a value and the ones that don't.</p>\n"},{"tags":["java","maven","telosys"],"answers":[{"owner":{"user_id":3764947,"display_name":"CrazedCoder"},"up_vote_count":0,"is_accepted":false,"creation_date":1674848137,"answer_id":75262610,"body":"<p>Seems like you may be looking for <a href=\"https://www.telosys.org/templates-doc/objects/target.html\" rel=\"nofollow noreferrer\">$target</a></p>\n<pre><code>$target.javaPackageFromFolder(String srcFolder)\n</code></pre>\n"},{"owner":{"user_id":2067631,"display_name":"lgu"},"up_vote_count":1,"is_accepted":true,"creation_date":1675088364,"answer_id":75285720,"body":"<p>To generate a multi-modules Maven project I recommend the following approach :</p>\n<ol>\n<li>At <strong>Telosys project level</strong> define a specific global variable for each module in the file &quot;<strong>telosys.cfg</strong>&quot; and define the &quot;root package&quot; variable</li>\n</ol>\n<p>Example:</p>\n<pre><code># Root package (will be used as &quot;root folder&quot; in targets)\nROOT_PKG = org.demo.orders\n\n# Maven project / parent  :\nProjectVariable.MODULE_PARENT = orders-parent\n\n# Maven project / modules :\nProjectVariable.MODULE_MICROSERVICE   = orders-microservice\nProjectVariable.MODULE_DOMAIN         = orders-domain\nProjectVariable.MODULE_INFRA_MYBATIS  = orders-infra-mybatis\nProjectVariable.MODULE_INFRA_ELASTIC  = orders-infra-elastic\nProjectVariable.MODULE_INFRA_RABBITMQ = orders-infra-rabbitmq\n</code></pre>\n<p>You can keep the usual values for the standard variables:</p>\n<pre><code>SRC      = src/main/java\nRES      = src/main/resources\nWEB      = src/main/webapp\nTEST_SRC = src/test/java\nTEST_RES = src/test/resources\nDOC      = doc\nTMP      = tmp\n</code></pre>\n<ol start=\"2\">\n<li>At <strong>Telosys templates level</strong> (in each bundle) use the global variables to define the target folder in the file &quot;<strong>templates.cfg</strong>&quot;</li>\n</ol>\n<p>You can combine $SRC, $MODULE_XXX and $ROOT_PKG to build the destination directory</p>\n<p>Example (project modules initialization):</p>\n<pre><code># &quot;microservice&quot; module\n; pom.xml                    ; ${MODULE_MICROSERVICE}                     ; microservice/microservice-pom_xml.vm; 1 \n; README.md                  ; ${MODULE_MICROSERVICE}                     ; microservice/README_md.vm ; 1 \n; SpringBootApp.java         ; ${MODULE_MICROSERVICE}/${SRC}/${ROOT_PKG}  ; microservice/SpringBootApp_java.vm    ; 1 \n; application.properties     ; ${MODULE_MICROSERVICE}/${RES}              ; microservice/application_properties.vm    ; 1 \n; application-dev.properties ; ${MODULE_MICROSERVICE}/${RES}              ; microservice/application-dev_properties.vm; 1 \n\n# Other modules initialization\n; pom.xml ; ${MODULE_DOMAIN}        ; modules/domain-pom_xml.vm  ; 1 \n; pom.xml ; ${MODULE_INFRA_MYBATIS} ; modules/infra-mybatis-pom_xml.vm   ; 1 \n; pom.xml ; ${MODULE_INFRA_ELASTIC} ; modules/infra-elastic-pom_xml.vm   ; 1 \n; pom.xml ; ${MODULE_INFRA_RABBITMQ}; modules/infra-rabbitmq-pom_xml.vm   ; 1 \n; pom.xml ; ${MODULE_REST_APP}      ; modules/rest-app-pom_xml.vm   ; 1 \n; pom.xml ; ${MODULE_REST_DTO}      ; modules/rest-dto-pom_xml.vm   ; 1 \n</code></pre>\n<p>Other example (in the bundle for &quot;domain&quot; module):</p>\n<pre><code>pom.xml file    ; pom.xml      ; ${MODULE_DOMAIN} ; domain-pom_xml.vm      ; 1\nreadme file     ; README.md    ; ${MODULE_DOMAIN} ; domain-readme_md.vm    ; 1 \n\nEntity        ; Entity.java                  ; ${MODULE_DOMAIN}/${SRC}/${ROOT_PKG}/domain/common ; domain-common/Entity_java.vm  ; 1 \nAggregRoot    ; AggregateRoot.java           ; ${MODULE_DOMAIN}/${SRC}/${ROOT_PKG}/domain/common ; domain-common/AggregateRoot_java.vm  ; 1 \nAggregRootRepo; AggregateRootRepository.java ; ${MODULE_DOMAIN}/${SRC}/${ROOT_PKG}/domain/common ; domain-common/AggregateRootRepository_java.vm  ; 1\n</code></pre>\n<ol start=\"3\">\n<li>With multiple source folders the Java package can be determined in 2 ways\nin <strong>templates</strong> (.vm files):</li>\n</ol>\n<ul>\n<li>using $target.javaPackageFromFolder() with the composite source folder,<br />\nexample:</li>\n</ul>\n<blockquote>\n<p>package ${target.javaPackageFromFolder(&quot;<strong>${MODULE_DOMAIN}/${SRC}</strong>&quot;)} ;</p>\n</blockquote>\n<ul>\n<li>using the ${ROOT_PKG} variable and adding the specific part of the package,<br />\nexample:</li>\n</ul>\n<blockquote>\n<p>package <strong>${ROOT_PKG}</strong>.my.sub.pkg ;</p>\n</blockquote>\n<p>the ending part of the package name is not supposed to change, but if you want you can also use a global variable to define it. Example:</p>\n<blockquote>\n<p>package <strong>${ROOT_PKG}</strong>.<strong>${DOMAIN_PKG}</strong> ;</p>\n</blockquote>\n"},{"owner":{"user_id":937808,"display_name":"Michael Ressler"},"up_vote_count":0,"is_accepted":false,"creation_date":1675389624,"answer_id":75330771,"body":"<p>My current solution involves a <code>distribution.sh</code> script that copies out of the <code>src</code> folder to the appropriate destinations. This works fairly well as the packages that I'm writing to are unique across my modules. But if two of my modules have the same module, I'll be out of luck.</p>\n<pre><code>#!/bin/bash\ncp -rv src/main/java/my/company/model/* service-core/src/main/java/my/company/model\ncp -rv src/main/java/my/company/dao/* service-core/src/main/java/my/company/dao\ncp -rv src/main/java/my/company/service/* service-core/src/main/java/my/company/service\ncp -rv src/main/java/my/company/dto/* dto-public/src/main/java/my/company/dto\ncp -rv src/main/java/my/company/web/v6/* api-public/src/main/java/my/company/web/v6\ncp -rv src/main/java/my/company/web/integration/v6/* common-test/src/main/java/my/company/web/integration\ncp -rv src/test/java/my/company/web/integration/v6/* api-public/src/test/java/my/company/web/integration/v6\n\n</code></pre>\n"}],"owner":{"user_id":937808,"display_name":"Michael Ressler"},"view_count":88,"up_vote_count":2,"accepted_answer_id":75285720,"answer_count":3,"score":2,"creation_date":1674847331,"question_id":75262499,"body":"<p>I have a Maven project with several submodules inside of it. They are packaged up so that I can reuse the code across several microservices. I can generate my Java classes in the parent project as I would like them to be, however, when I attempt to generate a class in a subdirectory my a package declaration that looks like:</p>\n<p><code>package ${target.javaPackageFromFolder(${SRC})};</code></p>\n<p>In a template will resolve to:</p>\n<p><code>package error.folder.not.started.with.the.given.src.folder.activities;</code></p>\n<p>In the <code>.java</code> class. This is understandable since my <code>$SRC</code> is at <code>src/main/java</code> and not <code>service-core/src/main/java</code>.</p>\n<p>All of my modules are organized the same way, with <code>$SRC</code> at <code>src/main/java</code>, if I could just inform Telosys about the existence of these modules, I would be able to generate the code in the right place without needing to move it after generation.</p>\n<p>I would just <code>init</code> Telosys in the <code>service-core</code> module, but I would also like to support generating DTOs in <code>dto-public</code> and controllers/tests in my <code>api-public</code>. Is there any way to support this in Telosys?</p>\n<p>Things I've tried:</p>\n<ul>\n<li>Adding a parent <code>.vm</code> file that calls <code>$generator.generate</code> with a different directory. This configuration produces the above result.</li>\n<li>Changing the generated directory in the <code>templates.cfg</code> to include <code>service-core/${SRC}/${ROOT_PKG}/model/</code>. This configuration also produces the above result.</li>\n</ul>\n"},{"tags":["java","spring-boot","jpa","spring-data-jpa","crud"],"answers":[{"owner":{"user_id":1604048,"display_name":"Murat Yıldız"},"up_vote_count":1,"is_accepted":false,"creation_date":1674839239,"answer_id":75261222,"body":"<p>Try to update <code>SiteUser</code> fields as shown below:</p>\n<pre><code>@ManyToOne(optional = true, fetch = FetchType.LAZY)\n@JoinColumn(name = &quot;site_user_id&quot;, referencedColumnName = &quot;id&quot;)\nprivate SiteUser siteUser;\n</code></pre>\n"},{"owner":{"user_id":1143399,"display_name":"Tusar"},"up_vote_count":0,"is_accepted":false,"creation_date":1675081397,"answer_id":75284325,"body":"<p>I think the issue is with the category_name. It is not following the standard naming convention. Underscore is used to separate property names in JPA custom methods.</p>\n<pre><code>@Column(name = &quot;category_name&quot;)\nprivate String categoryName;\n</code></pre>\n<p>NB: Also you have to implement the changes mentioned by Murat. Use optional = false if it is Not Null in DB</p>\n"}],"owner":{"user_id":19226314,"display_name":"whgus613"},"view_count":73,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1674838707,"question_id":75261134,"body":"<p>I created POST API in Spring Boot, but 500 error occurs.</p>\n<blockquote>\n<p>&quot;timestamp&quot;: &quot;2023-01-27T16:27:32.609+00:00&quot;,\n&quot;status&quot;: 500,\n&quot;error&quot;: &quot;Internal Server Error&quot;,\n&quot;trace&quot;: &quot;org.springframework.dao.DataIntegrityViolationException: could not execute statement; SQL [n/a]; constraint [&quot;PRIMARY KEY ON PUBLIC.CATEGORY(CATEGORY_ID) ( /* key:1 */ 1, U&amp;'\\\\c1fc\\\\d551\\\\bab0', 1)&quot;; SQL statement:\\ninsert into category (category_id, category_name, site_user_id) values (default, ?, ?)</p>\n</blockquote>\n<p>I want to put data in the 'category' table with 'categoryId', 'category_name', and 'site_user_id' as columns through POST API. It seems to be caused by putting 'siteUser' entity instead of 'site_user_id', but I don't know how to modify the code.</p>\n<p>Below is the code I wrote.</p>\n<p><strong>Category.java</strong></p>\n<pre><code>package com.kakaotrack.choco.linkupapi.category;\n\nimport com.fasterxml.jackson.annotation.JsonIgnoreProperties;\nimport com.kakaotrack.choco.linkupapi.linkcollection.LinkCollection;\nimport com.kakaotrack.choco.linkupapi.user.SiteUser;\nimport jakarta.persistence.*;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.util.List;\n\n@Entity\n@Data\n@Table(name = &quot;category&quot;)\n@NoArgsConstructor\npublic class Category {\n\n    public Category(String category_name, SiteUser siteUser){\n        this.category_name = category_name;\n        this.siteUser = siteUser;\n    }\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private int categoryId;\n\n    private String category_name;\n\n    @OneToMany(mappedBy = &quot;category&quot;, cascade = CascadeType.REMOVE)\n    @JsonIgnoreProperties({&quot;category&quot;})\n    private List&lt;LinkCollection&gt; link_collection_list;\n\n    @ManyToOne\n    private SiteUser siteUser;\n\n}\n\n</code></pre>\n<p><strong>SiteUser.java</strong></p>\n<pre><code>package com.kakaotrack.choco.linkupapi.user;\n\nimport jakarta.persistence.*;\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\nimport lombok.Setter;\n\n@Getter\n@Setter\n@Entity\n@Table(name = &quot;users&quot;)\n@NoArgsConstructor\npublic class SiteUser {\n\n    public SiteUser(String username, String email){\n        this.username=username;\n        this.email=email;\n    }\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private int id;\n\n    @Column(unique = true)\n    private String username;\n\n    private String password;\n\n    @Column(unique = true)\n    private String email;\n}\n\n</code></pre>\n<p><strong>CategoryService.java</strong></p>\n<pre><code>package com.kakaotrack.choco.linkupapi.category;\n\nimport com.kakaotrack.choco.linkupapi.linkcollection.LinkCollection;\nimport com.kakaotrack.choco.linkupapi.user.SiteUser;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\n\nimport java.util.List;\n\n@RequiredArgsConstructor\n@Service\npublic class CategoryService {\n\n    private final CategoryRepository categoryRepository;\n\n    public List&lt;Category&gt; getAll() {return categoryRepository.findAll();}\n\n    public List&lt;Category&gt; getBySiteUser(int id){\n        return categoryRepository.findBySiteUserId(id);\n    }\n\n    public Category createCategory(String categoryName, SiteUser siteUser){\n        Category category = new Category(categoryName, siteUser);\n        return categoryRepository.save(category);\n    }\n\n    public void deleteByCategoryId(int category_id){categoryRepository.deleteById(category_id);}\n\n}\n\n</code></pre>\n<p><strong>CategoryController.java</strong></p>\n<pre><code>package com.kakaotrack.choco.linkupapi.category;\n\nimport com.kakaotrack.choco.linkupapi.linkcollection.LinkCollection;\nimport com.kakaotrack.choco.linkupapi.linkcollection.LinkCollectionRepository;\nimport com.kakaotrack.choco.linkupapi.user.SiteUser;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.List;\n\n@RestController\n@RequiredArgsConstructor\npublic class CategoryController {\n\n    private final CategoryService categoryService;\n\n    @GetMapping(value = &quot;/categories&quot;)\n    public List&lt;Category&gt; getAll() {return categoryService.getAll();}\n\n    @GetMapping(value = &quot;/categories/{id}&quot;)\n    public List&lt;Category&gt; getBySiteUser(@PathVariable int id) {return categoryService.getBySiteUser(id);}\n\n    @PostMapping(value = &quot;/categories&quot;)\n    public Category createCategory(String categoryName, SiteUser siteUser){\n        Category category = categoryService.createCategory(categoryName, siteUser);\n        return category;\n    }\n\n    @DeleteMapping(value = &quot;/categories/{category_id}&quot;)\n    public void deleteCategory(@PathVariable int category_id){ categoryService.deleteByCategoryId(category_id);}\n\n}\n\n</code></pre>\n<p>DELETE and GET APIs work well.</p>\n"},{"tags":["java","android","statusbar","android-statusbar","android-window"],"answers":[{"owner":{"user_id":9851608,"display_name":"Zain"},"up_vote_count":1,"is_accepted":true,"creation_date":1674829824,"answer_id":75259470,"body":"<p>You can solve this by consuming the insets dispatch event by returning <code>WindowInsetsCompat.CONSUMED</code> instead of <code>insets</code></p>\n<p><a href=\"https://developer.android.com/reference/androidx/core/view/WindowInsetsCompat#CONSUMED()\" rel=\"nofollow noreferrer\">Per documentation</a>:</p>\n<blockquote>\n<p>This can be used during insets dispatch in the view hierarchy by returning this value from View.onApplyWindowInsets(WindowInsets) or onApplyWindowInsets to stop dispatch the insets to its children to avoid traversing the entire view hierarchy.</p>\n<p>The application should return this instance once it has taken care of all insets on a certain level in the view hierarchy, and doesn't need to dispatch to its children anymore for better performance.</p>\n</blockquote>\n<p><strong>UPDATE:</strong></p>\n<blockquote>\n<p>This does work, seems like it just pushes the action bar up to the top of the screen, leaving the action bar higher than normally. But I guess I can just add some height and padding to the top of the action bar to prevent this.</p>\n</blockquote>\n<p>Well, that does seem to make the activity full screen, even intersects with the navigation bar as well.</p>\n<p>Now to fix that return the following instead:</p>\n<pre><code>ViewCompat.onApplyWindowInsets(v, insets)\n</code></pre>\n<pre><code>ViewCompat.setOnApplyWindowInsetsListener(this.getWindow().getDecorView(), (v, insets) -&gt; {\n\n        int keyboardHeight = insets.getInsets(WindowInsetsCompat.Type.ime()).bottom;\n\n        //Do your job here\n        Log.d(&quot;Keyboard height: &quot;, String.valueOf(keyboardHeight));\n\n        SharedPreferences preferences = this.getSharedPreferences(&quot;MyPreferences&quot;, Context.MODE_PRIVATE);\n        SharedPreferences.Editor editor = preferences.edit();\n\n        if (keyboardHeight &gt; 0) {\n            bottom.getLayoutParams().height = 0;\n            editor.putInt(&quot;keyboard_height&quot;, keyboardHeight);\n        } else {\n            bottom.getLayoutParams().height = preferences.getInt(&quot;keyboard_height&quot;, 500);\n        }\n\n        editor.apply();\n\n        return ViewCompat.onApplyWindowInsets(v, insets);\n    });\n</code></pre>\n"}],"owner":{"user_id":1734802,"display_name":"Peter"},"view_count":226,"up_vote_count":2,"accepted_answer_id":75259470,"answer_count":1,"score":2,"creation_date":1674823922,"question_id":75258374,"body":"<p>This is the code I use to detect when the <code>Keyboard Height</code> changes.</p>\n<p>Only the problem is that the <code>Statur Bar</code> color disappears and turns white when this code runs.</p>\n<pre><code>ViewCompat.setOnApplyWindowInsetsListener(this.getWindow().getDecorView(), (v, insets) -&gt; {\n\n        int keyboardHeight = insets.getInsets(WindowInsetsCompat.Type.ime()).bottom;\n\n        //Do your job here\n        Log.d(&quot;Keyboard height: &quot;, String.valueOf(keyboardHeight));\n\n        SharedPreferences preferences = this.getSharedPreferences(&quot;MyPreferences&quot;, Context.MODE_PRIVATE);\n        SharedPreferences.Editor editor = preferences.edit();\n\n        if (keyboardHeight &gt; 0) {\n            bottom.getLayoutParams().height = 0;\n            editor.putInt(&quot;keyboard_height&quot;, keyboardHeight);\n        } else {\n            bottom.getLayoutParams().height = preferences.getInt(&quot;keyboard_height&quot;, 500);\n        }\n\n        editor.apply();\n\n        return insets;\n});\n</code></pre>\n<p>Any alternative code that doesn't alter the <code>Status Bar</code> color?</p>\n<p>Or any way to programmatically re-add the <code>Status Bar</code> color after this code runs?</p>\n"},{"tags":["java","android","gradle","javadoc"],"answers":[{"owner":{"user_id":2174504,"display_name":"Joan P.S"},"up_vote_count":1,"is_accepted":false,"creation_date":1674811308,"answer_id":75256119,"body":"<p>After more investigation I found the way to exclude files from the javadoc. Apparently there is a bug in the gradle task and the following workaround will allow the javadoc task to finish gratefully</p>\n<pre><code>task javadoc(type: Javadoc) {\n    source = android.sourceSets.main.java.sourceFiles\n    exclude 'com/example/customlib/internal/Utils.java'\n\n    // The following lines will workaround the problem with the exclude\n    var sourceSetDirectories = android.sourceSets.main.java.srcDirs.join(&quot;:&quot;)\n    options.addStringOption(&quot;-source-path&quot;, sourceSetDirectories)\n}\n</code></pre>\n<p>If the library has references to other libs like androidx or android classes, add the <code>classpath</code> parameter and <code>option.links</code>:</p>\n<pre><code>task javadoc(type: Javadoc) {\n    // failOnError false -&gt; This will tell gradle the job was successful but nothing is generated\n    source = android.sourceSets.main.java.sourceFiles\n    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))\n    options {\n        links &quot;http://docs.oracle.com/javase/7/docs/api/&quot;\n        linksOffline('https://d.android.com/reference/', 'https://d.android.com/reference/androidx/')\n    }\n\n    exclude 'com/example/customlib/internal/Utils.java'\n\n    // The following lines will workaround the problem with the exclude\n    var sourceSetDirectories = android.sourceSets.main.java.srcDirs.join(&quot;:&quot;)\n    options.addStringOption(&quot;-source-path&quot;, sourceSetDirectories)\n}\n</code></pre>\n"}],"owner":{"user_id":2174504,"display_name":"Joan P.S"},"view_count":123,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1674739158,"question_id":75246690,"body":"<p>I'm trying to build the javadoc for a library which contains some internal classes which are not relevant for the developers. Previously with java 1.6 I was able to exclude the classes I don't want to appear in the javadoc using the <code>exclude</code> option, But since java 8 this is not the case anymore. When I use the <code>exclude</code> option the classes are just removed and the javadoc lint throws an error because other classes need the internal classes which I want to exclude. Here the example:</p>\n<pre><code>task javadoc(type: Javadoc) {\n    // failOnError false -&gt; This will tell gradle the job was successful but nothing is generated\n    source = android.sourceSets.main.java.sourceFiles\n    exclude 'com/example/customlib/internal/Utils.java'\n}\n</code></pre>\n<p>Running the task throws the following error:</p>\n<pre><code>[..]/customlib/src/main/java/com/example/customlib/Foo.java:3: error: package com.example.customlib.internal does not exist\n</code></pre>\n<p>After searching a solution I came across many proposals but non of them worked. It appears the javadoc lint is firing the error when it generates the docs. Then I've tried disabling the lint for the specific file as follows:</p>\n<pre><code>task javadoc(type: Javadoc) {\n    source = android.sourceSets.main.java.sourceFiles\n    exclude 'com/example/customlib/internal/Utils.java'\n    options.addStringOption('Xdoclint:none src/main/java/com/example/customlib/internal/Utils.java', '-quiet')\n}\n</code></pre>\n<p>Now the tasks succeed but the classes I want to exclude are present in the generated javadoc.</p>\n<p>Does anybody knows how to remove specific classes/packages from the generated javadoc?</p>\n"},{"tags":["java","spring-boot","spring-security","graalvm","graalvm-native-image"],"answers":[{"owner":{"user_id":9544067,"display_name":"V. Perfilev"},"up_vote_count":1,"is_accepted":true,"creation_date":1676305080,"answer_id":75438517,"body":"<p>I have had the same problem, and the cause was the dependency &quot;springdoc-openapi-ui&quot;.</p>\n<pre><code>// implementation(&quot;org.springdoc:springdoc-openapi-ui:1.6.14&quot;)\nimplementation(&quot;org.springdoc:springdoc-openapi-starter-webmvc-ui:2.0.2&quot;)\n</code></pre>\n"}],"owner":{"user_id":20068533,"display_name":"Farid Guluzade"},"view_count":181,"up_vote_count":2,"accepted_answer_id":75438517,"answer_count":1,"score":2,"creation_date":1674731983,"question_id":75245400,"body":"<p>I upgraded Spring boot version 3.0.2 and i try graalvm nativeCompile that is error happened.</p>\n<p>I run this application normal way it is OK but i try executable file show this error.</p>\n<pre><code> Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration': Unsatisfied dependency expressed through method 'setFilterChains' parameter 0: Error creating bean with name 'mvcHandlerMappingIntrospector': Error creating bean with name 'resourceHandlerMapping': Instantiation of supplied bean failed\n</code></pre>\n<pre><code>org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration': Unsatisfied dependency expressed through method 'setFilterChains' parameter 0: Error creating bean with name 'mvcHandlerMappingIntrospector': Error creating bean with name 'resourceHandlerMapping': Instantiation of supplied bean failed\n</code></pre>\n<p>i try use this annotation register bean , unfortunately repeat again error</p>\n<pre><code>@RegisterReflectionForBinding\n</code></pre>\n<p>that is my security configuration</p>\n<pre><code>@Configuration\n@EnableMethodSecurity\n@EnableWebSecurity\npublic class SecurityConfiguration {\n\n       @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {\n        httpSecurity\n                .csrf().disable()\n                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n                .and()\n                .headers()\n                .and()\n                .authorizeHttpRequests()\n                .anyRequest().authenticated()\n                .and()\n                .addFilterBefore(getAuthContext(),\n                        UsernamePasswordAuthenticationFilter.class);\n        return httpSecurity.build();\n    }\n\n\n    @Bean\n    public AuthContextFilter1 getAuthContext() {\n        return new AuthContextFilter1();\n    }\n\n}\n\n\nthat is my authContextFilter class\n\n\n@Slf4j\npublic class AuthContextFilter1 extends GenericFilterBean {\n\n    private static final String X_CLIENT_ID = &quot;ID&quot;;\n    private static final String X_CLIENT_ROLES = &quot;ROLE&quot;;\n    private static final String ROLE_PREFIX = &quot;ROLE_&quot;;\n\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {\n        Collection&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();\n        HttpServletRequest httpServletRequest = (HttpServletRequest) request;\n        String clientId = httpServletRequest.getHeader(X_CLIENT_ID);\n        String roles = httpServletRequest.getHeader(X_CLIENT_ROLES);\n\n        if (Objects.nonNull(clientId)) {\n            try {\n                if ((!StringUtils.isEmpty(roles))) {\n                    authorities = Arrays.stream(roles.split(&quot;,&quot;))\n                            .map(role -&gt; new SimpleGrantedAuthority(ROLE_PREFIX + role))\n                            .collect(Collectors.toList());\n                }\n\n                Authentication auth = new CustomAuthentication(clientId, authorities);\n                SecurityContextHolder.getContext().setAuthentication(auth);\n            } catch (Exception e) {\n                log.error(&quot;Auth context initialization failed for clientId: {}, message: {}&quot;,\n                        clientId, e.getMessage());\n            }\n        }\n\n        chain.doFilter(request, response);\n    }\n\n}\n</code></pre>\n"},{"tags":["java","spring-boot","graalvm","graalvm-native-image"],"comments":[{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":132775637,"body":"Try passing <code>server.port</code>, also I&#39;m not certain if embedded profiles are supported in property files."}],"answers":[{"owner":{"user_id":9311364,"display_name":"Ladu anand"},"up_vote_count":1,"is_accepted":true,"creation_date":1674723407,"answer_id":75243963,"body":"<p>Able to make it work by passing the arguments as -- instead of using -D.</p>\n<p>For building the native image, no need to pass -D.</p>\n<pre><code>./mvnw -Pnative native:compile\n</code></pre>\n<p>And to run the executable with system properties, use the below command</p>\n<pre><code>./target/&lt;app-executable&gt; --spring.profiles.active=local\n</code></pre>\n<p>This picked up the server.port=9093.</p>\n"}],"owner":{"user_id":9311364,"display_name":"Ladu anand"},"view_count":539,"up_vote_count":2,"accepted_answer_id":75243963,"answer_count":1,"score":2,"creation_date":1674710620,"question_id":75242495,"body":"<p>I am planning to use a native image with Spring Boot 3. My environment-specific properties are stored in the application.properties file. Sample file</p>\n<pre><code>spring.config.activate.on-profile=dev\nserver.port=9092\n#---\nspring.config.activate.on-profile=local\nserver.port=9093\n</code></pre>\n<p>I build the native executable using the following command</p>\n<pre><code>./mvnw -Pnative native:compile -Dspring.profiles.active=local\n</code></pre>\n<p>and run the executable using the below command</p>\n<pre><code>./target/&lt;app-executable&gt; -Dspring.profiles.active=local\n</code></pre>\n<p>In the logs I see</p>\n<pre><code>No active profile set, falling back to 1 default profile: &quot;default&quot;\n</code></pre>\n<p>Am I doing something wrong or Are profiles not supported with Spring Boot 3 native image?</p>\n"},{"tags":["java","xml","jackson"],"answers":[{"owner":{"user_id":11713777,"display_name":"dariosicily"},"up_vote_count":1,"is_accepted":true,"creation_date":1674671620,"answer_id":75238373,"body":"<p>You can use the <a href=\"https://fasterxml.github.io/jackson-core/javadoc/2.14/com/fasterxml/jackson/core/JsonGenerator.html#writeObjectField-java.lang.String-java.lang.Object-\" rel=\"nofollow noreferrer\"><code>JsonGenerator#writeObjectField</code></a> method that serialize the <code>Dog</code> pojo inside the already defined <code>ZooSerializer#serialize</code> method like below:</p>\n<pre><code>public class ZooSerializer extends StdSerializer&lt;Zoo&gt; {\n\n    public ZooSerializer(Class&lt;Zoo&gt; t) {\n        super(t);\n    }\n    \n    public ZooSerializer() {\n        this(null);\n    }\n\n    @Override\n    public void serialize(Zoo zoo, JsonGenerator jg, SerializerProvider sp) throws IOException {\n        jg.writeStartObject();\n        for (Animal animal: zoo.animals) {\n            String animalClassName = animal.getClass().getSimpleName();      \n            jg.writeObjectField(animalClassName, animal);    \n        }\n        jg.writeEndObject();\n    }\n}\n\n\nOutput in your main example:\n&lt;Zoo&gt;\n  &lt;Dog&gt;\n    &lt;breed&gt;Collie&lt;/breed&gt;\n    &lt;age&gt;6&lt;/age&gt;\n  &lt;/Dog&gt;\n&lt;/Zoo&gt;\n</code></pre>\n<p>Due to the writing of a custom serializer in this way without the use of the <code>JsonTypeInfo</code> you have to write a custom deserializer if you want to deserialize the obtained xml to a <code>Zoo</code> object.</p>\n"}],"owner":{"user_id":8796806,"display_name":"Timothy Clotworthy"},"view_count":31,"up_vote_count":2,"accepted_answer_id":75238373,"answer_count":1,"score":2,"creation_date":1674662002,"question_id":75236506,"body":"<p>I have a small hierarchy of classes that I need to serialize to XML. I found a past posting(<a href=\"https://stackoverflow.com/questions/74273254/jackson-serialize-list-with-polymorphic-elements-to-xml/74294338#74294338\">Jackson serialize list with polymorphic elements to XML</a>), which was useful for getting the subclasses to serialize with the proper subclass name. However, the fields of those subclasses are not being serialized. Here I will provide an example:</p>\n<pre><code>public abstract class Animal {}\n\n\npublic class Dog extends Animal{\n\n    public String breed;\n    public String age;\n\n    public Dog(String breed, String age) {\n        this.breed = breed;\n        this.age = age;\n    }\n}\n\n@JsonSerialize(using = ZooSerializer.class)\npublic class Zoo {\n    public List&lt;Animal&gt; animals = new ArrayList&lt;&gt;();\n}\n\n\npublic class ZooSerializer extends StdSerializer&lt;Zoo&gt; {\n\n    public ZooSerializer(Class&lt;Zoo&gt; t) {\n        super(t);\n    }\n\n    public ZooSerializer() {\n        this(null);\n    }\n\n    @Override\n    public void serialize(Zoo zoo, JsonGenerator jg, SerializerProvider sp) throws IOException \n    {\n        jg.writeStartObject();\n        for (Animal animal: zoo.animals) {\n            jg.writeNullField(animal.getClass().getSimpleName());\n        }\n        jg.writeEndObject();\n    }\n</code></pre>\n<p>, then using this to test:</p>\n<pre><code>@Test\npublic void Test() {\n    XmlMapper xmlMapper = new XmlMapper();\n    try {\n    \n        Zoo zoo = new Zoo();\n        Dog dog = new Dog(&quot;Collie&quot;, &quot;6&quot;);\n\n        System.out.println(xmlMapper.writerWithDefaultPrettyPrinter().writeValueAsString(dog));\n        zoo.animals.add(dog);\n        System.out.println(xmlMapper.writerWithDefaultPrettyPrinter().writeValueAsString(zoo));\n\n    } catch (JsonProcessingException e) {\n        e.printStackTrace();\n    }\n}\n</code></pre>\n<p>, I get the following response:</p>\n<pre><code>&lt;Dog&gt;\n  &lt;breed&gt;Collie&lt;/breed&gt;\n  &lt;age&gt;6&lt;/age&gt;\n&lt;/Dog&gt;\n\n&lt;Zoo&gt;\n  &lt;Dog/&gt;\n&lt;/Zoo&gt;\n</code></pre>\n<p>So, I cannot figure out why the <code>dog</code> fields are present when streaming the <code>dog</code> object by itself, but not when streaming it after adding it to the <code>zoo</code> object. I would be grateful for any ideas. Thank you.</p>\n"},{"tags":["java","selenium","selenium-webdriver","selenium-chromedriver"],"comments":[{"owner":{"user_id":3485434,"display_name":"Prophet"},"edited":false,"comment_id":132762999,"body":"Please share all your code including the link to the page you working on. Currently this question is missing minimal debugging details"},{"owner":{"user_id":8157304,"display_name":"sound wave"},"edited":false,"comment_id":132763113,"body":"You can&#39;t use selenium to click on UI buttons, you must use Automaton or something similar"},{"owner":{"user_id":6734312,"display_name":"Tudor"},"edited":false,"comment_id":132763346,"body":"i am talking about automation, java with selenium. so i need a method that would click on the Close button of the browser. @Prophet there is no debug information needed, i need a method to click on the X (close) button of the browser. After that i can easily write an assertion for the alert that i need to see."},{"owner":{"user_id":6734312,"display_name":"Tudor"},"edited":false,"comment_id":132763380,"body":"@prophet the page does not matter. let&#39;s presume the page is google.com, i just navigated to it. now i want to click on the close button of the browser. how do it do it?"},{"owner":{"user_id":3485434,"display_name":"Prophet"},"edited":false,"comment_id":132763503,"body":"Generally you need to get the element and click it. That&#39;s all. Like this <code>driver.findElement(By.cssSelector(&quot;span.grid-header-name-tex&zwnj;&#8203;t&quot;)).click()</code>."},{"owner":{"user_id":6734312,"display_name":"Tudor"},"edited":false,"comment_id":132763820,"body":"@Prophet that is not the proper selector for the close button. i know how to locate an element on a page. the challenge is to click on the close button, which is not part of the page, but rather part of the browser."},{"owner":{"user_id":3485434,"display_name":"Prophet"},"edited":false,"comment_id":132763846,"body":"This is exactly what I wrote you 36 minutes ago"},{"owner":{"user_id":6734312,"display_name":"Tudor"},"edited":false,"comment_id":132764096,"body":"it is not working.  org.openqa.selenium.NoSuchElementException: no such element: Unable to locate element: {&quot;method&quot;:&quot;css selector&quot;,&quot;selector&quot;:&quot;span.grid-header-name-text&quot;}   (Session info: chrome=109.0.5414.75)"}],"answers":[{"owner":{"user_id":7598774,"display_name":"Shawn"},"up_vote_count":1,"is_accepted":true,"creation_date":1674664696,"answer_id":75237108,"body":"<p>Because the X mark is outside the scope of HTML tree structure, you cannot inspect element and get the locator of it. And hence you cannot achieve the action of clicking X using selenium(unless you want to go with <code>driver.close()</code> or <code>driver.quit()</code>). You can try by using either some third party tool or by using java's features like Robot class. Try below code:</p>\n<pre><code>driver = new ChromeDriver();\ndriver.manage().window().maximize();\ndriver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);\ndriver.get(&quot;https://www.facebook.com/&quot;);\nRobot robot = new Robot();\nThread.sleep(2000);\n// Press keys Ctrl + W\nrobot.keyPress(KeyEvent.VK_CONTROL);\nrobot.keyPress(KeyEvent.VK_W);\n// Release keys Ctrl + W\nrobot.keyRelease(KeyEvent.VK_W);\nrobot.keyRelease(KeyEvent.VK_CONTROL);\n</code></pre>\n<p>Try this. <strong>Note</strong>: Ctrl+W shortcut is to close chrome browser, if you want to close some other browser, use the shortcut accordingly</p>\n"}],"owner":{"user_id":6734312,"display_name":"Tudor"},"view_count":120,"up_vote_count":3,"accepted_answer_id":75237108,"answer_count":1,"score":2,"creation_date":1674661214,"question_id":75236324,"body":"<p>In the application i am testing, i am inputting some data in some fields in Chrome Browser with Selenium. I want to click on the &quot;Close&quot; button on the top right of the page, because a notification should appear when i try to do that. However, i cannot find a way to click on that</p>\n<p>Is there any way to simulate clicking on the &quot;X&quot; button in the top right of the screen?</p>\n<p>I tried to close the browser with driver.close() but that closes the browser immediately. I need to emulate the user action of clicking on the &quot;X&quot; button top right.</p>\n"},{"tags":["java","spring","oracle","hibernate","hibernate-6.x"],"comments":[{"owner":{"user_id":2889760,"display_name":"Gavin King"},"edited":false,"comment_id":132763603,"body":"I would like to help you with this one, but I can&#39;t because the critical code which actually sets the query parameter is hidden from me. I have no clue what <code>findAllByTimestamp()</code> does.  So if you can reproduce the problem <i>with just Hibernate</i> and no Spring repository, I&#39;ll be able to help."},{"owner":{"user_id":4956336,"display_name":"p3consulting"},"edited":false,"comment_id":132767811,"body":"You should look at the Hibernate generated SQL and the values passed, and at the presentation from Oracle Office Hours: <a href=\"https://asktom.oracle.com/pls/apex/asktom.search?oh=19484\" rel=\"nofollow noreferrer\">asktom.oracle.com/pls/apex/asktom.search?oh=19484</a> from time 53:00, it&#39;s about DATE and TIMESTAMP and how ORACLE is handling TZ and daylight saving."},{"owner":{"user_id":2889760,"display_name":"Gavin King"},"edited":false,"comment_id":132771272,"body":"FTR I just wrote and tested some code which does what you want to do in pure Hibernate, and it worked with no issues. So the problem would seem to be in whatever Spring is doing that is hidden from me."},{"owner":{"user_id":6663100,"display_name":"TobsenB"},"edited":false,"comment_id":132773972,"body":"Thank you for your input. I updated the question to include some screenshots of the DB table and the associated log statements that contain the generated sql and parameter bindings.  @p3consulting since no changes were made to the database itself or the way we handle time zones I suspect that the issue resides somewehere in the Spring/Hibernate layer. Thank you anyway for sharing the video, it gave some interesting insights into Oracle&#39;s timestamp handling."},{"owner":{"user_id":6663100,"display_name":"TobsenB"},"edited":false,"comment_id":132774065,"body":"@Gavin Basically, <code>findAllByTimestamp</code> uses Spring&#39;s aut-generation mechanism for creating the SQL query provided by the logs. However, I also tried explicitly defining a native query (<code>select * from entity where demo_timestamp = :timestamp</code>) which caused no differences. Thanks for your input using plain Hibernate, maybe there is an issue with Spring&#39;s communication with JPA/Hibernate. I&#39;ll have a shot at this for myself to gain more insights!"},{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":132777372,"body":"@TobsenB what is the version of JDBC driver? Does annotating timestamp field by <code>@JdbcType(InstantAsTimestampJdbcType.class)</code> change behaviour?"},{"owner":{"user_id":6663100,"display_name":"TobsenB"},"edited":false,"comment_id":132781467,"body":"@Andrey We&#39;re using ojdbc10@19.16.0.0. Adding <code>@JdbcType(InstantAsTimestampJdbcType.class)</code> to the field actually fixes the behaviour. Unfortunately, although this would fix the symptoms for every field using the annotation it would not resolve the problem itself."},{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":132782635,"body":"@TobsenB <code>InstantAsTimestampJdbcType</code> behaves like HBN5 did: it converts <code>Instant</code> to <code>Timestamp</code> prior sending data to JDBC driver, <code>InstantAsTimestampWithTimeZoneJdbcType</code> type, which is default for HBN6/Oracle, works differently: it converts <code>Instant</code> to <code>OffsetDateTime</code> (there are some issues on JDBC 4.2 spec side related to <code>Instant</code> type) prior sending data to JDBC driver. As I can see ojdbc versions <code>19.16.0.0</code> and <code>21.8.0.0</code> handle <code>OffsetDateTime</code> differently, that could be a reason."},{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":132782750,"body":"so, you have three options: 1. place <code>@JdbcType(InstantAsTimestampJdbcType.class)</code> over <code>Instant</code> fields. 2. Tune dialect in HBN: I believe that is enough to implement SPI <code>org.hibernate.boot.model.TypeContributor</code> with smth. like <code>typeContributions.contributeJdbcType(InstantAsTimestampJdbcT&zwnj;&#8203;ype.class)</code>. 3. Try newer version of JDBC driver."},{"owner":{"user_id":6663100,"display_name":"TobsenB"},"edited":false,"comment_id":132795035,"body":"@Andrey Thank you for your contributions, I&#39;ll check the provided solutions!"}],"answers":[{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"up_vote_count":0,"is_accepted":false,"creation_date":1675181316,"answer_id":75299931,"body":"<p><code>Hibernate 5</code> was using <a href=\"https://github.com/hibernate/hibernate-orm/blob/49fbe84dde773de84ea704bb10193c4c581d34b8/hibernate-core/src/main/java/org/hibernate/type/descriptor/sql/TimestampTypeDescriptor.java#L81\" rel=\"nofollow noreferrer\">following method</a> to perform all date/time related calculations:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Override\nprotected X doExtract(ResultSet rs, String name, WrapperOptions options) throws SQLException {\n  return options.getJdbcTimeZone() != null ?\n   javaTypeDescriptor.wrap( rs.getTimestamp( name, Calendar.getInstance( options.getJdbcTimeZone() ) ), options ) :\n   javaTypeDescriptor.wrap( rs.getTimestamp( name ), options );\n}\n</code></pre>\n<p>Now, for your &quot;Instant case&quot;, <code>Hibernate 6</code> uses <a href=\"https://github.com/hibernate/hibernate-orm/blob/cc42864351ab571cd1b85347fdc323764a35fa30/hibernate-core/src/main/java/org/hibernate/type/descriptor/jdbc/InstantAsTimestampWithTimeZoneJdbcType.java#L88\" rel=\"nofollow noreferrer\">following method</a>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>protected void doBind(\n        PreparedStatement st,\n        X value,\n        int index,\n        WrapperOptions wrapperOptions) throws SQLException {\n    final OffsetDateTime dateTime = javaType.unwrap( value, OffsetDateTime.class, wrapperOptions );\n    // supposed to be supported in JDBC 4.2\n    st.setObject( index, dateTime.withOffsetSameInstant( ZoneOffset.UTC ), Types.TIMESTAMP_WITH_TIMEZONE );\n}\n</code></pre>\n<p>which actually looks weird because HBN binds timezone-aware data-type to non-timezone-aware column and the question is: what does the expression <code>st.setObject(index, odt, 2014)</code> really mean and what actual value will DB engine use when selecting rows?</p>\n<p>Answer:</p>\n<ul>\n<li>JDBC driver sends &quot;expected&quot; value</li>\n<li>DB engine adjusts both date/time data stored in table and query parameters to UTC timezone (for stored data it uses <a href=\"https://docs.oracle.com/database/121/SQLRF/functions176.htm#SQLRF06105\" rel=\"nofollow noreferrer\">session timezone</a> as a baseline - <code>ALTER SESSION SET TIME_ZONE='UTC'</code> solve the issue as well as setting JDK timezone to <code>UTC</code>) prior doing any comparisons (that is the reason why your select statement does not return data) - that actually becomes clear if we take a look at execution plan:</li>\n</ul>\n<pre><code>explain plan for\nselect * from entity\nwhere &quot;demo_timestamp&quot; = to_timestamp_tz(:1);\n\nselect plan_table_output\nfrom table(dbms_xplan.display('plan_table',null,'basic +predicate'));\n</code></pre>\n<pre><code>Explained.\n\n\nPLAN_TABLE_OUTPUT                                           \n------------------------------------------------------------\nPlan hash value: 92196100\n \n------------------------------------\n| Id  | Operation         | Name   |\n------------------------------------\n|   0 | SELECT STATEMENT  |        |\n|*  1 |  TABLE ACCESS FULL| ENTITY |\n------------------------------------\n \nPredicate Information (identified by operation id):\n---------------------------------------------------\n\nPLAN_TABLE_OUTPUT                                           \n------------------------------------------------------------\n \n   1 - filter(SYS_EXTRACT_UTC(INTERNAL_FUNCTION(&quot;demo_timest\namp&quot;))=SYS_EXTRACT_UTC(TO_TIMESTAMP_TZ(:1)))\n\n14 rows selected. \n</code></pre>\n<p>So, yes, there are &quot;breaking changes&quot; (or a bug) in <code>Hibernate 6</code> and now storing timezone-aware data in non-timezone-aware columns may cause a plenty of issues (wrong results, slow queries, etc)</p>\n"},{"owner":{"user_id":2889760,"display_name":"Gavin King"},"up_vote_count":3,"is_accepted":false,"creation_date":1675282736,"answer_id":75315752,"body":"<p>OK, so, look, after my comment I was really hoping that you would make an attempt to reproduce the problem outside of Spring, so that we could establish what the cause of it is.</p>\n<p>But anyway, I have now I've managed to reproduce it with the following setup:</p>\n<ol>\n<li>set the JVM timezone to <code>EST</code> and the Oracle server timezone to <code>UTC</code></li>\n<li><em>do not set</em> <code>hibernate.jdbc.time_zone</code>, so that Hibernate doesn't know there's a mismatch between the timezones</li>\n<li>manually override the default column type generated by Hibernate's schema export from <code>timestamp with time zone</code> to <code>timestamp</code>, using the JPA <code>@Column</code> annotation</li>\n<li><em>do not set</em> <code>hibernate.type.preferred_instant_jdbc_type</code>, nor use <code>@JdbcTypeCode(TIMESTAMP)</code>, so that Hibernate doesn't know you're using a local <code>timestamp</code> as your column type</li>\n<li>finally, <em>and most importantly</em>, use <code>setParameter(&quot;timestamp&quot;, Timestamp.from(instant))</code> when binding the parameter of the query, instead of just passing the <code>Instant</code> object</li>\n</ol>\n<p>FTR, the test code I have used is the following:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@DomainModel(annotatedClasses = UTCNormalizedInstantTest.Instantaneous.class)\n@SessionFactory\n@ServiceRegistry(settings = {@Setting(name = AvailableSettings.TIMEZONE_DEFAULT_STORAGE, value = &quot;NORMALIZE_UTC&quot;),\n//      @Setting(name = AvailableSettings.JDBC_TIME_ZONE, value=&quot;UTC&quot;),\n//      @Setting(name = AvailableSettings.PREFERRED_INSTANT_JDBC_TYPE, value=&quot;TIMESTAMP&quot;)\n})\npublic class UTCNormalizedInstantTest {\n\n    @Test\n    void test(SessionFactoryScope scope) {\n        TimeZone.setDefault(TimeZone.getTimeZone(&quot;EST&quot;));\n        Instant timestamp = Instant.parse(&quot;2022-12-31T23:00:00Z&quot;);\n        UUID id = scope.fromTransaction( s-&gt; {\n            Instantaneous z = new Instantaneous();\n            z.instant = timestamp;\n            s.persist(z);\n            return z.id;\n        });\n        scope.inSession( s-&gt; {\n            Instantaneous z = s.find(Instantaneous.class, id);\n            assertEquals( timestamp, z.instant );\n        });\n        scope.inSession( s-&gt; {\n            Instant i = s.createQuery(&quot;select i.instant from Instantaneous i&quot;, Instant.class)\n                    .getSingleResult();\n            assertEquals( timestamp, i );\n            Instantaneous a = s.createQuery(&quot;from Instantaneous i where i.instant=:timestamp&quot;, Instantaneous.class)\n                    .setParameter(&quot;timestamp&quot;, timestamp )\n                    .getSingleResult();\n            assertEquals( timestamp, a.instant );\n            Instantaneous b = s.createQuery(&quot;from Instantaneous i where cast(i.instant as Timestamp)=:timestamp&quot;, Instantaneous.class)\n                    .setParameter(&quot;timestamp&quot;, Timestamp.from(timestamp) )\n                    .getSingleResult();\n            assertEquals( timestamp, b.instant );\n        });\n    }\n\n    @Entity(name = &quot;Instantaneous&quot;)\n    public static class Instantaneous {\n        @Id\n        @GeneratedValue\n        UUID id;\n//      @JdbcTypeCode(Types.TIMESTAMP)\n        @Column(columnDefinition = &quot;timestamp&quot;)\n        Instant instant;\n    }\n}\n</code></pre>\n<p>Now, uncommenting <em>any one</em> of the three commented lines, or removing the <code>@Column</code> annotation makes this test pass.</p>\n<p>So the solution is, either:</p>\n<ul>\n<li>set <code>hibernate.type.preferred_instant_jdbc_type=TIMESTAMP</code>,</li>\n<li>annotate the field <code>@JdbcTypeCode(TIMESTAMP)</code>, or</li>\n<li>set <code>hibernate.jdbc.time_zone</code> to the server time zone (you say you tried this but I'm willing to bet that if you debug you'll find it didn't stick).</li>\n</ul>\n<p>Note that I was <em>only</em> able to eventually reproduce the problem by using <code>setParameter(&quot;timestamp&quot;, Timestamp.from(instant))</code>. It does not appear to occur if I use <code>setParameter(&quot;timestamp&quot;, instant)</code>, which of course better and more natural. This makes sense. I suppose (but do not know) that if you debug the code generated by Spring, you will find that it is (incorrectly) converting your <code>Instant</code> to a <code>Timestamp</code> before passing it to <code>setParameter()</code>.</p>\n<p>FTR, the difference between H5 and H6 is that by default H6 uses a <code>timestamp with time zone</code> to store <code>Instant</code>s, rather than a <code>timestamp</code>, since a <code>timestamp</code> with no time zone is more like a Java <code>LocalDateTime</code>. Since you're using <code>timestamp</code> to store your <code>Instant</code>, you need to let Hibernate know about that, or, at the very least, let it know about the mismatch between the JVM and Oracle time zones.</p>\n"}],"owner":{"user_id":6663100,"display_name":"TobsenB"},"view_count":734,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1674660733,"question_id":75236228,"body":"<p>We're currently migrating a Spring Boot 2 application to Spring Boot 3 (<code>3.0.2</code>) which includes moving to Hibernate 6 (<code>6.1.6</code>).</p>\n<p>All Timestamps are normalized to UTC and saved to the underlying OracleDB using columns of the TIMESTAMP data type (without timezones). To make Hibernate use UTC we set the <code>jpa.properties.hibernate.jdbc.time_zone</code> configuration property to <code>true</code> within our <code>application.yaml</code>.</p>\n<p>After moving to Spring Boot 3 and Hibernate 6 (which introduces a more specific configuration for timestamp conversion) the migration of timestamps doesn't work as expected anymore:</p>\n<p>When looking up entities by timestamp attributes, they won't be found.</p>\n<p><strong>A short example:</strong><br />\nSaving an entity with a <code>java.time.Instant</code> timestamp of <code>2023-12-13T00:00:00Z</code> to the database creates a new record as expected.<br />\nHowever, when trying to retrieve the record using the same timestamp the data repository will return an empty result. It therefore seems that the timestamp conversion differs between saving and querying.</p>\n<p>We tried to adjust this behaviour using the configuration property <code>spring.jpa.properties.hibernate.timezone.default_storage</code> but no matter what value we set, the behaviour kept being the same. We also tried different combinations of the <code>jdbc.time_zone</code> and <code>timezone.default_storage</code> config properties without recognizing any effects on the application's behaviour. We initially thought that the properties for whatever reason wouldn't be applied, but assigning invalid values raised exceptions on application startup.</p>\n<p>The same code works like a charm when using a H2 database.</p>\n<p>The relevant part of the <code>application.yaml</code> we're using is as follows:</p>\n<pre><code>spring:\n  datasource:\n    driverClassName: oracle.jdbc.OracleDriver\n    url: jdbc:oracle:thin:@localhost:1521:xe\n    username: [dbuser]\n    password: [dbpassword]\n    type: org.springframework.jdbc.datasource.SimpleDriverDataSource\n  jpa:\n    show-sql: false\n    generate-ddl: true\n    hibernate.ddl-auto: none\n    task:\n    scheduling:\n      pool:\n        size: 10\n    properties:\n      hibernate:\n        jdbc:\n          time_zone: UTC\n        timezone:\n          default_storage: NORMALIZE_UTC\n</code></pre>\n<p>An example entity:</p>\n<pre><code>import jakarta.persistence.Column;\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.Id;\nimport jakarta.persistence.Table;\nimport java.time.Instant;\nimport java.util.UUID;\nimport lombok.Getter;\nimport lombok.Setter;\n\n@Setter\n@Getter\n@Entity\n@Table(name =&quot;entity&quot;)\npublic class DemoEntity {\n\n  @Id\n  @Column(name = &quot;`id`&quot;)\n  UUID id;\n\n  @Column(name = &quot;`demo_timestamp`&quot; ,columnDefinition = &quot;TIMESTAMP&quot;)\n  private Instant timestamp;\n\n  public DemoEntity() {\n    this.id = UUID.randomUUID();\n  }\n\n}\n</code></pre>\n<p>The repository:</p>\n<pre><code>import java.time.Instant;\nimport java.util.Optional;\nimport java.util.UUID;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.jpa.repository.JpaSpecificationExecutor;\nimport org.springframework.stereotype.Repository;\n\n@Repository\npublic interface EntityRepository extends JpaRepository&lt;DemoEntity, UUID&gt;, JpaSpecificationExecutor&lt;DemoEntity&gt; {\n\n  Optional&lt;DemoEntity&gt; findAllByTimestamp(Instant timestamp);\n}\n</code></pre>\n<p>The service showcasing the observed behaviour:</p>\n<pre><code>import java.time.Instant;\nimport java.util.Optional;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.event.ContextRefreshedEvent;\nimport org.springframework.context.event.EventListener;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n@Service\n@Slf4j\npublic class EntityService {\n\n  private final EntityRepository repository;\n\n  @Autowired\n  public EntityService(EntityRepository repository) {\n    this.repository = repository;\n  }\n\n  @EventListener(ContextRefreshedEvent.class)\n  @Transactional\n  public void init() {\n    Instant timestamp = Instant.parse(&quot;2022-12-31T23:00:00Z&quot;);\n\n    Optional&lt;DemoEntity&gt; findResult = repository.findAllByTimestamp(timestamp);\n\n    if(findResult.isPresent()) {\n      log.info(&quot;Entity was found for timestamp {}&quot;, timestamp);\n      return;\n    }\n\n    log.info(&quot;No entity was found for timestamp {}, creating one&quot;, timestamp);\n\n    DemoEntity demoEntity = new DemoEntity();\n    demoEntity.setTimestamp(timestamp);\n\n    this.repository.save(demoEntity);\n  }\n}\n</code></pre>\n<p>The service keeps creating new records with correct timestamps since it fails to look up the persisted timestamps:</p>\n<ol>\n<li><strong>The entity is created properly...</strong>\n<a href=\"https://i.stack.imgur.com/QIdc5.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QIdc5.png\" alt=\"enter image description here\" /></a></li>\n<li><strong>...but not found by the SQL query afterwards...</strong></li>\n</ol>\n<pre><code>2023-01-26T07:20:47.986+01:00  INFO 1274 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''\n2023-01-26T07:20:48.105+01:00 DEBUG 1274 --- [  restartedMain] org.hibernate.SQL                        : select d1_0.&quot;id&quot;,d1_0.&quot;demo_timestamp&quot; from entity d1_0 where d1_0.&quot;demo_timestamp&quot;=?\n2023-01-26T07:20:48.106+01:00 TRACE 1274 --- [  restartedMain] org.hibernate.orm.jdbc.bind              : binding parameter [1] as [TIMESTAMP_UTC] - [2022-12-31T23:00:00Z]\n2023-01-26T07:20:48.130+01:00  INFO 1274 --- [  restartedMain] com.example.demo.EntityService           : No entity was found for timestamp 2022-12-31T23:00:00Z, creating one\n2023-01-26T07:20:48.138+01:00 DEBUG 1274 --- [  restartedMain] org.hibernate.SQL                        : select d1_0.&quot;id&quot;,d1_0.&quot;demo_timestamp&quot; from entity d1_0 where d1_0.&quot;id&quot;=?\n2023-01-26T07:20:48.138+01:00 TRACE 1274 --- [  restartedMain] org.hibernate.orm.jdbc.bind              : binding parameter [1] as [BINARY] - [1ccd9b88-4d18-416a-938d-d8c3fb6dac7d]\n2023-01-26T07:20:48.150+01:00 DEBUG 1274 --- [  restartedMain] org.hibernate.SQL                        : insert into entity (&quot;demo_timestamp&quot;, &quot;id&quot;) values (?, ?)\n2023-01-26T07:20:48.150+01:00 TRACE 1274 --- [  restartedMain] org.hibernate.orm.jdbc.bind              : binding parameter [1] as [TIMESTAMP_UTC] - [2022-12-31T23:00:00Z]\n2023-01-26T07:20:48.150+01:00 TRACE 1274 --- [  restartedMain] org.hibernate.orm.jdbc.bind              : binding parameter [2] as [BINARY] - [1ccd9b88-4d18-416a-938d-d8c3fb6dac7d]\n</code></pre>\n<ol start=\"3\">\n<li><strong>...resulting in another entity being created</strong>\n<a href=\"https://i.stack.imgur.com/BsjkI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/BsjkI.png\" alt=\"enter image description here\" /></a></li>\n</ol>\n<p>We also found, that looking up the entities as if they were in fact using not UTC but our local timezone CET, i.e. UTC+1, delivered the expected results. More specifically, looking up records for an Instant of <code>2022-31-12T22:00:00Z</code> returned the entities having a timestamp of <code>2022-31-12T23:00:00Z</code>. Moreover everything works fine when setting the JVM timezone using <code>TimeZone.setDefault(TimeZone.getTimeZone(&quot;UTC&quot;));</code> or <code>-Duser.timezone=UTC</code>.</p>\n<p>It seems that UTC timestamps represented as Instants are actually converted to local time when being queried but are handled properly when being written to the database.</p>\n<p>Do we miss anything in our configuration or is there a bug in Spring/Hibernate that causes this odd behaviour?</p>\n<p>As far as I know the default behaviour of Hibernate 6 should match the one provided by version 5 so that no configuration changes should be required at all to preserve the previous behaviour.</p>\n"},{"tags":["java","spring-boot","hibernate","multi-tenant"],"answers":[{"owner":{"user_id":2369963,"display_name":"jaletechs"},"up_vote_count":1,"is_accepted":false,"creation_date":1681284854,"answer_id":75992995,"body":"<p>You can use inheritance to achieve the desired result (moving the tenant_id column out of the entity), rather than the <code>@Embedded</code> annotation. Here's how:</p>\n<p>For the <code>BaseEntity</code> class (please forgive my use of Lombok annotations)</p>\n<pre><code>import jakarta.persistence.Column;\nimport jakarta.persistence.MappedSuperclass;\nimport org.hibernate.annotations.TenantId;\n\n@MappedSuperclass\n@Getter\n@Setter\n@NoArgsConstructor\npublic abstract class BaseEntity {\n\n  @TenantId\n  @Column(name = &quot;tenant_id&quot;, nullable = false)\n  private String tenantId;\n}\n</code></pre>\n<p>Then in the <code>Person</code> class, simply extend <code>BaseEntity</code></p>\n<pre><code>import jakarta.persistence.*;\n\n\nimport java.util.Objects;\n\n@Entity\npublic class Person extends BaseEntity {\n\n    @Id \n    @GeneratedValue private Long id;\n\n    private String name;\n\n    public Long getId() {\n        return id;\n    }\n\n    public void setId(Long id) {\n        this.id = id;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    @Override\n    public String toString() {\n        return &quot;Person{&quot; + &quot;id=&quot; + id + &quot;, name='&quot; + name + '\\'' + '}';\n    }\n\n    @Override\n    public boolean equals(Object o) {\n        // TODO implement a suitable equals method\n    }\n\n    @Override\n    public int hashCode() {\n        return 0; // TODO implement a suitable hashcode method\n    }\n}\n</code></pre>\n"}],"owner":{"user_id":4910789,"display_name":"Sachin S Rao"},"view_count":351,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1674642765,"question_id":75232660,"body":"<p>I'm using Spring boot v3.0.1 and hibernate v6.1.6.Final. I'm trying the @TenantId annotation in my entity class. This annotation works fine if I declare the annotation in the entity class directly. But if I create a @Embeddable class and then declare the @TenantId annotation inside it, then the application doesn't start.</p>\n<p>Below is the sample code:</p>\n<p>BaseEntity.Java</p>\n<pre><code>import jakarta.persistence.Column;\nimport jakarta.persistence.Embeddable;\nimport jakarta.persistence.MappedSuperclass;\nimport org.hibernate.annotations.TenantId;\n\n@MappedSuperclass\n@Embeddable\npublic class BaseEntity {\n\n  @TenantId\n  @Column(name = &quot;tenant_id&quot;, nullable = false)\n  private String tenantId;\n\n  public BaseEntity() {\n  }\n\n  public BaseEntity(String tenantId) {\n    this.tenantId = tenantId;\n  }\n\n  public String getTenantId() {\n    return tenantId;\n  }\n\n  public void setTenantId(String tenantId) {\n    this.tenantId = tenantId;\n  }\n}\n</code></pre>\n<p>Person.java</p>\n<pre><code>import jakarta.persistence.*;\n\n\nimport java.util.Objects;\n\n@Entity\npublic class Person {\n\n    @Id @GeneratedValue private Long id;\n\n    @Embedded\n    private BaseEntity baseEntity;\n\n    private String name;\n\n    public Long getId() {\n        return id;\n    }\n\n    public void setId(Long id) {\n        this.id = id;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public BaseEntity getBaseEntity() {\n        return baseEntity;\n    }\n\n    public void setBaseEntity(BaseEntity baseEntity) {\n        this.baseEntity = baseEntity;\n    }\n\n    @Override\n    public String toString() {\n        return &quot;Person{&quot; + &quot;id=&quot; + id + &quot;, name='&quot; + name + '\\'' + '}';\n    }\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (o == null || getClass() != o.getClass()) return false;\n        Person person = (Person) o;\n        return Objects.equals(id, person.id) &amp;&amp; Objects.equals(baseEntity, person.baseEntity) &amp;&amp; Objects.equals(name, person.name);\n    }\n\n    @Override\n    public int hashCode() {\n        return Objects.hash(id, baseEntity, name);\n    }\n}\n</code></pre>\n<p>Error message:</p>\n<blockquote>\n<p>org.springframework.beans.factory.BeanCreationException: Error\ncreating bean with name 'entityManagerFactory' defined in class path\nresource\n[org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]:\n[PersistenceUnit: default] Unable to build Hibernate SessionFactory;\nnested exception is org.hibernate.cfg.NotYetImplementedException:\nStill need to wire in composite in-memory value generation   at\norg.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1751)\n~[spring-beans-6.0.3.jar:6.0.3]   at\norg.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)\n~[spring-beans-6.0.3.jar:6.0.3]   at\norg.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:521)\n~[spring-beans-6.0.3.jar:6.0.3]   at\norg.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)\n~[spring-beans-6.0.3.jar:6.0.3]   at\norg.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)\n~[spring-beans-6.0.3.jar:6.0.3]   at\norg.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)\n~[spring-beans-6.0.3.jar:6.0.3]   at\norg.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)\n~[spring-beans-6.0.3.jar:6.0.3]   at\norg.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1130)\n~[spring-context-6.0.3.jar:6.0.3]   at\norg.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:905)\n~[spring-context-6.0.3.jar:6.0.3]   at\norg.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:584)\n~[spring-context-6.0.3.jar:6.0.3]   at\norg.springframework.boot.SpringApplication.refresh(SpringApplication.java:730)\n~[spring-boot-3.0.1.jar:3.0.1]   at\norg.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:432)\n~[spring-boot-3.0.1.jar:3.0.1]   at\norg.springframework.boot.SpringApplication.run(SpringApplication.java:308)\n~[spring-boot-3.0.1.jar:3.0.1]   at\norg.springframework.boot.SpringApplication.run(SpringApplication.java:1302)\n~[spring-boot-3.0.1.jar:3.0.1]   at\norg.springframework.boot.SpringApplication.run(SpringApplication.java:1291)\n~[spring-boot-3.0.1.jar:3.0.1]   at\nexample.springdata.jpa.hibernatemultitenant.partition.Application.main(Application.java:9)\n~[classes/:na] Caused by: jakarta.persistence.PersistenceException:\n[PersistenceUnit: default] Unable to build Hibernate SessionFactory;\nnested exception is org.hibernate.cfg.NotYetImplementedException:\nStill need to wire in composite in-memory value generation   at\norg.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:421)\n~[spring-orm-6.0.3.jar:6.0.3]   at\norg.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)\n~[spring-orm-6.0.3.jar:6.0.3]   at\norg.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)\n~[spring-orm-6.0.3.jar:6.0.3]   at\norg.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1797)\n~[spring-beans-6.0.3.jar:6.0.3]   at\norg.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1747)\n~[spring-beans-6.0.3.jar:6.0.3]   ... 15 common frames omitted Caused\nby: org.hibernate.cfg.NotYetImplementedException: Still need to wire\nin composite in-memory value generation   at\norg.hibernate.tuple.entity.EntityMetamodel$CompositeGenerationStrategyPairBuilder.buildPair(EntityMetamodel.java:601)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.tuple.entity.EntityMetamodel.buildGenerationStrategyPair(EntityMetamodel.java:460)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.tuple.entity.EntityMetamodel.(EntityMetamodel.java:296)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.persister.entity.AbstractEntityPersister.(AbstractEntityPersister.java:728)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.persister.entity.SingleTableEntityPersister.(SingleTableEntityPersister.java:152)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\njava.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native\nMethod) ~[na:na]   at\njava.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)\n~[na:na]   at\njava.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n~[na:na]   at\njava.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)\n~[na:na]   at\njava.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)\n~[na:na]   at\norg.hibernate.persister.internal.PersisterFactoryImpl.createEntityPersister(PersisterFactoryImpl.java:92)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.persister.internal.PersisterFactoryImpl.createEntityPersister(PersisterFactoryImpl.java:75)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.metamodel.model.domain.internal.MappingMetamodelImpl.processBootEntities(MappingMetamodelImpl.java:278)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.metamodel.model.domain.internal.MappingMetamodelImpl.finishInitialization(MappingMetamodelImpl.java:211)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.metamodel.internal.RuntimeMetamodelsImpl.finishInitialization(RuntimeMetamodelsImpl.java:60)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.internal.SessionFactoryImpl.(SessionFactoryImpl.java:311)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:415)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1425)\n~[hibernate-core-6.1.6.Final.jar:6.1.6.Final]   at\norg.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:66)\n~[spring-orm-6.0.3.jar:6.0.3]   at\norg.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)\n~[spring-orm-6.0.3.jar:6.0.3]   at\norg.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)\n~[spring-orm-6.0.3.jar:6.0.3]   ... 19 common frames omitted</p>\n</blockquote>\n<p>Any help is appreciated. Thanks in advance,</p>\n"},{"tags":["java","spring-boot","apache-kafka","integration-testing","testcontainers-junit5"],"answers":[{"owner":{"user_id":3102303,"display_name":"Tony Langworthy"},"up_vote_count":1,"is_accepted":false,"creation_date":1675276797,"answer_id":75314729,"body":"<p>We (<a href=\"https://stackoverflow.com/users/6297979/k-hervey\">Kent Hervey</a> and I) found the answer as below:</p>\n<ul>\n<li>The <code>@DynamicPropertySource</code> was definitely being executed.</li>\n<li>The property <code>spring.kafka.bootstrap-servers</code> was incorrect. <em><strong>We were not able to find this in the <a href=\"https://docs.spring.io/spring-kafka/reference/html/#junit\" rel=\"nofollow noreferrer\">Spring Kafka documentation</a>.</strong></em> We used the debugger to step through and figure out which property key was available.</li>\n<li>After changing the property key, the test was able successfully connect to the Kafka broker running in the Testcontainer.</li>\n<li>What we’re working on now is a schema registry Testcontainer (it doesn’t exist, so we are extending the GenericContainer).</li>\n<li>We are still calling the same method on the KafkaTemplate, since that is actually called in the service class. <code>spring.kafka.properties.bootstrap.servers</code></li>\n</ul>\n<p>The following code reflects that changes we made to set the Kafka Bootstrap servers dynamically.</p>\n<pre><code>@DynamicPropertySource\nstatic void kafkaProperties(DynamicPropertyRegistry registry) {\n    registry.add(&quot;spring.kafka.properties.bootstrap.servers&quot;, kafkaContainer::getBootstrapServers);\n}\n</code></pre>\n"}],"owner":{"user_id":3102303,"display_name":"Tony Langworthy"},"view_count":366,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1674518145,"question_id":75216241,"body":"<p>I'm working on integration tests using Kafka Testcontainers. The container starts up, and reads the bootstrap servers' configuration that is set in the application.yml.</p>\n<p>Since the Testcontainers port is created dynamically, I'm using <code>kafkaContainer.getBootstrapServers()</code> to get the socket created by the test container.</p>\n<p>According to the <a href=\"https://docs.spring.io/spring-kafka/reference/html/#testing\" rel=\"nofollow noreferrer\">Spring Kafka documentation</a>, and several online articles, the <code>DynamicPropertyRegistry</code> class can be used to override the existing configuration.</p>\n<p>Here is the code I am using to override the boostrap servers configuration.</p>\n<pre><code>@DynamicPropertySource\nstatic void kafkaProperties(DynamicPropertyRegistry registry) {\n    registry.add(&quot;spring.kafka.bootstrap-servers&quot;, kafkaContainer::getBootstrapServers);\n}\n</code></pre>\n<p>However, the code above seems to have no effect, since the output of the test displays several lines of</p>\n<p><code>Connection to node -1 (localhost/127.0.0.1:29092) could not be established. Broker may not be available.</code></p>\n<p>and then eventually fails with this error message:</p>\n<pre><code>org.springframework.kafka.KafkaException: Send failed\n\nat org.springframework.kafka.core.KafkaTemplate.doSend(KafkaTemplate.java:731)\nat org.springframework.kafka.core.KafkaTemplate.observeSend(KafkaTemplate.java:691)\nat org.springframework.kafka.core.KafkaTemplate.send(KafkaTemplate.java:514)\nat com.zeal.accelerator.kafka.service.KafkaService.sendMessage(KafkaService.java:38)\nat com.zeal.accelerator.kafka.producer.Producer.sendAvroMessage(Producer.java:24)\nat com.zeal.integration.accelerator.kafka.ProducerIT.verify_that_expected_event_is_successfully_sent(ProducerIT.java:96)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\nat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.base/java.lang.reflect.Method.invoke(Method.java:568)\nat org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:727)\nat org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)\nat org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)\nat org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)\nat org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)\nat org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)\nat org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)\nat org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)\nat org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)\nat org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)\nat org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)\nat org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)\nat org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)\nat org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)\nat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:217)\nat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\nat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:213)\nat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:138)\nat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:68)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)\nat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\nat org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\nat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\nat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\nat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\nat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\nat org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\nat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\nat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\nat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\nat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\nat org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\nat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\nat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\nat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)\nat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)\nat org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)\nat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:147)\nat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:127)\nat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:90)\nat org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:55)\nat org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:102)\nat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:54)\nat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)\nat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)\nat org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)\nat org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:53)\nat com.intellij.junit5.JUnit5IdeaTestRunner.startRunnerWithArgs(JUnit5IdeaTestRunner.java:57)\nat com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)\nat com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)\nat com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)\nat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)\nat com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)\nCaused by: org.apache.kafka.common.errors.TimeoutException: Topic test-topic not present in metadata after 60000 ms. \n</code></pre>\n<p>This is the test class.</p>\n<pre><code>@Slf4j\n@Testcontainers\n@ActiveProfiles({&quot;test&quot;})\n@ExtendWith(SpringExtension.class)\n@SpringBootTest(classes = KafkaApplication.class)\nclass ProducerIT {\n\nprivate final static String TEST_TOPIC = &quot;test-topic&quot;;\n\nprivate TestAvroMessage expectedPayload;\n\nprivate final CountDownLatch latch = new CountDownLatch(1);\n\n@Autowired\nprivate KafkaService kafkaService;\n\n@Autowired\nprivate Producer kafkaProducer;\n\n@Autowired\nprivate KafkaProperties kafkaProperties;\n\n@Container\nprivate static final KafkaContainer kafkaContainer =\n        new KafkaContainer(DockerImageName.parse(&quot;confluentinc/cp-kafka:latest&quot;))\n                .withEmbeddedZookeeper();\n\n@DynamicPropertySource\nstatic void kafkaProperties(DynamicPropertyRegistry registry) {\n    registry.add(&quot;spring.kafka.bootstrap-servers&quot;, kafkaContainer::getBootstrapServers);\n}\n\n@Test\nvoid verify_that_expected_event_is_successfully_sent() throws ExecutionException, InterruptedException {\n\n    ReflectionTestUtils.setField(kafkaService, &quot;producerTopic&quot;, TEST_TOPIC);\n    kafkaProperties.setBootstrapServers(List.of(kafkaContainer.getBootstrapServers()));\n\n\n\n    TestAvroMessage actual = TestAvroMessage.newBuilder()\n            .setId(&quot;aDemoId&quot;)\n            .setName(&quot;test&quot;)\n            .setProcessed(true)\n            .setCost(125000.00)\n            .setLevel(5)\n            .build();\n\n    kafkaProducer.sendAvroMessage(actual);\n\n    latch.await(10, TimeUnit.SECONDS);\n\n    assertThat(actual).isEqualTo(expectedPayload);\n}\n\n@KafkaListener(topics = TEST_TOPIC,\n        groupId = &quot;${test.kafka.group-id}&quot;,\n        containerFactory = &quot;eventListenerContainerFactory&quot;)\nvoid messageListener(TestAvroMessage event,\n                     @Header(value = KafkaHeaders.RECEIVED_KEY, required = false) String messageKey,\n                     @Header(KafkaHeaders.RECEIVED_PARTITION) String partitionId,\n                     @Header(KafkaHeaders.OFFSET) long offset,\n                     @Header(KafkaHeaders.RECEIVED_TOPIC) String topic,\n                     @Headers Map&lt;String, Object&gt; headers) throws InterruptedException {\n\n    latch.countDown();\n\n    expectedPayload = event;\n}\n}\n</code></pre>\n<p>I'm looking for help solving this. Architectural requirements include use of Testcontainers and precludes the use of <code>EmbeddedKafka</code>. Thanks!</p>\n"},{"tags":["java","spring","spring-data-jpa"],"comments":[{"owner":{"user_id":7109162,"display_name":"XtremeBaumer"},"edited":false,"comment_id":132717237,"body":"Do you have a JPA query? I am not sure how supported it is to filter the relationship beforehand. Something I found <a href=\"https://stackoverflow.com/questions/60863789/select-only-a-subset-of-an-entities-collection\">is this related question</a>"},{"owner":{"user_id":6209532,"display_name":"Sotiris Oik"},"edited":false,"comment_id":132717459,"body":"It looks relevant but it that case the function would be findeAsByeBsByeCs (or something like that) which does not seem to be possible cause its the &quot;third level&quot; which I need to apply the clause to"}],"answers":[{"owner":{"user_id":639520,"display_name":"E-Riz"},"up_vote_count":1,"is_accepted":false,"creation_date":1674484235,"answer_id":75210932,"body":"<p>You should be able to use a <a href=\"https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods\" rel=\"nofollow noreferrer\">derived query method</a> in your repository interface, no SQL needed. Spring Data can derive queries based only on the name of a repository method and its parameter type(s). It's a powerful feature, useful to avoid the need to write SQL or JPQL queries manually. <a href=\"https://www.baeldung.com/spring-data-derived-queries\" rel=\"nofollow noreferrer\">Here is another useful explanation</a> with some examples.</p>\n<p>For your case, the repository method name to filter nested objects would be somewhat complex, but doable. The exact repository method name depends on the field names in your entity classes, which you didn't show us. So assuming classes like this (annotations omitted):</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class A {\n    private long id;\n    private Collection&lt;B&gt; entityBs;\n}\n\npublic class B {\n    private long id;\n    private Collection&lt;C&gt; entityCs;\n}\n\npublic class C {\n    private long id;\n}\n</code></pre>\n<p>The repository method would look like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface EntityARepository extends JPARepository&lt;A, long&gt; {\n    Collection&lt;A&gt; findByEntityBsEntityCsIdIn(long[] ids);\n}\n</code></pre>\n<p>The return type of the repo method can be other types, <a href=\"https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-return-types\" rel=\"nofollow noreferrer\">as documented here</a>, depending on how you want the results returned.</p>\n"}],"owner":{"user_id":6209532,"display_name":"Sotiris Oik"},"view_count":525,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1674479655,"question_id":75210044,"body":"<p>I have 3 entities in my Project. Entity A (eA) has an One-to-Many relationship with Entity B (eB) and eB has an One-to-Many relationship with Entity C (eC). I have fetch = eager in all of them.</p>\n<p>I want to get eA with eB and eC nested but i want to get specific entries from eC. I have created a simple query like this</p>\n<pre><code>SELECT eA.* from eA\nINNER JOIN eB on eA.eB_id = eB.id\nINNER JOIN eC on eB.eC_id = eC.id\nWHERE eC.id IN (1,2,3)\n</code></pre>\n<p>It actually seems to work when I run this directly in the database but when I create function in my repository with this query it returns all data from eB and eC and the right ones based on the WHERE clause.</p>\n<p>I have tried switching fetch to lazy but with no luck.</p>\n<p>Do you have any idea how I can achieve this?</p>\n<p>Thanks!</p>\n"},{"tags":["java","apache-poi"],"comments":[{"owner":{"user_id":3915431,"display_name":"Axel Richter"},"edited":false,"comment_id":132714068,"body":"This one line of code is not sufficient. What is <code>a</code>? What is <code>b</code>? Are there more merged regions in that sheet? To be able to answer we would need a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a>."},{"owner":{"user_id":3915431,"display_name":"Axel Richter"},"edited":false,"comment_id":132717959,"body":"What <code>apache poi</code> version are you using? According to your program logic: <code>a = b;</code> ... <code>spreadsheet.addMergedRegion(new CellRangeAddress(a+1, b, 1, 1));</code>;  <code>firstRow</code> can be greater than <code>lastRow</code> in <code>CellRangeAddress</code> and that should not be so. And current <code>apache poi</code> versions would not allow this."}],"answers":[{"owner":{"user_id":3915431,"display_name":"Axel Richter"},"up_vote_count":1,"is_accepted":false,"creation_date":1674535334,"answer_id":75217481,"body":"<p>Your programming logic is wrong and produces overlapping merged regions. That is what Excel does not tolerate and alerts the error about.</p>\n<p>Your program does the following:\nIt starts with <code>int b=i; int a=i;</code> where <code>i</code> points to the first row. The values in first row and second row are equal. So your program sets <code>a = b;</code> so that now both <code>a</code> and <code>b</code> point to the first row. Then it merges <code>spreadsheet.addMergedRegion(new CellRangeAddress(a+1, b, 1, 1));</code>. So it creates <code>&lt;mergeCell ref=&quot;B2:B1&quot;/&gt;</code>. This is not really correct as it should be <code>&lt;mergeCell ref=&quot;B1:B2&quot;/&gt;</code>. But that Excel would tolerate. Now <code>i</code> increases and points to second row. The values in second row and third row are not equal. So your program sets <code>b = i;</code>. Now <code>b</code> points to second row but <code>a</code> has not changed and points to first row. Now your code merges <code>a+1</code> and <code>b</code> which both points to second row. So it creates <code>&lt;mergeCell ref=&quot;B2:B2&quot;/&gt;</code>. That one-cell-merged-region is useless but would be tolerated by Excel. But it additionally overlaps the former created <code>&lt;mergeCell ref=&quot;B2:B1&quot;/&gt;</code>. And here Excel's tolerance ends.</p>\n<p>The following <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a> shows a working program logic. It additional shows what Minimal, <strong>Reproducible</strong> Example really means.</p>\n<p>Have a Excel workbook <code>ExcelExample.xlsx</code> containing following in columns <code>A</code> and <code>B</code> of first sheet:</p>\n<pre><code>Col1        Col2\nRecord1     Value1\nRecord2     Value1\nRecord3     Value2\nRecord4     Value3\nRecord5     Value3\nRecord6     Value3\nRecord7     Value4\nRecord8     Value5\nRecord9     Value5\nRecord10    Value5\nRecord11    Value6\nRecord12    Value7\nRecord13    Value7\nRecord14    Value7\nRecord15    Value8\nRecord16    Value9\nRecord17    Value10\nRecord18    Value10\nRecord19    Value10\nRecord20    Value10\n</code></pre>\n<p>Then do running the following code:</p>\n<pre><code>import java.io.FileInputStream;\nimport java.io.FileOutputStream;\n\nimport org.apache.poi.ss.usermodel.*;\nimport org.apache.poi.ss.util.CellRangeAddress;\n\npublic class ExcelMergeRowsByContent {\n    \n static void mergeRowsByContent(Sheet sheet, int col) {\n  int firstRow = sheet.getFirstRowNum();\n  int lastRow = sheet.getLastRowNum();\n  DataFormatter dataFormatter = new DataFormatter();\n  dataFormatter.setUseCachedValuesForFormulaCells(true);\n  int fromRow = firstRow;\n  int toRow = 0;\n  boolean merge = false;\n  while(fromRow &lt;= lastRow) {\n   Row row1 = sheet.getRow(fromRow); if (row1 == null) row1 = sheet.createRow(fromRow);\n   Cell cell1 = row1.getCell(col);\n   String cellValue1 = dataFormatter.formatCellValue(cell1);\n   toRow = fromRow + 1;\n   while (toRow &lt;= lastRow) { // check whether following values are equal\n    Row row2 = sheet.getRow(toRow); if (row2 == null) row2 = sheet.createRow(toRow);\n    Cell cell2 = row2.getCell(col);\n    String cellValue2 = dataFormatter.formatCellValue(cell2);\n    System.out.println(&quot;cell value in row &quot; + fromRow + &quot; = &quot; + cellValue1 + &quot;; cell value in row &quot; + toRow + &quot; = &quot; + cellValue2);\n    if (cellValue2.equals(cellValue1)) {\n     merge = true; // merging is needed      \n     toRow++; // try whether next row also has equal value\n    } else {\n     break; // values were not equal, so break searching       \n    }\n   }\n   if (merge) {\n    toRow--; // merge only rows where values are equal, last toRow was not\n    System.out.println(&quot;merging from row &quot; + fromRow + &quot; to row &quot; + toRow);\n    sheet.addMergedRegion(new CellRangeAddress(fromRow, toRow, col, col));\n    fromRow = toRow;\n   } \n   merge = false;\n   fromRow++;\n  }\n }\n\n public static void main(String[] args) throws Exception {\n  try (\n   FileInputStream in = new FileInputStream(&quot;./ExcelExample.xlsx&quot;); FileOutputStream out = new FileOutputStream(&quot;./ExcelExampleNew.xlsx&quot;);\n   //FileInputStream in = new FileInputStream(&quot;./ExcelExample.xls&quot;); FileOutputStream out = new FileOutputStream(&quot;./ExcelExampleNew.xls&quot;);\n   Workbook workbook = WorkbookFactory.create(in); ) {\n   \n   Sheet sheet = workbook.getSheetAt(0);\n\n   mergeRowsByContent(sheet, 1);\n  \n   workbook.write(out);\n  }\n }\n}\n</code></pre>\n<p>After that it should have produced following result in <code>ExcelExampleNew.xlsx</code>:</p>\n<p><a href=\"https://i.stack.imgur.com/wlbZM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wlbZM.png\" alt=\"enter image description here\" /></a></p>\n<p>Disclaimer: This code is tested and runs using current <code>apache poi 5.2.3</code>. Older <code>apache poi</code> versions are outdated and not supported anymore.</p>\n"}],"owner":{"user_id":20341578,"display_name":"prathibha "},"view_count":85,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1674439566,"question_id":75205187,"body":"<p>I am getting the below Excel error when I use <code>addMergedRegion</code>. This is my code:</p>\n<pre><code>spreadsheet.addMergedRegion(new CellRangeAddress(a+1, b, 1, 1));\n</code></pre>\n<p>The error I get in Excel says that the downloaded file has &quot;unreadable content&quot; and asks if I want to recover the contents. I click yes.</p>\n<p>Excel then opens the file and a window says that it repaired or removed what was wrong and then it says:</p>\n<p><a href=\"https://i.stack.imgur.com/oxOsx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oxOsx.png\" alt=\"enter image description here\" /></a></p>\n<p>I check those sheets for the cell I wanted merged, and it's merged exactly the way I want it.</p>\n<p>So why is Excel giving me this error, and how do I fix it? Thanks.</p>\n<p>Edit 1: Added additional code. I have a sheet like this and I want to merge the rows with same value.\n<strong>Input</strong>\n<a href=\"https://i.stack.imgur.com/BB1ay.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/BB1ay.png\" alt=\"enter image description here\" /></a></p>\n<p><strong>Output</strong>\n<a href=\"https://i.stack.imgur.com/434z2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/434z2.png\" alt=\"enter image description here\" /></a></p>\n<pre><code>        int i=primrowCountSplice; int b=i; int a=i;\n        for (i=primrowCountSplice;i&lt;primrowCount-1;i++) {\n\n         if(spreadsheet.getRow(i).getCell(1).getStringCellValue().equals(spreadsheet.getRow(i+1).getCell(1).getStringCellValue()))\n            {\n                out.println(&quot;i: &quot; + i);\n                out.println(spreadsheet.getRow(i).getCell(1).getStringCellValue());\n                out.println(spreadsheet.getRow(i+1).getCell(1).getStringCellValue());\n                a = b;\n                out.println(&quot;a: &quot; + a);\n            } else {\n\n              b = i;\n             out.println(&quot;b:  &quot; + b);\n         }\n            spreadsheet.addMergedRegion(new CellRangeAddress(a+1, b, 1, 1));\n</code></pre>\n"},{"tags":["java","design-patterns","decorator"],"comments":[{"owner":{"user_id":7723926,"display_name":"Hamed Heidarian"},"edited":false,"comment_id":132701638,"body":"Do you want to have an object with both publish methods?"},{"owner":{"user_id":1371329,"display_name":"jaco0646"},"edited":false,"comment_id":132704052,"body":"Sounds like you&#39;re overthinking it and the problem is solved with basic object composition: <code>A</code> has-a <code>B</code>."},{"owner":{"user_id":3135811,"display_name":"subham"},"edited":false,"comment_id":132712394,"body":"@jaco0646 I know composition can solve this issue. But what I am more insterested in knowing is limitation of decorator pattern."},{"owner":{"user_id":3135811,"display_name":"subham"},"edited":false,"comment_id":132712419,"body":"@HamedHeidarian i want to keep one base publisher and one decorator around it which will just compress incoming message"}],"answers":[{"owner":{"user_id":1646240,"display_name":"StepUp"},"up_vote_count":1,"is_accepted":true,"creation_date":1674655978,"answer_id":75235254,"body":"<blockquote>\n<p>All decorator classes inherit same parent interface, so one can decorate classes in any possible combination. So for decorator pattern to work properly, all of decorators must be compatible with each others irrespective of orders in which they are applied. Is this understanding correct?</p>\n</blockquote>\n<p>yeah, you are absolutely right. This is how polymorphism works.</p>\n<p>For instance, we want to calculate overall sum of coffee with whip. Usually, price has the same type everywhere. If you have different types, then you need to create some converter class.</p>\n<p>Let me show an example via C#.</p>\n<p>This is an abstraction of beverages:</p>\n<pre><code>public abstract class Beverage\n{\n    public abstract string GetDescription();\n\n    public abstract double GetCost();\n}\n</code></pre>\n<p>and <code>Espresso</code> is concrete implementation of beverage:</p>\n<p>public class Espresso : Beverage\n{\npublic override double GetCost()\n{\nreturn 1;\n}</p>\n<pre><code>public override string GetDescription()\n{\n    return &quot;Espresso&quot;;\n}\n</code></pre>\n<p>}</p>\n<p>This is an abstraction of some addings that can be added or decorated into beverages:</p>\n<pre><code>public abstract class BeverageDecorator : Beverage\n{\n    protected Beverage _beverage;\n}\n</code></pre>\n<p>and <code>WhipDecorator</code> is concrete implementation of beverage decorator adding:</p>\n<pre><code>public class WhipDecorator: BeverageDecorator\n{\n    public WhipDecorator(Beverage beverage)\n    {\n        _beverage= beverage;\n    }\n\n    public override double GetCost()\n    {\n        return _beverage.GetCost() + 1;\n    }\n\n    public override string GetDescription()\n    {\n        return _beverage.GetDescription() + &quot; Whip&quot;;\n    }\n}\n</code></pre>\n<p>The above code can be run like this:</p>\n<pre><code>Beverage espresso = new Espresso();\nespresso = new WhipDecorator(espresso);\n\ndouble cost = espresso.GetCost(); // OUTPUT: 2\nstring description = espresso.GetDescription(); // OUTPUT: &quot;Espresso Whip&quot;\n</code></pre>\n<p>I highly recommend you to read this fascinating book <a href=\"https://www.oreilly.com/library/view/head-first-design/9781492077992/\" rel=\"nofollow noreferrer\">Head First Design Patterns, 2nd Edition</a></p>\n"}],"owner":{"user_id":3135811,"display_name":"subham"},"view_count":63,"up_vote_count":2,"accepted_answer_id":75235254,"answer_count":1,"score":2,"creation_date":1674397415,"question_id":75201177,"body":"<p>I have a usecase where I am trying to use decorator pattern but not sure if it is the right way of using pattern.\nI have 2 message publisher class.\nFirst publisher takes json as input and publish message\nSecond publisher takes bytes as input and publish message</p>\n<p>Currently these 2 are separate classes</p>\n<pre><code>public class A {\n    publish(Json input);\n}\n\npublic class B {\n    publish(byte[] input);\n}\n</code></pre>\n<p>I want to decorate B with A instead of creating a separate class. Basically user would give input as Json and it would be converted to compressed bytes and published to a sink.\nBut problem what i can think here is, while I can decorate B with A, I can't decorate A with B, reason being json can be converted to byte stream but all byte stream can't be converted to json format, and doing so would throw exception.</p>\n<p>All decorator classes inherit same parent interface, so one can dcorate classes in any possible combination. So for decorator pattern to work properly, all of decorators must be compatible with each others irrespective of orders in which they are applied. Is this understanding correct or am I missing something in decorator pattern.</p>\n"},{"tags":["java","number-formatting"],"answers":[{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"up_vote_count":1,"is_accepted":true,"creation_date":1674302812,"answer_id":75193194,"body":"<p>That is character 0xA0, or \\u00A0, or non-breaking space (or NO-BREAK SPACE) in - for example - Windows-1252 and Unicode. This is used to prevent a line break or wrap from occurring after the currency symbol, but before the number.</p>\n<p>The regex character class <code>\\s</code> in Java only covers:</p>\n<blockquote>\n<p>A whitespace character: [ \\t\\n\\x0B\\f\\r]</p>\n</blockquote>\n<p>See javadoc of <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/regex/Pattern.html\" rel=\"nofollow noreferrer\"><code>java.util.regex.Pattern</code></a>.</p>\n<p>Instead, use <code>\\\\h</code> instead of <code>\\\\s</code>, as <code>\\h</code> covers:</p>\n<blockquote>\n<p>A horizontal whitespace character: [ \\t\\xA0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000]</p>\n</blockquote>\n<p>Or, only replace <code>\\u00a0</code>.</p>\n"}],"owner":{"user_id":2580580,"display_name":"Sebastian"},"view_count":99,"up_vote_count":2,"accepted_answer_id":75193194,"answer_count":1,"score":2,"creation_date":1674300431,"question_id":75192964,"body":"<p>I have the following code:</p>\n<pre><code>NumberFormat numberFormat = NumberFormat.getCurrencyInstance(getLocale());\nreturn numberFormat.format(&quot;-123.45&quot;).replaceAll(&quot;\\\\s&quot;, &quot;&quot;);\n</code></pre>\n<p>Since the format returns &quot;-€ 123,45&quot; for my locale, I would expect the code to return &quot;-€123,45&quot;, but it returns &quot;-€ 123,45&quot;. When inspecting the returned string it says that it has a -96 instead of a space. So obviously instead of inserting a space, format inserts that mysterious -96 character. How can I remove that -96 character?</p>\n"},{"tags":["java","generics","overloading"],"comments":[{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":132732188,"body":"You can add a parameter <code>Consumer&lt;T&gt;</code> and replace <code>func(a);</code> with <code>consumer.accept(a);</code>, then, the caller must provide a reference to the appropriate <code>func</code> method, <code>baz(42, this::func);</code> will use <code>func(Integer)</code>, <code>baz(&quot;test&quot;, this::func);</code> will use <code>func(String)</code>, etc."}],"answers":[{"owner":{"user_id":1291492,"display_name":"ControlAltDel"},"up_vote_count":0,"is_accepted":false,"creation_date":1674235433,"answer_id":75187392,"body":"<p>No, you can't do this as you've written it.</p>\n<p>The biggest blocker (as I see it) is that add(String,String) returns an object, but add(int,int) returns a primative(int), so there's a problem with return type.</p>\n<p>But I think you are over complicating things here. Why can't the two add functions could stand on their own? Do you really need a generic <code>baz</code> function?</p>\n"},{"owner":{"user_id":2837741,"display_name":"daniu"},"up_vote_count":1,"is_accepted":false,"creation_date":1674235827,"answer_id":75187460,"body":"<p>Your <code>baz</code> code is valid, but won't work for your case because generic parameters get reduced to <code>Object</code> at runtime, so it needs to be resolved at compile time. To be able to do that, you'd need a common interface like <code>Addable</code>, then you could declare it</p>\n<pre><code>private &lt;T extends Addable&gt; void baz(T a, T b) {\n  // do something\n  System.out.println(add(a, b));\n  // do something else\n}\n</code></pre>\n<p>but you wouldn't be able to call it with <code>int</code> or <code>String</code> because those don't implement <code>Addable</code>; you could wrap them, but not much gained in what you're trying to do.</p>\n<p>So in short: no, not possible; you need to design around this.</p>\n<pre><code>interface Addable&lt;T extends Addable&lt;T&gt;&gt; { T add(T to Add); }\n\nclass IntAddable implements Addable&lt;IntAddable&gt; {\n  Integer value;\n  Integer add(IntAddable toAdd { \n    return new IntAddable(value + to Add.value);\n }\n}\nIntAddable a = new IntAddable(1);\nIntAddable b = new IntAddable(2);\nIntAddable sum = baz(a, b);\n// assuming an analogue class for String\nStringAddable concatted = baz(s1, s2);\n</code></pre>\n"}],"owner":{"user_id":558892,"display_name":"Deqing"},"view_count":54,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1674234836,"question_id":75187290,"body":"<pre><code>private void foo(int a, int b) {\n  // do something\n  System.out.println(add(a, b));\n  // do something else\n}\n\nprivate void bar(String a, String b) {\n  // do something\n  System.out.println(add(a, b));\n  // do something else\n}\n\nprivate int add(int a, int b) {\n  return a + b;\n}\n\nprivate String add(String a, String b) {\n  return a.concat(b);\n}\n</code></pre>\n<p>Is it possible to merge duplicated logic in foo and bar into one function?</p>\n<p>e.g.</p>\n<pre><code>private &lt;T&gt; void baz(T a, T b) {\n  // do something\n  System.out.println(add(a, b));\n  // do something else\n}\n</code></pre>\n<p>-- EDIT --</p>\n<p>Just tried to put a simple example to describe my question.</p>\n<p>Actually in my real code I don't need the return type, the functions are like following:</p>\n<pre><code>void func(Integer a);\nvoid func(String a);\nvoid func(MyEnum a);\nvoid func(MyClass a);\nvoid func(List&lt;MyClass&gt; a);\n</code></pre>\n<p>And I'd like to have a function like:</p>\n<pre><code>private &lt;T&gt; void baz(T a) {\n  // do something\n  func(a);\n  // do something else\n}\n</code></pre>\n<p>So I don't have to write the same logic multiple times.</p>\n"},{"tags":["java","spring","jpa","transactions","spring-data"],"comments":[{"owner":{"user_id":340088,"display_name":"jbx"},"edited":false,"comment_id":132637540,"body":"1. Are you sure the ID in <code>PersonDto</code> corresponds to the same ID in the returned <code>Person</code> object? Are you sure it is not null? 2. Are you sure you are not calling <code>method2</code> from another Transactional method, thus the transaction wouldn&#39;t have ended yet, and maybe <code>method3()</code> is called from another transaction before the first one is committed?"},{"owner":{"user_id":8690140,"display_name":"Serr"},"edited":false,"comment_id":132638915,"body":"Yes, I&#39;m sure, I have a log for it before retrieving it in method3. Also, it works most of the time, about 1% of the time it fails, generally, when it executes super fast. About the Transaction, in the StackTrace there is no other method with a @Transactional annotation. Thanks!"}],"answers":[{"owner":{"user_id":639520,"display_name":"E-Riz"},"up_vote_count":1,"is_accepted":true,"creation_date":1674066861,"answer_id":75163798,"body":"<p>I can see a couple of reason why you're getting the results you describe.</p>\n<p>One possibility is that <code>@Transactional</code> doesn't necessarily mean &quot;execute this method in a totally separate transaction.&quot; The default propagation is <code>REQUIRED</code>, which will use an existing transaction if one is already active. So if <code>method2()</code> is called in a stack where a transaction was opened earlier, it won't create a new one (and thus the new entity won't be committed) until that original transaction is committed. If this is what's happening, one solution would be to change the propagation to <code>REQUIRES_NEW</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Transactional(propagation = REQUIRES_NEW)\n</code></pre>\n<p>Another possibility, which seems more likely, is that these methods are all in the same class. To understand why that fails, you have to understand how Spring implements handling of <code>@Transactional</code> (and most other behavioral annotations): using proxies. That means that only method calls that come through the proxy get the transactional behavior. That's the typical scenario when one object calls a reference it has to another; the reference is actually to the proxy, which intercepts the call and wraps the behavior (in this case, transactionality) around it. However, when calling methods within the same instance, there is no proxy in play (Spring doesn't/can't replace <code>this</code> with a reference to the proxy), and thus no transactional behavior.</p>\n<p>There are a few ways to work around that, but first I would consider how to restructure my classes and methods to avoid it. If that's not reasonable, things like AspectJ, <code>TransactionTemplate</code>, and maybe some other ideas are discussed in <a href=\"https://stackoverflow.com/q/4396284/639520\">this SO Q&amp;A</a>.</p>\n<hr />\n<p>Addendum:\n<a href=\"https://stackoverflow.com/q/3423972/639520\">This question and its answers</a> also talks about options to work around the proxying problem.</p>\n"}],"owner":{"user_id":8690140,"display_name":"Serr"},"view_count":142,"up_vote_count":2,"accepted_answer_id":75163798,"answer_count":1,"score":2,"creation_date":1674064523,"question_id":75163357,"body":"<p>I have a Java, Spring Data application with a PostgreSQL DB and I have a code similar to this in my service layer:</p>\n<pre><code>public void method1() {\n    PersonDto dto = method2();\n    method3(dto);\n}\n\n@Transactional\npublic PersonDto method2() {\n    Person p1 = personRepository.saveAndFlush(new Person());\n    return createPersonDto(p1);\n}\n\n@Transactional\npublic void method3(PersonDto p1) {\n    Person p2 = personRepository.findById(p1.getId());\n    if (p2 == null) {\n        System.out.println(&quot;Not in the DB&quot;);\n    } else {\n        System.out.println(&quot;In the DB&quot;);\n    }\n}\n</code></pre>\n<p>Sometimes this code prints &quot;Not in the DB&quot;, when I was expecting that it would always print &quot;In the DB&quot;. My questions are:</p>\n<ol>\n<li>This saveAndFlush is even necessary? Since I'm not reusing that Entity in the same transaction, I guess it would have the same effect as a save, right?</li>\n<li>How to guarantee that the changes in method2 will be committed before method 3 calls it? So it will always print &quot;In the DB&quot;?</li>\n<li>The fact that I'm converting my Entity to a DTO is what is messing this up? Maybe if I was passing the Entity itself it would work properly?</li>\n</ol>\n<p>I'm thinking about @Transactional only in method1, or replacing @Transactional in method3 with @Transactional(isolation = Isolation.READ_UNCOMMITTED).\nAny advice?</p>\n"},{"tags":["java","eclipse","minecraft","bukkit","spigot"],"comments":[{"owner":{"user_id":106104,"display_name":"user253751"},"edited":false,"comment_id":132636340,"body":"did you try classpath instead of modulepath?"},{"owner":{"user_id":11667048,"display_name":"Dieter Blancke"},"edited":false,"comment_id":132689338,"body":"another option might be to use a build tool such as Maven or Gradle and import the Spigot API like that."}],"answers":[{"owner":{"user_id":19862958,"display_name":"jules brugot"},"up_vote_count":0,"is_accepted":false,"creation_date":1674119057,"answer_id":75169826,"body":"<p>I'm using Intellij IDEA and there is a plugin that create all the file on it, if you really want a clean environment use this to create your project and go back on eclipse after, i can create it and send you the main folder if you can provide you paper version that you want</p>\n"},{"owner":{"user_id":9564834,"display_name":"Daniel"},"up_vote_count":0,"is_accepted":false,"creation_date":1674986604,"answer_id":75274067,"body":"<p>You cannot use <code>paper</code> as a External JAR. Instead download <code>Bukkit</code> or <code>Spigot</code> from the internet (or use <a href=\"https://www.spigotmc.org/wiki/buildtools/\" rel=\"nofollow noreferrer\">BuildTools</a> to compile your own jar file), and use those instead of paper.</p>\n"},{"owner":{"user_id":20336557,"display_name":"PandaDEV"},"up_vote_count":1,"is_accepted":false,"creation_date":1678730991,"answer_id":75725462,"body":"<p>As an advanced user I recommend IntelliJ IDEA, it handles all the dependencies automatically, so you don't have to. When you have it installed, just download the &quot;Minecraft Development&quot; plugin and create a new project with it.</p>\n"}],"owner":{"user_id":21037003,"display_name":"InstantBulldog"},"view_count":133,"up_vote_count":2,"answer_count":3,"score":2,"creation_date":1674055186,"question_id":75161458,"body":"<p>I'm having issues including bukkit/spigot/paper into my Eclipse since when I try &quot;extends JavaPlugin&quot; in my Class it does not seem able to import the file</p>\n<p>I have tried versions of craftbukkit, spigot and paper on several occasions but it just does not seem to work:</p>\n<p><img src=\"https://i.stack.imgur.com/L3dGD.png\" alt=\"\" /></p>\n<p><img src=\"https://i.stack.imgur.com/JwrM8.png\" alt=\"\" /></p>\n<p>From all the online tutorials I have seen, I have noticed that on their versions of eclipse the &quot;Modulepath&quot; and &quot;Classpath&quot; headings do not seem to be there, but for me they are right there:</p>\n<p><img src=\"https://i.stack.imgur.com/uoL97.png\" alt=\"import popup\" /></p>\n<p>Could someone please tell me how to fix this issue?</p>\n"},{"tags":["java","character-encoding","tomcat7","cjk"],"comments":[{"owner":{"user_id":20306007,"display_name":"life888888"},"edited":false,"comment_id":132610009,"body":"Tomcat On Windows ?"},{"owner":{"user_id":21027876,"display_name":"Yaseen"},"edited":false,"comment_id":132622857,"body":"Tomcat on centos7"},{"owner":{"user_id":21027876,"display_name":"Yaseen"},"edited":false,"comment_id":132623129,"body":"Japanese Folder: /data/修繕管理/ The docker image is locally created as per our environment setup. Docker version 20.10.12, build e91ed57"}],"answers":[{"owner":{"user_id":11020958,"display_name":"Muhammed Yaseen"},"up_vote_count":1,"is_accepted":true,"creation_date":1678192745,"answer_id":75662089,"body":"<p>Upgrade Tomcat7 to tomcat9 or Tomcat7.0.109.\nThe support is not available in Tomcat7 Early versions</p>\n"}],"owner":{"user_id":21027876,"display_name":"Yaseen"},"view_count":89,"up_vote_count":2,"accepted_answer_id":75662089,"answer_count":1,"score":2,"creation_date":1673963167,"question_id":75147380,"body":"<p>Getting a <code>FileNotFoundException</code> while reading a Japanese folder structer from a Tomcat 7 web application. But it's working in a Docker container and direct java console execution.</p>\n<p>Both Docker and normal tomcat7 setup and configurations are the same.</p>\n<p>We have done following configurations:</p>\n<ol>\n<li>Tomcat Server <code>server.xml</code> - In Connector tag added <code>URIEncoding</code> attribute as:\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Connector port=&quot;8080&quot;\n           protocol=&quot;HTTP/1.1&quot; \n           connectionTimeout=&quot;20000&quot; \n           redirectPort=&quot;8443&quot;\n           URIEncoding=&quot;UTF-8&quot;/&gt;\n</code></pre>\n</li>\n<li><code>catalina.sh</code> - added following:\n<pre class=\"lang-bash prettyprint-override\"><code>export JAVA_OPTS=&quot;$JAVA_OPTS -server \\\n   -XX:-UseGCOverheadLimit \\\n   -Djava.awt.headless=true \\\n   -Djavax.servlet.request.encoding=UTF-8 \\\n   -Dfile.encoding=UTF-8&quot;\n\nexport CATALINA_OPTS=&quot;$CATALINA_OPTS \\\n   -Dfile.encoding='UTF-8'&quot;`\n</code></pre>\n</li>\n<li>Executed the following command to change the server language:\n<pre class=\"lang-bash prettyprint-override\"><code>export LC_ALL=en_US.UTF-8\n</code></pre>\n</li>\n</ol>\n"},{"tags":["java","kotlin","jooq"],"answers":[{"owner":{"user_id":521799,"display_name":"Lukas Eder"},"up_vote_count":1,"is_accepted":true,"creation_date":1673943022,"answer_id":75143483,"body":"<h3>Background on the availability of convenience overloads</h3>\n<p>jOOQ's API can't overload all possible combinations of <code>Tn</code> vs <code>Field&lt;Tn&gt;</code> for larger numbers of <code>n</code> where <code>n</code> is the number of function parameters. For example:</p>\n<ul>\n<li>1 parameter = 2 overloads (<code>f(T1)</code> and <code>f(F&lt;T1&gt;)</code></li>\n<li>2 parameters = 4 overloads (<code>f(T1, T2)</code>, <code>f(T1, F&lt;T2&gt;)</code>, <code>f(F&lt;T1&gt;, T2)</code>, <code>f(F&lt;T1&gt;, F&lt;T2&gt;)</code></li>\n<li>3 parameters = 8 overloads</li>\n<li>n parameters = 2^n overloads</li>\n</ul>\n<p>While the DSL API often provides complete overloads for 2 parameters, it stops at 3 parameters, offering only 2 overloads in total:</p>\n<ul>\n<li>An overload accepting <em>only</em> bind values</li>\n<li>An overload accepting <em>only</em> expressions</li>\n</ul>\n<p>It is the same with convenience overloads of generated user defined functions.</p>\n<h3>Possibility of a more verbose call syntax</h3>\n<p>Ordinary routines support both the convenience syntax and a more verbose call syntax:</p>\n<pre class=\"lang-java prettyprint-override\"><code>// Convenience call\nRoutines.ordinaryRoutine(1, 2)\n\n// Verbose way to call the routine, equivalent to the above\nval r = OrdinaryRoutine()\nr.param1 = 1\nr.param2 = 2\n</code></pre>\n<p>This currently isn't available for table valued functions, which only know the &quot;convenience syntax&quot;. Might be worth looking into generating alternatives to calling table valued functions:</p>\n<ul>\n<li><a href=\"https://github.com/jOOQ/jOOQ/issues/14508\" rel=\"nofollow noreferrer\">https://github.com/jOOQ/jOOQ/issues/14508</a></li>\n</ul>\n<h3>Workarounds</h3>\n<ul>\n<li>You could create an auxiliary function that calls your function but accepts the first set of parameters in the form of a UDT (<code>CREATE TYPE</code>), so you have to wrap the single UDT argument in <code>DSL.val()</code> only a single time. This doesn't scale too well in terms of function API design, but it works around this problem</li>\n<li>You could use plain SQL templating for the function call (<code>from(&quot;f(?, ?, ... {0})&quot;, someString.capitalise(), someInt, ..., field(...))</code>), since you're already using a plain SQL template. This won't be type safe, though.</li>\n<li>You could <a href=\"https://www.jooq.org/doc/latest/manual/code-generation/codegen-custom-code/\" rel=\"nofollow noreferrer\">extend the <code>JavaGenerator</code></a> to generate an extra overload for your specific case</li>\n</ul>\n<p>Personally, I don't find any of these workarounds very practical. Since you probably don't have this case very often, I'd stick with the original call using explicit <code>val</code> calls</p>\n"}],"owner":{"user_id":3407594,"display_name":"Buğra Ekuklu"},"view_count":56,"up_vote_count":2,"accepted_answer_id":75143483,"answer_count":1,"score":2,"creation_date":1673940297,"question_id":75143082,"body":"<p>I'm calling a function from the database, named <code>some_table_generating_function</code> for the sake of simplicity, in order to cast the query into a select statement returning <code>Field&lt;Array&lt;UUID&gt;&gt;</code>, it forces me to use the <code>val</code> function of the DSL, and it creates a lot of boilerplate for doing a simple function invocation.</p>\n<p>The following example works, but it seems to be overusing the <code>val</code> function, do you have any suggestions to cleanse this piece of code?</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>context\n  .select()\n  .from(\n    select(\n      // fields to be selected\n    )\n      .from(\n        Public.SOME_TABLE_GENERATING_FUNCTION(\n          `val`(someString.capitalise()),\n          `val`(someInt),\n          `val`(BigDecimal(someDecimalString)),\n          `val`(someInt),\n          `val`(BigDecimal(anotherDecimalString)),\n          `val`(BigDecimal(yetAnotherDecimalString)),\n          `val`(anotherInt),\n          `val`(someLong),\n          `val`(anotherLong),\n          // the important bit: uuid[] parameter expected for this parameter\n          field(\n            &quot;ARRAY({0})::uuid[]&quot;,\n            select(A_TABLE.UUID.cast(String::class.java))\n              .from(A_TABLE)\n              .innerJoin(ANOTHER_TABLE)\n              .on(A_TABLE.UUID.eq(ANOTHER_TABLE.UUID))\n              .where(\n                // additional conditions\n              )\n          ) as Field&lt;Array&lt;UUID&gt;&gt;\n        )\n      )\n      .join(THE_TABLE)\n      .asTable(&quot;inner_query&quot;)\n  )\n  .where(\n    // additional conditions\n  )\n</code></pre>\n"},{"tags":["java","flutter","android-studio","version"],"comments":[{"owner":{"user_id":13158691,"display_name":"Paulo Henrique Sousa da Silva"},"edited":false,"comment_id":132571231,"body":"See if the solution in the link solves it: <a href=\"https://stackoverflow.com/a/75122314/13158691\">stackoverflow.com/a/75122314/13158691</a>"},{"owner":{"user_id":14688013,"display_name":"cosmic"},"edited":false,"comment_id":132574059,"body":"no, it did not, thats the error is got:  <code>New-Item : The directory is not empty.     + CategoryInfo          : WriteError: (C:\\Program File...roid Studio\\jre:String) [New-Item], IOException     + FullyQualifiedErrorId : NewItemDeleteIOError,Microsoft.PowerShell.Commands.NewItemCo&zwnj;&#8203;mmand </code>"}],"answers":[{"owner":{"user_id":14688013,"display_name":"cosmic"},"up_vote_count":0,"is_accepted":false,"creation_date":1673804098,"answer_id":75127049,"body":"<p>Here is how I solved mine:\nI installed the old version of <a href=\"https://redirector.gvt1.com/edgedl/android/studio/install/2021.3.1.17/android-studio-2021.3.1.17-windows.exe\" rel=\"nofollow noreferrer\">Android studio(v2021.3.1.17)</a> and JDK 16. Everything working fine now.</p>\n"},{"owner":{"user_id":14634256,"display_name":"ALI USAMA"},"up_vote_count":1,"is_accepted":false,"creation_date":1673953319,"answer_id":75145417,"body":"<p>I've faced the same problem and found the solution.</p>\n<p>So the <strong>solution</strong> to this problem is:</p>\n<ol>\n<li>Go to your AndroidStudio folder</li>\n</ol>\n<blockquote>\n<p>(e.g. C:\\Program Files\\Android\\Android Studio)</p>\n</blockquote>\n<ol start=\"2\">\n<li>There you'll find the <code>jbr</code> and <code>jre</code> folder So what you need to do is to copy the content of jbr and paste the content into the <strong>jre</strong> folder.</li>\n</ol>\n"}],"owner":{"user_id":14688013,"display_name":"cosmic"},"view_count":97,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1673765349,"question_id":75123411,"body":"<p><a href=\"https://i.stack.imgur.com/3mXkj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3mXkj.png\" alt=\"[enter image description here](https://i.stack.imgur.com/yDmlw.png)\" /></a></p>\n<p>Here is a picture from the <code>flutter doctor -v</code>. i am not sure if its the error of new version android studio. Past releases link are broken as well. Hence, I am stuck here.</p>\n<p><a href=\"https://i.stack.imgur.com/eghGm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/eghGm.png\" alt=\"[enter image description here](https://i.stack.imgur.com/RX21X.png)\" /></a></p>\n<p>Here are my versions of flutter, android studio and java. One thing to be noted, my new version of android studio was giving issues in the environment variables so after trying jdk 8,11 only 16 allowed me to use the studio.</p>\n<p>OS: Windows 11(latest version)</p>\n<p>P.S. I only have one android studio folder in the android folder. I can not just delete it, right?</p>\n"},{"tags":["java","json","apache-camel","unmarshalling"],"comments":[{"owner":{"user_id":6949832,"display_name":"Kumaran"},"edited":false,"comment_id":132567654,"body":"Forgot to add this thing. My input message is huge about 2000 lines of json string. So I can&#39;t do unmarshal and marshal again."},{"owner":{"user_id":9025960,"display_name":"rgnt"},"edited":false,"comment_id":132571933,"body":"Question is, why would you need an access to the JSON?"},{"owner":{"user_id":6949832,"display_name":"Kumaran"},"edited":false,"comment_id":132600297,"body":"json string is input to my app from a queue."}],"answers":[{"owner":{"user_id":16480631,"display_name":"Pasi &#214;sterman"},"up_vote_count":1,"is_accepted":true,"creation_date":1674114264,"answer_id":75169074,"body":"<p>You can store the original body to an exchange property. Marshal by default replaces the message body but you can use exchange properties to store values for later use in the route.</p>\n<pre class=\"lang-java prettyprint-override\"><code>from(&quot;jms:queue:example&quot;)\n    .routeId(&quot;receiveExampleMessage&quot;)\n    .convertBodyTo(String.class)\n    .setProperty(&quot;originalBody&quot;, body())\n    .unmarshal(exampleDataFormat)\n    // Usage:\n    // Log original body\n    .log(&quot;original body ${exchangeProperty.originalBody}&quot;)\n    // Use exchange property with plain java\n    .process(ex -&gt; {\n        String originalBody = ex.getProperty(&quot;originalBody&quot;, \n            String.class);\n    })\n    // Set property value back to body\n    .setBody().exchangeProperty(&quot;originalBody&quot;)\n;\n</code></pre>\n"}],"owner":{"user_id":6949832,"display_name":"Kumaran"},"view_count":176,"up_vote_count":2,"accepted_answer_id":75169074,"answer_count":1,"score":2,"creation_date":1673756157,"question_id":75122893,"body":"<p>I am getting an input json string from a queue to my camel route, I need to unmarshal it to get a java object. After unmarshal I can't access my original message via Exchange object in process. If anyone faced the same issue and found solution, could you please answer this.</p>\n<p>I tried to unmarshal a json string to java object from incoming camel route. I wan to get access to original input message after unmarshal.</p>\n"},{"tags":["java","android","javafx-19"],"comments":[{"owner":{"user_id":11168157,"display_name":"Chris Damianidis"},"edited":false,"comment_id":132539148,"body":"Why dont you learn about android-studio? You would find many lessons and you have many opportunities in android development."},{"owner":{"user_id":20997947,"display_name":"Sayon Mitra"},"edited":false,"comment_id":132539274,"body":"But Android Studio is very bulky, and I have a dell latitude e6420 laptop that have 4gb ram, and it cannot handle a bulky and huge software like this, that&#39;s why I want to make android apps with low resources."},{"owner":{"user_id":11168157,"display_name":"Chris Damianidis"},"edited":false,"comment_id":132539865,"body":"fair enough, the only video I found that maybe help you is this, <a href=\"https://www.youtube.com/watch?v=o4VdX_FtAg8\" rel=\"nofollow noreferrer\">youtube.com/watch?v=o4VdX_FtAg8</a>.  Maybe in the future make an upgrade to yourself and try Android-studio. There are many lessons and really you can do many things on your own. Good luck."},{"owner":{"user_id":20997947,"display_name":"Sayon Mitra"},"edited":false,"comment_id":132540062,"body":"Thanks, sir, for helping, I will try to do better in future if I make money with my apps."}],"answers":[{"owner":{"user_id":4262407,"display_name":"mipa"},"up_vote_count":1,"is_accepted":false,"creation_date":1673614197,"answer_id":75109471,"body":"<p>In order to build JavaFX apps for Android (and also iOS) you need to use the tooling provided by Gluon. Extensive documentation can be found here: <a href=\"https://docs.gluonhq.com/\" rel=\"nofollow noreferrer\">https://docs.gluonhq.com/</a>\nThere are also some tutorials, e.g., this one <a href=\"https://foojay.io/today/creating-mobile-apps-with-javafx---part-1/\" rel=\"nofollow noreferrer\">https://foojay.io/today/creating-mobile-apps-with-javafx---part-1/</a></p>\n"}],"owner":{"user_id":20997947,"display_name":"Sayon Mitra"},"view_count":43,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1673596851,"question_id":75106324,"body":"<p>I am a new programmer, and I am learning JavaFX now. But I want to make Android apps too, and I searched for it online. I saw a few people was saying that we can create Android apps with JavaFX too. But there is no course or anything on how I can use JavaFX for Android app development. How can I create Android apps with JavaFX?</p>\n<p>Thanks in Advance.</p>\n<hr />\n<p>BTW I am using VS Code and have a JavaFX sdk installed. I did not found much results on the Internet. Please help me, I am a beginner, and I don't know how to do that.</p>\n"},{"tags":["java","scala","jna"],"answers":[{"owner":{"user_id":1161484,"display_name":"Daniel Widdis"},"up_vote_count":1,"is_accepted":true,"creation_date":1673557431,"answer_id":75102277,"body":"<p>The <code>**</code> represents a pointer to a pointer to a byte (the beginning of the byte array of interest), so the correct implementation is a <code>PointerByReference</code>:</p>\n<pre class=\"lang-scala prettyprint-override\"><code>def func(output: PointerByReference): Int\n</code></pre>\n<p>The value being returned is ultimately a <code>Pointer</code>. Since 'Memory' is a subclass of <code>Pointer</code> designed for Java-level allocation of memory.  Since it's a subclass it appears to work, but is not the correct implementation.</p>\n<p><code>PointerByReference.getValue()</code> returns the <code>Pointer</code> pointed to, removing one level of indirection to get you to <code>byte*</code>:</p>\n<pre class=\"lang-scala prettyprint-override\"><code>// val size = size of buffer that you are passing to the actual function\nval pbr = new PointerByReference()\n// allocates the array and returns pointer to it\nval resultCode = NativeLibrary.INSTANCE.func(pbr)\n// get the pointer to the actual data\nval dataPointer = pbr.getValue()\n// get the data as a byte array\nval data = dataPointer.getByteArray(0, size)\n// later to free the `byte*`\nresultCode = voicevox_wav_free(dataPointer)\n</code></pre>\n"}],"owner":{"user_id":3173048,"display_name":"Windymelt"},"view_count":75,"up_vote_count":2,"accepted_answer_id":75102277,"answer_count":1,"score":2,"creation_date":1673541120,"question_id":75099485,"body":"<p>I'm trying to use JNA to call native API in Scala. I don't know how to pass pointer of array of byte (<code>byte**</code>).</p>\n<p>The signature of native API follows:</p>\n<pre class=\"lang-c prettyprint-override\"><code>// this function mallocs some array buffer and stores it to passed pointer value\nint func(byte **output);\n</code></pre>\n<p>Then I tried to pass pointer like this:</p>\n<pre class=\"lang-scala prettyprint-override\"><code>class NativeLibrary extends Library {\n  def func(output: Array[Byte]) // doesn't work. thats' for byte*, not byte**\n  def func(output: Array[Array[Byte]]) // doesn't work. JNA doesn't support this type\n  def func(output: Memory) // works, but I don't know how to get inner array\n}\n</code></pre>\n<p>Both don't seem to work, returning broken pointer value or raising SEGV.</p>\n<p>How can I retrieve array from this native function?</p>\n<p>Actual native function: <a href=\"https://github.com/VOICEVOX/voicevox_core/blob/0.13.0/core/src/core.h#L169\" rel=\"nofollow noreferrer\">https://github.com/VOICEVOX/voicevox_core/blob/0.13.0/core/src/core.h#L169</a></p>\n"},{"tags":["java","spring","spring-boot","multipartform-data"],"answers":[{"owner":{"user_id":9513184,"display_name":"Unmitigated"},"up_vote_count":1,"is_accepted":false,"creation_date":1673540546,"answer_id":75099371,"body":"<p>Add a field for the <code>MultipartFile</code> in <code>PortfolioFileSaveRequestDto</code> so you can handle all the data together.</p>\n"}],"owner":{"user_id":16752809,"display_name":"gs97ahn"},"view_count":55,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1673540330,"question_id":75099317,"body":"<p>I tried implementing this way, but I get <code>415 Error</code> if I send the request. I don't want to split it into two different request. I'm not sure what I am doing wrong.</p>\n<pre class=\"lang-java prettyprint-override\"><code>\n    @ResponseStatus(value = HttpStatus.CREATED)\n    @PostMapping(value = &quot;/file/new&quot;,\n            consumes = {MediaType.APPLICATION_JSON_VALUE, MediaType.MULTIPART_FORM_DATA_VALUE})\n    public ResponseEntity&lt;DefaultResponseDto&lt;Object&gt;&gt; createFile(HttpServletRequest servletRequest,\n                                                                 @RequestBody @Valid\n                                                                 PortfolioFileSaveRequestDto request,\n                                                                 @RequestPart MultipartFile file) {\n        List&lt;String&gt; tokenInfo = jwtProvider.authorizeJwt(servletRequest.getHeader(AUTHORIZATION));\n\n        ...\n\n        Portfolio portfolio = portfolioService.saveFile(request, user.getUsername(), profile, file);\n\n        ...\n    }\n</code></pre>\n"},{"tags":["java","spring","kotlin","exception","controller-advice"],"comments":[{"owner":{"user_id":4467208,"display_name":"Murat Karag&#246;z"},"edited":false,"comment_id":132525257,"body":"Does this answer your question? <a href=\"https://stackoverflow.com/questions/37398385/spring-boot-and-custom-404-error-page\">Spring Boot and custom 404 error page</a>"},{"owner":{"user_id":4467208,"display_name":"Murat Karag&#246;z"},"edited":false,"comment_id":132525289,"body":"<a href=\"https://www.baeldung.com/spring-boot-custom-error-page\" rel=\"nofollow noreferrer\">baeldung.com/spring-boot-custom-error-page</a>"},{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":132525584,"body":"Have you tried <code>@ControllerAdvice</code> as this doesn&#39;t really match an <code>@RestController</code> but anything. You would also need an exception handler for a <code>NoHandlerFoundException</code>"},{"owner":{"user_id":4012392,"display_name":"hc0re"},"edited":false,"comment_id":132525771,"body":"@MuratKarag&#246;z I&#39;ve seen this question, no, this doesn&#39;t help me, sadly."},{"owner":{"user_id":4012392,"display_name":"hc0re"},"edited":false,"comment_id":132525792,"body":"@M.Deinum changing from RestControllerAdvice to ControllerAdvice doesn&#39;t help"},{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":132526036,"body":"As mentioned you need one for <code>NoHandlerFoundException</code> and set <code>spring.mvc.throw-exception-if-no-handler-found</code> to <code>true</code> else the <code>DispatcherServlet</code> will handle it itself."},{"owner":{"user_id":4012392,"display_name":"hc0re"},"edited":false,"comment_id":132526160,"body":"@M.Deinum I have set pring.mvc.throw-exception-if-no-handler-found to true, the logs look fine, but I still receive the whitelabel error page instead of a custom JSON..."}],"answers":[{"owner":{"user_id":888580,"display_name":"lane.maxwell"},"up_vote_count":1,"is_accepted":false,"creation_date":1673547584,"answer_id":75100721,"body":"<p><code>spring.mvc.throw-exception-if-no-handler-found</code> works in conjunction with\n<code>spring.mvc.static-path-pattern</code>.  By default, the static path pattern is /**, which includes the whitelabel error pages that you're seeing.</p>\n<p>See <a href=\"https://github.com/spring-projects/spring-boot/pull/31660\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-boot/pull/31660</a>\nand <a href=\"https://gitter.im/spring-projects/spring-boot?at=62ba1378568c2c30d30790af\" rel=\"nofollow noreferrer\">https://gitter.im/spring-projects/spring-boot?at=62ba1378568c2c30d30790af</a>\nand <a href=\"https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#web.servlet.spring-mvc.static-content\" rel=\"nofollow noreferrer\">https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#web.servlet.spring-mvc.static-content</a></p>\n<p>Option one is to set these two properties in your configuration.</p>\n<pre><code>spring:\n  mvc:\n    throw-exception-if-no-handler-found: true\n    static-path-pattern: /static\n</code></pre>\n<p>Option 2 is to add <code>@EnableWebMvc</code> to your spring boot application, and set the <code>spring.mvc.throw-exception-if-no-handler-found</code> property to true.  By adding <code>EnableWebMvc</code> you'll be getting the <code>WebMvcConfigurationSupport</code> bean, which will cause Spring not to initialize the <code>WebMvcAutoConfiguration</code> and thereby not set the static-path-pattern.</p>\n"}],"owner":{"user_id":4012392,"display_name":"hc0re"},"view_count":201,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1673535394,"question_id":75098242,"body":"<p>I have a problem with Spring's exception handling for controllers. I have a class annotated with <code>@RestControllerAdvice</code> with a couple of <code>@ExceptionHandler</code>'s, like this:</p>\n<pre><code>@ExceptionHandler(HttpRequestMethodNotSupportedException::class)\nfun methodNotSupportedException(\n    exception: HttpRequestMethodNotSupportedException,\n    request: HttpServletRequest\n): ResponseEntity&lt;ApiError&gt; {\n    logger().error(&quot;Method not supported: {}&quot;, exception.message)\n    val methodNotAllowed = HttpStatus.METHOD_NOT_ALLOWED\n    val apiError = logAndBuildApiError(request, methodNotAllowed, exception)\n    return ResponseEntity(apiError, methodNotAllowed)\n}\n</code></pre>\n<p>and they work perfectly fine. In this case, when I'm trying to use an non-implemented HTTP method like POST:</p>\n<pre><code>{\n    &quot;requestUri&quot;: &quot;/api/v1/items&quot;,\n    &quot;status&quot;: 405,\n    &quot;statusText&quot;: &quot;Method Not Allowed&quot;,\n    &quot;createdAt&quot;: &quot;2023-01-12T16:50:36.55422+02:00&quot;,\n    &quot;errorMessage&quot;: &quot;Request method 'POST' not supported&quot;\n}\n</code></pre>\n<p>What I would like to achieve is to handle situations when someone is trying to reach an non-existing endpoint, i.e. the correct one is <code>GET http://localhost:8080/api/v1/items</code>.</p>\n<p>But when I'm trying to reach <code>http://localhost:8080/api/v1/itemss</code>, which is of course nonexistent, I recieve a regular Spring whitelabel error page, but I would like to receive a JSON like in the former example:</p>\n<pre><code>{\n    &quot;requestUri&quot;: &quot;/api/v1/itemss&quot;,\n    &quot;status&quot;: 404,\n    &quot;statusText&quot;: &quot;Not Found&quot;,\n    &quot;createdAt&quot;: &quot;2023-01-12T16:52:06.932108+02:00&quot;,\n    &quot;errorMessage&quot;: &quot;Some error message&quot;\n}\n</code></pre>\n<p>How do I implement a <code>@ExceptionHandler</code> so it could handle exceptions related to non-existing resources?</p>\n"},{"tags":["java","java-8","mockito","junit5","completable-future"],"comments":[{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":132525224,"body":"Something in <a href=\"https://stackoverflow.com/q/40485398/2711488\">this direction</a>?"},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":132555532,"body":"@Holger - Thanks I changed my question appropriately."},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":132563597,"body":"@AbhijitSarkar - need it to test all edge cases(null, number of times, etc) but keep in mind that its generic and reusable for all general purposes involving <code>CompletableFuture</code>."},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":132563651,"body":"I used the link from @Holger to come up with this <code>RetryUtility</code> but don&#39;t see any JUnit tests in that link... Why does this question need to be closed? The Holger link was only asking for the <code>retry()</code> implementation but now how to test it... This question is a different question Created the open bounty so someone could help me with some direction using code examples not to tell me that my post should be closed..."},{"owner":{"user_id":839733,"display_name":"Abhijit Sarkar"},"edited":false,"comment_id":132563726,"body":"You’ve been long enough to know how stackoverflow works. IMO, your question should be closed because it’s not about a specific problem you encountered while attempting to write JUnit tests. What you’re asking for is someone to write the tests for you, and you’ve shown no evidence that you even tried to do that yourself."},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":132563739,"body":"Am just seeking some direction not a complete solution."},{"owner":{"user_id":839733,"display_name":"Abhijit Sarkar"},"edited":false,"comment_id":132565085,"body":"I&#39;d recommend using a battle tested library like <a href=\"https://resilience4j.readme.io/docs/retry\" rel=\"nofollow noreferrer\">resilience4j</a> instead of rolling your own. The good thing about it is that someone else will write the tests for you."},{"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"edited":false,"comment_id":132566606,"body":"Thank you but this was just supposed to be generic at the Java SE level. I could write the mockito test by injecting my service impl objects but this <code>RetryUtility</code> is written inside an in-house common library that is imported into a microservice as a Maven dependency The usage I provided for the <code>OrderServiceFuture</code> is from the microservice just as an example. Does this make sense? I&#39;ll edit my post."}],"answers":[{"owner":{"user_id":7970787,"display_name":"Alex R"},"up_vote_count":1,"is_accepted":false,"creation_date":1673749762,"answer_id":75122574,"body":"<p>Before you ask &quot;How do I test method X?&quot; it helps to clarify &quot;What does X actually do?&quot;. To answer\nthis latter question I personally like to rewrite methods in a way such that individual steps become\nclearer.</p>\n<p>Doing that for your <code>retry</code> method, I get:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static &lt;R&gt; CompletableFuture&lt;R&gt; retry(\n        Supplier&lt;CompletableFuture&lt;R&gt;&gt; supplier,\n        int numRetries\n) {\n    CompletableFuture&lt;R&gt; completableFuture = supplier.get();\n    for (int i = 0; i &lt; numRetries; i++) {\n        Function&lt;R, CompletableFuture&lt;R&gt;&gt; function1 = CompletableFuture::completedFuture;\n        CompletableFuture&lt;CompletableFuture&lt;R&gt;&gt; tmp1 = completableFuture.thenApply(function1);\n        \n        Function&lt;Throwable, CompletableFuture&lt;R&gt;&gt; function2 = t -&gt; supplier.get();\n        CompletableFuture&lt;CompletableFuture&lt;R&gt;&gt; tmp2 = tmp1.exceptionally(function2);\n        \n        Function&lt;CompletableFuture&lt;R&gt;, CompletableFuture&lt;R&gt;&gt; function3 = Function.identity();\n        completableFuture = tmp2.thenCompose(function3);\n    }\n    return completableFuture;\n}\n</code></pre>\n<p>Note that I removed the unnecessary <code>if</code> statement and also the <code>log.info</code> call. The latter isn't\ntestable unless you pass in a logger instance as a method argument (or make <code>retry</code> non-static and\nhave the logger as an instance variable that is passed via the constructor, or maybe use some\ndirty hacks like redirecting the logger output stream).</p>\n<p>Now, what does <code>retry</code> actually do?</p>\n<ol>\n<li>It calls <code>supplier.get()</code> once and assigns the value to the <code>completableFuture</code> variable.</li>\n<li>If <code>numRetries &lt;= 0</code>, then it returns <code>completableFuture</code> which is the same CF instance that the\nSupplier's <code>get</code> method returned.</li>\n<li>If <code>numRetries &gt; 0</code>, then it does the following steps <code>numRetries</code> times:\n<ol>\n<li>It creates a function <code>function1</code> that returns a completed CF.</li>\n<li>It passes <code>function1</code> to the <code>thenApply</code> method of <code>completableFuture</code>, creating a new\nCF <code>tmp1</code>.</li>\n<li>It creates another function <code>function2</code> which is a function that ignores its input argument\nbut calls <code>supplier.get()</code>.</li>\n<li>It passes <code>function2</code> to the <code>exceptionally</code> method of <code>tmp1</code>, creating a new\nCF <code>tmp2</code>.</li>\n<li>It creates a third function <code>function3</code> which is the identity function.</li>\n<li>It passes <code>function3</code> to the <code>thenCompose</code> of <code>tmp2</code>, creating a new CF and assigning it to\nthe <code>completableFuture</code> variable.</li>\n</ol>\n</li>\n</ol>\n<p>Having a clear breakdown of what a function does lets you see what you can test and what you cannot\ntest and, therefore, might want to refactor. Steps 1. and 2. are very easy to test:</p>\n<p>For step 1. you mock a <code>Supplier</code> and test that it's <code>get</code> method is called:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Test\nvoid testStep1() { // please use more descriptive names...\n    Supplier&lt;CompletableFuture&lt;Object&gt;&gt; mock = Mockito.mock(Supplier.class);\n    RetryUtility.retry(mock, 0);\n    Mockito.verify(mock).get();\n    Mockito.verifyNoMoreInteractions(mock);\n}\n</code></pre>\n<p>For step 2. you let the supplier return some predefined instance and check that <code>retry</code> returns\nthe same instance:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Test\nvoid testStep2() {\n    CompletableFuture&lt;Object&gt; instance = CompletableFuture.completedFuture(&quot;&quot;);\n    Supplier&lt;CompletableFuture&lt;Object&gt;&gt; supplier = () -&gt; instance;\n    CompletableFuture&lt;Object&gt; result = RetryUtility.retry(supplier, 0);\n    Assertions.assertSame(instance, result);\n}\n</code></pre>\n<p>The tricky part is, of course, step 3. The first thing you should look out for is which variables\nare influenced by our input arguments. These are: <code>completableFuture</code>, <code>tmp1</code>, <code>function2</code>,\nand <code>tmp2</code>. In contrast, <code>function1</code> and <code>function3</code> are practically constants and are not\ninfluenced by our input arguments.</p>\n<p>So, how can we influence the listed arguments then? Well, <code>completableFuture</code> is the return value\nof the <code>get</code> method of our <code>Supplier</code>. If we let <code>get</code> return a mock, we can influence the return\nvalue of <code>thenApply</code>. Similarly, if we let <code>thenApply</code> return a mock, we can influence the return\nvalue of <code>expectionally</code>. We can apply the same logic to <code>thenCompose</code> and then test that\nour methods have been called the correct amount of times in the correct order:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ParameterizedTest\n@ValueSource(ints = {0, 1, 2, 3, 5, 10, 100})\nvoid testStep3(int numRetries) {\n    CompletableFuture&lt;Object&gt; completableFuture = mock(CompletableFuture.class);\n    CompletableFuture&lt;CompletableFuture&lt;Object&gt;&gt; tmp1 = mock(CompletableFuture.class);\n    CompletableFuture&lt;CompletableFuture&lt;Object&gt;&gt; tmp2 = mock(CompletableFuture.class);\n\n    doReturn(tmp1).when(completableFuture).thenApply(any(Function.class));\n    doReturn(tmp2).when(tmp1).exceptionally(any(Function.class));\n    doReturn(completableFuture).when(tmp2).thenCompose(any(Function.class));\n\n    CompletableFuture&lt;Object&gt; retry = RetryUtility.retry(\n            () -&gt; completableFuture, // here 'get' returns our mock\n            numRetries\n    );\n    // While we're at it we also test that we get back our initial CF\n    Assertions.assertSame(completableFuture, retry);\n\n    InOrder inOrder = Mockito.inOrder(completableFuture, tmp1, tmp2);\n    for (int i = 0; i &lt; numRetries; i++) {\n        inOrder.verify(completableFuture, times(1)).thenApply(any(Function.class));\n        inOrder.verify(tmp1, times(1)).exceptionally(any(Function.class));\n        inOrder.verify(tmp2, times(1)).thenCompose(any(Function.class));\n    }\n    inOrder.verifyNoMoreInteractions();\n}\n</code></pre>\n<p>What about the method arguments of <code>thenApply</code> and <code>thenCompose</code>? There is no way to test\nthat these methods have been called with <code>function1</code> and <code>function3</code>, respectively, (unless you\nrefactor your code and move the functions out of that method call) as these functions are local to\nour method and not influenced by our arguments.\nBut what about <code>function2</code>? While we cannot test that <code>exceptionally</code> is called with <code>function2</code> as\nan argument, we can test that <code>function2</code> calls <code>supplier.get()</code> exactly <code>numRetries</code> times. When\ndoes it do that? Well, only if the CF fails:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ParameterizedTest\n@ValueSource(ints = {0, 1, 2, 3, 5, 10, 100})\nvoid testStep3_4(int numRetries) {\n    CompletableFuture&lt;Object&gt; future = CompletableFuture.failedFuture(new RuntimeException());\n    Supplier&lt;CompletableFuture&lt;Object&gt;&gt; supplier = mock(Supplier.class);\n    doReturn(future).when(supplier).get();\n\n    Assertions.assertThrows(\n            CompletionException.class,\n            () -&gt; RetryUtility.retry(supplier, numRetries).join()\n    );\n    \n    // remember: supplier.get() is also called once at the beginning \n    Mockito.verify(supplier, times(numRetries + 1)).get();\n    Mockito.verifyNoMoreInteractions(supplier);\n}\n</code></pre>\n<p>Similarly, you can test that <code>retry</code> calls the <code>get</code> method <code>n+1</code> times by providing a supplier,\nthat returns a completed future after it has been called <code>n</code> times.</p>\n<p>What we still need to do (and what we should probably have had done as a first step) is to test\nwhether the return value of our method behaves correctly:</p>\n<ul>\n<li>If the CF fails <code>numRetries</code> tries, the CF should complete exceptionally.</li>\n<li>If the CF fails fewer than <code>numRetries</code> tries, the CF should complete normally.</li>\n</ul>\n<pre class=\"lang-java prettyprint-override\"><code>@ParameterizedTest\n@ValueSource(ints = {0, 1, 2, 3, 5, 10})\nvoid testFailingCf(int numRetries) {\n    RuntimeException exception = new RuntimeException(&quot;&quot;);\n    CompletableFuture&lt;Object&gt; future = CompletableFuture.failedFuture(exception);\n\n    CompletionException completionException = Assertions.assertThrows(\n            CompletionException.class,\n            () -&gt; RetryUtility.retry(() -&gt; future, numRetries).join()\n    );\n    Assertions.assertSame(exception, completionException.getCause());\n}\n\n@ParameterizedTest\n@ValueSource(ints = {0, 1, 2, 3, 5, 10})\nvoid testSucceedingCf(int numRetries) {\n    final AtomicInteger counter = new AtomicInteger();\n    final String expected = &quot;expected&quot;;\n\n    Supplier&lt;CompletableFuture&lt;Object&gt;&gt; supplier =\n            () -&gt; (counter.getAndIncrement() &lt; numRetries / 2)\n                    ? CompletableFuture.failedFuture(new RuntimeException())\n                    : CompletableFuture.completedFuture(expected);\n\n    Object result = RetryUtility.retry(supplier, numRetries).join();\n\n    Assertions.assertEquals(expected, result);\n    Assertions.assertEquals(numRetries / 2 + 1, counter.get());\n}\n</code></pre>\n<p>Some other cases you might want to consider testing and catching are what happens if <code>numRetries</code> is\nnegative or very large? Should such method calls throw an exception?</p>\n<hr>\n<p>Another question we haven't touched so far is: <strong><em>Is this the right way to test your code?</em></strong></p>\n<p>Some people might say yes, others\nwould argue that you shouldn't test the internal structure of your method but only its output given\nsome input (i.e. basically only the last two tests). That's clearly debatable and, like most things,\ndepends\non your requirements. (For example, would you test the internal structure of some sorting\nalgorithm, like array assignments and what not?).</p>\n<p>As you can see, by testing the internal structure, the tests become quite complicated and involve a\nlot of mocking. Testing the internal structure can also make refactoring more troublesome, as your\ntests might start to fail, even though you haven't changed the logic of your method. Personally, in\nmost situations I wouldn't write such tests. However, if a lot of people depended on the correctness\nof my code, for example on the order in which steps are executed, I might consider it.</p>\n<p>In any case, if you choose to go that route, I hope these examples are useful to you.</p>\n"}],"owner":{"user_id":146234,"display_name":"PacificNW_Lover"},"view_count":274,"up_vote_count":3,"answer_count":1,"score":2,"creation_date":1673512764,"question_id":75093513,"body":"<p>Have a common framework that isn't server specific which we use to import and re-use objects inside our microservices but can be used for any particular Java program which supports Java 8.</p>\n<p>Was tasked to create a <code>retry()</code> mechanism that would take the following two parameters:</p>\n<ol>\n<li><code>Supplier&lt;CompletableFuture&lt;R&gt;&gt; supplier</code></li>\n<li><code>int numRetries</code></li>\n</ol>\n<p>What I needed it to do is to make a generic component that conducts a retry operation for a <code>CompletableFuture</code> every time there's an exception based on the <code>numRetries</code> specified.</p>\n<p>Using Java 8, I wrote the following generic helper class which uses a Supplier to retry a method based on a number of retries specified.</p>\n<p>Am new to <code>CompletableFuture</code>, in general, so am wondering how to write a JUnit 5 (and if Mockito is better) test for this method? Am testing for all edge cases and have made this as generic as possible for others to re-use.</p>\n<p>Note this is inside an in-house common framework which is imported by other microservices as a Maven dependency but the aim is to be able to re-use this at the Java SE level.</p>\n<pre><code>public class RetryUtility {\n\n    private static final Logger log = \n                    LoggerFactory.getLogger(RetryUtility.class);\n\n    public static &lt;R&gt; CompletableFuture&lt;R&gt; retry(\n                                       Supplier&lt;CompletableFuture&lt;R&gt;&gt; supplier, \n                                       int numRetries) {\n        CompletableFuture&lt;R&gt; completableFuture = supplier.get();\n        if (numRetries &gt; 0) {\n            for (int i = 0; i &lt; numRetries; i++) {\n                completableFuture = \n                            completableFuture\n                              .thenApply(CompletableFuture::completedFuture)\n                              .exceptionally(\n                                  t -&gt; {\n                                   log.info(&quot;Retrying for {}&quot;, t.getMessage());\n                                   return supplier.get();\n                                })\n                              .thenCompose(Function.identity());\n            }\n        }\n        return completableFuture;\n    }\n}\n</code></pre>\n<hr />\n<p>Usage: Presume this code compiles and works, I was able to put in a wrong URL in the config file for <code>client</code> and <code>log.info(Error getting orderResponse = {});</code> was printed twice via <code>grep</code> against <code>app.log</code> file.</p>\n<p>This is the calling class that imports the above class as Maven dependency:</p>\n<pre><code>public class OrderServiceFuture {\n\n    private CompletableFuture&lt;OrderReponse&gt; getOrderResponse(\n                           OrderInput orderInput,BearerToken token) {\n        int numRetries = 1;\n        CompletableFuture&lt;OrderReponse&gt; orderResponse =\n               RetryUtility.retry(() -&gt; makeOrder(orderInput, token), numRetries);\n        orderResponse.join();\n        return orderResponse;\n    }\n\n    public CompletableFuture&lt;OrderReponse&gt; makeOrder() {\n        return client.post(orderInput, token),\n            orderReponse -&gt; {\n            log.info(&quot;Got orderReponse = {}&quot;, orderReponse);\n        },\n        throwable -&gt; {\n            log.error(&quot;Error getting orderResponse = {}&quot;, throwable.getMessage());\n        }\n    }\n}\n</code></pre>\n<hr />\n<p>Although this example's calling class uses  <code>OrderSerice</code> with an <code>HttpClient</code> making a call, this is a generic utility class that was specifically written to be reusable for any type of method call which returns <code>CompletableFuture&lt;OrderReponse&gt;</code>.</p>\n<p>Question(s):</p>\n<ol>\n<li><p>How to write a JUnit 5 test case (or Mockito) for this:\n<code>public static &lt;R&gt; CompletableFuture&lt;R&gt; RetryUtility.retry(Supplier&lt;CompletableFuture&lt;R&gt;&gt; supplier, int numRetries)</code> method?</p>\n</li>\n<li><p>Is there any edge cases or nuances that someone can see with its design and/or implementation?</p>\n</li>\n</ol>\n"},{"tags":["java","date","time","format","formatter"],"comments":[{"owner":{"user_id":7109162,"display_name":"XtremeBaumer"},"edited":false,"comment_id":132496341,"body":"<code>DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd-HH.mm.ss.SSSSSS&quot;).pa&zwnj;&#8203;rse(&quot;2022-09-23-11.2&zwnj;&#8203;5.52.660135&quot;);</code> use the new classes for representing instances in time"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132497787,"body":"Stay far away from <code>Date</code>, <code>DateFormat</code> and <code>SimpleDateFormat</code>. They give you nothing but trouble and are fortunately long outdated. Use java.time, the modern Java date and time API."},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132497833,"body":"What data type has the value got in your database? And why would you need a string for your query? Prefer a datetime type (from java.time, as I said)."},{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"edited":false,"comment_id":132498001,"body":"Check <a href=\"https://stackoverflow.com/a/67752047/10819573\">this answer</a> and <a href=\"https://stackoverflow.com/a/67505173/10819573\">this answer</a> to learn how to use <code>java.time</code> API with JDBC. It your case, it will be <code>LocalDateTime</code>."},{"owner":{"user_id":20981101,"display_name":"TheCrow"},"edited":false,"comment_id":132500120,"body":"I checked the info about this column and it is a Timestamp on DB not a Date. I tried to get the date as LocalDateTime and now i get the entire date correctly"},{"owner":{"user_id":10819573,"display_name":"Arvind Kumar Avinash"},"edited":false,"comment_id":132500739,"body":"Great! Wish you more success!"},{"owner":{"user_id":5772882,"display_name":"Ole V.V."},"edited":false,"comment_id":132505648,"body":"@TheCrow Would you write an answer to your own question based on what you got to work with <code>LocalDateTime</code>? I am sure it will be very helpful to future readers, and if it is, I will be happy to upvote it."}],"answers":[{"owner":{"user_id":773113,"display_name":"Mike Nakis"},"up_vote_count":1,"is_accepted":false,"creation_date":1673433114,"answer_id":75081625,"body":"<p>Not only I do not know of any such format, but <em><strong>there exists no such format,</strong></em> because:</p>\n<ul>\n<li><p>the available formats are listed exhaustively <a href=\"https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html\" rel=\"nofollow noreferrer\">in the documentation of the class</a>, and no such format is included in that list. If someone knew of some format which magically works even though it is not listed, you should not use it because this would constitute <em><strong>documentation by divine revelation</strong></em> and <em><strong>programming by magic</strong></em>.</p>\n</li>\n<li><p>both <code>SimpleDateFormat</code> and <code>DateFormat</code> were built to work with <code>Date</code>, which is defined <a href=\"https://docs.oracle.com/javase/7/docs/api/java/util/Date.html\" rel=\"nofollow noreferrer\">by its documentation</a> as having <em>millisecond precision.</em> Thus, there is no way to format microseconds because <code>Date</code> does not have microseconds.</p>\n</li>\n</ul>\n<p>In light of the above, your statement that you 'lose the &quot;135&quot;' is suspicious: what makes you believe that you had a 135 in the first place? Come to think of it, you have completely failed to explain something very important: are you trying to print a date, or to parse a date? If you are trying to parse a date, then what makes you believe that you can have that 135 in a date? That's why <em><strong>showing your code is always very important on StackOverflow</strong></em>.</p>\n<p>To answer the &quot;how do you do it&quot; part:</p>\n<ul>\n<li><p>If you really like <code>SimpleDateFormat</code>, you can use it to output the time coordinate without microseconds, then append a '.' to it, and then convert the microseconds to string by yourself, left-padding with zeros.</p>\n</li>\n<li><p>However, if you are using <code>Instant</code>, then you should be using the <code>DateTimeFormatter</code> class, which offers a format specifier for describing fractions of a second with precisions greater than milliseconds.</p>\n</li>\n</ul>\n"},{"owner":{"user_id":5973244,"display_name":"jayaraj"},"up_vote_count":0,"is_accepted":false,"creation_date":1673435938,"answer_id":75082203,"body":"<p>try this\nDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd-HH.mm.ssssss&quot;);</p>\n"}],"owner":{"user_id":20981101,"display_name":"TheCrow"},"view_count":121,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1673432375,"question_id":75081467,"body":"<p>Do you know a format for this kind of date without losing the last 3 numbers?</p>\n<p>I used a select query in my project to extract a date from a table and I need to use this date for a second query and extract other information on another table. The Date I got from the first query has this structure and the value is only an example:</p>\n<p>&quot;2022-09-23-11.25.52.660135&quot;</p>\n<p>I need to use this Date as String in order to do the second query, but when I use the format, I lose the last 3 numbers ( 135 ) and obviously the select returns nothing because the date is wrong.</p>\n<p>I used this DateFormat for the first try:</p>\n<pre class=\"lang-java prettyprint-override\"><code>DateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd-HH.mm.ss.SS&quot;);\n</code></pre>\n<p>Formats like yyyy-MM-dd-HH.mm.ss.SSS and yyyy-MM-dd-HH.mm.ss.SSSSSS don't work because it will just add zeroes and I need the exact same Date.</p>\n<p>To solve this issue i had to edit the format of the column in the model class of the desired table. In my case for example</p>\n<p><code>@Column(name = &quot;TIMESTAMP_B_B03&quot;) private Timestamp timestampB03;</code></p>\n<p>I had to change Timestamp and use LocalDateTime to get microseconds</p>\n<p>ps: the real format of the column on DB is Timestamp but you need to use LocalDateFormat in java.</p>\n"},{"tags":["java","google-drive-api"],"comments":[{"owner":{"user_id":1841839,"display_name":"Linda Lawton - DaImTo"},"edited":false,"comment_id":132493180,"body":"Can i get a little more context on exactly what you want help with here?    what do you mean by &quot;publicly available google drive link&quot; what is this and how was it created?   Why not download them directly via the drive api?   If you want help fixing &quot;using url.openStream() but it provided the name(without link)&quot;  you need to add the code."},{"owner":{"user_id":1474659,"display_name":"abhijeet"},"edited":false,"comment_id":132493246,"body":"publicly available google drive link means that if I open the link in browser in incognito mode, it shows the content of the attached folder."},{"owner":{"user_id":1474659,"display_name":"abhijeet"},"edited":false,"comment_id":132493283,"body":"I am able to use drive APIs to access files in my drive but unable to access the URLs as I am not able to find a method which takes URL as input."},{"owner":{"user_id":1474659,"display_name":"abhijeet"},"edited":false,"comment_id":132493418,"body":"@DaImTo I have provided the explanations regarding your questions. I request you to have a look and let me know."},{"owner":{"user_id":1841839,"display_name":"Linda Lawton - DaImTo"},"edited":false,"comment_id":132494083,"body":"If the link you are talking about is one of those share with me links.   Go to drive right click -&gt; share with me then get that link.   You cant access that with the api as its not a true share its not shared permissions so it wont work.   The drive api will need you to have a permission set.  in order to access it."},{"owner":{"user_id":1841839,"display_name":"Linda Lawton - DaImTo"},"edited":false,"comment_id":132494122,"body":"That code looks fun let me give it a go I have never tried with downloading a directory like that interesting use case."},{"owner":{"user_id":1474659,"display_name":"abhijeet"},"edited":false,"comment_id":132494228,"body":"Let us <a href=\"https://chat.stackoverflow.com/rooms/251026/discussion-between-abhijeet-and-daimto\">continue this discussion in chat</a>."}],"answers":[{"owner":{"user_id":1841839,"display_name":"Linda Lawton - DaImTo"},"up_vote_count":1,"is_accepted":true,"creation_date":1673429340,"answer_id":75080839,"body":"<p>The link you are using contains the folder id, the folder should also be readable by everyone.</p>\n<p>In this instance you can use the files.list method from the Google drive api and access it using 'folderid' in parents which will return a list of all of the files within that folder.</p>\n<p>For this to work the folder needs to be public to viewers which yours seem to be, after our conversation in chat.</p>\n"}],"owner":{"user_id":1474659,"display_name":"abhijeet"},"view_count":68,"up_vote_count":2,"accepted_answer_id":75080839,"answer_count":1,"score":2,"creation_date":1673424215,"question_id":75079904,"body":"<p>I have been trying to download files/whole directory from publicly available google drive link URL using Java. I am able to read files which are present in my google drive using google drive libraries but I am not able to understand how to pass google drive link URL.</p>\n<p>Also, I tried to use typical method of downloading files from URL  but it produced error java.io.IOException: Server returned HTTP response code: 400 for URL.</p>\n<pre><code>URL url;\nURLConnection con;\nDataInputStream dis;\nFileOutputStream fos;\nbyte[] fileData;\ntry {\n    url = new URL(&quot;https://drive.google.com/drive/folders/&lt;some-alphanumeric-code&gt;/&lt;file-name&gt;&quot;); //File Location goes here\n    con = url.openConnection(); // open the url connection.\n    dis = new DataInputStream(con.getInputStream());\n    fileData = new byte[con.getContentLength()];\n    for (int q = 0; q &lt; fileData.length; q++) {\n        fileData[q] = dis.readByte();\n    }\n    dis.close(); // close the data input stream\n    fos = new FileOutputStream(new File(&quot;/Users/abhijeetkunwar/file.png&quot;)); //FILE Save Location goes here\n    fos.write(fileData);  // write out the file we want to save.\n    fos.close(); // close the output stream writer\n}\ncatch(Exception m) {\n   System.out.println(m);\n}\n</code></pre>\n<p>Kindly suggest the solution please.</p>\n"},{"tags":["java","multithreading","mockito","guice"],"comments":[{"owner":{"user_id":7109162,"display_name":"XtremeBaumer"},"edited":false,"comment_id":132496962,"body":"In the code you posted, you mock the service class, not the util class <code>Mockito.mockStatic(SomeService.class)</code>"},{"owner":{"user_id":3305737,"display_name":"Jonasz"},"edited":false,"comment_id":132506290,"body":"@XtremeBaumer is right - the test code does not even compile (incompatible types)."},{"owner":{"user_id":18087971,"display_name":"waynewingorc"},"edited":false,"comment_id":132511650,"body":"Sorry about the typo @XtremeBaumer. I&#39;ve corrected them. And I seem to have found out why <code>MockedStatic</code> doesn&#39;t work for me: that it&#39;s called by another thread."}],"answers":[{"owner":{"user_id":3305737,"display_name":"Jonasz"},"up_vote_count":1,"is_accepted":true,"creation_date":1673413329,"answer_id":75078521,"body":"<p>Your tested code doesn't seem to match your test code. In <code>SomeService#doSth</code> you're calling <code>UtilClass.getConfigForId()</code>, yet in the test you're mocking a method with different signature: <code>UtilClass.getConfigForId(&quot;id&quot;)</code>.</p>\n<p>If you use a method with String parameter in your code, the stubbing has to match it, so if in the test you expect a value <code>&quot;id&quot;</code>, it should be passed to the method in the tested code (<code>SomeService</code>) as well (values are compared using <code>equals</code> method in Mockito by default). Otherwise, you should use <a href=\"https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/ArgumentMatchers.html#any--\" rel=\"nofollow noreferrer\">an ArgumentMatcher like any()</a>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>var id = &quot;id&quot;;\nvar mockedValue = &quot;test value&quot;;\nvar someConfig = new SomeConfig(mockedValue);\nvar someService = new SomeService();\ntry (MockedStatic&lt;UtilClass&gt; dummy = Mockito.mockStatic(UtilClass.class)) {\n    dummy.when(() -&gt; UtilClass.getConfigForId(id))\n         .thenReturn(someConfig);\n\n    var result = someService.doSth(id);\n\n    assertEquals(mockedValue, result);\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>var mockedValue = &quot;test value 2&quot;;\nvar someConfig = new SomeConfig(mockedValue);\nvar someService = new SomeService();\ntry (MockedStatic&lt;UtilClass&gt; dummy = Mockito.mockStatic(UtilClass.class)) {\n    dummy.when(() -&gt; UtilClass.getConfigForId(any()))\n         .thenReturn(someConfig);\n\n    var result = someService.doSth(&quot;some id&quot;);\n\n    assertEquals(mockedValue, result);\n}\n</code></pre>\n<p>If the signature of the method you're using in the tested code does not include a parameter, it should be mocked without a parameter as well (in case of for example an overloaded method).</p>\n<hr />\n<p>I've tested the code above and all tests pass - you can verify it <a href=\"https://github.com/Jonarzz/stack-overflow/commit/a0707d99ffe265fd79dbbc58b2b8858cc8568eb4\" rel=\"nofollow noreferrer\">in a GitHub repository</a>.</p>\n"}],"owner":{"user_id":18087971,"display_name":"waynewingorc"},"view_count":532,"up_vote_count":2,"accepted_answer_id":75078521,"answer_count":1,"score":2,"creation_date":1673410994,"question_id":75078316,"body":"<p>I have a method that calls a Util class' static method.<br />\nIs there a way to mock the return value of this static method so that it always returns a static value?</p>\n<p>I want to do this because this static method returns me some configurations that could change, but I don't want this to affect my test. If I could mock this Util class and return a static results for the method all the time, it would give me a stable test.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class SomeService{\n  public void doSth(){\n    SomeConfig config = UtilClass.getConfigForId(“id”);\n    ...\n  }\n}\n</code></pre>\n<p>I tried the <code>mockStatic</code> method mentioned <a href=\"https://stackoverflow.com/questions/21105403/mocking-static-methods-with-mockito\">here</a> but it didn't work:</p>\n<pre class=\"lang-java prettyprint-override\"><code>// get SomeService instance from Guice container\nInjector injector = Guice.createInjector(new BasicModule());\nSomeService someService = injector.getInstance(SomeService.class);\n\ntry (MockedStatic&lt;UtilClass&gt; dummy = Mockito.mockStatic(UtilClass.class)) {\n  \n  dummy.when(() -&gt; UtilClass.getConfigForId(any()))\n        .thenReturn(someConfig);\n  \n  // Didn't give me someConfig above, but the actual value\n  someService.doSth();\n}\n</code></pre>\n<hr />\n<p>UPDATE:</p>\n<p>Apologies for all the typos made. I've now corrected them so that the code is syntax-error free.<br />\nI think I found what might have broke the MockedStatic: that <code>UtilClass.getConfigForId</code> is called in another thread. Here's the overall structure:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class SomeService{\n  public void doSth(List&lt;Msg&gt; messages){\n    List&lt;Callable&lt;Void&gt;&gt; tasks = new ArrayList&lt;&gt;();\n    \n    for (Msg msg : messages){\n      tasks.add(()-&gt;{\n            String id = msg.getId();\n            SomeConfig config = UtilClass.getConfigForId(id);\n            ...\n      })\n    }\n    \n\n    // use Executors.newWorkStealingPool() to execute the tasks\n    ...\n  }\n}\n</code></pre>\n<p>As long as <code>UtilClass.getConfigForId(id)</code> is not executed in the same thread as the <code>try with resource</code> code, the magic doesn't work. I've tried another function that does the same but in one thread and <code>MockedStatic</code> works there fine.<br />\nSo the question becomes: how to make <code>MockedStatic</code> work in a different thread?<br />\nAnother UPDATE:<br />\nI think from the <a href=\"https://javadoc.io/static/org.mockito/mockito-core/3.4.3/org/mockito/MockedStatic.html\" rel=\"nofollow noreferrer\">javaDoc</a> it's not possbile. So I'll have to come up with other ways, e.g. refactoring</p>\n"},{"tags":["java","reflection","avro"],"comments":[{"owner":{"user_id":9418902,"display_name":"Csisanyi"},"edited":false,"comment_id":132487376,"body":"Have you tried getRecordSchema(Object o) instead of getSchema(Type t)? This alphabetical ordering seems very strange though."},{"owner":{"user_id":845414,"display_name":"Johannes Kuhn"},"edited":false,"comment_id":132487736,"body":"Fields do not have an ordering. <code>Class.getFields()</code> may return fields in any arbitrary order."},{"owner":{"user_id":57719,"display_name":"Chin Huang"},"edited":false,"comment_id":132487866,"body":"Avro version 1.10.0 changed ReflectData to <a href=\"https://issues.apache.org/jira/browse/AVRO-2579\" rel=\"nofollow noreferrer\">sort fields into alphabetical order</a>. Some people <a href=\"https://issues.apache.org/jira/browse/AVRO-3138\" rel=\"nofollow noreferrer\">complained that was a breaking change</a>."},{"owner":{"user_id":6341982,"display_name":"Luiz Henrique"},"edited":false,"comment_id":132489967,"body":"@ChinHuang does it still have this behavior on 1.11.0? If so, how can I properly convert N array of bytes to this schema in an order that was not expected?"},{"owner":{"user_id":6341982,"display_name":"Luiz Henrique"},"edited":false,"comment_id":132489987,"body":"@Csisanyi It is not the case. I have an array of bytes and need to convert to an Object. I do not have the Object o, just the schema of the Object.class"},{"owner":{"user_id":6341982,"display_name":"Luiz Henrique"},"edited":false,"comment_id":133188817,"body":"@ChinHuang, the version was the issue. Would you mind writting the answer so I can accept it?"}],"answers":[{"owner":{"user_id":57719,"display_name":"Chin Huang"},"up_vote_count":1,"is_accepted":true,"creation_date":1676662778,"answer_id":75488598,"body":"<p>Avro version 1.10.0 changed ReflectData to <a href=\"https://issues.apache.org/jira/browse/AVRO-2579\" rel=\"nofollow noreferrer\">sort fields into alphabetical order</a> because the Class.getDeclaredFields() method API specification does not mandate a specific order of the fields that get returned. Some Java implementations return the fields in the order they appear in the Java source file. Some people <a href=\"https://issues.apache.org/jira/browse/AVRO-3138\" rel=\"nofollow noreferrer\">complained that was a breaking change</a>.</p>\n<p>If you don't want the fields sorted into alphabetical order, then you must stay at Avro version 1.9.2 or lower.</p>\n"}],"owner":{"user_id":6341982,"display_name":"Luiz Henrique"},"view_count":207,"up_vote_count":2,"accepted_answer_id":75488598,"answer_count":1,"score":2,"creation_date":1673388105,"question_id":75076310,"body":"<p>I have a class the I need to converto to an avro schema:</p>\n<pre><code>public class MonitorStateSchema {\n    private MetaResponse c;\n    private Header a;\n    private MonitorStateEnvelope b;\n\n    public MonitorStateSchema(MetaResponse c, Header a, MonitorStateEnvelope b) {\n        this.c = c;\n        this.a = a;\n        this.b = b;\n    }\n}\n</code></pre>\n<p>I use a generic method to get the schema from it</p>\n<pre><code>public static &lt;D&gt; void getFromAvro(Class&lt;D&gt; schemaType) {\n    Schema schema = ReflectData.get().getSchema(schemaType);\n\n   // other stuff\n}\n</code></pre>\n<p>After doing it, I got a different order in the result than the expected:</p>\n<p>EXPECTED:</p>\n<pre><code>{\n  &quot;type&quot;: &quot;record&quot;,\n  &quot;name&quot;: &quot;MonitorSchema&quot;,\n  &quot;namespace&quot;: &quot;mypackage.monitor&quot;,\n  &quot;fields&quot;: [\n    {\n      &quot;name&quot;: &quot;c&quot;,\n      &quot;type&quot;: {\n        &quot;type&quot;: &quot;record&quot;,\n        &quot;name&quot;: &quot;MetaResponse&quot;,\n        &quot;namespace&quot;: &quot;mypackage.monitor&quot;,\n        &quot;fields&quot;: [\n          {\n            &quot;name&quot;: &quot;uuid&quot;,\n            &quot;type&quot;: &quot;string&quot;\n          },\n          {\n            &quot;name&quot;: &quot;code&quot;,\n            &quot;type&quot;: &quot;int&quot;\n          },\n          {\n            &quot;name&quot;: &quot;message&quot;,\n            &quot;type&quot;: &quot;string&quot;\n          }\n        ]\n      }\n    },\n    {\n      &quot;name&quot;: &quot;a&quot;,\n      &quot;type&quot;: {\n        &quot;type&quot;: &quot;record&quot;,\n        &quot;name&quot;: &quot;Header&quot;,\n        &quot;namespace&quot;: &quot;mypackage.monitor&quot;,\n        &quot;fields&quot;: [\n          {\n            &quot;name&quot;: &quot;apiKey&quot;,\n            &quot;type&quot;: &quot;string&quot;\n          },\n          {\n            &quot;name&quot;: &quot;signature&quot;,\n            &quot;type&quot;: &quot;string&quot;\n          },\n          {\n            &quot;name&quot;: &quot;nonce&quot;,\n            &quot;type&quot;: &quot;int&quot;\n          }\n        ]\n      }\n    },\n    {\n      &quot;name&quot;: &quot;b&quot;,\n      &quot;type&quot;: {\n        &quot;type&quot;: &quot;record&quot;,\n        &quot;name&quot;: &quot;MonitorEnvelope&quot;,\n        &quot;fields&quot;: [\n          {\n            &quot;name&quot;: &quot;fields&quot;,\n            &quot;type&quot;: {\n              &quot;type&quot;: &quot;array&quot;,\n              &quot;items&quot;: {\n                &quot;type&quot;: &quot;record&quot;,\n                &quot;name&quot;: &quot;Field&quot;,\n                &quot;fields&quot;: [\n                  {\n                    &quot;name&quot;: &quot;name&quot;,\n                    &quot;type&quot;: &quot;string&quot;\n                  },\n                  {\n                    &quot;name&quot;: &quot;value&quot;,\n                    &quot;type&quot;: &quot;string&quot;\n                  }\n                ]\n              },\n              &quot;java-class&quot;: &quot;[Lmypackage.monitor.Field;&quot;\n            }\n          }\n        ]\n      }\n    }\n  ]\n}\n</code></pre>\n<p>ACTUAL RESULT:</p>\n<pre><code>{\n  &quot;type&quot;: &quot;record&quot;,\n  &quot;name&quot;: &quot;MonitorStateSchema&quot;,\n  &quot;namespace&quot;: &quot;mypackage.monitor&quot;,\n  &quot;fields&quot;: [\n    {\n      &quot;name&quot;: &quot;a&quot;,\n      &quot;type&quot;: {\n        &quot;type&quot;: &quot;record&quot;,\n        &quot;name&quot;: &quot;Header&quot;,\n        &quot;namespace&quot;: &quot;mypackage.monitor&quot;,\n        &quot;fields&quot;: [\n          {\n            &quot;name&quot;: &quot;apiKey&quot;,\n            &quot;type&quot;: &quot;string&quot;\n          },\n          {\n            &quot;name&quot;: &quot;nonce&quot;,\n            &quot;type&quot;: &quot;int&quot;\n          },\n          {\n            &quot;name&quot;: &quot;signature&quot;,\n            &quot;type&quot;: &quot;string&quot;\n          }\n        ]\n      }\n    },\n    {\n      &quot;name&quot;: &quot;b&quot;,\n      &quot;type&quot;: {\n        &quot;type&quot;: &quot;record&quot;,\n        &quot;name&quot;: &quot;MonitorStateEnvelope&quot;,\n        &quot;fields&quot;: [\n          {\n            &quot;name&quot;: &quot;fields&quot;,\n            &quot;type&quot;: {\n              &quot;type&quot;: &quot;array&quot;,\n              &quot;items&quot;: {\n                &quot;type&quot;: &quot;record&quot;,\n                &quot;name&quot;: &quot;Field&quot;,\n                &quot;namespace&quot;: &quot;mypackage.monitor&quot;,\n                &quot;fields&quot;: [\n                  {\n                    &quot;name&quot;: &quot;name&quot;,\n                    &quot;type&quot;: &quot;string&quot;\n                  },\n                  {\n                    &quot;name&quot;: &quot;value&quot;,\n                    &quot;type&quot;: &quot;string&quot;\n                  }\n                ]\n              },\n              &quot;java-class&quot;: &quot;[Lmypackage.monitor.Field;&quot;\n            }\n          }\n        ]\n      }\n    },\n    {\n      &quot;name&quot;: &quot;c&quot;,\n      &quot;type&quot;: {\n        &quot;type&quot;: &quot;record&quot;,\n        &quot;name&quot;: &quot;MetaResponse&quot;,\n        &quot;namespace&quot;: &quot;mypackage.monitor&quot;,\n        &quot;fields&quot;: [\n          {\n            &quot;name&quot;: &quot;code&quot;,\n            &quot;type&quot;: &quot;int&quot;\n          },\n          {\n            &quot;name&quot;: &quot;message&quot;,\n            &quot;type&quot;: &quot;string&quot;\n          },\n          {\n            &quot;name&quot;: &quot;uuid&quot;,\n            &quot;type&quot;: &quot;string&quot;\n          }\n        ]\n      }\n    }\n  ]\n}\n</code></pre>\n<p>Seems that it is ordering by alphabetical order on the name of the field and it is breaking the application when deserializing the byte array. Is there any reason for this to happen?</p>\n"},{"tags":["java","jooq"],"comments":[{"owner":{"user_id":521799,"display_name":"Lukas Eder"},"edited":false,"comment_id":132480677,"body":"What do you mean by &quot;automatically&quot;? The documented ad-hoc conversion utilities aren&#39;t what you&#39;re looking for? Why?"},{"owner":{"user_id":20975649,"display_name":"JavaStan"},"edited":false,"comment_id":132480737,"body":"@LukasEder I guess I&#39;m looking for something like <code>org.jooq.Records</code>, but for nested records like <code>FilmActors</code>. Not sure if there is an easier way to obtain that other than writing my own <code>RecordMapper</code>. It looks like ModelMapper is still waiting on Java records support"}],"answers":[{"owner":{"user_id":20975649,"display_name":"JavaStan"},"up_vote_count":1,"is_accepted":false,"creation_date":1673372517,"answer_id":75073875,"body":"<p>I think found an answer <a href=\"https://www.jooq.org/doc/latest/manual/sql-execution/fetching/ad-hoc-converter/\" rel=\"nofollow noreferrer\">here</a> under <em>Using ad hoc converters on nested collections</em>. <code>convertFrom</code> did the trick:</p>\n<pre><code>Field&lt;List&lt;FilmActors.Actor&gt;&gt; actors = DSL.multiset(\n                                              DSL.select(Tables.FILM_ACTOR.actor().FIRST_NAME, Tables.FILM_ACTOR.actor().LAST_NAME)\n                                                 .from(Tables.FILM_ACTOR)\n                                                 .where(Tables.FILM_ACTOR.FILM_ID.eq(Tables.FILM.FILM_ID))\n                                          )\n                                          .as(&quot;actors&quot;)\n                                          .convertFrom(record -&gt; record.map(Records.mapping(FilmActors.Actor::new)));\n\nList&lt;FilmActors&gt; filmActors = this.context.select(Tables.FILM.FILM_ID, Tables.FILM.TITLE, actors)\n                                          .from(Tables.FILM)\n                                          .limit(10)\n                                          .fetch(Records.mapping(FilmActors::new));\n</code></pre>\n"}],"owner":{"user_id":20975649,"display_name":"JavaStan"},"view_count":89,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1673367593,"question_id":75072897,"body":"<p>For this example, I am using the <a href=\"https://dev.mysql.com/doc/sakila/en/\" rel=\"nofollow noreferrer\">Sakila Sample Database</a>.</p>\n<p>Let's say I have a <code>Film</code> record as follows:</p>\n<pre><code>public record Film(UShort filmId, String title) {\n}\n</code></pre>\n<p>If I am reading films from jOOQ, I can easily map them to <code>Film</code> using the following:</p>\n<pre><code>List&lt;Film&gt; films = this.context.select(Tables.FILM.FILM_ID, Tables.FILM.TITLE)\n                               .from(Tables.FILM)\n                               .limit(10)\n                               .fetch(Records.mapping(Film::new));\n</code></pre>\n<p>Now let's say I want each film and the actors associated with it. For this, I decide to use <code>multiset</code>:</p>\n<pre><code>Set&lt;SelectField&lt;?&gt;&gt; readFields = Set.of(\n    Tables.FILM.FILM_ID,\n    Tables.FILM.TITLE,\n    DSL.multiset(\n        DSL.select(Tables.FILM_ACTOR.actor().FIRST_NAME, Tables.FILM_ACTOR.actor().LAST_NAME)\n           .from(Tables.FILM_ACTOR)\n           .where(Tables.FILM_ACTOR.FILM_ID.eq(Tables.FILM.FILM_ID))\n        )\n       .as(&quot;actors&quot;)\n);\n\nvar result = this.context.select(readFields)\n                         .from(Tables.FILM)\n                         .limit(10)\n                         .fetch();\n</code></pre>\n<p>Now that I have my results, I want to map them into a record <code>FilmActors</code>:</p>\n<pre><code>public record FilmActors(UShort filmId, String title, List&lt;Actor&gt; actors) {\n    public record Actor(String firstName, String lastName) {\n    }\n}\n</code></pre>\n<p>Is there anyway to do this automatically, or with the help of a library like ModelMapper? I'm wanting to avoid rolling a custom <code>RecordMapper</code> if possible. Thanks!</p>\n<p>I tried using jOOQ's built-in <code>Records</code> class, and tried to see if ModelMapper supports records.</p>\n"},{"tags":["java","apache-kafka","spring-kafka"],"comments":[{"owner":{"user_id":1240763,"display_name":"Gary Russell"},"edited":false,"comment_id":132457296,"body":"Configuration looks correct; if you are using Boot, it should automatically configure a <code>KafkaAdmin</code> bean; use a debugger in <code>KafkaAdmin.afterSingletonsInstantiated()</code> to see what&#39;s going wrong."},{"owner":{"user_id":13629257,"display_name":"prateek jangid"},"edited":false,"comment_id":132459054,"body":"@GaryRussell Thanks for helping out.Issue of replica factor number mismatch."},{"owner":{"user_id":9881640,"display_name":"Vipul Gupta"},"edited":false,"comment_id":132459281,"body":"@prateekjangid Replication factor value is more than the number of Brokers which is the potential issue seems like."}],"answers":[{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"up_vote_count":1,"is_accepted":true,"creation_date":1673312258,"answer_id":75064410,"body":"<p>As shown by the CLI describe output, you only have one broker. Therefore, you are limited to one replica, rather than 2.</p>\n"}],"owner":{"user_id":13629257,"display_name":"prateek jangid"},"view_count":123,"up_vote_count":2,"accepted_answer_id":75064410,"answer_count":1,"score":2,"creation_date":1673274435,"question_id":75058694,"body":"<p>I am creating topic dynamically in spring boot on my local machine.But when described the the topic there was only one partition.\nBelow is the code.</p>\n<pre><code>    @Bean\n        public NewTopic newTopic() {\n    \n            return new NewTopic(&quot;kafkaTopic&quot;,20,(short)2);\n //return TopicBuilder.name(&quot;kafkaTopic&quot;).partitions(15).replicas(2).build();// tried with as well.\n        }\n</code></pre>\n<p>o/p:-</p>\n<pre><code>Topic: kafkaTopic   TopicId: ZiypKK48Q0GqcNwsx6323Q PartitionCount: 1   ReplicationFactor: Configs: \n    Topic: kafkaTopic   Partition: 0    Leader: 0   Replicas: 0 Isr: 0\n</code></pre>\n<p>Looked through net but not able to resolve issue.</p>\n<p>Config code</p>\n<pre><code>@Bean\n    public ProducerFactory&lt;String, String&gt; producerFactoryString() {\n        Map&lt;String, Object&gt; configProps = new HashMap&lt;&gt;();\n\n        configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, server);\n        configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n\n        return new DefaultKafkaProducerFactory&lt;&gt;(configProps);\n    }\n\n@Bean\n    public ConsumerFactory&lt;String, String&gt; consumerFactory() {\n        Map&lt;String, Object&gt; configProps = new HashMap&lt;&gt;();\n        configProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, server);\n        configProps.put(ConsumerConfig.GROUP_ID_CONFIG, consumerGroupId);\n        configProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        configProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        configProps.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, &quot;200&quot;);\n        configProps.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;latest&quot;);\n        configProps.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, &quot;550000&quot;);\n        configProps.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);\n        configProps.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, &quot;55000&quot;);\n        configProps.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, &quot;25000&quot;);\n\n        return new DefaultKafkaConsumerFactory&lt;&gt;(configProps);\n    }\n</code></pre>\n<p>Did i miss any configuration or anything to add?</p>\n"},{"tags":["java","android","firebase","android-studio","android-recyclerview"],"comments":[{"owner":{"user_id":5246885,"display_name":"Alex Mamo"},"edited":false,"comment_id":132447652,"body":"What exactly in this code doesn&#39;t work the way you expect? Tell us what is wrong with shared code. Do you have any errors?"},{"owner":{"user_id":14972476,"display_name":"Azariah Natasha"},"edited":false,"comment_id":132450866,"body":"My application can be launched successfully without any errors but the contact list is not displayed. It will only show blank page"},{"owner":{"user_id":5246885,"display_name":"Alex Mamo"},"edited":false,"comment_id":132451008,"body":"Please edit your question and add your database structure as a JSON file. You can simply get it by clicking the Export JSON in the overflow menu (⠇) in your <a href=\"https://console.firebase.google.com/u/0/project/_/database/data\" rel=\"nofollow noreferrer\">Firebase Console</a>."}],"answers":[{"owner":{"user_id":12819796,"display_name":"Aditya Nandardhane"},"up_vote_count":1,"is_accepted":false,"creation_date":1673246283,"answer_id":75053878,"body":"<p><strong>You are not updating list in Adaptor</strong></p>\n<p><em>Please add this method in your adaptor class -</em></p>\n<pre><code>public void updateList(ArrayList&lt;Contact&gt; list){\n   this.list=list;\n   notifyDataSetChanged();\n}\n</code></pre>\n<p>And replace this line from your contactList activity to <strong>adapter.notifyDataSetChanged();</strong> --&gt; <strong>adapter.updateList(list);</strong></p>\n<p><strong>contactList.java</strong></p>\n<pre><code>   package com.example.lucentproj;\n\n    import androidx.annotation.NonNull; \n    import androidx.appcompat.app.AppCompatActivity; \n    import androidx.recyclerview.widget.LinearLayoutManager; \n    import androidx.recyclerview.widget.RecyclerView;\n    import android.os.Bundle;\n    import com.google.firebase.auth.FirebaseAuth; \n    import com.google.firebase.auth.FirebaseUser; \n    import com.google.firebase.database.DataSnapshot; \n    import com.google.firebase.database.DatabaseError; \n    import com.google.firebase.database.DatabaseReference; \n    import com.google.firebase.database.FirebaseDatabase; \n    import com.google.firebase.database.ValueEventListener;`\n    import java.util.ArrayList;\n\n    public class contactList extends AppCompatActivity {\n    RecyclerView recyclerView;\n    DatabaseReference reference;\n    contAdapter adapter;\n    ArrayList&lt;Contact&gt; list;\n    FirebaseUser user;\n\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_contact_list);\n\n    user = FirebaseAuth.getInstance().getCurrentUser();\n    recyclerView = findViewById(R.id.contList);\n    reference = FirebaseDatabase.getInstance().getReference(&quot;Contact&quot;);\n    recyclerView.setHasFixedSize(true);\n    recyclerView.setLayoutManager(new LinearLayoutManager(this));\n\n    list = new ArrayList&lt;&gt;();\n\n    myRef.addChildEventListener(new ChildEventListener() {\n    @Override\n    public void onChildAdded(DataSnapshot dataSnapshot, String s) {\n         Contact contact = dataSnapshot.getValue(Contact.class);\n         list.add(contact);\n      }\n    }\n\n    adapter = new contAdapter(this, list);\n    recyclerView.setAdapter(adapter);\n\n    reference.addValueEventListener(new ValueEventListener() {\n    @Override\n    public void onDataChange(@NonNull DataSnapshot snapshot) {\n\n    for (DataSnapshot dataSnapshot : snapshot.getChildren()){\n\n    Contact contact = dataSnapshot.getValue(Contact.class);\n    list.add(contact);\n\n    }\n    adapter.updateList(list);\n  }\n\n   @Override\n   public void onCancelled(@NonNull DatabaseError error) {\n\n   }\n  });\n }\n}\n</code></pre>\n"}],"owner":{"user_id":14972476,"display_name":"Azariah Natasha"},"view_count":53,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1673245976,"question_id":75053844,"body":"<p>I am trying to display my contact list for my mobile application. I have already connected the database and I figured that there is no problem with the database since I can add new contact but I am unable to display the list. I use RecyclerView which I already created Adapter class, item layout and model for.</p>\n<ul>\n<li>Adapter class - contAdapter.java</li>\n<li>item layout - item.xml</li>\n<li>Model - Contact</li>\n<li>RecyclerView Layout - contactList.xml</li>\n<li>contactList - to bind recyclerview with adapter</li>\n</ul>\n<p>I wish to see the list of contact added to the database to be displayed on the screen but I have been stuck here for quite some time since I cannot figure out what the problem is :(</p>\n<p>Here is my Contact Model:</p>\n<pre><code>public Contact() {\n\n}\n\npublic Contact(String contName, String contNumber) {\nthis.contName = contName;\nthis.contNumber = contNumber;\n}\n\npublic String getContName() {\nreturn contName;\n}\n\npublic void setContName(String contName) {\nthis.contName = contName;\n}\n\npublic String getContNumber() {\nreturn contNumber;\n}\n\npublic void setContNumber(String contNumber) {\nthis.contNumber = contNumber;\n}\n</code></pre>\n<p><code>contactList.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n\n        &lt;androidx.constraintlayout.widget.ConstraintLayout\n        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n        xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;match_parent&quot; xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n        android:layout_margin=&quot;25dp&quot; tools:context=&quot;.MainActivity&quot;&gt;\n    \n        &lt;androidx.recyclerview.widget.RecyclerView\n        android:id=&quot;@+id/contList&quot;\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;match_parent&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;/&gt;\n        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre>\n<p><code>contactList.java</code>:</p>\n<pre><code>    package com.example.lucentproj;\n\n    import androidx.annotation.NonNull; \n    import androidx.appcompat.app.AppCompatActivity; \n    import androidx.recyclerview.widget.LinearLayoutManager; \n    import androidx.recyclerview.widget.RecyclerView;\n    import android.os.Bundle;\n    import com.google.firebase.auth.FirebaseAuth; \n    import com.google.firebase.auth.FirebaseUser; \n    import com.google.firebase.database.DataSnapshot; \n    import com.google.firebase.database.DatabaseError; \n    import com.google.firebase.database.DatabaseReference; \n    import com.google.firebase.database.FirebaseDatabase; \n    import com.google.firebase.database.ValueEventListener;`\n    import java.util.ArrayList;\n\n    public class contactList extends AppCompatActivity {\n    RecyclerView recyclerView;\n    DatabaseReference reference;\n    contAdapter adapter;\n    ArrayList&lt;Contact&gt; list;\n    FirebaseUser user;\n\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_contact_list);\n\n    user = FirebaseAuth.getInstance().getCurrentUser();\n    recyclerView = findViewById(R.id.contList);\n    reference = FirebaseDatabase.getInstance().getReference(&quot;Contact&quot;);\n    recyclerView.setHasFixedSize(true);\n    recyclerView.setLayoutManager(new LinearLayoutManager(this));\n\n    list = new ArrayList&lt;&gt;();\n    adapter = new contAdapter(this, list);\n    recyclerView.setAdapter(adapter);\n\n    reference.addValueEventListener(new ValueEventListener() {\n    @Override\n    public void onDataChange(@NonNull DataSnapshot snapshot) {\n\n    for (DataSnapshot dataSnapshot : snapshot.getChildren()){\n\n    Contact contact = dataSnapshot.getValue(Contact.class);\n    list.add(contact);\n\n    }\n    adapter.updateList(list);\n  }\n\n   @Override\n   public void onCancelled(@NonNull DatabaseError error) {\n\n   }\n});\n}\n}\n</code></pre>\n<p><code>item.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n\n        &lt;androidx.cardview.widget.CardView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n        android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot;\n        xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot; android:layout_margin=&quot;16dp&quot;\n        app:cardElevation=&quot;8dp&quot; app:cardCornerRadius=&quot;8dp&quot;&gt;\n    \n    \n        &lt;LinearLayout\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:layout_marginLeft=&quot;16dp&quot;\n        android:orientation=&quot;vertical&quot;/&gt;\n    \n        &lt;LinearLayout\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:layout_gravity=&quot;center_vertical&quot;\n        android:orientation=&quot;horizontal&quot; /&gt;\n    \n        &lt;TextView\n        android:id=&quot;@+id/contname&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:fontFamily=&quot;@font/amaranth&quot;\n        android:text=&quot;Name&quot;\n        android:layout_marginLeft=&quot;10dp&quot;\n        android:layout_marginTop=&quot;8dp&quot;\n        android:textSize=&quot;20sp&quot;\n        android:textStyle=&quot;bold&quot; /&gt;\n    \n        &lt;TextView\n        android:id=&quot;@+id/contno&quot;\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:layout_marginTop=&quot;30dp&quot;\n        android:fontFamily=&quot;@font/amaranth_italic&quot;\n        android:paddingLeft=&quot;10dp&quot;\n        android:text=&quot;Number&quot;\n        android:textSize=&quot;20dp&quot;\n        android:textStyle=&quot;italic&quot; /&gt;\n    \n        &lt;ImageView\n        android:id=&quot;@+id/cCall&quot;\n        android:layout_width=&quot;38dp&quot;\n        android:layout_height=&quot;30dp&quot;\n        android:layout_marginLeft=&quot;280dp&quot;\n        android:layout_marginTop=&quot;15dp&quot;\n        android:clickable=&quot;true&quot;\n        android:src=&quot;@drawable/call&quot; /&gt;\n    \n        &lt;ImageView\n        android:id=&quot;@+id/cEdit&quot;\n        android:layout_width=&quot;45dp&quot;\n        android:layout_height=&quot;30dp&quot;\n        android:layout_marginLeft=&quot;320dp&quot;\n        android:layout_marginTop=&quot;15dp&quot;\n        android:clickable=&quot;true&quot;\n        android:src=&quot;@drawable/edit&quot; /&gt;\n    \n    &lt;/androidx.cardview.widget.CardView&gt;\n</code></pre>\n<p><code>contAdapter</code>:</p>\n<pre><code>package com.example.lucentproj;\n\nimport android.content.Context; \nimport android.view.LayoutInflater; \nimport android.view.View; \nimport android.view.ViewGroup; import android.widget.TextView; \nimport androidx.annotation.NonNull; \nimport androidx.recyclerview.widget.RecyclerView; \nimport java.util.ArrayList;\n\npublic class contAdapter extends RecyclerView.Adapter&lt;contAdapter.ViewHolder&gt; {Context context;\n\n    ArrayList&lt;Contact&gt; list;\n\npublic contAdapter(Context context, ArrayList&lt;Contact&gt; list) {\n    this.context = context;\n    this.list = list;\n}\n\n@NonNull\n@Override\n    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n    View v = LayoutInflater.from(context).inflate(R.layout.item,parent,false);\n    return new ViewHolder(v);\n}\n\n@Override\n    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {\n\n    Contact cont = list.get(position);\n    holder.cname.setText(cont.getContName());\n    holder.cnum.setText(cont.getContNumber());\n\n}\n\n@Override\n    public int getItemCount() {\n    return list.size();\n}\n\npublic static class ViewHolder extends RecyclerView.ViewHolder {\n\n    TextView cname, cnum;\n\n    public ViewHolder(@NonNull View itemView) {\n        super(itemView);\n\n        cname = itemView.findViewById(R.id.contName);\n        cnum =  itemView.findViewById(R.id.contNumber);\n    }\n}\n    public void updateList(ArrayList&lt;Contact&gt; list){\n    this.list=list;\n    notifyDataSetChanged();\n}\n}\n</code></pre>\n"},{"tags":["java","log4j2"],"answers":[{"owner":{"user_id":11748454,"display_name":"Piotr P. Karwasz"},"up_vote_count":1,"is_accepted":true,"creation_date":1673201195,"answer_id":75050199,"body":"<p>You didn't set a <code>TRACE</code> threshold on the logger, but on the appender reference. Hence your &quot;com.fdmgroup.logging.Demo&quot; logger has a:</p>\n<ul>\n<li><code>WARN</code> threshold for the logger (inherited from the root logger),</li>\n<li>a <code>TRACE</code> threshold for the &quot;StdOut&quot; appender,</li>\n<li>no threshold for the &quot;FileAppender&quot; inherited from the root logger (the default value for <code>additivity</code> is `true).</li>\n</ul>\n<p>A message is logged only if it not rejected by filter on the logger and the appender, hence only <code>WARN</code> messages are logged.</p>\n<p>You probably wanted to set the level for loggers, not appender refs:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>    &lt;Loggers&gt;   \n        &lt;Root level=&quot;WARN&quot;&gt;\n            &lt;AppenderRef ref=&quot;FileAppender&quot; /&gt;\n        &lt;/Root&gt;\n        &lt;Logger name=&quot;com.fdmgroup.logging.Demo&quot; additivity=&quot;false&quot; level=&quot;TRACE&quot;&gt;\n            &lt;AppenderRef ref=&quot;StdOut&quot;/&gt;\n        &lt;/Logger&gt;     \n        &lt;Logger name=&quot;com.fdmgroup.exercise.Runner&quot; level=&quot;TRACE&quot;&gt;\n            &lt;AppenderRef ref=&quot;StdOut&quot;/&gt;\n        &lt;/Logger&gt;\n    &lt;/Loggers&gt;\n</code></pre>\n"}],"owner":{"user_id":20959443,"display_name":"le jaeson"},"view_count":52,"up_vote_count":2,"accepted_answer_id":75050199,"answer_count":1,"score":2,"creation_date":1673200144,"question_id":75050078,"body":"<p>Can someone give me pointers on below. I tought the child class level (trace) should override the root class level (warn), but I only see the warn and above logs.</p>\n<p><a href=\"https://i.stack.imgur.com/ghrAK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ghrAK.png\" alt=\"enter image description here\" /></a>\nI tought the child class level (trace) should override the root class level (warn). but I only see the warn and above logs.</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n\n&lt;Configuration status=&quot;warn&quot;  monitorInterval=&quot;30&quot;&gt;\n    &lt;Appenders&gt;\n        &lt;Console name=&quot;StdOut&quot; target=&quot;SYSTEM_OUT&quot;&gt;\n            &lt;PatternLayout pattern=&quot;[%-5level] %msg%n&quot; /&gt;\n        &lt;/Console&gt;\n        \n        &lt;File name=&quot;FileAppender&quot; filename=&quot;LogOutput.log&quot;&gt;\n            &lt;PatternLayout\n                pattern=&quot;%d{dd MMM yyyy HH:mm:ss} [%t] %-5level %logger{36} - %msg%n&quot; /&gt;\n        &lt;/File&gt;\n    &lt;/Appenders&gt;\n    &lt;Loggers&gt;   \n        &lt;Root level=&quot;warn&quot;&gt;\n            &lt;AppenderRef ref=&quot;FileAppender&quot; /&gt;\n        &lt;/Root&gt;\n\n        &lt;!--  Uncomment the Logger definition below to have ONLY warn-level messages \n        and above be directed to the console --&gt;\n        \n        &lt;Logger name=&quot;com.fdmgroup.logging.Demo&quot; &gt;\n            &lt;AppenderRef ref=&quot;StdOut&quot; level=&quot;trace&quot;/&gt;\n        &lt;/Logger&gt; \n        \n        &lt;Logger name=&quot;com.fdmgroup.exercise.Runner&quot; &gt;\n            &lt;AppenderRef ref=&quot;StdOut&quot; level=&quot;trace&quot;/&gt;\n            &lt;AppenderRef ref=&quot;FileAppender&quot; level=&quot;trace&quot;/&gt;\n        &lt;/Logger&gt; \n    \n        \n\n    &lt;/Loggers&gt;  \n&lt;/Configuration&gt;\n</code></pre>\n"},{"tags":["java","spring","spring-boot","jpa"],"comments":[{"owner":{"user_id":496099,"display_name":"Chris"},"edited":false,"comment_id":132439353,"body":"It is still not clear what your application needs to receive when you fetch Players. If you want the club data every time included with the player, it has to be fetched ever time. You can either make the relationship eager OR create a special accessor in the repository that triggers the relationship (fetch joins within the query, a entity fetch/load graph, or access an attribute within the clubs to ensure it is fetched). There is no need for a separate DTO if you don&#39;t want the relationship - just mark it with JSON ignorable and it won&#39;t be included, so can be left lazily/unfetched."},{"owner":{"user_id":15761589,"display_name":"funnyguy"},"edited":false,"comment_id":132439565,"body":"I want to have when fetching a player/list of players (when fetching it from the controller!), but I thought that making it <code>EAGER</code> is not the best idea, since I might use not always need to use players, if I make some other operations with the players not related to the API endpoint I provided."},{"owner":{"user_id":15761589,"display_name":"funnyguy"},"edited":false,"comment_id":132439621,"body":"So I just thought about it in a way, that I only need the information of clubs eagerly when making API calls: getting all players and getting a single player. But on the other hand I thought that I might do some operations with the players (e.g. setting all of them some property at once), where I wouldn&#39;t need the information of their Clubs then. Or am I misunderstanding something?"}],"answers":[{"owner":{"user_id":15761589,"display_name":"funnyguy"},"up_vote_count":0,"is_accepted":false,"creation_date":1673192684,"answer_id":75049130,"body":"<p>I have a solution guys, but I'd like to hear from you if it can be done this way, or it is some kind of anti-pattern.\nI just simply set the <code>playerToDto</code>'s Club to the brandly new fetched <code>Club</code> with the ID of the <code>foundPlayer</code></p>\n<pre><code>@GetMapping(&quot;/api/players/{id}&quot;)\n    ResponseEntity&lt;PlayerDto&gt; getPlayer(@PathVariable String id) {\n        Player foundPlayer = playerInterface.getPlayer(Long.valueOf(id));\n        PlayerDto playerToDto = convertToDto(foundPlayer);\n        playerToDto.setClub(clubInterface.getClub(foundPlayer.getClub().getId()));\n\n        return ResponseEntity.ok().body(playerToDto);\n    }\n</code></pre>\n<p>In the end I came up with this:</p>\n<pre><code>@GetMapping(&quot;/api/players&quot;)\n    ResponseEntity&lt;List&lt;PlayerDto&gt;&gt; getAllPlayers() {\n        List&lt;PlayerDto&gt; playersList = playerInterface.getAllPlayers().stream().map(this::convertToDto).collect(Collectors.toList());\n        playersList.forEach(playerInterface::fetchClubToPlayer);\n        return ResponseEntity.ok().body(playersList);\n    }\n\n    @GetMapping(&quot;/api/players/{id}&quot;)\n    ResponseEntity&lt;PlayerDto&gt; getPlayer(@PathVariable String id) {\n        Player foundPlayer = playerInterface.getPlayer(Long.valueOf(id));\n        PlayerDto playerToDto = convertToDto(foundPlayer);\n        playerInterface.fetchClubToPlayer(playerToDto);\n        return ResponseEntity.ok().body(playerToDto);\n    }\n</code></pre>\n<pre><code>public PlayerDto fetchClubToPlayer(PlayerDto player) {\n        if (player.getClub() != null) {\n            Club club = clubInterface.getClub(player.getClub().getId());\n            player.setClub(club);\n        }\n        return player;\n    }\n</code></pre>\n<p>is it fine?</p>\n"},{"owner":{"user_id":9769594,"display_name":"warmCabin"},"up_vote_count":1,"is_accepted":false,"creation_date":1673194159,"answer_id":75049316,"body":"<p>You're right, this is the expected behavior of lazy loading. It's a good thing, don't set it to eager! Instead of returning a Club @Entity class directly on your response body, you should create a ClubDto and initialize it with another convertToDto method. It's kinda tedious (I like using <a href=\"https://mapstruct.org/\" rel=\"nofollow noreferrer\">Mapstruct</a> and <a href=\"https://projectlombok.org/\" rel=\"nofollow noreferrer\">Lombok</a> to alleviate that), but it'll induce Hibernate to make all the queries you need.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Data\npublic class ClubDto {\n    private String id;\n    private String name;\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@Mapper\npublic interface ClubMapper {\n    public ClubDTO mapToDto(Club club);\n}\n</code></pre>\n<hr />\n<p>Oops, didn't realize you were already using <a href=\"https://modelmapper.org/\" rel=\"nofollow noreferrer\">ModelMapper</a>. I'm not too familiar with that, but it sounds like it will just work if you swap Club for ClubDto.</p>\n"},{"owner":{"user_id":10231374,"display_name":"birca123"},"up_vote_count":0,"is_accepted":false,"creation_date":1673213277,"answer_id":75051441,"body":"<p>I suggest you use <a href=\"https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-graph\" rel=\"nofollow noreferrer\"><code>@EntityGraph</code></a> to configure the fetch plan of the resulting method's query. For example, you can declare a method in <code>PlayerRepository</code> to find a <code>Player</code> entity by id, apart from the default <code>findById</code> method, where its <code>Club</code> entity would be fetched eagerly.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface PlayerRepository extends JpaRepository&lt;Player, Long&gt;{\n   ...\n   @EntityGraph(attributePaths = {&quot;club&quot;})\n   Optional&lt;Player&gt; findWithClubFetchedEagerlyById(LongId);\n}\n</code></pre>\n<p>By providing <code>attributePaths</code>, fields that should be fetched eagerly are defined.</p>\n<p>If the <code>Club</code> entity should be always fetched eagerly when you call the <code>findById</code> method then there's no need for a separate method, therefore you can annotate the default one with <code>@EntityGraph</code>.</p>\n<p>With this solution, the network traversal is minimized because all needed data is fetched at once from a database.</p>\n"}],"owner":{"user_id":15761589,"display_name":"funnyguy"},"view_count":174,"up_vote_count":2,"answer_count":3,"score":2,"creation_date":1673192265,"question_id":75049080,"body":"<p>I have a problem with my <code>Club</code> entity - I'm using <code>LAZY</code> fetch type and <code>ModelMapper</code> to return my JSON. The problem is that if I use <code>LAZY</code> instead of <code>EAGER</code> what I get as a response of <code>GET</code> <code>/api/players/{id}</code> is:</p>\n<pre><code>Resolved [org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: could not initialize proxy\n</code></pre>\n<p>and a screenshot from Postman:</p>\n<p><a href=\"https://i.stack.imgur.com/Plg1W.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Plg1W.png\" alt=\"enter image description here\" /></a></p>\n<p>When I debug my controller's action:</p>\n<pre><code>@GetMapping(&quot;/api/players/{id}&quot;)\n    ResponseEntity&lt;PlayerDto&gt; getPlayer(@PathVariable String id) {\n        Player foundPlayer = playerInterface.getPlayer(Long.valueOf(id));\n        PlayerDto playerToDto = convertToDto(foundPlayer);\n\n        return ResponseEntity.ok().body(playerToDto);\n    }\n\n...\n\n private PlayerDto convertToDto(Player player) {\n        return modelMapper.map(player, PlayerDto.class);\n    }\n</code></pre>\n<p>it seems like both <code>foundPlayer</code> and <code>playerToDto</code> have the <code>Club</code> like this:</p>\n<p><a href=\"https://i.stack.imgur.com/KAjsL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KAjsL.png\" alt=\"enter image description here\" /></a></p>\n<p>but when I do <code>foundPlayer.getClub().getName()</code> I get a proper name. I know it's probably expected behavior, but I would love to have the <code>Club</code> returned in my response like this (screenshot from the response if <code>EAGER</code> is set):\n<a href=\"https://i.stack.imgur.com/bcjCo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bcjCo.png\" alt=\"enter image description here\" /></a></p>\n<p>without having to set the fetch type to <code>EAGER</code>.</p>\n<p>My <code>Player</code> entity:</p>\n<pre><code>@Entity\npublic class Player {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n\n    private String firstName;\n\n\n    private String lastName;;\n\n    @ManyToOne(cascade = { CascadeType.PERSIST, CascadeType.REMOVE }, fetch = FetchType.EAGER)\n    @JsonManagedReference\n    private Club club;\n</code></pre>\n<p>My <code>Club</code> entity:</p>\n<pre><code>@Entity\npublic class Club {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n    private String name;\n\n    @OneToMany(mappedBy = &quot;club&quot;, cascade = CascadeType.PERSIST, fetch = FetchType.LAZY)\n    @JsonBackReference\n    private List&lt;Player&gt; players;\n</code></pre>\n<p><code>getPlayer</code> method from the <code>PlayerService</code> (the one, that the controller calls):</p>\n<pre><code> @Override\n    public Player getPlayer(Long id) {\n        Optional&lt;Player&gt; foundPlayer = playerRepository.findById(id);\n        return foundPlayer.orElseThrow(PlayerNotFoundException::new);\n    }\n</code></pre>\n<p><code>PlayerToDto</code>:</p>\n<pre><code>package pl.ug.kchelstowski.ap.lab06.dto;\n\nimport pl.ug.kchelstowski.ap.lab06.domain.Club;\n\npublic class PlayerDto {\n    private Long id;\n    private String firstName;\n    private String lastName;\n\n    private Club club;\n\n    public Long getId() {\n        return id;\n    }\n\n    public void setId(Long id) {\n        this.id = id;\n    }\n\n    public String getFirstName() {\n        return firstName;\n    }\n\n    public void setFirstName(String firstName) {\n        this.firstName = firstName;\n    }\n\n    public String getLastName() {\n        return lastName;\n    }\n\n    public void setLastName(String lastName) {\n        this.lastName = lastName;\n    }\n\n    public Club getClub() {\n        return club;\n    }\n\n    public void setClub(Club club) {\n        this.club = club;\n    }\n\n\n\n}\n</code></pre>\n"},{"tags":["java","spring-boot","hibernate","spring-data-jpa","spring-data"],"answers":[{"owner":{"user_id":5151202,"display_name":"times29"},"up_vote_count":1,"is_accepted":true,"creation_date":1673247975,"answer_id":75054057,"body":"<p>Try annotating your method with <code>@Transactional</code>. Then then <code>Customer</code> won't get detached within the method.</p>\n"}],"owner":{"user_id":12330039,"display_name":"Jeebendu kumar Behera"},"view_count":340,"up_vote_count":2,"accepted_answer_id":75054057,"answer_count":1,"score":2,"creation_date":1673189387,"question_id":75048705,"body":"<p>Sales Order save not working for existing Customer but working for new Customer</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Table(name = &quot;sales_order&quot;)\n@EntityListeners(AuditingEntityListener.class)\npublic class SalesOrder extends Auditable&lt;String&gt;  implements Serializable {\n    \n\n    private static final long serialVersionUID = 1L;\n\n    @Id\n    @GeneratedValue(strategy= GenerationType.IDENTITY)\n    private Long id;\n    \n    @OneToOne(fetch = FetchType.EAGER,cascade=CascadeType.ALL)\n    @JoinColumn(name = &quot;customer_id&quot;, nullable = false)\n    private Customer customer;\n    \n\n@Entity\n@Table(name = &quot;customer&quot;)\n@EntityListeners(AuditingEntityListener.class)\npublic class Customer extends Auditable&lt;String&gt;  implements Serializable {\n    \n\n    private static final long serialVersionUID = 1L;\n\n    @Id\n    @GeneratedValue(strategy= GenerationType.IDENTITY)\n    private Long id;\n    \n    @OneToOne(mappedBy=&quot;customer&quot;,cascade={CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST,CascadeType.REFRESH})\n    private SalesOrder salesOrder;\n    \n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>SalesOrder salesOrder = new SalesOrder();\n            Branch branch = BranchContextHolder.getCurrentBranch();\n            String nextSequense = null;\n            if(salesOrderDto.getId()==null) {\n                salesOrder = new SalesOrder(salesOrderDto);\n                salesOrder.setBranch(branch);\n                if(customerRepository.existsByPhone(salesOrderDto.getCustomer().getPhone())) {\n                    Customer customer = customerRepository.findCustomerByPhone(salesOrderDto.getCustomer().getPhone());\n                    customer.setSalesOrder(salesOrder);\n                    salesOrder.setCustomer(customer);\n                }\n                nextSequense = sequenceService.getNextSequense(branch.getId(),module.getId());\n                salesOrder.setUid(nextSequense);\n            }\n\n//save sales order\nsalesOrder = salesOrderRepository.save(salesOrder);\n</code></pre>\n<p>On save getting error:</p>\n<pre><code>detached entity passed to persist: com.jee.cms.app.customer.model.Customer; nested exception is org.hibernate.PersistentObjectException: detached entity passed to persist: com.jee.cms.app.customer.model.Customer\n</code></pre>\n<p>Anything I am missing?</p>\n"},{"tags":["java","gradle"],"comments":[{"owner":{"user_id":6395627,"display_name":"Slaw"},"edited":false,"comment_id":132432684,"body":"From what I can tell from your directory structure, project 2 is nested under project 1, yet it has its own <code>settings.gradle</code> file. Is project 2 supposed to be a sub-project? Or did you mean them to be two separate projects?"},{"owner":{"user_id":3321579,"display_name":"Scorb"},"edited":false,"comment_id":132441311,"body":"@Slaw that is just some graphical confusion from the tree output. project1 and project2 are sibling directories at the same level."},{"owner":{"user_id":6395627,"display_name":"Slaw"},"edited":false,"comment_id":132443971,"body":"Ah yes, I see now. Perhaps this is what you&#39;re looking for: <a href=\"https://docs.gradle.org/current/userguide/composite_builds.html\" rel=\"nofollow noreferrer\">docs.gradle.org/current/userguide/composite_builds.html</a>"},{"owner":{"user_id":12704,"display_name":"Michael Easter"},"edited":false,"comment_id":132516703,"body":"Which version of Gradle are you using? That could help us reproduce the issue."},{"owner":{"user_id":7096274,"display_name":"H&#246;lderlin"},"edited":false,"comment_id":132521035,"body":"It looks like you are trying to include the project1 in two ways: first, as a project dependency, and second, as a JAR file. Remove the line <code>implementation files(&#39;..&#47;..&#47;project1&#47;lib&#47;build&#47;libs&#47;lib.jar&#39;)</code> from your build.gradle file and only keep the project dependency <code>implementation project(&#39;:project1&#39;)</code>. Also, check the path specified in settings.gradle file, if the path is correct and the project1 folder exist in that path."}],"answers":[{"owner":{"user_id":549372,"display_name":"Martin Zeitler"},"up_vote_count":0,"is_accepted":false,"creation_date":1673529293,"answer_id":75096874,"body":"<p>Make directories <code>project1</code> and <code>project2</code> both modules, one application and one library module.\nFiles <code>gradle</code>, <code>gradlew</code>, <code>gradlew.bat</code>, <code>settings.gradle</code> need to be moved one level up. The root project needs it's own <code>build.gradle</code>. Including\nthe modules in <code>settings.gradle</code> is straightforward:</p>\n<pre><code>include ':project1'\ninclude ':project2'\n</code></pre>\n<p>Then one can depend on module <code>:project2</code> in module <code>:project1</code>:</p>\n<pre><code>dependencies {\n    testImplementation project(':project2')\n    api project(':project2')\n}\n</code></pre>\n<p>The library could also be published to the default local repository <code>mavenLocal()</code>. Unless publishing a sources package to Maven (eg. <code>lib-sources.jar</code>), it's usually easier to debug with two modules. The library module still can be made a Git sub-module.</p>\n"},{"owner":{"user_id":6395627,"display_name":"Slaw"},"up_vote_count":1,"is_accepted":true,"creation_date":1673556661,"answer_id":75102173,"body":"<h1>Types of Builds</h1>\n<p>First you have to decide if this should be a <a href=\"https://docs.gradle.org/current/userguide/multi_project_builds.html\" rel=\"nofollow noreferrer\">multi-project build</a> or a <a href=\"https://docs.gradle.org/current/userguide/composite_builds.html#defining_composite_builds\" rel=\"nofollow noreferrer\">composite build</a>.</p>\n<h2>Multi-Project Build</h2>\n<p>This is when you have a single Gradle project that is made up of multiple sub-projects. You should use a multi-project build if the various modules are highly coupled.</p>\n<p>You create a sub-project by using <code>include</code> in the <code>settings.gradle[.kts]</code> file. But you should only have the one settings file. Each individual sub-project may have its own <code>build.gradle[.kts]</code> file, and typically does, but does not necessarily have to. There are various ways to cross-configure sub-projects. See the documentation linked above for details.</p>\n<p>I do not provide an example of a multi-project build in this answer.</p>\n<h2>Composite Build</h2>\n<p>This is when you have two (or more?) relatively independent projects, but one depends on the other like any other external dependency. Yet you want to use the artifacts of the Gradle project directly rather than grab the binaries from a repository. At least some of the time, anyway.</p>\n<p>There are a few ways to create a composite build.</p>\n<ol>\n<li><p>Use <code>--include-build</code> on the command line. This requires the least amount of modification to either project (none).</p>\n</li>\n<li><p>Use <code>includeBuild</code> in the <code>settings.gradle[.kts]</code> file (<strong>not</strong> <code>include</code>, as that's for multi-project builds). This requires modifying at least one of the project's configurations, which may not be desirable.</p>\n</li>\n<li><p>Create a &quot;parent&quot; Gradle project for the &quot;real&quot; projects with a <code>settings.gradle[.kts]</code> file. Then add <code>includeBuild</code> for the &quot;real&quot; projects that you want to composite.</p>\n</li>\n</ol>\n<p>In a composite build, the way dependencies are resolved is described in the documentation linked above. Here's an excerpt:</p>\n<blockquote>\n<p>Included builds interact with other builds via <a href=\"https://docs.gradle.org/current/userguide/resolution_rules.html#sec:dependency_substitution_rules\" rel=\"nofollow noreferrer\"><em>dependency substitution</em></a>. If any build in the composite has a dependency that can be satisfied by the included build, then that dependency will be replaced by a project dependency on the included build. <em>Because of the reliance on dependency substitution, composite builds may force configurations to be resolved earlier, when composing the task execution graph. This can have a negative impact on overall build performance, because these configurations are not resolved in parallel</em>.</p>\n</blockquote>\n<p>Note you don't use <code>project(&quot;...&quot;)</code> to define a dependency on an included build. You simply use the regular Maven coordinates like normal, and if the included build has a project matching those coordinates, then it will be substituted in.</p>\n<hr />\n<h1>Example Composite Build</h1>\n<p>This example uses <code>--include-build</code> to create a composite build. Although this example can be reproduced by following the instructions below, it can be a little error-prone and tedious, so here is a <a href=\"https://gitlab.com/stack-overflow1/so-75045567\" rel=\"nofollow noreferrer\">GitLab repository</a> of the final example. I make no promise to keep the repository alive.</p>\n<h2>Source Code</h2>\n<p>Here is how the two projects were generated and any changes I made to the build configurations and or the code. Note I used Gradle 7.6 when running the <code>init</code> task. Also, when prompted with:</p>\n<blockquote>\n<pre class=\"lang-none prettyprint-override\"><code>Generate build using new APIs and behavior (some features may change in the next minor release)? (default: no) [yes, no]\n</code></pre>\n</blockquote>\n<p>I answered, &quot;no&quot;.</p>\n<h3>Project 1</h3>\n<p>This project is the &quot;library&quot;. It was generated with the following command:</p>\n<pre class=\"lang-none prettyprint-override\"><code>...\\demo\\project1&gt; gradle init --type java-library --test-framework junit-jupiter --project-name project1 --package sample.project1 --dsl kotlin\n</code></pre>\n<p>I only made modifications to the following files:</p>\n<p><strong>lib\\build.gradle.kts</strong></p>\n<p>I added:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>group = &quot;sample.project1&quot;\nversion = &quot;1.0&quot;\n</code></pre>\n<p><strong>lib\\src\\main\\java\\sample\\project1\\Library.java</strong></p>\n<p>Changed it to:</p>\n<pre class=\"lang-java prettyprint-override\"><code>/*\n * This Java source file was generated by the Gradle 'init' task.\n */\npackage sample.project1;\n\npublic class Library {\n\n    public static void printMessage() {\n        System.out.println(&quot;Hello, this is a composite build!&quot;);\n    }\n}\n</code></pre>\n<p><strong>lib\\src\\test\\java\\sample\\project1\\LibraryTest.java</strong></p>\n<p>I deleted this file.</p>\n<h3>Project 2</h3>\n<p>This project is the &quot;application&quot;. It depends on project 1. It was generated with the following command:</p>\n<pre class=\"lang-none prettyprint-override\"><code>...\\demo\\project2&gt; gradle init --type java-application --test-framework junit-jupiter --project-name project2 --package sample.project2 --dsl kotlin\n</code></pre>\n<p>I only made modifications to the following files:</p>\n<p><strong>app\\build.gradle.kts</strong></p>\n<p>I added:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>group = &quot;sample.project2&quot;\nversion = &quot;1.0&quot;\n</code></pre>\n<p>And added the following to the <code>dependencies</code> block:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>// ADD DEPENDENCY ON PROJECT 1\nimplementation(&quot;sample.project1:lib:1.0&quot;)\n</code></pre>\n<p><strong>app\\src\\main\\java\\sample\\project2\\App.java</strong></p>\n<p>I changed it to:</p>\n<pre class=\"lang-java prettyprint-override\"><code>/*\n * This Java source file was generated by the Gradle 'init' task.\n */\npackage sample.project2;\n\nimport sample.project1.Library;\n\npublic class App {\n\n    public static void main(String[] args) {\n        Library.printMessage();\n    }\n}\n</code></pre>\n<p><strong>app\\src\\test\\java\\sample\\project2\\AppTest.java</strong></p>\n<p>I deleted this file.</p>\n<h2>Directory Structure</h2>\n<p>Here is the directory structure of the two projects after generating them and making the above modifications. The output excludes the <code>.gradle</code> directory.</p>\n<pre class=\"lang-none prettyprint-override\"><code>...\\DEMO\n├───project1\n│   │   .gitattributes\n│   │   .gitignore\n│   │   gradlew\n│   │   gradlew.bat\n│   │   settings.gradle.kts\n│   │\n│   ├───gradle\n│   │   └───wrapper\n│   │           gradle-wrapper.jar\n│   │           gradle-wrapper.properties\n│   │\n│   └───lib\n│       │   build.gradle.kts\n│       │\n│       └───src\n│           ├───main\n│           │   ├───java\n│           │   │   └───sample\n│           │   │       └───project1\n│           │   │               Library.java\n│           │   │\n│           │   └───resources\n│           └───test\n│               ├───java\n│               └───resources\n└───project2\n    │   .gitattributes\n    │   .gitignore\n    │   gradlew\n    │   gradlew.bat\n    │   settings.gradle.kts\n    │\n    ├───app\n    │   │   build.gradle.kts\n    │   │\n    │   └───src\n    │       ├───main\n    │       │   ├───java\n    │       │   │   └───sample\n    │       │   │       └───project2\n    │       │   │               App.java\n    │       │   │\n    │       │   └───resources\n    │       └───test\n    │           ├───java\n    │           └───resources\n    └───gradle\n        └───wrapper\n                gradle-wrapper.jar\n                gradle-wrapper.properties\n</code></pre>\n<h2>Running Example</h2>\n<p>Running the example with the following command:</p>\n<pre class=\"lang-none prettyprint-override\"><code>...\\demo\\project2&gt; .\\gradlew app:run --include-build ..\\project1 --console plain\n</code></pre>\n<p><sup><strong>Note:</strong> I used <code>--console plain</code> in order to see all the task output. That way you can see tasks from the included build were executed. You do not need to include this option if you don't want to.</sup></p>\n<p>Gave the following output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>&gt; Task :app:processResources NO-SOURCE\n&gt; Task :project1:lib:compileJava\n&gt; Task :project1:lib:processResources NO-SOURCE\n&gt; Task :project1:lib:classes\n&gt; Task :project1:lib:jar\n&gt; Task :app:compileJava\n&gt; Task :app:classes\n\n&gt; Task :app:run\nHello, this is a composite build!\n\nBUILD SUCCESSFUL in 1s\n4 actionable tasks: 4 executed\n</code></pre>\n"}],"owner":{"user_id":3321579,"display_name":"Scorb"},"view_count":204,"up_vote_count":2,"accepted_answer_id":75102173,"answer_count":2,"score":2,"creation_date":1673153424,"question_id":75045567,"body":"<p>I have project2 that depends on project1. They are both next to each other on my file system.</p>\n<p>When I try to build project2 (after successfully building project1) I get the error:</p>\n<pre><code>Could not determine the dependencies of task ':app:distTar'.\n&gt; Could not resolve all task dependencies for configuration ':app:runtimeClasspath'.\n   &gt; Could not resolve project :project1.\n     Required by:\n         project :app\n      &gt; No matching configuration of project :project1 was found. The consumer was configured to find a runtime of a library compatible with Java 11, packaged as a jar, preferably optimized for standard JVMs, and its dependencies declared externally but:\n          - None of the consumable configurations have attributes.\n</code></pre>\n<p>Project2 adds the dependency to project1 as follows...</p>\n<p>build.gradle</p>\n<pre><code>/*\n * This file was generated by the Gradle 'init' task.\n *\n * This generated file contains a sample Java application project to get you started.\n * For more details take a look at the 'Building Java &amp; JVM projects' chapter in the Gradle\n * User Manual available at https://docs.gradle.org/7.2/userguide/building_java_projects.html\n */\n\nplugins {\n    // Apply the application plugin to add support for building a CLI application in Java.\n    id 'application'\n}\n\nrepositories {\n    // Use Maven Central for resolving dependencies.\n    mavenCentral()\n}\n\ndependencies {\n    // Use JUnit test framework.\n    testImplementation 'junit:junit:4.13.2'\n\n    // This dependency is used by the application.\n    implementation 'com.google.guava:guava:30.1.1-jre'\n\n    implementation project(':project1')\n    implementation files('../../project1/lib/build/libs/lib.jar')\n}\n\napplication {\n    // Define the main class for the application.\n    mainClass = 'project2.App'\n}\n</code></pre>\n<p>Settings.gradle</p>\n<pre><code>rootProject.name = 'project2'\ninclude('app')\n\ninclude   ':project1'\nproject(':project1').projectDir = new File(settingsDir, '../project1')\n</code></pre>\n<p>The source for project1...</p>\n<pre><code>/*\n * This Java source file was generated by the Gradle 'init' task.\n */\npackage project1;\n\npublic class Library {\n    public boolean someLibraryMethod() {\n        return true;\n    }\n}\n</code></pre>\n<p>The source for project2</p>\n<pre><code>/*\n * This Java source file was generated by the Gradle 'init' task.\n */\npackage project2;\n\nimport project1.*;\n\npublic class App {\n    public String getGreeting() {\n        return &quot;Hello World!&quot;;\n    }\n\n    public static void main(String[] args) {\n        System.out.println(new App().getGreeting());\n        bool someBool = Library.someLibraryMethod();\n    }\n}\n</code></pre>\n<p>the complete folder structure of the two projects. Although it looks like project2 is under project1, that is just how the copy pasted output looks, they are indeed sibling folders.</p>\n<pre><code>── project1\n│   ├── gradle\n│   │   └── wrapper\n│   │       ├── gradle-wrapper.jar\n│   │       └── gradle-wrapper.properties\n│   ├── gradlew\n│   ├── gradlew.bat\n│   ├── lib\n│   │   ├── bin\n│   │   │   ├── main\n│   │   │   │   └── project1\n│   │   │   │       └── Library.class\n│   │   │   └── test\n│   │   │       └── project1\n│   │   │           └── LibraryTest.class\n│   │   ├── build\n\n│   │   │   ├── libs\n│   │   │   │   └── lib.jar\n\n│   │   ├── build.gradle\n│   │   └── src\n│   │       ├── main\n│   │       │   ├── java\n│   │       │   │   └── project1\n│   │       │   │       └── Library.java\n│   │       │   └── resources\n│   │       └── test\n│   │           ├── java\n│   │           │   └── project1\n│   │           │       └── LibraryTest.java\n│   │           └── resources\n│   └── settings.gradle\n└── project2\n    ├── app\n    │   ├── build.gradle\n    │   └── src\n    │       ├── main\n    │       │   ├── java\n    │       │   │   └── project2\n    │       │   │       └── App.java\n    │       │   └── resources\n    │       └── test\n    │           ├── java\n    │           │   └── project2\n    │           │       └── AppTest.java\n    │           └── resources\n    ├── gradle\n    │   └── wrapper\n    │       ├── gradle-wrapper.jar\n    │       └── gradle-wrapper.properties\n    ├── gradlew\n    ├── gradlew.bat\n    └── settings.gradle\n</code></pre>\n<p>69 directories, 37 files</p>\n"},{"tags":["java"],"comments":[{"owner":{"user_id":4216641,"display_name":"Turing85"},"edited":false,"comment_id":132428098,"body":"I take a guess: you try to implement <a href=\"https://anydice.com/articles/exploding-dice/\" rel=\"nofollow noreferrer\">exploding dice (<code>anydice.com</code>)</a>? My suggestion - if you want the individual die values - would be to return a <code>List&lt;Integer&gt;</code> (one value per die rolled, in a first approximation). Later on, we could extend this and return a <code>List&lt;DieRoll&gt;</code> where <code>DieRoll</code> is a class we write and can store meta-information in (e.g. which die - if exploded - triggered this die to roll)."},{"owner":{"user_id":256196,"display_name":"Bohemian"},"edited":false,"comment_id":132431853,"body":"Is it that you want to implement say &quot;3D8&quot; as 3 rolls of an 8-sided dice and return the total of the 3 rolls?"}],"answers":[{"owner":{"user_id":4725875,"display_name":"DevilsHnd"},"up_vote_count":0,"is_accepted":false,"creation_date":1673129652,"answer_id":75044126,"body":"<p>Specific game dice can be basically anything but typically they are just a cube with six faces consisting of one to six dots or numbered 1 to 6. I don't know what <strong>DnD</strong> has for dice but this can apply to any type of dice or be easily modified to accommodate whatever.</p>\n<p>The idea is a method that allows you provide the number of dice to roll and the number of Faces (sides) that will be on each die. Since the dice are specific to the game, the number of faces (sides) can be hard-coded into the method but in this case, the method could be used for any dice game since the number of faces is also provided to the method. The value of the returned die values could relate to a specific index (-1) of a specific Array to provide specific meaning:</p>\n<pre><code>public static int[] rollDice(int numberOfDice, int numberOfDieFaces){\n    int[] die = new int[numberOfDice];\n    for (int d = 0; d &lt; die.length; d++) {\n        die[d] = java.util.concurrent.ThreadLocalRandom.current().nextInt(1, numberOfDieFaces + 1);\n    }\n    return die;\n}\n</code></pre>\n<p><strong>To roll a single die with six faces:</strong></p>\n<pre><code>int[] dice  = rollDice(1, 6);\nSystem.out.println(Arrays.toString(dice));\n</code></pre>\n<p><strong>To roll two dice with eight faces:</strong></p>\n<pre><code>int[] dice  = rollDice(2, 8);\nSystem.out.println(Arrays.toString(dice));\n</code></pre>\n<p><strong>To roll five dice with six faces:</strong></p>\n<pre><code>int[] dice  = rollDice(5, 6);\nSystem.out.println(Arrays.toString(dice));\n</code></pre>\n<p>ect, ect, ....</p>\n"},{"owner":{"user_id":731938,"display_name":"Igor Kanshyn"},"up_vote_count":1,"is_accepted":false,"creation_date":1673129667,"answer_id":75044129,"body":"<p>In Java, you cannot return several values from one function, but you can return an Object which will hold several values.\nHere is a basic implementation of such function and a respective unit test for it:</p>\n<pre><code>    public List&lt;Integer&gt; roll(int sides, int amount){\n        int lowestRoll = 1;\n\n        List&lt;Integer&gt; results = new ArrayList&lt;&gt;();\n\n        ThreadLocalRandom random = ThreadLocalRandom.current();\n        for (int ii = 0; ii &lt; amount; ii++) {\n            results.add(random.nextInt(lowestRoll, sides));\n        }\n        return results;\n    }\n\n    @Test\n    void testRoll() {\n       assertThat(roll(6, 1).size()).isEqualTo(1);\n       assertThat(roll(6, 3).size()).isEqualTo(3);\n    }\n\n</code></pre>\n<p>Please, make sure that you have adjusted the actual roll method logic to your needs.</p>\n"},{"owner":{"user_id":642706,"display_name":"Basil Bourque"},"up_vote_count":0,"is_accepted":false,"creation_date":1673141931,"answer_id":75044987,"body":"<h1>tl;dr</h1>\n<p>Make a class to represent a die. Write a <code>roll</code> method, and another method that rolls repeatedly to return a list like that discussed in <a href=\"https://stackoverflow.com/a/75044129/642706\">other Answer</a>.</p>\n<pre><code>new Die( 6 ).rollRepeatedly( 3 )\n</code></pre>\n<blockquote>\n<p>[5, 6, 1]</p>\n</blockquote>\n<h1>Details</h1>\n<p>The <a href=\"https://stackoverflow.com/a/75044129/642706\">Answer by Igor Kanshyn</a> is correct, and directly answers your Question. I will look at the bigger picture, to show an object-oriented way to address the multiple types of dice you want to support.</p>\n<h2>Make class <code>Die</code></h2>\n<p>By the way, the singular of <a href=\"https://en.wikipedia.org/wiki/Dice\" rel=\"nofollow noreferrer\">dice</a> is <em>die</em>. Precise naming helps to make your programming more clear.</p>\n<p>We define a class to represent a die. The constructor for this class takes an argument to define the number of its sides.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public Die ( final int sides )\n{\n    this.sides = sides;\n}\n</code></pre>\n<p>And the class needs a method <code>roll</code> to randomly pick a face (a side).</p>\n<p>The last-rolled face needs to be kept as state on the object. So we have a property <code>currentFace</code> on our class, kept as read-only to outsiders.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public int roll ( )\n{\n    this.currentFace = ThreadLocalRandom.current().nextInt( 1 , ( this.sides + 1 ) );  // Add one because the `bound` parameter is *exclusive*. \n    return this.currentFace;\n}\n</code></pre>\n<p>And we should add overrides for some of the methods inherited from the <code>Object</code> superclass. These methods are <code>equals</code>, <code>hashCode</code>, and <code>toString</code>.</p>\n<p>And let's add a method to roll multiple times. This method returns an unmodifiable <code>List</code> of the results.</p>\n<p>Put all that code together.</p>\n<pre class=\"lang-java prettyprint-override\"><code>package work.basil.example.game;\n\nimport java.util.List;\nimport java.util.Objects;\nimport java.util.UUID;\nimport java.util.concurrent.ThreadLocalRandom;\nimport java.util.stream.IntStream;\n\npublic class Die\n{\n    // -------|  Final state  |-----------------------\n\n    public final UUID id;  // Identify each die existing in the game.\n    public final int sides;\n\n    // -------|  Properties  |-----------------------\n\n    private int currentFace;\n\n    // -------|  Business logic  |-----------------------\n\n    public int roll ( )\n    {\n        this.currentFace = ThreadLocalRandom.current().nextInt( 1 , ( this.sides + 1 ) );\n        return this.currentFace;\n    }\n\n    public List &lt; Integer &gt; rollRepeatedly ( final int countRolls )\n    {\n        // Validate argument.\n        if ( countRolls &lt; 1 ) { throw new IllegalArgumentException( &quot;Count of rolls must be a positive number, bigger than zero. Message # 404cd68f-034a-47de-91dc-adbdbfb0801b.&quot; ); }\n\n        // Generate the specified amount of rolls.\n        List &lt; Integer &gt; results = IntStream.rangeClosed( 1 , countRolls ).map( ( int n ) -&gt; this.roll() ).boxed().toList();\n        return results;\n    }\n\n    // -------|  Constructors  |-----------------------\n\n    public Die ( final int sides )\n    {\n        // Validate argument.\n        if ( sides &lt; 2 ) { throw new IllegalArgumentException( &quot;Count of sides must be a positive number, more than one. Message # b9586272-2f2c-4618-993d-2d2ccbb8f489.&quot; ); }\n\n        this.sides = sides;\n        this.id = UUID.randomUUID();\n        this.roll();  // Initialize.\n    }\n\n    // -------|  Getters  |-----------------------\n\n    public int getCurrentFace ( ) { return currentFace; }\n\n    // ---------|  `Object` overrides  |----------------------------\n\n    @Override\n    public boolean equals ( Object obj )\n    {\n        if ( obj == this ) { return true; }\n        if ( obj == null || obj.getClass() != this.getClass() ) { return false; }\n        var that = ( Die ) obj;\n        return Objects.equals( this.id , that.id );\n    }\n\n    @Override\n    public int hashCode ( ) { return Objects.hash( id ); }\n\n    @Override\n    public String toString ( )\n    {\n        return &quot;Die{&quot; +\n                &quot;id=&quot; + id +\n                &quot;, sides=&quot; + sides +\n                &quot;, currentFace=&quot; + currentFace +\n                '}';\n    }\n}\n</code></pre>\n<p>Let's exercise that class.</p>\n<pre class=\"lang-java prettyprint-override\"><code>System.out.println( new Die( 6 ).rollRepeatedly( 3 ) );\n</code></pre>\n<blockquote>\n<p>[5, 6, 1]</p>\n</blockquote>\n<hr />\n<p>If not comfortable with streams, you can replace the <code>IntStream</code> line in the <code>rollRepeatedly</code> method with a conventional <code>for</code> loop.</p>\n<pre class=\"lang-java prettyprint-override\"><code>        List &lt; Integer &gt; results = new ArrayList &lt;&gt;();\n        for ( int nthRoll = 1 ; nthRoll &lt;= countRolls ; nthRoll++ )\n        {\n            int roll = this.roll();\n            Integer integer = roll;  // Wrapping a primitive `int` within an `Integer` object.  \n            results.add( integer );\n        }\n</code></pre>\n"},{"owner":{"user_id":256196,"display_name":"Bohemian"},"up_vote_count":0,"is_accepted":false,"creation_date":1673145521,"answer_id":75045174,"body":"<p>Assuming <code>amount</code> is the number of rolls of a <code>sides</code> sided dice and you want to return the <em>sum</em> of those rolls:</p>\n<pre><code>public static int roll(int sides, int amount) {\n    int result = 0;\n    for (int i = 0; i &lt; amount; i++) { \n        result += ThreadLocalRandom.current().nextInt(sides) + 1;\n    }\n    return result;\n}\n</code></pre>\n<p>If you prefer a one-liner:</p>\n<pre><code>public static int roll(int sides, int amount) {\n    return Stream.generate(ThreadLocalRandom::current)\n      .limit(amount)\n      .mapToInt(tlr -&gt; tlr.nextInt(sides) + 1)\n      .sum();\n}\n</code></pre>\n"}],"owner":{"user_id":20304433,"display_name":"tachankskang"},"view_count":104,"up_vote_count":2,"answer_count":4,"score":2,"creation_date":1673118212,"question_id":75043048,"body":"<p>I have been trying to build a <a href=\"https://en.wikipedia.org/wiki/Dungeons_&amp;_Dragons\" rel=\"nofollow noreferrer\"><em>Dungeons &amp; Dragons</em></a> inspired text based adventure game in Java. I am relatively new to coding/programming.</p>\n<p>I have built a separate method that I am building the dice rolling function inside of, and then calling it inside the main when I need the method.</p>\n<p>The method that I have made proceeds as follows:</p>\n<pre><code>public static int roll(int sides, int amount1){\n        numSides = sides;\n        amount = amount1;\n        return ThreadLocalRandom\n            .current()\n            .nextInt(lowestRoll,numSides);\n            \n\n            \n    }\n</code></pre>\n<p><code>sides</code> indicates of sides I have for each of the dice so that way I can use multiple dice types in one method. I basically want to be able to return the <code>ThreadLocalRandom</code> multiple times depending on a conditional. I know that you cannot return something multiple times in a method which is why I have came here because I need a loophole to figure this method out.</p>\n<p>I think that what I'm looking for would look approximately like this but I'm not sure:</p>\n<pre><code> if (amount &gt; 1){\n            return ThreadLocalRandom * amount\n                .current()\n                .nextInt(lowestRoll,numSides);\n                }\n</code></pre>\n<p>This is not the right syntax(obviously) but any help with this method would be appreciated.</p>\n<p>Now, the program runs correctly, I would just have to call the method multiple times instead of using the sides parameter.</p>\n"},{"tags":["java","spring","google-cloud-platform","google-cloud-storage"],"answers":[{"owner":{"user_id":4671437,"display_name":"Stan Ostrovskii"},"up_vote_count":1,"is_accepted":true,"creation_date":1673077332,"answer_id":75038811,"body":"<p>Well, that did not take me long to figure out. I was able to make it work as follows:</p>\n<pre><code>@GetMapping(path = &quot;/file&quot;, produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)\npublic ResponseEntity&lt;InputStreamResource&gt; getSpecificFile(@RequestParam String fileName, @RequestParam String bucketName, @RequestParam String projectName) {\n    Storage storage = StorageOptions.newBuilder().setProjectId(projectId).build().getService();\n    Blob blob = storage.get(bucketName, fileName);\n    ReadChannel readChannel = blob.reader();\n    try {\n        String contentType = Files.probeContentType(Paths.get(fileName));\n\n        InputStream inputStream = Channels.newInputStream(readChannel);\n        return ResponseEntity.ok().contentType(MediaType.valueOf(contentType))\n                .header(&quot;Content-Disposition&quot;, &quot;attachment; filename=&quot; + fileName)\n                .body(new InputStreamResource(inputStream));\n    } catch (IOException e) {\n        e.printStackTrace();\n        return ResponseEntity.internalServerError().body(null);\n    }\n}\n</code></pre>\n<p>Basically redirect the InputStream to the readChannel instead of the file.</p>\n"}],"owner":{"user_id":4671437,"display_name":"Stan Ostrovskii"},"view_count":181,"up_vote_count":2,"accepted_answer_id":75038811,"answer_count":1,"score":2,"creation_date":1673075754,"question_id":75038694,"body":"<p>We would like to have a Java REST API to return files from Google Cloud Storage as attachment. I was able to able to get it to work using the following method. The problem is that the file has to be downloaded locally to the service container (we are deploying on Google Cloud Run) and this is a problem in the case of very large files, and may generally be bad practice. Is there a way to modify this code somehow to skip the creation of a local file?</p>\n<pre><code>@GetMapping(path = &quot;/file&quot;, produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)\npublic ResponseEntity&lt;InputStreamResource&gt; getSpecificFile(@RequestParam String fileName,\n        @RequestParam String bucketName, @RequestParam String projectName) {\n    Storage storage = StorageOptions.newBuilder().setProjectId(projectId).build().getService();\n    Blob blob = storage.get(bucketName, fileName);\n    ReadChannel readChannel = blob.reader();\n    String outputFileName = tempFileDestination.concat(&quot;\\\\&quot;).concat(fileName);\n    try (FileOutputStream fileOutputStream = new FileOutputStream(outputFileName)) {\n        fileOutputStream.getChannel().transferFrom(readChannel, 0, Long.MAX_VALUE);\n        String contentType = Files.probeContentType(Paths.get(outputFileName));\n\n        FileInputStream fileInputStream = new FileInputStream(outputFileName);\n        return ResponseEntity.ok().contentType(MediaType.valueOf(contentType))\n                .header(&quot;Content-Disposition&quot;, &quot;attachment; filename=&quot; + fileName)\n                .body(new InputStreamResource(fileInputStream));\n    } catch (IOException e) {\n        e.printStackTrace();\n        return ResponseEntity.internalServerError().body(null);\n    } finally {\n        // delete the local file as cleanup\n        try {\n            Files.delete(Paths.get(outputFileName));\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n"},{"tags":["java","spring","spring-integration"],"answers":[{"owner":{"user_id":2756547,"display_name":"Artem Bilan"},"up_vote_count":1,"is_accepted":true,"creation_date":1673020746,"answer_id":75033244,"body":"<p>Confirmed. Looks like some bug in Java compiler by itself.\nWhen I swap those <code>transform()</code> and <code>handle()</code> it compiles.\nOr if I remove it or modify some other way...</p>\n<p>You can use this as a workaround for now:</p>\n<pre><code>.transform(this, &quot;transform&quot;)\n</code></pre>\n<p>That compiler error is fully not relevant to your <code>transform()</code> definition.</p>\n<p>I might be mistaken judging Java compiler, so will be glad to see some other explanations and hints what is wrong with our code.</p>\n"}],"owner":{"user_id":20370596,"display_name":"Christoph Dahlen"},"view_count":45,"up_vote_count":2,"accepted_answer_id":75033244,"answer_count":1,"score":2,"creation_date":1673010167,"question_id":75031285,"body":"<p>I am still fighting to realize the following flow using Spring Integration 5.5:</p>\n<ol>\n<li>read a file from remote SFTP service as InputStream</li>\n<li>transform that stream into a custom entity</li>\n<li>persist the entity via JPA</li>\n<li>delete remote file from SFTP server</li>\n</ol>\n<p>So, I have the following flow using Java DSL:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\npublic class Flow {\n\n    @Bean\n    public StandardIntegrationFlow createFlow() {\n        return IntegrationFlows\n            .from(source())\n            .publishSubscribeChannel(pubSub -&gt; pubSub\n                .subscribe(sub1 -&gt; sub1\n                    .transform(Message.class, this::transform)\n                    .handle(persist(), e -&gt; e.transactional(false))\n                )\n                .subscribe(sub2 -&gt; sub2 \n                    .handle(remove())\n                )\n            )\n            .get();\n\n    }\n\n    public MessageSource&lt;InputStream&gt; source() {\n        return null;\n    }\n\n    public Message&lt;MyEntity&gt; transform(Message&lt;InputStream&gt; message) {\n        return null;\n    }\n\n    public JpaOutboundGateway persist() {\n        return null;\n    }\n\n    public AbstractMessageHandler remove() {\n        return null;\n    }\n\n}\n</code></pre>\n<p>My IDE (VSCode) is giving me no warning about this code, however when trying to compile it using Apache Maven 3.8 / JDK 17, I get the following compilation error:</p>\n<pre><code>[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.1:compile (default-compile) on project amqp: Compilation failure\n[ERROR] /C:/Users/.../src/main/java/com/example/Flow.java:[25,46] cannot find symbol\n[ERROR]   symbol:   method transactional(boolean)\n[ERROR]   location: variable e of type java.lang.Object\n</code></pre>\n<p>The reason seems to the the transformation (<code>transform()</code>), because as soon as I remove that transformation, the code compiles. Of course it fails during runtime, because <code>persist()</code> method expects a Message, not Message.</p>\n<p>Any ideas on what is wrong with my transform-methods signature?</p>\n"},{"tags":["java","spring-boot","google-app-engine","spring-security"],"comments":[{"owner":{"user_id":20939581,"display_name":"Jessie"},"edited":false,"comment_id":132394915,"body":"For the local test, I use <a href=\"http://localhost:8080\" rel=\"nofollow noreferrer\">localhost:8080</a>. For Google cloud test, I use <a href=\"http://eomclubregistrationweb.ue.r.appspot.com\" rel=\"nofollow noreferrer\">eomclubregistrationweb.ue.r.appspot.com</a> which is generated by Google cloud. I don&#39;t know if there is any reverse proxy or not."},{"owner":{"user_id":20939581,"display_name":"Jessie"},"edited":false,"comment_id":132395697,"body":"I am sure I am running the same Spring application code on Google. The pom.xml has some extra configuration for Google. I use Java 17 locally while Google requires to use Java 11. I added more debug logs above. Please take a look. It looks like Ant [pattern=&#39;/admin*&#39;] is missing in the log on Google."},{"owner":{"user_id":13664137,"display_name":"moken"},"edited":false,"comment_id":132403329,"body":"All your comments should be added to the question. Edit and rewite if necessary."}],"answers":[{"owner":{"user_id":20939581,"display_name":"Jessie"},"up_vote_count":1,"is_accepted":false,"creation_date":1673028483,"answer_id":75034610,"body":"<p>I found the issue is related to the order of the security config applied to the Spring security framework.</p>\n<p>When running the code using localhost:8080, the admin security config is applied first and the Google oauth2 is applied later. I noticed this from the Spring security debug log. However, when running the same code on google cloud, the order of processing the security config is reversed. I don't know why. Once the google oauth2 is configured first, the admin form login is configured later, I start to see the issue.</p>\n<p>So, a workaround fix is available. I tried to reverse the security config order in the code for my google cloud version. This did fix the issue. I was able to see the admin form login as well as Google oauth2 login.</p>\n<p>It looks like the &quot;@Order&quot; doesn't work as expected. The actual order of processing the security config is determined by the class name alphabetically.</p>\n"}],"owner":{"user_id":20939581,"display_name":"Jessie"},"view_count":331,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1672949879,"question_id":75023909,"body":"<p>I have a Spring Boot web application with two types of authentication configurations. One is form login for admin and the other is OAuth2 using Google account.</p>\n<p>This works fine when I run it locally on Eclipse. It also works fine when I run the same using <code>./mvnw spring-boot:run</code> on cloud-shell. But when I deploy the application to Google App engine or Google Run, the form login stop working. The form login doesn't show up and the the webpage secured for admin is accessible to anyone. The Google OAuth2 login always works fine.</p>\n<p>Here is the code for security config.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\n@EnableWebSecurity\n// Spring boot security configuration\npublic class SecurityConfig {\n\n    @Bean\n    public static PasswordEncoder encoder() {\n        return new BCryptPasswordEncoder();\n    }\n\n    // Admin credential configuration\n    @Configuration\n    @Order(1)\n    public static class AdminConfigurationAdapter {\n        @Bean\n        public UserDetailsService userDetailsServiceAdmin() {\n            UserDetails user = User\n                    .withUsername(&quot;admin&quot;)\n                    .password(encoder().encode(&quot;adminPass&quot;))\n                    .roles(&quot;ADMIN&quot;)\n                    .build();\n            return new InMemoryUserDetailsManager(user);\n        }\n\n        @Bean\n        public SecurityFilterChain filterChainAdmin(HttpSecurity http) throws Exception {\n            http\n                .antMatcher(&quot;/admin*&quot;)\n                .authorizeRequests()\n                    .anyRequest().hasRole(&quot;ADMIN&quot;)\n                    // log in\n                    .and()\n                .formLogin()\n                    .loginPage(&quot;/loginAdmin&quot;)\n                    .loginProcessingUrl(&quot;/admin_login&quot;)\n                    .failureUrl(&quot;/loginAdmin?error=loginError&quot;)\n                    .defaultSuccessUrl(&quot;/admin_view&quot;)\n                    // logout\n                    .and()\n                .logout()\n                    .logoutUrl(&quot;/admin_logout&quot;)\n                    .logoutSuccessUrl(&quot;/welcome&quot;)\n                    .deleteCookies(&quot;JSESSIONID&quot;)\n                    .and()\n                .exceptionHandling()\n                    .accessDeniedPage(&quot;/403&quot;)\n                    .and()\n                .csrf().disable();\n\n            return http.build();\n        }\n    }\n\n    // Google account oauth2 login configuration\n    @Order(2)\n    @Configuration\n    public static class ApplicantConfiguration {\n        @Bean\n        public SecurityFilterChain filterChainApplicant(HttpSecurity http) throws Exception {\n            http\n                .authorizeRequests()\n                    .antMatchers(&quot;/applicant*&quot;).authenticated()\n                    .and()\n                .oauth2Login()\n                    .and()\n                .logout()\n                    .logoutSuccessUrl(&quot;/welcome&quot;)\n                    .deleteCookies(&quot;JSESSIONID&quot;)\n                    .and()\n                .exceptionHandling()\n                    .accessDeniedPage(&quot;/403&quot;);\n            return http.build();\n        }\n    }\n}\n</code></pre>\n<p>I found that if I create two different form login using different user/passwd, it works fine in Google Cloud App engine. Only the case that the form login mixed with Google OAuth2 login doesn't work.</p>\n<p>Here are the Spring Security debug logs for comparing. When running on Google Cloud APP, it says &quot;Authorized public object filter invocation [GET /admin_view]&quot;. When running locally, it says &quot;Redirecting to http://localhost:8080/loginAdmin&quot;. I just couldn't figure out why.</p>\n<p><strong>The logs for the working one on localhost:8080</strong></p>\n<pre><code>2022-12-29 22:05:08.768 DEBUG 92679 --- [nio-8080-exec-3] o.s.security.web.FilterChainProxy        : Securing GET /admin_view\n\n2022-12-29 22:05:08.768 DEBUG 92679 --- [nio-8080-exec-3] s.s.w.c.SecurityContextPersistenceFilter : Set SecurityContextHolder to empty SecurityContext\n\n2022-12-29 22:05:08.768 DEBUG 92679 --- [nio-8080-exec-3] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext\n\n2022-12-29 22:05:08.768 DEBUG 92679 --- [nio-8080-exec-3] o.s.s.w.session.SessionManagementFilter  : Request requested invalid session id 0C1EB7E035C74BC01E7F8D1E706683FC\n\n2022-12-29 22:05:08.776 DEBUG 92679 --- [nio-8080-exec-3] o.s.s.w.a.i.FilterSecurityInterceptor    : Failed to authorize filter invocation [GET /admin_view] with attributes [hasRole('ROLE_ADMIN')]\n\n2022-12-29 22:05:08.798 DEBUG 92679 --- [nio-8080-exec-3] o.s.s.w.s.HttpSessionRequestCache        : Saved request http://localhost:8080/admin_view to session\n\n2022-12-29 22:05:08.799 DEBUG 92679 --- [nio-8080-exec-3] o.s.s.web.DefaultRedirectStrategy        : Redirecting to http://localhost:8080/loginAdmin\n</code></pre>\n<p><strong>The logs for the application running on Google App engine.</strong></p>\n<pre><code>2022-12-30 03:07:15 default[20221230t020608]  2022-12-30 03:07:15.991 DEBUG 11 --- [0.0-8081-exec-2] o.s.security.web.FilterChainProxy        : Securing GET /admin_view\n\n2022-12-30 03:07:15 default[20221230t020608]  2022-12-30 03:07:15.992 DEBUG 11 --- [0.0-8081-exec-2] s.s.w.c.SecurityContextPersistenceFilter : Set SecurityContextHolder to empty SecurityContext\n\n2022-12-30 03:07:15 default[20221230t020608]  2022-12-30 03:07:15.992 DEBUG 11 --- [0.0-8081-exec-2] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext\n\n2022-12-30 03:07:15 default[20221230t020608]  2022-12-30 03:07:15.992 DEBUG 11 --- [0.0-8081-exec-2] o.s.s.w.session.SessionManagementFilter  : Request requested invalid session id A7635E4C3457927648904B5BCAC69E7C\n\n2022-12-30 03:07:15 default[20221230t020608]  2022-12-30 03:07:15.992 DEBUG 11 --- [0.0-8081-exec-2] o.s.s.w.a.i.FilterSecurityInterceptor    : Authorized public object filter invocation [GET /admin_view]\n\n2022-12-30 03:07:15 default[20221230t020608]  2022-12-30 03:07:15.993 DEBUG 11 --- [0.0-8081-exec-2] o.s.security.web.FilterChainProxy        : Secured GET /admin_view\n</code></pre>\n"},{"tags":["java","apache-kafka","spring-kafka","aws-glue","avro"],"comments":[{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"edited":false,"comment_id":132396830,"body":"So the factory didn&#39;t compile, so where else is <code>consumerConfigs()</code> actually being used? In the logs, are you seeing <code>value.deserializer = ... StringDeserializer</code>, then? Why not configure deserializers <a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/messaging.html#messaging.kafka\" rel=\"nofollow noreferrer\">in the properties</a>?"},{"owner":{"user_id":9418902,"display_name":"Csisanyi"},"edited":false,"comment_id":132397645,"body":"Could you please add your pom.xml (At least the dependencies concerning kafka and the schema registry). Also just as a naive question, have you generated the necessary classes from the avro schema(s) And as mentioned by @OneCricketeer what about application.properties?"},{"owner":{"user_id":10867687,"display_name":"Anand K"},"edited":false,"comment_id":132408350,"body":"POM added @Csisanyi. Topics are written using the Kafka connect as GenericRecord., so no need for avro schema classes."},{"owner":{"user_id":10867687,"display_name":"Anand K"},"edited":false,"comment_id":132408351,"body":"@OneCricketeer, ConsumerConfigs() are only used in the ConsumerFactory. properties are set below, key and value are avro. And using springboot they are not deserializing key or value and it gives the above error (cant cast string to genericrecord). Works fine in regular java program.          config.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, GlueSchemaRegistryKafkaDeserializer.class.getName());         config.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, GlueSchemaRegistryKafkaDeserializer.class.getName());"},{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"edited":false,"comment_id":132408771,"body":"Spring is still a &quot;regular java program&quot;. If your method is never used, spring-kafka simply defaults to use StringDeserializer. Why not use property file?"},{"owner":{"user_id":10867687,"display_name":"Anand K"},"edited":false,"comment_id":132409143,"body":"What I meant by regular java program is not using springboot. Both consumer properties and glue configs are set in consumerConfigs() method. consumerConfigs() are used as argument in building consumerFactory(), and consumerFactory() is used as a argument in concurrentKafkaListenerContainerFactory(). So everything is set properly."}],"answers":[{"owner":{"user_id":10867687,"display_name":"Anand K"},"up_vote_count":1,"is_accepted":true,"creation_date":1673024174,"answer_id":75033878,"body":"<p>I figured out what the issue is. In the config class SpringBoot expects the factory bean name to be <strong>kafkaListenerContainerFactory</strong>. I named it <strong>concurrentKafkaListenerContainerFactory</strong> which is causing the issue of not loading the consumer and glue configurations properly.</p>\n<blockquote>\n<p>By default, a bean with name <strong>kafkaListenerContainerFactory</strong> is\nexpected.</p>\n</blockquote>\n<p><a href=\"https://docs.spring.io/spring-kafka/docs/current/reference/html/#kafka-listener-annotation\" rel=\"nofollow noreferrer\">https://docs.spring.io/spring-kafka/docs/current/reference/html/#kafka-listener-annotation</a></p>\n"}],"owner":{"user_id":10867687,"display_name":"Anand K"},"view_count":624,"up_vote_count":2,"accepted_answer_id":75033878,"answer_count":1,"score":2,"creation_date":1672940949,"question_id":75022441,"body":"<p>I have topics written by kafka connect that are in AVRO GENERIC_RECORD format using Glue Schema Registry. I am able to consume those using the documentation using a plain java program.\nHowever I am having difficulty reading consuming them using spring boot application.</p>\n<p>My simple config class</p>\n<pre><code>@EnableKafka\n@Configuration\n\npublic class KafkaAvroConsumerConfig {\n\n    @Value(&quot;${spring.kafka.bootstrap-servers}&quot;)\n    private String brokers;\n    @Value(&quot;${spring.kafka.consumer.group-id}&quot;)\n    private String groupId;\n\n    // Creating a Listener\n    @Bean\n    public ConcurrentKafkaListenerContainerFactory&lt;GenericRecord, GenericRecord&gt; concurrentKafkaListenerContainerFactory() {\n        ConcurrentKafkaListenerContainerFactory&lt;GenericRecord, GenericRecord&gt; factory = new ConcurrentKafkaListenerContainerFactory&lt;&gt;();\n        factory.setConsumerFactory(consumerFactory());\n        return factory;\n    }\n\n    @Bean\n    public ConsumerFactory&lt;GenericRecord, GenericRecord&gt; consumerFactory() {\n        return new DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs());\n    }\n\n    @Bean\n    public Map&lt;String, Object&gt; consumerConfigs() {\n        // Creating a Map of string-object pairs\n        Map&lt;String, Object&gt; config = new HashMap&lt;&gt;();\n\n        // Adding the Configuration\n        config.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, brokers);\n        config.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n\n        config.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, GlueSchemaRegistryKafkaDeserializer.class.getName());\n        config.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, GlueSchemaRegistryKafkaDeserializer.class.getName());\n\n        config.put(AWSSchemaRegistryConstants.AWS_REGION, region);\n        config.put(AWSSchemaRegistryConstants.REGISTRY_NAME, registryName);\n\n        config.put(AWSSchemaRegistryConstants.AVRO_RECORD_TYPE, AvroRecordType.GENERIC_RECORD.getName());\n        config.put(AWSSchemaRegistryConstants.SCHEMA_NAMING_GENERATION_CLASS,\n                MySchemaNamingStrategy.class.getName());\n\n        return config;\n    }\n}\n\n</code></pre>\n<p>And listener class</p>\n<pre><code>@Component\n\npublic class KafkaAvroConsumer {\n\n    @Autowired\n    KafkaTemplate&lt;GenericRecord, GenericRecord&gt; kafkaTemplate;\n\n    @KafkaListener(topics = &quot;gsr1.HR.DEPARTMENTS&quot;)\n    public void listenDepartment(ConsumerRecord&lt;GenericRecord, GenericRecord&gt; record) {\n\n        //System.out.println(&quot;DEPARTMENTS key   schema = &quot; + record.key().getSchema().toString());\n        GenericRecord key = record.key();\n        GenericRecord value = record.value();\n        System.out.println(&quot;            record.key() = &quot; + key);\n        System.out.println(&quot;          record.value() = &quot; + value);\n        System.out.println(&quot;      Key  DEPARTMENT_ID = &quot; + key.get(&quot;DEPARTMENT_ID&quot;));\n        System.out.println(&quot;         DEPARTMENT_NAME = &quot; + (String) value.get(&quot;DEPARTMENT_NAME&quot;));\n    }\n\n}\n</code></pre>\n<p>This gives me an error at &quot;GenericRecord key = record.key();&quot;, looks like they didn't get deserialized to GenericRecord, instead they are just raw bytes</p>\n<pre><code>Caused by: java.lang.ClassCastException: class java.lang.String cannot be cast to class org.apache.avro.generic.GenericRecord (java.lang.String is in module java.base of loader 'bootstrap'; org.apache.avro.generic.GenericRecord is in unnamed module of loader 'app')\n</code></pre>\n<p>I was looking and in spring documentation the DefaultKafkaConsumerFactory method also takes key and value deserialization class also as parameters. So I tried to do this but that doesn't compile.. GlueSchemaRegistryKafkaDeserializer doesn't take type argument either</p>\n<pre><code>    public ConsumerFactory&lt;GenericRecord, GenericRecord&gt; consumerFactory() {\n        Deserializer&lt;GenericRecord&gt; avroDeser =  new GlueSchemaRegistryKafkaDeserializer();\n        avroDeser.configure(consumerConfigs(), false);\n        return new DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs(), avroDeser, avroDeser);\n    }\n</code></pre>\n<p>Any help in how to get this to work.\nI put the question out in GSR github too <a href=\"https://github.com/awslabs/aws-glue-schema-registry/issues/241\" rel=\"nofollow noreferrer\">https://github.com/awslabs/aws-glue-schema-registry/issues/241</a></p>\n<p>Here is the POM</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.0.1&lt;/version&gt;\n        &lt;relativePath/&gt; \n    &lt;/parent&gt;\n    &lt;groupId&gt;com.test&lt;/groupId&gt;\n    &lt;artifactId&gt;SpringBootKafkaAvro&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;SpringBootKafkaAvro&lt;/name&gt;\n    &lt;description&gt;Spring boot Kafka Avro using Glue Schema registry&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;software.amazon.glue&lt;/groupId&gt;\n            &lt;artifactId&gt;schema-registry-serde&lt;/artifactId&gt;\n            &lt;version&gt;1.1.14&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;\n            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;\n            &lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-kafka-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n\n</code></pre>\n"},{"tags":["java","eclipse","maven"],"comments":[{"owner":{"user_id":2657515,"display_name":"JonathanDavidArndt"},"edited":false,"comment_id":132392346,"body":"Is this actually Richard Feynman?"},{"owner":{"user_id":10660307,"display_name":" RichardFeynman"},"edited":false,"comment_id":132393703,"body":"@JonathanDavidArndt Mr. Feynman? Surely You&#39;re Joking"},{"owner":{"user_id":2657515,"display_name":"JonathanDavidArndt"},"edited":false,"comment_id":132395720,"body":"YESSSSS! Love it"}],"answers":[{"owner":{"user_id":2657515,"display_name":"JonathanDavidArndt"},"up_vote_count":1,"is_accepted":false,"creation_date":1672942866,"answer_id":75022778,"body":"<p>Agree: this can be cumbersome, especially with a large number of sub-projects.</p>\n<p>The parent pom will typically be its own project. Other projects that use the parent pom will also be their own projects, and linked to the parent pom using Maven.</p>\n<p>Files/directories such as <code>.settings</code>, <code>.classpath</code>, <code>.project</code> and <code>pom.xml</code> must be at the top level of an Eclipse project (nesting sub-projects inside another related project will probably not work).</p>\n<p>While there may be settings for <code>&lt;modules&gt;</code> in Eclipse &amp; Maven that I am not aware of, everything you have with a src/target folder should be in its own Eclipse project. They can then be setup as dependencies of each other (either in Eclipse, Maven, or both).</p>\n"},{"owner":{"user_id":10660307,"display_name":" RichardFeynman"},"up_vote_count":0,"is_accepted":false,"creation_date":1673013308,"answer_id":75031857,"body":"<p>In the end I followed khmarbaise instructions. (There was a .project file in the root in the repo that needed to be deleted)</p>\n<p>After deleting all .classpath, .project and .settings files, I was able to use the import wizard without any issues.</p>\n<p>The only other thing I will add is before I primarily used the package explore in eclipse, this will show each of the sub projects as sperate entities.  If you go to the Project explorer it will show the root project in the working set you added it to with the sub projects nested underneath.</p>\n"}],"owner":{"user_id":10660307,"display_name":" RichardFeynman"},"view_count":105,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1672940537,"question_id":75022377,"body":"<p>I am trying to import a Maven project into eclipse but I am having difficulty getting Eclipse to see the java files as source files and not as resource files.</p>\n<p>I am able to clean/build the project via eclipse however.</p>\n<p>The project has parent pom.xml which lists several sub projects as modules.\nIf I directly import any of the subprojects it will see the java files as source files, but this will make it difficult to manage different versions of the project if each version will require multiple interrelated projects.</p>\n<p>I would ideally like a way to import just the parent project and have all sub projects managed under it.</p>\n<p>Project file tree:</p>\n<pre><code>ProjectFoo\n+.settings\n+base\n+lib\n+SubProjectFooA\n|   +.settings\\\n|   +scs\n|   +target\n|   +.classpath\n|   +.project\n|   +pom.xml\n+SubProjectFooB\n|   +.settings\\\n|   +scs\n|   +target\n|   +.classpath\n|   +.project\n|   +pom.xml\n+SubProjectFooC\n|   +.settings\\\n|   +scs\n|   +target\n|   +.classpath\n|   +.project\n|   +pom.xml\n+SubProjectFooD\n|   +.settings\\\n|   +scs\n|   +target\n|   +.classpath\n|   +.project\n|   +pom.xml\n+SubProjectFooE\n|   +.settings\\\n|   +scs\n|   +target\n|   +.classpath\n|   +.project\n|   +pom.xml\n+SubProjectFooF\n    +.settings\\\n    +scs\n    +target\n    +.classpath\n    +.project\n    +pom.xml\n</code></pre>\n<p>In the parent pom.xml this is how all the sub projects are added.  I am not very familiar with maven and think part of the problem could be the sub projects are added as modules, but I am not certain yet.</p>\n<pre><code>&lt;modules&gt;\n    &lt;module&gt;SubProjectFooA&lt;/module&gt;\n    &lt;module&gt;SubProjectFooB&lt;/module&gt;\n    &lt;module&gt;SubProjectFooC&lt;/module&gt;\n    &lt;module&gt;SubProjectFooD&lt;/module&gt;\n    &lt;module&gt;SubProjectFooE&lt;/module&gt;\n    &lt;module&gt;SubProjectFooF&lt;/module&gt;\n&lt;/modules&gt;\n</code></pre>\n<p>Things I have tried:</p>\n<ul>\n<li><p>Pull copy of project from git, run mvn eclipse:clean eclipse:eclipse, then import into Eclipse</p>\n</li>\n<li><p>Directly adding javabuilder and javanature to .project file</p>\n</li>\n</ul>\n"},{"tags":["java","groovy","locale"],"comments":[{"owner":{"user_id":16376827,"display_name":"g00se"},"edited":false,"comment_id":132392171,"body":"Interestingly, if you copied and pasted from your terminal, Gefährlichkeit.docx has its a umlaut as two separate characters, which can happen sometimes. What, in the terminal, is the output of <code>ls *rlichkeit.docx</code>?"},{"owner":{"user_id":1276664,"display_name":"daggett"},"edited":false,"comment_id":132395144,"body":"What if you print name with and without getAbsoluteFile()? 2 bytes means utf-8 but if you still see 2 bytes in terminal - it&#39;s wrong."},{"owner":{"user_id":1682820,"display_name":"injecteer"},"edited":false,"comment_id":132397176,"body":"why do you need to check for existence of files, which are returned by file iterating methods? if files are returned, they DO exist by definition..."},{"owner":{"user_id":14748724,"display_name":"Dirk27"},"edited":false,"comment_id":132402069,"body":"Thanks for your replies. We use UTF-8 in our dev env and in the database. The app runs in a tomcat directly on a server and in a container. g00se: With ls the file name is printed correct like in the ls -al above as &#39;Gefährlichkeit.docx&#39;. daggett: The file name inside the app is always printed wrong like above as &#39;Gefa��hrlichkeit.docx&#39;. injecteer: This is only code showing the core of the problem. The app gets the file name from the database as &#39;Gefährlichkeit.docx&#39; and java can&#39;t find the file then."},{"owner":{"user_id":14748724,"display_name":"Dirk27"},"edited":false,"comment_id":132402392,"body":"@g00se: With ls the file name is printed correct like in the ls -al above as &#39;Gefährlichkeit.docx&#39;."},{"owner":{"user_id":14748724,"display_name":"Dirk27"},"edited":false,"comment_id":132402401,"body":"@daggett: The file name inside the app is always printed wrong like above as &#39;Gefa��hrlichkeit.docx&#39;."},{"owner":{"user_id":14748724,"display_name":"Dirk27"},"edited":false,"comment_id":132402413,"body":"@injecteer: This is only code showing the core of the problem. The app gets the file name from the database as &#39;Gefährlichkeit.docx&#39; and java can&#39;t find the file then."},{"owner":{"user_id":1682820,"display_name":"injecteer"},"edited":false,"comment_id":132404187,"body":"if the file name comes from the DB, it should be a URI instead!"},{"owner":{"user_id":16376827,"display_name":"g00se"},"edited":false,"comment_id":132404584,"body":"Your problem is being caused by Unicode composition. See <a href=\"https://docs.oracle.com/en/java/javase/18/docs/api/java.base/java/text/Normalizer.html\" rel=\"nofollow noreferrer\">java.text.Normalizer</a> Perhaps more from me on this later"},{"owner":{"user_id":14748724,"display_name":"Dirk27"},"edited":false,"comment_id":132405504,"body":"Thanks for your replies. So far I think I can fix the problem by setting sun.jnu.encoding to &#39;UTF-8&#39; on application startup. In the dev env it works by setting it in the grails 4 app via build.gradle in the bootRun section. I try it now in the tomcat servers and come back later."}],"answers":[{"owner":{"user_id":16376827,"display_name":"g00se"},"up_vote_count":0,"is_accepted":false,"creation_date":1673006124,"answer_id":75030615,"body":"<p>This is not an answer as such, but it allows me to show the problem with Unicode composition and file names. Let's create two files with the same name:</p>\n<pre><code>goose@t410:/tmp$ touch $(echo -e '\\x61\\xCC\\x88.txt')\ngoose@t410:/tmp$ touch $(echo -e '\\xC3\\xA4.txt')\ngoose@t410:/tmp$ ls *.txt\nä.txt  ä.txt\n</code></pre>\n<p>What!? Hang on, this is a trick isn't it? They are really the same file? Here's proof they are different:</p>\n<pre><code>goose@t410:/tmp$ ls -i *.txt\n</code></pre>\n<p>131467 ä.txt  131527 ä.txt</p>\n"},{"owner":{"user_id":14748724,"display_name":"Dirk27"},"up_vote_count":1,"is_accepted":false,"creation_date":1673022138,"answer_id":75033482,"body":"<h1>Solution</h1>\n<p>The problem occured in different environments:</p>\n<ol>\n<li>development env: grails 4 application startet with gradle bootRun</li>\n<li>CI-stage with a tomcat 9 server</li>\n<li>production env: tomcat running in a docker container</li>\n</ol>\n<p><strong>Short answer:</strong>\nThe problem was the wrong settings for sun.jnu.encoding. Solution was to set it in the correct way for each env.</p>\n<p><strong>Long answer:</strong>\nWe had to set the java system property 'sun.jnu.encoding' in the different envs :</p>\n<h2>1. dev env</h2>\n<p>Set system properties in the bootRun section in build.gradle:</p>\n<pre><code>bootRun {\n    jvmArgs(\n        '-Dsun.jnu.encoding=UTF-8',\n        '-Dfile.encoding=UTF-8',\n        ...)\n}\n</code></pre>\n<h2>2. tomcat 9 on server</h2>\n<p>Set system properties in setenv.sh in tomcat/bin:</p>\n<pre><code>export JAVA_OPTS=&quot;-Dsun.jnu.encoding=UTF-8 -Dfile.encoding=UTF-8 $JAVA_OPTS&quot;\n</code></pre>\n<h2>3. tomcat 9 in docker container in prod env</h2>\n<p>We used this solution <a href=\"https://stackoverflow.com/a/28406007/14748724\">https://stackoverflow.com/a/28406007/14748724</a>. We need to rebuild the container image.</p>\n<p>Finally we had to set this in the docker-compose.yaml file:</p>\n<pre><code>tomcat:\n   environment:\n      LC_ALL: 'en_US.UTF-8'\n</code></pre>\n<p>Before it was <code>LC_ALL: 'C'</code>, which was wrong.</p>\n<p><em>Note: Using the setenv.sh solution from env 2. <strong>didn't</strong> work in the container!</em></p>\n"}],"owner":{"user_id":14748724,"display_name":"Dirk27"},"view_count":76,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1672940248,"question_id":75022318,"body":"<p>Im facing a problem with umlauts in groovy/java on a ubuntu server.</p>\n<p>This groovy code return for exists() false for files with umlauts:</p>\n<pre><code>def f1 = new File('/var/lib/jenkins/test/')\ndef files = [:]\nf1.listFiles().each {\n  files.put(it.name, it.getAbsoluteFile().exists())\n}\nprintln files\nprintln 'file.encoding:' + System.getProperty('file.encoding')\n</code></pre>\n<p>Results in:</p>\n<pre><code>Verderblichkeit.docx:true\nGefa��hrlichkeit.docx:false\nfile.encoding:&quot;iso-8859-1&quot;\n</code></pre>\n<p>So it return false for a file it found itself with listFile(). That is wrong.</p>\n<p>ls -al in the drirectory:</p>\n<pre><code>drwxr-xr-x  2 jenkins jenkins   4096 Jan  5 18:17 .\ndrwxr-xr-x 66 jenkins jenkins  12288 Jan  5 18:16 ..\n-rw-r--r--  1 jenkins jenkins  98035 Jan  5 18:16 Gefährlichkeit.docx\n-rw-r--r--  1 jenkins jenkins 277515 Jan  5 18:17 Verderblichkeit.docx\n\n</code></pre>\n<p>In linux I can copy or mv or rename the files and see the umlauts.</p>\n<p>Environment:</p>\n<ul>\n<li>Version of Java: Java(TM) SE Runtime Environment (build 1.8.0_131-b11)</li>\n</ul>\n<p>Note: The original problem is getting the file path from a database. The file can be found and served throug nginx but in the java app (grails with groovy files) I get a false result for File.exists()</p>\n<p>What can I do?</p>\n<p>I tried setting UTF-8 as file.encoding by setting this in the application environment or by -D param on start. I searched the web but didn't find a solution.</p>\n"},{"tags":["java","algorithm","bubble-sort"],"answers":[{"owner":{"user_id":5459839,"display_name":"trincot"},"up_vote_count":1,"is_accepted":false,"creation_date":1672928399,"answer_id":75019868,"body":"<p>You would need a second swap function:</p>\n<pre class=\"lang-java prettyprint-override\"><code>    public static void main(String[] args) {\n        // ... ...\n        // ... ...\n\n        sort(voteNumArray, voteNameArray); // Pass the second array too\n        displaySortedItems(voteNumArray);\n     }\n     public static void sort(int[] array, String[] names){\n        for (int i = 0; i &lt; (array.length-1);i++){\n            for(int j = 0; j &lt; (array.length - i -1);j++){\n                if(array[j] &lt; array[j+1]){\n                    swapInts(array,j);\n                    swapStrings(names,j); // Swap in second array too\n                }\n            }\n        }\n    }\n    public static void swapInts(int[] array, int index){\n        int temp = array[index];\n        array[index] = array[index + 1];\n        array[index + 1] = temp;\n    }\n    public static void swapStrings(String[] array, int index){ // Extra swap function\n        String temp = array[index];\n        array[index] = array[index + 1];\n        array[index + 1] = temp;\n    }\n</code></pre>\n"},{"owner":{"display_name":"user19443549"},"up_vote_count":0,"is_accepted":true,"creation_date":1672929166,"answer_id":75020024,"body":"<p>Bubble sort compares adjacent values and swaps if not in desired order so after every pass you will get largest/minimum(depending on implementation) value at the end of array.</p>\n<p>let assume your array is having below values and you are sorting in ascending order -</p>\n<pre><code>2,5,1,7,4\n</code></pre>\n<p>In First pass, <code>i = 0</code> -</p>\n<ol>\n<li><p>It will compare 2,5 and 5 is greater than 2, so no swap.</p>\n</li>\n<li><p>then it will compare 5,1 and 1 is smaller so it will swap and your array will become as below -</p>\n<p>2,1,5,7,4</p>\n</li>\n<li><p>compare 5,7 and no swap as 7 is greater.</p>\n</li>\n<li><p>compare 7,4 and swap as 4 is smaller and your array will become -</p>\n<p>2,5,1,4,7</p>\n</li>\n</ol>\n<p>After second pass, <code>i = 1</code> -</p>\n<pre><code>2,1,4,5,7\n</code></pre>\n<p>After third pass, <code>i = 2</code> -</p>\n<pre><code>1,2,4,5,7\n</code></pre>\n<p>Your array is sorted now, but still it will complete rest 2 passes but wont do any swap.</p>\n<p>In every iteration you gets largest(considering ascending sorting) number in the end and thats the reason you are doing <code>j &lt; array.length - i -1</code>, because you just need to sort remaining array.</p>\n"}],"owner":{"display_name":"user20758216"},"view_count":92,"up_vote_count":2,"accepted_answer_id":75020024,"answer_count":2,"score":2,"creation_date":1672926854,"question_id":75019505,"body":"<p>I have a program that I have written that allows the user to enter some votes into a system. In the end, the number entered correlates to the person of that number. (0 = Ahmed, 1 = boo, etc)</p>\n<ul>\n<li>0 - Ahmed</li>\n<li>1 - Boo</li>\n<li>2 - Celine</li>\n<li>3 - Didi</li>\n<li>4 - Elaine</li>\n</ul>\n<p><em>(current)At the end of the voting period the program will sort the votes in descending order and output them (once the user has entered -1).</em></p>\n<p><em>(future) the name of the candidate should be shown in this sorted list, e.g. ahmed - 5, celine - 4, didi -3, boo - 0, elaine - 0.</em></p>\n<p>I have the code writing the sorted vote numbers, but I am struggling to understand how it works to implement the swap with the name array to produce the final result as listed before in <strong>future</strong>.\nCan anyone help with this? Below is my code:</p>\n<pre><code>public class Main {\n    public static void main(String[] args) {\n        Scanner input = new Scanner(System.in);\n\n        int[] NumArray = new int[5];\n        final int EXIT_CODE = -1;\n        displayInitialText();\n        int userInput = input.nextInt();\n        while (userInput != EXIT_CODE) {\n            if (userInput &gt;= 0 &amp;&amp; userInput &lt;= 4) {\n                voteNumArray[userInput] = voteNumArray[userInput] + 1;\n            } else {\n                System.out.println(&quot;\\n-----------------------&quot;);\n                System.out.println(&quot;Invalid Vote - Please enter a number between 0-4&quot;);\n                System.out.println(&quot;-----------------------\\n&quot;);\n            }\n    \n            userInput = input.nextInt();\n        }\n        sort(voteNumArray);\n        displaySortedItems(voteNumArray);\n    }\n</code></pre>\n"},{"tags":["java","log4j2","smtpappender"],"comments":[{"owner":{"user_id":11748454,"display_name":"Piotr P. Karwasz"},"edited":false,"comment_id":132392552,"body":"Can you explain what kind of logic did you use to select a recipient address? Allowing the recipient to be chosen at runtime from user generated data would be a security risk."},{"owner":{"user_id":3042447,"display_name":"dethorpe"},"edited":false,"comment_id":132403210,"body":"it&#39;s not from user generated data. It&#39;s from config for an alert that is raised and logged. This is a long standing process using log4j1, so just trying to get it converted to log4j2 instead to bring it up to date."}],"answers":[{"owner":{"user_id":11748454,"display_name":"Piotr P. Karwasz"},"up_vote_count":1,"is_accepted":true,"creation_date":1673246956,"answer_id":75053942,"body":"<p>The <code>SMTPAppender</code> only evaluates the subject of an e-mail as a <a href=\"https://logging.apache.org/log4j/2.x/manual/layouts.html#Patterns\" rel=\"nofollow noreferrer\">pattern</a>. The remaining fields are immutable.</p>\n<p>What you can do is to use <a href=\"https://logging.apache.org/log4j/2.x/manual/appenders.html#RoutingAppender\" rel=\"nofollow noreferrer\"><code>RoutingAppender</code></a> to create a different SMTP appender per e-mail recipient. Something like this should work (I didn't test it):</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Routing name=&quot;Routing&quot;&gt;\n  &lt;Routes pattern=&quot;$${ctx:mailto}&quot;&gt;\n    &lt;Route&gt;\n         &lt;SMTP  name=&quot;WarningMail-${ctx:mailto}&quot; \n                subject=&quot;$${ctx:subject:-Int HealthCheck Warning}&quot;\n                to=&quot;${ctx:mailto:-root@example.com}&quot; \n                from=&quot;support@company.com&quot;\n                smtpHost=&quot;ldnsmtp&quot; \n                smtpPort=&quot;25&quot; \n                bufferSize=&quot;2000&quot; \n                ignoreExceptions=&quot;true&quot;&gt;\n                &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; \n                &lt;EmailLoggerLayout /&gt;               \n         &lt;/SMTP&gt;\n    &lt;/Route&gt;\n  &lt;/Routes&gt;\n  &lt;IdlePurgePolicy timeToLive=&quot;15&quot; timeUnit=&quot;minutes&quot;/&gt;\n&lt;/Routing&gt;\n</code></pre>\n"}],"owner":{"user_id":3042447,"display_name":"dethorpe"},"view_count":89,"up_vote_count":2,"accepted_answer_id":75053942,"answer_count":1,"score":2,"creation_date":1672924387,"question_id":75018964,"body":"<p>I'm converting a simple java healthcheck application we use from using log4j1 to log4j2-17.2. It currently uses a custom SMTPAppender which extends the built in one to set <strong>subject</strong> and <strong>To address</strong> at runtime from values in the logged event.</p>\n<p>In log4j2 can't do that as the SMTPAppender plugin class is final. Have got it working using the built in one for subject using a ThreadContext lookup, but that doesn't work for TO address and struggling to find anyway to set the To address that works.</p>\n<p>This is what I have so far</p>\n<p>For subject the SMTPAppender config is:</p>\n<pre><code>&lt;SMTP   name=&quot;ErrorMail&quot;\n                subject=&quot;$${ctx:subject:-Int HealthCheck Error}&quot; \n                to=&quot;user@company.com&quot; \n                from=&quot;support@company.com&quot;\n                smtpHost=&quot;ldnsmtp&quot; \n                smtpPort=&quot;25&quot; \n                bufferSize=&quot;2000&quot; \n                ignoreExceptions=&quot;true&quot;&gt;\n                &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;\n            &lt;EmailLoggerLayout /&gt;               \n          &lt;/SMTP&gt;\n</code></pre>\n<p>With this code setting the subject then logging the event. This works and the subject appears in the email OK</p>\n<pre><code>            if (healthCheckAlert.getSubject() != null) {\n                ThreadContext.put(&quot;subject&quot;, subjectPrefix + healthCheckAlert.getSubject());\n            }\n            warningSender.log(level, message);\n\n</code></pre>\n<p>For the To address I'm trying this to use a ThreadContext variable in same way:</p>\n<pre><code>         &lt;SMTP  name=&quot;WarningMail&quot; \n                subject=&quot;$${ctx:subject:-Int HealthCheck Warning}&quot;\n                to=&quot;$${ctx:mailto}&quot; \n                from=&quot;support@company.com&quot;\n                smtpHost=&quot;ldnsmtp&quot; \n                smtpPort=&quot;25&quot; \n                bufferSize=&quot;2000&quot; \n                ignoreExceptions=&quot;true&quot;&gt;\n                &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt; \n                &lt;EmailLoggerLayout /&gt;               \n         &lt;/SMTP&gt;\n\n</code></pre>\n<p>With this code to set it:</p>\n<pre><code>        if (healthCheckAlert.getMailTo() != null) {\n            ThreadContext.put(&quot;mailto&quot;, healthCheckAlert.getMailTo());\n        }\n\n</code></pre>\n<p>But get the error below, which indicates it hasn't been expanded</p>\n<pre><code>2023-01-05 12:40:25,951 main ERROR SmtpManager SMTP:${ctx:mailto}:::support@company.com::${ctx:subject:-Int HealthCheck Warning}:smtp:ldnsmtp:25:::INFO Could not set SmtpAppender message options: javax.mail.internet.AddressException: Local address contains illegal character in string ``${ctx:mailto}'' javax.mail.internet.AddressException: Local address contains illegal character in string ``${ctx:mailto}''\n    at javax.mail.internet.InternetAddress.checkAddress(InternetAddress.java:1216)\n    at javax.mail.internet.InternetAddress.parse(InternetAddress.java:1091)\n    at javax.mail.internet.InternetAddress.parse(InternetAddress.java:633)\n    at org.apache.logging.log4j.core.net.MimeMessageBuilder.parseAddresses(MimeMessageBuilder.java:99)\n    at org.apache.logging.log4j.core.net.MimeMessageBuilder.setRecipients(MimeMessageBuilder.java:66)\n    at org.apache.logging.log4j.core.net.SmtpManager.createMimeMessage(SmtpManager.java:71)\n    at org.apache.logging.log4j.core.net.SmtpManager.connect(SmtpManager.java:340)\n    at org.apache.logging.log4j.core.net.SmtpManager.sendEvents(SmtpManager.java:172)\n    at org.apache.logging.log4j.core.appender.SmtpAppender.append(SmtpAppender.java:353)\n    at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:161)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:134)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:125)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:89)\n    at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:675)\n    at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:633)\n    at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:616)\n    at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:552)\n    at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:82)\n    at org.apache.logging.log4j.core.Logger.log(Logger.java:161)\n    at org.apache.logging.log4j.spi.AbstractLogger.tryLogMessage(AbstractLogger.java:2205)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessageTrackRecursion(AbstractLogger.java:2159)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2142)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1994)\n    at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1852)\n    at org.apache.logging.log4j.spi.AbstractLogger.log(AbstractLogger.java:1642)\n    at com.company.utils.healthcheck.logging.EmailLogger.log(EmailLogger.java:42)\n    at com.company.utils.healthcheck.EmailLoggerTest.testWarnAlert(EmailLoggerTest.java:42)\n</code></pre>\n<p>Have done a lot of searching to find a way to do this to no avail. Can anyone let me know if this can be done with the ThreadContext lookup somehow, or is that just not possible in log4j2 for the TO address? If so any clues on some other way to do this?.</p>\n<p>My current backstop idea is to make our own copy of the SMTPAppender class using the log4j2 source code and modify that, but would rather not.</p>\n<p><strong>UPDATE: The stacked trace when trying Piotr's idea to use a routing appender is:</strong></p>\n<pre><code>2023-01-17 11:46:23,815 main ERROR SmtpManager SMTP:${ctx:mailto}:::LondonIntegrationRtB@standardbank.com::${ctx:subject:-Int HealthCheck Warning}:smtp:ldnsmtp:25:::INFO Could not set SmtpAppender message options: javax.mail.internet.AddressException: Local address contains illegal character in string ``${ctx:mailto}'' javax.mail.internet.AddressException: Local address contains illegal character in string ``${ctx:mailto}''\n    at javax.mail.internet.InternetAddress.checkAddress(InternetAddress.java:1216)\n    at javax.mail.internet.InternetAddress.parse(InternetAddress.java:1091)\n    at javax.mail.internet.InternetAddress.parse(InternetAddress.java:633)\n    at org.apache.logging.log4j.core.net.MimeMessageBuilder.parseAddresses(MimeMessageBuilder.java:99)\n    at org.apache.logging.log4j.core.net.MimeMessageBuilder.setRecipients(MimeMessageBuilder.java:66)\n    at org.apache.logging.log4j.core.net.SmtpManager.createMimeMessage(SmtpManager.java:71)\n    at org.apache.logging.log4j.core.net.SmtpManager.connect(SmtpManager.java:340)\n    at org.apache.logging.log4j.core.net.SmtpManager.sendEvents(SmtpManager.java:172)\n    at org.apache.logging.log4j.core.appender.SmtpAppender.append(SmtpAppender.java:353)\n    at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:161)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:134)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:125)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:89)\n    at org.apache.logging.log4j.core.appender.routing.RoutingAppender.append(RoutingAppender.java:243)\n    at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:161)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:134)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:125)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:89)\n    at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:675)\n    at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:633)\n    at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:616)\n    at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:552)\n    at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:82)\n    at org.apache.logging.log4j.core.Logger.log(Logger.java:161)\n    at org.apache.logging.log4j.spi.AbstractLogger.tryLogMessage(AbstractLogger.java:2205)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessageTrackRecursion(AbstractLogger.java:2159)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2142)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1994)\n    at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1852)\n    at org.apache.logging.log4j.spi.AbstractLogger.log(AbstractLogger.java:1642)\n    at com.standardbank.utils.healthcheck.logging.EmailLogger.log(EmailLogger.java:42)\n    at com.standardbank.utils.healthcheck.EmailLoggerTest.testWarnAlert(EmailLoggerTest.java:60)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)\n    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n    at org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n    at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)\n    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:678)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)\n\nLogEvent message class = class org.apache.logging.log4j.core.impl.MutableLogEventMessage parameters = [Ljava.lang.Object;@408d971b2023-01-17 11:46:23,849 main ERROR SmtpManager SMTP:${ctx:mailto}:::LondonIntegrationRtB@standardbank.com::${ctx:subject:-Int HealthCheck Warning}:smtp:ldnsmtp:25:::INFO Caught exception while sending e-mail notification.: java.lang.NullPointerException java.lang.NullPointerException\n    at org.apache.logging.log4j.core.net.SmtpManager.sendMultipartMessage(SmtpManager.java:287)\n    at org.apache.logging.log4j.core.net.SmtpManager.sendEvents(SmtpManager.java:189)\n    at org.apache.logging.log4j.core.appender.SmtpAppender.append(SmtpAppender.java:353)\n    at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:161)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:134)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:125)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:89)\n    at org.apache.logging.log4j.core.appender.routing.RoutingAppender.append(RoutingAppender.java:243)\n    at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:161)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:134)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:125)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:89)\n    at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:675)\n    at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:633)\n    at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:616)\n    at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:552)\n    at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:82)\n    at org.apache.logging.log4j.core.Logger.log(Logger.java:161)\n    at org.apache.logging.log4j.spi.AbstractLogger.tryLogMessage(AbstractLogger.java:2205)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessageTrackRecursion(AbstractLogger.java:2159)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2142)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1994)\n    at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1852)\n    at org.apache.logging.log4j.spi.AbstractLogger.log(AbstractLogger.java:1642)\n    at com.standardbank.utils.healthcheck.logging.EmailLogger.log(EmailLogger.java:42)\n    at com.standardbank.utils.healthcheck.EmailLoggerTest.testWarnAlert(EmailLoggerTest.java:60)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)\n    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n    at org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n    at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)\n    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:678)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)\n\n2023-01-17 11:46:23,852 main ERROR An exception occurred processing Appender WarningMail org.apache.logging.log4j.LoggingException: Error occurred while sending email\n    at org.apache.logging.log4j.core.net.SmtpManager.sendEvents(SmtpManager.java:192)\n    at org.apache.logging.log4j.core.appender.SmtpAppender.append(SmtpAppender.java:353)\n    at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:161)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:134)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:125)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:89)\n    at org.apache.logging.log4j.core.appender.routing.RoutingAppender.append(RoutingAppender.java:243)\n    at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:161)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:134)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:125)\n    at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:89)\n    at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:675)\n    at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:633)\n    at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:616)\n    at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:552)\n    at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:82)\n    at org.apache.logging.log4j.core.Logger.log(Logger.java:161)\n    at org.apache.logging.log4j.spi.AbstractLogger.tryLogMessage(AbstractLogger.java:2205)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessageTrackRecursion(AbstractLogger.java:2159)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2142)\n    at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1994)\n    at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1852)\n    at org.apache.logging.log4j.spi.AbstractLogger.log(AbstractLogger.java:1642)\n    at com.standardbank.utils.healthcheck.logging.EmailLogger.log(EmailLogger.java:42)\n    at com.standardbank.utils.healthcheck.EmailLoggerTest.testWarnAlert(EmailLoggerTest.java:60)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)\n    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n    at org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n    at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)\n    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:678)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)\nCaused by: java.lang.NullPointerException\n    at org.apache.logging.log4j.core.net.SmtpManager.sendMultipartMessage(SmtpManager.java:287)\n    at org.apache.logging.log4j.core.net.SmtpManager.sendEvents(SmtpManager.java:189)\n    ... 46 more\n\n</code></pre>\n"},{"tags":["java","gradle","code-generation","avro","avro-tools"],"answers":[{"owner":{"user_id":3067148,"display_name":"Harold L. Brown"},"up_vote_count":1,"is_accepted":true,"creation_date":1674723522,"answer_id":75243972,"body":"<p>I have now created a simple Gradle task that generates the Avro Java classes.</p>\n<pre><code>import org.apache.avro.tool.SpecificCompilerTool\n\nbuildscript {\n    dependencies {\n        // Add the Avro code generation to the build dependencies so that it can be used in a Gradle task.\n        classpath group: 'org.apache.avro', name: 'avro-tools', version: '1.11.1'\n    }\n}\n\nplugins {\n    // some project plugins\n    id 'application'\n}\n\ndef avroSchemasDir = &quot;src/main/avro&quot;\ndef avroCodeGenerationDir = &quot;build/generated-main-avro-java&quot;\n\n// Add the generated Avro Java code to the Gradle source files.\nsourceSets.main.java.srcDirs += [avroCodeGenerationDir]\n\ndependencies {\n    // some project dependencies\n}\n\ntasks.register('avroCodeGeneration') {\n    // Define the task inputs and outputs for the Gradle up-to-date checks.\n    inputs.dir(avroSchemasDir)\n    outputs.dir(avroCodeGenerationDir)\n    // The Avro code generation logs to the standard streams. Redirect the standard streams to the Gradle log.\n    logging.captureStandardOutput(LogLevel.INFO);\n    logging.captureStandardError(LogLevel.ERROR)\n    doLast {\n        // Run the Avro code generation.\n        new SpecificCompilerTool().run(System.in, System.out, System.err, List.of(\n                &quot;-encoding&quot;, &quot;UTF-8&quot;,\n                &quot;-string&quot;,\n                &quot;-fieldVisibility&quot;, &quot;private&quot;,\n                &quot;-noSetters&quot;,\n                &quot;schema&quot;, &quot;$projectDir/$avroSchemasDir&quot;.toString(), &quot;$projectDir/$avroCodeGenerationDir&quot;.toString()\n        ))\n    }\n}\n\ntasks.withType(JavaCompile).configureEach {\n    // Make Java compilation tasks depend on the Avro code generation task.\n    dependsOn('avroCodeGeneration')\n}\n</code></pre>\n<p>This task can be added to any Gradle build script.</p>\n"}],"owner":{"user_id":3067148,"display_name":"Harold L. Brown"},"view_count":780,"up_vote_count":3,"accepted_answer_id":75243972,"answer_count":1,"score":2,"creation_date":1672905230,"question_id":75015303,"body":"<p><a href=\"https://avro.apache.org/docs/1.11.1/getting-started-java/#download\" rel=\"nofollow noreferrer\">For Maven there is an official Avro plugin to generate Java classes from Avro schemas.</a></p>\n<p>However, for Gradle there exists no official plugin.</p>\n<p>There is <a href=\"https://github.com/davidmc24/gradle-avro-plugin\" rel=\"nofollow noreferrer\">davidmc24/gradle-avro-plugin</a>, but it is no longer maintained and <a href=\"https://github.com/davidmc24/gradle-avro-plugin#seeking-new-maintainer\" rel=\"nofollow noreferrer\">it is looking for a maintainer</a>.</p>\n<p>How can I generate Java classes from Avro schemas as part of a Gradle build?</p>\n"},{"tags":["java","sql","database","replace"],"comments":[{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":132379320,"body":"you need to pay attention at least to <code>order by</code> and <code>group by</code> clauses, because replacing projection by <code>count(*)</code> makes SQL statement invalid if statement contains <code>order by</code> or <code>group by</code>. Another case is set operations: <code>UNION (ALL)</code>, <code>INTERSECT</code>, <code>MINUS</code> - that is obvious you can&#39;t perform desired transformation. Why do not just enclose original query into <code>select count(*) from (...)</code>?"},{"owner":{"user_id":16959486,"display_name":"Teddy Tsai"},"edited":false,"comment_id":132379537,"body":"@AndreyB.Panfilov because the database sharding parsing engine will not allow nested queries that do not contain the sharding column, it won&#39;t know how to route the query and throw a parsing exception."},{"owner":{"user_id":3706016,"display_name":"jarlh"},"edited":false,"comment_id":132379643,"body":"To do this properly you need a full SQL grammar (for the dbms you&#39;re using.)"}],"answers":[{"owner":{"user_id":1863229,"display_name":"Tim Biegeleisen"},"up_vote_count":2,"is_accepted":false,"creation_date":1672903869,"answer_id":75015109,"body":"<p>We can try a regex replacement here, targeting the <code>SELECT</code> clause.  Assuming that each part of the query be on a separate line, we can try:</p>\n<pre class=\"lang-java prettyprint-override\"><code>String sql = &quot;select xxx,xxx,xxx \\nfrom xxx\\nwhere xxxxx&quot;;\nString output = sql.replaceAll(&quot;\\\\bselect.*&quot;, &quot;select count(*) as total&quot;);\nSystem.out.println(output);\n</code></pre>\n<p>This prints:</p>\n<pre><code>select count(*) as total\nfrom xxx\nwhere xxxxx\n</code></pre>\n<p>The regex pattern <code>\\bselect.*</code> will match the <code>select</code> keyword until the end of that line (<code>.*</code> will not match across newlines by default).  We then replace with the desired select count.</p>\n"}],"owner":{"user_id":16959486,"display_name":"Teddy Tsai"},"view_count":55,"up_vote_count":3,"answer_count":1,"score":2,"creation_date":1672903447,"question_id":75015040,"body":"<p>I need like to write a method (java) to transform an arbirtraty SQL string</p>\n<pre><code>select xxx,xxx,xxx \nfrom xxx\nwhere xxxxx\n\n-- or\n\nselect *\nfrom xxx\nwhere xxxxx\n</code></pre>\n<p>to a count sql string like:</p>\n<pre><code>select count(*) as total\nfrom xxx\nwhere xxxxx\n</code></pre>\n<p>I was thinking of replacing anything between <code>select</code> and <code>from</code> with <code>count(*) as total</code>, are there some potential problems with this approach? I don't need to handle EVERY case but I'd like to know which cases could be problematic with this approach and if I can afford to ignore them, or if you would do it some other way.</p>\n<p>I cannot use this nested solution</p>\n<pre><code>select count(*)\nfrom ( original query )\n</code></pre>\n<p>because of database sharding limitations.</p>\n"},{"tags":["java","maven","junit","log4j","junit5"],"answers":[{"owner":{"user_id":4198317,"display_name":"St&#233;phane Jeandeaux"},"up_vote_count":1,"is_accepted":true,"creation_date":1672900685,"answer_id":75014638,"body":"<p>The methods BeforeAll and BeforeEach are not executed due to surefire plugin.\nYou should use at least maven-surefire-plugin#3.0.0-M1.</p>\n<pre><code>&lt;plugin&gt;\n  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n  &lt;artifactId&gt;maven-surefire-report-plugin&lt;/artifactId&gt;\n  &lt;version&gt;3.0.0-M1&lt;/version&gt;\n&lt;/plugin&gt;\n</code></pre>\n"}],"owner":{"user_id":2526362,"display_name":"Reed_Xia"},"view_count":158,"up_vote_count":2,"accepted_answer_id":75014638,"answer_count":1,"score":2,"creation_date":1672882589,"question_id":75013039,"body":"<p>I create a simple maven project to describe my problem</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n  &lt;groupId&gt;org.example&lt;/groupId&gt;\n  &lt;artifactId&gt;NoLog&lt;/artifactId&gt;\n  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n  &lt;properties&gt;\n    &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;\n    &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;\n    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n  &lt;/properties&gt;\n  &lt;dependencies&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n      &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;\n      &lt;version&gt;5.9.0&lt;/version&gt;\n      &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;commons-logging&lt;/groupId&gt;\n      &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;\n      &lt;version&gt;1.2&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n      &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;\n      &lt;version&gt;2.19.0&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n      &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;\n      &lt;version&gt;2.19.0&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n      &lt;artifactId&gt;log4j-jcl&lt;/artifactId&gt;\n      &lt;version&gt;2.19.0&lt;/version&gt;\n    &lt;/dependency&gt;\n  &lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre>\n<p>my test class code</p>\n<pre><code>import org.apache.logging.log4j.LogManager;\nimport org.apache.logging.log4j.Logger;\nimport org.junit.jupiter.api.BeforeAll;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\n\npublic class TestDemo {\n\n  static Logger log = LogManager.getLogger(TestDemo.class);\n  @BeforeAll\n  public static void setupClass() {\n    log.info(&quot;BeforeAll 111 from log.info&quot;);\n    System.out.println(&quot;BeforeAll 111 from print&quot;);\n    log.info(&quot;BeforeAll 222 from log.info&quot;);\n    System.out.println(&quot;BeforeAll 222 from print&quot;);\n  }\n\n  @BeforeEach\n  public void setup() {\n    log.info(&quot;BeforeEach 111 from log.info&quot;);\n    System.out.println(&quot;BeforeEach 111 from print&quot;);\n    log.info(&quot;BeforeEach 222 from log.info&quot;);\n    System.out.println(&quot;BeforeEach 222 from print&quot;);\n  }\n\n  @Test\n  public void test1() {\n    log.info(&quot;test1 111 from log.info&quot;);\n    System.out.println(&quot;test 111 from print&quot;);\n    log.info(&quot;test1 222 from log.info&quot;);\n    System.out.println(&quot;test 222 from print&quot;);\n  }\n}\n</code></pre>\n<p>and the log4j2.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Configuration status=&quot;WARN&quot;&gt;\n  &lt;Appenders&gt;\n    &lt;Console name=&quot;LogToConsole&quot; target=&quot;SYSTEM_OUT&quot;&gt;\n      &lt;PatternLayout pattern=&quot;%d{YYYY-MM-dd HH:mm:ss} [%t] %-5p %c{1}:%L - %msg%n&quot;/&gt;\n    &lt;/Console&gt;\n  &lt;/Appenders&gt;\n  &lt;Loggers&gt;\n    &lt;Root level=&quot;info&quot;&gt;\n      &lt;AppenderRef ref=&quot;LogToConsole&quot;/&gt;\n    &lt;/Root&gt;\n    &lt;Logger name=&quot;com.hexagon&quot; level=&quot;debug&quot; additivity=&quot;false&quot;&gt;\n      &lt;AppenderRef ref=&quot;LogToConsole&quot;/&gt;\n    &lt;/Logger&gt;\n  &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>My question is, when I run it using <code>mvn test</code>, I can only see the logs from @Test function, while I don't see the logs from @BeforeAll and @BeforeEach, why and how to enable it?</p>\n<pre><code>-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning TestDemo\n2023-01-05 09:28:03 [main] INFO  TestDemo:29 - test1 111 from log.info\ntest 111 from print\n2023-01-05 09:28:03 [main] INFO  TestDemo:31 - test1 222 from log.info\ntest 222 from print\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec\n\nResults :\n\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n</code></pre>\n"},{"tags":["java","hadoop","parquet","java-17"],"comments":[{"owner":{"user_id":18157,"display_name":"Jim Garrison"},"edited":false,"comment_id":132369582,"body":"See the comment from @trilogy on the first answer to <a href=\"https://stackoverflow.com/a/45208857/18157\">this question</a>"},{"owner":{"user_id":5646962,"display_name":"Thomas Kl&#228;ger"},"edited":false,"comment_id":132372137,"body":"It could be a problem similar to <a href=\"https://stackoverflow.com/questions/48527958/docker-error-getting-username-from-password-database\" title=\"docker error getting username from password database\">stackoverflow.com/questions/48527958/&hellip;</a> (i.e. the uid that your container uses has no uid-to-username mapping within the container)."},{"owner":{"user_id":2308683,"display_name":"OneCricketeer"},"edited":false,"comment_id":132373849,"body":"<a href=\"https://hadoop.apache.org/docs/r3.3.4/index.html\" rel=\"nofollow noreferrer\">Latest version</a> only supports Java 11 runtime"},{"owner":{"user_id":814804,"display_name":"Denis"},"edited":false,"comment_id":132403846,"body":"@ThomasKl&#228;ger it seems it is the case, adding <code>RUN groupadd -g 1001 sysadmin    RUN useradd appadmin -u 1001 -g 1001 -m -s &#47;bin&#47;bash</code> to Dockerfile helped"},{"owner":{"user_id":5646962,"display_name":"Thomas Kl&#228;ger"},"edited":false,"comment_id":132404598,"body":"This information might be useful for others too. May I suggest that you write down your findings as your own answer and then accept it?"}],"answers":[{"owner":{"user_id":814804,"display_name":"Denis"},"up_vote_count":1,"is_accepted":false,"creation_date":1673006670,"answer_id":75030708,"body":"<p>adding to Dockerfile solves the issue</p>\n<pre><code>RUN groupadd -g 1001 sysadmin\nRUN useradd appadmin -u 1001 -g 1001 -m -s /bin/bash\n</code></pre>\n"}],"owner":{"user_id":814804,"display_name":"Denis"},"view_count":138,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1672856459,"question_id":75009659,"body":"<p>Following code works on OSX</p>\n<pre><code>var hadoopInputFile  = org.apache.parquet.hadoop.util.HadoopInputFile.fromPath(parquetPath, new Configuration())\n</code></pre>\n<p>but it doesn't on Linux:</p>\n<pre><code>failure to login: javax.security.auth.login.LoginException: java.lang.NullPointerException: invalid null input: name\n    at jdk.security.auth/com.sun.security.auth.UnixPrincipal.&lt;init&gt;(UnixPrincipal.java:67)\n    at jdk.security.auth/com.sun.security.auth.module.UnixLoginModule.login(UnixLoginModule.java:134)\n    at java.base/javax.security.auth.login.LoginContext.invoke(LoginContext.java:726)\n    at java.base/javax.security.auth.login.LoginContext$4.run(LoginContext.java:665)\n    at java.base/javax.security.auth.login.LoginContext$4.run(LoginContext.java:663)\n    at java.base/java.security.AccessController.doPrivileged(AccessController.java:691)\n    at java.base/javax.security.auth.login.LoginContext.invokePriv(LoginContext.java:663)\n    at java.base/javax.security.auth.login.LoginContext.login(LoginContext.java:574)\n    at org.apache.hadoop.security.UserGroupInformation$HadoopLoginContext.login(UserGroupInformation.java:2065)\n    at org.apache.hadoop.security.UserGroupInformation.doSubjectLogin(UserGroupInformation.java:1975)\n    at org.apache.hadoop.security.UserGroupInformation.createLoginUser(UserGroupInformation.java:719)\n    at org.apache.hadoop.security.UserGroupInformation.getLoginUser(UserGroupInformation.java:669)\n    at org.apache.hadoop.security.UserGroupInformation.getCurrentUser(UserGroupInformation.java:579)\n    at org.apache.hadoop.fs.FileSystem$Cache$Key.&lt;init&gt;(FileSystem.java:3746)\n    at org.apache.hadoop.fs.FileSystem$Cache$Key.&lt;init&gt;(FileSystem.java:3736)\n    at org.apache.hadoop.fs.FileSystem$Cache.get(FileSystem.java:3520)\n    at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:540)\n    at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:288)\n    at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:524)\n    at org.apache.hadoop.fs.Path.getFileSystem(Path.java:365)\n    at org.apache.parquet.hadoop.util.HadoopInputFile.fromPath(HadoopInputFile.java:38)\n...\n</code></pre>\n<p>i found that <code>new com.sun.security.auth.module.UnixSystem().getUsername()</code> returns <code>null</code> but it shouldn't</p>\n<p>any thoughts how to fix it or work around?</p>\n<p>UPD<br />\nSince this is happening inside docker container<br />\nDockerfile:</p>\n<pre><code>FROM maven:3.8.5-openjdk-17 AS tests\nENV WORKDIR=&quot;/application&quot;\nWORKDIR ${WORKDIR}\nCOPY . $WORKDIR/\n</code></pre>\n<p>run command:</p>\n<pre><code>      docker run\n        --user 0:1001\n        --volume $(command -v docker):/usr/bin/docker\n        --volume /var/run/docker.sock:/var/run/docker.sock\n        --volume $(pwd):/path/to/project/application\n        app_tag bash -c\n        &quot;umask 002;\n        mvn --settings ./.m2-settings.xml package&quot;\n</code></pre>\n<p>UPD 2<br />\ni found thad <code>id</code> gives <code>uid=1001 gid=1001 groups=1001</code><br />\nand <code>whoami</code> - <code>whoami: cannot find name for user ID 1001</code></p>\n<p>for now workaround is to add to Dockerfile</p>\n<pre><code>RUN groupadd -g 1001 sysadmin\nRUN useradd appadmin -u 1001 -g 1001 -m -s /bin/bash\n</code></pre>\n"},{"tags":["java","spring-boot","unit-testing","junit","mockito"],"comments":[{"owner":{"user_id":13084140,"display_name":"Ryednap"},"edited":false,"comment_id":132368081,"body":"Does this answer your query? <a href=\"https://stackoverflow.com/questions/34571/how-do-i-test-a-class-that-has-private-methods-fields-or-inner-classes\">How do I test a class that has private methods, fields, or inner classes?</a>"},{"owner":{"user_id":11002,"display_name":"tgdavies"},"edited":false,"comment_id":132375129,"body":"Your test is mocking <code>RequestValidationHelper</code> (which I assume is the class you want to test, although your question doesn&#39;t say), so you are not testing anything. There is no point asserting on the result of calling methods on mocks."}],"answers":[{"owner":{"user_id":9095554,"display_name":"Fabiano"},"up_vote_count":1,"is_accepted":false,"creation_date":1672853731,"answer_id":75009181,"body":"<p>In short: you should treat the content of the private methods as part of the public method you are testing. That means you should have test cases for each validation performed on the private methods, and you would test it by calling the public <code>#validate</code> method.</p>\n<p>For instance, in one case, you would use a request with an invalid date range and assert your <code>#validate</code> method throws the <code>ValidationException</code> with the expected message. And you should create cases for each one of the cases you are validating.</p>\n"}],"owner":{"user_id":19820952,"display_name":"user19820952"},"view_count":55,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1672852554,"question_id":75008972,"body":"<p>The Method Under Unit Test is this.</p>\n<pre><code>    public void validate(PurchaseOrderRequest request)\n    {\n        validateBuyers(request);\n        validateOrders(request);\n        validateSuppliers(request);\n        validateDateRange(request);\n        validateStatuses(request);\n    }\n</code></pre>\n<p>The Private Methods Look Like this</p>\n<pre><code>private void validateDateRange(PurchaseOrderRequest request)\n    {\n        if (request.getFromDeliveryDate() != null &amp;&amp; request.getThruDeliveryDate() != null &amp;&amp;\n                request.getFromDeliveryDate().isAfter(request.getThruDeliveryDate()))\n        {\n            throw new ValidationException(String.format(\n                    &quot;From delivery Date %s is invalid (cannot be after Thru Delivery Date of %s)&quot;,\n                    request.getFromDeliveryDate(), request.getThruDeliveryDate()));\n        }\n    }\n\n private void validateBuyers(PurchaseOrderRequest request)\n    {\n        if (request.getBuyers() != null)\n        {\n            request.getBuyers().forEach(elem -&gt; {\n                validateNotNull(elem, String.format(&quot;Buyer %s is invalid&quot;, elem));\n                validateRange(elem, buyerRange, String.format(&quot;Buyer %s is invalid&quot;, elem));\n            });\n            validateListMaxSize(request.getBuyers(), 50, &quot;Buyers&quot;);\n        }\n    }\n</code></pre>\n<p>My question is, what do I need to test to ensure I get the code coverage as well as useful Unit test cases? The class under test is also a child class, and with that and the private methods, it's kind of throwing me off, or maybe I'm just over thinking it.</p>\n<p>I currently have this:</p>\n<pre><code>@Test\n    void validate()\n    {\n        RmsPurchaseOrderHeaderRequest rmsPurchaseOrderHeaderRequest = Mockito.mock(RmsPurchaseOrderHeaderRequest.class);\n        RequestValidationHelper requestValidationHelper = Mockito.mock(RequestValidationHelper.class);\n\n        requestValidationHelper.validate(rmsPurchaseOrderHeaderRequest);\n        String toStringBuyers = rmsPurchaseOrderHeaderRequest.getBuyers().toString();\n        String toStringOrders = rmsPurchaseOrderHeaderRequest.getOrders().toString();\n\n        Assertions.assertNotNull(requestValidationHelper);\n        Assertions.assertEquals(rmsPurchaseOrderHeaderRequest.getBuyers().toString(),toStringBuyers);\n        Assertions.assertEquals(rmsPurchaseOrderHeaderRequest.getOrders().toString(),toStringOrders);\n\n    }\n</code></pre>\n<p>but I feel like I'm way off...\nalso if anyone knows of a good plugin to show code coverage that would be great as well. I can't get sonar lint to work.</p>\n"},{"tags":["java","spring","spring-boot","aspectj","load-time-weaving"],"comments":[{"owner":{"user_id":2696260,"display_name":"M. Deinum"},"edited":false,"comment_id":132363098,"body":"Following a manual for the 3.2.0 version of the framework where you are on 5.3 isn&#39;t the best idea. Also why both java-agents? You should only need 1. Next to that loadtimeweaving in Spring Boot is a bit of a pain to get to work (imho)."},{"owner":{"user_id":10436325,"display_name":"Mina Kh"},"edited":false,"comment_id":132363695,"body":"I searched alot and looked at many tutorials they where all the same with a little less or more. Yes definitely ltw in spring is pain but i have a requirement and also so curious about it. Thank&#39;s for your advice i will try to find related document. And i also tried one agent but got the same exception."},{"owner":{"user_id":1082681,"display_name":"kriegaex"},"edited":false,"comment_id":132366021,"body":"Welcome to SO. I have a few educated guesses what might be wrong with your approach. But I cannot say for sure, unless you post a link to an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>, ideally a Maven project on GitHub. If I can reproduce your problem, it will be easy to fix. But I do not like speculating, possibly needing multiple iterations due to incomplete information."},{"owner":{"user_id":10436325,"display_name":"Mina Kh"},"edited":false,"comment_id":132366806,"body":"I uploaded the code in my github and put the link in post. thanks in advance. <a href=\"https://github.com/minakh1993/LoadTimeWeavingSample\" rel=\"nofollow noreferrer\">github.com/minakh1993/LoadTimeWeavingSample</a>"},{"owner":{"user_id":1045142,"display_name":"Simon Martinelli"},"edited":false,"comment_id":132367294,"body":"IMO you don&#39;t need to configure the bean with TestAspect testAspect = Aspects.aspectOf(TestAspect.class);"},{"owner":{"user_id":10436325,"display_name":"Mina Kh"},"edited":false,"comment_id":132367653,"body":"I know i added it to show the exception on startup for simplicity...otherwise the exception shows itself on calling the pointcut."}],"answers":[{"owner":{"user_id":1082681,"display_name":"kriegaex"},"up_vote_count":1,"is_accepted":true,"creation_date":1672860517,"answer_id":75010362,"body":"<p>Thanks for the GitHub repo. It was easy to fix the problem like this, you did yourself a great favour by preparing it.</p>\n<p>Firstly, the pointcut and weaver configuration does not fit the example class name. Please change</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Pointcut(&quot;execution(public * com.tosan.http.server.starter.logger.ServiceLogger.log(..))&quot;)\n</code></pre>\n<p>to</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Pointcut(&quot;execution(* *(..)) &amp;&amp; @annotation(com.sample.demo.TestAnnotation)&quot;)\n</code></pre>\n<p>because I guess you want to intercept methods with marker annotations.</p>\n<p>In <em>aop.xml</em>, remove line</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;include within=&quot;com.tosan.http.server.starter.logger.ServiceLogger&quot;/&gt;\n</code></pre>\n<p>or replace it by something like</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;include within=&quot;com.sample.demo..*&quot;/&gt;\n</code></pre>\n<p>Next, get rid of factory method <code>@Bean TestAspect testAspect()</code>. You do not need it. Instead, in order to test the aspect, simply change the main method to:</p>\n<pre class=\"lang-java prettyprint-override\"><code>  public static void main(String[] args) {\n    try (ConfigurableApplicationContext appContext = SpringApplication.run(DemoApplication.class, args)) {\n      appContext.getBean(TestController.class).test();\n    }\n  }\n</code></pre>\n<p>If now you run your application like before, the console log says:</p>\n<pre class=\"lang-none prettyprint-override\"><code>(...)\n[AppClassLoader@4d7e1886] info register aspect com.sample.demo.aspect.TestAspect\n(...)\n  .   ____          _            __ _ _\n /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\\n( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\\n \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )\n  '  |____| .__|_| |_|_| |_\\__, | / / / /\n =========|_|==============|___/=/_/_/_/\n :: Spring Boot ::                (v2.7.5)\n\n(...)\n[AppClassLoader@4d7e1886] weaveinfo Join point 'method-execution(void com.sample.demo.controller.TestController.test())' in Type 'com.sample.demo.controller.TestController' (TestController.java:17) advised by around advice from 'com.sample.demo.aspect.TestAspect' (TestAspect.java)\n(...)\n2023-01-04 20:25:47.599  INFO 20208 --- [           main] c.sample.demo.controller.TestController  : {\n  &quot;service&quot; : &quot;test&quot;,\n  &quot;request&quot; : { }\n}\naspect invocation\ntest\n2023-01-04 20:25:47.611  INFO 20208 --- [           main] c.sample.demo.controller.TestController  : {\n  &quot;service&quot; : &quot;test&quot;,\n  &quot;duration&quot; : &quot;0.026s&quot;,\n  &quot;response&quot; : { }\n}\n(...)\n</code></pre>\n<p>Please note <code>aspect invocation</code> printed by the aspect.</p>\n"}],"owner":{"user_id":10436325,"display_name":"Mina Kh"},"view_count":176,"up_vote_count":2,"accepted_answer_id":75010362,"answer_count":1,"score":2,"creation_date":1672832286,"question_id":75004866,"body":"<p>I used <a href=\"https://docs.spring.io/spring-framework/docs/3.2.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw\" rel=\"nofollow noreferrer\">spring ltw documentation</a> to configure load time weaving in my spring boot app.\nbelow dependencies are in pom file:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>    &lt;dependency&gt;\n        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;\n        &lt;artifactId&gt;aspectjrt&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;\n        &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n     &lt;dependency&gt;\n         &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n         &lt;artifactId&gt;spring-instrument&lt;/artifactId&gt;\n     &lt;/dependency&gt;\n</code></pre>\n<p>aop.xml is configured as below and have placed in resources/META-INF</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;!DOCTYPE aspectj PUBLIC\n    &quot;-//AspectJ//DTD//EN&quot; &quot;http://www.eclipse.org/aspectj/dtd/aspectj.dtd&quot;&gt;\n&lt;aspectj&gt;\n    &lt;weaver options=&quot;-verbose -showWeaveInfo&quot;&gt;\n        &lt;include within=&quot;com.tosan.http.server.starter.logger.ServiceLogger&quot;/&gt;\n    &lt;/weaver&gt;\n&lt;aspects&gt;\n    &lt;aspect name=&quot;com.sample.demo.aspect.TestAspect&quot;/&gt;\n&lt;/aspects&gt;\n</code></pre>\n\n<p>I also enabled aspectj load time weaving with spring boot configuration:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\n@EnableLoadTimeWeaving()\npublic class DemoConfig {\n\n   @Bean\n   public TestAspect testAspect() {\n       TestAspect testAspect = Aspects.aspectOf(TestAspect.class);\n       return testAspect;\n   }\n}\n</code></pre>\n<p>on running program javaagent is passed as below:</p>\n<pre class=\"lang-none prettyprint-override\"><code>-javaagent:\\aspectjweaver.jar \n-javaagent:\\spring-instrument-5.3.23.jar\n</code></pre>\n<p>app give noSuchMethodException on start up:</p>\n<pre class=\"lang-none prettyprint-override\"><code>[AppClassLoader@368239c8] weaveinfo Join point 'method-execution(java.lang.Object \ncom.tosan.http.server.starter.logger.ServiceLogger.log(org.aspectj.lang.ProceedingJoinPoint))' \nin Type 'com.tosan.http.server.starter.logger.ServiceLogger' (ServiceLogger.java:17) advised \nby around advice from 'com.sample.demo.aspect.TestAspect' (TestAspect.java)\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name \n'testAspect' defined in class path resource [com/sample/demo/DemoConfig.class]: Bean \ninstantiation via factory method failed; nested exception is \norg.springframework.beans.BeanInstantiationException: Failed to instantiate \n[com.sample.demo.aspect.TestAspect]: Factory method 'testAspect' threw exception; nested \nexception is org.aspectj.lang.NoAspectBoundException: Exception while initializing \ncom.sample.demo.aspect.TestAspect: java.lang.NoSuchMethodException: \ncom.sample.demo.aspect.TestAspect.aspectOf()\nat \n</code></pre>\n<p>I should also mention that when i add ajc compiler(with com.nickwongdev plugin) app starts fine but the aspect execute twice. also tried ajc compiler and only aspectjWeaver as agent and it gives error for not finding spring specific weaver classes and tried ajc compiler with only spring weaver agent that doesn't give any error but aspect is not executed.\nany help would be appreciated.</p>\n<p>Complete code sample on <a href=\"https://github.com/minakh1993/LoadTimeWeavingSample\" rel=\"nofollow noreferrer\">github</a>.</p>\n<p>upadate: problem solved by adding the path of aspect in weaver:</p>\n<pre><code>&lt;include within=&quot;com.sample.demo.aspect.TestAspect&quot;/&gt;\n</code></pre>\n<p>I also noticed by removing @EnableLoadTimeWeaving() nothing happen and ltw is done in presence or absence of this annotation. This annotation only force the presence of spring weaver as javaagent in runtime.</p>\n<p>correct code is updated on github.</p>\n"},{"tags":["java","spring-boot","lombok"],"answers":[{"owner":{"user_id":7237884,"display_name":"Panagiotis Bougioukos"},"up_vote_count":0,"is_accepted":false,"creation_date":1672827512,"answer_id":75003975,"body":"<p>You have misunderstood something.</p>\n<p><a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/cli.html\" rel=\"nofollow noreferrer\">Spring CLI</a></p>\n<blockquote>\n<p>The Spring Boot CLI is a command line tool that you can use to\nbootstrap a new project from start.spring.io or encode a password.</p>\n</blockquote>\n<p>CLI is not part of <code>spring-boot-starter</code>. CLI is only a command line tool used as the <a href=\"https://start.spring.io/\" rel=\"nofollow noreferrer\">spring io initialized (Web)</a> but executes from your local command line instead.</p>\n<p>So the <a href=\"https://docs.spring.io/spring-boot/docs/2.7.x/reference/html/dependency-versions.html#appendix.dependency-versions\" rel=\"nofollow noreferrer\">table</a> that you have referenced in your question means that if you use <code>Spring CLI</code> and ask for lombok dependency in a <code>spring-boot</code> app of either 2.7 or 3.0.1 the initializer will provide you a newly created project where it would already have declared as dependency the <code>lombok 1.18.24</code>.</p>\n<p>This would not mean that you don't have to have declared a specific <code>lombok</code> dependency in your spring boot project. <code>spring-boot-starter-parent</code> would not have one declared for you.</p>\n<p>It is just that the CLI would make automatically this declaration in the <code>pom</code> of your new project if you choose to use the CLI for project creation.</p>\n"},{"owner":{"user_id":1136151,"display_name":"Arthur Kalimullin"},"up_vote_count":1,"is_accepted":false,"creation_date":1681272641,"answer_id":75991828,"body":"<p>Took me a long time to find the same issue you are facing. I believe you are facing this issue: <a href=\"https://github.com/projectlombok/lombok/issues/3331\" rel=\"nofollow noreferrer\">https://github.com/projectlombok/lombok/issues/3331</a></p>\n<p>If you are using <code>@ConstructorBinding</code> and didn't migrate it to the new way yet, <code>@ConstructorBinding</code> should be replaced with <code>@RequiredArgsConstructor(onConstructor_={@ConstructorBinding})</code> or removed altogether.</p>\n"}],"owner":{"user_id":3042145,"display_name":"kism3t"},"view_count":863,"up_vote_count":2,"answer_count":2,"score":2,"creation_date":1672826464,"question_id":75003789,"body":"<p>this post <a href=\"https://stackoverflow.com/questions/74952527/spring-boot-3-with-lombok\">Spring Boot 3 Lombock</a> I already read, it is exactly my issues but the solution does not help me.</p>\n<p>The issue occured while migrating from Spring Boot 2.7 to 3.0.1. According to version of lombock both have 1.18.24, which to post above suggests using. See <a href=\"https://docs.spring.io/spring-boot/docs/2.7.x/reference/html/dependency-versions.html#appendix.dependency-versions\" rel=\"nofollow noreferrer\">Spring 2.7.X</a> and <a href=\"https://docs.spring.io/spring-boot/docs/3.0.x/reference/html/dependency-versions.html#appendix.dependency-versions\" rel=\"nofollow noreferrer\">Spring 3.0.X</a>. (Edit: I got those pages from <a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide\" rel=\"nofollow noreferrer\">Spring-Boot-3.0-Migration-Guide</a>)</p>\n<p>So I get following error while <code>mvn clean compile</code> on my Entities annotated with @Data</p>\n<pre><code>[ERROR] /home/me/code/connect/services/integrator-service/src/main/java/de/comp/integratorservice/service/data/DataService.java:[113,52] cannot find symbol\n  symbol:   method getKey()\n  location: variable d of type de.comp.integratorservice.rest.dto.DataDto\n</code></pre>\n<p>All pom.xml are altered to hide company names</p>\n<p>Here is my modules pom.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n  \n  &lt;parent&gt;\n    &lt;groupId&gt;de.comp&lt;/groupId&gt;\n    &lt;artifactId&gt;pname-services&lt;/artifactId&gt;\n    &lt;version&gt;1.42-SNAPSHOT&lt;/version&gt;\n  &lt;/parent&gt;\n\n  &lt;artifactId&gt;integrator-service&lt;/artifactId&gt;\n  &lt;packaging&gt;jar&lt;/packaging&gt;\n  &lt;name&gt;integrator-service&lt;/name&gt;\n\n  &lt;dependencies&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n      &lt;scope&gt;provided&lt;/scope&gt;\n      &lt;exclusions&gt;\n        &lt;exclusion&gt;\n          &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;\n          &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;\n        &lt;/exclusion&gt;\n      &lt;/exclusions&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-cloud-stream-test-support&lt;/artifactId&gt;\n      &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.h2database&lt;/groupId&gt;\n      &lt;artifactId&gt;h2&lt;/artifactId&gt;\n      &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n\n    &lt;!-- open-api --&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springdoc&lt;/groupId&gt;\n      &lt;artifactId&gt;springdoc-openapi-webmvc-core&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;!-- when switchting to openapi from springfox swagger the compile didnt work any more...  https://mvnrepository.com/artifact/com.google.guava/guava --&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.google.guava&lt;/groupId&gt;\n      &lt;artifactId&gt;guava&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;!-- Add application packages --&gt;\n    &lt;!-- some other dependencies from our company --&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;\n      &lt;artifactId&gt;flyway-core&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;\n      &lt;artifactId&gt;flyway-sqlserver&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.microsoft.sqlserver&lt;/groupId&gt;\n      &lt;artifactId&gt;mssql-jdbc&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.github.spotbugs&lt;/groupId&gt;\n      &lt;artifactId&gt;spotbugs-annotations&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n  &lt;/dependencies&gt;\n\n\n  &lt;build&gt;\n    &lt;plugins&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;io.kokuwa.maven&lt;/groupId&gt;\n        &lt;artifactId&gt;helm-maven-plugin&lt;/artifactId&gt;\n      &lt;/plugin&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n      &lt;/plugin&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;\n      &lt;/plugin&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;com.spotify&lt;/groupId&gt;\n        &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt;\n      &lt;/plugin&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;\n      &lt;/plugin&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;com.github.spotbugs&lt;/groupId&gt;\n        &lt;artifactId&gt;spotbugs-maven-plugin&lt;/artifactId&gt;\n      &lt;/plugin&gt;\n    &lt;/plugins&gt;\n  &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n<p>Here is the one parent pom.xml:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n  &lt;parent&gt;\n    &lt;groupId&gt;de.comp&lt;/groupId&gt;\n    &lt;artifactId&gt;pname&lt;/artifactId&gt;\n    &lt;version&gt;1.42-SNAPSHOT&lt;/version&gt;\n  &lt;/parent&gt;\n  &lt;artifactId&gt;pname-services&lt;/artifactId&gt;\n  &lt;packaging&gt;pom&lt;/packaging&gt;\n\n\n  &lt;properties&gt;\n    &lt;spring-boot.repackage.skip&gt;true&lt;/spring-boot.repackage.skip&gt;\n    &lt;apt-maven-plugin.version&gt;1.1.3&lt;/apt-maven-plugin.version&gt;\n    &lt;helm-maven-plugin.version&gt;6.6.1&lt;/helm-maven-plugin.version&gt;\n  &lt;/properties&gt;\n\n  &lt;modules&gt;\n    ...\n    &lt;module&gt;integrator-service&lt;/module&gt;\n    ...\n  &lt;/modules&gt;\n\n  &lt;build&gt;\n    &lt;pluginManagement&gt;\n      &lt;plugins&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;io.kokuwa.maven&lt;/groupId&gt;\n          &lt;artifactId&gt;helm-maven-plugin&lt;/artifactId&gt;\n          &lt;version&gt;${helm-maven-plugin.version}&lt;/version&gt;\n          &lt;configuration&gt;\n            &lt;chartDirectory&gt;${project.basedir}&lt;/chartDirectory&gt;\n            &lt;chartVersion&gt;${project.version}&lt;/chartVersion&gt;\n            &lt;useLocalHelmBinary&gt;true&lt;/useLocalHelmBinary&gt;\n          &lt;/configuration&gt;\n          &lt;executions&gt;\n            &lt;execution&gt;\n              &lt;id&gt;package-helm-chart&lt;/id&gt;\n              &lt;phase&gt;package&lt;/phase&gt;\n              &lt;goals&gt;\n                &lt;goal&gt;lint&lt;/goal&gt;\n                &lt;goal&gt;package&lt;/goal&gt;\n              &lt;/goals&gt;\n            &lt;/execution&gt;\n          &lt;/executions&gt;\n        &lt;/plugin&gt;\n\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.4.0&lt;/version&gt;\n          &lt;executions&gt;\n            &lt;execution&gt;\n              &lt;id&gt;copy-dependencies&lt;/id&gt;\n              &lt;phase&gt;package&lt;/phase&gt;\n              &lt;goals&gt;\n                &lt;goal&gt;copy-dependencies&lt;/goal&gt;\n              &lt;/goals&gt;\n              &lt;configuration&gt;\n                &lt;outputDirectory&gt;${project.build.directory}/dependencies&lt;/outputDirectory&gt;\n                &lt;includeScope&gt;compile&lt;/includeScope&gt;\n                &lt;includeScope&gt;runtime&lt;/includeScope&gt;\n              &lt;/configuration&gt;\n            &lt;/execution&gt;\n          &lt;/executions&gt;\n        &lt;/plugin&gt;\n      &lt;/plugins&gt;\n    &lt;/pluginManagement&gt;\n  &lt;/build&gt;\n&lt;/project&gt;\n\n</code></pre>\n<p>and here is the parent`s parent pom:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n  &lt;groupId&gt;de.comp&lt;/groupId&gt;\n  &lt;artifactId&gt;pname&lt;/artifactId&gt;\n  &lt;version&gt;1.42-SNAPSHOT&lt;/version&gt;\n  &lt;packaging&gt;pom&lt;/packaging&gt;\n\n  &lt;parent&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n    &lt;version&gt;3.0.1&lt;/version&gt;\n    &lt;relativePath/&gt;\n  &lt;/parent&gt;\n\n  &lt;modules&gt;\n    &lt;module&gt;pname-commons&lt;/module&gt;\n  &lt;/modules&gt;\n\n  &lt;profiles&gt;\n    &lt;profile&gt;\n      &lt;id&gt;default&lt;/id&gt;\n      &lt;activation&gt;\n        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;\n      &lt;/activation&gt;\n      &lt;modules&gt;\n        &lt;module&gt;pname-external-apis&lt;/module&gt;\n        &lt;module&gt;pname-apis&lt;/module&gt;\n        &lt;module&gt;pname-services&lt;/module&gt;\n        &lt;module&gt;pname-tools&lt;/module&gt;\n        &lt;module&gt;pname-tests&lt;/module&gt;\n      &lt;/modules&gt;\n    &lt;/profile&gt;\n    &lt;profile&gt;\n      &lt;id&gt;pname-tests&lt;/id&gt;\n      &lt;modules&gt;\n        &lt;module&gt;pname-tests&lt;/module&gt;\n      &lt;/modules&gt;\n      &lt;properties&gt;\n        &lt;maven.javadoc.skip&gt;true&lt;/maven.javadoc.skip&gt;\n        &lt;maven.test.skip&gt;true&lt;/maven.test.skip&gt;\n      &lt;/properties&gt;\n    &lt;/profile&gt;\n  &lt;/profiles&gt;\n\n\n  &lt;properties&gt;\n    &lt;java.version&gt;17&lt;/java.version&gt;\n    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n    &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;\n\n    &lt;build.tag&gt;latest&lt;/build.tag&gt;\n    &lt;dockerfile.push.skip&gt;true&lt;/dockerfile.push.skip&gt;\n    &lt;codechecks.skip&gt;false&lt;/codechecks.skip&gt;\n    &lt;!-- spring-cloud must fit to the base spring-boot version --&gt;\n    &lt;spring-cloud.version&gt;2021.0.5&lt;/spring-cloud.version&gt;\n\n    &lt;org.mapstruct.version&gt;1.5.3.Final&lt;/org.mapstruct.version&gt;\n    &lt;openapi-webmvc.version&gt;1.6.14&lt;/openapi-webmvc.version&gt;\n    &lt;swagger-annotations.version&gt;2.2.7&lt;/swagger-annotations.version&gt;\n    &lt;logstash-logback-encoder.version&gt;7.2&lt;/logstash-logback-encoder.version&gt;\n    &lt;com.microsoft.sqlserver.version&gt;11.2.2.jre17&lt;/com.microsoft.sqlserver.version&gt;\n    &lt;google.guava.version&gt;31.1-jre&lt;/google.guava.version&gt;\n    &lt;checkstyle-maven-plugin.version&gt;3.2.0&lt;/checkstyle-maven-plugin.version&gt;\n    &lt;com.puppycrawl.tools.checkstyle.version&gt;10.5.0&lt;/com.puppycrawl.tools.checkstyle.version&gt;\n    &lt;sca-rules.version&gt;1.3&lt;/sca-rules.version&gt;\n    &lt;spotbugs-maven-plugin.version&gt;4.7.3.0&lt;/spotbugs-maven-plugin.version&gt;\n    &lt;com.github.spotbugs.version&gt;4.7.3&lt;/com.github.spotbugs.version&gt;\n    &lt;de.comp.security-code-generator.version&gt;1.0.8&lt;/de.comp.security-code-generator.version&gt;\n    &lt;de.comp.kcu.version&gt;1.5.0&lt;/de.comp.kcu.version&gt;\n    &lt;org.testcontainers.mssqlserver.version&gt;1.17.6&lt;/org.testcontainers.mssqlserver.version&gt;\n    &lt;com.microsoft.azure.sdk.iot.iot-service-client.versions&gt;1.34.2&lt;/com.microsoft.azure.sdk.iot.iot-service-client.versions&gt;\n    &lt;com.azure.azure-storage-blob.version&gt;12.14.4&lt;/com.azure.azure-storage-blob.version&gt;\n    &lt;net.javacrumbs.shedlock.shedlock-spring.version&gt;4.43.0&lt;/net.javacrumbs.shedlock.shedlock-spring.version&gt;\n    &lt;joda-time.version&gt;2.12.2&lt;/joda-time.version&gt;\n    &lt;querydsl-apt.version&gt;5.0.0&lt;/querydsl-apt.version&gt;\n    &lt;reproducible-build-maven-plugin.version&gt;0.16&lt;/reproducible-build-maven-plugin.version&gt;\n    &lt;exec-maven-plugin.version&gt;3.1.0&lt;/exec-maven-plugin.version&gt;\n    &lt;commons-io.version&gt;2.11.0&lt;/commons-io.version&gt;\n    &lt;apache.collections.version&gt;4.4&lt;/apache.collections.version&gt;\n    &lt;org.immutables.value.version&gt;2.9.3&lt;/org.immutables.value.version&gt;\n    &lt;com.ibm.icu4j.version&gt;72.1&lt;/com.ibm.icu4j.version&gt;\n    &lt;hamcrest-junit.version&gt;2.0.0.0&lt;/hamcrest-junit.version&gt;\n    &lt;esper.version&gt;8.8.0&lt;/esper.version&gt;\n    &lt;esper-runtime.version&gt;8.8.0&lt;/esper-runtime.version&gt;\n    &lt;esper-common.version&gt;8.8.0&lt;/esper-common.version&gt;\n    &lt;esper-compiler.version&gt;8.8.0&lt;/esper-compiler.version&gt;\n    &lt;dockerfile.maven.version&gt;1.4.13&lt;/dockerfile.maven.version&gt;\n    &lt;apache.commons-text.version&gt;1.10.0&lt;/apache.commons-text.version&gt;\n    &lt;mockserver.version&gt;5.14.0&lt;/mockserver.version&gt;\n    &lt;scala.version&gt;2.13.10&lt;/scala.version&gt;\n  &lt;/properties&gt;\n\n\n  &lt;distributionManagement&gt;\n    &lt;repository&gt;\n      &lt;id&gt;pname&lt;/id&gt;\n      &lt;url&gt;...&lt;/url&gt;\n    &lt;/repository&gt;\n  &lt;/distributionManagement&gt;\n\n  &lt;repositories&gt;\n    &lt;repository&gt;\n      &lt;id&gt;pname&lt;/id&gt;\n      &lt;url&gt;...&lt;/url&gt;\n      &lt;releases&gt;\n        &lt;enabled&gt;true&lt;/enabled&gt;\n      &lt;/releases&gt;\n      &lt;snapshots&gt;\n        &lt;enabled&gt;true&lt;/enabled&gt;\n      &lt;/snapshots&gt;\n    &lt;/repository&gt;\n    &lt;repository&gt;\n      &lt;id&gt;spring-milestones&lt;/id&gt;\n      &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;\n    &lt;/repository&gt;\n  &lt;/repositories&gt;\n\n  &lt;pluginRepositories&gt;\n    ...\n  &lt;/pluginRepositories&gt;\n\n  &lt;dependencies&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n      &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n      &lt;optional&gt;true&lt;/optional&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n      &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n      &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;\n      &lt;version&gt;${org.mapstruct.version}&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n      &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;\n      &lt;version&gt;${org.mapstruct.version}&lt;/version&gt;\n      &lt;scope&gt;provided&lt;/scope&gt;\n    &lt;/dependency&gt;\n  &lt;/dependencies&gt;\n\n  &lt;dependencyManagement&gt;\n    &lt;dependencies&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;\n        &lt;version&gt;${spring-cloud.version}&lt;/version&gt;\n        &lt;type&gt;pom&lt;/type&gt;\n        &lt;scope&gt;import&lt;/scope&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;\n        &lt;exclusions&gt;\n          &lt;!--\n           Exluding Sping Data mongodb to avoid CVE-2021-44906 (https://avd.aquasec.com/nvd/2021/cve-2021-44906/)\n           in versions prior to 3.3.5 and 3.4.1\n           --&gt;\n          &lt;exclusion&gt;\n            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-data-mongodb&lt;/artifactId&gt;\n          &lt;/exclusion&gt;\n        &lt;/exclusions&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-data-mongodb&lt;/artifactId&gt;\n        &lt;version&gt;3.4.6&lt;/version&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.springdoc&lt;/groupId&gt;\n        &lt;artifactId&gt;springdoc-openapi-webmvc-core&lt;/artifactId&gt;\n        &lt;version&gt;${openapi-webmvc.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;io.swagger.core.v3&lt;/groupId&gt;\n        &lt;artifactId&gt;swagger-annotations&lt;/artifactId&gt;\n        &lt;version&gt;${swagger-annotations.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.microsoft.sqlserver&lt;/groupId&gt;\n        &lt;artifactId&gt;mssql-jdbc&lt;/artifactId&gt;\n        &lt;version&gt;${com.microsoft.sqlserver.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.google.guava&lt;/groupId&gt;\n        &lt;artifactId&gt;guava&lt;/artifactId&gt;\n        &lt;version&gt;${google.guava.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;de.comp&lt;/groupId&gt;\n        &lt;artifactId&gt;security-code-generator&lt;/artifactId&gt;\n        &lt;version&gt;${de.comp.security-code-generator.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;de.comp.kcu&lt;/groupId&gt;\n        &lt;artifactId&gt;interfaces&lt;/artifactId&gt;\n        &lt;version&gt;${de.comp.kcu.version}&lt;/version&gt;\n        &lt;exclusions&gt;\n          &lt;!-- we manage our own version of this dependencies --&gt;\n          &lt;exclusion&gt;\n            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;\n            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;\n          &lt;/exclusion&gt;\n          &lt;exclusion&gt;\n            &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;\n            &lt;artifactId&gt;jackson-datatype-jdk8&lt;/artifactId&gt;\n          &lt;/exclusion&gt;\n          &lt;exclusion&gt;\n            &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;\n            &lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;\n          &lt;/exclusion&gt;\n          &lt;exclusion&gt;\n            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;\n          &lt;/exclusion&gt;\n        &lt;/exclusions&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.testcontainers&lt;/groupId&gt;\n        &lt;artifactId&gt;mssqlserver&lt;/artifactId&gt;\n        &lt;version&gt;${org.testcontainers.mssqlserver.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.microsoft.azure.sdk.iot&lt;/groupId&gt;\n        &lt;artifactId&gt;iot-service-client&lt;/artifactId&gt;\n        &lt;version&gt;${com.microsoft.azure.sdk.iot.iot-service-client.versions}&lt;/version&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.azure&lt;/groupId&gt;\n        &lt;artifactId&gt;azure-storage-blob&lt;/artifactId&gt;\n        &lt;version&gt;${com.azure.azure-storage-blob.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.github.spotbugs&lt;/groupId&gt;\n        &lt;artifactId&gt;spotbugs-annotations&lt;/artifactId&gt;\n        &lt;version&gt;${com.github.spotbugs.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.ibm.icu&lt;/groupId&gt;\n        &lt;artifactId&gt;icu4j&lt;/artifactId&gt;\n        &lt;version&gt;${com.ibm.icu4j.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n        &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;\n        &lt;version&gt;${apache.collections.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n        &lt;artifactId&gt;commons-text&lt;/artifactId&gt;\n        &lt;version&gt;${apache.commons-text.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.immutables&lt;/groupId&gt;\n        &lt;artifactId&gt;value&lt;/artifactId&gt;\n        &lt;version&gt;${org.immutables.value.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;\n        &lt;artifactId&gt;hamcrest-junit&lt;/artifactId&gt;\n        &lt;version&gt;${hamcrest-junit.version}&lt;/version&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n      &lt;/dependency&gt;\n\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.espertech&lt;/groupId&gt;\n        &lt;artifactId&gt;esper&lt;/artifactId&gt;\n        &lt;version&gt;${esper.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.espertech&lt;/groupId&gt;\n        &lt;artifactId&gt;esper-common&lt;/artifactId&gt;\n        &lt;version&gt;${esper-common.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.espertech&lt;/groupId&gt;\n        &lt;artifactId&gt;esper-compiler&lt;/artifactId&gt;\n        &lt;version&gt;${esper-compiler.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.espertech&lt;/groupId&gt;\n        &lt;artifactId&gt;esper-runtime&lt;/artifactId&gt;\n        &lt;version&gt;${esper-runtime.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.mock-server&lt;/groupId&gt;\n        &lt;artifactId&gt;mockserver-core&lt;/artifactId&gt;\n        &lt;version&gt;${mockserver.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.mock-server&lt;/groupId&gt;\n        &lt;artifactId&gt;mockserver-client-java&lt;/artifactId&gt;\n        &lt;version&gt;${mockserver.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;net.javacrumbs.shedlock&lt;/groupId&gt;\n        &lt;artifactId&gt;shedlock-spring&lt;/artifactId&gt;\n        &lt;version&gt;${net.javacrumbs.shedlock.shedlock-spring.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;net.javacrumbs.shedlock&lt;/groupId&gt;\n        &lt;artifactId&gt;shedlock-provider-jdbc-template&lt;/artifactId&gt;\n        &lt;version&gt;${net.javacrumbs.shedlock.shedlock-spring.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;!-- start\n          Rise Scala version for &quot;CVE-2022-31692&quot; transient dependency of\n          spring-cloud-stream-binder-kafka:3.25\n      --&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.scala-lang&lt;/groupId&gt;\n        &lt;artifactId&gt;scala-library&lt;/artifactId&gt;\n        &lt;version&gt;${scala.version}&lt;/version&gt;\n      &lt;/dependency&gt;\n      &lt;!-- end\n          Rise Scala version for &quot;CVE-2022-31692&quot; transient dependency of\n          spring-cloud-stream-binder-kafka:3.25\n      --&gt;\n    &lt;/dependencies&gt;\n  &lt;/dependencyManagement&gt;\n\n  &lt;build&gt;\n    &lt;pluginManagement&gt;\n      &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;\n            &lt;configuration&gt;\n                &lt;archive&gt;\n                    &lt;manifest&gt;\n                        &lt;addClasspath&gt;false&lt;/addClasspath&gt;\n                    &lt;/manifest&gt;\n                    &lt;addMavenDescriptor&gt;false&lt;/addMavenDescriptor&gt;\n                &lt;/archive&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;io.github.zlika&lt;/groupId&gt;\n            &lt;artifactId&gt;reproducible-build-maven-plugin&lt;/artifactId&gt;\n            &lt;version&gt;${reproducible-build-maven-plugin.version}&lt;/version&gt;\n            &lt;executions&gt;\n                &lt;execution&gt;\n                    &lt;phase&gt;package&lt;/phase&gt;\n                    &lt;goals&gt;\n                        &lt;goal&gt;strip-jar&lt;/goal&gt;\n                    &lt;/goals&gt;\n                &lt;/execution&gt;\n            &lt;/executions&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;com.spotify&lt;/groupId&gt;\n          &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt;\n          &lt;version&gt;${dockerfile.maven.version}&lt;/version&gt;\n          &lt;executions&gt;\n            &lt;execution&gt;\n              &lt;id&gt;build-tag-latest&lt;/id&gt;\n              &lt;phase&gt;package&lt;/phase&gt;\n              &lt;goals&gt;\n                &lt;goal&gt;build&lt;/goal&gt;\n              &lt;/goals&gt;\n            &lt;/execution&gt;\n            &lt;execution&gt;\n              &lt;id&gt;tag-version&lt;/id&gt;\n              &lt;phase&gt;package&lt;/phase&gt;\n              &lt;goals&gt;\n                &lt;goal&gt;tag&lt;/goal&gt;\n              &lt;/goals&gt;\n              &lt;configuration&gt;\n                &lt;tag&gt;${build.tag}&lt;/tag&gt;\n              &lt;/configuration&gt;\n            &lt;/execution&gt;\n            &lt;execution&gt;\n              &lt;phase&gt;package&lt;/phase&gt;\n              &lt;goals&gt;\n                &lt;goal&gt;push&lt;/goal&gt;\n              &lt;/goals&gt;\n            &lt;/execution&gt;\n          &lt;/executions&gt;\n          &lt;configuration&gt;\n            ...\n          &lt;/configuration&gt;\n        &lt;/plugin&gt;\n      &lt;/plugins&gt;\n    &lt;/pluginManagement&gt;\n    &lt;plugins&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;io.github.zlika&lt;/groupId&gt;\n        &lt;artifactId&gt;reproducible-build-maven-plugin&lt;/artifactId&gt;\n      &lt;/plugin&gt;\n    &lt;/plugins&gt;\n  &lt;/build&gt;\n&lt;/project&gt;\n\n</code></pre>\n"},{"tags":["java","spring-boot","apache-camel","junit5"],"comments":[{"owner":{"user_id":1540177,"display_name":"grekier"},"edited":false,"comment_id":132359825,"body":"You could use the <code>template.sendBody</code> method"},{"owner":{"user_id":20825594,"display_name":"John"},"edited":false,"comment_id":132359872,"body":"I have a predicate checking headers so I need to send headers, what difference is there between template.sendBody and         template.sendBodyAndHeaders? Issue seems to be that when I mock the endpoint with &quot;mock:&quot; in test class it does not puck up the .to() endpoint - I manually added the &quot;mock:&quot; into the route as well and it worked but I am sure this is not the proper way.."},{"owner":{"user_id":20825594,"display_name":"John"},"edited":false,"comment_id":132360270,"body":"Believe I may need to use Advice with not sure how to implement..."}],"answers":[{"owner":{"user_id":1540177,"display_name":"grekier"},"up_vote_count":1,"is_accepted":false,"creation_date":1672837733,"answer_id":75005927,"body":"<p>Here is an example with route advice. Note that you probably will need to do some cleanup after your test to reset the data!</p>\n<p>A bit older code in kotlin but should get the idea:</p>\n<pre><code>@SpringBootTest\nclass YourTest {\n    @Autowired\n    private lateinit var camelContext: CamelContext\n\n    @Autowired\n    private lateinit var template: ProducerTemplate\n\n    // No MockEndpoints\n\n    ...\n\n    @Throws(Exception::class)\n    private fun configureMockEndpoint() {\n        AdviceWith.adviceWith(\n            camelContext,\n            &quot;yourRouteId&quot;\n        ) { adviceWithRouteBuilder: AdviceWithRouteBuilder -&gt;\n            adviceWithRouteBuilder.replaceFromWith(&quot;direct:test&quot;)\n        }\n    }\n\n    @Test\n    fun yourTest() {\n        configureMockEndpoint()\n        template.sendBodyAndHeader(&quot;direct:test&quot;, &quot;Your headers&quot;, &quot;&quot;&quot;\n            your content\n        &quot;&quot;&quot;.trimIndent())\n        // asserts\n        // cleanups\n    }\n\n}\n</code></pre>\n"}],"owner":{"user_id":20825594,"display_name":"John"},"view_count":192,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1672825475,"question_id":75003600,"body":"<p>am writing a camel route test case but am getting this issue,  have also included the camel route. Have debugged looks like the object is flowing through properly but on my assertion it seems to fail...</p>\n<blockquote>\n<p>java.lang.AssertionError:\nmock://seda:processMessage?blockWhenFull=true Received message count.\nExpected: &lt;1&gt; but was: &lt;0&gt;</p>\n</blockquote>\n<pre><code>import java.math.BigDecimal;\nimport java.util.HashMap;\nimport java.util.Map;\n\nimport org.apache.camel.EndpointInject;\nimport org.apache.camel.ProducerTemplate;\nimport org.apache.camel.component.mock.MockEndpoint;\nimport org.apache.camel.test.spring.MockEndpoints;\nimport org.apache.camel.test.spring.junit5.CamelSpringBootTest;\nimport org.junit.jupiter.api.Test;\nimport org.mockito.Mock;\nimport org.mockito.Mockito;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\n\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.sams.pricing.prism.data.processor.model.CostIQRetail;\nimport com.sams.pricing.prism.data.processor.service.RulesEngineClient;\nimport com.sams.pricing.prism.data.processor.util.Endpoints;\n\n\n\n@SpringBootTest\n@CamelSpringBootTest\n@MockEndpoints( Endpoints.SEDA_PROCESS_ENDPOINT)\npublic class CamelRouteTests3  {\n\n\n    \n\n        @Autowired\n        private ProducerTemplate template;\n\n        @EndpointInject(&quot;mock:&quot;+ Endpoints.SEDA_PROCESS_ENDPOINT)\n        private MockEndpoint mock;\n\n        @Mock\n        private RulesEngineClient rulesEngineClientMock;\n\n    \n    \n\n    public CostIQRetail costIQObject() {\n\n        CostIQRetail obj = new CostIQRetail();\n\n        obj.setItemNbr(123);\n        obj.setLocationNbr(4931);\n        obj.setIsDcFlag(false) ;\n        obj.setStatus(&quot;SUCCESS&quot;);\n        obj.setOrderableCost(new BigDecimal((10.0)));\n        obj.setWarehousePackCost(new BigDecimal(100.0));\n        obj.setOrderablePrepaidCost(null) ;\n        obj.setOrderableCollectCost(null) ;\n        obj.setReasonCode(&quot;Markdown - category funded&quot;);\n        obj.setEffectiveDate(&quot;2022-12-29&quot;);\n        obj.setIsFutureEffectiveDate(false);\n        obj.setCostType(&quot;WAREHOUSE PACK COST&quot;);\n        obj.setSource(&quot;COST IQ&quot;);\n        obj.setCreatedBy(&quot;lab1 account&quot;);\n        obj.setCreatedByUserId(&quot;LB-cost-test&quot;);\n        obj.setCreatedTs(&quot;2022-12-29T02:42:25.529Z&quot;);\n        obj.setCurrentRetailPrice(new BigDecimal(55.0)) ;\n        obj.setCurrentOrderableCost(null);\n        obj.setCurrentWarehousePackCost(new BigDecimal((0.0)));\n        obj.setCurrentOrderablePrepaidCost(null) ;\n        obj.setCurrentOrderableCollectCost(null);\n        obj.setMarginChange(new BigDecimal((-100.0)));\n        obj.setOwedToClub(new BigDecimal((0.0))); \n        obj.setItemSourceId(3572924); \n        obj.setPriceDestId(701800);\n        obj.setCategory(87);\n        obj.setOrderableQty(null);\n        obj.setOldMargin(new BigDecimal((100.0)));\n        obj.setNewMargin(new BigDecimal(0.0));  \n\n        return obj;\n    }\n\n    private String costIQPayloadString() throws JsonProcessingException\n    {\n\n         String key =  &quot;{\\&quot;retailTypeReasonCode\\&quot;:{\\&quot;retailTypeReasonCodeId\\&quot;:{\\&quot;retailType\\&quot;:\\&quot;BP\\&quot;,\\&quot;retailReasonCode\\&quot;:\\&quot;CC\\&quot;}},\\&quot;expirationDate\\&quot;:null,\\&quot;customerRetailAmount\\&quot;:0.0,\\&quot;auditMessage\\&quot;:null,\\&quot;createdTimestamp\\&quot;:null,\\&quot;clientID\\&quot;:\\&quot;COST IQ\\&quot;,\\&quot;rowNumber\\&quot;:0,\\&quot;auditRecordTimestamp\\&quot;:null,\\&quot;clubNumber\\&quot;:4931,\\&quot;itemNumber\\&quot;:123,\\&quot;effectiveDate\\&quot;:\\&quot;2022-12-29\\&quot;,\\&quot;submissionID\\&quot;:null,\\&quot;retailAmount\\&quot;:55.0,\\&quot;createdBy\\&quot;:\\&quot;lab1 account\\&quot;}&quot;;\n    //   String key2 = &quot;{\\&quot;retailTypeReasonCode\\&quot;:{\\&quot;retailTypeReasonCodeId\\&quot;:{\\&quot;retailType\\&quot;:\\&quot;BP\\&quot;,\\&quot;retailReasonCode\\&quot;:\\&quot;CC\\&quot;}},\\&quot;expirationDate\\&quot;:null,\\&quot;customerRetailAmount\\&quot;:0.0,\\&quot;auditMessage\\&quot;:null,\\&quot;createdTimestamp\\&quot;:null,\\&quot;clientID\\&quot;:\\&quot;COST IQ\\&quot;,\\&quot;rowNumber\\&quot;:0,\\&quot;auditRecordTimestamp\\&quot;:null,\\&quot;categoryId\\&quot;:87,\\&quot;subCategoryId\\&quot;:1,\\&quot;clubNumber\\&quot;:4931,\\&quot;itemNumber\\&quot;:123,\\&quot;effectiveDate\\&quot;:\\&quot;2022-12-29\\&quot;,\\&quot;submissionID\\&quot;:null,\\&quot;retailAmount\\&quot;:10.0,\\&quot;createdBy\\&quot;:\\&quot;lab1 account\\&quot;}&quot;;\n         return key;\n\n//      CostIQPayloadTransformer transformer = new CostIQPayloadTransformer();\n//      return transformer.payloadTransformer(costIQObject());\n    }\n\n\n    @Test\n     void test() throws Exception {\n        // Set up the mock endpoints\n        mock.expectedBodiesReceived(costIQPayloadString());\n        \n        //getMockEndpoint( mock  +  Endpoints.SEDA_PROCESS_ENDPOINT).expectedBodiesReceived(costIQPayloadString());\n\n\n        //**need to properly mock and return this value\n        Mockito.when(rulesEngineClientMock.validateRules((costIQObject()))).thenReturn(costIQObject());  //.thenR\n\n        Map&lt;String, Object&gt; headers = new HashMap&lt;&gt;();\n        headers.put(&quot;appName&quot;, &quot;costIQ&quot;);\n\n        //   Send the test message to the SEDA_SEND_ENDPOINT\n        template.sendBodyAndHeaders(Endpoints.SEDA_SEND_ENDPOINT, costIQObject(), headers);\n\n        //System.out.println(&quot;here &quot; +mock.());\n        mock.assertIsSatisfied();\n\n\n    \n    }\n\n\n\n}\n</code></pre>\n<p>(below is the camel route )</p>\n<pre><code> ThreadPoolExecutor executor = (ThreadPoolExecutor) Executors.newFixedThreadPool(2);\n    ExecutorService executorService =\n        MoreExecutors.getExitingExecutorService(executor, 100, TimeUnit.MILLISECONDS);\n\n    @SuppressWarnings(&quot;resource&quot;)\n    ThrottlingInflightRoutePolicy throttlingInflightRoutePolicy =\n        new ThrottlingInflightRoutePolicy();\n    throttlingInflightRoutePolicy.setMaxInflightExchanges(150);\n    throttlingInflightRoutePolicy.setResumePercentOfMax(25);\n\n    // Camel's error handler that will attempt to redeliver the message 3 times\n    errorHandler(deadLetterChannel(&quot;seda:costIqDeadLetterChannel&quot;)\n                    .maximumRedeliveries(3)\n                    .redeliveryDelay(3000)\n    );\n\n    // SEDA Endpoint Stage Event Driven Architecture\n    from(Endpoints.SEDA_SEND_ENDPOINT)\n        .messageHistory()\n        // Route Name\n        .routeId(Endpoints.SEDA_SEND_ENDPOINT)\n\n        // multicast\n        .multicast()\n        .parallelProcessing() // create parallel threads\n\n        // thread pool\n        .threads()\n        .executorService(executorService) // specific thread pool\n        .log(&quot;Camel Route Started Message Processing : - ${body}&quot;)\n\n        .choice()\n        .when(PrismUtility.costIQPredicate)\n        .circuitBreaker()\n        .inheritErrorHandler(true)\n        .bean(CostIQService.class, PrismConstants.CALCULATE_PRICE) // rules engine call\n        .bean(\n            CostIQPayloadTransformer.class,\n            PrismConstants.PAYLOAD_TRANSFORMER) // payload transformer\n        .to(\n            Endpoints.SEDA_PROCESS_ENDPOINT // consumer 1\n            )\n        .endCircuitBreaker()\n        .endChoice()\n\n        .log(&quot;Final :- ${body}&quot;)\n        .end();\n</code></pre>\n<p>Edit :</p>\n<p>I modified the class like below by adding &quot;mock:&quot; to my route but  is there a way to go around this? seems like it is not sending to the proper endpoint without me changing and adding the &quot;mock:&quot; value to where it is sending</p>\n<p>Edit :</p>\n<p>I added in this peice of code - to try to use adviceWith in my test class. I am calling the endpoint like so</p>\n<pre><code>    getMockEndpoint(&quot;mock:&quot;+Endpoints.SEDA_PROCESS_ENDPOINT).expectedBodiesReceived(costIQPayloadString());\n</code></pre>\n<p>But am getting the error</p>\n<blockquote>\n<p>Cannot advice routes as there are no routes</p>\n</blockquote>\n<pre><code>   @Test\n    public void testReplaceFrom() throws Exception {\n        AdviceWith.adviceWith(context, Endpoints.SEDA_PROCESS_ENDPOINT, a -&gt; {\n            a.mockEndpoints(&quot;mock:&quot;+Endpoints.SEDA_PROCESS_ENDPOINT);\n        });\n        }\n</code></pre>\n"},{"tags":["java","spring-boot","java-8","cryptography","annotations"],"answers":[{"owner":{"user_id":13084140,"display_name":"Ryednap"},"up_vote_count":1,"is_accepted":false,"creation_date":1672729185,"answer_id":74989963,"body":"<p>You can use Java <code>Reflection API</code> to achieve the desired task. Assuming you have defined the Annotation <code>PIIData</code> yourself. Here's how you can implement the <code>apply</code> method. Also, define the <code>encryptValue</code> and <code>decryptValue</code> functions yourself.</p>\n<p>Also, I am assuming your Employee class looks like this</p>\n<pre class=\"lang-java prettyprint-override\"><code> class Employee {\n    @PIIData(value = &quot;Encrypt&quot;)\n    String name;\n    @PIIData(value=&quot;Decrypt&quot;)\n    String email;\n}\n</code></pre>\n<ol>\n<li>To intercept annotation first get all the fields defined by the <code>object</code> parameter in <code>apply</code> method using <code>Reflection API</code> then iterate through each field and check if it has some annotation using <code>isAnnotationPresent</code> function of <code>Reflection API</code> then you can check the value of the annotation and perform your code logic. You don't need to return back the object as <code>Reflection API</code> replaces the new value of the field in place.</li>\n<li>To make sure the method works define some tests.</li>\n<li>Yes you can pass values such as <code>Decrypt</code> and <code>Encrypt</code> to tell the <code>apply</code> method what to do.</li>\n</ol>\n<pre class=\"lang-java prettyprint-override\"><code>class Utility {\n    static void apply(Object object) throws IllegalAccessException {\n        Field[] fields = object.getClass().getDeclaredFields();\n\n\n        for (Field field : fields) {\n            if (field.isAnnotationPresent(PIIData.class)) {\n\n                Object fieldValue = field.get(object);\n                String annotationValue = field.getAnnotation(PIIData.class).value();\n\n                if (annotationValue.equals(&quot;Encrypt&quot;)) {\n                    // perform encryption\n                    String encryptedValue = encryptValue((String) fieldValue);\n                    // set the encryption through reflection API\n                    field.set(object, encryptedValue);\n\n                } else if (annotationValue.equals(&quot;Decrypt&quot;)) {\n                    // perform decryption;\n                    String decryptedValue = decryptValue((String) fieldValue);\n                    // set the decrypted value\n                    field.set(object, decryptedValue);\n                }\n            }\n        }\n    }\n\n    // define your encryption logic here\n    static String encryptValue(String value) {\n        return &quot;encrypted:&quot; + value;\n    }\n\n\n    // define your decryption logic here\n    static String decryptValue(String value) {\n        return &quot;decrypted: &quot; + value;\n    }\n}\n\n</code></pre>\n<p>Here's the test code for the above class methods</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class UtilityTest {\n    @Test\n    void testApplyMethod() throws IllegalAccessException {\n        Employee employee = new Employee(&quot;name&quot;, &quot;email&quot;);\n        Utility.apply(employee);\n        assertEquals(employee.name, &quot;encrypted:name&quot;);\n        assertEquals(employee.email, &quot;decrypted:email&quot;);\n    }\n}\n</code></pre>\n<p>Hope this helps.</p>\n"}],"owner":{"user_id":6309111,"display_name":"Dev-vruper"},"view_count":224,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1672727562,"question_id":74989755,"body":"<p>I want to identify PII fields of a class which are annotated with a custom annotation and then perform a encrypt/decrypt operation only on those fields and return the Class object .</p>\n<p>Explaination:</p>\n<ol>\n<li><p>Consider Class Employee .It has 3 fields .</p>\n<pre><code>    { \n     String name;\n     String email;\n     long phnNumber;\n     }\n</code></pre>\n</li>\n<li><p>Now I would write some custom annotation like @PIIData to identify which fields need encryption/decryption, and then annotate the fields with this annotation.</p>\n<pre><code>   { \n     @PIIData\n     String name;\n     @PIIData\n     String email;\n     long phnNumber;\n     }\n</code></pre>\n</li>\n<li><p>I now initialize object of Employee class with some values , and then pass this object to a encrypt/decrypt utility.</p>\n<p><strong>Pseudo Code :</strong></p>\n<pre><code>Employee emp = new Employee('Alice','alice@al.com',999);\nutility.apply(emp);\n</code></pre>\n</li>\n</ol>\n<p><strong>My Question :</strong></p>\n<ol>\n<li>How can I make sure that when we pass any object to <strong>utility.apply()</strong> which has fields annotated with @PIIData, this utility should intercept that, perform encrypt/decrypt operation only on the annotated fields, and then return back same object to the caller?</li>\n<li>Can I pass some value in the custom annotation so that we can explicitly tell utility to encrypt/decrypt ?</li>\n</ol>\n<blockquote>\n<p>eg @PIIData(value=&quot;Encrypt&quot;)</p>\n</blockquote>\n"},{"tags":["java","spring-boot","cassandra","datastax","cql"],"comments":[{"owner":{"user_id":2415194,"display_name":"nachokk"},"edited":false,"comment_id":134508225,"body":"what cass version are you using?"}],"answers":[{"owner":{"user_id":18627,"display_name":"Alex Ott"},"up_vote_count":0,"is_accepted":false,"creation_date":1684350285,"answer_id":76275432,"body":"<p>TTL is bound to a specific cell, so when you're updating only specific columns, then only them are updated. To update everything, you need to update all values</p>\n"}],"owner":{"user_id":10976839,"display_name":"Martin Dardis"},"view_count":16,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1684349043,"question_id":76275293,"body":"<p>i'm trying to update a column value (not key column) and to set new TTL for the whole row.\nBut when i execute the generated statement, only column ttl was updates and the other columns remain with the original, producing NULL values in future reads.</p>\n<p>My app was written in Java and using datastax for querying, and the function for generating the statement is something like this.</p>\n<pre class=\"lang-java prettyprint-override\"><code>private Statement updateLastActivityStatement(int ttl, Long ts){\n    return QueryBuilder.update(KEY_SPACE, TABLE_NAME)\n        .with(QueryBuilder.set(LAST_ACTIVITY, ts))\n        .where(QueryBuilder.eq(ENTRY_ID, userA))\n        .and(QueryBuilder.eq(ID, userB))\n        .using(QueryBuilder.ttl(ttl));\n}\n</code></pre>\n"},{"tags":["java","postgresql","spring-boot","hibernate"],"owner":{"user_id":19681717,"display_name":"axxa"},"view_count":17,"up_vote_count":2,"answer_count":0,"score":2,"creation_date":1684334469,"question_id":76273331,"body":"<p>I'm very new to Spring Boot.</p>\n<p>I have an entity that basically is a kind of &quot;tier list&quot;. It is used as a ranking of objects. Multiple objects could be in the same rank.</p>\n<p>So I represent it as HashMap&lt;Integer, LinkedList&lt;ObjectsToRank&gt;&gt;. The map key is the rank, associated with list of ObjectsToRank.</p>\n<p>Tier list entity:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Table(name = &quot;classements&quot;)\npublic class ClassementEntity {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(name = &quot;id_classement&quot;)\n    private  Long id_classement;\n\n    @ManyToOne\n    @JoinColumn(name = &quot;id_agent&quot;)\n    private AgentEntity agent;\n\n    @Column(name = &quot;max_rank&quot;)\n    private Integer max_rank;\n    \n    private HashMap&lt;Integer, LinkedList&lt;PeriodeProtocolaireEntity&gt;&gt; mapRang;\n\n}\n</code></pre>\n<p>So my question is how can I store it in my PostgreSQL DB ?</p>\n<p>I thought about Jsonb column that would look like:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n    mapKeyInteger: [\n            PeriodeProtocolaireEntity.id,\n            PeriodeProtocolaireEntity.id,\n    ],\n    2: ...\n}\n</code></pre>\n<p>But I don't know how to do it in a good way with Spring Boot or if there is a better way.</p>\n"},{"tags":["java","java-11"],"comments":[{"owner":{"user_id":2657515,"display_name":"JonathanDavidArndt"},"edited":false,"comment_id":134503550,"body":"There should be minimal mocking for this one. I&#39;m sure this makes perfect sense to somebody, but Java has gotten a little weird in this area."},{"owner":{"user_id":40342,"display_name":"Joachim Sauer"},"edited":false,"comment_id":134503556,"body":"It&#39;s an anonymous subclass with an instance initializer block. It&#39;s a bad idea and it&#39;s often called <a href=\"https://stackoverflow.com/questions/1958636/what-is-double-brace-initialization-in-java\">Double Brace initialization</a> because it&#39;s often formatted as <code>new Something() {{ doThing }}</code>."},{"owner":{"user_id":2411243,"display_name":"Zabuzard"},"edited":false,"comment_id":134503573,"body":"Its called the double-brace (<i>anti</i>-)pattern. It creates an anonymous class and then has an initializer-block in it (which is executed during its construction). <code>new Foo(){...}</code> for the anonymous class and <code>{...}</code> inside it for an intializer block."},{"owner":{"user_id":40342,"display_name":"Joachim Sauer"},"edited":false,"comment_id":134503582,"body":"@JonathanDavidArndt the good news is that basically no one that understands it actively thinks this is a good idea. At least no one that I ever discussed this with."},{"owner":{"user_id":2411243,"display_name":"Zabuzard"},"edited":false,"comment_id":134503592,"body":"It was sometimes used before <code>Map.of(...)</code> and <code>List.of(...)</code> etc were a thing, because its shorter than writing it out properly. (Doesnt necessarily justify its use though)"},{"owner":{"user_id":2657515,"display_name":"JonathanDavidArndt"},"edited":false,"comment_id":134503600,"body":"Well, That is a relief anyway. Our instructors always warned us about using &quot;unusual programming features&quot; and it is so true."},{"owner":{"user_id":40342,"display_name":"Joachim Sauer"},"edited":false,"comment_id":134503603,"body":"@Zabuzard: yeah, but even then just creating your own helper method is much saner. Because the double-brace initializer always creates a new class with all the associated disadvantages."},{"owner":{"user_id":664577,"display_name":"Anthony Accioly"},"edited":false,"comment_id":134503677,"body":"Just to address the second question. Have  a look at <a href=\"https://stackoverflow.com/a/745769/664577\">stackoverflow.com/a/745769/664577</a> . To sum it up, the syntax in question is creating a serializable function (i.e., the underlying class implements both <code>Function</code> and <code>Serializable</code>)."},{"owner":{"user_id":2300597,"display_name":"peter.petrov"},"edited":false,"comment_id":134503735,"body":"@AnthonyAccioly Thanks all and thank you specifically."}],"owner":{"user_id":2300597,"display_name":"peter.petrov"},"view_count":40,"up_vote_count":3,"answer_count":0,"score":2,"creation_date":1684334062,"question_id":76273274,"body":"<p>I will probably be mocked at but I don't understand this syntax.</p>\n<p>What does that mean?</p>\n<pre><code>new HashMap&lt;String, Function&lt;String, LocalDateTime&gt;&gt;() {\n                        {\n                            Function&lt;String, LocalDateTime&gt; dateParser = (Function&lt;String, LocalDateTime&gt; &amp; Serializable) (\n                                    dateText) -&gt; {\n                                return LocalDateTime.parse(dateText, DateTimeFormatter.ofPattern(&quot;yyyy-M-d'T'HH:mm:ss.SSS&quot;);\n                            };\n\n                            put(&quot;messageDate&quot;, dateParser);\n                        }\n}\n</code></pre>\n<p>This whole thing is passed in as an argument to a method  where a <code>HashMap&lt;String, Function&lt;String, LocalDateTime&gt;&gt;</code> parameter is expected.</p>\n<ol>\n<li>Does it mean we are sub-classing <code>HashMap&lt;String, Function&lt;String, LocalDateTime&gt;&gt;</code> somehow in-place, and somehow calling implicitly a class or an instance constructor or something like that?</li>\n</ol>\n<p>I don't get this syntax. Please someone more knowledgeable explain and point me to some docs.</p>\n<ol start=\"2\">\n<li>I don't get this part too.<br />\n<code>(Function&lt;String, LocalDateTime&gt; &amp; Serializable)</code><br />\nWhat does that mean as well?</li>\n</ol>\n<p>In which version of Java was this syntax introduced?</p>\n<p>It is legacy code written by someone else which we are using in our BigData/Spark projects. I was debugging it last night (or actually rather staring at it), and then realized I don't really understand even the syntax of this.</p>\n"},{"tags":["java","spring-boot","nullpointerexception"],"comments":[{"owner":{"user_id":7218656,"display_name":"Arun Sudhakaran"},"edited":false,"comment_id":134511374,"body":"Does this answer your question? <a href=\"https://stackoverflow.com/questions/218384/what-is-a-nullpointerexception-and-how-do-i-fix-it\">What is a NullPointerException, and how do I fix it?</a>"},{"owner":{"user_id":7218656,"display_name":"Arun Sudhakaran"},"edited":false,"comment_id":134511389,"body":"Please do a debug and see whether <code>projetRepository</code> is null or not"}],"owner":{"user_id":16251325,"display_name":"Moe_blg"},"view_count":47,"up_vote_count":2,"answer_count":0,"score":2,"creation_date":1684331488,"question_id":76272883,"body":"<p>I'm trying to add an entity Projet which has a list property of another entity Sprint. These are the two entities</p>\n<p>Projet:</p>\n<pre><code>import com.fasterxml.jackson.annotation.JsonIgnore;\nimport lombok.AllArgsConstructor;\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\nimport lombok.Setter;\n\nimport javax.persistence.*;\nimport java.util.List;\n\n@AllArgsConstructor\n@NoArgsConstructor\n@Entity\n@Getter\n@Setter\npublic class Projet {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private int id;\n    private String title;\n    private String description;\n    @ManyToMany(mappedBy = &quot;projets&quot;)\n    private List&lt;User&gt; users;\n    @OneToMany(mappedBy = &quot;projet&quot;)\n    @JsonIgnore\n    private List&lt;Sprint&gt; sprints;\n}\n</code></pre>\n<p>Sprint:</p>\n<pre><code>import com.fasterxml.jackson.annotation.JsonIgnore;\nimport lombok.AllArgsConstructor;\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\nimport lombok.Setter;\n\nimport javax.persistence.*;\nimport java.util.Date;\n\n@Entity\n@Getter\n@Setter\n@AllArgsConstructor\n@NoArgsConstructor\npublic class Sprint {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private int id;\n    private String description;\n    @Temporal(TemporalType.DATE)\n    private Date startDate;\n    @ManyToOne\n    @JsonIgnore\n    private Projet projet;\n}\n</code></pre>\n<p>I have a repository interface, ProjetRepository:</p>\n<pre><code>import org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\nimport tn.esprit.spring.entities.Projet;\n\n@Repository\npublic interface ProjetRepository extends JpaRepository&lt;Projet, Integer&gt; {\n}\n</code></pre>\n<p>A service interface, IProjetService:</p>\n<pre><code>import tn.esprit.spring.entities.Projet;\n\npublic interface IProjetService {\n    public Projet addProject (Projet project);\n}\n</code></pre>\n<p>And a service implementation class, ProjetService:</p>\n<pre><code>import org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport tn.esprit.spring.entities.Projet;\nimport tn.esprit.spring.entities.Sprint;\nimport tn.esprit.spring.repositories.ProjetRepository;\n\nimport java.util.List;\n\n@Service\npublic class ProjetService implements IProjetService{\n    @Autowired\n    ProjetRepository projetRepository;\n    @Override\n    public Projet addProject(Projet projet) {\n        List&lt;Sprint&gt; sprints = projet.getSprints();\n        for ( Sprint sprint: sprints) {\n            sprint.setProjet(projet);\n        }\n        return projetRepository.save(projet);\n    }\n}\n</code></pre>\n<p>This is the controller, ProjetController:</p>\n<pre><code>import lombok.RequiredArgsConstructor;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport tn.esprit.spring.entities.Projet;\nimport tn.esprit.spring.services.IProjetService;\n\n@RequiredArgsConstructor\n@RequestMapping(&quot;/projet&quot;)\n@RestController\npublic class ProjetController {\n    @Autowired\n    IProjetService projetService;\n    @PostMapping(&quot;/addProjet&quot;)\n    public Projet addProject (@RequestBody Projet project){\n        return projetService.addProject(project);\n    }\n}\n</code></pre>\n<p>This is the test application, SpringTestApplication:</p>\n<pre><code>import org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.boot.autoconfigure.domain.EntityScan;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.data.jpa.repository.config.EnableJpaRepositories;\n\n@SpringBootApplication\n\n@EntityScan(basePackages = {&quot;tn.esprit.spring.entities&quot;})\n@ComponentScan(basePackages = {&quot;tn.esprit.spring.controllers&quot;, &quot;tn.esprit.spring.services&quot;\n        , &quot;tn.esprit.spring.repositories&quot;})\n\n@EnableJpaRepositories(basePackages = {&quot;tn.esprit.spring.repositories&quot;})\n\npublic class SpringTestApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringTestApplication.class, args);\n    }\n\n}\n</code></pre>\n<p>When testing the addProjet method on Postman on this url using Post method http://localhost:8085/Exam/projet/addProjet using this request body:</p>\n<pre><code>{\n    &quot;title&quot;: &quot;MAP&quot;,\n    &quot;description&quot;: &quot;Gestion de Mandats, Assignations et Projets&quot;,\n    &quot;sprints&quot;: [\n        {\n            &quot;description&quot;: &quot;Sprint Projets&quot;,\n            &quot;startDate&quot;: &quot;2023-05-27&quot;\n        }\n    ]\n}\n</code></pre>\n<p>In Postman response body:</p>\n<pre><code>{\n    &quot;timestamp&quot;: &quot;2023-05-17T13:45:51.279+00:00&quot;,\n    &quot;status&quot;: 500,\n    &quot;error&quot;: &quot;Internal Server Error&quot;,\n    &quot;path&quot;: &quot;/Exam/projet/addProjet&quot;\n}\n</code></pre>\n<p>In IDE console:</p>\n<pre><code>java.lang.NullPointerException: null\n    at tn.esprit.spring.services.ProjetService.addProject(ProjetService.java:21) ~[classes/:na]\n    at tn.esprit.spring.controllers.ProjetController.addProject(ProjetController.java:20) ~[classes/:na]\n</code></pre>\n<p>Which points to here:</p>\n<pre><code>return projetRepository.save(projet);\n</code></pre>\n<p>I really don't understand what the issue is, could anyone please help ?</p>\n<p>EDIT: I also get this error in console: <code>2023-05-17 14:56:42.938 ERROR 8448 --- [nio-8085-exec-4] o.a.c.c.C.[.[.[.[dispatcherServlet]      : Servlet.service() for servlet [dispatcherServlet] in context with path [/Exam] threw exception [Request processing failed; nested exception is java.lang.NullPointerException] with root cause</code></p>\n"},{"tags":["java","c","math","java-8","java-17"],"comments":[{"owner":{"user_id":1774084,"display_name":"M. Yousfi"},"edited":false,"comment_id":134482190,"body":"Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"},{"owner":{"user_id":5133585,"display_name":"Sweeper"},"edited":false,"comment_id":134482223,"body":"Are you talking about <a href=\"https://openjdk.org/jeps/306\" rel=\"nofollow noreferrer\">JEP 306</a>?"},{"owner":{"user_id":4790924,"display_name":"Sharon Ben Asher"},"edited":false,"comment_id":134482228,"body":"how can math calculations have different valid results?"},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134482332,"body":"@SharonBenAsher Older Java version used shortcuts/different calculations (at least on x86) for floating point operations for historic reasons (e.g. it was slower to use strictly conforming calculations on some hardware), and only formally complied with the IEEE-754 standard if you tagged the variables with the <code>strictfp</code> keyword. This changed in Java 17 with <a href=\"https://openjdk.org/jeps/306\" rel=\"nofollow noreferrer\">JEP-306</a>, the default behaviour is now the same as the strictfp behaviour."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134482342,"body":"@SharonBenAsher Given the shortcuts used can result in slightly different values, and if you then consider compound error, the results between the old default behaviour and the strict behaviour can result in larger deviations."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134482371,"body":"OP, why can&#39;t you accept that the math behaviour changed and move on?"},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134482674,"body":"I added an example, and added a sentence to explain the motivation."},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134482864,"body":"@MarkRotteveel the example provided is also valid for java 11, means: java 11 also produces a different result than java 8. So there was something introduced even earlier."},{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134482913,"body":"You should be able to &quot;Any ideas how the same math behaviour can be achieved?&quot; You should be able to use <code>StrictMath</code> instead of <code>Math</code> and get the same results for both jdks."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134482931,"body":"I&#39;m going to go out on a limb and guess that in Java 11 (or earlier) they made some changes which affected the non-strict floating point operations, and instead of changing it back (it likely still complied with the spec), they decided to ditch that non-strict behaviour entirely through JEP-306, so they now only have behaviour that complies with the IEEE-754 standard."},{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134482954,"body":"@MarkRotteveel from your description it seems like <code>Math.exp</code> and <code>StrictMath.exp</code> should be the same for java 17 but different for java 8. That&#39;s not what I get though."},{"owner":{"user_id":466862,"display_name":"Mark Rotteveel"},"edited":false,"comment_id":134483062,"body":"@matt Interesting, I&#39;m not sure if that is a bug or just a deviation allowed by the spec. Given <code>Math.exp(...)</code> delegates to <code>StrictMath.exp(...)</code>, I guess it should have the same result, but <code>Math.exp(...)</code> can be replaced with an intrinsic at runtime, while <code>StrictMath.exp(...)</code> cannot."},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134483172,"body":"@matt yes, it is a good idea to use StrictMath in the future or any other math library which ensures consistency across versions and platforms.  For now it doesn&#39;t solve the problem because StrictMath doesn&#39;t deliver the same results like java 8 Math. Check with exp function and number 1.0d"},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134483225,"body":"@MarkRotteveel yes that&#39;s also my best guess... and yes, java.lang.Math delegates to java.lang.StrictMath, BUT because of intrinsic functions the jvm can do something different during runtime to improve performance (e.g. call native code)  see also this list:  <a href=\"https://chriswhocodes.com/hotspot_intrinsics_openjdk8.html\" rel=\"nofollow noreferrer\">chriswhocodes.com/hotspot_intrinsics_openjdk8.html</a>"},{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134483237,"body":"@Nik java 8 uses StrictMath for the Math.exp, I don&#39;t get how it can produce a different result, but I tried <code>a=1.0d;</code> and <code>Math.exp(a)</code> and <code>StrictMath.exp(a)</code> They&#39;re different. java 17 makes sense because it has the intrisic anotation. It&#39;s strange for java 8. So far though all three jdk&#39;s I try produce the same strict math results."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134483291,"body":"Can not reproduce your problem with <code>1.0</code>. On my machine, <code>StrictMath</code> produces the same results from Java 8 to Java 21."},{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134483311,"body":"@Holger 1.0 gives different results for Math and StrictMath, that means java 21 StrictMath cannot be used for java 8 Math. The <code>0.003978202863827189</code> example gives a different result for java 17 Math and java 8 Math."},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134483319,"body":"@Holger maybe a misunderstanding: StrictMath produces the same result across jdks, but not the same result like the Math counterpart. Example:  JVM VERSION: 17.0.6 Input number: 1.0 Math result (java.lang.Math.exp):  -&gt; 2.718281828459045 StrictMath result (java.lang.StrictMath.exp):  -&gt; 2.7182818284590455"},{"owner":{"user_id":845414,"display_name":"Johannes Kuhn"},"edited":false,"comment_id":134483329,"body":"@matt Java 8 does not necessarily annotate hotspot intrinsic methods. Those methods can replace a pure java method. (And if you change one, but not the other...). Anyway, <code>Math.pow()</code> is a hotspot intrinsic since java 6."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134483475,"body":"I don’t understand where you’re heading at. If you want consistent results across all versions, use <code>StrictMath</code>. In all versions. Of course, it does not (always) produce the same results as <code>Math</code>. If it did, what would be the point of having two classes?"},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134483733,"body":"@Holger we have old code that uses java.lang.Math written for java 8. The same code must now run on java 17. The question is how can the same math behavior on java 8 be achieved on java 17 (or even other java versions). java.lang.Math could be only one part of the problem, e.g. I don&#39;t know if also math operators like +, -, /, * changed behaviour. The question how to avoid these problems in the future (e.g. use StrictMath) is a different topic."},{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134483817,"body":"Did you consider building the JDK? Then you should see the options use to build the library."},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134483953,"body":"@matt I downloaded open-jdk8u and open-jdk17u source repositories. That&#39;s how I started my research and I already found out a lot, like the intrinsic functions and usage of fdlibm. But it&#39;s a huge code base and I couldn&#39;t figure out how the math parts are built yet."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134483970,"body":"No, the arithmetic operations did not change their behavior. You tripped over <a href=\"https://bugs.openjdk.org/browse/JDK-8132207\" rel=\"nofollow noreferrer\">a single optimization</a> and if the application really depends on the last bit of a 64 bit floating point result, there’s a much deeper problem. And if you really consider changing the behavior of the JDK/JVM to be more feasible than fixing your own code, I’d rethink whether your code really “must now run on java 17”."},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134484301,"body":"Thanks for the hints (arithmetic operations, exp optimization)! Compound errors can amplify the problem. I don&#39;t want to build a special version of java 17 - a (JNI?) library with the same behaviour would be sufficient. And of course in the future the code must use something more portable - this is already planned. I&#39;m looking for a possibility to calculate old data with the old behaviour and newer data with the portable/standard behaviour. There are a lot reasons java 17 must be used in the future, e.g. overall performance, long term support/security patches, features to name a few..."},{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134485185,"body":"@Nik yes, it is a monster, the ones I look at have pretty good instructions for building the jdk. I would suggest building it. Making sure it produces the results you want. You&#39;ll also be able to find the lib&#39;s you needs, and the commands used to build them with tools like <code>find</code> and <code>grep</code>"},{"owner":{"user_id":37213,"display_name":"duffymo"},"edited":false,"comment_id":134485680,"body":"You assume that the JDK 8 Math behavior is correct.  That might not be the case.  I&#39;d go for the JDK 17 StrictMath results."},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134486615,"body":"Writing that hypothetical JNI library still would be more effort than just using <code>StrictMath</code>. And why do you think about “performance, long term support/security patches, etc” when you’re going to throw it all away by introducing a new JNI library to your code that will kill the performance and likely introduce bugs and security holes."},{"owner":{"user_id":740553,"display_name":"Mike &#39;Pomax&#39; Kamermans"},"edited":false,"comment_id":134488929,"body":"I’m voting to close this question because while there is an inconvenient here, there is no <i>problem</i> here, IEEE floating points decimals are explicitly inaccurate, and code that relies on precision in the last few decimals but also uses IEEE floating point decimals is using the wrong datatype entirely: those decimals are guaranteed to almost never be right no matter which version of java (or any other programming language) you use. You don&#39;t try to fix Java 17, you should <i>really</i> fix your code."},{"owner":{"user_id":3169867,"display_name":"Nik"},"edited":false,"comment_id":134489200,"body":"I don&#39;t assume java 8 Math is &quot;correct&quot;. The discussion is not about mathematical correctness. And like I said StrictMath and/or other datatypes is the way to go in the future. I also don&#39;t try to &quot;fix&quot; java 17 everything is fine there.  I&#39;m looking for a possibility to achieve the same outcome in the math computations for legacy code and data there already is. This old stuff will slowly fade away after some years.  I couldn&#39;t figure out how to extract the math behaviour of the jdk source and therefore asked the community"},{"owner":{"user_id":2711488,"display_name":"Holger"},"edited":false,"comment_id":134490554,"body":"There is an easy way to keep to the outcome of the legacy code the same. Keep running the legacy code with the legacy Java version. It’s ok, if you don’t want to touch that code (and rather let it fade away). But then, don’t touch the code."},{"owner":{"user_id":2067492,"display_name":"matt"},"edited":false,"comment_id":134512524,"body":"If you look at the included libraries in java 8 you can find that <code>liblcms.so</code> contains math symbols. One of them being <code>U exp@GLIBC_2.2.5</code>  There is also the StrictMath exp reference, but I think it is refering to the GLIBC one."}],"answers":[{"owner":{"user_id":908621,"display_name":"fishinear"},"up_vote_count":2,"is_accepted":false,"creation_date":1684234025,"answer_id":76262142,"body":"<p>When comparing floating point numbers, you should ALWAYS take the accuracy of the numbers involved into account. That accuracy is almost always much less than the accuracy of the floating point representation. So it should not matter for your results whether the mathematical operations have become a tiny bit more accurate.</p>\n<p>Therefore, when &quot;checking if results were calculated correctly&quot;, take the accuracy of the results into account.</p>\n"}],"owner":{"user_id":3169867,"display_name":"Nik"},"view_count":169,"up_vote_count":4,"answer_count":1,"score":2,"creation_date":1684223160,"question_id":76260498,"body":"<p>We have an growing codebase which also involves doing math calculations on data and store them historically. Now we need to move on and migrate from Java 8 to Java 17 but we noticed the calculation results are different in Java 17! The reason why we try to achieve the same calculation behaviour is because of possible recalculations and historical comparison of data (check if results were calculated correctly in terms of new calculation equals the saved values).</p>\n<p>After a lot of research I already know, that Java 8 used optimizations like use more floating precision if available on a system. They use intrinsic functions which modify math operations during runtime for performance improvements. And they rely on fdlibm 5.3, a native c math library. In Java 17 they ported the fdlibm from c to java and use it at least in StrictMath, but still there are intrinsic functions which use native code.</p>\n<p>I think the key to achieve what I am trying is to understand how and with which options they compiled the native math code the intrinsic functions use.</p>\n<p>I built a JNI library which delegates functions like exp, log, sqrt etc. to native fdlibm. I tried different optimizations like -Ofast, but still the results are not exactly the same.</p>\n<p>Maybe the code for operators like division, multiply, plus and minus was also changed?</p>\n<p>I ran the tests on the same system so it should be comparable.</p>\n<p><strong>Any ideas how the math behaviour of java 8 can be extracted to use it for legacy calculations in java 17?</strong></p>\n<p>Example of different computation with Math.exp:</p>\n<pre><code>JVM VERSION: 1.8.0_362 \n--- Input number: 0.003978202863827189 \njava.lang.Math.exp       : 1.0039861264165226 \n\nJVM VERSION: 17.0.6\n--- Input number: 0.003978202863827189 \njava.lang.Math.exp       : 1.0039861264165224 \n</code></pre>\n<p>Example Code for the output above:</p>\n<pre><code>public class Exp {\n\n    public static void main(String[] args) {\n        System.out.println(System.getProperty(&quot;java.library.path&quot;));\n        \n        double input = Double.valueOf(args[0]);\n\n        System.out.println(&quot;JVM VERSION: &quot; + System.getProperty(&quot;java.version&quot;));\n        System.out.println(&quot;---&quot;);\n        System.out.println(&quot;Input number: &quot; + input);\n            \n        System.out.println(&quot;Math result (java.lang.Math.exp):&quot;);\n        System.out.println(&quot; -&gt; &quot; + Math.exp(input)); \n\n    }\n}\n</code></pre>\n"},{"tags":["java","spring","spring-boot","azure","project-reactor"],"owner":{"user_id":5160940,"display_name":"DockYard"},"view_count":34,"up_vote_count":2,"answer_count":0,"score":2,"creation_date":1684098758,"question_id":76249707,"body":"<p>I'm using Microsoft cosmos Nosql DB and a spring boot backend with the reactive cosmos client.</p>\n<p>Theres a container Person.java, and the backend application does CRUD operations on it.</p>\n<p>Below if existing code for it:</p>\n<pre><code>------------------------------------------------\nPerson.java\n------------------------------------------------\npackage com.cosmos.containers;\n\nimport com.azure.spring.data.cosmos.core.mapping.Container;\nimport com.azure.spring.data.cosmos.core.mapping.PartitionKey;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.springframework.data.annotation.Id;\nimport org.springframework.data.annotation.Version;\n\n@Container(containerName = &quot;Person&quot;)\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class Person extends DomainEntity {\n\n    @Id private String id;\n\n    @PartitionKey private String partitionKey;\n\n    private String name;\n}\n\n\n</code></pre>\n<pre><code>------------------------------------------------\nCosmosDBConfig.java\n------------------------------------------------\npackage com.cosmos.config;\n\nimport com.azure.core.credential.AzureKeyCredential;\nimport com.azure.cosmos.ConsistencyLevel;\nimport com.azure.cosmos.CosmosClientBuilder;\nimport com.azure.cosmos.DirectConnectionConfig;\nimport com.azure.cosmos.GatewayConnectionConfig;\nimport com.azure.spring.data.cosmos.config.AbstractCosmosConfiguration;\nimport com.azure.spring.data.cosmos.config.CosmosConfig;\nimport com.azure.spring.data.cosmos.repository.config.EnableReactiveCosmosRepositories;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\n@EnableReactiveCosmosRepositories(\n        basePackages = {&quot;com.cosmos.repositories&quot;})\n@Slf4j\npublic class CosmosDBConfig extends AbstractCosmosConfiguration {\n\n    private AzureKeyCredential azureKeyCredential;\n\n\n    @Override\n    protected String getDatabaseName() {\n        return &quot;MyDataBase&quot;;\n    }\n\n    @Bean\n    public CosmosClientBuilder cosmosDBClientBuilder() {\n        this.azureKeyCredential = new AzureKeyCredential(&lt;private key&gt;);\n        DirectConnectionConfig directConnectionConfig = new DirectConnectionConfig();\n        GatewayConnectionConfig gatewayConnectionConfig = new GatewayConnectionConfig();\n        return new CosmosClientBuilder()\n                .endpoint(&lt;url&gt;)\n                .credential(azureKeyCredential)\n                .consistencyLevel(\n                        ConsistencyLevel.valueOf(&quot;SESSION&quot;))\n                .multipleWriteRegionsEnabled(false)\n                .preferredRegions(&lt;my regions&gt;)\n                .directMode(directConnectionConfig, gatewayConnectionConfig);\n    }\n\n\n    @Override\n    public CosmosConfig cosmosConfig() {\n        return CosmosConfig.builder()\n                .enableQueryMetrics(true)\n                .maxDegreeOfParallelism(-1)\n                .build();\n    }\n\n\n}\n\n</code></pre>\n<pre><code>------------------------------------------------\nPersonRepository.java\n------------------------------------------------\n\npackage com.cosmos.repositories;\n\nimport com.azure.spring.data.cosmos.repository.ReactiveCosmosRepository;\n\n@Repository\npublic interface PersonRepository extends ReactiveCosmosRepository&lt;Person, String&gt; {\n\n}\n\n</code></pre>\n<pre><code>------------------------------------------------\nMyPersonService.java\n------------------------------------------------\n@Service\npublic class MyPersonService {\n    @Autowired\n    private PersonRepository repository;\n\n    public Person save(Person person) {\n        return repository.save(person);\n    }\n}\n\n</code></pre>\n<p>Now lets say I want to limit the usage of RUs for Person container to 1500 RUs/seconds using the ThroughputControlGroupConfig feature of java sdk in this code base(<a href=\"https://the9090rule.medium.com/controlling-an-applications-throughput-consumption-in-cosmos-db-with-throughputcontrolgroup-247cc0eafa92\" rel=\"nofollow noreferrer\">details docs of ThroughputControlGroupConfig can be found here</a>).</p>\n<p>How do I do this.</p>\n<p>More specifically I want to know how to I pass his ThroughputControlGroupConfig to the <code>PersonRepository</code> class</p>\n"},{"tags":["java","spring-boot","kotlin","spring-boot-test","testcontainers"],"comments":[{"owner":{"user_id":7979194,"display_name":"Nam Nguyễn"},"edited":false,"comment_id":134465450,"body":"IDK what do you want in here, you want to test what? If only you need to specific port: you can use profile test, or  @SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT) <a href=\"https://rieckpil.de/guide-to-springboottest-for-spring-boot-integration-tests/\" rel=\"nofollow noreferrer\">rieckpil.de/&hellip;</a>. like you did, but what&#39;s the point?"},{"owner":{"user_id":18112015,"display_name":"paui"},"edited":false,"comment_id":134465664,"body":"I want to expose the port spring uses for my testcontainer"},{"owner":{"user_id":7979194,"display_name":"Nam Nguyễn"},"edited":false,"comment_id":134466216,"body":"I will send you this <a href=\"https://www.baeldung.com/spring-boot-running-port\" rel=\"nofollow noreferrer\">baeldung.com/spring-boot-running-port</a>"},{"owner":{"user_id":1396362,"display_name":"Kevin Wittek"},"edited":false,"comment_id":134469023,"body":"Is this a Kotlin specific issue? Your pattern should generally work using the <code>@DynamicPropertySource</code>. If you use <code>container.withAccessToHost(true)</code>, you can also expose the host after the container started, see <a href=\"https://www.testcontainers.org/features/networking/#exposing-host-ports-to-the-container\" rel=\"nofollow noreferrer\">testcontainers.org/features/networking/&hellip;</a>."},{"owner":{"user_id":18112015,"display_name":"paui"},"edited":false,"comment_id":134470936,"body":"container.withAccessToHost(true) workaround solves the issue for me, then I can just expose the port in a beforeall. Thanks"}],"owner":{"user_id":18112015,"display_name":"paui"},"view_count":35,"up_vote_count":2,"answer_count":0,"score":2,"creation_date":1684097095,"question_id":76249595,"body":"<p>Im struggling with getting the &quot;spring&quot; generated random port for tests where it would be needed in a companion object for mapping my config to the proper testcontainer port</p>\n<pre><code>@SpringBootTest(classes = [Application::class], webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)\nclass Test {\n companion object {\n        @JvmStatic\n        @LocalServerPort\n        protected var testPort = 0\n\n        @JvmStatic\n        @DynamicPropertySource\n        fun registerProps(registry: DynamicPropertyRegistry) {\n            println(&quot;opening port $testPort &quot;)\n            TestContainers.exposeHostPorts(testPort)\n            OpsContainer.start()\n            registry.add(&quot;service.ops.port&quot;, testPort)\n        }\n    }\n\n  @Test\n  fun basicTest() {\n    .\n    .\n    .\n  }\n}\n</code></pre>\n<p>If I try and put LocalServerPort inside the companion object it wont initialize &quot;correctly&quot; but will have the default value of 0. If I move it out of the companion it &quot;works&quot; but then I cant bind my config to the spring port as that needs to happen in a companion.</p>\n<p>I have tried a few different combinations but seem to be in a position where a needs b, and at the same time, b depends on a.</p>\n"},{"tags":["java","maven","maven-3"],"owner":{"user_id":2898535,"display_name":"AnthonyA"},"view_count":29,"up_vote_count":2,"answer_count":0,"score":2,"creation_date":1683965816,"question_id":76241743,"body":"<p>In 3.9.0, Maven introduced <a href=\"https://maven.apache.org/resolver/remote-repository-filtering.html\" rel=\"nofollow noreferrer\">Remote Repository Filtering</a>.</p>\n<p>In theory, it sounds great:</p>\n<blockquote>\n<p>Imagine you can instruct Maven which repository can contain what artifact? Instead of “ordered loop” searching for artifacts in remote repositories, Maven could be instructed in controlled way to directly reach only the needed remote repository.</p>\n</blockquote>\n<p>Until you get to the fine print:</p>\n<blockquote>\n<p>Maven Central (MC) repository is special in this respect, as Maven will always try to get things from here, as your build, plugins, plugin dependencies, extension, etc. will most often come from here. While you CAN filter MC, filtering MC is most often a bad idea (filtering, as in “limiting what can come from it”). On other hand, MC itself offers help to prevent request leakage to it (see “prefixes” filter).</p>\n</blockquote>\n<blockquote>\n<p>So, most often limiting “what can be fetched” from MC is a bad idea, it can be done but in very, very cautious way, as otherwise you put your build at risk. RRF does not distinguish the “context” of an artifact, it merely filters them out by (artifact, remoteRepository) pair, and by limiting MC you can easily get into state where you break your build (as plugin depends on filtered artifact).</p>\n</blockquote>\n<p>I have a bunch of jars in a personal repository. Even though they are clearly marked as such inside my ~/.m2:</p>\n<pre><code>#NOTE: This is a Maven Resolver internal implementation file, its format can be \nchanged without prior notice.\n#Fri May 12 21:15:32 PDT 2023\nmy-commons-2.1.0.pom&gt;personal=\nmy-commons-2.1.0.jar&gt;personal=\n</code></pre>\n<p>Once I updated to 3.9.X, maven continually tries to get it from central:</p>\n<pre><code>[INFO] Artifact com.personal.space:my-commons:pom:2.1.0 is \npresent in the local repository, but cached from a remote repository ID that is \nunavailable in current build context, verifying that is downloadable from [central. \n(https://repo.maven.apache.org/maven2, default, releases)]\n</code></pre>\n<p>How exactly do I turn this off for my own personal repository? There's talks of filtering and what not on their docs, but I've fiddled and got nothing working.</p>\n"},{"tags":["java","spring-boot","oauth-2.0"],"owner":{"user_id":20918006,"display_name":"Sard"},"view_count":35,"up_vote_count":2,"answer_count":0,"score":2,"creation_date":1683956425,"question_id":76241253,"body":"<p>The implementation was to customize the endpoint to check the token in Oauth2 authorizarion server in spring which /oauth2/introspect Sample: <code>http://localhost:8080/oauth2/introspect?token=tokenValueHere&amp;client_id=client&amp;client_secret=secret</code> but the requirement is to check the token only without client_id and client_secret.</p>\n<p>Have try to customize it, the method <code>getAuthenticationProvider</code>\nBut when i try without client_id and client_secret it will  401 Unauthorized and the print <code>Going to this method</code> is not showing which mean the method is not being excuted, its being block.</p>\n<p>Would like to ask where to modified <code> /oauth2/introspect</code> to required without client_id and client_secret?</p>\n<pre><code>    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);\n        http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)\n                .tokenIntrospectionEndpoint(a -&gt; a.authenticationProvider(getAuthenticationProvider()));\n        \n\n        http.csrf().disable();\n        \n\n        return http.build();\n    }\n\n    private AuthenticationProvider getAuthenticationProvider() {\n    System.out.println(&quot;Going to this method&quot;);\n        return new AuthenticationProvider() {\n            @Override\n            public Authentication authenticate(Authentication authentication) throws AuthenticationException {\n            \n                if (authentication.getPrincipal() == null || authentication.getCredentials() == null) {\n                    return authentication;\n                }\n                throw new BadCredentialsException(&quot;Invalid credentials&quot;);\n            }\n            @Override\n            public boolean supports(Class&lt;?&gt; authentication) {\n                return OAuth2TokenIntrospectionAuthenticationToken.class.isAssignableFrom(authentication);\n            }\n        };\n</code></pre>\n<pre><code>    &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-oauth2-authorization-server&lt;/artifactId&gt;\n            &lt;version&gt;1.0.2&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre>\n"},{"tags":["java","maven","sonarqube","sonarqube-plugin"],"answers":[{"owner":{"user_id":6309,"display_name":"VonC"},"up_vote_count":0,"is_accepted":false,"creation_date":1684088992,"answer_id":76249080,"body":"<p><code>java.lang.NoClassDefFoundError: org/sonarsource/analyzer/commons/RuleMetadataLoader</code></p>\n<p>That means the required class is not found in the classpath during runtime.</p>\n<p>In your case, your custom SonarQube plugin is missing a dependency on the <code>sonar-analyzer-commons</code> library.<br />\nTry and add the dependency (<a href=\"https://mvnrepository.com/artifact/org.sonarsource.analyzer-commons/sonar-analyzer-commons\" rel=\"nofollow noreferrer\"><code>org.sonarsource.analyzer-commons » sonar-analyzer-commons</code></a>) to your custom plugin's <code>pom.xml</code> file.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependencies&gt;\n    ...\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.sonarsource.analyzer.commons&lt;/groupId&gt;\n        &lt;artifactId&gt;sonar-analyzer-commons&lt;/artifactId&gt;\n        &lt;version&gt;2.5.0.1358&lt;/version&gt; &lt;!-- Use the appropriate version that matches your SonarQube version --&gt;\n    &lt;/dependency&gt;\n    ...\n&lt;/dependencies&gt;\n</code></pre>\n<p>That library does include <a href=\"https://github.com/SonarSource/sonar-analyzer-commons/blob/master/commons/src/main/java/org/sonarsource/analyzer/commons/RuleMetadataLoader.java\" rel=\"nofollow noreferrer\"><code>RuleMetadataLoader.java</code></a>.</p>\n<hr />\n<p>The <a href=\"https://stackoverflow.com/users/3202325/ramgrg\">OP RamGrg</a> confirms in <a href=\"https://stackoverflow.com/questions/76229040/an-issue-occurred-while-starting-sonarqube-with-custom-java-maven-plugin/76249080#comment134472653_76249080\">the comments</a>:</p>\n<blockquote>\n<p>I have these inside <code>&lt;dependencyManagement&gt; &lt;dependencies&gt;....&lt;/dependencies&gt;&lt;/dependencyManagement&gt;</code>.</p>\n</blockquote>\n<p>And that the root cause of your issue.<br />\nLet's clarify the differences between <code>&lt;dependencies&gt;</code> and <code>&lt;dependencyManagement&gt;</code>:</p>\n<ol>\n<li><p><code>&lt;dependencies&gt;</code>: This section is used to declare the dependencies that your project needs. The libraries specified here will be included in the classpath during the build process.</p>\n</li>\n<li><p><code>&lt;dependencyManagement&gt;</code>: This section is used to manage the versions of dependencies in a multimodule project. When you declare dependencies inside the <code>&lt;dependencyManagement&gt;</code> tag, <strong>you are not actually including them in your project</strong>. Instead, you're specifying the versions that should be used if the project or its submodules were to include those dependencies.<br />\nIt's a way to ensure that all submodules use the same version of a dependency, thereby avoiding potential conflicts.</p>\n</li>\n</ol>\n<p>The issue in your case is likely due to the fact that the <code>sonar-analyzer-commons</code> dependency is declared inside <code>&lt;dependencyManagement&gt;</code>, but not in <code>&lt;dependencies&gt;</code>. This means that the dependency isn't actually being included in your build, leading to the <code>NoClassDefFoundError</code> you're seeing.</p>\n<p>To resolve this, you should move the <code>sonar-analyzer-commons</code> dependency from <code>&lt;dependencyManagement&gt;</code> to <code>&lt;dependencies&gt;</code>.<br />\nHere's how you can do this:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;project&gt;\n    ...\n    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;!-- other dependencies can be managed here, for instance: --&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;org.sonarsource.sonarqube&lt;/groupId&gt;\n                &lt;artifactId&gt;sonar-plugin-api&lt;/artifactId&gt;\n                &lt;version&gt;9.4.0.54424&lt;/version&gt;\n                &lt;scope&gt;provided&lt;/scope&gt;\n            &lt;/dependency&gt;\n            &lt;!-- declare other managed dependencies here... --&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n\n    &lt;dependencies&gt;\n        &lt;!-- Here is where you should declare sonar-analyzer-commons dependency --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.sonarsource.analyzer.commons&lt;/groupId&gt;\n            &lt;artifactId&gt;sonar-analyzer-commons&lt;/artifactId&gt;\n            &lt;version&gt;2.1.0.1111&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- declare other direct dependencies here... --&gt;\n    &lt;/dependencies&gt;\n    ...\n&lt;/project&gt;\n</code></pre>\n<p>In this <code>pom.xml</code>, the <code>sonar-analyzer-commons</code> dependency is declared outside the <code>&lt;dependencyManagement&gt;</code> section, meaning it will be included in the classpath during the build.</p>\n<p>In the <code>&lt;dependencyManagement&gt;</code> section, you're managing the version of <code>sonar-plugin-api</code> (and possibly other dependencies) to ensure that all submodules (if any) use the same version. But these dependencies won't be included in the classpath unless they're also declared in the <code>&lt;dependencies&gt;</code> section.</p>\n<hr />\n<p>Your <code>pom.xml</code> seems OK with respect to the <code>sonar-analyzer-commons</code> dependency. It is declared in the <code>&lt;dependencies&gt;</code> section, so it should be included in the classpath during the build. You might want to double-check your dependency versions to ensure compatibility, however.</p>\n<p>Here's an updated version of your <code>pom.xml</code>, with a potentially compatible <code>sonar-analyzer-commons</code> version. However, this is just a guess, since compatibility often involves more than one dependency. You might need to check the compatibility with other dependencies as well.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n  &lt;!-- ... rest of your pom.xml ... --&gt;\n  &lt;dependencies&gt;\n    &lt;!-- ... rest of your dependencies ... --&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.sonarsource.analyzer.commons&lt;/groupId&gt;\n      &lt;artifactId&gt;sonar-analyzer-commons&lt;/artifactId&gt;\n      &lt;version&gt;2.1.0.1111&lt;/version&gt; &lt;!-- Ensure this version is compatible with your SonarQube version --&gt;\n    &lt;/dependency&gt;\n    &lt;!-- ... rest of your dependencies ... --&gt;\n  &lt;/dependencies&gt;\n  &lt;!-- ... rest of your pom.xml ... --&gt;\n&lt;/project&gt;\n</code></pre>\n<p>In the updated version, I only changed the comment for the <code>sonar-analyzer-commons</code> dependency to highlight the need for compatibility with your SonarQube version.</p>\n<p>If you're still encountering the same issue, the problem might not be with the <code>pom.xml</code>. It could be related to the way your custom plugin is interacting with the SonarQube API, or it might be a problem with the SonarQube setup itself.</p>\n"}],"owner":{"user_id":3202325,"display_name":"RamGrg"},"view_count":57,"up_vote_count":2,"answer_count":1,"score":2,"creation_date":1683817229,"question_id":76229040,"body":"<p>I am creating a custom sonarqube java plugin. After adding the plugin jar file inside ../extensions/plugins folder, I tried to start sonarqube in my device. But it is showing the following issues:</p>\n<pre><code>Background initialization failed. Stopping SonarQube\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jdk.internal.loader.ClassLoaders$AppClassLoader@5ffd2b27-org.sonar.server.rule.RegisterRules': Initialization of bean failed; nested exception is java.lang.NoClassDefFoundError: org/sonarsource/analyzer/commons/RuleMetadataLoader\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:628)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:542)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:955)\n    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:918)\n    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:583)\n    at org.sonar.core.platform.SpringComponentContainer.startComponents(SpringComponentContainer.java:187)\n    at org.sonar.server.platform.platformlevel.PlatformLevel.start(PlatformLevel.java:80)\n    at org.sonar.server.platform.platformlevel.PlatformLevelStartup.access$001(PlatformLevelStartup.java:55)\n    at org.sonar.server.platform.platformlevel.PlatformLevelStartup$1.doPrivileged(PlatformLevelStartup.java:127)\n    at org.sonar.server.user.DoPrivileged.execute(DoPrivileged.java:45)\n    at org.sonar.server.platform.platformlevel.PlatformLevelStartup.start(PlatformLevelStartup.java:124)\n    at org.sonar.server.platform.PlatformImpl.executeStartupTasks(PlatformImpl.java:183)\n    at org.sonar.server.platform.PlatformImpl$AutoStarterRunnable.runIfNotAborted(PlatformImpl.java:344)\n    at org.sonar.server.platform.PlatformImpl$1.doRun(PlatformImpl.java:107)\n    at org.sonar.server.platform.PlatformImpl$AutoStarterRunnable.run(PlatformImpl.java:328)\n    at java.base/java.lang.Thread.run(Thread.java:833)\nCaused by: java.lang.NoClassDefFoundError: org/sonarsource/analyzer/commons/RuleMetadataLoader\n    at com.plugins.sonar.java.SonarqubeJavaRulesDefinition.define(SonarqubeJavaRulesDefinition.java:44)\n    at org.sonar.server.rule.RuleDefinitionsLoader.load(RuleDefinitionsLoader.java:56)\n    at org.sonar.server.rule.RegisterRules.start(RegisterRules.java:125)\n    at org.sonar.core.platform.StartableBeanPostProcessor.postProcessBeforeInitialization(StartableBeanPostProcessor.java:33)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:440)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1796)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:620)\n    ... 19 common frames omitted\nCaused by: java.lang.ClassNotFoundException: org.sonarsource.analyzer.commons.RuleMetadataLoader\n    at org.sonar.classloader.ParentFirstStrategy.loadClass(ParentFirstStrategy.java:39)\n    at org.sonar.classloader.ClassRealm.loadClass(ClassRealm.java:87)\n    at org.sonar.classloader.ClassRealm.loadClass(ClassRealm.java:76)\n</code></pre>\n<p>The line of code as mentioned in logs, (SonarqubeJavaRulesDefinition.java:44), is the following:\n<code>RuleMetadataLoader ruleMetadataLoader = new RuleMetadataLoader(RULES_BASE_PATH, runtime);</code></p>\n<p>The following is the pom.xml:</p>\n<pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n  &lt;groupId&gt;com.sonar.project&lt;/groupId&gt;\n  &lt;artifactId&gt;static-java-code-analysis&lt;/artifactId&gt;\n  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n  &lt;name&gt;StaticJavaCodeAnalysis&lt;/name&gt;\n  \n  &lt;description&gt;It defines the rules that detect energy smells in different loop types in java&lt;/description&gt;\n  &lt;packaging&gt;sonar-plugin&lt;/packaging&gt;\n  &lt;properties&gt;\n    &lt;java.version&gt;11&lt;/java.version&gt;\n    \n    &lt;!-- &lt;maven.compiler.source&gt;${java.version}&lt;/maven.compiler.source&gt;\n    &lt;maven.compiler.target&gt;${java.version}&lt;/maven.compiler.target&gt; --&gt;\n    &lt;sonarqube.version&gt;9.4.0.54424&lt;/sonarqube.version&gt;\n    &lt;sonar.organization&gt;ramgrg&lt;/sonar.organization&gt;\n    &lt;sonar.host.url&gt;https://sonarcloud.io&lt;/sonar.host.url&gt;\n    &lt;sonarjava.version&gt;7.15.0.30507&lt;/sonarjava.version&gt; \n    &lt;sonar.skipDependenciesPackaging&gt;true&lt;/sonar.skipDependenciesPackaging&gt;\n   &lt;/properties&gt;\n   &lt;dependencies&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n        &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;\n        &lt;version&gt;5.9.1&lt;/version&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n     &lt;/dependency&gt;\n     &lt;dependency&gt;\n       &lt;groupId&gt;org.assertj&lt;/groupId&gt;\n       &lt;artifactId&gt;assertj-core&lt;/artifactId&gt;\n       &lt;version&gt;3.23.1&lt;/version&gt;\n     &lt;/dependency&gt;\n      &lt;dependency&gt;\n         &lt;groupId&gt;org.sonarsource.sonarqube&lt;/groupId&gt;\n         &lt;artifactId&gt;sonar-plugin-api&lt;/artifactId&gt;\n         &lt;version&gt;${sonarqube.version}&lt;/version&gt;\n         &lt;scope&gt;provided&lt;/scope&gt;\n      &lt;/dependency&gt;\n     &lt;dependency&gt;\n       &lt;groupId&gt;org.sonarsource.analyzer-commons&lt;/groupId&gt;\n       &lt;artifactId&gt;sonar-analyzer-commons&lt;/artifactId&gt;\n       &lt;version&gt;2.1.0.1111&lt;/version&gt;\n     &lt;/dependency&gt;\n     &lt;dependency&gt;\n       &lt;groupId&gt;org.sonarsource.sonarqube&lt;/groupId&gt;\n       &lt;artifactId&gt;sonar-plugin-api-impl&lt;/artifactId&gt;\n       &lt;version&gt;9.7.1.62043&lt;/version&gt;\n     &lt;/dependency&gt;\n     &lt;dependency&gt;\n       &lt;groupId&gt;org.sonarsource.java&lt;/groupId&gt;\n       &lt;artifactId&gt;sonar-java-plugin&lt;/artifactId&gt;\n       &lt;version&gt;${sonarjava.version}&lt;/version&gt;\n       &lt;type&gt;sonar-plugin&lt;/type&gt;\n       &lt;scope&gt;provided&lt;/scope&gt;\n     &lt;/dependency&gt;\n     &lt;dependency&gt;\n       &lt;groupId&gt;org.sonarsource.java&lt;/groupId&gt;\n       &lt;artifactId&gt;java-checks-testkit&lt;/artifactId&gt;\n       &lt;version&gt;${sonarjava.version}&lt;/version&gt;\n       &lt;scope&gt;test&lt;/scope&gt;\n     &lt;/dependency&gt;\n  &lt;/dependencies&gt;\n   &lt;build&gt;\n      &lt;plugins&gt;\n          &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.11.0&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;source&gt;${java.version}&lt;/source&gt;\n                    &lt;target&gt;${java.version}&lt;/target&gt;\n                &lt;/configuration&gt;\n          &lt;/plugin&gt;\n          &lt;plugin&gt;\n             &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n             &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n             &lt;version&gt;3.0.0&lt;/version&gt;\n          &lt;/plugin&gt;\n          &lt;plugin&gt;\n             &lt;groupId&gt;org.sonarsource.sonar-packaging-maven-plugin&lt;/groupId&gt;\n             &lt;artifactId&gt;sonar-packaging-maven-plugin&lt;/artifactId&gt;\n             &lt;version&gt;1.21.0.505&lt;/version&gt;\n             &lt;extensions&gt;true&lt;/extensions&gt;\n             &lt;configuration&gt;\n                &lt;pluginKey&gt;staticjavacode&lt;/pluginKey&gt;\n                &lt;pluginName&gt;${project.name}&lt;/pluginName&gt;\n                &lt;pluginClass&gt;com.sonar.java.SonarqubeJavaplugin&lt;/pluginClass&gt;\n                &lt;sonarLintSupported&gt;true&lt;/sonarLintSupported&gt;\n             &lt;!--   &lt;skipDependenciesPackaging&gt;true&lt;/skipDependenciesPackaging&gt; --&gt;\n                &lt;sonarQubeMinVersion&gt;${sonarqube.version}&lt;/sonarQubeMinVersion&gt;\n                &lt;requirePlugins&gt;java:${sonarjava.version}&lt;/requirePlugins&gt;   \n             &lt;/configuration&gt;\n          &lt;/plugin&gt;\n      &lt;/plugins&gt;\n  &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<p>Any help is appreciated.</p>\n"},{"tags":["java","hibernate","spring-data-jpa","spring-data","eclipselink"],"comments":[{"owner":{"user_id":3426309,"display_name":"Andrey B. Panfilov"},"edited":false,"comment_id":134419498,"body":"afaik, you can&#39;t overcome that, hibernate creates insert task upon persist, so it expects all required fields are populated, however I do like that eclipselink behaviour."}],"owner":{"user_id":9944181,"display_name":"Hasn A"},"view_count":32,"up_vote_count":2,"answer_count":0,"score":2,"creation_date":1683769939,"question_id":76223632,"body":"<p>We are migrating our application from eclipselink to hibernate.\nIn our legacy code we are persisting the object first, then setting the values.\nThis used to work in eclipselink but fails in hibernate in the case when we try to call em.persist before setting the value of any field which has not-null constraint in DB.</p>\n<p>Error message I get:</p>\n<pre><code>could not execute statement; SQL [n/a]; constraint [null]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statement\n</code></pre>\n<p>eclipselink code which works:</p>\n<pre><code>//eclipselink 2.5.1\n@javax.ejb.TransactionAttribute(javax.ejb.TransactionAttributeType.REQUIRED)\npublic void save(Person p){\n    em.persist(p);\n    p.setEmail(&quot;abc@xyz.com&quot;);         \n}\n</code></pre>\n<p>Hibernate code which doesnt work(same code as eclipselink)</p>\n<pre><code>//hibernate 5.6.15\n@org.springframework.transaction.annotation.Transactional\npublic void save(Person p){\n    em.persist(p);             \n    p.setEmail(&quot;abc@xyz.com&quot;);\n}\n</code></pre>\n<p>Here p.setEmail() is set as not-null in DB.\nAnd exception is thrown after the method execution is completed and it goes to commit the transaction. And in logs the generated insert query has null value for property 'email'.</p>\n"},{"tags":["java","java-11","java-17","inetaddress","java-http-client"],"comments":[{"owner":{"user_id":1512592,"display_name":"Dirk Hillbrecht"},"edited":false,"comment_id":134409561,"body":"I&#39;d like to add that ChatGPT - which I asked in parallel - suggests an explicitly programmed loop through all IP addresses. While I find it astonishing that I get such an advise from an AI program, this has already come to my mind, too. However, I&#39;d strongly favor something <i>within</i> HttpClient or its helper classes."},{"owner":{"user_id":6650475,"display_name":"Andrew S"},"edited":false,"comment_id":134410325,"body":"Is the client configured to follow redirects?  How would a client even know all the potential IP addresses to iterate over them?  If a node of a cluster is down, then the load balancer of that cluster should not attempt to direct requests to the downed node.  A badly configured cluster is not a concern of the client."},{"owner":{"user_id":1512592,"display_name":"Dirk Hillbrecht"},"edited":false,"comment_id":134413121,"body":"The client should simply iterate over <code>InetAddress.getAllByName()</code>. This actually is what most clients (not only HTTP) do when it comes to address resolution. And it&#39;s not about &quot;bad configuration&quot;: If one of your three load balancers has a hardware failure, it will be in DNS for at least a while. And if a client only tries to connect to this single machine, it will fail - which is not needed as all it needs to do is to try one of the other addresses."}],"owner":{"user_id":1512592,"display_name":"Dirk Hillbrecht"},"view_count":27,"up_vote_count":2,"answer_count":0,"score":2,"creation_date":1683720432,"question_id":76218224,"body":"<p>How can I configure Java's own &quot;new&quot; (Java 9/11/17) HttpClient to try more than the first found IP adress behind a hostname? There are (at least) two scenarios:</p>\n<ol>\n<li>A server with IPv4 and IPv6 support:</li>\n</ol>\n<pre><code>&gt; host localhost\nlocalhost has address 127.0.0.1\nlocalhost has IPv6 address ::1\n</code></pre>\n<ol start=\"2\">\n<li>One &quot;logical&quot; hostname where the service is delivered by multiple redundant servers:</li>\n</ol>\n<pre><code>&gt; host frontend.example.com\nfrontend.example.com has address 245.3.4.5\nfrontend.example.com has address 246.4.5.6\nfrontend.example.com has IPv6 address 4f00:5678::19\nfrontend.example.com has IPv6 address 4f00:7890::20\n</code></pre>\n<p>My observation is that HttpClient only tries the <em>first</em> delivered address and fails if the service is not reachable under that address. Is there a way to tell it to try <em>all</em> assigned IP adresses - <code>InetAddress.getAllByName()</code> deliveres them - until a HTTP server can be found at one of them and fails only with &quot;no connection&quot; if <em>none</em> of them succeeds.</p>\n<p>In the first case, this is relevant if a certain service <em>only</em> binds to either the IPv4 or IPv6 address. In the second case, one of the servers or services could be down for maintenance or due to technical problems and the other one serves all incoming requests. So, in my optinion this should be a fairly common requirement for a HTTP client implementation. Still, I have not understood how to archieve this behaviour.</p>\n"}],"has_more":true,"quota_max":300,"quota_remaining":179}